(function(k,Nl){typeof exports=="object"&&typeof module<"u"?Nl(require("react"),require("react-dom")):typeof define=="function"&&define.amd?define(["react","react-dom"],Nl):(k=typeof globalThis<"u"?globalThis:k||self,Nl(k.React,k.ReactDOM))})(this,function(k,Nl){"use strict";function _R(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const s in t)if(s!=="default"){const n=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(e,s,n.get?n:{enumerable:!0,get:()=>t[s]})}}return e.default=t,Object.freeze(e)}function RR(t,e){for(var s=0;s<e.length;s++){const n=e[s];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in t)){const i=Object.getOwnPropertyDescriptor(n,r);i&&Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}const we=_R(k);var na=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function PR(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function FR(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var s=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};s.prototype=e.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(s,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}),s}var Gv={exports:{}},Rh={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var OR=k,MR=Symbol.for("react.element"),LR=Symbol.for("react.fragment"),zR=Object.prototype.hasOwnProperty,BR=OR.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,UR={key:!0,ref:!0,__self:!0,__source:!0};function Hv(t,e,s){var n,r={},i=null,o=null;s!==void 0&&(i=""+s),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)zR.call(e,n)&&!UR.hasOwnProperty(n)&&(r[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)r[n]===void 0&&(r[n]=e[n]);return{$$typeof:MR,type:t,key:i,ref:o,props:r,_owner:BR.current}}Rh.Fragment=LR,Rh.jsx=Hv,Rh.jsxs=Hv,Gv.exports=Rh;var a=Gv.exports;window.__POWERED_BY_QIANKUN__&&(window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__?__webpack_public_path__=window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__:console.warn("[Qiankun] __INJECTED_PUBLIC_PATH_BY_QIANKUN__ is not defined!"));var Ph={};/*!
 * vite-plugin-qiankun.js v1.0.14
 * (c) 2021-2022 Teng Mao Qing
 * Released under the MIT License.
 */Object.defineProperty(Ph,"__esModule",{value:!0});var kl=typeof window<"u"?window.proxy||window:{},qv=function(t){kl?.__POWERED_BY_QIANKUN__&&(window.moudleQiankunAppLifeCycles||(window.moudleQiankunAppLifeCycles={}),kl.qiankunName&&(window.moudleQiankunAppLifeCycles[kl.qiankunName]=t))};Ph.default=qv;var VR=Ph.qiankunWindow=kl;Ph.renderWithQiankun=qv;var Kv,Xv=Nl;Kv=Xv.createRoot,Xv.hydrateRoot;/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var WR={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GR=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Ee=(t,e)=>{const s=k.forwardRef(({color:n="currentColor",size:r=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:l="",children:c,...d},u)=>k.createElement("svg",{ref:u,...WR,width:r,height:r,stroke:n,strokeWidth:o?Number(i)*24/Number(r):i,className:["lucide",`lucide-${GR(t)}`,l].join(" "),...d},[...e.map(([h,p])=>k.createElement(h,p)),...Array.isArray(c)?c:[c]]));return s.displayName=`${t}`,s};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HR=Ee("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=Ee("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oc=Ee("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ra=Ee("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qR=Ee("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=Ee("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jr=Ee("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wg=Ee("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yv=Ee("BarChart",[["line",{x1:"12",x2:"12",y1:"20",y2:"10",key:"1vz5eb"}],["line",{x1:"18",x2:"18",y1:"20",y2:"4",key:"cun8e5"}],["line",{x1:"6",x2:"6",y1:"20",y2:"16",key:"hq0ia6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KR=Ee("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ti=Ee("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ia=Ee("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=Ee("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mc=Ee("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ai=Ee("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Er=Ee("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XR=Ee("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yr=Ee("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=Ee("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zv=Ee("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YR=Ee("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cl=Ee("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZR=Ee("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fh=Ee("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lc=Ee("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jv=Ee("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=Ee("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qv=Ee("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JR=Ee("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QR=Ee("Coffee",[["path",{d:"M17 8h1a4 4 0 1 1 0 8h-1",key:"jx4kbh"}],["path",{d:"M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z",key:"1bxrl0"}],["line",{x1:"6",x2:"6",y1:"2",y2:"4",key:"1cr9l3"}],["line",{x1:"10",x2:"10",y1:"2",y2:"4",key:"170wym"}],["line",{x1:"14",x2:"14",y1:"2",y2:"4",key:"1c5f70"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e4=Ee("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t4=Ee("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gg=Ee("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sl=Ee("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zc=Ee("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bc=Ee("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e1=Ee("Facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s4=Ee("Factory",[["path",{d:"M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"159hny"}],["path",{d:"M17 18h1",key:"uldtlt"}],["path",{d:"M12 18h1",key:"s9uhes"}],["path",{d:"M7 18h1",key:"1neino"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n4=Ee("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t1=Ee("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=Ee("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s1=Ee("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uc=Ee("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r4=Ee("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i4=Ee("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o4=Ee("GitFork",[["circle",{cx:"12",cy:"18",r:"3",key:"1mpf1b"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["path",{d:"M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9",key:"1uq4wg"}],["path",{d:"M12 12v3",key:"158kv8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ks=Ee("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a4=Ee("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l4=Ee("HandHeart",[["path",{d:"M11 14h2a2 2 0 1 0 0-4h-3c-.6 0-1.1.2-1.4.6L3 16",key:"1ifwr1"}],["path",{d:"m7 20 1.6-1.4c.3-.4.8-.6 1.4-.6h4c1.1 0 2.1-.4 2.8-1.2l4.6-4.4a2 2 0 0 0-2.75-2.91l-4.2 3.9",key:"17abbs"}],["path",{d:"m2 15 6 6",key:"10dquu"}],["path",{d:"M19.5 8.5c.7-.7 1.5-1.6 1.5-2.7A2.73 2.73 0 0 0 16 4a2.78 2.78 0 0 0-5 1.8c0 1.2.8 2 1.5 2.8L16 12Z",key:"1h3036"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vc=Ee("Headphones",[["path",{d:"M3 14h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-7a9 9 0 0 1 18 0v7a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3",key:"1xhozi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c4=Ee("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n1=Ee("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d4=Ee("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u4=Ee("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r1=Ee("Languages",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i1=Ee("LineChart",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h4=Ee("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Di=Ee("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p4=Ee("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jl=Ee("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zr=Ee("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f4=Ee("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o1=Ee("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _i=Ee("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wc=Ee("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m4=Ee("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a1=Ee("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hg=Ee("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l1=Ee("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g4=Ee("PhoneCall",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}],["path",{d:"M14.05 2a9 9 0 0 1 8 7.94",key:"vmijpz"}],["path",{d:"M14.05 6A5 5 0 0 1 18 10",key:"13nbpp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oa=Ee("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x4=Ee("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qg=Ee("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=Ee("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $r=Ee("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kg=Ee("Rocket",[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c1=Ee("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Il=Ee("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qn=Ee("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oh=Ee("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xg=Ee("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const El=Ee("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const po=Ee("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d1=Ee("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b4=Ee("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y4=Ee("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w4=Ee("Sunrise",[["path",{d:"M12 2v8",key:"1q4o3n"}],["path",{d:"m4.93 10.93 1.41 1.41",key:"2a7f42"}],["path",{d:"M2 18h2",key:"j10viu"}],["path",{d:"M20 18h2",key:"wocana"}],["path",{d:"m19.07 10.93-1.41 1.41",key:"15zs5n"}],["path",{d:"M22 22H2",key:"19qnx5"}],["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}],["path",{d:"M16 18a4 4 0 0 0-8 0",key:"1lzouq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ys=Ee("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u1=Ee("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h1=Ee("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const er=Ee("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v4=Ee("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=Ee("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N4=Ee("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k4=Ee("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ri=Ee("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p1=Ee("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $l=Ee("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tr=Ee("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const f1=Ee("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fo=Ee("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pi=Ee("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yg=Ee("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);let C4={data:""},S4=t=>typeof window=="object"?((t?t.querySelector("#_goober"):window._goober)||Object.assign((t||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:t||C4,j4=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,I4=/\/\*[^]*?\*\/|  +/g,m1=/\n+/g,mo=(t,e)=>{let s="",n="",r="";for(let i in t){let o=t[i];i[0]=="@"?i[1]=="i"?s=i+" "+o+";":n+=i[1]=="f"?mo(o,i):i+"{"+mo(o,i[1]=="k"?"":e)+"}":typeof o=="object"?n+=mo(o,e?e.replace(/([^,])+/g,l=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,c=>/&/.test(c)?c.replace(/&/g,l):l?l+" "+c:c)):i):o!=null&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),r+=mo.p?mo.p(i,o):i+":"+o+";")}return s+(e&&r?e+"{"+r+"}":r)+n},Fi={},g1=t=>{if(typeof t=="object"){let e="";for(let s in t)e+=s+g1(t[s]);return e}return t},E4=(t,e,s,n,r)=>{let i=g1(t),o=Fi[i]||(Fi[i]=(c=>{let d=0,u=11;for(;d<c.length;)u=101*u+c.charCodeAt(d++)>>>0;return"go"+u})(i));if(!Fi[o]){let c=i!==t?t:(d=>{let u,h,p=[{}];for(;u=j4.exec(d.replace(I4,""));)u[4]?p.shift():u[3]?(h=u[3].replace(m1," ").trim(),p.unshift(p[0][h]=p[0][h]||{})):p[0][u[1]]=u[2].replace(m1," ").trim();return p[0]})(t);Fi[o]=mo(r?{["@keyframes "+o]:c}:c,s?"":"."+o)}let l=s&&Fi.g?Fi.g:null;return s&&(Fi.g=Fi[o]),((c,d,u,h)=>{h?d.data=d.data.replace(h,c):d.data.indexOf(c)===-1&&(d.data=u?c+d.data:d.data+c)})(Fi[o],e,n,l),o},$4=(t,e,s)=>t.reduce((n,r,i)=>{let o=e[i];if(o&&o.call){let l=o(s),c=l&&l.props&&l.props.className||/^go/.test(l)&&l;o=c?"."+c:l&&typeof l=="object"?l.props?"":mo(l,""):l===!1?"":l}return n+r+(o??"")},"");function Mh(t){let e=this||{},s=t.call?t(e.p):t;return E4(s.unshift?s.raw?$4(s,[].slice.call(arguments,1),e.p):s.reduce((n,r)=>Object.assign(n,r&&r.call?r(e.p):r),{}):s,S4(e.target),e.g,e.o,e.k)}let x1,Zg,Jg;Mh.bind({g:1});let Oi=Mh.bind({k:1});function T4(t,e,s,n){mo.p=e,x1=t,Zg=s,Jg=n}function go(t,e){let s=this||{};return function(){let n=arguments;function r(i,o){let l=Object.assign({},i),c=l.className||r.className;s.p=Object.assign({theme:Zg&&Zg()},l),s.o=/ *go\d+/.test(c),l.className=Mh.apply(s,n)+(c?" "+c:"");let d=t;return t[0]&&(d=l.as||t,delete l.as),Jg&&d[0]&&Jg(l),x1(d,l)}return r}}var A4=t=>typeof t=="function",Lh=(t,e)=>A4(t)?t(e):t,D4=(()=>{let t=0;return()=>(++t).toString()})(),b1=(()=>{let t;return()=>{if(t===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");t=!e||e.matches}return t}})(),_4=20,y1=(t,e)=>{switch(e.type){case 0:return{...t,toasts:[e.toast,...t.toasts].slice(0,_4)};case 1:return{...t,toasts:t.toasts.map(i=>i.id===e.toast.id?{...i,...e.toast}:i)};case 2:let{toast:s}=e;return y1(t,{type:t.toasts.find(i=>i.id===s.id)?1:0,toast:s});case 3:let{toastId:n}=e;return{...t,toasts:t.toasts.map(i=>i.id===n||n===void 0?{...i,dismissed:!0,visible:!1}:i)};case 4:return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(i=>i.id!==e.toastId)};case 5:return{...t,pausedAt:e.time};case 6:let r=e.time-(t.pausedAt||0);return{...t,pausedAt:void 0,toasts:t.toasts.map(i=>({...i,pauseDuration:i.pauseDuration+r}))}}},zh=[],aa={toasts:[],pausedAt:void 0},la=t=>{aa=y1(aa,t),zh.forEach(e=>{e(aa)})},R4={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},P4=(t={})=>{let[e,s]=k.useState(aa),n=k.useRef(aa);k.useEffect(()=>(n.current!==aa&&s(aa),zh.push(s),()=>{let i=zh.indexOf(s);i>-1&&zh.splice(i,1)}),[]);let r=e.toasts.map(i=>{var o,l,c;return{...t,...t[i.type],...i,removeDelay:i.removeDelay||((o=t[i.type])==null?void 0:o.removeDelay)||t?.removeDelay,duration:i.duration||((l=t[i.type])==null?void 0:l.duration)||t?.duration||R4[i.type],style:{...t.style,...(c=t[i.type])==null?void 0:c.style,...i.style}}});return{...e,toasts:r}},F4=(t,e="blank",s)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:t,pauseDuration:0,...s,id:s?.id||D4()}),Gc=t=>(e,s)=>{let n=F4(e,t,s);return la({type:2,toast:n}),n.id},jt=(t,e)=>Gc("blank")(t,e);jt.error=Gc("error"),jt.success=Gc("success"),jt.loading=Gc("loading"),jt.custom=Gc("custom"),jt.dismiss=t=>{la({type:3,toastId:t})},jt.remove=t=>la({type:4,toastId:t}),jt.promise=(t,e,s)=>{let n=jt.loading(e.loading,{...s,...s?.loading});return typeof t=="function"&&(t=t()),t.then(r=>{let i=e.success?Lh(e.success,r):void 0;return i?jt.success(i,{id:n,...s,...s?.success}):jt.dismiss(n),r}).catch(r=>{let i=e.error?Lh(e.error,r):void 0;i?jt.error(i,{id:n,...s,...s?.error}):jt.dismiss(n)}),t};var O4=(t,e)=>{la({type:1,toast:{id:t,height:e}})},M4=()=>{la({type:5,time:Date.now()})},Hc=new Map,L4=1e3,z4=(t,e=L4)=>{if(Hc.has(t))return;let s=setTimeout(()=>{Hc.delete(t),la({type:4,toastId:t})},e);Hc.set(t,s)},B4=t=>{let{toasts:e,pausedAt:s}=P4(t);k.useEffect(()=>{if(s)return;let i=Date.now(),o=e.map(l=>{if(l.duration===1/0)return;let c=(l.duration||0)+l.pauseDuration-(i-l.createdAt);if(c<0){l.visible&&jt.dismiss(l.id);return}return setTimeout(()=>jt.dismiss(l.id),c)});return()=>{o.forEach(l=>l&&clearTimeout(l))}},[e,s]);let n=k.useCallback(()=>{s&&la({type:6,time:Date.now()})},[s]),r=k.useCallback((i,o)=>{let{reverseOrder:l=!1,gutter:c=8,defaultPosition:d}=o||{},u=e.filter(f=>(f.position||d)===(i.position||d)&&f.height),h=u.findIndex(f=>f.id===i.id),p=u.filter((f,m)=>m<h&&f.visible).length;return u.filter(f=>f.visible).slice(...l?[p+1]:[0,p]).reduce((f,m)=>f+(m.height||0)+c,0)},[e]);return k.useEffect(()=>{e.forEach(i=>{if(i.dismissed)z4(i.id,i.removeDelay);else{let o=Hc.get(i.id);o&&(clearTimeout(o),Hc.delete(i.id))}})},[e]),{toasts:e,handlers:{updateHeight:O4,startPause:M4,endPause:n,calculateOffset:r}}},U4=Oi`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,V4=Oi`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,W4=Oi`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,G4=go("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${U4} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${V4} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${t=>t.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${W4} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,H4=Oi`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,q4=go("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${t=>t.secondary||"#e0e0e0"};
  border-right-color: ${t=>t.primary||"#616161"};
  animation: ${H4} 1s linear infinite;
`,K4=Oi`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,X4=Oi`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Y4=go("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${K4} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${X4} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${t=>t.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Z4=go("div")`
  position: absolute;
`,J4=go("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Q4=Oi`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,e3=go("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Q4} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,t3=({toast:t})=>{let{icon:e,type:s,iconTheme:n}=t;return e!==void 0?typeof e=="string"?we.createElement(e3,null,e):e:s==="blank"?null:we.createElement(J4,null,we.createElement(q4,{...n}),s!=="loading"&&we.createElement(Z4,null,s==="error"?we.createElement(G4,{...n}):we.createElement(Y4,{...n})))},s3=t=>`
0% {transform: translate3d(0,${t*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,n3=t=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${t*-150}%,-1px) scale(.6); opacity:0;}
`,r3="0%{opacity:0;} 100%{opacity:1;}",i3="0%{opacity:1;} 100%{opacity:0;}",o3=go("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,a3=go("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,l3=(t,e)=>{let s=t.includes("top")?1:-1,[n,r]=b1()?[r3,i3]:[s3(s),n3(s)];return{animation:e?`${Oi(n)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Oi(r)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},c3=we.memo(({toast:t,position:e,style:s,children:n})=>{let r=t.height?l3(t.position||e||"top-center",t.visible):{opacity:0},i=we.createElement(t3,{toast:t}),o=we.createElement(a3,{...t.ariaProps},Lh(t.message,t));return we.createElement(o3,{className:t.className,style:{...r,...s,...t.style}},typeof n=="function"?n({icon:i,message:o}):we.createElement(we.Fragment,null,i,o))});T4(we.createElement);var d3=({id:t,className:e,style:s,onHeightUpdate:n,children:r})=>{let i=we.useCallback(o=>{if(o){let l=()=>{let c=o.getBoundingClientRect().height;n(t,c)};l(),new MutationObserver(l).observe(o,{subtree:!0,childList:!0,characterData:!0})}},[t,n]);return we.createElement("div",{ref:i,className:e,style:s},r)},u3=(t,e)=>{let s=t.includes("top"),n=s?{top:0}:{bottom:0},r=t.includes("center")?{justifyContent:"center"}:t.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:b1()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(s?1:-1)}px)`,...n,...r}},h3=Mh`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Bh=16,w1=({reverseOrder:t,position:e="top-center",toastOptions:s,gutter:n,children:r,containerStyle:i,containerClassName:o})=>{let{toasts:l,handlers:c}=B4(s);return we.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:Bh,left:Bh,right:Bh,bottom:Bh,pointerEvents:"none",...i},className:o,onMouseEnter:c.startPause,onMouseLeave:c.endPause},l.map(d=>{let u=d.position||e,h=c.calculateOffset(d,{reverseOrder:t,gutter:n,defaultPosition:e}),p=u3(u,h);return we.createElement(d3,{id:d.id,key:d.id,onHeightUpdate:c.updateHeight,className:d.visible?h3:"",style:p},d.type==="custom"?Lh(d.message,d):r?r(d):we.createElement(c3,{toast:d,position:u}))}))};/*! js-cookie v3.0.5 | MIT */function Uh(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)t[n]=s[n]}return t}var p3={read:function(t){return t[0]==='"'&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function Qg(t,e){function s(r,i,o){if(!(typeof document>"u")){o=Uh({},e,o),typeof o.expires=="number"&&(o.expires=new Date(Date.now()+o.expires*864e5)),o.expires&&(o.expires=o.expires.toUTCString()),r=encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var l="";for(var c in o)o[c]&&(l+="; "+c,o[c]!==!0&&(l+="="+o[c].split(";")[0]));return document.cookie=r+"="+t.write(i,r)+l}}function n(r){if(!(typeof document>"u"||arguments.length&&!r)){for(var i=document.cookie?document.cookie.split("; "):[],o={},l=0;l<i.length;l++){var c=i[l].split("="),d=c.slice(1).join("=");try{var u=decodeURIComponent(c[0]);if(o[u]=t.read(d,u),r===u)break}catch{}}return r?o[r]:o}}return Object.create({set:s,get:n,remove:function(r,i){s(r,"",Uh({},i,{expires:-1}))},withAttributes:function(r){return Qg(this.converter,Uh({},this.attributes,r))},withConverter:function(r){return Qg(Uh({},this.converter,r),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(t)}})}var De=Qg(p3,{path:"/"});const f3=()=>{const[t,e]=k.useState("automatic"),[s,n]=k.useState([{id:1,name:"John Smith",skills:["Web Development","UI/UX Design"],status:"Complete",successRate:"95%"},{id:2,name:"Sarah Johnson",skills:["Digital Marketing","Content Creation"],status:"Incomplete",successRate:"87%"},{id:3,name:"Michael Brown",skills:["Project Management","Agile"],status:"Complete",successRate:"92%"},{id:4,name:"Emily Davis",skills:["Data Analysis","Machine Learning"],status:"Complete",successRate:"89%"},{id:5,name:"David Wilson",skills:["Mobile Development","React Native"],status:"Incomplete",successRate:"78%"}]);return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Profile Creation"}),a.jsxs("button",{className:"flex items-center space-x-2 rounded-lg bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700",children:[a.jsx(Xs,{className:"h-5 w-5"}),a.jsx("span",{children:"New Profile"})]})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsxs("div",{className:"mb-6 flex space-x-4 border-b border-gray-200",children:[a.jsx("button",{className:`border-b-2 px-4 py-2 font-medium ${t==="automatic"?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700"}`,onClick:()=>e("automatic"),children:"Automatic Generation"}),a.jsx("button",{className:`border-b-2 px-4 py-2 font-medium ${t==="manual"?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700"}`,onClick:()=>e("manual"),children:"Manual Creation"}),a.jsx("button",{className:`border-b-2 px-4 py-2 font-medium ${t==="import"?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700"}`,onClick:()=>e("import"),children:"Import Profiles"})]}),t==="automatic"&&a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"rounded-lg bg-indigo-50 p-4 text-indigo-700",children:a.jsx("p",{className:"text-sm",children:"The AI will automatically generate detailed profiles based on available data sources. You can review and customize the generated profiles before finalizing."})}),a.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Data Sources"}),a.jsx("div",{className:"mt-2 space-y-2",children:["LinkedIn Profiles","Resume Database","Previous Performance Data","Skills Assessment"].map((r,i)=>a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:`source-${i}`,className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500",defaultChecked:!0}),a.jsx("label",{htmlFor:`source-${i}`,className:"ml-2 text-sm text-gray-700",children:r})]},i))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Profile Depth"}),a.jsxs("select",{className:"mt-2 block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-base focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm",children:[a.jsx("option",{children:"Basic (Skills & Experience)"}),a.jsx("option",{children:"Standard (+ Performance Metrics)"}),a.jsx("option",{children:"Comprehensive (+ Success Patterns)"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Search for Existing Profiles"}),a.jsxs("div",{className:"mt-2 flex rounded-md shadow-sm",children:[a.jsxs("div",{className:"relative flex flex-grow items-stretch",children:[a.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:a.jsx(Il,{className:"h-5 w-5 text-gray-400"})}),a.jsx("input",{type:"text",className:"block w-full rounded-md border-gray-300 pl-10 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Search by name, skills, or experience..."})]}),a.jsx("button",{className:"ml-3 inline-flex items-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:"Search"})]})]}),a.jsx("button",{className:"w-full rounded-md bg-indigo-600 py-2 px-4 text-white hover:bg-indigo-700",children:"Generate Profiles"})]}),t==="manual"&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Full Name"}),a.jsx("input",{type:"text",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"John Smith"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),a.jsx("input",{type:"email",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"john.smith@example.com"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Skills (comma separated)"}),a.jsx("input",{type:"text",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Web Development, UI/UX Design, JavaScript, React"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Experience"}),a.jsx("textarea",{rows:4,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Describe professional experience..."})]}),a.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Hourly Rate ($)"}),a.jsx("input",{type:"number",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"75"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Availability"}),a.jsxs("select",{className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",children:[a.jsx("option",{children:"Full-time"}),a.jsx("option",{children:"Part-time"}),a.jsx("option",{children:"Weekends only"}),a.jsx("option",{children:"Evenings only"})]})]})]}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsx("button",{className:"rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:"Cancel"}),a.jsx("button",{className:"rounded-md bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",children:"Create Profile"})]})]}),t==="import"&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"rounded-lg border-2 border-dashed border-gray-300 p-6 text-center",children:[a.jsx("div",{className:"flex justify-center",children:a.jsx(Ri,{className:"h-12 w-12 text-gray-400"})}),a.jsx("p",{className:"mt-2 text-sm font-medium text-gray-900",children:"Drag and drop CSV or Excel files"}),a.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Or click to browse from your computer"}),a.jsx("input",{type:"file",className:"hidden",id:"file-upload",accept:".csv, .xlsx, .xls"}),a.jsx("button",{onClick:()=>document.getElementById("file-upload")?.click(),className:"mt-4 inline-flex items-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",children:"Select Files"})]}),a.jsxs("div",{className:"rounded-lg bg-gray-50 p-4",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Import Guidelines"}),a.jsxs("ul",{className:"mt-2 list-disc pl-5 text-xs text-gray-500",children:[a.jsx("li",{children:"Use our template for best results"}),a.jsx("li",{children:"CSV or Excel files only"}),a.jsx("li",{children:"Maximum 100 profiles per import"}),a.jsx("li",{children:"Required fields: Name, Email, Skills"}),a.jsx("li",{children:"Optional fields will be generated by AI if missing"})]}),a.jsx("button",{className:"mt-3 text-xs font-medium text-indigo-600 hover:text-indigo-500",children:"Download Template"})]})]})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h2",{className:"mb-4 text-lg font-semibold text-gray-900",children:"Existing Profiles"}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Name"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Skills"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Status"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Success Rate"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Actions"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:s.map(r=>a.jsxs("tr",{children:[a.jsx("td",{className:"whitespace-nowrap px-6 py-4",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"h-10 w-10 flex-shrink-0 rounded-full bg-indigo-100 flex items-center justify-center",children:a.jsx(Jv,{className:"h-6 w-6 text-indigo-600"})}),a.jsx("div",{className:"ml-4",children:a.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.name})})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("div",{className:"flex flex-wrap gap-1",children:r.skills.map((i,o)=>a.jsx("span",{className:"inline-flex items-center rounded-full bg-indigo-100 px-2.5 py-0.5 text-xs font-medium text-indigo-800",children:i},o))})}),a.jsx("td",{className:"whitespace-nowrap px-6 py-4",children:r.status==="Complete"?a.jsxs("span",{className:"inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800",children:[a.jsx(ht,{className:"mr-1 h-3 w-3"}),"Complete"]}):a.jsxs("span",{className:"inline-flex items-center rounded-full bg-yellow-100 px-2.5 py-0.5 text-xs font-medium text-yellow-800",children:[a.jsx(hs,{className:"mr-1 h-3 w-3"}),"Incomplete"]})}),a.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-500",children:r.successRate}),a.jsxs("td",{className:"whitespace-nowrap px-6 py-4 text-right text-sm font-medium",children:[a.jsx("button",{className:"mr-2 text-indigo-600 hover:text-indigo-900",children:a.jsx(po,{className:"h-4 w-4"})}),a.jsx("button",{className:"text-red-600 hover:text-red-900",children:a.jsx(er,{className:"h-4 w-4"})})]})]},r.id))})]})})]})]})},m3=()=>{const[t,e]=k.useState("create"),[s,n]=k.useState([{id:1,title:"Web Development Project",client:"XYZ Corp",budget:"$2,500",status:"Published",matches:8},{id:2,title:"Digital Marketing Campaign",client:"ABC Inc",budget:"$1,800",status:"Draft",matches:0},{id:3,title:"Mobile App Development",client:"Tech Startup",budget:"$5,000",status:"Published",matches:12},{id:4,title:"Content Creation for Blog",client:"Marketing Agency",budget:"$800",status:"Pending Approval",matches:0},{id:5,title:"UI/UX Design for Website",client:"E-commerce Store",budget:"$1,200",status:"Published",matches:5}]);return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gig Generation"}),a.jsxs("button",{className:"flex items-center space-x-2 rounded-lg bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700",children:[a.jsx(Xs,{className:"h-5 w-5"}),a.jsx("span",{children:"New Gig"})]})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsxs("div",{className:"mb-6 flex space-x-4 border-b border-gray-200",children:[a.jsx("button",{className:`border-b-2 px-4 py-2 font-medium ${t==="create"?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700"}`,onClick:()=>e("create"),children:"Create Gig"}),a.jsx("button",{className:`border-b-2 px-4 py-2 font-medium ${t==="optimize"?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700"}`,onClick:()=>e("optimize"),children:"Optimize Existing"}),a.jsx("button",{className:`border-b-2 px-4 py-2 font-medium ${t==="templates"?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700"}`,onClick:()=>e("templates"),children:"Templates"})]}),t==="create"&&a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"rounded-lg bg-indigo-50 p-4 text-indigo-700",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx(El,{className:"mr-2 h-5 w-5 flex-shrink-0"}),a.jsx("p",{className:"text-sm",children:"The AI will help you create an optimized gig description based on your requirements. Fill in the details below or use our quick-start templates."})]})}),a.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Gig Title"}),a.jsx("input",{type:"text",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"e.g., Web Development Project"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Client/Company"}),a.jsx("input",{type:"text",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"e.g., XYZ Corporation"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Gig Description"}),a.jsx("textarea",{rows:4,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Describe the project, requirements, and desired outcomes..."})]}),a.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Budget"}),a.jsxs("div",{className:"mt-1 flex rounded-md shadow-sm",children:[a.jsx("span",{className:"inline-flex items-center rounded-l-md border border-r-0 border-gray-300 bg-gray-50 px-3 text-gray-500 sm:text-sm",children:"$"}),a.jsx("input",{type:"number",className:"block w-full flex-1 rounded-none rounded-r-md border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"1000"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Duration"}),a.jsxs("div",{className:"mt-1 flex rounded-md shadow-sm",children:[a.jsx("input",{type:"number",className:"block w-full flex-1 rounded-l-md border-gray-300 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"2"}),a.jsx("span",{className:"inline-flex items-center rounded-r-md border border-l-0 border-gray-300 bg-gray-50 px-3 text-gray-500 sm:text-sm",children:"weeks"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Required Skills"}),a.jsx("input",{type:"text",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"e.g., JavaScript, React, Node.js"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Optimization Level"}),a.jsxs("div",{className:"mt-2 grid grid-cols-1 gap-4 sm:grid-cols-3",children:[a.jsxs("div",{className:"relative flex cursor-pointer rounded-lg border bg-white p-4 shadow-sm focus:outline-none",children:[a.jsx("input",{type:"radio",name:"optimization",value:"basic",className:"h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500",defaultChecked:!0}),a.jsxs("div",{className:"ml-3 flex flex-col",children:[a.jsx("span",{className:"block text-sm font-medium text-gray-900",children:"Basic"}),a.jsx("span",{className:"block text-xs text-gray-500",children:"Grammar & clarity checks"})]})]}),a.jsxs("div",{className:"relative flex cursor-pointer rounded-lg border bg-white p-4 shadow-sm focus:outline-none",children:[a.jsx("input",{type:"radio",name:"optimization",value:"standard",className:"h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"}),a.jsxs("div",{className:"ml-3 flex flex-col",children:[a.jsx("span",{className:"block text-sm font-medium text-gray-900",children:"Standard"}),a.jsx("span",{className:"block text-xs text-gray-500",children:"+ Keyword optimization"})]})]}),a.jsxs("div",{className:"relative flex cursor-pointer rounded-lg border bg-white p-4 shadow-sm focus:outline-none",children:[a.jsx("input",{type:"radio",name:"optimization",value:"premium",className:"h-4 w-4 border-gray-300 text-indigo-600 focus:ring-indigo-500"}),a.jsxs("div",{className:"ml-3 flex flex-col",children:[a.jsx("span",{className:"block text-sm font-medium text-gray-900",children:"Premium"}),a.jsx("span",{className:"block text-xs text-gray-500",children:"+ Conversion optimization"})]})]})]})]}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsx("button",{className:"rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:"Save as Draft"}),a.jsx("button",{className:"rounded-md bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",children:"Generate & Preview"})]})]}),t==="optimize"&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Select Gig to Optimize"}),a.jsxs("div",{className:"mt-2 flex rounded-md shadow-sm",children:[a.jsxs("div",{className:"relative flex flex-grow items-stretch",children:[a.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:a.jsx(Il,{className:"h-5 w-5 text-gray-400"})}),a.jsx("input",{type:"text",className:"block w-full rounded-md border-gray-300 pl-10 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Search by title or client..."})]}),a.jsx("button",{className:"ml-3 inline-flex items-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:"Search"})]})]}),a.jsxs("div",{className:"rounded-lg border border-gray-200 p-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Digital Marketing Campaign"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Client: ABC Inc"})]}),a.jsx("span",{className:"inline-flex items-center rounded-full bg-yellow-100 px-2.5 py-0.5 text-xs font-medium text-yellow-800",children:"Draft"})]}),a.jsx("div",{className:"mt-4",children:a.jsx("p",{className:"text-sm text-gray-700",children:"Looking for a digital marketing expert to help with our new product launch. Need someone with experience in social media marketing, email campaigns, and PPC advertising."})}),a.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-xs text-gray-500",children:"Budget:"}),a.jsx("span",{className:"ml-1 text-sm font-medium text-gray-900",children:"$1,800"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-xs text-gray-500",children:"Duration:"}),a.jsx("span",{className:"ml-1 text-sm font-medium text-gray-900",children:"3 weeks"})]})]}),a.jsxs("button",{className:"inline-flex items-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",children:[a.jsx(El,{className:"mr-1 h-4 w-4"}),"Optimize"]})]})]}),a.jsxs("div",{className:"rounded-lg bg-indigo-50 p-4",children:[a.jsx("h3",{className:"text-sm font-medium text-indigo-900",children:"AI Optimization Suggestions"}),a.jsxs("ul",{className:"mt-2 space-y-2",children:[a.jsxs("li",{className:"flex items-start",children:[a.jsx(js,{className:"mr-2 h-4 w-4 text-indigo-600"}),a.jsx("span",{className:"text-sm text-indigo-700",children:"Add specific KPIs and success metrics to attract qualified candidates"})]}),a.jsxs("li",{className:"flex items-start",children:[a.jsx(js,{className:"mr-2 h-4 w-4 text-indigo-600"}),a.jsx("span",{className:"text-sm text-indigo-700",children:"Include information about target audience and platforms"})]}),a.jsxs("li",{className:"flex items-start",children:[a.jsx(js,{className:"mr-2 h-4 w-4 text-indigo-600"}),a.jsx("span",{className:"text-sm text-indigo-700",children:"Specify required reporting frequency and format"})]})]}),a.jsx("button",{className:"mt-3 text-sm font-medium text-indigo-600 hover:text-indigo-500",children:"Apply All Suggestions"})]})]}),t==="templates"&&a.jsx("div",{className:"space-y-6",children:a.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[{title:"Web Development",description:"For website creation, maintenance, or redesign projects",skills:["HTML/CSS","JavaScript","React"]},{title:"Digital Marketing",description:"For social media, email, and advertising campaigns",skills:["Social Media","SEO","Content"]},{title:"Mobile App Development",description:"For iOS and Android application projects",skills:["Swift","Kotlin","React Native"]},{title:"UI/UX Design",description:"For user interface and experience design projects",skills:["Figma","User Research","Prototyping"]},{title:"Content Creation",description:"For blog posts, articles, and copywriting",skills:["Writing","Editing","SEO"]},{title:"Data Analysis",description:"For data processing and insights generation",skills:["SQL","Python","Visualization"]}].map((r,i)=>a.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-4 shadow-sm hover:shadow-md",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:r.title}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:r.description}),a.jsx("div",{className:"mt-3 flex flex-wrap gap-1",children:r.skills.map((o,l)=>a.jsx("span",{className:"inline-flex items-center rounded-full bg-indigo-100 px-2.5 py-0.5 text-xs font-medium text-indigo-800",children:o},l))}),a.jsx("button",{className:"mt-4 w-full rounded-md bg-indigo-600 py-2 text-sm font-medium text-white hover:bg-indigo-700",children:"Use Template"})]},i))})})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h2",{className:"mb-4 text-lg font-semibold text-gray-900",children:"Existing Gigs"}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Title"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Client"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Budget"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Status"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Matches"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Actions"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:s.map(r=>a.jsxs("tr",{children:[a.jsx("td",{className:"whitespace-nowrap px-6 py-4",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"h-10 w-10 flex-shrink-0 rounded-full bg-indigo-100 flex items-center justify-center",children:a.jsx(Ir,{className:"h-6 w-6 text-indigo-600"})}),a.jsx("div",{className:"ml-4",children:a.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.title})})]})}),a.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-500",children:r.client}),a.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-500",children:r.budget}),a.jsx("td",{className:"whitespace-nowrap px-6 py-4",children:r.status==="Published"?a.jsxs("span",{className:"inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800",children:[a.jsx(ht,{className:"mr-1 h-3 w-3"}),"Published"]}):r.status==="Draft"?a.jsxs("span",{className:"inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800",children:[a.jsx(po,{className:"mr-1 h-3 w-3"}),"Draft"]}):a.jsxs("span",{className:"inline-flex items-center rounded-full bg-yellow-100 px-2.5 py-0.5 text-xs font-medium text-yellow-800",children:[a.jsx(St,{className:"mr-1 h-3 w-3"}),"Pending Approval"]})}),a.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-500",children:r.matches>0?a.jsxs("span",{className:"inline-flex items-center rounded-full bg-indigo-100 px-2.5 py-0.5 text-xs font-medium text-indigo-800",children:[r.matches," matches"]}):a.jsx("span",{className:"text-gray-400",children:"-"})}),a.jsxs("td",{className:"whitespace-nowrap px-6 py-4 text-right text-sm font-medium",children:[a.jsx("button",{className:"mr-2 text-indigo-600 hover:text-indigo-900",children:a.jsx(po,{className:"h-4 w-4"})}),a.jsx("button",{className:"text-red-600 hover:text-red-900",children:a.jsx(er,{className:"h-4 w-4"})})]})]},r.id))})]})})]})]})},Bn="http://localhost:5011/api",g3="http://localhost:5012/api",x3=async()=>{console.log("getReps called");try{const t=await fetch(`${Bn}/reps`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok){const s=await t.json();throw new Error(s.message||"Failed to fetch reps")}const e=await t.json();if(console.log("Parsed getReps response:",e),!Array.isArray(e))throw new Error("Invalid response format: expected an array of reps");return e}catch(t){throw console.error("Error in getReps:",t),t}},b3=async()=>{console.log("getGigs called");try{const t=await fetch(`${Bn}/gigs`);if(!t.ok){const s=await t.json();throw new Error(s.message||"Failed to fetch gigs")}const e=await t.json();if(console.log("Parsed getGigs response:",e),!Array.isArray(e))throw new Error("Invalid response format: expected an array of gigs");return e}catch(t){throw console.error("Error in getGigs:",t),t}},y3=async t=>{console.log("getGigsByCompanyId called with:",t);try{const e=await fetch(`${g3}/gigs/company/${t}`);if(!e.ok)throw new Error("Failed to fetch gigs by company");const s=await e.json();return console.log("Parsed getGigsByCompanyId response:",s),s.data||[]}catch(e){throw console.error("Error in getGigsByCompanyId:",e),e}},ex=async(t,e)=>{console.log("findMatchesForGig called with:",{gigId:t,weights:e});try{const s=await fetch(`${Bn}/matches/gig/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({weights:e})});if(!s.ok){let r="Failed to find matches for gig";try{r=(await s.json()).message||r}catch{r=`HTTP ${s.status}: ${s.statusText}`}throw s.status===404?r=`Gig with ID ${t} not found`:s.status===400?r=`Invalid request data for gig ${t}`:s.status===500&&(r=`Server error while processing gig ${t}`),new Error(r)}const n=await s.json();return console.log("Parsed findMatchesForGig response:",n),n.preferedmatches?n:{totalMatches:n.matches?.length||0,perfectMatches:0,partialMatches:0,noMatches:0,preferedmatches:n.matches||[],matches:n.matches||[]}}catch(s){throw console.error("Error in findMatchesForGig:",s),s.name==="TypeError"&&s.message.includes("fetch")?new Error(`Network error: Unable to connect to matching service. ${s.message}`):s.message?new Error(`Matching error: ${s.message}`):new Error(`Unknown error occurred while finding matches for gig ${t}`)}},w3=async t=>{console.log("createGigAgent called with:",t);try{const e=await fetch(`${Bn}/gig-agents`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){const n=await e.json();throw new Error(n.message||"Failed to create gig-agent")}const s=await e.json();return console.log("Parsed createGigAgent response:",s),s}catch(e){throw console.error("Error in createGigAgent:",e),e}},v1=async t=>{console.log("getGigAgentsForGig called with:",t);try{const e=await fetch(`${Bn}/gig-agents/gig/${t}`);if(!e.ok)throw new Error("Failed to fetch gig agents");const s=await e.json();return console.log("Parsed getGigAgentsForGig response:",s),s||[]}catch(e){throw console.error("Error in getGigAgentsForGig:",e),e}},Vh=async t=>{try{const e=await fetch(`${Bn}/gig-agents/invited/company/${t}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();return console.log(" Invited agents for company:",s),s}catch(e){throw console.error("Error fetching invited agents for company:",e),e}},Wh=async t=>{try{const e=await fetch(`${Bn}/gig-agents/active-agents/company/${t}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();return console.log(" Active agents for company:",s),s}catch(e){throw console.error("Error fetching active agents for company:",e),e}},v3=async(t,e)=>{try{const s=await fetch(`${Bn}/gig-agents/enrollment-requests/${t}/accept`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notes:e})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const n=await s.json();return console.log(" Enrollment request accepted:",n),n}catch(s){throw console.error("Error accepting enrollment request:",s),s}},N3=async(t,e)=>{try{const s=await fetch(`${Bn}/gig-agents/enrollment-requests/${t}/reject`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notes:e})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const n=await s.json();return console.log(" Enrollment request rejected:",n),n}catch(s){throw console.error("Error rejecting enrollment request:",s),s}},Gh=async t=>{try{const e=await fetch(`${Bn}/gig-agents/enrollment-requests/company/${t}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const s=await e.json();return console.log(" Enrollment requests for company:",s),s}catch(e){throw console.error("Error fetching enrollment requests for company:",e),e}},k3=async()=>{console.log("getAllSkills called");const t={professional:[{_id:"1",name:"Sales Management",category:"professional"},{_id:"2",name:"Customer Service",category:"professional"},{_id:"3",name:"Project Management",category:"professional"}],technical:[{_id:"4",name:"CRM Software",category:"technical"},{_id:"5",name:"Data Analysis",category:"technical"},{_id:"6",name:"Excel Advanced",category:"technical"}],soft:[{_id:"7",name:"Communication",category:"soft"},{_id:"8",name:"Leadership",category:"soft"},{_id:"9",name:"Problem Solving",category:"soft"}]};return console.log("Using mock skills data:",t),t},C3=async()=>{console.log("getLanguages called");const t=[{_id:"1",name:"English",code:"en"},{_id:"2",name:"French",code:"fr"},{_id:"3",name:"Spanish",code:"es"},{_id:"4",name:"German",code:"de"},{_id:"5",name:"Italian",code:"it"},{_id:"6",name:"Portuguese",code:"pt"},{_id:"7",name:"Dutch",code:"nl"},{_id:"8",name:"Arabic",code:"ar"},{_id:"9",name:"Chinese",code:"zh"},{_id:"10",name:"Japanese",code:"ja"}];return console.log("Using mock languages data:",t),t},S3=async(t,e)=>{console.log(" SAVE GIG WEIGHTS CALLED:",{gigId:t,matchingWeights:e});try{const s=await fetch(`${Bn}/gig-matching-weights/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({matchingWeights:e})});if(!s.ok){const r=await s.json();throw new Error(r.message||"Failed to save gig weights")}const n=await s.json();return console.log(" SAVE GIG WEIGHTS SUCCESS:",n),n.data||n}catch(s){throw console.error(" Error saving gig weights:",s),s}},j3=async t=>{console.log(" GET GIG WEIGHTS CALLED:",t);try{const e=await fetch(`${Bn}/gig-matching-weights/${t}`);if(!e.ok){if(e.status===404)throw new Error("No saved weights found for this gig");const n=await e.json();throw new Error(n.message||"Failed to get gig weights")}const s=await e.json();return console.log(" GET GIG WEIGHTS SUCCESS:",s),s.data||s}catch(e){throw console.error(" Error getting gig weights:",e),e}},I3=async t=>{console.log(" RESET GIG WEIGHTS CALLED:",t);try{const e=await fetch(`${Bn}/gig-matching-weights/${t}`,{method:"DELETE"});if(!e.ok){const s=await e.json();throw new Error(s.message||"Failed to reset gig weights")}console.log(" RESET GIG WEIGHTS SUCCESS")}catch(e){throw console.error(" Error resetting gig weights:",e),e}},N1=()=>{const[t,e]=k.useState([]),[s,n]=k.useState([]),[r,i]=k.useState(null),[o,l]=k.useState([]),[c,d]=k.useState(null),[u,h]=k.useState(!1),[p,f]=k.useState(!0),[m,b]=k.useState(!0),[g,x]=k.useState({experience:0,skills:0,industry:0,languages:0,availability:0,timezone:0,activities:0,region:0}),[y,w]=k.useState(null),[v,N]=k.useState(new Set),[C,j]=k.useState([]),[I,T]=k.useState(!1),[E,$]=k.useState(null),[D,P]=k.useState(null),[_,O]=k.useState({professional:[],technical:[],soft:[]}),[R,X]=k.useState([]),[L,K]=k.useState(!1),[B,G]=k.useState(!1),[de,ae]=k.useState(null),[ve,Ne]=k.useState("matching"),[le,H]=k.useState(new Set),[ue,F]=k.useState(new Set),[ee,re]=k.useState([]),[te,ce]=k.useState([]),[Se,Pe]=k.useState([]),[$e,rt]=k.useState(""),[q,fe]=k.useState(25),[Fe,et]=k.useState(!1),Me=S=>{et(!0),S.preventDefault()},Xe=S=>{if(!Fe)return;const z=document.querySelector(".resizable-container");if(!z)return;const Y=z.getBoundingClientRect(),Ce=(S.clientX-Y.left)/Y.width*100,je=Math.max(20,Math.min(50,Ce));fe(je)},it=()=>{et(!1)};k.useEffect(()=>(Fe&&(document.addEventListener("mousemove",Xe),document.addEventListener("mouseup",it)),()=>{document.removeEventListener("mousemove",Xe),document.removeEventListener("mouseup",it)}),[Fe]);const Et=o.filter(S=>S.agentInfo?.name?.toLowerCase().includes($e.toLowerCase())||S.agentInfo?.email?.toLowerCase().includes($e.toLowerCase())||S.agentInfo?.personalInfo?.name?.toLowerCase().includes($e.toLowerCase())||S.agentInfo?.personalInfo?.email?.toLowerCase().includes($e.toLowerCase()));k.useEffect(()=>{(async()=>{f(!0),w(null);try{console.log("Fetching data from backend...");const z=De.get("companyId")||"685abf28641398dc582f4c95",[Y,Ce,je,se]=await Promise.all([z?y3(z):b3(),Vh(z),Gh(z),Wh(z)]);n(Y),j(Ce),ce(je),Pe(se);const[_e,Ke,He]=await Promise.all([x3(),k3(),C3()]);e(_e),O(Ke),X(He),console.log("=== BACKEND DATA ==="),console.log("Gigs:",Y),console.log("Company Invited Agents:",Ce),console.log("Enrollment Requests:",je)}catch(z){console.error("Error fetching data:",z),w("Failed to fetch data. Please try again.")}finally{f(!1)}})()},[]),k.useEffect(()=>{const S=localStorage.getItem("selectedGigId");if(S&&s.length>0&&!r){console.log("Restoring selected gig from localStorage:",S);const z=s.find(Y=>Y._id===S);z&&yt(z)}},[s]),k.useEffect(()=>{!C||!te||!Se||(console.log(" Company Invited Agents Structure:",C),console.log(" Enrollment Requests Structure:",te),console.log(" Active Agents Structure:",Se),re(C.filter(S=>!S.isActive&&!S.hasCompletedOnboarding)),ce(te),console.log(" Setting active agents:",Se))},[C,te,Se]);const yt=async S=>{console.log(" GIG SELECTED:",S.title,"ID:",S._id),i(S),S._id&&localStorage.setItem("selectedGigId",S._id),h(!0),w(null),l([]),d(null),rt(""),K(!1),G(!1),ae(null);let z=g;try{try{const se=await j3(S._id||"");x(se.matchingWeights),ae(se.matchingWeights),K(!0),G(!1),z=se.matchingWeights,console.log(" Gig has saved weights, loaded:",se.matchingWeights)}catch(se){se.message?.includes("No saved weights found")?console.log(" No saved weights found for gig:",S._id,"- Using default weights"):se.message?.includes("Failed to fetch")?console.warn(" Network error loading weights for gig:",S._id,"- Using current weights"):console.error(" Unexpected error loading weights for gig:",S._id,se),K(!1)}const Y=await v1(S._id||""),Ce=new Set(Y.map(se=>se.agentId));N(Ce),console.log(" Invited reps for gig:",Ce),console.log("Searching for reps matching gig:",S.title),console.log(" WEIGHTS BEING SENT TO API:",z);let je;try{je=await ex(S._id||"",z),console.log("=== MATCHES DATA ===",je)}catch(se){console.error(" Error finding matches for gig:",se),se.message?.includes("Failed to fetch")?console.error(" Network error: Unable to connect to matching service"):se.message?.includes("500")?console.error(" Server error: Matching service encountered an internal error"):console.error(" Unexpected error:",se.message),je={preferedmatches:[],totalMatches:0,perfectMatches:0,partialMatches:0,noMatches:0}}if(je.preferedmatches&&je.preferedmatches.length>0){const se=je.preferedmatches[0];console.log(" SCORE BREAKDOWN FOR FIRST MATCH:"),console.log("- Agent:",se.agentInfo?.name),console.log("- Total Score from API:",se.totalMatchingScore),console.log("- Skills Score:",se.skillsMatch?.score," Weight:",z.skills,"=",(se.skillsMatch?.score||0)*z.skills),console.log("- Languages Score:",se.languageMatch?.score," Weight:",z.languages,"=",(se.languageMatch?.score||0)*z.languages),console.log("- Industry Score:",se.industryMatch?.score," Weight:",z.industry,"=",(se.industryMatch?.score||0)*z.industry),console.log("- Activity Score:",se.activityMatch?.score," Weight:",z.activities,"=",(se.activityMatch?.score||0)*z.activities),console.log("- Experience Score:",se.experienceMatch?.score," Weight:",z.experience,"=",(se.experienceMatch?.score||0)*z.experience),console.log("- Timezone Score:",se.timezoneMatch?.score," Weight:",z.timezone,"=",(se.timezoneMatch?.score||0)*z.timezone),console.log("- Region Score:",se.regionMatch?.score," Weight:",z.region,"=",(se.regionMatch?.score||0)*z.region),console.log("- Availability Score:",se.availabilityMatch?.score," Weight:",z.availability,"=",(se.availabilityMatch?.score||0)*z.availability);const _e=(se.skillsMatch?.score||0)*z.skills+(se.languageMatch?.score||0)*z.languages+(se.industryMatch?.score||0)*z.industry+(se.activityMatch?.score||0)*z.activities+(se.experienceMatch?.score||0)*z.experience+(se.timezoneMatch?.score||0)*z.timezone+(se.regionMatch?.score||0)*z.region+(se.availabilityMatch?.score||0)*z.availability;console.log(" CALCULATED TOTAL:",_e),console.log(" API TOTAL:",se.totalMatchingScore),console.log(" DIFFERENCE:",Math.abs(_e-se.totalMatchingScore))}l(je.preferedmatches||je.matches||[]),d(je),setTimeout(()=>Ct(),100)}catch(Y){console.error("Error getting matches:",Y),w("Failed to get matches. Please try again."),l([]),d(null)}finally{h(!1)}},xe=(S,z)=>{const Y={...g,[S]:z};if(x(Y),de&&L){const Ce=Object.keys(Y).some(je=>Math.abs(Y[je]-de[je])>.001);G(Ce)}r&&Ve()},Ve=async()=>{if(r){h(!0),w(null);try{console.log("Searching with current weights (no DB reload):",g);const S=await ex(r._id||"",g);console.log("=== MATCHES DATA WITH CURRENT WEIGHTS ===",S),l(S.preferedmatches||S.matches||[]),d(S);const z=await v1(r._id||""),Y=new Set(z.map(Ce=>Ce.agentId));N(Y)}catch(S){console.error("Error searching with current weights:",S),w("Failed to get matches. Please try again."),l([]),d(null)}finally{h(!1)}}},qe=()=>{const S={experience:0,skills:0,industry:0,languages:0,availability:0,timezone:0,activities:0,region:0};if(x(S),de&&L){const z=Object.keys(S).some(Y=>Math.abs(S[Y]-de[Y])>.001);G(z)}r&&Ve()},We=async()=>{if(console.log(" SAVE WEIGHTS FOR GIG CALLED"),!r){console.error("No gig selected"),w("No gig selected");return}console.log(" MANUAL SAVE TRIGGERED - User clicked save button"),h(!0),w(null);try{await S3(r._id||"",g),console.log(" Weights saved successfully for gig:",r._id),K(!0),ae(g),G(!1),await Ve()}catch(S){console.error(" Error saving weights or searching:",S),w("Failed to save weights or search. Please try again.")}finally{h(!1)}},at=async S=>{if(!r){P("No gig selected");return}T(!0),P(null),$(null),console.log("Creating gig-rep with data:",{agentId:S.agentId,gigId:r._id,match:S});const z={agentId:S.agentId,gigId:r._id||""};console.log(" Sending minimal request data:",z);try{const Y=await w3(z);console.log("Gig-Rep created successfully:",Y),N(Ke=>new Set([...Ke,S.agentId])),l(Ke=>Ke.map(He=>He.agentId===S.agentId?{...He,isInvited:!0}:He)),$(`Successfully invited ${S.agentInfo?.name} to ${r.title}`),setTimeout(()=>{$(null)},3e3);const Ce=De.get("companyId")||"685abf28641398dc582f4c95",[je,se,_e]=await Promise.all([Vh(Ce),Gh(Ce),Wh(Ce)]);if(j(je),ce(se),Pe(_e),r){const Ke=await ex(r._id||"",g);l(Ke.preferedmatches||Ke.matches||[]),d(Ke)}}catch(Y){console.error("Error creating gig-rep:",Y),P("Failed to invite rep to gig. Please try again.")}finally{T(!1)}},Ct=()=>{console.log(" DEBUG: All matches data:",o),console.log(" DEBUG: invitedAgents Set:",v),console.log(" DEBUG: Company Invited Reps:",C);const S=C.filter(Ce=>{const je=!Ce.isActive&&!Ce.hasCompletedOnboarding;return console.log(` Company Invited Rep ${Ce.personalInfo?.name}:`,{status:Ce.status,isActive:Ce.isActive,hasCompletedOnboarding:Ce.hasCompletedOnboarding,isInvited:je,fullData:Ce}),je}),z=te;console.log(" Enrollment Requests from API:",z);const Y=Se;console.log(" Active Reps from API:",Y),console.log(" Organizing reps by status:"),console.log(" Invited:",S.length,S.map(Ce=>({name:Ce.personalInfo?.name,id:Ce._id}))),console.log(" Enrollment Requests:",z.length,z.map(Ce=>({name:Ce.personalInfo?.name,id:Ce._id}))),console.log(" Active:",Y.length,Y.map(Ce=>({name:Ce.personalInfo?.name,id:Ce._id}))),re(S),ce(z),Pe(Y)},ut=(S,z)=>{if(!S)return"Unknown Skill";if(typeof S=="object"&&S.name)return S.name;const Y=typeof S=="string"?S:S.toString();if(Y.match(/^[0-9a-fA-F]{24}$/)){const je=_[z].find(se=>se._id===Y);return je?je.name:`${z.charAt(0).toUpperCase()+z.slice(1)} Skill`}return Y},mt=S=>{if(!S)return"Unknown Language";if(typeof S=="object"&&S.name)return S.name;const z=typeof S=="string"?S:S.toString();if(z.match(/^[0-9a-fA-F]{24}$/)){let Ce=R.find(je=>je._id===z);return Ce?Ce.name:"Language"}let Y=R.find(Ce=>Ce.code===z);return Y||(Y=R.find(Ce=>Ce._id===z)),Y||(Y=R.find(Ce=>Ce.name?.toLowerCase()===z.toLowerCase())),Y?Y.name:z},Xt=S=>{H(z=>{const Y=new Set(z);return Y.has(S)?Y.delete(S):Y.add(S),Y})},mn=S=>{F(z=>{const Y=new Set(z);return Y.has(S)?Y.delete(S):Y.add(S),Y})};return a.jsxs("div",{className:"min-h-screen bg-antigravity-bg w-full max-w-full overflow-x-hidden text-antigravity-text",children:[a.jsxs("header",{className:"bg-antigravity-primary border-b border-antigravity-primary shadow-lg",children:[a.jsx("div",{className:"container mx-auto px-4 py-4",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"p-2 bg-white/10 rounded-lg",children:a.jsx(tr,{size:24,className:"text-white"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-white",children:"Reps Management System"}),a.jsx("p",{className:"text-blue-100 text-sm",children:"Manage reps through their complete lifecycle"})]})]}),a.jsxs("div",{className:"hidden lg:flex items-center space-x-6 px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-sm",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"font-bold text-lg text-white",children:t.length}),a.jsx("div",{className:"text-blue-100 text-xs",children:"Total Reps"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"font-bold text-lg text-white",children:ee.length}),a.jsx("div",{className:"text-blue-100 text-xs",children:"Invited"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"font-bold text-lg text-white",children:te.length}),a.jsx("div",{className:"text-blue-100 text-xs",children:"Requests"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"font-bold text-lg text-white",children:Se.length}),a.jsx("div",{className:"text-blue-100 text-xs",children:"Active"})]})]})]})}),a.jsx("div",{className:"border-t border-white/20",children:a.jsx("div",{className:"container mx-auto px-4",children:a.jsx("nav",{className:"flex space-x-0",children:[{id:"matching",label:"Smart Matching System",icon:"",description:"Find & match perfect reps"},{id:"invited",label:"Invited Reps",icon:"",description:"Pending invitations"},{id:"enrollment",label:"Enrollment Requests",icon:"",description:"Rep applications"},{id:"active",label:"Active Reps",icon:"",description:"Working reps"}].map(S=>a.jsx("button",{onClick:()=>Ne(S.id),className:`flex-1 px-4 py-4 text-left transition-all duration-200 border-b-4 ${ve===S.id?"border-white bg-white/10":"border-transparent hover:bg-white/5 text-blue-100 hover:text-white"}`,children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("span",{className:"text-xl",children:S.icon}),a.jsxs("div",{children:[a.jsx("div",{className:`font-medium ${ve===S.id?"text-white":"text-blue-100 group-hover:text-white"}`,children:S.label}),a.jsx("div",{className:`text-xs opacity-80 ${ve===S.id?"text-white":"text-blue-200"}`,children:S.description})]})]})},S.id))})})})]}),a.jsxs("main",{className:"container mx-auto p-6 w-full max-w-full overflow-hidden",children:[y&&a.jsx("div",{className:"mb-6 bg-red-900/20 border-l-4 border-antigravity-accent text-antigravity-accent px-4 py-3 rounded-lg shadow-md backdrop-blur-sm",children:a.jsxs("p",{className:"flex items-center",children:[a.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),y]})}),p&&a.jsx("div",{className:"flex justify-center items-center py-20",children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-antigravity-primary"}),a.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:a.jsx(Yg,{size:24,className:"text-antigravity-primary animate-pulse"})})]})}),!p&&a.jsxs(a.Fragment,{children:[ve==="matching"&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-bold text-antigravity-text",children:" Smart Matching System"}),a.jsx("p",{className:"text-antigravity-muted",children:"Find and match the perfect reps for your gigs"})]}),a.jsxs("button",{onClick:()=>b(!m),className:`px-4 py-2 rounded-lg transition-all duration-200 flex items-center space-x-2 text-sm font-medium ${m?"bg-antigravity-primary text-white hover:bg-indigo-700":"bg-white border border-antigravity-border text-antigravity-text hover:bg-gray-50"}`,children:[a.jsx(Qn,{size:16,className:m?"rotate-180":""}),a.jsx("span",{children:m?"Close Weights":"Adjust Weights"})]})]}),m&&a.jsxs("div",{className:"bg-antigravity-surface rounded-xl shadow-lg p-6 mb-6 transform transition-all duration-300 ease-in-out border border-antigravity-border overflow-hidden",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"p-2 bg-antigravity-primary/10 rounded-lg shadow-sm border border-antigravity-primary/20",children:a.jsx(Qn,{size:20,className:"text-antigravity-primary"})}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("h2",{className:"text-lg font-bold text-antigravity-text",children:"Matching Weights Configuration"}),B&&a.jsxs("span",{className:"inline-flex items-center px-3 py-1 bg-yellow-500/20 text-yellow-400 rounded-full text-sm font-medium animate-pulse border border-yellow-500/30",children:[a.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.082 16.5c-.77.833.192 2.5 1.732 2.5z"})}),"Unsaved changes"]})]}),a.jsx("p",{className:"text-antigravity-muted text-sm mt-1",children:"Customize how each factor influences the matching algorithm"})]})]}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("button",{onClick:qe,disabled:u,className:"px-6 py-3 bg-gray-600 text-white hover:bg-gray-700 rounded-xl shadow-lg transition-all duration-200 flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed transform hover:-translate-y-0.5",children:[a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),a.jsx("span",{className:"font-semibold",children:"Reset to Default"})]}),r&&L&&a.jsxs("button",{onClick:async()=>{if(r)try{h(!0),await I3(r._id||""),K(!1),qe(),console.log(" Gig weights reset successfully")}catch(S){console.error(" Error resetting gig weights:",S),w("Failed to reset gig weights")}finally{h(!1)}},disabled:u,className:"px-6 py-3 bg-red-500/10 border border-red-500/30 text-red-400 hover:bg-red-500/20 rounded-xl shadow-lg transition-all duration-200 flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed transform hover:-translate-y-0.5",children:[a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),a.jsx("span",{className:"font-semibold",children:"Delete Saved Weights"})]})]})]}),a.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-4 w-full overflow-hidden",children:Object.entries(g).map(([S,z])=>a.jsxs("div",{className:"bg-antigravity-bg rounded-xl p-3 shadow-md border border-antigravity-border hover:border-antigravity-primary/50 transition-all duration-200 group w-full max-w-full",children:[a.jsxs("div",{className:"flex justify-between items-center mb-3",children:[a.jsx("label",{className:"text-xs font-bold text-antigravity-muted uppercase tracking-wider",children:S}),a.jsxs("div",{className:`px-2 py-1 rounded text-xs font-bold ${Math.round(z*100)>=20?"bg-antigravity-primary/20 text-antigravity-primary shadow-sm shadow-antigravity-primary/10":Math.round(z*100)>=10?"bg-antigravity-secondary/20 text-antigravity-secondary":"bg-antigravity-border text-antigravity-muted"}`,children:[Math.round(z*100),"%"]})]}),a.jsxs("div",{className:"relative mb-2 px-1",children:[a.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:z,onChange:Y=>xe(S,parseFloat(Y.target.value)),className:"w-full h-1.5 bg-antigravity-surface rounded-full appearance-none cursor-pointer slider",style:{background:`linear-gradient(to right, #8b5cf6 0%, #3b82f6 ${z*100}%, #2D3748 ${z*100}%, #2D3748 100%)`}}),a.jsx("div",{className:"absolute top-1/2 transform -translate-y-1/2 w-4 h-4 bg-antigravity-text rounded-full shadow-lg border-2 border-antigravity-primary pointer-events-none transition-all duration-200 group-hover:scale-110 group-hover:bg-white",style:{left:`calc(${z*100}% - 4px)`}})]})]},`weight-${S}`))}),r&&a.jsx("div",{className:"flex justify-center",children:a.jsxs("button",{onClick:()=>{console.log(" BUTTON CLICKED - User manually clicked save button"),We()},disabled:u,className:`group relative px-6 py-2 rounded-lg transition-all duration-200 flex items-center space-x-2 shadow-lg transform hover:-translate-y-0.5 hover:shadow-xl font-semibold text-sm disabled:opacity-50 disabled:cursor-not-allowed ${B?"bg-gradient-to-r from-antigravity-accent to-red-600 hover:from-red-500 hover:to-red-700 text-white animate-pulse":L?"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white":"bg-gradient-to-r from-antigravity-primary to-antigravity-secondary hover:from-antigravity-secondary hover:to-antigravity-primary text-white"}`,children:[a.jsx("div",{className:"absolute inset-0 rounded-lg bg-gradient-to-r from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-200"}),u?a.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"}):a.jsx("svg",{className:"w-4 h-4 group-hover:scale-110 transition-transform duration-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),a.jsx("span",{className:"relative z-10",children:u?"Saving...":B?"Save Changes":L?"Update Weights":"Save Weights"}),a.jsx("div",{className:`absolute inset-0 rounded-lg blur-lg opacity-20 group-hover:opacity-40 transition-opacity duration-200 ${B?"bg-antigravity-accent":L?"bg-green-500":"bg-antigravity-primary"}`})]})})]}),r&&a.jsx("div",{className:"mb-6",children:a.jsxs("div",{className:"relative max-w-md mx-auto",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx("svg",{className:"h-5 w-5 text-antigravity-muted",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),a.jsx("input",{type:"text",placeholder:"Search reps...",value:$e,onChange:S=>rt(S.target.value),className:"block w-full pl-10 pr-3 py-3 border border-antigravity-border rounded-lg leading-5 bg-antigravity-surface placeholder-antigravity-muted focus:outline-none focus:placeholder-antigravity-text/50 focus:ring-2 focus:ring-antigravity-primary focus:border-antigravity-primary text-sm text-antigravity-text transition-all duration-200"}),$e&&a.jsx("button",{onClick:()=>rt(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:a.jsx("svg",{className:"h-5 w-5 text-antigravity-muted hover:text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})}),a.jsxs("div",{className:"resizable-container flex gap-4 w-full max-w-full overflow-hidden",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-6 overflow-hidden transition-all duration-200 flex-shrink-0 border border-indigo-100/50 backdrop-blur-sm",style:{width:`${q}%`,minWidth:"280px",maxWidth:"50%"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-800 flex items-center space-x-2",children:[a.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg",children:a.jsx(Ir,{size:20,className:"text-indigo-600"})}),a.jsx("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-violet-600",children:"Available Gigs"})]}),a.jsx("span",{className:"bg-indigo-50 text-indigo-600 py-1 px-3 rounded-full text-xs font-bold border border-indigo-100",children:s.length})]}),a.jsx("div",{className:"space-y-3 max-h-[600px] overflow-y-auto pr-2 custom-scrollbar",children:s.map(S=>{const z=ue.has(S._id||"");return a.jsxs("div",{className:`group relative rounded-xl border transition-all duration-300 ${r?._id===S._id?"border-indigo-500 shadow-xl bg-gradient-to-br from-indigo-600 to-violet-600 text-white transform scale-[1.02] ring-2 ring-indigo-200 ring-offset-2":"bg-white border-gray-100 hover:border-indigo-200 hover:shadow-lg hover:bg-indigo-50/30"}`,children:[a.jsxs("div",{className:"cursor-pointer p-4",onClick:()=>yt(S),children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[a.jsx("div",{className:`p-2.5 rounded-xl transition-colors duration-200 ${r?._id===S._id?"bg-white/20 backdrop-blur-sm":"bg-indigo-50 group-hover:bg-white shadow-sm"}`,children:a.jsx(Ir,{size:18,className:`${r?._id===S._id?"text-white":"text-indigo-600"}`})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:`font-bold text-sm mb-0.5 ${r?._id===S._id?"text-white":"text-gray-800"}`,children:S.title}),a.jsx("p",{className:`text-xs truncate font-medium ${r?._id===S._id?"text-indigo-100":"text-gray-500"}`,children:S.companyName})]})]}),r?._id===S._id&&a.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full flex items-center justify-center",children:a.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})})})]}),a.jsx("div",{className:"px-4 pb-4",children:a.jsxs("button",{onClick:Y=>{Y.stopPropagation(),mn(S._id||"")},className:`w-full flex items-center justify-center space-x-2 px-3 py-2 rounded-lg transition-all duration-200 text-sm font-medium ${r?._id===S._id?"bg-white/20 text-white hover:bg-white/30 backdrop-blur-sm":"bg-indigo-50/50 hover:bg-indigo-100 text-indigo-700"}`,children:[a.jsx("span",{children:"View Details"}),a.jsx("svg",{className:`w-4 h-4 transform transition-transform duration-200 ${z?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]})}),z&&a.jsx("div",{className:"px-4 pb-4 border-t border-antigravity-border bg-white overflow-hidden",children:a.jsxs("div",{className:"pt-4 space-y-4 text-sm overflow-hidden text-antigravity-text",children:[S.industries&&S.industries.length>0&&a.jsxs("div",{children:[a.jsx("p",{className:"text-antigravity-muted font-medium mb-2",children:"Industries:"}),a.jsx("div",{className:"flex flex-wrap gap-1",children:S.industries.map((Y,Ce)=>{const je=Y.name||(typeof Y=="string"&&!Y.match(/^[0-9a-fA-F]{24}$/)?Y:"Industry");return a.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-700 border border-orange-200 rounded text-xs font-medium",children:je},Ce)})})]}),S.activities&&S.activities.length>0&&a.jsxs("div",{children:[a.jsx("p",{className:"text-antigravity-muted font-medium mb-2",children:"Activities:"}),a.jsx("div",{className:"flex flex-wrap gap-1",children:S.activities.map((Y,Ce)=>{const je=Y.name||(typeof Y=="string"&&!Y.match(/^[0-9a-fA-F]{24}$/)?Y:"Activity");return a.jsx("span",{className:"px-2 py-1 bg-teal-100 text-teal-700 border border-teal-200 rounded text-xs font-medium",children:je},Ce)})})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-antigravity-muted font-medium",children:"Experience:"}),a.jsxs("span",{className:"font-semibold text-antigravity-text",children:[S.seniority?.yearsExperience||"N/A"," years"]})]}),S.skills?.languages&&S.skills.languages.length>0&&a.jsxs("div",{children:[a.jsx("p",{className:"text-antigravity-muted font-medium mb-2",children:"Languages:"}),a.jsx("div",{className:"flex flex-wrap gap-1",children:S.skills.languages.map((Y,Ce)=>a.jsxs("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 border border-purple-200 rounded text-xs font-medium",children:[mt(Y.language||Y.iso639_1||Y),Y.proficiency&&a.jsxs("span",{className:"ml-1 text-purple-800",children:["(",Y.proficiency,")"]})]},Ce))})]}),S.availability&&a.jsxs("div",{children:[a.jsx("span",{className:"text-antigravity-muted font-medium",children:"Availability:"}),a.jsx("p",{className:"font-semibold text-antigravity-text",children:S.availability.schedule?`${S.availability.schedule.length} days/week`:S.availability.hoursPerWeek?`${S.availability.hoursPerWeek}h/week`:S.availability.workingHours&&typeof S.availability.workingHours=="string"?S.availability.workingHours:"Flexible"})]}),S.skills?.professional&&S.skills.professional.length>0&&a.jsxs("div",{children:[a.jsx("p",{className:"text-antigravity-muted font-medium mb-2",children:"Professional Skills:"}),a.jsx("div",{className:"flex flex-wrap gap-1",children:S.skills.professional.map((Y,Ce)=>a.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 border border-blue-200 rounded text-xs font-medium",children:ut(Y.skill||Y,"professional")},`prof-${Ce}`))})]}),S.skills?.technical&&S.skills.technical.length>0&&a.jsxs("div",{children:[a.jsx("p",{className:"text-antigravity-muted font-medium mb-2",children:"Technical Skills:"}),a.jsx("div",{className:"flex flex-wrap gap-1",children:S.skills.technical.map((Y,Ce)=>a.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-700 border border-green-200 rounded text-xs font-medium",children:ut(Y.skill||Y,"technical")},`tech-${Ce}`))})]}),S.skills?.soft&&S.skills.soft.length>0&&a.jsxs("div",{children:[a.jsx("p",{className:"text-antigravity-muted font-medium mb-2",children:"Soft Skills:"}),a.jsx("div",{className:"flex flex-wrap gap-1",children:S.skills.soft.map((Y,Ce)=>a.jsx("span",{className:"px-2 py-1 bg-pink-100 text-pink-700 border border-pink-200 rounded text-xs font-medium",children:ut(Y.skill||Y,"soft")},`soft-${Ce}`))})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[S.region&&a.jsxs("div",{children:[a.jsx("span",{className:"text-antigravity-muted font-medium",children:"Region:"}),a.jsx("p",{className:"font-semibold text-antigravity-text",children:typeof S.region=="string"?S.region:S.region.name||"Unknown Region"})]}),S.timezone&&a.jsxs("div",{children:[a.jsx("span",{className:"text-antigravity-muted font-medium",children:"Timezone:"}),a.jsx("p",{className:"font-semibold text-antigravity-text",children:typeof S.timezone=="string"?S.timezone:S.timezone.name||S.timezone.timezoneName||"Unknown Timezone"})]})]})]})})]},S._id)})})]}),a.jsx("div",{className:`flex-shrink-0 w-1 bg-antigravity-border hover:bg-antigravity-primary cursor-col-resize transition-colors duration-200 rounded-full flex items-center justify-center group ${Fe?"bg-antigravity-primary":""}`,onMouseDown:Me,title:"Drag to resize",children:a.jsx("div",{className:"w-0.5 h-8 bg-antigravity-muted group-hover:bg-white rounded-full transition-colors duration-200"})}),a.jsxs("div",{className:"bg-antigravity-surface rounded-xl shadow-lg p-6 overflow-hidden transition-all duration-200 flex-1 min-w-0 border border-antigravity-border",children:[a.jsxs("h3",{className:"text-xl font-semibold text-antigravity-text mb-4 flex items-center space-x-2",children:[a.jsx(tr,{size:20,className:"text-antigravity-primary"}),a.jsx("span",{children:r?`Matches for "${r.title}"`:"Select a Gig to See Matches"})]}),r?u?a.jsx("div",{className:"flex justify-center items-center py-12",children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-antigravity-primary"}),a.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:a.jsx(Yg,{size:16,className:"text-antigravity-primary animate-pulse"})})]})}):Et.length>0?a.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:Et.map((S,z)=>{const Y=Se.some(He=>{const gt=He.agentId?._id||He.agentId,Yt=He.gigId?._id||He.gigId;return gt===S.agentId&&Yt===r?._id}),Ce=S.isInvited!==void 0?S.isInvited:v.has(S.agentId),je=Y||S.isEnrolled||S.status==="accepted"||S.agentResponse==="accepted"||S.enrollmentStatus==="accepted"||S.agentInfo?.status==="accepted",se=Math.round((S.totalMatchingScore||0)*100),_e=se>=70?"bg-white border-green-500/30 hover:border-green-500/60 shadow-lg":se>=50?"bg-white border-yellow-500/30 hover:border-yellow-500/60 shadow-lg":"bg-white border-red-500/30 hover:border-red-500/60 shadow-lg",Ke=le.has(S.agentId);return a.jsxs("div",{className:`rounded-xl p-6 border transition-all duration-300 ${_e}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx("h4",{className:"text-lg font-bold text-antigravity-text truncate cursor-pointer hover:text-antigravity-primary transition-colors",onClick:()=>Xt(S.agentId),children:S.agentInfo?.name}),a.jsxs("div",{className:`px-4 py-2 rounded-full text-sm font-bold shadow-sm ${se>=70?"bg-green-500 text-white":se>=50?"bg-yellow-500 text-white":"bg-red-500 text-white"}`,children:[se,"% Match"]})]}),a.jsx("p",{className:"text-sm text-antigravity-muted truncate",children:S.agentInfo?.email}),a.jsxs("div",{className:"flex items-center gap-4 text-xs text-antigravity-muted mt-1",children:[(S.agentInfo?.timezone?.countryName||S.agentInfo?.location)&&a.jsxs("span",{children:[" ",S.agentInfo?.timezone?.countryName||S.agentInfo?.location]}),S.agentInfo?.timezone?.gmtDisplay&&S.agentInfo.timezone.gmtDisplay!=="Unknown"&&a.jsxs("span",{children:[" ",S.agentInfo.timezone.gmtDisplay]}),S.agentInfo?.professionalSummary?.yearsOfExperience&&a.jsxs("span",{children:[" ",S.agentInfo.professionalSummary.yearsOfExperience.toString().replace(/\s+years?/gi,"")," years exp."]}),S.agentInfo?.personalInfo?.languages&&S.agentInfo.personalInfo.languages.length>0&&a.jsxs("span",{children:[" ",S.agentInfo.personalInfo.languages.length," languages"]})]})]}),a.jsx("div",{className:"flex-shrink-0 ml-4",children:je?a.jsx("span",{className:"inline-flex items-center px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:"Enrolled"}):S.alreadyEnrolled?a.jsx("span",{className:"inline-flex items-center px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-sm font-medium",children:"Already Enrolled"}):Ce?a.jsx("span",{className:"inline-flex items-center px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium",children:"Invited"}):a.jsxs("button",{className:"inline-flex items-center px-3 py-1 bg-antigravity-primary text-white rounded-lg hover:bg-indigo-700 transition-all duration-200 text-sm font-medium gap-1 shadow-sm",onClick:()=>at(S),disabled:I,children:[a.jsx(Yg,{className:"w-4 h-4"}),"Invite"]})})]}),a.jsx("div",{className:"flex justify-center mt-4",children:a.jsxs("button",{onClick:()=>Xt(S.agentId),className:"flex items-center space-x-2 px-4 py-2 bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-700 hover:to-indigo-800 text-white rounded-lg transition-all duration-200 text-sm font-medium shadow-md hover:shadow-lg transform hover:-translate-y-0.5",children:[a.jsx("span",{children:Ke?"Hide Details":"View Details"}),a.jsx("svg",{className:`w-4 h-4 transform transition-transform duration-200 ${Ke?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]})}),Ke&&a.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 space-y-6 overflow-hidden",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 w-full max-w-full overflow-hidden",children:[S.skillsMatch&&a.jsxs("div",{className:"bg-antigravity-surface rounded-lg p-4 shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h5",{className:"font-semibold text-antigravity-text",children:"Skills Match"}),a.jsxs("span",{className:`px-2 py-1 rounded text-xs font-bold ${Math.round((S.skillsMatch.score||0)*100)>=70?"bg-green-100 text-green-800":Math.round((S.skillsMatch.score||0)*100)>=50?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[Math.round((S.skillsMatch.score||0)*100),"%"]})]}),S.skillsMatch.details?.matchingSkills&&S.skillsMatch.details.matchingSkills.length>0&&a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-xs text-antigravity-muted mb-2",children:"Matched Skills:"}),a.jsxs("div",{className:"flex flex-wrap gap-1",children:[S.skillsMatch.details.matchingSkills.slice(0,3).map((He,gt)=>a.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-medium",children:He.skill?.name||He.skillName||ut(He._id||He.skillId||He,He.category||"professional")},gt)),S.skillsMatch.details.matchingSkills.length>3&&a.jsxs("span",{className:"px-2 py-1 bg-antigravity-bg text-antigravity-muted rounded text-xs",children:["+",S.skillsMatch.details.matchingSkills.length-3]})]})]})]}),S.languageMatch&&a.jsxs("div",{className:"bg-antigravity-surface rounded-lg p-4 shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h5",{className:"font-semibold text-antigravity-text",children:"Languages"}),a.jsxs("span",{className:`px-2 py-1 rounded text-xs font-bold ${Math.round((S.languageMatch.score||0)*100)>=70?"bg-green-100 text-green-800":Math.round((S.languageMatch.score||0)*100)>=50?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[Math.round((S.languageMatch.score||0)*100),"%"]})]}),S.languageMatch.details?.matchingLanguages&&S.languageMatch.details.matchingLanguages.length>0&&a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-xs text-antigravity-muted mb-2",children:"Matched Languages:"}),a.jsxs("div",{className:"flex flex-wrap gap-1",children:[S.languageMatch.details.matchingLanguages.slice(0,3).map((He,gt)=>a.jsxs("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 rounded text-xs font-medium",children:[He.language?.name||He.languageName||mt(He.language||He.code||He),He.agentLevel&&a.jsxs("span",{className:"ml-1 text-purple-800",children:["(",He.agentLevel,")"]})]},gt)),S.languageMatch.details.matchingLanguages.length>3&&a.jsxs("span",{className:"px-2 py-1 bg-antigravity-bg text-antigravity-muted rounded text-xs",children:["+",S.languageMatch.details.matchingLanguages.length-3]})]})]})]}),S.industryMatch&&a.jsxs("div",{className:"bg-antigravity-surface rounded-lg p-4 shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h5",{className:"font-semibold text-antigravity-text",children:"Industry"}),a.jsxs("span",{className:`px-2 py-1 rounded text-xs font-bold ${Math.round((S.industryMatch.score||0)*100)>=70?"bg-green-100 text-green-800":Math.round((S.industryMatch.score||0)*100)>=50?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[Math.round((S.industryMatch.score||0)*100),"%"]})]}),S.industryMatch.details?.matchingIndustries&&S.industryMatch.details.matchingIndustries.length>0&&a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-xs text-antigravity-muted mb-2",children:"Matched Industries:"}),a.jsxs("div",{className:"flex flex-wrap gap-1",children:[S.industryMatch.details.matchingIndustries.slice(0,2).map((He,gt)=>a.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-700 rounded text-xs font-medium",children:He.industry?.name||He.industryName||He.name||He},gt)),S.industryMatch.details.matchingIndustries.length>2&&a.jsxs("span",{className:"px-2 py-1 bg-antigravity-bg text-antigravity-muted rounded text-xs",children:["+",S.industryMatch.details.matchingIndustries.length-2]})]})]})]}),S.experienceMatch&&a.jsxs("div",{className:"bg-antigravity-surface rounded-lg p-4 shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h5",{className:"font-semibold text-antigravity-text",children:"Experience"}),a.jsxs("span",{className:`px-2 py-1 rounded text-xs font-bold ${Math.round((S.experienceMatch.score||0)*100)>=70?"bg-green-100 text-green-800":Math.round((S.experienceMatch.score||0)*100)>=50?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[Math.round((S.experienceMatch.score||0)*100),"%"]})]}),a.jsxs("div",{className:"text-xs text-antigravity-muted",children:[a.jsxs("p",{children:["Rep: ",S.agentInfo?.professionalSummary?.yearsOfExperience||"N/A"," years"]}),a.jsxs("p",{children:["Required: ",r?.seniority?.yearsExperience||"N/A"," years"]})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 w-full max-w-full overflow-hidden",children:[S.timezoneMatch&&a.jsxs("div",{className:"bg-antigravity-surface rounded-lg p-4 shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h5",{className:"font-semibold text-antigravity-text",children:"Timezone"}),a.jsxs("span",{className:`px-2 py-1 rounded text-xs font-bold ${Math.round((S.timezoneMatch.score||0)*100)>=70?"bg-green-100 text-green-800":Math.round((S.timezoneMatch.score||0)*100)>=50?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[Math.round((S.timezoneMatch.score||0)*100),"%"]})]}),a.jsxs("div",{className:"text-xs text-antigravity-muted",children:[a.jsxs("p",{children:["Rep: ",S.agentInfo?.timezone?.gmtDisplay||"N/A"]}),a.jsxs("p",{children:["Zone: ",S.agentInfo?.timezone?.timezoneName||S.agentInfo?.availability?.timeZone?.zoneName||"N/A"]}),a.jsxs("p",{children:["Location: ",S.agentInfo?.timezone?.countryName||S.agentInfo?.personalInfo?.country?.name||S.agentInfo?.location||"N/A"]})]})]}),S.regionMatch&&a.jsxs("div",{className:"bg-antigravity-surface rounded-lg p-4 shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h5",{className:"font-semibold text-antigravity-text",children:"Region"}),a.jsxs("span",{className:`px-2 py-1 rounded text-xs font-bold ${Math.round((S.regionMatch.score||0)*100)>=70?"bg-green-100 text-green-800":Math.round((S.regionMatch.score||0)*100)>=50?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[Math.round((S.regionMatch.score||0)*100),"%"]})]}),a.jsxs("div",{className:"text-xs text-antigravity-muted",children:[a.jsxs("p",{children:["Country: ",S.agentInfo?.timezone?.countryName||S.agentInfo?.personalInfo?.country?.name||"N/A"]}),a.jsxs("p",{children:["Code: ",S.agentInfo?.timezone?.countryCode||S.agentInfo?.personalInfo?.country?.code||"N/A"]})]})]}),S.availabilityMatch&&a.jsxs("div",{className:"bg-antigravity-surface rounded-lg p-4 shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h5",{className:"font-semibold text-antigravity-text",children:"Availability"}),a.jsxs("span",{className:`px-2 py-1 rounded text-xs font-bold ${Math.round((S.availabilityMatch.score||0)*100)>=70?"bg-green-100 text-green-800":Math.round((S.availabilityMatch.score||0)*100)>=50?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[Math.round((S.availabilityMatch.score||0)*100),"%"]})]}),a.jsx("div",{className:"text-xs text-antigravity-muted",children:a.jsxs("p",{children:["Schedule: ",S.agentInfo?.availability?.schedule?.length||0," days/week"]})})]}),S.activityMatch&&a.jsxs("div",{className:"bg-antigravity-surface rounded-lg p-4 shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h5",{className:"font-semibold text-antigravity-text",children:"Activities"}),a.jsxs("span",{className:`px-2 py-1 rounded text-xs font-bold ${Math.round((S.activityMatch.score||0)*100)>=70?"bg-green-100 text-green-800":Math.round((S.activityMatch.score||0)*100)>=50?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[Math.round((S.activityMatch.score||0)*100),"%"]})]}),S.activityMatch.details?.matchingActivities&&S.activityMatch.details.matchingActivities.length>0&&a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-xs text-antigravity-muted mb-2",children:"Matched Activities:"}),a.jsxs("div",{className:"flex flex-wrap gap-1",children:[S.activityMatch.details.matchingActivities.slice(0,2).map((He,gt)=>a.jsx("span",{className:"px-2 py-1 bg-teal-100 text-teal-700 rounded text-xs font-medium",children:He.activity?.name||He.activityName||He.name||He},gt)),S.activityMatch.details.matchingActivities.length>2&&a.jsxs("span",{className:"px-2 py-1 bg-antigravity-bg text-antigravity-muted rounded text-xs",children:["+",S.activityMatch.details.matchingActivities.length-2]})]})]})]})]})]})]},`match-${S.agentId}-${z}`)})}):$e?a.jsx("div",{className:"text-center py-8",children:a.jsxs("div",{className:"bg-antigravity-surface rounded-xl p-6 max-w-md mx-auto",children:[a.jsx("svg",{className:"w-12 h-12 text-antigravity-muted mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),a.jsxs("p",{className:"text-antigravity-text mb-2",children:['No reps found for "',$e,'"']}),a.jsx("p",{className:"text-sm text-antigravity-muted",children:"Try adjusting your search terms"})]})}):a.jsx("div",{className:"text-center py-8",children:a.jsxs("div",{className:"bg-antigravity-surface rounded-xl p-6 max-w-md mx-auto",children:[a.jsx(Ir,{size:24,className:"text-antigravity-muted mx-auto mb-2"}),a.jsx("p",{className:"text-antigravity-text",children:"No matches found for this gig."})]})}):a.jsx("div",{className:"text-center py-12",children:a.jsxs("div",{className:"bg-antigravity-bg rounded-xl p-8 max-w-md mx-auto border border-antigravity-border",children:[a.jsx(Ir,{size:48,className:"text-antigravity-muted mx-auto mb-4"}),a.jsx("p",{className:"text-antigravity-text text-lg mb-2",children:"No gig selected"}),a.jsx("p",{className:"text-sm text-antigravity-muted",children:"Choose a gig from the left to see matching reps"})]})}),E&&a.jsx("div",{className:"mt-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),E]})}),D&&a.jsx("div",{className:"mt-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),D]})})]})]})]}),ve==="invited"&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[a.jsx("h2",{className:"text-2xl font-bold text-antigravity-text",children:" Invited Reps"}),a.jsxs("span",{className:"px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-sm font-medium border border-yellow-200",children:[ee.length," Pending"]})]}),a.jsx("p",{className:"text-antigravity-muted",children:"Reps who have been invited but haven't responded yet"}),a.jsx("div",{className:"bg-antigravity-surface rounded-xl shadow-lg p-6",children:ee.length>0?a.jsx("div",{className:"space-y-4",children:ee.map((S,z)=>(console.log(" Invited Agent Data:",S),a.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-5 hover:shadow-md transition-all duration-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900",children:S.personalInfo?.name}),a.jsx("p",{className:"text-antigravity-muted",children:S.personalInfo?.email}),a.jsxs("div",{className:"mt-2 space-y-1",children:[a.jsx("p",{className:"text-sm text-yellow-600 font-medium bg-yellow-100/50 inline-block px-2 py-0.5 rounded",children:"Invited  Waiting for response"}),(S.gigId?.title||S.gig?.title)&&a.jsxs("p",{className:"text-sm text-antigravity-muted",children:[a.jsx("span",{className:"font-medium",children:"Gig:"})," ",S.gigId?.title||S.gig?.title]})]})]}),a.jsx("div",{className:"flex items-center space-x-2",children:a.jsx("span",{className:"inline-flex items-center px-3 py-2 bg-yellow-900/40 text-yellow-300 rounded-lg text-sm font-medium",children:" Pending"})})]})},`invited-${S._id}-${z}`)))}):a.jsx("div",{className:"text-center py-12",children:a.jsxs("div",{className:"bg-antigravity-bg rounded-xl p-8 max-w-md mx-auto border border-antigravity-border",children:[a.jsx("div",{className:"text-6xl mb-4",children:""}),a.jsx("p",{className:"text-antigravity-text text-lg mb-2",children:"No pending invitations"}),a.jsx("p",{className:"text-sm text-antigravity-muted",children:"All invitations have been responded to."})]})})})]}),ve==="enrollment"&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[a.jsx("h2",{className:"text-2xl font-bold text-antigravity-text",children:" Enrollment Requests"}),a.jsxs("span",{className:"px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium border border-blue-200",children:[te.length," Requests"]})]}),a.jsx("p",{className:"text-antigravity-muted",children:"Reps who accepted invitations and are requesting to join"}),a.jsx("div",{className:"bg-antigravity-surface rounded-xl shadow-lg p-6",children:te.length>0?a.jsx("div",{className:"space-y-4",children:te.map((S,z)=>a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-5 hover:shadow-md transition-all duration-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900",children:S.agentId?.personalInfo?.name}),a.jsx("p",{className:"text-antigravity-muted",children:S.agentId?.personalInfo?.email}),a.jsxs("div",{className:"mt-2 space-y-1",children:[a.jsxs("p",{className:"text-sm text-blue-600 font-medium",children:[a.jsx("span",{className:"font-medium",children:"Status:"})," ",S.enrollmentStatus]}),(S.gigId?.title||S.gig?.title)&&a.jsxs("p",{className:"text-sm text-antigravity-muted",children:[a.jsx("span",{className:"font-medium",children:"Gig:"})," ",S.gigId?.title||S.gig?.title]}),S.notes&&a.jsxs("p",{className:"text-sm text-antigravity-muted italic",children:['"',S.notes,'"']})]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("button",{onClick:async()=>{try{await v3(S._id,"Welcome to the team! We are delighted to have you.");const Y=De.get("companyId")||"",[Ce,je,se]=await Promise.all([Vh(Y),Gh(Y),Wh(Y)]);j(Ce),ce(je),Pe(se)}catch(Y){console.error("Error accepting enrollment request:",Y)}},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all duration-200 text-sm font-medium",children:" Approve"}),a.jsx("button",{onClick:async()=>{try{await N3(S._id,"Sorry, we cannot proceed with your application at this time.");const Y=De.get("companyId")||"",[Ce,je,se]=await Promise.all([Vh(Y),Gh(Y),Wh(Y)]);j(Ce),ce(je),Pe(se)}catch(Y){console.error("Error rejecting enrollment request:",Y)}},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all duration-200 text-sm font-medium",children:" Reject"})]})]})},`enrollment-${S._id}-${z}`))}):a.jsx("div",{className:"text-center py-12",children:a.jsxs("div",{className:"bg-antigravity-bg rounded-xl p-8 max-w-md mx-auto border border-antigravity-border",children:[a.jsx("div",{className:"text-6xl mb-4",children:""}),a.jsx("p",{className:"text-antigravity-text text-lg mb-2",children:"No enrollment requests"}),a.jsx("p",{className:"text-sm text-antigravity-muted",children:"No reps are waiting for approval."})]})})})]}),ve==="active"&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[a.jsx("h2",{className:"text-2xl font-bold text-antigravity-text",children:" Active Reps"}),a.jsxs("span",{className:"px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium border border-green-200",children:[Se.length," Active"]})]}),a.jsx("p",{className:"text-antigravity-muted",children:"Reps who are approved and actively working"}),a.jsx("div",{className:"bg-antigravity-surface rounded-xl shadow-lg p-6",children:Se.length>0?a.jsx("div",{className:"space-y-4",children:Se.map((S,z)=>a.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-5 hover:shadow-md transition-all duration-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx("h3",{className:"text-lg font-bold text-gray-900",children:S.agentId?.personalInfo?.name}),a.jsx("span",{className:"inline-flex items-center px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-medium border border-green-200",children:" Active"})]}),a.jsx("p",{className:"text-antigravity-muted mb-2",children:S.agentId?.personalInfo?.email}),a.jsxs("div",{className:"mt-3 space-y-2",children:[(S.gigId?.title||S.gig?.title)&&a.jsx("div",{className:"mb-2",children:a.jsxs("p",{className:"text-sm text-antigravity-muted",children:[a.jsx("span",{className:"font-medium",children:"Gig:"})," ",S.gigId?.title||S.gig?.title]})}),a.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[a.jsxs("span",{className:"text-antigravity-muted",children:[a.jsx("span",{className:"font-medium",children:"Experience:"})," ",S.agentId?.professionalSummary?.yearsOfExperience," years"]}),a.jsxs("span",{className:"text-antigravity-muted",children:[a.jsx("span",{className:"font-medium",children:"Role:"})," ",S.agentId?.professionalSummary?.currentRole]})]}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[S.agentId?.professionalSummary?.keyExpertise?.slice(0,5).map((Y,Ce)=>a.jsx("span",{className:"px-2 py-1 bg-green-900/30 text-green-300 rounded text-xs",children:Y},Ce)),S.agentId?.professionalSummary?.keyExpertise?.length>5&&a.jsxs("span",{className:"px-2 py-1 bg-antigravity-bg text-antigravity-muted rounded text-xs",children:["+",S.agentId.professionalSummary.keyExpertise.length-5," more"]})]}),a.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-antigravity-muted",children:[a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Availability:"})," ",S.agentId?.availability?.schedule?.length," days/week"]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Status:"})," ",S.agentId?.onboardingProgress?.currentPhase===4?"Fully Onboarded":"In Progress"]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Languages:"})," ",S.agentId?.personalInfo?.languages?.length||0]})]})]})]}),a.jsx("div",{className:"flex flex-col items-end space-y-2",children:a.jsx("button",{className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all duration-200 text-sm font-medium",children:"Manage Profile"})})]})},`active-${S._id}-${z}`))}):a.jsx("div",{className:"text-center py-12",children:a.jsxs("div",{className:"bg-antigravity-bg rounded-xl p-8 max-w-md mx-auto border border-antigravity-border",children:[a.jsx("div",{className:"text-6xl mb-4",children:""}),a.jsx("p",{className:"text-antigravity-text text-lg mb-2",children:"No active reps"}),a.jsx("p",{className:"text-sm text-antigravity-muted",children:"Start by finding matches and inviting reps."})]})})})]})]})]})]})};var tx={};Object.defineProperty(tx,"__esModule",{value:!0}),tx.parse=R3,tx.serialize=P3;const E3=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,$3=/^[\u0021-\u003A\u003C-\u007E]*$/,T3=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,A3=/^[\u0020-\u003A\u003D-\u007E]*$/,D3=Object.prototype.toString,_3=(()=>{const t=function(){};return t.prototype=Object.create(null),t})();function R3(t,e){const s=new _3,n=t.length;if(n<2)return s;const r=e?.decode||F3;let i=0;do{const o=t.indexOf("=",i);if(o===-1)break;const l=t.indexOf(";",i),c=l===-1?n:l;if(o>c){i=t.lastIndexOf(";",o-1)+1;continue}const d=k1(t,i,o),u=C1(t,o,d),h=t.slice(d,u);if(s[h]===void 0){let p=k1(t,o+1,c),f=C1(t,c,p);const m=r(t.slice(p,f));s[h]=m}i=c+1}while(i<n);return s}function k1(t,e,s){do{const n=t.charCodeAt(e);if(n!==32&&n!==9)return e}while(++e<s);return s}function C1(t,e,s){for(;e>s;){const n=t.charCodeAt(--e);if(n!==32&&n!==9)return e+1}return s}function P3(t,e,s){const n=s?.encode||encodeURIComponent;if(!E3.test(t))throw new TypeError(`argument name is invalid: ${t}`);const r=n(e);if(!$3.test(r))throw new TypeError(`argument val is invalid: ${e}`);let i=t+"="+r;if(!s)return i;if(s.maxAge!==void 0){if(!Number.isInteger(s.maxAge))throw new TypeError(`option maxAge is invalid: ${s.maxAge}`);i+="; Max-Age="+s.maxAge}if(s.domain){if(!T3.test(s.domain))throw new TypeError(`option domain is invalid: ${s.domain}`);i+="; Domain="+s.domain}if(s.path){if(!A3.test(s.path))throw new TypeError(`option path is invalid: ${s.path}`);i+="; Path="+s.path}if(s.expires){if(!O3(s.expires)||!Number.isFinite(s.expires.valueOf()))throw new TypeError(`option expires is invalid: ${s.expires}`);i+="; Expires="+s.expires.toUTCString()}if(s.httpOnly&&(i+="; HttpOnly"),s.secure&&(i+="; Secure"),s.partitioned&&(i+="; Partitioned"),s.priority)switch(typeof s.priority=="string"?s.priority.toLowerCase():void 0){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${s.priority}`)}if(s.sameSite)switch(typeof s.sameSite=="string"?s.sameSite.toLowerCase():s.sameSite){case!0:case"strict":i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"none":i+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${s.sameSite}`)}return i}function F3(t){if(t.indexOf("%")===-1)return t;try{return decodeURIComponent(t)}catch{return t}}function O3(t){return D3.call(t)==="[object Date]"}function M3(t={}){let{initialEntries:e=["/"],initialIndex:s,v5Compat:n=!1}=t,r;r=e.map((f,m)=>u(f,typeof f=="string"?null:f.state,m===0?"default":void 0));let i=c(s??r.length-1),o="POP",l=null;function c(f){return Math.min(Math.max(f,0),r.length-1)}function d(){return r[i]}function u(f,m=null,b){let g=z3(r?d().pathname:"/",f,m,b);return Ar(g.pathname.charAt(0)==="/",`relative pathnames are not supported in memory history: ${JSON.stringify(f)}`),g}function h(f){return typeof f=="string"?f:Hh(f)}return{get index(){return i},get action(){return o},get location(){return d()},createHref:h,createURL(f){return new URL(h(f),"http://localhost")},encodeLocation(f){let m=typeof f=="string"?Tl(f):f;return{pathname:m.pathname||"",search:m.search||"",hash:m.hash||""}},push(f,m){o="PUSH";let b=u(f,m);i+=1,r.splice(i,r.length,b),n&&l&&l({action:o,location:b,delta:1})},replace(f,m){o="REPLACE";let b=u(f,m);r[i]=b,n&&l&&l({action:o,location:b,delta:0})},go(f){o="POP";let m=c(i+f),b=r[m];i=m,l&&l({action:o,location:b,delta:f})},listen(f){return l=f,()=>{l=null}}}}function zs(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Ar(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function L3(){return Math.random().toString(36).substring(2,10)}function z3(t,e,s=null,n){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Tl(e):e,state:s,key:e&&e.key||n||L3()}}function Hh({pathname:t="/",search:e="",hash:s=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),s&&s!=="#"&&(t+=s.charAt(0)==="#"?s:"#"+s),t}function Tl(t){let e={};if(t){let s=t.indexOf("#");s>=0&&(e.hash=t.substring(s),t=t.substring(0,s));let n=t.indexOf("?");n>=0&&(e.search=t.substring(n),t=t.substring(0,n)),t&&(e.pathname=t)}return e}function S1(t,e,s="/"){return B3(t,e,s,!1)}function B3(t,e,s,n){let r=typeof e=="string"?Tl(e):e,i=Mi(r.pathname||"/",s);if(i==null)return null;let o=j1(t);U3(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let d=Q3(i);l=Z3(o[c],d,n)}return l}function j1(t,e=[],s=[],n=""){let r=(i,o,l)=>{let c={relativePath:l===void 0?i.path||"":l,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};c.relativePath.startsWith("/")&&(zs(c.relativePath.startsWith(n),`Absolute route path "${c.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),c.relativePath=c.relativePath.slice(n.length));let d=Li([n,c.relativePath]),u=s.concat(c);i.children&&i.children.length>0&&(zs(i.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${d}".`),j1(i.children,e,u,d)),!(i.path==null&&!i.index)&&e.push({path:d,score:X3(d,i.index),routesMeta:u})};return t.forEach((i,o)=>{if(i.path===""||!i.path?.includes("?"))r(i,o);else for(let l of I1(i.path))r(i,o,l)}),e}function I1(t){let e=t.split("/");if(e.length===0)return[];let[s,...n]=e,r=s.endsWith("?"),i=s.replace(/\?$/,"");if(n.length===0)return r?[i,""]:[i];let o=I1(n.join("/")),l=[];return l.push(...o.map(c=>c===""?i:[i,c].join("/"))),r&&l.push(...o),l.map(c=>t.startsWith("/")&&c===""?"/":c)}function U3(t){t.sort((e,s)=>e.score!==s.score?s.score-e.score:Y3(e.routesMeta.map(n=>n.childrenIndex),s.routesMeta.map(n=>n.childrenIndex)))}var V3=/^:[\w-]+$/,W3=3,G3=2,H3=1,q3=10,K3=-2,E1=t=>t==="*";function X3(t,e){let s=t.split("/"),n=s.length;return s.some(E1)&&(n+=K3),e&&(n+=G3),s.filter(r=>!E1(r)).reduce((r,i)=>r+(V3.test(i)?W3:i===""?H3:q3),n)}function Y3(t,e){return t.length===e.length&&t.slice(0,-1).every((n,r)=>n===e[r])?t[t.length-1]-e[e.length-1]:0}function Z3(t,e,s=!1){let{routesMeta:n}=t,r={},i="/",o=[];for(let l=0;l<n.length;++l){let c=n[l],d=l===n.length-1,u=i==="/"?e:e.slice(i.length)||"/",h=qh({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},u),p=c.route;if(!h&&d&&s&&!n[n.length-1].route.index&&(h=qh({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},u)),!h)return null;Object.assign(r,h.params),o.push({params:r,pathname:Li([i,h.pathname]),pathnameBase:nP(Li([i,h.pathnameBase])),route:p}),h.pathnameBase!=="/"&&(i=Li([i,h.pathnameBase]))}return o}function qh(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[s,n]=J3(t.path,t.caseSensitive,t.end),r=e.match(s);if(!r)return null;let i=r[0],o=i.replace(/(.)\/+$/,"$1"),l=r.slice(1);return{params:n.reduce((d,{paramName:u,isOptional:h},p)=>{if(u==="*"){let m=l[p]||"";o=i.slice(0,i.length-m.length).replace(/(.)\/+$/,"$1")}const f=l[p];return h&&!f?d[u]=void 0:d[u]=(f||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:o,pattern:t}}function J3(t,e=!1,s=!0){Ar(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let n=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(n.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(n.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):s?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),n]}function Q3(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ar(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Mi(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let s=e.endsWith("/")?e.length-1:e.length,n=t.charAt(s);return n&&n!=="/"?null:t.slice(s)||"/"}function eP(t,e="/"){let{pathname:s,search:n="",hash:r=""}=typeof t=="string"?Tl(t):t;return{pathname:s?s.startsWith("/")?s:tP(s,e):e,search:rP(n),hash:iP(r)}}function tP(t,e){let s=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?s.length>1&&s.pop():r!=="."&&s.push(r)}),s.length>1?s.join("/"):"/"}function sx(t,e,s,n){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${s}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function sP(t){return t.filter((e,s)=>s===0||e.route.path&&e.route.path.length>0)}function $1(t){let e=sP(t);return e.map((s,n)=>n===e.length-1?s.pathname:s.pathnameBase)}function T1(t,e,s,n=!1){let r;typeof t=="string"?r=Tl(t):(r={...t},zs(!r.pathname||!r.pathname.includes("?"),sx("?","pathname","search",r)),zs(!r.pathname||!r.pathname.includes("#"),sx("#","pathname","hash",r)),zs(!r.search||!r.search.includes("#"),sx("#","search","hash",r)));let i=t===""||r.pathname==="",o=i?"/":r.pathname,l;if(o==null)l=s;else{let h=e.length-1;if(!n&&o.startsWith("..")){let p=o.split("/");for(;p[0]==="..";)p.shift(),h-=1;r.pathname=p.join("/")}l=h>=0?e[h]:"/"}let c=eP(r,l),d=o&&o!=="/"&&o.endsWith("/"),u=(i||o===".")&&s.endsWith("/");return!c.pathname.endsWith("/")&&(d||u)&&(c.pathname+="/"),c}var Li=t=>t.join("/").replace(/\/\/+/g,"/"),nP=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),rP=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,iP=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function oP(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var A1=["POST","PUT","PATCH","DELETE"];new Set(A1);var aP=["GET",...A1];new Set(aP);var Al=we.createContext(null);Al.displayName="DataRouter";var Kh=we.createContext(null);Kh.displayName="DataRouterState";var D1=we.createContext({isTransitioning:!1});D1.displayName="ViewTransition";var lP=we.createContext(new Map);lP.displayName="Fetchers";var cP=we.createContext(null);cP.displayName="Await";var Jr=we.createContext(null);Jr.displayName="Navigation";var Xh=we.createContext(null);Xh.displayName="Location";var zi=we.createContext({outlet:null,matches:[],isDataRoute:!1});zi.displayName="Route";var nx=we.createContext(null);nx.displayName="RouteError";function dP(t,{relative:e}={}){zs(qc(),"useHref() may be used only in the context of a <Router> component.");let{basename:s,navigator:n}=we.useContext(Jr),{hash:r,pathname:i,search:o}=Kc(t,{relative:e}),l=i;return s!=="/"&&(l=i==="/"?s:Li([s,i])),n.createHref({pathname:l,search:o,hash:r})}function qc(){return we.useContext(Xh)!=null}function ca(){return zs(qc(),"useLocation() may be used only in the context of a <Router> component."),we.useContext(Xh).location}var _1="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function R1(t){we.useContext(Jr).static||we.useLayoutEffect(t)}function P1(){let{isDataRoute:t}=we.useContext(zi);return t?kP():uP()}function uP(){zs(qc(),"useNavigate() may be used only in the context of a <Router> component.");let t=we.useContext(Al),{basename:e,navigator:s}=we.useContext(Jr),{matches:n}=we.useContext(zi),{pathname:r}=ca(),i=JSON.stringify($1(n)),o=we.useRef(!1);return R1(()=>{o.current=!0}),we.useCallback((c,d={})=>{if(Ar(o.current,_1),!o.current)return;if(typeof c=="number"){s.go(c);return}let u=T1(c,JSON.parse(i),r,d.relative==="path");t==null&&e!=="/"&&(u.pathname=u.pathname==="/"?e:Li([e,u.pathname])),(d.replace?s.replace:s.push)(u,d.state,d)},[e,s,i,r,t])}we.createContext(null);function Kc(t,{relative:e}={}){let{matches:s}=we.useContext(zi),{pathname:n}=ca(),r=JSON.stringify($1(s));return we.useMemo(()=>T1(t,JSON.parse(r),n,e==="path"),[t,r,n,e])}function hP(t,e,s,n){zs(qc(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r,static:i}=we.useContext(Jr),{matches:o}=we.useContext(zi),l=o[o.length-1],c=l?l.params:{},d=l?l.pathname:"/",u=l?l.pathnameBase:"/",h=l&&l.route;{let y=h&&h.path||"";O1(d,!h||y.endsWith("*")||y.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${d}" (under <Route path="${y}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${y}"> to <Route path="${y==="/"?"*":`${y}/*`}">.`)}let p=ca(),f;f=p;let m=f.pathname||"/",b=m;if(u!=="/"){let y=u.replace(/^\//,"").split("/");b="/"+m.replace(/^\//,"").split("/").slice(y.length).join("/")}let g=!i&&s&&s.matches&&s.matches.length>0?s.matches:S1(t,{pathname:b});return Ar(h||g!=null,`No routes matched location "${f.pathname}${f.search}${f.hash}" `),Ar(g==null||g[g.length-1].route.element!==void 0||g[g.length-1].route.Component!==void 0||g[g.length-1].route.lazy!==void 0,`Matched leaf route at location "${f.pathname}${f.search}${f.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),xP(g&&g.map(y=>Object.assign({},y,{params:Object.assign({},c,y.params),pathname:Li([u,r.encodeLocation?r.encodeLocation(y.pathname).pathname:y.pathname]),pathnameBase:y.pathnameBase==="/"?u:Li([u,r.encodeLocation?r.encodeLocation(y.pathnameBase).pathname:y.pathnameBase])})),o,s,n)}function pP(){let t=NP(),e=oP(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),s=t instanceof Error?t.stack:null,n="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:n},i={padding:"2px 4px",backgroundColor:n},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=we.createElement(we.Fragment,null,we.createElement("p",null," Hey developer "),we.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",we.createElement("code",{style:i},"ErrorBoundary")," or"," ",we.createElement("code",{style:i},"errorElement")," prop on your route.")),we.createElement(we.Fragment,null,we.createElement("h2",null,"Unexpected Application Error!"),we.createElement("h3",{style:{fontStyle:"italic"}},e),s?we.createElement("pre",{style:r},s):null,o)}var fP=we.createElement(pP,null),mP=class extends we.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return this.state.error!==void 0?we.createElement(zi.Provider,{value:this.props.routeContext},we.createElement(nx.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function gP({routeContext:t,match:e,children:s}){let n=we.useContext(Al);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),we.createElement(zi.Provider,{value:t},s)}function xP(t,e=[],s=null,n=null){if(t==null){if(!s)return null;if(s.errors)t=s.matches;else if(e.length===0&&!s.initialized&&s.matches.length>0)t=s.matches;else return null}let r=t,i=s?.errors;if(i!=null){let c=r.findIndex(d=>d.route.id&&i?.[d.route.id]!==void 0);zs(c>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(i).join(",")}`),r=r.slice(0,Math.min(r.length,c+1))}let o=!1,l=-1;if(s)for(let c=0;c<r.length;c++){let d=r[c];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(l=c),d.route.id){let{loaderData:u,errors:h}=s,p=d.route.loader&&!u.hasOwnProperty(d.route.id)&&(!h||h[d.route.id]===void 0);if(d.route.lazy||p){o=!0,l>=0?r=r.slice(0,l+1):r=[r[0]];break}}}return r.reduceRight((c,d,u)=>{let h,p=!1,f=null,m=null;s&&(h=i&&d.route.id?i[d.route.id]:void 0,f=d.route.errorElement||fP,o&&(l<0&&u===0?(O1("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),p=!0,m=null):l===u&&(p=!0,m=d.route.hydrateFallbackElement||null)));let b=e.concat(r.slice(0,u+1)),g=()=>{let x;return h?x=f:p?x=m:d.route.Component?x=we.createElement(d.route.Component,null):d.route.element?x=d.route.element:x=c,we.createElement(gP,{match:d,routeContext:{outlet:c,matches:b,isDataRoute:s!=null},children:x})};return s&&(d.route.ErrorBoundary||d.route.errorElement||u===0)?we.createElement(mP,{location:s.location,revalidation:s.revalidation,component:f,error:h,children:g(),routeContext:{outlet:null,matches:b,isDataRoute:!0}}):g()},null)}function rx(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function bP(t){let e=we.useContext(Al);return zs(e,rx(t)),e}function yP(t){let e=we.useContext(Kh);return zs(e,rx(t)),e}function wP(t){let e=we.useContext(zi);return zs(e,rx(t)),e}function ix(t){let e=wP(t),s=e.matches[e.matches.length-1];return zs(s.route.id,`${t} can only be used on routes that contain a unique "id"`),s.route.id}function vP(){return ix("useRouteId")}function NP(){let t=we.useContext(nx),e=yP("useRouteError"),s=ix("useRouteError");return t!==void 0?t:e.errors?.[s]}function kP(){let{router:t}=bP("useNavigate"),e=ix("useNavigate"),s=we.useRef(!1);return R1(()=>{s.current=!0}),we.useCallback(async(r,i={})=>{Ar(s.current,_1),s.current&&(typeof r=="number"?t.navigate(r):await t.navigate(r,{fromRouteId:e,...i}))},[t,e])}var F1={};function O1(t,e,s){!e&&!F1[t]&&(F1[t]=!0,Ar(!1,s))}we.memo(CP);function CP({routes:t,future:e,state:s}){return hP(t,void 0,s,e)}function SP({basename:t,children:e,initialEntries:s,initialIndex:n}){let r=we.useRef();r.current==null&&(r.current=M3({initialEntries:s,initialIndex:n,v5Compat:!0}));let i=r.current,[o,l]=we.useState({action:i.action,location:i.location}),c=we.useCallback(d=>{we.startTransition(()=>l(d))},[l]);return we.useLayoutEffect(()=>i.listen(c),[i,c]),we.createElement(jP,{basename:t,children:e,location:o.location,navigationType:o.action,navigator:i})}function jP({basename:t="/",children:e=null,location:s,navigationType:n="POP",navigator:r,static:i=!1}){zs(!qc(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=t.replace(/^\/*/,"/"),l=we.useMemo(()=>({basename:o,navigator:r,static:i,future:{}}),[o,r,i]);typeof s=="string"&&(s=Tl(s));let{pathname:c="/",search:d="",hash:u="",state:h=null,key:p="default"}=s,f=we.useMemo(()=>{let m=Mi(c,o);return m==null?null:{location:{pathname:m,search:d,hash:u,state:h,key:p},navigationType:n}},[o,c,d,u,h,p,n]);return Ar(f!=null,`<Router basename="${o}"> is not able to match the URL "${c}${d}${u}" because it does not start with the basename, so the <Router> won't render anything.`),f==null?null:we.createElement(Jr.Provider,{value:l},we.createElement(Xh.Provider,{children:e,value:f}))}var Yh="get",Zh="application/x-www-form-urlencoded";function Jh(t){return t!=null&&typeof t.tagName=="string"}function IP(t){return Jh(t)&&t.tagName.toLowerCase()==="button"}function EP(t){return Jh(t)&&t.tagName.toLowerCase()==="form"}function $P(t){return Jh(t)&&t.tagName.toLowerCase()==="input"}function TP(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function AP(t,e){return t.button===0&&(!e||e==="_self")&&!TP(t)}var Qh=null;function DP(){if(Qh===null)try{new FormData(document.createElement("form"),0),Qh=!1}catch{Qh=!0}return Qh}var _P=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function ox(t){return t!=null&&!_P.has(t)?(Ar(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Zh}"`),null):t}function RP(t,e){let s,n,r,i,o;if(EP(t)){let l=t.getAttribute("action");n=l?Mi(l,e):null,s=t.getAttribute("method")||Yh,r=ox(t.getAttribute("enctype"))||Zh,i=new FormData(t)}else if(IP(t)||$P(t)&&(t.type==="submit"||t.type==="image")){let l=t.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=t.getAttribute("formaction")||l.getAttribute("action");if(n=c?Mi(c,e):null,s=t.getAttribute("formmethod")||l.getAttribute("method")||Yh,r=ox(t.getAttribute("formenctype"))||ox(l.getAttribute("enctype"))||Zh,i=new FormData(l,t),!DP()){let{name:d,type:u,value:h}=t;if(u==="image"){let p=d?`${d}.`:"";i.append(`${p}x`,"0"),i.append(`${p}y`,"0")}else d&&i.append(d,h)}}else{if(Jh(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');s=Yh,n=null,r=Zh,o=t}return i&&r==="text/plain"&&(o=i,i=void 0),{action:n,method:s.toLowerCase(),encType:r,formData:i,body:o}}function ax(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}async function PP(t,e){if(t.id in e)return e[t.id];try{let s=await import(t.module);return e[t.id]=s,s}catch(s){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(s),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function FP(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function OP(t,e,s){let n=await Promise.all(t.map(async r=>{let i=e.routes[r.route.id];if(i){let o=await PP(i,s);return o.links?o.links():[]}return[]}));return BP(n.flat(1).filter(FP).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function M1(t,e,s,n,r,i){let o=(c,d)=>s[d]?c.route.id!==s[d].route.id:!0,l=(c,d)=>s[d].pathname!==c.pathname||s[d].route.path?.endsWith("*")&&s[d].params["*"]!==c.params["*"];return i==="assets"?e.filter((c,d)=>o(c,d)||l(c,d)):i==="data"?e.filter((c,d)=>{let u=n.routes[c.route.id];if(!u||!u.hasLoader)return!1;if(o(c,d)||l(c,d))return!0;if(c.route.shouldRevalidate){let h=c.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:s[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function MP(t,e,{includeHydrateFallback:s}={}){return LP(t.map(n=>{let r=e.routes[n.route.id];if(!r)return[];let i=[r.module];return r.clientActionModule&&(i=i.concat(r.clientActionModule)),r.clientLoaderModule&&(i=i.concat(r.clientLoaderModule)),s&&r.hydrateFallbackModule&&(i=i.concat(r.hydrateFallbackModule)),r.imports&&(i=i.concat(r.imports)),i}).flat(1))}function LP(t){return[...new Set(t)]}function zP(t){let e={},s=Object.keys(t).sort();for(let n of s)e[n]=t[n];return e}function BP(t,e){let s=new Set;return new Set(e),t.reduce((n,r)=>{let i=JSON.stringify(zP(r));return s.has(i)||(s.add(i),n.push({key:i,link:r})),n},[])}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var UP=new Set([100,101,204,205]);function VP(t,e){let s=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return s.pathname==="/"?s.pathname="_root.data":e&&Mi(s.pathname,e)==="/"?s.pathname=`${e.replace(/\/$/,"")}/_root.data`:s.pathname=`${s.pathname.replace(/\/$/,"")}.data`,s}function L1(){let t=we.useContext(Al);return ax(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function WP(){let t=we.useContext(Kh);return ax(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var lx=we.createContext(void 0);lx.displayName="FrameworkContext";function z1(){let t=we.useContext(lx);return ax(t,"You must render this element inside a <HydratedRouter> element"),t}function GP(t,e){let s=we.useContext(lx),[n,r]=we.useState(!1),[i,o]=we.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:d,onMouseLeave:u,onTouchStart:h}=e,p=we.useRef(null);we.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let b=x=>{x.forEach(y=>{o(y.isIntersecting)})},g=new IntersectionObserver(b,{threshold:.5});return p.current&&g.observe(p.current),()=>{g.disconnect()}}},[t]),we.useEffect(()=>{if(n){let b=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(b)}}},[n]);let f=()=>{r(!0)},m=()=>{r(!1),o(!1)};return s?t!=="intent"?[i,p,{}]:[i,p,{onFocus:Xc(l,f),onBlur:Xc(c,m),onMouseEnter:Xc(d,f),onMouseLeave:Xc(u,m),onTouchStart:Xc(h,f)}]:[!1,p,{}]}function Xc(t,e){return s=>{t&&t(s),s.defaultPrevented||e(s)}}function HP({page:t,...e}){let{router:s}=L1(),n=we.useMemo(()=>S1(s.routes,t,s.basename),[s.routes,t,s.basename]);return n?we.createElement(KP,{page:t,matches:n,...e}):null}function qP(t){let{manifest:e,routeModules:s}=z1(),[n,r]=we.useState([]);return we.useEffect(()=>{let i=!1;return OP(t,e,s).then(o=>{i||r(o)}),()=>{i=!0}},[t,e,s]),n}function KP({page:t,matches:e,...s}){let n=ca(),{manifest:r,routeModules:i}=z1(),{basename:o}=L1(),{loaderData:l,matches:c}=WP(),d=we.useMemo(()=>M1(t,e,c,r,n,"data"),[t,e,c,r,n]),u=we.useMemo(()=>M1(t,e,c,r,n,"assets"),[t,e,c,r,n]),h=we.useMemo(()=>{if(t===n.pathname+n.search+n.hash)return[];let m=new Set,b=!1;if(e.forEach(x=>{let y=r.routes[x.route.id];!y||!y.hasLoader||(!d.some(w=>w.route.id===x.route.id)&&x.route.id in l&&i[x.route.id]?.shouldRevalidate||y.hasClientLoader?b=!0:m.add(x.route.id))}),m.size===0)return[];let g=VP(t,o);return b&&m.size>0&&g.searchParams.set("_routes",e.filter(x=>m.has(x.route.id)).map(x=>x.route.id).join(",")),[g.pathname+g.search]},[o,l,n,r,d,e,t,i]),p=we.useMemo(()=>MP(u,r),[u,r]),f=qP(u);return we.createElement(we.Fragment,null,h.map(m=>we.createElement("link",{key:m,rel:"prefetch",as:"fetch",href:m,...s})),p.map(m=>we.createElement("link",{key:m,rel:"modulepreload",href:m,...s})),f.map(({key:m,link:b})=>we.createElement("link",{key:m,...b})))}function XP(...t){return e=>{t.forEach(s=>{typeof s=="function"?s(e):s!=null&&(s.current=e)})}}var B1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{B1&&(window.__reactRouterVersion="7.6.0")}catch{}var U1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,V1=we.forwardRef(function({onClick:e,discover:s="render",prefetch:n="none",relative:r,reloadDocument:i,replace:o,state:l,target:c,to:d,preventScrollReset:u,viewTransition:h,...p},f){let{basename:m}=we.useContext(Jr),b=typeof d=="string"&&U1.test(d),g,x=!1;if(typeof d=="string"&&b&&(g=d,B1))try{let T=new URL(window.location.href),E=d.startsWith("//")?new URL(T.protocol+d):new URL(d),$=Mi(E.pathname,m);E.origin===T.origin&&$!=null?d=$+E.search+E.hash:x=!0}catch{Ar(!1,`<Link to="${d}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let y=dP(d,{relative:r}),[w,v,N]=GP(n,p),C=QP(d,{replace:o,state:l,target:c,preventScrollReset:u,relative:r,viewTransition:h});function j(T){e&&e(T),T.defaultPrevented||C(T)}let I=we.createElement("a",{...p,...N,href:g||y,onClick:x||i?e:j,ref:XP(f,v),target:c,"data-discover":!b&&s==="render"?"true":void 0});return w&&!b?we.createElement(we.Fragment,null,I,we.createElement(HP,{page:y})):I});V1.displayName="Link";var YP=we.forwardRef(function({"aria-current":e="page",caseSensitive:s=!1,className:n="",end:r=!1,style:i,to:o,viewTransition:l,children:c,...d},u){let h=Kc(o,{relative:d.relative}),p=ca(),f=we.useContext(Kh),{navigator:m,basename:b}=we.useContext(Jr),g=f!=null&&rF(h)&&l===!0,x=m.encodeLocation?m.encodeLocation(h).pathname:h.pathname,y=p.pathname,w=f&&f.navigation&&f.navigation.location?f.navigation.location.pathname:null;s||(y=y.toLowerCase(),w=w?w.toLowerCase():null,x=x.toLowerCase()),w&&b&&(w=Mi(w,b)||w);const v=x!=="/"&&x.endsWith("/")?x.length-1:x.length;let N=y===x||!r&&y.startsWith(x)&&y.charAt(v)==="/",C=w!=null&&(w===x||!r&&w.startsWith(x)&&w.charAt(x.length)==="/"),j={isActive:N,isPending:C,isTransitioning:g},I=N?e:void 0,T;typeof n=="function"?T=n(j):T=[n,N?"active":null,C?"pending":null,g?"transitioning":null].filter(Boolean).join(" ");let E=typeof i=="function"?i(j):i;return we.createElement(V1,{...d,"aria-current":I,className:T,ref:u,style:E,to:o,viewTransition:l},typeof c=="function"?c(j):c)});YP.displayName="NavLink";var ZP=we.forwardRef(({discover:t="render",fetcherKey:e,navigate:s,reloadDocument:n,replace:r,state:i,method:o=Yh,action:l,onSubmit:c,relative:d,preventScrollReset:u,viewTransition:h,...p},f)=>{let m=sF(),b=nF(l,{relative:d}),g=o.toLowerCase()==="get"?"get":"post",x=typeof l=="string"&&U1.test(l),y=w=>{if(c&&c(w),w.defaultPrevented)return;w.preventDefault();let v=w.nativeEvent.submitter,N=v?.getAttribute("formmethod")||o;m(v||w.currentTarget,{fetcherKey:e,method:N,navigate:s,replace:r,state:i,relative:d,preventScrollReset:u,viewTransition:h})};return we.createElement("form",{ref:f,method:g,action:b,onSubmit:n?c:y,...p,"data-discover":!x&&t==="render"?"true":void 0})});ZP.displayName="Form";function JP(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function W1(t){let e=we.useContext(Al);return zs(e,JP(t)),e}function QP(t,{target:e,replace:s,state:n,preventScrollReset:r,relative:i,viewTransition:o}={}){let l=P1(),c=ca(),d=Kc(t,{relative:i});return we.useCallback(u=>{if(AP(u,e)){u.preventDefault();let h=s!==void 0?s:Hh(c)===Hh(d);l(t,{replace:h,state:n,preventScrollReset:r,relative:i,viewTransition:o})}},[c,l,d,s,n,e,t,r,i,o])}var eF=0,tF=()=>`__${String(++eF)}__`;function sF(){let{router:t}=W1("useSubmit"),{basename:e}=we.useContext(Jr),s=vP();return we.useCallback(async(n,r={})=>{let{action:i,method:o,encType:l,formData:c,body:d}=RP(n,e);if(r.navigate===!1){let u=r.fetcherKey||tF();await t.fetch(u,s,r.action||i,{preventScrollReset:r.preventScrollReset,formData:c,body:d,formMethod:r.method||o,formEncType:r.encType||l,flushSync:r.flushSync})}else await t.navigate(r.action||i,{preventScrollReset:r.preventScrollReset,formData:c,body:d,formMethod:r.method||o,formEncType:r.encType||l,replace:r.replace,state:r.state,fromRouteId:s,flushSync:r.flushSync,viewTransition:r.viewTransition})},[t,e,s])}function nF(t,{relative:e}={}){let{basename:s}=we.useContext(Jr),n=we.useContext(zi);zs(n,"useFormAction must be used inside a RouteContext");let[r]=n.matches.slice(-1),i={...Kc(t||".",{relative:e})},o=ca();if(t==null){i.search=o.search;let l=new URLSearchParams(i.search),c=l.getAll("index");if(c.some(u=>u==="")){l.delete("index"),c.filter(h=>h).forEach(h=>l.append("index",h));let u=l.toString();i.search=u?`?${u}`:""}}return(!t||t===".")&&r.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),s!=="/"&&(i.pathname=i.pathname==="/"?s:Li([s,i.pathname])),Hh(i)}function rF(t,e={}){let s=we.useContext(D1);zs(s!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=W1("useViewTransitionState"),r=Kc(t,{relative:e.relative});if(!s.isTransitioning)return!1;let i=Mi(s.currentLocation.pathname,n)||s.currentLocation.pathname,o=Mi(s.nextLocation.pathname,n)||s.nextLocation.pathname;return qh(r.pathname,o)!=null||qh(r.pathname,i)!=null}[...UP];const iF=()=>{const t=P1(),e=(s,n)=>{const r=n?`?gigId=${n}`:"";t(`/agent-details/${s}${r}`)};return a.jsx(N1,{onAgentSelect:e})};function G1(t,e){return function(){return t.apply(e,arguments)}}const{toString:oF}=Object.prototype,{getPrototypeOf:cx}=Object,{iterator:ep,toStringTag:H1}=Symbol,tp=(t=>e=>{const s=oF.call(e);return t[s]||(t[s]=s.slice(8,-1).toLowerCase())})(Object.create(null)),Dr=t=>(t=t.toLowerCase(),e=>tp(e)===t),sp=t=>e=>typeof e===t,{isArray:Dl}=Array,Yc=sp("undefined");function aF(t){return t!==null&&!Yc(t)&&t.constructor!==null&&!Yc(t.constructor)&&jn(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const q1=Dr("ArrayBuffer");function lF(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&q1(t.buffer),e}const cF=sp("string"),jn=sp("function"),K1=sp("number"),np=t=>t!==null&&typeof t=="object",dF=t=>t===!0||t===!1,rp=t=>{if(tp(t)!=="object")return!1;const e=cx(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(H1 in t)&&!(ep in t)},uF=Dr("Date"),hF=Dr("File"),pF=Dr("Blob"),fF=Dr("FileList"),mF=t=>np(t)&&jn(t.pipe),gF=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||jn(t.append)&&((e=tp(t))==="formdata"||e==="object"&&jn(t.toString)&&t.toString()==="[object FormData]"))},xF=Dr("URLSearchParams"),[bF,yF,wF,vF]=["ReadableStream","Request","Response","Headers"].map(Dr),NF=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Zc(t,e,{allOwnKeys:s=!1}={}){if(t===null||typeof t>"u")return;let n,r;if(typeof t!="object"&&(t=[t]),Dl(t))for(n=0,r=t.length;n<r;n++)e.call(null,t[n],n,t);else{const i=s?Object.getOwnPropertyNames(t):Object.keys(t),o=i.length;let l;for(n=0;n<o;n++)l=i[n],e.call(null,t[l],l,t)}}function X1(t,e){e=e.toLowerCase();const s=Object.keys(t);let n=s.length,r;for(;n-- >0;)if(r=s[n],e===r.toLowerCase())return r;return null}const da=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Y1=t=>!Yc(t)&&t!==da;function dx(){const{caseless:t}=Y1(this)&&this||{},e={},s=(n,r)=>{const i=t&&X1(e,r)||r;rp(e[i])&&rp(n)?e[i]=dx(e[i],n):rp(n)?e[i]=dx({},n):Dl(n)?e[i]=n.slice():e[i]=n};for(let n=0,r=arguments.length;n<r;n++)arguments[n]&&Zc(arguments[n],s);return e}const kF=(t,e,s,{allOwnKeys:n}={})=>(Zc(e,(r,i)=>{s&&jn(r)?t[i]=G1(r,s):t[i]=r},{allOwnKeys:n}),t),CF=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),SF=(t,e,s,n)=>{t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),s&&Object.assign(t.prototype,s)},jF=(t,e,s,n)=>{let r,i,o;const l={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),i=r.length;i-- >0;)o=r[i],(!n||n(o,t,e))&&!l[o]&&(e[o]=t[o],l[o]=!0);t=s!==!1&&cx(t)}while(t&&(!s||s(t,e))&&t!==Object.prototype);return e},IF=(t,e,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=e.length;const n=t.indexOf(e,s);return n!==-1&&n===s},EF=t=>{if(!t)return null;if(Dl(t))return t;let e=t.length;if(!K1(e))return null;const s=new Array(e);for(;e-- >0;)s[e]=t[e];return s},$F=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&cx(Uint8Array)),TF=(t,e)=>{const n=(t&&t[ep]).call(t);let r;for(;(r=n.next())&&!r.done;){const i=r.value;e.call(t,i[0],i[1])}},AF=(t,e)=>{let s;const n=[];for(;(s=t.exec(e))!==null;)n.push(s);return n},DF=Dr("HTMLFormElement"),_F=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(s,n,r){return n.toUpperCase()+r}),Z1=(({hasOwnProperty:t})=>(e,s)=>t.call(e,s))(Object.prototype),RF=Dr("RegExp"),J1=(t,e)=>{const s=Object.getOwnPropertyDescriptors(t),n={};Zc(s,(r,i)=>{let o;(o=e(r,i,t))!==!1&&(n[i]=o||r)}),Object.defineProperties(t,n)},PF=t=>{J1(t,(e,s)=>{if(jn(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const n=t[s];if(jn(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")})}})},FF=(t,e)=>{const s={},n=r=>{r.forEach(i=>{s[i]=!0})};return Dl(t)?n(t):n(String(t).split(e)),s},OF=()=>{},MF=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function LF(t){return!!(t&&jn(t.append)&&t[H1]==="FormData"&&t[ep])}const zF=t=>{const e=new Array(10),s=(n,r)=>{if(np(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[r]=n;const i=Dl(n)?[]:{};return Zc(n,(o,l)=>{const c=s(o,r+1);!Yc(c)&&(i[l]=c)}),e[r]=void 0,i}}return n};return s(t,0)},BF=Dr("AsyncFunction"),UF=t=>t&&(np(t)||jn(t))&&jn(t.then)&&jn(t.catch),Q1=((t,e)=>t?setImmediate:e?((s,n)=>(da.addEventListener("message",({source:r,data:i})=>{r===da&&i===s&&n.length&&n.shift()()},!1),r=>{n.push(r),da.postMessage(s,"*")}))(`axios@${Math.random()}`,[]):s=>setTimeout(s))(typeof setImmediate=="function",jn(da.postMessage)),VF=typeof queueMicrotask<"u"?queueMicrotask.bind(da):typeof process<"u"&&process.nextTick||Q1,ge={isArray:Dl,isArrayBuffer:q1,isBuffer:aF,isFormData:gF,isArrayBufferView:lF,isString:cF,isNumber:K1,isBoolean:dF,isObject:np,isPlainObject:rp,isReadableStream:bF,isRequest:yF,isResponse:wF,isHeaders:vF,isUndefined:Yc,isDate:uF,isFile:hF,isBlob:pF,isRegExp:RF,isFunction:jn,isStream:mF,isURLSearchParams:xF,isTypedArray:$F,isFileList:fF,forEach:Zc,merge:dx,extend:kF,trim:NF,stripBOM:CF,inherits:SF,toFlatObject:jF,kindOf:tp,kindOfTest:Dr,endsWith:IF,toArray:EF,forEachEntry:TF,matchAll:AF,isHTMLForm:DF,hasOwnProperty:Z1,hasOwnProp:Z1,reduceDescriptors:J1,freezeMethods:PF,toObjectSet:FF,toCamelCase:_F,noop:OF,toFiniteNumber:MF,findKey:X1,global:da,isContextDefined:Y1,isSpecCompliantForm:LF,toJSONObject:zF,isAsyncFn:BF,isThenable:UF,setImmediate:Q1,asap:VF,isIterable:t=>t!=null&&jn(t[ep])};function xt(t,e,s,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),s&&(this.config=s),n&&(this.request=n),r&&(this.response=r,this.status=r.status?r.status:null)}ge.inherits(xt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ge.toJSONObject(this.config),code:this.code,status:this.status}}});const e2=xt.prototype,t2={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{t2[t]={value:t}}),Object.defineProperties(xt,t2),Object.defineProperty(e2,"isAxiosError",{value:!0}),xt.from=(t,e,s,n,r,i)=>{const o=Object.create(e2);return ge.toFlatObject(t,o,function(c){return c!==Error.prototype},l=>l!=="isAxiosError"),xt.call(o,t.message,e,s,n,r),o.cause=t,o.name=t.name,i&&Object.assign(o,i),o};const WF=null;function ux(t){return ge.isPlainObject(t)||ge.isArray(t)}function s2(t){return ge.endsWith(t,"[]")?t.slice(0,-2):t}function n2(t,e,s){return t?t.concat(e).map(function(r,i){return r=s2(r),!s&&i?"["+r+"]":r}).join(s?".":""):e}function GF(t){return ge.isArray(t)&&!t.some(ux)}const HF=ge.toFlatObject(ge,{},null,function(e){return/^is[A-Z]/.test(e)});function ip(t,e,s){if(!ge.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,s=ge.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,g){return!ge.isUndefined(g[b])});const n=s.metaTokens,r=s.visitor||u,i=s.dots,o=s.indexes,c=(s.Blob||typeof Blob<"u"&&Blob)&&ge.isSpecCompliantForm(e);if(!ge.isFunction(r))throw new TypeError("visitor must be a function");function d(m){if(m===null)return"";if(ge.isDate(m))return m.toISOString();if(!c&&ge.isBlob(m))throw new xt("Blob is not supported. Use a Buffer instead.");return ge.isArrayBuffer(m)||ge.isTypedArray(m)?c&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function u(m,b,g){let x=m;if(m&&!g&&typeof m=="object"){if(ge.endsWith(b,"{}"))b=n?b:b.slice(0,-2),m=JSON.stringify(m);else if(ge.isArray(m)&&GF(m)||(ge.isFileList(m)||ge.endsWith(b,"[]"))&&(x=ge.toArray(m)))return b=s2(b),x.forEach(function(w,v){!(ge.isUndefined(w)||w===null)&&e.append(o===!0?n2([b],v,i):o===null?b:b+"[]",d(w))}),!1}return ux(m)?!0:(e.append(n2(g,b,i),d(m)),!1)}const h=[],p=Object.assign(HF,{defaultVisitor:u,convertValue:d,isVisitable:ux});function f(m,b){if(!ge.isUndefined(m)){if(h.indexOf(m)!==-1)throw Error("Circular reference detected in "+b.join("."));h.push(m),ge.forEach(m,function(x,y){(!(ge.isUndefined(x)||x===null)&&r.call(e,x,ge.isString(y)?y.trim():y,b,p))===!0&&f(x,b?b.concat(y):[y])}),h.pop()}}if(!ge.isObject(t))throw new TypeError("data must be an object");return f(t),e}function r2(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function hx(t,e){this._pairs=[],t&&ip(t,this,e)}const i2=hx.prototype;i2.append=function(e,s){this._pairs.push([e,s])},i2.toString=function(e){const s=e?function(n){return e.call(this,n,r2)}:r2;return this._pairs.map(function(r){return s(r[0])+"="+s(r[1])},"").join("&")};function qF(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function o2(t,e,s){if(!e)return t;const n=s&&s.encode||qF;ge.isFunction(s)&&(s={serialize:s});const r=s&&s.serialize;let i;if(r?i=r(e,s):i=ge.isURLSearchParams(e)?e.toString():new hx(e,s).toString(n),i){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+i}return t}class a2{constructor(){this.handlers=[]}use(e,s,n){return this.handlers.push({fulfilled:e,rejected:s,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ge.forEach(this.handlers,function(n){n!==null&&e(n)})}}const l2={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},KF={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:hx,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},px=typeof window<"u"&&typeof document<"u",fx=typeof navigator=="object"&&navigator||void 0,XF=px&&(!fx||["ReactNative","NativeScript","NS"].indexOf(fx.product)<0),YF=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ZF=px&&window.location.href||"http://localhost",nn={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:px,hasStandardBrowserEnv:XF,hasStandardBrowserWebWorkerEnv:YF,navigator:fx,origin:ZF},Symbol.toStringTag,{value:"Module"})),...KF};function JF(t,e){return ip(t,new nn.classes.URLSearchParams,Object.assign({visitor:function(s,n,r,i){return nn.isNode&&ge.isBuffer(s)?(this.append(n,s.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function QF(t){return ge.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function eO(t){const e={},s=Object.keys(t);let n;const r=s.length;let i;for(n=0;n<r;n++)i=s[n],e[i]=t[i];return e}function c2(t){function e(s,n,r,i){let o=s[i++];if(o==="__proto__")return!0;const l=Number.isFinite(+o),c=i>=s.length;return o=!o&&ge.isArray(r)?r.length:o,c?(ge.hasOwnProp(r,o)?r[o]=[r[o],n]:r[o]=n,!l):((!r[o]||!ge.isObject(r[o]))&&(r[o]=[]),e(s,n,r[o],i)&&ge.isArray(r[o])&&(r[o]=eO(r[o])),!l)}if(ge.isFormData(t)&&ge.isFunction(t.entries)){const s={};return ge.forEachEntry(t,(n,r)=>{e(QF(n),r,s,0)}),s}return null}function tO(t,e,s){if(ge.isString(t))try{return(e||JSON.parse)(t),ge.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(0,JSON.stringify)(t)}const Jc={transitional:l2,adapter:["xhr","http","fetch"],transformRequest:[function(e,s){const n=s.getContentType()||"",r=n.indexOf("application/json")>-1,i=ge.isObject(e);if(i&&ge.isHTMLForm(e)&&(e=new FormData(e)),ge.isFormData(e))return r?JSON.stringify(c2(e)):e;if(ge.isArrayBuffer(e)||ge.isBuffer(e)||ge.isStream(e)||ge.isFile(e)||ge.isBlob(e)||ge.isReadableStream(e))return e;if(ge.isArrayBufferView(e))return e.buffer;if(ge.isURLSearchParams(e))return s.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let l;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return JF(e,this.formSerializer).toString();if((l=ge.isFileList(e))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return ip(l?{"files[]":e}:e,c&&new c,this.formSerializer)}}return i||r?(s.setContentType("application/json",!1),tO(e)):e}],transformResponse:[function(e){const s=this.transitional||Jc.transitional,n=s&&s.forcedJSONParsing,r=this.responseType==="json";if(ge.isResponse(e)||ge.isReadableStream(e))return e;if(e&&ge.isString(e)&&(n&&!this.responseType||r)){const o=!(s&&s.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(l){if(o)throw l.name==="SyntaxError"?xt.from(l,xt.ERR_BAD_RESPONSE,this,null,this.response):l}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:nn.classes.FormData,Blob:nn.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ge.forEach(["delete","get","head","post","put","patch"],t=>{Jc.headers[t]={}});const sO=ge.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),nO=t=>{const e={};let s,n,r;return t&&t.split(`
`).forEach(function(o){r=o.indexOf(":"),s=o.substring(0,r).trim().toLowerCase(),n=o.substring(r+1).trim(),!(!s||e[s]&&sO[s])&&(s==="set-cookie"?e[s]?e[s].push(n):e[s]=[n]:e[s]=e[s]?e[s]+", "+n:n)}),e},d2=Symbol("internals");function Qc(t){return t&&String(t).trim().toLowerCase()}function op(t){return t===!1||t==null?t:ge.isArray(t)?t.map(op):String(t)}function rO(t){const e=Object.create(null),s=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=s.exec(t);)e[n[1]]=n[2];return e}const iO=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function mx(t,e,s,n,r){if(ge.isFunction(n))return n.call(this,e,s);if(r&&(e=s),!!ge.isString(e)){if(ge.isString(n))return e.indexOf(n)!==-1;if(ge.isRegExp(n))return n.test(e)}}function oO(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,s,n)=>s.toUpperCase()+n)}function aO(t,e){const s=ge.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(t,n+s,{value:function(r,i,o){return this[n].call(this,e,r,i,o)},configurable:!0})})}class In{constructor(e){e&&this.set(e)}set(e,s,n){const r=this;function i(l,c,d){const u=Qc(c);if(!u)throw new Error("header name must be a non-empty string");const h=ge.findKey(r,u);(!h||r[h]===void 0||d===!0||d===void 0&&r[h]!==!1)&&(r[h||c]=op(l))}const o=(l,c)=>ge.forEach(l,(d,u)=>i(d,u,c));if(ge.isPlainObject(e)||e instanceof this.constructor)o(e,s);else if(ge.isString(e)&&(e=e.trim())&&!iO(e))o(nO(e),s);else if(ge.isObject(e)&&ge.isIterable(e)){let l={},c,d;for(const u of e){if(!ge.isArray(u))throw TypeError("Object iterator must return a key-value pair");l[d=u[0]]=(c=l[d])?ge.isArray(c)?[...c,u[1]]:[c,u[1]]:u[1]}o(l,s)}else e!=null&&i(s,e,n);return this}get(e,s){if(e=Qc(e),e){const n=ge.findKey(this,e);if(n){const r=this[n];if(!s)return r;if(s===!0)return rO(r);if(ge.isFunction(s))return s.call(this,r,n);if(ge.isRegExp(s))return s.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,s){if(e=Qc(e),e){const n=ge.findKey(this,e);return!!(n&&this[n]!==void 0&&(!s||mx(this,this[n],n,s)))}return!1}delete(e,s){const n=this;let r=!1;function i(o){if(o=Qc(o),o){const l=ge.findKey(n,o);l&&(!s||mx(n,n[l],l,s))&&(delete n[l],r=!0)}}return ge.isArray(e)?e.forEach(i):i(e),r}clear(e){const s=Object.keys(this);let n=s.length,r=!1;for(;n--;){const i=s[n];(!e||mx(this,this[i],i,e,!0))&&(delete this[i],r=!0)}return r}normalize(e){const s=this,n={};return ge.forEach(this,(r,i)=>{const o=ge.findKey(n,i);if(o){s[o]=op(r),delete s[i];return}const l=e?oO(i):String(i).trim();l!==i&&delete s[i],s[l]=op(r),n[l]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const s=Object.create(null);return ge.forEach(this,(n,r)=>{n!=null&&n!==!1&&(s[r]=e&&ge.isArray(n)?n.join(", "):n)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,s])=>e+": "+s).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...s){const n=new this(e);return s.forEach(r=>n.set(r)),n}static accessor(e){const n=(this[d2]=this[d2]={accessors:{}}).accessors,r=this.prototype;function i(o){const l=Qc(o);n[l]||(aO(r,o),n[l]=!0)}return ge.isArray(e)?e.forEach(i):i(e),this}}In.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ge.reduceDescriptors(In.prototype,({value:t},e)=>{let s=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(n){this[s]=n}}}),ge.freezeMethods(In);function gx(t,e){const s=this||Jc,n=e||s,r=In.from(n.headers);let i=n.data;return ge.forEach(t,function(l){i=l.call(s,i,r.normalize(),e?e.status:void 0)}),r.normalize(),i}function u2(t){return!!(t&&t.__CANCEL__)}function _l(t,e,s){xt.call(this,t??"canceled",xt.ERR_CANCELED,e,s),this.name="CanceledError"}ge.inherits(_l,xt,{__CANCEL__:!0});function h2(t,e,s){const n=s.config.validateStatus;!s.status||!n||n(s.status)?t(s):e(new xt("Request failed with status code "+s.status,[xt.ERR_BAD_REQUEST,xt.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s))}function lO(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function cO(t,e){t=t||10;const s=new Array(t),n=new Array(t);let r=0,i=0,o;return e=e!==void 0?e:1e3,function(c){const d=Date.now(),u=n[i];o||(o=d),s[r]=c,n[r]=d;let h=i,p=0;for(;h!==r;)p+=s[h++],h=h%t;if(r=(r+1)%t,r===i&&(i=(i+1)%t),d-o<e)return;const f=u&&d-u;return f?Math.round(p*1e3/f):void 0}}function dO(t,e){let s=0,n=1e3/e,r,i;const o=(d,u=Date.now())=>{s=u,r=null,i&&(clearTimeout(i),i=null),t.apply(null,d)};return[(...d)=>{const u=Date.now(),h=u-s;h>=n?o(d,u):(r=d,i||(i=setTimeout(()=>{i=null,o(r)},n-h)))},()=>r&&o(r)]}const ap=(t,e,s=3)=>{let n=0;const r=cO(50,250);return dO(i=>{const o=i.loaded,l=i.lengthComputable?i.total:void 0,c=o-n,d=r(c),u=o<=l;n=o;const h={loaded:o,total:l,progress:l?o/l:void 0,bytes:c,rate:d||void 0,estimated:d&&l&&u?(l-o)/d:void 0,event:i,lengthComputable:l!=null,[e?"download":"upload"]:!0};t(h)},s)},p2=(t,e)=>{const s=t!=null;return[n=>e[0]({lengthComputable:s,total:t,loaded:n}),e[1]]},f2=t=>(...e)=>ge.asap(()=>t(...e)),uO=nn.hasStandardBrowserEnv?((t,e)=>s=>(s=new URL(s,nn.origin),t.protocol===s.protocol&&t.host===s.host&&(e||t.port===s.port)))(new URL(nn.origin),nn.navigator&&/(msie|trident)/i.test(nn.navigator.userAgent)):()=>!0,hO=nn.hasStandardBrowserEnv?{write(t,e,s,n,r,i){const o=[t+"="+encodeURIComponent(e)];ge.isNumber(s)&&o.push("expires="+new Date(s).toGMTString()),ge.isString(n)&&o.push("path="+n),ge.isString(r)&&o.push("domain="+r),i===!0&&o.push("secure"),document.cookie=o.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function pO(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function fO(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function m2(t,e,s){let n=!pO(e);return t&&(n||s==!1)?fO(t,e):e}const g2=t=>t instanceof In?{...t}:t;function ua(t,e){e=e||{};const s={};function n(d,u,h,p){return ge.isPlainObject(d)&&ge.isPlainObject(u)?ge.merge.call({caseless:p},d,u):ge.isPlainObject(u)?ge.merge({},u):ge.isArray(u)?u.slice():u}function r(d,u,h,p){if(ge.isUndefined(u)){if(!ge.isUndefined(d))return n(void 0,d,h,p)}else return n(d,u,h,p)}function i(d,u){if(!ge.isUndefined(u))return n(void 0,u)}function o(d,u){if(ge.isUndefined(u)){if(!ge.isUndefined(d))return n(void 0,d)}else return n(void 0,u)}function l(d,u,h){if(h in e)return n(d,u);if(h in t)return n(void 0,d)}const c={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:l,headers:(d,u,h)=>r(g2(d),g2(u),h,!0)};return ge.forEach(Object.keys(Object.assign({},t,e)),function(u){const h=c[u]||r,p=h(t[u],e[u],u);ge.isUndefined(p)&&h!==l||(s[u]=p)}),s}const x2=t=>{const e=ua({},t);let{data:s,withXSRFToken:n,xsrfHeaderName:r,xsrfCookieName:i,headers:o,auth:l}=e;e.headers=o=In.from(o),e.url=o2(m2(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),l&&o.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let c;if(ge.isFormData(s)){if(nn.hasStandardBrowserEnv||nn.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((c=o.getContentType())!==!1){const[d,...u]=c?c.split(";").map(h=>h.trim()).filter(Boolean):[];o.setContentType([d||"multipart/form-data",...u].join("; "))}}if(nn.hasStandardBrowserEnv&&(n&&ge.isFunction(n)&&(n=n(e)),n||n!==!1&&uO(e.url))){const d=r&&i&&hO.read(i);d&&o.set(r,d)}return e},mO=typeof XMLHttpRequest<"u"&&function(t){return new Promise(function(s,n){const r=x2(t);let i=r.data;const o=In.from(r.headers).normalize();let{responseType:l,onUploadProgress:c,onDownloadProgress:d}=r,u,h,p,f,m;function b(){f&&f(),m&&m(),r.cancelToken&&r.cancelToken.unsubscribe(u),r.signal&&r.signal.removeEventListener("abort",u)}let g=new XMLHttpRequest;g.open(r.method.toUpperCase(),r.url,!0),g.timeout=r.timeout;function x(){if(!g)return;const w=In.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),N={data:!l||l==="text"||l==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:w,config:t,request:g};h2(function(j){s(j),b()},function(j){n(j),b()},N),g=null}"onloadend"in g?g.onloadend=x:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(x)},g.onabort=function(){g&&(n(new xt("Request aborted",xt.ECONNABORTED,t,g)),g=null)},g.onerror=function(){n(new xt("Network Error",xt.ERR_NETWORK,t,g)),g=null},g.ontimeout=function(){let v=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const N=r.transitional||l2;r.timeoutErrorMessage&&(v=r.timeoutErrorMessage),n(new xt(v,N.clarifyTimeoutError?xt.ETIMEDOUT:xt.ECONNABORTED,t,g)),g=null},i===void 0&&o.setContentType(null),"setRequestHeader"in g&&ge.forEach(o.toJSON(),function(v,N){g.setRequestHeader(N,v)}),ge.isUndefined(r.withCredentials)||(g.withCredentials=!!r.withCredentials),l&&l!=="json"&&(g.responseType=r.responseType),d&&([p,m]=ap(d,!0),g.addEventListener("progress",p)),c&&g.upload&&([h,f]=ap(c),g.upload.addEventListener("progress",h),g.upload.addEventListener("loadend",f)),(r.cancelToken||r.signal)&&(u=w=>{g&&(n(!w||w.type?new _l(null,t,g):w),g.abort(),g=null)},r.cancelToken&&r.cancelToken.subscribe(u),r.signal&&(r.signal.aborted?u():r.signal.addEventListener("abort",u)));const y=lO(r.url);if(y&&nn.protocols.indexOf(y)===-1){n(new xt("Unsupported protocol "+y+":",xt.ERR_BAD_REQUEST,t));return}g.send(i||null)})},gO=(t,e)=>{const{length:s}=t=t?t.filter(Boolean):[];if(e||s){let n=new AbortController,r;const i=function(d){if(!r){r=!0,l();const u=d instanceof Error?d:this.reason;n.abort(u instanceof xt?u:new _l(u instanceof Error?u.message:u))}};let o=e&&setTimeout(()=>{o=null,i(new xt(`timeout ${e} of ms exceeded`,xt.ETIMEDOUT))},e);const l=()=>{t&&(o&&clearTimeout(o),o=null,t.forEach(d=>{d.unsubscribe?d.unsubscribe(i):d.removeEventListener("abort",i)}),t=null)};t.forEach(d=>d.addEventListener("abort",i));const{signal:c}=n;return c.unsubscribe=()=>ge.asap(l),c}},xO=function*(t,e){let s=t.byteLength;if(s<e){yield t;return}let n=0,r;for(;n<s;)r=n+e,yield t.slice(n,r),n=r},bO=async function*(t,e){for await(const s of yO(t))yield*xO(s,e)},yO=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:s,value:n}=await e.read();if(s)break;yield n}}finally{await e.cancel()}},b2=(t,e,s,n)=>{const r=bO(t,e);let i=0,o,l=c=>{o||(o=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:d,value:u}=await r.next();if(d){l(),c.close();return}let h=u.byteLength;if(s){let p=i+=h;s(p)}c.enqueue(new Uint8Array(u))}catch(d){throw l(d),d}},cancel(c){return l(c),r.return()}},{highWaterMark:2})},lp=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",y2=lp&&typeof ReadableStream=="function",wO=lp&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),w2=(t,...e)=>{try{return!!t(...e)}catch{return!1}},vO=y2&&w2(()=>{let t=!1;const e=new Request(nn.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),v2=64*1024,xx=y2&&w2(()=>ge.isReadableStream(new Response("").body)),cp={stream:xx&&(t=>t.body)};lp&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!cp[e]&&(cp[e]=ge.isFunction(t[e])?s=>s[e]():(s,n)=>{throw new xt(`Response type '${e}' is not supported`,xt.ERR_NOT_SUPPORT,n)})})})(new Response);const NO=async t=>{if(t==null)return 0;if(ge.isBlob(t))return t.size;if(ge.isSpecCompliantForm(t))return(await new Request(nn.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(ge.isArrayBufferView(t)||ge.isArrayBuffer(t))return t.byteLength;if(ge.isURLSearchParams(t)&&(t=t+""),ge.isString(t))return(await wO(t)).byteLength},kO=async(t,e)=>{const s=ge.toFiniteNumber(t.getContentLength());return s??NO(e)},bx={http:WF,xhr:mO,fetch:lp&&(async t=>{let{url:e,method:s,data:n,signal:r,cancelToken:i,timeout:o,onDownloadProgress:l,onUploadProgress:c,responseType:d,headers:u,withCredentials:h="same-origin",fetchOptions:p}=x2(t);d=d?(d+"").toLowerCase():"text";let f=gO([r,i&&i.toAbortSignal()],o),m;const b=f&&f.unsubscribe&&(()=>{f.unsubscribe()});let g;try{if(c&&vO&&s!=="get"&&s!=="head"&&(g=await kO(u,n))!==0){let N=new Request(e,{method:"POST",body:n,duplex:"half"}),C;if(ge.isFormData(n)&&(C=N.headers.get("content-type"))&&u.setContentType(C),N.body){const[j,I]=p2(g,ap(f2(c)));n=b2(N.body,v2,j,I)}}ge.isString(h)||(h=h?"include":"omit");const x="credentials"in Request.prototype;m=new Request(e,{...p,signal:f,method:s.toUpperCase(),headers:u.normalize().toJSON(),body:n,duplex:"half",credentials:x?h:void 0});let y=await fetch(m);const w=xx&&(d==="stream"||d==="response");if(xx&&(l||w&&b)){const N={};["status","statusText","headers"].forEach(T=>{N[T]=y[T]});const C=ge.toFiniteNumber(y.headers.get("content-length")),[j,I]=l&&p2(C,ap(f2(l),!0))||[];y=new Response(b2(y.body,v2,j,()=>{I&&I(),b&&b()}),N)}d=d||"text";let v=await cp[ge.findKey(cp,d)||"text"](y,t);return!w&&b&&b(),await new Promise((N,C)=>{h2(N,C,{data:v,headers:In.from(y.headers),status:y.status,statusText:y.statusText,config:t,request:m})})}catch(x){throw b&&b(),x&&x.name==="TypeError"&&/Load failed|fetch/i.test(x.message)?Object.assign(new xt("Network Error",xt.ERR_NETWORK,t,m),{cause:x.cause||x}):xt.from(x,x&&x.code,t,m)}})};ge.forEach(bx,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const N2=t=>`- ${t}`,CO=t=>ge.isFunction(t)||t===null||t===!1,k2={getAdapter:t=>{t=ge.isArray(t)?t:[t];const{length:e}=t;let s,n;const r={};for(let i=0;i<e;i++){s=t[i];let o;if(n=s,!CO(s)&&(n=bx[(o=String(s)).toLowerCase()],n===void 0))throw new xt(`Unknown adapter '${o}'`);if(n)break;r[o||"#"+i]=n}if(!n){const i=Object.entries(r).map(([l,c])=>`adapter ${l} `+(c===!1?"is not supported by the environment":"is not available in the build"));let o=e?i.length>1?`since :
`+i.map(N2).join(`
`):" "+N2(i[0]):"as no adapter specified";throw new xt("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n},adapters:bx};function yx(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new _l(null,t)}function C2(t){return yx(t),t.headers=In.from(t.headers),t.data=gx.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),k2.getAdapter(t.adapter||Jc.adapter)(t).then(function(n){return yx(t),n.data=gx.call(t,t.transformResponse,n),n.headers=In.from(n.headers),n},function(n){return u2(n)||(yx(t),n&&n.response&&(n.response.data=gx.call(t,t.transformResponse,n.response),n.response.headers=In.from(n.response.headers))),Promise.reject(n)})}const S2="1.9.0",dp={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{dp[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const j2={};dp.transitional=function(e,s,n){function r(i,o){return"[Axios v"+S2+"] Transitional option '"+i+"'"+o+(n?". "+n:"")}return(i,o,l)=>{if(e===!1)throw new xt(r(o," has been removed"+(s?" in "+s:"")),xt.ERR_DEPRECATED);return s&&!j2[o]&&(j2[o]=!0,console.warn(r(o," has been deprecated since v"+s+" and will be removed in the near future"))),e?e(i,o,l):!0}},dp.spelling=function(e){return(s,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function SO(t,e,s){if(typeof t!="object")throw new xt("options must be an object",xt.ERR_BAD_OPTION_VALUE);const n=Object.keys(t);let r=n.length;for(;r-- >0;){const i=n[r],o=e[i];if(o){const l=t[i],c=l===void 0||o(l,i,t);if(c!==!0)throw new xt("option "+i+" must be "+c,xt.ERR_BAD_OPTION_VALUE);continue}if(s!==!0)throw new xt("Unknown option "+i,xt.ERR_BAD_OPTION)}}const up={assertOptions:SO,validators:dp},Qr=up.validators;class ha{constructor(e){this.defaults=e||{},this.interceptors={request:new a2,response:new a2}}async request(e,s){try{return await this._request(e,s)}catch(n){if(n instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(e,s){typeof e=="string"?(s=s||{},s.url=e):s=e||{},s=ua(this.defaults,s);const{transitional:n,paramsSerializer:r,headers:i}=s;n!==void 0&&up.assertOptions(n,{silentJSONParsing:Qr.transitional(Qr.boolean),forcedJSONParsing:Qr.transitional(Qr.boolean),clarifyTimeoutError:Qr.transitional(Qr.boolean)},!1),r!=null&&(ge.isFunction(r)?s.paramsSerializer={serialize:r}:up.assertOptions(r,{encode:Qr.function,serialize:Qr.function},!0)),s.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?s.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:s.allowAbsoluteUrls=!0),up.assertOptions(s,{baseUrl:Qr.spelling("baseURL"),withXsrfToken:Qr.spelling("withXSRFToken")},!0),s.method=(s.method||this.defaults.method||"get").toLowerCase();let o=i&&ge.merge(i.common,i[s.method]);i&&ge.forEach(["delete","get","head","post","put","patch","common"],m=>{delete i[m]}),s.headers=In.concat(o,i);const l=[];let c=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(s)===!1||(c=c&&b.synchronous,l.unshift(b.fulfilled,b.rejected))});const d=[];this.interceptors.response.forEach(function(b){d.push(b.fulfilled,b.rejected)});let u,h=0,p;if(!c){const m=[C2.bind(this),void 0];for(m.unshift.apply(m,l),m.push.apply(m,d),p=m.length,u=Promise.resolve(s);h<p;)u=u.then(m[h++],m[h++]);return u}p=l.length;let f=s;for(h=0;h<p;){const m=l[h++],b=l[h++];try{f=m(f)}catch(g){b.call(this,g);break}}try{u=C2.call(this,f)}catch(m){return Promise.reject(m)}for(h=0,p=d.length;h<p;)u=u.then(d[h++],d[h++]);return u}getUri(e){e=ua(this.defaults,e);const s=m2(e.baseURL,e.url,e.allowAbsoluteUrls);return o2(s,e.params,e.paramsSerializer)}}ge.forEach(["delete","get","head","options"],function(e){ha.prototype[e]=function(s,n){return this.request(ua(n||{},{method:e,url:s,data:(n||{}).data}))}}),ge.forEach(["post","put","patch"],function(e){function s(n){return function(i,o,l){return this.request(ua(l||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}ha.prototype[e]=s(),ha.prototype[e+"Form"]=s(!0)});class wx{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let s;this.promise=new Promise(function(i){s=i});const n=this;this.promise.then(r=>{if(!n._listeners)return;let i=n._listeners.length;for(;i-- >0;)n._listeners[i](r);n._listeners=null}),this.promise.then=r=>{let i;const o=new Promise(l=>{n.subscribe(l),i=l}).then(r);return o.cancel=function(){n.unsubscribe(i)},o},e(function(i,o,l){n.reason||(n.reason=new _l(i,o,l),s(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const s=this._listeners.indexOf(e);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const e=new AbortController,s=n=>{e.abort(n)};return this.subscribe(s),e.signal.unsubscribe=()=>this.unsubscribe(s),e.signal}static source(){let e;return{token:new wx(function(r){e=r}),cancel:e}}}function jO(t){return function(s){return t.apply(null,s)}}function IO(t){return ge.isObject(t)&&t.isAxiosError===!0}const vx={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(vx).forEach(([t,e])=>{vx[e]=t});function I2(t){const e=new ha(t),s=G1(ha.prototype.request,e);return ge.extend(s,ha.prototype,e,{allOwnKeys:!0}),ge.extend(s,e,null,{allOwnKeys:!0}),s.create=function(r){return I2(ua(t,r))},s}const Ae=I2(Jc);Ae.Axios=ha,Ae.CanceledError=_l,Ae.CancelToken=wx,Ae.isCancel=u2,Ae.VERSION=S2,Ae.toFormData=ip,Ae.AxiosError=xt,Ae.Cancel=Ae.CanceledError,Ae.all=function(e){return Promise.all(e)},Ae.spread=jO,Ae.isAxiosError=IO,Ae.mergeConfig=ua,Ae.AxiosHeaders=In,Ae.formToJSON=t=>c2(ge.isHTMLForm(t)?new FormData(t):t),Ae.getAdapter=k2.getAdapter,Ae.HttpStatusCode=vx,Ae.default=Ae;const E2=()=>{const[t,e]=k.useState(null),[s,n]=k.useState([]),[r,i]=k.useState("all"),[o,l]=k.useState([]),[c,d]=k.useState(null),[u,h]=k.useState(!0),[p,f]=k.useState(null),[m,b]=k.useState("main"),[g,x]=k.useState(null),[y,w]=k.useState({}),[v,N]=k.useState({}),[C,j]=k.useState(["Monday","Tuesday"]),[I,T]=k.useState({start:"09:00",end:"17:00"}),[E,$]=k.useState([]),[D,P]=k.useState(!1),[_,O]=k.useState(null),[R,X]=k.useState([]),[L,K]=k.useState([]),[B,G]=k.useState([]);k.useEffect(()=>{F(),de(),ae(),ve(),Ne()},[]);const de=async()=>{try{const S=De.get("companyId");if(!S){console.error(" Company ID not found for company details");return}const z=await Ae.get(`https://v25searchcompanywizardbackend-production.up.railway.app/api/companies/${S}/details`);console.log(" Company details fetched:",z.data.data),d(z.data.data)}catch(S){console.error(" Error fetching company details:",S)}},ae=async()=>{try{const S=await Ae.get("undefined/activities");S.data&&S.data.success&&Array.isArray(S.data.data)?(console.log(" Activities fetched:",S.data.data),X(S.data.data)):(console.warn(" Invalid activities response format"),X([]))}catch(S){console.error(" Error fetching activities:",S),X([])}},ve=async()=>{try{const S=await Ae.get("undefined/industries");S.data&&S.data.success&&Array.isArray(S.data.data)?(console.log(" Industries fetched:",S.data.data),K(S.data.data)):(console.warn(" Invalid industries response format"),K([]))}catch(S){console.error(" Error fetching industries:",S),K([])}},Ne=async()=>{try{const S=await Ae.get("undefined/languages");S.data&&S.data.success&&Array.isArray(S.data.data)?(console.log(" Languages fetched:",S.data.data),G(S.data.data)):(console.warn(" Invalid languages response format"),G([]))}catch(S){console.error(" Error fetching languages:",S),G([])}},le=S=>{if(!R||!Array.isArray(R))return S;const z=R.find(Y=>Y._id===S);return z?z.name:S},H=S=>{if(!L||!Array.isArray(L))return S;const z=L.find(Y=>Y._id===S);return z?z.name:S},ue=S=>{if(!B||!Array.isArray(B))return S;const z=B.find(Y=>Y._id===S);return z?z.name:S},F=async()=>{console.log(" Starting fetchGigs..."),h(!0),f(null);try{const S=De.get("companyId"),z=De.get("gigId"),Y=De.get("userId");if(console.log(" Cookies found:",{companyId:S,gigId:z,userId:Y}),!S)throw console.error(" Company ID not found in cookies"),new Error("Company ID not found");const Ce=`undefined/gigs/company/${S}`;console.log(" Fetching from API:",Ce);const je=await fetch(Ce,{headers:{Authorization:`Bearer ${z}:${Y}`,"Content-Type":"application/json"}});if(console.log(" API Response status:",je.status),console.log(" API Response headers:",Object.fromEntries(je.headers.entries())),!je.ok)throw console.error(" API request failed:",je.status,je.statusText),new Error("Failed to fetch gigs");const se=await je.json();if(console.log(" Raw API data:",se),se.data){console.log(" Found gigs data, transforming...");const _e=se.data.map(Ke=>{const He={_id:Ke._id,title:Ke.title,description:Ke.description,status:Ke.status||"pending",category:Ke.category,budget:Ke.commission?.baseAmount&&Ke.commission.baseAmount!=="0"?`$${Ke.commission.baseAmount}`:null,companyId:Ke.companyId,companyName:Ke.companyName||Ke.company?.name||c?.name||"Company",createdAt:Ke.createdAt,updatedAt:Ke.updatedAt,submittedBy:Ke.submittedBy||Ke.companyName||Ke.company?.name||c?.name||"Company",issues:Ke.issues||[]};return console.log(" Transformed gig:",He),He});console.log(" Setting gigs state with",_e.length,"gigs"),l(_e)}else console.warn(" No data property in API response"),l([])}catch(S){console.error(" Error fetching gigs:",S),f(S instanceof Error?S.message:"Failed to fetch gigs")}finally{console.log(" fetchGigs completed, setting loading to false"),h(!1)}},ee=S=>{console.log(" Toggling gig expansion:",S,"Current expanded:",t),e(t===S?null:S)},re=S=>{console.log(" Toggling gig selection:",S,"Currently selected:",s),s.includes(S)?n(s.filter(z=>z!==S)):n([...s,S])},te=()=>{console.log(" Selecting all gigs. Current selected:",s.length,"Total filtered:",ce.length),s.length===ce.length?n([]):n(ce.map(S=>S._id))},ce=o.filter(S=>{if(r==="all")return!0;const Y={pending:["pending","to_activate","draft","submitted"],approved:["approved","active","published"],rejected:["rejected","declined","cancelled","inactive"],archived:["archived"]}[r]||[r],Ce=Y.includes(S.status);return console.log(` Filtering gig ${S._id} (${S.title}): status="${S.status}", filter="${r}", validStatuses=${JSON.stringify(Y)}, isMatch=${Ce}`),Ce});console.log(" Filtered gigs:",{filter:r,totalGigs:o.length,filteredCount:ce.length,gigs:ce.map(S=>({id:S._id,title:S.title,status:S.status}))});const Se=S=>{if(console.log(" Formatting date:",S),!S)return console.log(" No date string provided"),"Invalid date";try{const z=new Date(S);if(isNaN(z.getTime()))return console.log(" Invalid date format"),"Invalid date";const Ce=Math.floor((new Date().getTime()-z.getTime())/(1e3*60*60));let je;if(Ce<1)je="Just now";else if(Ce<24)je=`${Ce} hours ago`;else{const se=Math.floor(Ce/24);se===1?je="1 day ago":je=`${se} days ago`}return console.log(" Formatted result:",je),je}catch(z){return console.error(" Error formatting date:",z),"Error formatting date"}},Pe=S=>{const z={to_activate:"To active",pending:"Pending",draft:"Draft",submitted:"Submitted",approved:"Approved",active:"Active",published:"Published",rejected:"Rejected",declined:"Declined",cancelled:"Cancelled",inactive:"Inactive",archived:"Archived"};return z[S]?z[S]:S.replace(/_/g," ").replace(/\b\w/g,Y=>Y.toUpperCase())},$e=async S=>{try{console.log(" Approving gig:",S);const z=De.get("companyId"),Y=De.get("userId"),Ce=De.get("gigId");if(console.log(" Auth tokens:",{companyId:z,userId:Y,gigId:Ce}),!z||!Y)throw new Error("Missing authentication tokens");const je=`undefined/gigs/${S}`;console.log(" API URL:",je);const se={status:"active"};console.log(" Request body:",se);const _e=await fetch(je,{method:"PUT",headers:{Authorization:`Bearer ${Ce}:${Y}`,"Content-Type":"application/json"},body:JSON.stringify(se)});if(console.log(" Response status:",_e.status),console.log(" Response headers:",Object.fromEntries(_e.headers.entries())),!_e.ok){const He=await _e.text();throw console.error(" API Error response:",He),new Error(`Failed to approve gig: ${_e.status} ${_e.statusText}`)}const Ke=await _e.json();console.log(" Gig approved successfully:",Ke),l(He=>He.map(gt=>gt._id===S?{...gt,status:"active"}:gt)),await rt()}catch(z){console.error(" Error approving gig:",z),f(z instanceof Error?z.message:"Failed to approve gig")}},rt=async()=>{try{const S=De.get("companyId");if(!S){console.warn("Company ID not found, cannot complete last phase and step");return}console.log(" Completing last phase and step due to active gig");const z=await fetch(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${S}/onboarding/complete-last`,{method:"PUT",headers:{"Content-Type":"application/json"}});if(z.ok){const Y=await z.json();console.log(" Last phase and step completed successfully:",Y)}else console.warn(" Failed to complete last phase and step:",z.status)}catch(S){console.error(" Error completing last phase and step:",S)}},q=async S=>{try{console.log(" Rejecting gig:",S);const z=De.get("companyId"),Y=De.get("userId"),Ce=De.get("gigId");if(console.log(" Auth tokens:",{companyId:z,userId:Y,gigId:Ce}),!z||!Y)throw new Error("Missing authentication tokens");const je=`undefined/gigs/${S}`;console.log(" API URL:",je);const se={status:"inactive"};console.log(" Request body:",se);const _e=await fetch(je,{method:"PUT",headers:{Authorization:`Bearer ${Ce}:${Y}`,"Content-Type":"application/json"},body:JSON.stringify(se)});if(console.log(" Response status:",_e.status),console.log(" Response headers:",Object.fromEntries(_e.headers.entries())),!_e.ok){const He=await _e.text();throw console.error(" API Error response:",He),new Error(`Failed to reject gig: ${_e.status} ${_e.statusText}`)}const Ke=await _e.json();console.log(" Gig rejected successfully:",Ke),l(He=>He.map(gt=>gt._id===S?{...gt,status:"inactive"}:gt)),await fe()}catch(z){console.error(" Error rejecting gig:",z),f(z instanceof Error?z.message:"Failed to reject gig")}},fe=async()=>{try{const S=De.get("companyId");if(!S){console.warn("Company ID not found, cannot check step 13 status");return}const z=o.some(Y=>Y.status==="active"||Y.status==="approved"||Y.status==="published");if(console.log(" Checking step 13 status after gig status change:",{totalGigs:o.length,hasActiveGig:z,gigStatuses:o.map(Y=>Y.status)}),!z){console.log(" No active gigs found - updating phase and step statuses");const Y=await fetch(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${S}/onboarding/phases/4/steps/13`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"in_progress"})}),Ce=await fetch(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${S}/onboarding/current-phase`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({phase:4})});Y.ok&&Ce.ok?console.log(" Step 13 and phase 4 statuses updated successfully"):console.warn(" Failed to update step 13 or phase 4 status:",{stepStatus:Y.status,phaseStatus:Ce.status})}}catch(S){console.error(" Error checking step 13 status:",S)}},Fe=async S=>{try{console.log(" Fetching skills data for gig");const z=[],Y=[],Ce=[];console.log(" Gig skills structure:",S.skills),S.skills?.professional&&S.skills.professional.forEach(se=>{console.log(" Professional skill object:",se);const _e=se.skill?.$oid||se.skill?._id||se.skill||se._id;_e?(z.push(_e),console.log(" Added professional skill ID:",_e)):console.warn(" Could not extract professional skill ID from:",se)}),S.skills?.technical&&S.skills.technical.forEach(se=>{console.log(" Technical skill object:",se);const _e=se.skill?.$oid||se.skill?._id||se.skill||se._id;_e?(Y.push(_e),console.log(" Added technical skill ID:",_e)):console.warn(" Could not extract technical skill ID from:",se)}),S.skills?.soft&&S.skills.soft.forEach(se=>{console.log(" Soft skill object:",se);const _e=se.skill?.$oid||se.skill?._id||se.skill||se._id;_e?(Ce.push(_e),console.log(" Added soft skill ID:",_e)):console.warn(" Could not extract soft skill ID from:",se)}),console.log(" Skills IDs by category:",{professional:z,technical:Y,soft:Ce});const je={};if(z.length>0)try{const se=await fetch("undefined/skills/professional");if(se.ok){const _e=se.headers.get("content-type");if(_e&&_e.includes("application/json")){const Ke=await se.json();if(console.log(" Fetched professional skills response:",Ke),Ke.success&&Ke.data&&Array.isArray(Ke.data)){const He=Ke.data;console.log(" Professional skills data:",He),z.forEach(gt=>{const Yt=He.find($i=>$i._id===gt);Yt?(je[gt]=Yt,console.log(` Matched professional skill ${gt}:`,Yt.name)):console.warn(` Professional skill ${gt} not found`)})}else console.warn(" Invalid response format for professional skills")}else console.warn(" Response is not JSON for professional skills")}else console.warn(" Failed to fetch professional skills:",se.status,se.statusText)}catch(se){console.warn(" Error fetching professional skills:",se)}if(Y.length>0)try{const se=await fetch("undefined/skills/technical");if(se.ok){const _e=se.headers.get("content-type");if(_e&&_e.includes("application/json")){const Ke=await se.json();if(console.log(" Fetched technical skills response:",Ke),Ke.success&&Ke.data&&Array.isArray(Ke.data)){const He=Ke.data;console.log(" Technical skills data:",He),Y.forEach(gt=>{const Yt=He.find($i=>$i._id===gt);Yt?(je[gt]=Yt,console.log(` Matched technical skill ${gt}:`,Yt.name)):console.warn(` Technical skill ${gt} not found`)})}else console.warn(" Invalid response format for technical skills")}else console.warn(" Response is not JSON for technical skills")}else console.warn(" Failed to fetch technical skills:",se.status,se.statusText)}catch(se){console.warn(" Error fetching technical skills:",se)}if(Ce.length>0)try{const se=await fetch("undefined/skills/soft");if(se.ok){const _e=se.headers.get("content-type");if(_e&&_e.includes("application/json")){const Ke=await se.json();if(console.log(" Fetched soft skills response:",Ke),Ke.success&&Ke.data&&Array.isArray(Ke.data)){const He=Ke.data;console.log(" Soft skills data:",He),Ce.forEach(gt=>{const Yt=He.find($i=>$i._id===gt);Yt?(je[gt]=Yt,console.log(` Matched soft skill ${gt}:`,Yt.name)):console.warn(` Soft skill ${gt} not found`)})}else console.warn(" Invalid response format for soft skills")}else console.warn(" Response is not JSON for soft skills")}else console.warn(" Failed to fetch soft skills:",se.status,se.statusText)}catch(se){console.warn(" Error fetching soft skills:",se)}w(je),console.log(" All skills data fetched and set:",je)}catch(z){console.error(" Error fetching skills data:",z)}},et=async S=>{try{console.log(" Fetching timezone data for gig");const z=S.availability?.time_zone;if(console.log(" Timezone ID from gig:",z),!z){console.log(" No timezone ID found in gig data");return}try{const Y=await fetch("undefined/timezones");if(Y.ok){const Ce=Y.headers.get("content-type");if(Ce&&Ce.includes("application/json")){const je=await Y.json();if(console.log(" Fetched timezones response:",je),je.success&&je.data&&Array.isArray(je.data)){const se=je.data;console.log(" Timezones data:",se);const _e=se.find(Ke=>Ke._id===z);_e?(N({[z]:_e}),console.log(` Matched timezone ${z}:`,_e.zoneName)):console.warn(` Timezone ${z} not found`)}else console.warn(" Invalid response format for timezones")}else console.warn(" Response is not JSON for timezones")}else console.warn(" Failed to fetch timezones:",Y.status,Y.statusText)}catch(Y){console.warn(" Error fetching timezones:",Y)}}catch(z){console.error(" Error fetching timezone data:",z)}},Me=async S=>{try{console.log(" Fetching destination zone data for gig");const z=S.destination_zone;if(console.log(" Destination zone from gig:",z),!z){console.log(" No destination zone found in gig data");return}try{const Ce=await fetch("undefined/timezones/country/FR");if(Ce.ok){const je=Ce.headers.get("content-type");if(je&&je.includes("application/json")){const se=await Ce.json();if(console.log(" Fetched destination zone timezones response:",se),se.success&&se.data&&Array.isArray(se.data)&&se.data.length>0){const _e=se.data[0];N(Ke=>({...Ke,0:_e})),console.log(" Set destination zone timezone:",_e.countryName)}else console.warn(" Invalid response format for destination zone timezones")}else console.warn(" Response is not JSON for destination zone timezones")}else console.warn(" Failed to fetch destination zone timezones:",Ce.status,Ce.statusText)}catch(Y){console.warn(" Error fetching destination zone timezones:",Y)}}catch(z){console.error(" Error fetching destination zone data:",z)}},Xe=async S=>{try{console.log(" Archiving gig:",S);const z=De.get("companyId"),Y=De.get("userId"),Ce=De.get("gigId");if(console.log(" Auth tokens:",{companyId:z,userId:Y,gigId:Ce}),!z||!Y)throw new Error("Missing authentication tokens");const je=`undefined/gigs/${S}`;console.log(" API URL:",je);const se={status:"archived"};console.log(" Request body:",se);const _e=await fetch(je,{method:"PUT",headers:{Authorization:`Bearer ${Ce}:${Y}`,"Content-Type":"application/json"},body:JSON.stringify(se)});if(console.log(" Response status:",_e.status),console.log(" Response headers:",Object.fromEntries(_e.headers.entries())),!_e.ok){const He=await _e.text();throw console.error(" API Error response:",He),new Error(`Failed to archive gig: ${_e.status} ${_e.statusText}`)}const Ke=await _e.json();console.log(" Gig archived successfully:",Ke),l(He=>He.map(gt=>gt._id===S?{...gt,status:"archived"}:gt)),await fe()}catch(z){console.error(" Error archiving gig:",z),f(z instanceof Error?z.message:"Failed to archive gig")}},it=async S=>{try{console.log(" Previewing gig:",S);const z=De.get("companyId"),Y=De.get("userId"),Ce=De.get("gigId");if(console.log(" Auth tokens:",{companyId:z,userId:Y,gigId:Ce}),!z||!Y)throw new Error("Missing authentication tokens");const je=`undefined/gigs/${S}`;console.log(" API URL:",je);const se=await fetch(je,{method:"GET",headers:{Authorization:`Bearer ${Ce}:${Y}`,"Content-Type":"application/json"}});if(console.log(" Response status:",se.status),!se.ok){const Ke=await se.text();throw console.error(" API Error response:",Ke),new Error(`Failed to fetch gig details: ${se.status} ${se.statusText}`)}const _e=await se.json();console.log(" Gig details for preview:",_e),console.log(" Date fields:",{createdAt:_e.data?.createdAt,updatedAt:_e.data?.updatedAt}),x(_e.data),await Fe(_e.data),await et(_e.data),await Me(_e.data),b("preview")}catch(z){console.error(" Error previewing gig:",z),f(z instanceof Error?z.message:"Failed to preview gig")}},Et=async S=>{try{console.log(" Editing gig:",S);const z=De.get("companyId"),Y=De.get("userId"),Ce=De.get("gigId");if(console.log(" Auth tokens:",{companyId:z,userId:Y,gigId:Ce}),!z||!Y)throw new Error("Missing authentication tokens");const je=`undefined/gigs/${S}`;console.log(" API URL:",je);const se=await fetch(je,{method:"GET",headers:{Authorization:`Bearer ${Ce}:${Y}`,"Content-Type":"application/json"}});if(console.log(" Response status:",se.status),!se.ok){const Ke=await se.text();throw console.error(" API Error response:",Ke),new Error(`Failed to fetch gig details for editing: ${se.status} ${se.statusText}`)}const _e=await se.json();console.log(" Current gig data for editing:",_e),console.log(" Date fields:",{createdAt:_e.data?.createdAt,updatedAt:_e.data?.updatedAt}),x(_e.data),await Fe(_e.data),await et(_e.data),await Me(_e.data),b("edit")}catch(z){console.error(" Error editing gig:",z),f(z instanceof Error?z.message:"Failed to edit gig")}},yt=async()=>{console.log(" Approving selected gigs:",s);for(const S of s)await $e(S);n([])},xe=async()=>{console.log(" Rejecting selected gigs:",s);for(const S of s)await q(S);n([])},Ve=()=>{b("main"),x(null)},qe=S=>{j(z=>z.includes(S)?z.filter(Y=>Y!==S):[...z,S])},We=S=>{switch(S){case"9-5":T({start:"09:00",end:"17:00"});break;case"early":T({start:"06:00",end:"14:00"});break;case"late":T({start:"14:00",end:"22:00"});break;case"evening":T({start:"18:00",end:"02:00"});break}},at=()=>{if(C.length===0)return;const S={id:Date.now(),days:[...C],startTime:I.start,endTime:I.end,displayText:`${C.join(" et ")} de ${I.start} jusqu' ${I.end}`};$(z=>[...z,S]),j(["Monday","Tuesday"]),T({start:"09:00",end:"17:00"}),P(!1)},Ct=S=>{O(S),j(S.days),T({start:S.startTime,end:S.endTime}),P(!0)},ut=()=>{if(!_||C.length===0)return;const S={..._,days:[...C],startTime:I.start,endTime:I.end,displayText:`${C.join(" et ")} de ${I.start} jusqu' ${I.end}`};$(z=>z.map(Y=>Y.id===_.id?S:Y)),O(null),j(["Monday","Tuesday"]),T({start:"09:00",end:"17:00"}),P(!1)},mt=S=>{$(z=>z.filter(Y=>Y.id!==S))},Xt=S=>{const[z,Y]=S.split(":"),Ce=parseInt(z),je=Ce>=12?"PM":"AM";return`${Ce===0?12:Ce>12?Ce-12:Ce}:${Y} ${je}`},mn=async()=>{try{const S=document.getElementById("activities"),z=document.getElementById("industries"),Y=document.getElementById("languages"),Ce=Array.from(S?.selectedOptions||[]).map(Yt=>Yt.value),je=Array.from(z?.selectedOptions||[]).map(Yt=>Yt.value),se=Array.from(Y?.selectedOptions||[]).map(Yt=>Yt.value),_e=document.getElementById("seniority_level")?.value,Ke=document.getElementById("years_experience")?.value,He={activities:Ce,industries:je,languages:se,seniority:{level:_e,yearsExperience:parseInt(Ke)||0}};console.log(" Saving gig changes:",He);const gt=await Ae.put(`undefined/gigs/${g._id}`,He,{headers:{"Content-Type":"application/json"}});gt.data.success?(console.log(" Gig updated successfully"),x({...g,...He}),b("preview")):console.error(" Failed to update gig:",gt.data.message)}catch(S){console.error(" Error saving changes:",S)}};return u?(console.log(" Rendering loading state"),a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Approval & Publishing"})}),a.jsx("div",{className:"rounded-lg bg-white shadow p-8",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto"}),a.jsx("p",{className:"mt-2 text-gray-500",children:"Loading gigs..."})]})})]})):p?(console.log(" Rendering error state:",p),a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Approval & Publishing"})}),a.jsx("div",{className:"rounded-lg bg-white shadow p-8",children:a.jsxs("div",{className:"text-center",children:[a.jsx(Oc,{className:"h-8 w-8 text-red-500 mx-auto"}),a.jsx("p",{className:"mt-2 text-red-600",children:p}),a.jsx("button",{onClick:F,className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"Retry"})]})})]})):(console.log(" Rendering main component with",o.length,"gigs"),m==="preview"&&g?a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("button",{onClick:Ve,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-900 transition-colors",children:[a.jsx(ra,{size:16}),"Back to Approval"]}),a.jsx("div",{className:"h-6 w-px bg-gray-300"}),a.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Preview: ",g.title]})]})}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:a.jsx(is,{className:"h-6 w-6 text-blue-600"})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Basic Information"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(Ys,{className:"h-4 w-4 text-blue-500"}),a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Title"})]}),a.jsx("p",{className:"text-sm text-gray-900 font-medium",children:g.title})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(jr,{className:"h-4 w-4 text-purple-500"}),a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Category"})]}),a.jsx("p",{className:"text-sm text-gray-900 font-medium",children:g.category||"Not specified"})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(Tr,{className:"h-4 w-4 text-green-500"}),a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Status"})]}),a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${g.status==="active"||g.status==="approved"?"bg-green-100 text-green-800":g.status==="pending"||g.status==="to_activate"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:g.status})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(Ks,{className:"h-4 w-4 text-indigo-500"}),a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Destination Zone"})]}),a.jsx("p",{className:"text-sm text-gray-900 font-medium",children:v[0]?.countryName||g.destination_zone||"Not specified"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(Ai,{className:"h-4 w-4 text-orange-500"}),a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Company"})]}),a.jsx("p",{className:"text-sm text-gray-900 font-medium",children:g.companyName||c?.name||"Not specified"})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(Er,{className:"h-4 w-4 text-emerald-500"}),a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Created"})]}),a.jsx("p",{className:"text-sm text-gray-900 font-medium",children:g.createdAt?Se(g.createdAt):"Not available"})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(St,{className:"h-4 w-4 text-cyan-500"}),a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Updated"})]}),a.jsx("p",{className:"text-sm text-gray-900 font-medium",children:g.updatedAt?Se(g.updatedAt):"Not available"})]})]})]}),a.jsxs("div",{className:"mt-6 bg-white rounded-lg p-4 border border-blue-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(is,{className:"h-4 w-4 text-blue-500"}),a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Description"})]}),a.jsx("p",{className:"text-sm text-gray-900 leading-relaxed",children:g.description})]})]}),a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-green-50 to-emerald-50 border border-green-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:a.jsx(Ys,{className:"h-6 w-6 text-green-600"})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Activities & Industries"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-green-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Tr,{className:"h-4 w-4 text-green-500"}),a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Activities"})]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:g.activities?.map((S,z)=>a.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-green-100 to-emerald-100 text-green-800 border border-green-200",children:S?.name||le(S)},z))||a.jsx("span",{className:"text-sm text-gray-500 italic",children:"No activities specified"})})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-green-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Ai,{className:"h-4 w-4 text-emerald-500"}),a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Industries"})]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:g.industries?.map((S,z)=>a.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-emerald-100 to-teal-100 text-emerald-800 border border-emerald-200",children:S?.name||H(S)},z))||a.jsx("span",{className:"text-sm text-gray-500 italic",children:"No industries specified"})})]})]})]}),a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-purple-50 to-violet-50 border border-purple-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:a.jsx(jr,{className:"h-6 w-6 text-purple-600"})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Seniority Requirements"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-purple-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(Ys,{className:"h-4 w-4 text-purple-500"}),a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Level"})]}),a.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-purple-100 to-violet-100 text-purple-800 border border-purple-200",children:g.seniority?.level||"Not specified"})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-purple-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(St,{className:"h-4 w-4 text-violet-500"}),a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Years of Experience"})]}),a.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-violet-100 to-purple-100 text-violet-800 border border-violet-200",children:g.seniority?.yearsExperience||"Not specified"})]})]})]}),a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-orange-50 to-amber-50 border border-orange-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:a.jsx(jr,{className:"h-6 w-6 text-orange-600"})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Skills & Languages"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-orange-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Ys,{className:"h-4 w-4 text-purple-500"}),a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Professional Skills"})]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:g.skills?.professional?.map((S,z)=>{const Y=S?.skill?.name||y[S?.skill?._id]?.name||`Skill ${S?.skill?._id||"Unknown"}`;return a.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-purple-100 to-violet-100 text-purple-800 border border-purple-200",children:[Y," (Level ",S?.level||"N/A",")"]},z)})||a.jsx("span",{className:"text-sm text-gray-500 italic",children:"No professional skills specified"})})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-orange-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Qn,{className:"h-4 w-4 text-orange-500"}),a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Technical Skills"})]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:g.skills?.technical?.map((S,z)=>{const Y=S?.skill?.name||y[S?.skill?._id]?.name||`Skill ${S?.skill?._id||"Unknown"}`;return a.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-orange-100 to-amber-100 text-orange-800 border border-orange-200",children:[Y," (Level ",S?.level||"N/A",")"]},z)})||a.jsx("span",{className:"text-sm text-gray-500 italic",children:"No technical skills specified"})})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-orange-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(tr,{className:"h-4 w-4 text-pink-500"}),a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Soft Skills"})]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:g.skills?.soft?.map((S,z)=>{const Y=S?.skill?.name||y[S?.skill?._id]?.name||`Skill ${S?.skill?._id||"Unknown"}`;return a.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-pink-100 to-rose-100 text-pink-800 border border-pink-200",children:[Y," (Level ",S?.level||"N/A",")"]},z)})||a.jsx("span",{className:"text-sm text-gray-500 italic",children:"No soft skills specified"})})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-orange-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Ks,{className:"h-4 w-4 text-indigo-500"}),a.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Languages"})]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:g.skills?.languages?.map((S,z)=>a.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-indigo-100 to-blue-100 text-indigo-800 border border-indigo-200",children:[S?.language?.name||ue(S?.language)," (",S?.proficiency||"N/A",")"]},z))||a.jsx("span",{className:"text-sm text-gray-500 italic",children:"No languages specified"})})]})]})]}),a.jsxs("div",{className:"rounded-lg bg-white shadow p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Schedule & Availability"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Time Zone:"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:(()=>{const S=g.availability?.time_zone;if(S&&typeof S=="object")return`${S.zoneName} (${S.countryName})`;const z=v[S];return z?`${z.zoneName} (${z.countryName})`:S||"Not specified"})()})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Flexibility:"}),a.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:g.availability?.flexibility?.map((S,z)=>a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:S},z))||a.jsx("span",{className:"text-sm text-gray-500",children:"No flexibility options specified"})})]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Weekly Schedule:"}),a.jsx("div",{className:"mt-2 space-y-2",children:g.availability?.schedule?.map((S,z)=>a.jsxs("div",{className:"flex justify-between items-center py-2 px-3 bg-gray-50 rounded-md",children:[a.jsx("span",{className:"text-sm font-medium text-gray-900",children:S?.day||"Unknown"}),a.jsxs("span",{className:"text-sm text-gray-600",children:[S?.hours?.start||"N/A"," - ",S?.hours?.end||"N/A"]})]},z))||a.jsx("span",{className:"text-sm text-gray-500",children:"No schedule specified"})})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Minimum Hours (Daily):"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:g.availability?.minimumHours?.daily||"Not specified"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Minimum Hours (Weekly):"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:g.availability?.minimumHours?.weekly||"Not specified"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Minimum Hours (Monthly):"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:g.availability?.minimumHours?.monthly||"Not specified"})]})]})]})]}),a.jsxs("div",{className:"rounded-lg bg-white shadow p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Commission & Compensation"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Base:"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:g.commission?.base||"Not specified"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Base Amount:"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:g.commission?.baseAmount?`${g.commission.baseAmount} ${g.commission.currency?.symbol||""}`:"Not specified"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Bonus:"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:g.commission?.bonus||"Not specified"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Bonus Amount:"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:g.commission?.bonusAmount?`${g.commission.bonusAmount} ${g.commission.currency?.symbol||""}`:"Not specified"})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Transaction Commission:"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:g.commission?.transactionCommission?.type||"Not specified"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Commission Amount:"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:g.commission?.transactionCommission?.amount?`${g.commission.transactionCommission.amount} ${g.commission?.currency?.symbol||""}`:"Not specified"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Minimum Volume:"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:g.commission?.minimumVolume?.amount?`${g.commission.minimumVolume.amount} ${g.commission.minimumVolume.unit} ${g.commission.minimumVolume.period}`:"Not specified"})]})]}),g.commission?.additionalDetails&&a.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Additional Details:"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:g.commission.additionalDetails})]})]})]}),a.jsxs("div",{className:"rounded-lg bg-white shadow p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Team Structure"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Team Size:"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:g.team?.size||"Not specified"})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Territories:"}),a.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:g.team?.territories?.map((S,z)=>a.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[S.flags&&a.jsx("img",{src:S.flags.png,alt:S.flags.alt,className:"w-3 h-2 rounded-sm"}),S.name?.common||S]},z))||a.jsx("span",{className:"text-sm text-gray-500",children:"No territories specified"})})]})]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Team Structure:"}),a.jsx("div",{className:"mt-2 space-y-2",children:g.team?.structure?.map((S,z)=>a.jsxs("div",{className:"flex justify-between items-center py-2 px-3 bg-gray-50 rounded-md",children:[a.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[S?.roleId||"Unknown"," (",S?.count||0,")"]}),a.jsxs("span",{className:"text-sm text-gray-600",children:[S?.seniority?.level||"N/A"," - ",S?.seniority?.yearsExperience||"N/A"," years"]})]},z))||a.jsx("span",{className:"text-sm text-gray-500",children:"No team structure specified"})})]})]})]}),g.issues&&g.issues.length>0&&a.jsxs("div",{className:"rounded-lg bg-yellow-50 border border-yellow-200 p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-yellow-800 mb-4",children:"Issues Requiring Attention"}),a.jsx("ul",{className:"list-disc space-y-1 pl-5 text-sm text-yellow-700",children:g.issues.map((S,z)=>a.jsx("li",{children:S},z))})]})]})]}):m==="edit"&&g?a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("button",{onClick:Ve,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-900 transition-colors",children:[a.jsx(ra,{size:16}),"Back to Approval"]}),a.jsx("div",{className:"h-6 w-px bg-gray-300"}),a.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Edit: ",g.title]})]})}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:a.jsx(is,{className:"h-6 w-6 text-blue-600"})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Basic Information"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Ys,{className:"h-4 w-4 text-blue-500"}),a.jsx("label",{htmlFor:"title",className:"text-sm font-semibold text-gray-700",children:"Gig Title"})]}),a.jsx("input",{type:"text",id:"title",defaultValue:g.title,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter gig title"})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(is,{className:"h-4 w-4 text-blue-500"}),a.jsx("label",{htmlFor:"description",className:"text-sm font-semibold text-gray-700",children:"Description"})]}),a.jsx("textarea",{id:"description",rows:4,defaultValue:g.description,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter gig description"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(jr,{className:"h-4 w-4 text-purple-500"}),a.jsx("label",{htmlFor:"category",className:"text-sm font-semibold text-gray-700",children:"Category"})]}),a.jsx("input",{type:"text",id:"category",defaultValue:g.category,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter category"})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Ks,{className:"h-4 w-4 text-indigo-500"}),a.jsx("label",{htmlFor:"destination_zone",className:"text-sm font-semibold text-gray-700",children:"Destination Zone"})]}),a.jsx("input",{type:"text",id:"destination_zone",defaultValue:g.destination_zone,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter destination zone"}),v[0]&&a.jsxs("p",{className:"mt-2 text-xs text-gray-500 bg-gray-50 px-2 py-1 rounded",children:["Country: ",v[0].countryName]})]})]})]})]}),a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-green-50 to-emerald-50 border border-green-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:a.jsx(Ys,{className:"h-6 w-6 text-green-600"})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Activities & Industries"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-green-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Tr,{className:"h-4 w-4 text-green-500"}),a.jsx("label",{htmlFor:"activities",className:"text-sm font-semibold text-gray-700",children:"Activities"})]}),a.jsx("select",{id:"activities",multiple:!0,defaultValue:g.activities||[],className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 min-h-[120px]",children:R.map(S=>a.jsxs("option",{value:S._id,children:[S.name," - ",S.category]},S._id))}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Hold Ctrl/Cmd to select multiple activities"})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-green-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Ai,{className:"h-4 w-4 text-emerald-500"}),a.jsx("label",{htmlFor:"industries",className:"text-sm font-semibold text-gray-700",children:"Industries"})]}),a.jsx("select",{id:"industries",multiple:!0,defaultValue:g.industries||[],className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 min-h-[120px]",children:L.map(S=>a.jsx("option",{value:S._id,children:S.name},S._id))}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Hold Ctrl/Cmd to select multiple industries"})]})]})]}),a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-purple-50 to-violet-50 border border-purple-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:a.jsx(jr,{className:"h-6 w-6 text-purple-600"})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Seniority Requirements"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-purple-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Ys,{className:"h-4 w-4 text-purple-500"}),a.jsx("label",{htmlFor:"seniority_level",className:"text-sm font-semibold text-gray-700",children:"Seniority Level"})]}),a.jsxs("select",{id:"seniority_level",defaultValue:g.seniority?.level,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[a.jsx("option",{value:"",children:"Select level"}),a.jsx("option",{value:"Entry-Level",children:"Entry-Level"}),a.jsx("option",{value:"Mid-Level",children:"Mid-Level"}),a.jsx("option",{value:"Senior",children:"Senior"}),a.jsx("option",{value:"Expert",children:"Expert"})]})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-purple-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(St,{className:"h-4 w-4 text-violet-500"}),a.jsx("label",{htmlFor:"years_experience",className:"text-sm font-semibold text-gray-700",children:"Years of Experience"})]}),a.jsx("input",{type:"number",id:"years_experience",defaultValue:g.seniority?.yearsExperience,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Enter years of experience"})]})]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:a.jsx(Gg,{className:"h-6 w-6 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Base Commission"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Set the fixed base rate and requirements"})]})]}),a.jsx("div",{className:"grid grid-cols-1 gap-6",children:a.jsxs("div",{children:[a.jsx("label",{htmlFor:"commission_per_call",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Per call compensation"}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),a.jsx("input",{type:"number",id:"commission_per_call",step:"0.01",defaultValue:g.commission?.commission_per_call,className:"w-full pl-8 pr-3 py-2 border border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter amount per call"})]})]})}),a.jsxs("div",{className:"mt-6 bg-white rounded-lg p-4 border border-blue-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx(Ys,{className:"h-4 w-4 text-blue-500"}),a.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Minimum Requirements"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"target_amount",className:"block text-xs font-medium text-gray-500 mb-1",children:"Target Amount"}),a.jsx("input",{type:"number",id:"target_amount",defaultValue:g.commission?.minimumVolume?.amount,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter target"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"unit_type",className:"block text-xs font-medium text-gray-500 mb-1",children:"Unit"}),a.jsxs("select",{id:"unit_type",defaultValue:g.commission?.minimumVolume?.unit,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"Select unit"}),a.jsx("option",{value:"Calls",children:"Calls"}),a.jsx("option",{value:"Sales",children:"Sales"}),a.jsx("option",{value:"Transactions",children:"Transactions"})]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"period",className:"block text-xs font-medium text-gray-500 mb-1",children:"Period"}),a.jsxs("select",{id:"period",defaultValue:g.commission?.minimumVolume?.period,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"Select period"}),a.jsx("option",{value:"Daily",children:"Daily"}),a.jsx("option",{value:"Weekly",children:"Weekly"}),a.jsx("option",{value:"Monthly",children:"Monthly"})]})]})]})]})]}),a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-purple-50 to-violet-50 border border-purple-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:a.jsx(Tr,{className:"h-6 w-6 text-purple-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Transaction Commission"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Define per-transaction rewards"})]})]}),a.jsx("div",{className:"grid grid-cols-1 gap-6",children:a.jsxs("div",{children:[a.jsx("label",{htmlFor:"transaction_commission",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Commission Amount"}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),a.jsx("input",{type:"number",id:"transaction_commission",step:"0.01",defaultValue:g.commission?.transactionCommission,className:"w-full pl-8 pr-3 py-2 border border-purple-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Enter amount"})]})]})})]}),a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-amber-50 to-yellow-50 border border-amber-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"p-2 bg-amber-100 rounded-lg",children:a.jsx(jr,{className:"h-6 w-6 text-amber-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Performance Bonus"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Set additional performance-based rewards"})]})]}),a.jsx("div",{className:"grid grid-cols-1 gap-6",children:a.jsxs("div",{children:[a.jsx("label",{htmlFor:"bonus_amount",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Bonus Amount"}),a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:a.jsx("span",{className:"text-gray-500 sm:text-sm",children:"$"})}),a.jsx("input",{type:"text",id:"bonus_amount",defaultValue:g.commission?.bonusAmount,className:"w-full pl-8 pr-3 py-2 border border-amber-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-amber-500",placeholder:"Enter bonus amount"})]})]})})]}),a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-gray-50 to-slate-50 border border-gray-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:a.jsx(Ks,{className:"h-6 w-6 text-gray-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Currency Settings"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Select the currency for all commission calculations"})]})]}),a.jsxs("div",{className:"max-w-md",children:[a.jsx("label",{htmlFor:"currency",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Currency"}),a.jsxs("select",{id:"currency",defaultValue:g.commission?.currency?.$oid||"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500",children:[a.jsx("option",{value:"",children:"Select currency"}),a.jsx("option",{value:"EUR",children:"EUR ()"}),a.jsx("option",{value:"USD",children:"USD ($)"}),a.jsx("option",{value:"GBP",children:"GBP ()"}),a.jsx("option",{value:"CAD",children:"CAD (C$)"}),a.jsx("option",{value:"AUD",children:"AUD (A$)"})]})]})]})]}),a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"p-2 bg-pink-100 rounded-lg",children:a.jsx(tr,{className:"h-6 w-6 text-pink-600"})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Team Structure"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-pink-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(tr,{className:"h-4 w-4 text-pink-500"}),a.jsx("label",{htmlFor:"team_size",className:"text-sm font-semibold text-gray-700",children:"Team Size"})]}),a.jsx("input",{type:"number",id:"team_size",defaultValue:g.team?.size,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-pink-500",placeholder:"Enter team size"})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-pink-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Zr,{className:"h-4 w-4 text-rose-500"}),a.jsx("label",{htmlFor:"territories",className:"text-sm font-semibold text-gray-700",children:"Territories"})]}),a.jsx("input",{type:"text",id:"territories",defaultValue:g.team?.territories?.map(S=>S.name?.common||S).join(", "),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-pink-500",placeholder:"Enter territories (comma separated)"})]})]})]}),a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-cyan-50 to-blue-50 border border-cyan-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"p-2 bg-cyan-100 rounded-lg",children:a.jsx(St,{className:"h-6 w-6 text-cyan-600"})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Schedule & Availability"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-cyan-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Ks,{className:"h-4 w-4 text-cyan-500"}),a.jsx("label",{htmlFor:"timezone",className:"text-sm font-semibold text-gray-700",children:"Time Zone"})]}),a.jsx("input",{type:"text",id:"timezone",defaultValue:g.availability?.time_zone?.zoneName||g.availability?.time_zone||"",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500",placeholder:"Enter timezone"})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-cyan-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Qn,{className:"h-4 w-4 text-blue-500"}),a.jsx("label",{htmlFor:"flexibility",className:"text-sm font-semibold text-gray-700",children:"Flexibility"})]}),a.jsx("input",{type:"text",id:"flexibility",defaultValue:g.availability?.flexibility?.join(", "),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500",placeholder:"Enter flexibility options (comma separated)"})]})]}),a.jsxs("div",{className:"bg-white rounded-lg p-6 border border-cyan-100",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Working Days"}),a.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(S=>a.jsx("button",{onClick:()=>qe(S),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${C.includes(S)?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:S},S))}),a.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx(St,{className:"h-4 w-4 text-blue-500"}),a.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:"Working Hours"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(Ai,{className:"h-4 w-4 text-orange-500"}),a.jsx("label",{className:"text-xs font-medium text-gray-500",children:"Start Time"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-lg font-bold text-gray-900",children:I.start}),a.jsx(St,{className:"h-4 w-4 text-gray-400"})]})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(Ai,{className:"h-4 w-4 text-purple-500"}),a.jsx("label",{className:"text-xs font-medium text-gray-500",children:"End Time"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-lg font-bold text-gray-900",children:I.end}),a.jsx(St,{className:"h-4 w-4 text-gray-400"})]})]})]}),a.jsxs("div",{className:"bg-gray-100 rounded-lg px-3 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Working Hours:"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("span",{className:"text-sm font-bold text-gray-900",children:[Xt(I.start)," - ",Xt(I.end)]}),a.jsx(St,{className:"h-4 w-4 text-gray-400"})]})]}),a.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[a.jsxs("button",{onClick:()=>We("9-5"),className:"flex flex-col items-center p-3 rounded-lg border border-gray-200 hover:border-orange-300 hover:bg-orange-50 transition-colors",children:[a.jsx(y4,{className:"h-5 w-5 text-orange-500 mb-1"}),a.jsx("span",{className:"text-xs font-medium text-gray-700",children:"9-5"})]}),a.jsxs("button",{onClick:()=>We("early"),className:"flex flex-col items-center p-3 rounded-lg border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-colors",children:[a.jsx(w4,{className:"h-5 w-5 text-blue-500 mb-1"}),a.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Early"})]}),a.jsxs("button",{onClick:()=>We("late"),className:"flex flex-col items-center p-3 rounded-lg border border-gray-200 hover:border-purple-300 hover:bg-purple-50 transition-colors",children:[a.jsx(St,{className:"h-5 w-5 text-purple-500 mb-1"}),a.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Late"})]}),a.jsxs("button",{onClick:()=>We("evening"),className:"flex flex-col items-center p-3 rounded-lg border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-colors",children:[a.jsx(m4,{className:"h-5 w-5 text-blue-600 mb-1"}),a.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Evening"})]})]}),a.jsx("div",{className:"mt-4 flex gap-2",children:_?a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:ut,className:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors",children:"Update Schedule"}),a.jsx("button",{onClick:()=>{O(null),j(["Monday","Tuesday"]),T({start:"09:00",end:"17:00"}),P(!1)},className:"px-4 py-2 bg-gray-500 text-white rounded-lg text-sm font-medium hover:bg-gray-600 transition-colors",children:"Cancel"})]}):a.jsx("button",{onClick:at,className:"px-4 py-2 bg-green-600 text-white rounded-lg text-sm font-medium hover:bg-green-700 transition-colors",children:"Add Schedule"})})]})]}),E.length>0&&a.jsxs("div",{className:"mt-6 bg-white rounded-lg p-4 border border-cyan-100",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Current Schedules"}),a.jsx("div",{className:"space-y-3",children:E.map(S=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(St,{className:"h-4 w-4 text-cyan-500"}),a.jsx("span",{className:"text-sm font-medium text-gray-900",children:S.displayText})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>Ct(S),className:"p-1 text-blue-600 hover:bg-blue-50 rounded",children:a.jsx(po,{className:"h-4 w-4"})}),a.jsx("button",{onClick:()=>mt(S.id),className:"p-1 text-red-600 hover:bg-red-50 rounded",children:a.jsx(er,{className:"h-4 w-4"})})]})]},S.id))})]}),a.jsxs("div",{className:"mt-6 bg-white rounded-lg p-4 border border-cyan-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx(St,{className:"h-4 w-4 text-cyan-500"}),a.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Minimum Hours"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"min_hours_daily",className:"block text-xs font-medium text-gray-500 mb-1",children:"Daily"}),a.jsx("input",{type:"number",id:"min_hours_daily",defaultValue:g.availability?.minimumHours?.daily,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Hours"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"min_hours_weekly",className:"block text-xs font-medium text-gray-500 mb-1",children:"Weekly"}),a.jsx("input",{type:"number",id:"min_hours_weekly",defaultValue:g.availability?.minimumHours?.weekly,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Hours"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"min_hours_monthly",className:"block text-xs font-medium text-gray-500 mb-1",children:"Monthly"}),a.jsx("input",{type:"number",id:"min_hours_monthly",defaultValue:g.availability?.minimumHours?.monthly,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-cyan-500",placeholder:"Hours"})]})]})]})]}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsx("button",{type:"button",onClick:Ve,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),a.jsx("button",{type:"button",onClick:mn,className:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700",children:"Save Changes"})]})]})]}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"flex items-center gap-4",children:a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Approval & Publishing"})}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("button",{className:`rounded-lg px-4 py-2 ${s.length>0?"bg-green-600 text-white hover:bg-green-700":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,disabled:s.length===0,onClick:yt,children:"Approve Selected"}),a.jsx("button",{className:`rounded-lg px-4 py-2 ${s.length>0?"bg-red-600 text-white hover:bg-red-700":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,disabled:s.length===0,onClick:xe,children:"Reject Selected"})]})]}),a.jsxs("div",{className:"flex space-x-1 rounded-lg bg-white p-1 shadow",children:[a.jsx("button",{className:`flex-1 rounded-md py-2 text-sm font-medium ${r==="all"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:bg-gray-100"}`,onClick:()=>{console.log(" Filter changed to: all"),i("all")},children:"All"}),a.jsx("button",{className:`flex-1 rounded-md py-2 text-sm font-medium ${r==="approved"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:bg-gray-100"}`,onClick:()=>{console.log(" Filter changed to: approved"),i("approved")},children:"Active"}),a.jsx("button",{className:`flex-1 rounded-md py-2 text-sm font-medium ${r==="rejected"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:bg-gray-100"}`,onClick:()=>{console.log(" Filter changed to: rejected"),i("rejected")},children:"Inactive"}),a.jsx("button",{className:`flex-1 rounded-md py-2 text-sm font-medium ${r==="archived"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:bg-gray-100"}`,onClick:()=>{console.log(" Filter changed to: archived"),i("archived")},children:"Archived"})]}),a.jsxs("div",{className:"rounded-lg bg-white shadow",children:[a.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 p-4",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("button",{onClick:te,children:s.length===ce.length&&ce.length>0?a.jsx(Zv,{className:"h-5 w-5 text-indigo-600"}):a.jsx(d1,{className:"h-5 w-5 text-gray-400"})}),a.jsxs("span",{className:"font-medium text-gray-700",children:[s.length," of ",ce.length," selected"]})]}),a.jsxs("div",{className:"text-sm text-gray-500",children:[ce.filter(S=>S.status==="pending").length," pending approval"]})]}),ce.length===0?a.jsx("div",{className:"p-8 text-center",children:a.jsx("p",{className:"text-gray-500",children:"No gigs found matching the current filter."})}):a.jsx("div",{className:"divide-y divide-gray-200",children:ce.map(S=>a.jsxs("div",{className:"hover:bg-gray-50",children:[a.jsxs("div",{className:"flex items-center p-4",children:[a.jsx("div",{className:"mr-3",children:a.jsx("button",{onClick:()=>re(S._id),children:s.includes(S._id)?a.jsx(Zv,{className:"h-5 w-5 text-indigo-600"}):a.jsx(d1,{className:"h-5 w-5 text-gray-400"})})}),a.jsxs("div",{className:"flex flex-1 cursor-pointer items-center justify-between",onClick:()=>ee(S._id),children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"h-10 w-10 flex-shrink-0 rounded-full bg-indigo-100 flex items-center justify-center",children:a.jsx(Ir,{className:"h-6 w-6 text-indigo-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-base font-medium text-gray-900",children:S.title}),a.jsxs("p",{className:"text-sm text-gray-500",children:[S.category||"No category",S.budget&&`  ${S.budget}`]})]})]}),a.jsxs("div",{className:"flex items-center space-x-4",children:[(S.status==="pending"||S.status==="to_activate"||S.status==="draft"||S.status==="submitted")&&a.jsxs("span",{className:"inline-flex items-center rounded-full bg-yellow-100 px-2.5 py-0.5 text-xs font-medium text-yellow-800",children:[a.jsx(St,{className:"mr-1 h-3 w-3"}),S.status==="to_activate"?"To active":Pe(S.status)]}),(S.status==="approved"||S.status==="active"||S.status==="published")&&a.jsxs("span",{className:"inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800",children:[a.jsx(ht,{className:"mr-1 h-3 w-3"}),Pe(S.status)]}),(S.status==="rejected"||S.status==="declined"||S.status==="cancelled"||S.status==="inactive")&&a.jsxs("span",{className:"inline-flex items-center rounded-full bg-red-100 px-2.5 py-0.5 text-xs font-medium text-red-800",children:[a.jsx(fo,{className:"mr-1 h-3 w-3"}),Pe(S.status)]}),S.status==="archived"&&a.jsxs("span",{className:"inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800",children:[a.jsx(St,{className:"mr-1 h-3 w-3"}),Pe(S.status)]}),t===S._id?a.jsx(Lc,{className:"h-5 w-5 text-gray-400"}):a.jsx(Cl,{className:"h-5 w-5 text-gray-400"})]})]})]}),t===S._id&&a.jsxs("div",{className:"border-t border-gray-100 bg-gray-50 p-4",children:[a.jsxs("div",{className:"mb-4 grid grid-cols-1 gap-4 sm:grid-cols-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium text-gray-500",children:"Company"}),a.jsx("p",{className:"text-sm font-medium text-gray-900",children:c?.name||S.submittedBy||"Company"})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium text-gray-500",children:"Created"}),a.jsx("p",{className:"text-sm font-medium text-gray-900",children:Se(S.createdAt)})]}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-medium text-gray-500",children:"Status"}),a.jsx("p",{className:"text-sm font-medium text-gray-900 capitalize",children:S.status})]})]}),S.description&&a.jsxs("div",{className:"mb-4",children:[a.jsx("p",{className:"text-xs font-medium text-gray-500",children:"Description"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:S.description})]}),S.issues&&S.issues.length>0&&a.jsx("div",{className:"mb-4 rounded-md bg-yellow-50 p-3",children:a.jsxs("div",{className:"flex",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(Oc,{className:"h-5 w-5 text-yellow-400"})}),a.jsxs("div",{className:"ml-3",children:[a.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Issues Requiring Attention"}),a.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:a.jsx("ul",{className:"list-disc space-y-1 pl-5",children:S.issues.map((z,Y)=>a.jsx("li",{children:z},Y))})})]})]})}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsxs("button",{onClick:()=>it(S._id),className:"inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:[a.jsx(Bc,{className:"mr-2 h-4 w-4"}),"Preview"]}),a.jsxs("button",{onClick:()=>Et(S._id),className:"inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:[a.jsx(po,{className:"mr-2 h-4 w-4"}),"Edit"]}),a.jsxs("button",{className:"inline-flex items-center rounded-md border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:[a.jsx(o1,{className:"mr-2 h-4 w-4"}),"Comment"]}),(S.status==="pending"||S.status==="to_activate"||S.status==="draft"||S.status==="submitted")&&a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:()=>$e(S._id),className:"inline-flex items-center rounded-md bg-green-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-green-700",children:[a.jsx(ht,{className:"mr-2 h-4 w-4"}),"Active"]}),a.jsxs("button",{onClick:()=>q(S._id),className:"inline-flex items-center rounded-md bg-red-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-red-700",children:[a.jsx(fo,{className:"mr-2 h-4 w-4"}),"Inactive"]}),a.jsxs("button",{onClick:()=>Xe(S._id),className:"inline-flex items-center rounded-md bg-gray-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-gray-700",children:[a.jsx(St,{className:"mr-2 h-4 w-4"}),"Archived"]})]}),(S.status==="approved"||S.status==="active"||S.status==="published")&&a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:()=>q(S._id),className:"inline-flex items-center rounded-md bg-red-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-red-700",children:[a.jsx(fo,{className:"mr-2 h-4 w-4"}),"Inactive"]}),a.jsxs("button",{onClick:()=>Xe(S._id),className:"inline-flex items-center rounded-md bg-gray-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-gray-700",children:[a.jsx(St,{className:"mr-2 h-4 w-4"}),"Archived"]})]}),(S.status==="rejected"||S.status==="declined"||S.status==="cancelled"||S.status==="inactive")&&a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:()=>$e(S._id),className:"inline-flex items-center rounded-md bg-green-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-green-700",children:[a.jsx(ht,{className:"mr-2 h-4 w-4"}),"Active"]}),a.jsxs("button",{onClick:()=>Xe(S._id),className:"inline-flex items-center rounded-md bg-gray-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-gray-700",children:[a.jsx(St,{className:"mr-2 h-4 w-4"}),"Archived"]})]}),S.status==="archived"&&a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:()=>$e(S._id),className:"inline-flex items-center rounded-md bg-green-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-green-700",children:[a.jsx(ht,{className:"mr-2 h-4 w-4"}),"Active"]}),a.jsxs("button",{onClick:()=>q(S._id),className:"inline-flex items-center rounded-md bg-red-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-red-700",children:[a.jsx(fo,{className:"mr-2 h-4 w-4"}),"Inactive"]})]})]})]})]},S._id))})]})]}))},EO=()=>{const[t,e]=k.useState(1),[s,n]=k.useState("30d"),r=[{id:1,title:"Web Development Project",client:"XYZ Corp",views:245,applications:18,conversionRate:"7.3%",trend:"up",trendValue:"+12%",suggestions:[{type:"high",text:"Add more specific technical requirements to attract qualified candidates"},{type:"medium",text:"Include information about the development team structure"},{type:"low",text:"Consider increasing the budget range to attract more senior developers"}]},{id:2,title:"Digital Marketing Campaign",client:"ABC Inc",views:187,applications:9,conversionRate:"4.8%",trend:"down",trendValue:"-5%",suggestions:[{type:"high",text:"Specify target audience demographics and platforms"},{type:"high",text:"Include examples of successful campaigns you admire"},{type:"medium",text:"Add KPIs and success metrics to the description"}]},{id:3,title:"Mobile App Development",client:"Tech Startup",views:312,applications:24,conversionRate:"7.7%",trend:"up",trendValue:"+18%",suggestions:[{type:"medium",text:"Clarify whether this is for iOS, Android, or both platforms"},{type:"low",text:"Add information about the app's target user base"}]}],i=o=>{e(t===o?null:o)};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Optimization & Performance"}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs("select",{className:"rounded-md border-gray-300 py-2 pl-3 pr-10 text-base focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm",value:s,onChange:o=>n(o.target.value),children:[a.jsx("option",{value:"7d",children:"Last 7 days"}),a.jsx("option",{value:"30d",children:"Last 30 days"}),a.jsx("option",{value:"90d",children:"Last 90 days"}),a.jsx("option",{value:"all",children:"All time"})]}),a.jsx("button",{className:"rounded-lg bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700",children:a.jsx($r,{className:"h-5 w-5"})})]})]}),a.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[a.jsxs("div",{className:"rounded-lg bg-white p-4 shadow",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Gigs"}),a.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:"24"})]}),a.jsx("div",{className:"rounded-full bg-indigo-100 p-3 text-indigo-600",children:a.jsx(Ir,{className:"h-6 w-6"})})]}),a.jsxs("div",{className:"mt-4 flex items-center text-sm",children:[a.jsx(Tr,{className:"h-4 w-4 text-green-500"}),a.jsx("span",{className:"ml-1 text-green-500",children:"+8%"}),a.jsx("span",{className:"ml-1 text-gray-500",children:"from last period"})]})]}),a.jsxs("div",{className:"rounded-lg bg-white p-4 shadow",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Views"}),a.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:"3,842"})]}),a.jsx("div",{className:"rounded-full bg-indigo-100 p-3 text-indigo-600",children:a.jsx(Wg,{className:"h-6 w-6"})})]}),a.jsxs("div",{className:"mt-4 flex items-center text-sm",children:[a.jsx(Tr,{className:"h-4 w-4 text-green-500"}),a.jsx("span",{className:"ml-1 text-green-500",children:"+15%"}),a.jsx("span",{className:"ml-1 text-gray-500",children:"from last period"})]})]}),a.jsxs("div",{className:"rounded-lg bg-white p-4 shadow",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Applications"}),a.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:"267"})]}),a.jsx("div",{className:"rounded-full bg-indigo-100 p-3 text-indigo-600",children:a.jsx(Jv,{className:"h-6 w-6"})})]}),a.jsxs("div",{className:"mt-4 flex items-center text-sm",children:[a.jsx(Tr,{className:"h-4 w-4 text-green-500"}),a.jsx("span",{className:"ml-1 text-green-500",children:"+12%"}),a.jsx("span",{className:"ml-1 text-gray-500",children:"from last period"})]})]}),a.jsxs("div",{className:"rounded-lg bg-white p-4 shadow",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Avg. Conversion Rate"}),a.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:"6.9%"})]}),a.jsx("div",{className:"rounded-full bg-indigo-100 p-3 text-indigo-600",children:a.jsx(Tr,{className:"h-6 w-6"})})]}),a.jsxs("div",{className:"mt-4 flex items-center text-sm",children:[a.jsx(Tr,{className:"h-4 w-4 text-green-500"}),a.jsx("span",{className:"ml-1 text-green-500",children:"+2.1%"}),a.jsx("span",{className:"ml-1 text-gray-500",children:"from last period"})]})]})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h2",{className:"mb-4 text-lg font-semibold text-gray-900",children:"Performance Trends"}),a.jsx("div",{className:"h-64 rounded-lg bg-gray-100 flex items-center justify-center",children:a.jsx("p",{className:"text-gray-500",children:"Performance chart visualization would appear here"})}),a.jsxs("div",{className:"mt-4 flex justify-center space-x-4",children:[a.jsx("button",{className:"rounded-full bg-indigo-100 px-4 py-1 text-sm font-medium text-indigo-700",children:"Views"}),a.jsx("button",{className:"rounded-full px-4 py-1 text-sm font-medium text-gray-500 hover:bg-gray-100",children:"Applications"}),a.jsx("button",{className:"rounded-full px-4 py-1 text-sm font-medium text-gray-500 hover:bg-gray-100",children:"Conversion Rate"}),a.jsx("button",{className:"rounded-full px-4 py-1 text-sm font-medium text-gray-500 hover:bg-gray-100",children:"Matches"})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Gig Optimization"}),r.map(o=>a.jsxs("div",{className:"rounded-lg bg-white shadow",children:[a.jsxs("div",{className:"flex cursor-pointer items-center justify-between p-4",onClick:()=>i(o.id),children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"h-10 w-10 flex-shrink-0 rounded-full bg-indigo-100 flex items-center justify-center",children:a.jsx(Ir,{className:"h-6 w-6 text-indigo-600"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:o.title}),a.jsx("p",{className:"text-sm text-gray-500",children:o.client})]})]}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("div",{className:"text-right",children:[a.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[o.conversionRate," conversion"]}),a.jsxs("div",{className:"flex items-center justify-end",children:[o.trend==="up"?a.jsx(Tr,{className:"h-4 w-4 text-green-500"}):a.jsx(v4,{className:"h-4 w-4 text-red-500"}),a.jsx("span",{className:`ml-1 text-sm ${o.trend==="up"?"text-green-500":"text-red-500"}`,children:o.trendValue})]})]}),t===o.id?a.jsx(Lc,{className:"h-5 w-5 text-gray-400"}):a.jsx(Cl,{className:"h-5 w-5 text-gray-400"})]})]}),t===o.id&&a.jsxs("div",{className:"border-t border-gray-200 p-4",children:[a.jsxs("div",{className:"mb-4 grid grid-cols-1 gap-4 sm:grid-cols-3",children:[a.jsxs("div",{className:"rounded-lg bg-gray-50 p-3",children:[a.jsx("p",{className:"text-xs font-medium text-gray-500",children:"Views"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900",children:o.views})]}),a.jsxs("div",{className:"rounded-lg bg-gray-50 p-3",children:[a.jsx("p",{className:"text-xs font-medium text-gray-500",children:"Applications"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900",children:o.applications})]}),a.jsxs("div",{className:"rounded-lg bg-gray-50 p-3",children:[a.jsx("p",{className:"text-xs font-medium text-gray-500",children:"Conversion Rate"}),a.jsx("p",{className:"text-lg font-semibold text-gray-900",children:o.conversionRate})]})]}),a.jsx("div",{className:"rounded-lg bg-indigo-50 p-4",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx(El,{className:"mr-2 h-5 w-5 text-indigo-600"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-indigo-900",children:"AI Optimization Suggestions"}),a.jsx("ul",{className:"mt-2 space-y-2",children:o.suggestions.map((l,c)=>a.jsxs("li",{className:"flex items-start",children:[l.type==="high"?a.jsx("span",{className:"mr-2 mt-0.5 h-2 w-2 rounded-full bg-red-500"}):l.type==="medium"?a.jsx("span",{className:"mr-2 mt-0.5 h-2 w-2 rounded-full bg-yellow-500"}):a.jsx("span",{className:"mr-2 mt-0.5 h-2 w-2 rounded-full bg-green-500"}),a.jsx("span",{className:"text-sm text-indigo-700",children:l.text})]},c))}),a.jsxs("div",{className:"mt-3 flex space-x-3",children:[a.jsx("button",{className:"rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",children:"Apply All"}),a.jsx("button",{className:"rounded-md bg-white px-3 py-1.5 text-sm font-medium text-indigo-600 shadow-sm ring-1 ring-inset ring-indigo-300 hover:bg-indigo-50",children:"Review Individually"})]})]})]})})]})]},o.id))]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h2",{className:"mb-4 text-lg font-semibold text-gray-900",children:"Best Practices"}),a.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[a.jsxs("div",{className:"rounded-lg border border-gray-200 p-4",children:[a.jsxs("h3",{className:"flex items-center text-base font-medium text-gray-900",children:[a.jsx(ht,{className:"mr-2 h-5 w-5 text-green-500"}),"High-Converting Gig Elements"]}),a.jsxs("ul",{className:"mt-2 space-y-2 pl-7",children:[a.jsxs("li",{className:"flex items-center text-sm text-gray-700",children:[a.jsx(js,{className:"mr-2 h-4 w-4 text-indigo-600"}),"Clear, specific titles that include key skills"]}),a.jsxs("li",{className:"flex items-center text-sm text-gray-700",children:[a.jsx(js,{className:"mr-2 h-4 w-4 text-indigo-600"}),"Detailed project scope with measurable deliverables"]}),a.jsxs("li",{className:"flex items-center text-sm text-gray-700",children:[a.jsx(js,{className:"mr-2 h-4 w-4 text-indigo-600"}),"Competitive budget ranges based on market rates"]}),a.jsxs("li",{className:"flex items-center text-sm text-gray-700",children:[a.jsx(js,{className:"mr-2 h-4 w-4 text-indigo-600"}),"Clear timeline expectations with milestones"]}),a.jsxs("li",{className:"flex items-center text-sm text-gray-700",children:[a.jsx(js,{className:"mr-2 h-4 w-4 text-indigo-600"}),"Information about the client's company/team"]})]})]}),a.jsxs("div",{className:"rounded-lg border border-gray-200 p-4",children:[a.jsxs("h3",{className:"flex items-center text-base font-medium text-gray-900",children:[a.jsx(hs,{className:"mr-2 h-5 w-5 text-red-500"}),"Common Conversion Blockers"]}),a.jsxs("ul",{className:"mt-2 space-y-2 pl-7",children:[a.jsxs("li",{className:"flex items-center text-sm text-gray-700",children:[a.jsx(js,{className:"mr-2 h-4 w-4 text-indigo-600"}),"Vague or generic project descriptions"]}),a.jsxs("li",{className:"flex items-center text-sm text-gray-700",children:[a.jsx(js,{className:"mr-2 h-4 w-4 text-indigo-600"}),"Unrealistic budget expectations"]}),a.jsxs("li",{className:"flex items-center text-sm text-gray-700",children:[a.jsx(js,{className:"mr-2 h-4 w-4 text-indigo-600"}),"Too many required skills (skill bloat)"]}),a.jsxs("li",{className:"flex items-center text-sm text-gray-700",children:[a.jsx(js,{className:"mr-2 h-4 w-4 text-indigo-600"}),"Missing information about work environment"]}),a.jsxs("li",{className:"flex items-center text-sm text-gray-700",children:[a.jsx(js,{className:"mr-2 h-4 w-4 text-indigo-600"}),"Unclear communication expectations"]})]})]})]}),a.jsxs("div",{className:"mt-4 rounded-lg bg-gray-50 p-4",children:[a.jsx("h3",{className:"text-base font-medium text-gray-900",children:"Resources"}),a.jsxs("div",{className:"mt-2 grid grid-cols-1 gap-2 sm:grid-cols-2",children:[a.jsxs("a",{href:"#",className:"flex items-center rounded-md p-2 text-sm text-indigo-600 hover:bg-indigo-50",children:[a.jsx(zc,{className:"mr-2 h-4 w-4"}),"Guide: Writing High-Converting Gig Descriptions"]}),a.jsxs("a",{href:"#",className:"flex items-center rounded-md p-2 text-sm text-indigo-600 hover:bg-indigo-50",children:[a.jsx(zc,{className:"mr-2 h-4 w-4"}),"Template: Optimized Gig Structure"]}),a.jsxs("a",{href:"#",className:"flex items-center rounded-md p-2 text-sm text-indigo-600 hover:bg-indigo-50",children:[a.jsx(zc,{className:"mr-2 h-4 w-4"}),"Case Study: Top-Performing Gigs Analysis"]}),a.jsxs("a",{href:"#",className:"flex items-center rounded-md p-2 text-sm text-indigo-600 hover:bg-indigo-50",children:[a.jsx(zc,{className:"mr-2 h-4 w-4"}),"Webinar: Maximizing Gig Visibility and Conversions"]})]})]})]})]})},Bi=Ae.create({baseURL:"http://localhost:3003/api",headers:{"Content-Type":"application/json"},timeout:3e4,validateStatus:t=>t>=200&&t<500});class sr extends Error{constructor(e,s,n,r){super(e),this.code=s,this.status=n,this.details=r,this.name="PhoneNumberServiceError"}}const $2=t=>t!==null&&typeof t=="object"&&"response"in t,Ui=(t,e)=>{if(console.error(` Error in ${e}:`,t),$2(t)){const n=t.response?.status,r=t.response?.data;throw console.error(" Response status:",n),console.error(" Response data:",r),console.error(" Request config:",t.config),n===404?new sr("Resource not found","NOT_FOUND",n,r):n===400?new sr("Invalid request parameters","INVALID_PARAMETERS",n,r):n===401?new sr("Authentication required","UNAUTHORIZED",n,r):n===403?new sr("Operation not allowed","FORBIDDEN",n,r):n===429?new sr("Rate limit exceeded","RATE_LIMIT",n,r):n&&n>=500?new sr("Server error occurred","SERVER_ERROR",n,r):new sr(t.message||"Unknown error occurred","UNKNOWN_ERROR",n,r)}const s=t instanceof Error?t.message:"Unknown error occurred";throw new sr(s,"UNKNOWN_ERROR")},nr={listPhoneNumbers:async t=>{try{const e=await Bi.get(`/phone-numbers/gig/${t}/check`);return console.log(" Listed phone numbers:",e.data),e.data}catch(e){throw Ui(e,"listPhoneNumbers")}},searchPhoneNumbers:async(t,e="telnyx")=>{try{const s=e==="twilio"?"/phone-numbers/search/twilio":"/phone-numbers/search";console.log(` Searching ${e} numbers for ${t}`);const n=await Bi.get(s,{params:{countryCode:t}});if(!n.data||typeof n.data=="string")return console.warn(" Invalid response format:",n.data),[];const r=n.data.map(i=>({...i,provider:e}));return console.log(` Found ${r.length} numbers for ${t}`),r}catch(s){return $2(s)&&s.response?.status===500?(console.warn(` ${e} API error, returning empty array`),[]):Ui(s,"searchPhoneNumbers")}},purchasePhoneNumber:async t=>{const{phoneNumber:e,provider:s,gigId:n,requirementGroupId:r,bundleSid:i,addressSid:o}=t;if(!n)throw new sr("gigId is required to purchase a phone number","MISSING_PARAMETER");if(!e)throw new sr("phoneNumber is required","MISSING_PARAMETER");if(!t.companyId)throw new sr("companyId is required to purchase a phone number","MISSING_PARAMETER");if(s==="telnyx"&&!r)throw new sr("requirementGroupId is required for Telnyx numbers","MISSING_PARAMETER");try{const l=s==="twilio"?"/phone-numbers/purchase/twilio":"/phone-numbers/purchase";console.log(` Purchasing ${s} number ${e} for gig ${n}`,r?`with requirement group ${r}`:"");const c={phoneNumber:e,provider:s,gigId:n,companyId:t.companyId,requirementGroupId:r};s==="twilio"&&(i&&(c.bundleSid=i),o&&(c.addressSid=o));const d=await Bi.post(l,c);return console.log(" Purchase successful:",d.data),d.data}catch(l){return Ui(l,"purchasePhoneNumber")}},getTwilioRequirements:async(t,e="local")=>{try{return(await Bi.get("/phone-numbers/twilio/requirements",{params:{countryCode:t,type:e}})).data}catch(s){return Ui(s,"getTwilioRequirements")}},createTwilioEndUser:async t=>{try{return(await Bi.post("/phone-numbers/twilio/end-users",t)).data}catch(e){return Ui(e,"createTwilioEndUser")}},createTwilioDocument:async(t,e,s,n)=>{try{const r=new FormData;return r.append("file",t),r.append("friendlyName",e),r.append("type",s),r.append("attributes",JSON.stringify(n)),(await Bi.post("/phone-numbers/twilio/documents",r,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(r){return Ui(r,"createTwilioDocument")}},createTwilioBundle:async t=>{try{return(await Bi.post("/phone-numbers/twilio/bundles",t)).data}catch(e){return Ui(e,"createTwilioBundle")}},assignItemToBundle:async(t,e)=>{try{return(await Bi.post(`/phone-numbers/twilio/bundles/${t}/items`,{objectSid:e})).data}catch(s){return Ui(s,"assignItemToBundle")}},submitTwilioBundle:async t=>{try{return(await Bi.post(`/phone-numbers/twilio/bundles/${t}/submit`)).data}catch(e){return Ui(e,"submitTwilioBundle")}}},T2=t=>t!==null&&typeof t=="object"&&"response"in t,rr={async checkCountryRequirements(t){try{console.log(` Checking requirements for ${t}`);const e=await Ae.get(`undefined/requirements/countries/${t}/requirements`);return console.log(" Requirements:",e.data),e.data}catch(e){throw console.error(" Error checking requirements:",e),e}},async getOrCreateGroup(t,e){try{console.log(` Getting/creating requirement group for ${t} in ${e}`);try{const s=await Ae.get(`undefined/requirement-groups/companies/${t}/zones/${e}`);return console.log(" Found existing group:",s.data),{group:s.data,isNew:!1}}catch(s){if(T2(s)&&s.response?.status===404){console.log(" No existing group found, creating new one...");try{const n=await Ae.post("undefined/requirement-groups",{companyId:t,destinationZone:e});return console.log(" Created new group:",n.data),{group:n.data,isNew:!0}}catch(n){if(T2(n)){if(n.response?.status===400)throw new Error(n.response.data.message||"Invalid request parameters");if(n.response?.status===409)return console.log(" Group was created by another request, retrying get..."),{group:(await Ae.get(`undefined/requirement-groups/companies/${t}/zones/${e}`)).data,isNew:!1}}throw n}}throw s}}catch(s){throw console.error(" Error getting/creating group:",s),s}},async submitDocument(t,e,s){try{console.log(` Submitting document for ${t}, field ${e}`);const n=new FormData;n.append("file",s);const r=await Ae.post(`undefined/requirements/groups/${t}/documents/${e}`,n,{headers:{"Content-Type":"multipart/form-data"}});return console.log(" Document submitted:",r.data),r.data}catch(n){throw console.error(" Error submitting document:",n),n}},async submitTextValue(t,e,s){try{console.log(` Submitting text value for ${t}, field ${e}`);const n=await Ae.post(`undefined/requirements/groups/${t}/values/${e}`,{value:s});return console.log(" Value submitted:",n.data),n.data}catch(n){throw console.error(" Error submitting value:",n),n}},async checkGroupStatus(t){try{console.log(` Checking status for group ${t}`);const e=await Ae.get(`undefined/requirements/groups/${t}/status`);return console.log(" Status:",e.data),e.data}catch(e){throw console.error(" Error checking status:",e),e}},async getDetailedGroupStatus(t){try{console.log(` Getting detailed status for group ${t}`);const e=await Ae.get(`undefined/requirement-groups/${t}/status`);return console.log(" Detailed status:",e.data),e.data}catch(e){throw console.error(" Error getting detailed status:",e),e}},async validateRequirements(t){try{console.log(` Validating requirements for group ${t}`);const e=await Ae.post(`undefined/requirements/groups/${t}/validate`);return console.log(" Validation result:",e.data),e.data}catch(e){throw console.error(" Error validating requirements:",e),e}}},$O=({requirements:t,existingValues:e,onSubmit:s,onCancel:n})=>{const[r,i]=k.useState(()=>!e||!Array.isArray(e)?{}:e.reduce((x,y)=>(y.value&&y.field&&(x[y.field]=y.value),x),{})),[o,l]=k.useState({}),[c,d]=k.useState(!1),[u,h]=k.useState(()=>!e||!Array.isArray(e)?{}:e.reduce((x,y)=>{if(y.value&&y.field)try{const w=JSON.parse(y.value);typeof w=="object"&&w!==null&&(x[y.field]=w)}catch{console.log("Not a JSON string for address field:",y.field)}return x},{})),p=(x,y)=>{i(w=>({...w,[x]:y})),l(w=>({...w,[x]:""}))},f=(x,y)=>{y&&(i(w=>({...w,[x]:y})),l(w=>({...w,[x]:""})))},m=()=>{const x={};let y=!0;return t.forEach(w=>{const v=r[w.id];if(!v){x[w.id]="This field is required",y=!1;return}if(w.type==="document"&&v instanceof File&&(v.size>5*1024*1024&&(x[w.id]="File size must be less than 5MB",y=!1),["image/jpeg","image/png","application/pdf"].includes(v.type)||(x[w.id]="Only JPG, PNG and PDF files are allowed",y=!1)),w.acceptance_criteria){const{min_length:N,max_length:C}=w.acceptance_criteria;typeof v=="string"&&(N&&v.length<N&&(x[w.id]=`Minimum length is ${N} characters`,y=!1),C&&v.length>C&&(x[w.id]=`Maximum length is ${C} characters`,y=!1))}}),l(x),y},b=async x=>{if(x.preventDefault(),!!m()){d(!0);try{await s(r)}catch(y){console.error("Error submitting requirements:",y),l(w=>({...w,submit:y instanceof Error?y.message:"Failed to submit requirements"}))}finally{d(!1)}}},g=x=>{const y=o[x.id],w=r[x.id],N=(()=>{switch(x.type){case"document":return is;case"address":return Zr;case"textual":return x.name.toLowerCase().includes("contact")?oa:x.name.toLowerCase().includes("business")?Ai:$l;default:return is}})();return a.jsxs("div",{className:"space-y-4 bg-gray-50 p-6 rounded-lg border border-gray-200",children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(N,{className:"h-5 w-5 text-gray-400"}),a.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[x.name,x.acceptance_criteria.time_limit&&a.jsxs("span",{className:"ml-1 text-xs text-yellow-600",children:["(within ",x.acceptance_criteria.time_limit,")"]})]})]}),w&&!y&&a.jsx(ht,{className:"h-5 w-5 text-green-500"})]}),a.jsx("p",{className:"text-sm text-gray-500",children:x.description}),x.type==="document"?a.jsxs("div",{className:"mt-1 flex items-center space-x-3",children:[a.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:C=>f(x.id,C.target.files?.[0]||null),className:"hidden",id:`file-${x.id}`}),a.jsxs("label",{htmlFor:`file-${x.id}`,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[a.jsx(Ri,{className:"-ml-1 mr-2 h-5 w-5"}),"Choose File"]}),w instanceof File&&a.jsx("span",{className:"text-sm text-gray-500",children:w.name})]}):a.jsx("div",{className:"mt-1",children:x.type==="address"?a.jsxs("div",{className:"space-y-2",children:[a.jsx("input",{type:"text",placeholder:"Street address",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:u[x.id]?.street||"",onChange:C=>{h(j=>({...j,[x.id]:{...j[x.id],street:C.target.value}})),p(x.id,JSON.stringify({...u[x.id],street:C.target.value}))}}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsx("input",{type:"text",placeholder:"City",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:u[x.id]?.city||"",onChange:C=>{h(j=>({...j,[x.id]:{...j[x.id],city:C.target.value}})),p(x.id,JSON.stringify({...u[x.id],city:C.target.value}))}}),a.jsx("input",{type:"text",placeholder:"Postal code",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:u[x.id]?.postalCode||"",onChange:C=>{h(j=>({...j,[x.id]:{...j[x.id],postalCode:C.target.value}})),p(x.id,JSON.stringify({...u[x.id],postalCode:C.target.value}))}})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsx("input",{type:"text",placeholder:"State/Province",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:u[x.id]?.state||"",onChange:C=>{h(j=>({...j,[x.id]:{...j[x.id],state:C.target.value}})),p(x.id,JSON.stringify({...u[x.id],state:C.target.value}))}}),a.jsx("input",{type:"text",placeholder:"Country",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",value:u[x.id]?.country||"",onChange:C=>{h(j=>({...j,[x.id]:{...j[x.id],country:C.target.value}})),p(x.id,JSON.stringify({...u[x.id],country:C.target.value}))}})]})]}):a.jsx("input",{type:"text",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:x.example,value:typeof w=="string"?w:"",onChange:C=>p(x.id,C.target.value)})}),y&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:y}),x.example&&!y&&a.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Example: ",x.example]})]},x.id)};return a.jsx("form",{onSubmit:b,className:"space-y-6",children:a.jsx("div",{className:"bg-white shadow sm:rounded-lg",children:a.jsxs("div",{className:"px-4 py-5 sm:p-6 space-y-8",children:[a.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"Required Information"}),a.jsx("div",{className:"mt-2 max-w-xl text-sm text-gray-500",children:a.jsx("p",{children:"Please provide the following information to purchase phone numbers in this region. All documents must be clear and legible."})}),a.jsx("div",{className:"mt-5 space-y-6",children:t.map(g)}),o.submit&&a.jsx("div",{className:"mt-4 rounded-md bg-red-50 p-4",children:a.jsxs("div",{className:"flex",children:[a.jsx(hs,{className:"h-5 w-5 text-red-400"}),a.jsxs("div",{className:"ml-3",children:[a.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error submitting requirements"}),a.jsx("div",{className:"mt-2 text-sm text-red-700",children:o.submit})]})]})}),a.jsxs("div",{className:"mt-5 flex justify-end space-x-3",children:[a.jsx("button",{type:"button",onClick:n,className:"rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:c,className:"inline-flex justify-center rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50",children:c?a.jsxs(a.Fragment,{children:[a.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Submitting..."]}):"Submit Requirements"})]})]})})})},TO=({isOpen:t,onClose:e,purchaseStatus:s,purchaseResponse:n,selectedNumber:r,countryReq:i,requirementStatus:o,provider:l,purchaseError:c,onSubmitRequirements:d,onConfirmPurchase:u,onSetPurchaseStatus:h,onSetSelectedNumber:p,onSetShowPurchaseModal:f})=>{const[m,b]=k.useState(""),[g,x]=k.useState("");return k.useState(!1),k.useEffect(()=>{t&&(b(""),x(""))},[t]),t?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 backdrop-blur-sm pointer-events-none"}),a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"w-full max-w-2xl rounded-lg bg-white shadow-2xl",children:[a.jsxs("div",{className:"relative border-b border-gray-200 p-4",children:[a.jsxs("h3",{className:"pr-8 text-lg font-medium text-gray-900",children:[s==="confirming"&&"Confirm Purchase",s==="requirements"&&"Complete Requirements",s==="purchasing"&&"Purchasing Number...",s==="success"&&"Purchase Successful!",s==="error"&&"Purchase Failed"]}),a.jsxs("button",{onClick:()=>{f(!1),h("idle"),p(null)},className:"absolute right-4 top-4 text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[a.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),a.jsx("span",{className:"sr-only",children:"Close"})]})]}),a.jsxs("div",{className:"max-h-[calc(100vh-16rem)] overflow-y-auto p-6",children:[s==="requirements"?a.jsx($O,{requirements:i.requirements||[],onSubmit:d,onCancel:()=>{f(!1),h("idle"),p(null)}}):s==="confirming"&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("p",{className:"text-sm text-gray-500",children:["Are you sure you want to purchase the number ",a.jsx("span",{className:"font-medium",children:r}),"?"]}),l==="telnyx"&&a.jsx("div",{className:`rounded-lg ${o.isComplete?"bg-green-50":"bg-yellow-50"} p-4`,children:a.jsxs("div",{className:"flex",children:[o.isComplete?a.jsx(ht,{className:"h-5 w-5 text-green-400"}):a.jsx(hs,{className:"h-5 w-5 text-yellow-400"}),a.jsx("div",{className:"ml-3",children:a.jsx("p",{className:"text-sm text-gray-600",children:o.isComplete?"Your company is approved to purchase numbers.":a.jsxs(a.Fragment,{children:["Requirements are needed for this number.",a.jsx("button",{onClick:()=>h("requirements"),className:"ml-2 text-indigo-600 hover:text-indigo-500",children:"Complete now"})]})})})]})})]}),s==="purchasing"&&a.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[a.jsx("div",{className:"h-6 w-6 animate-spin rounded-full border-b-2 border-indigo-600"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Processing your purchase..."})]}),s==="success"&&a.jsxs("div",{className:"text-center",children:[a.jsx(ht,{className:"mx-auto mb-4 h-12 w-12 text-green-500"}),a.jsxs("p",{className:"text-sm text-gray-500",children:["Number ",a.jsx("span",{className:"font-medium",children:n?.phoneNumber||r})," has been ordered!"]}),a.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Status: ",a.jsx("span",{className:`font-medium ${n?.status==="active"?"text-green-600":n?.status==="pending"?"text-yellow-600":"text-gray-600"}`,children:n?.status||"Unknown"})]}),a.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:[a.jsx("p",{children:"Features:"}),a.jsx("div",{className:"mt-2 flex justify-center space-x-4",children:n?.features&&Object.entries(n.features).map(([y,w])=>a.jsx("span",{className:`px-2 py-1 rounded-full ${w?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:y},y))})]}),a.jsx("p",{className:"mt-4 text-xs text-gray-500",children:"You can check the number status in the Purchased Numbers section."})]}),s==="error"&&a.jsxs("div",{className:"text-center",children:[a.jsx(hs,{className:"mx-auto mb-4 h-12 w-12 text-red-500"}),a.jsx("p",{className:"text-sm text-red-600",children:c||"An error occurred while purchasing the number"}),a.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Please try again or contact support if the issue persists."}),a.jsx("button",{onClick:()=>{h("confirming")},className:"mt-4 inline-flex items-center rounded-md bg-indigo-50 px-3 py-2 text-sm font-medium text-indigo-600 hover:bg-indigo-100",children:"Try Again"})]})]}),a.jsx("div",{className:"border-t border-gray-200 p-4",children:a.jsxs("div",{className:"flex justify-end space-x-3",children:[s==="confirming"&&a.jsxs(a.Fragment,{children:[a.jsx("button",{onClick:()=>{f(!1),h("idle"),p(null)},className:"rounded-md px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Cancel"}),a.jsx("button",{onClick:()=>u({bundleSid:m,addressSid:g}),className:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700",children:"Confirm Purchase"})]}),(s==="error"||s==="success")&&a.jsx("button",{onClick:()=>{f(!1),h("idle"),p(null)},className:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700",children:"Close"})]})})]})})]}):null};var AO=Object.defineProperty,DO=(t,e,s)=>e in t?AO(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Nx=(t,e,s)=>(DO(t,typeof e!="symbol"?e+"":e,s),s);let _O=class{constructor(){Nx(this,"current",this.detect()),Nx(this,"handoffState","pending"),Nx(this,"currentId",0)}set(e){this.current!==e&&(this.handoffState="pending",this.currentId=0,this.current=e)}reset(){this.set(this.detect())}nextId(){return++this.currentId}get isServer(){return this.current==="server"}get isClient(){return this.current==="client"}detect(){return typeof window>"u"||typeof document>"u"?"server":"client"}handoff(){this.handoffState==="pending"&&(this.handoffState="complete")}get isHandoffComplete(){return this.handoffState==="complete"}},Vi=new _O;function hp(t){var e,s;return Vi.isServer?null:t?"ownerDocument"in t?t.ownerDocument:"current"in t?(s=(e=t.current)==null?void 0:e.ownerDocument)!=null?s:document:null:document}function pp(t){typeof queueMicrotask=="function"?queueMicrotask(t):Promise.resolve().then(t).catch(e=>setTimeout(()=>{throw e}))}function Wi(){let t=[],e={addEventListener(s,n,r,i){return s.addEventListener(n,r,i),e.add(()=>s.removeEventListener(n,r,i))},requestAnimationFrame(...s){let n=requestAnimationFrame(...s);return e.add(()=>cancelAnimationFrame(n))},nextFrame(...s){return e.requestAnimationFrame(()=>e.requestAnimationFrame(...s))},setTimeout(...s){let n=setTimeout(...s);return e.add(()=>clearTimeout(n))},microTask(...s){let n={current:!0};return pp(()=>{n.current&&s[0]()}),e.add(()=>{n.current=!1})},style(s,n,r){let i=s.style.getPropertyValue(n);return Object.assign(s.style,{[n]:r}),this.add(()=>{Object.assign(s.style,{[n]:i})})},group(s){let n=Wi();return s(n),this.add(()=>n.dispose())},add(s){return t.includes(s)||t.push(s),()=>{let n=t.indexOf(s);if(n>=0)for(let r of t.splice(n,1))r()}},dispose(){for(let s of t.splice(0))s()}};return e}function fp(){let[t]=k.useState(Wi);return k.useEffect(()=>()=>t.dispose(),[t]),t}let En=(t,e)=>{Vi.isServer?k.useEffect(t,e):k.useLayoutEffect(t,e)};function pa(t){let e=k.useRef(t);return En(()=>{e.current=t},[t]),e}let Zt=function(t){let e=pa(t);return k.useCallback((...s)=>e.current(...s),[e])};function ed(t){return k.useMemo(()=>t,Object.values(t))}let RO=k.createContext(void 0);function PO(){return k.useContext(RO)}function kx(...t){return Array.from(new Set(t.flatMap(e=>typeof e=="string"?e.split(" "):[]))).filter(Boolean).join(" ")}function Gi(t,e,...s){if(t in e){let r=e[t];return typeof r=="function"?r(...s):r}let n=new Error(`Tried to handle "${t}" but there is no handler defined. Only defined handlers are: ${Object.keys(e).map(r=>`"${r}"`).join(", ")}.`);throw Error.captureStackTrace&&Error.captureStackTrace(n,Gi),n}var mp=(t=>(t[t.None=0]="None",t[t.RenderStrategy=1]="RenderStrategy",t[t.Static=2]="Static",t))(mp||{}),xo=(t=>(t[t.Unmount=0]="Unmount",t[t.Hidden=1]="Hidden",t))(xo||{});function ir(){let t=OO();return k.useCallback(e=>FO({mergeRefs:t,...e}),[t])}function FO({ourProps:t,theirProps:e,slot:s,defaultTag:n,features:r,visible:i=!0,name:o,mergeRefs:l}){l=l??MO;let c=A2(e,t);if(i)return gp(c,s,n,o,l);let d=r??0;if(d&2){let{static:u=!1,...h}=c;if(u)return gp(h,s,n,o,l)}if(d&1){let{unmount:u=!0,...h}=c;return Gi(u?0:1,{0(){return null},1(){return gp({...h,hidden:!0,style:{display:"none"}},s,n,o,l)}})}return gp(c,s,n,o,l)}function gp(t,e={},s,n,r){let{as:i=s,children:o,refName:l="ref",...c}=Cx(t,["unmount","static"]),d=t.ref!==void 0?{[l]:t.ref}:{},u=typeof o=="function"?o(e):o;"className"in c&&c.className&&typeof c.className=="function"&&(c.className=c.className(e)),c["aria-labelledby"]&&c["aria-labelledby"]===c.id&&(c["aria-labelledby"]=void 0);let h={};if(e){let p=!1,f=[];for(let[m,b]of Object.entries(e))typeof b=="boolean"&&(p=!0),b===!0&&f.push(m.replace(/([A-Z])/g,g=>`-${g.toLowerCase()}`));if(p){h["data-headlessui-state"]=f.join(" ");for(let m of f)h[`data-${m}`]=""}}if(td(i)&&(Object.keys(fa(c)).length>0||Object.keys(fa(h)).length>0))if(!k.isValidElement(u)||Array.isArray(u)&&u.length>1||zO(u)){if(Object.keys(fa(c)).length>0)throw new Error(['Passing props on "Fragment"!',"",`The current component <${n} /> is rendering a "Fragment".`,"However we need to passthrough the following props:",Object.keys(fa(c)).concat(Object.keys(fa(h))).map(p=>`  - ${p}`).join(`
`),"","You can apply a few solutions:",['Add an `as="..."` prop, to ensure that we render an actual element instead of a "Fragment".',"Render a single element as the child so that we can forward the props onto that element."].map(p=>`  - ${p}`).join(`
`)].join(`
`))}else{let p=u.props,f=p?.className,m=typeof f=="function"?(...x)=>kx(f(...x),c.className):kx(f,c.className),b=m?{className:m}:{},g=A2(u.props,fa(Cx(c,["ref"])));for(let x in h)x in g&&delete h[x];return k.cloneElement(u,Object.assign({},g,h,d,{ref:r(LO(u),d.ref)},b))}return k.createElement(i,Object.assign({},Cx(c,["ref"]),!td(i)&&d,!td(i)&&h),u)}function OO(){let t=k.useRef([]),e=k.useCallback(s=>{for(let n of t.current)n!=null&&(typeof n=="function"?n(s):n.current=s)},[]);return(...s)=>{if(!s.every(n=>n==null))return t.current=s,e}}function MO(...t){return t.every(e=>e==null)?void 0:e=>{for(let s of t)s!=null&&(typeof s=="function"?s(e):s.current=e)}}function A2(...t){if(t.length===0)return{};if(t.length===1)return t[0];let e={},s={};for(let n of t)for(let r in n)r.startsWith("on")&&typeof n[r]=="function"?(s[r]!=null||(s[r]=[]),s[r].push(n[r])):e[r]=n[r];if(e.disabled||e["aria-disabled"])for(let n in s)/^(on(?:Click|Pointer|Mouse|Key)(?:Down|Up|Press)?)$/.test(n)&&(s[n]=[r=>{var i;return(i=r?.preventDefault)==null?void 0:i.call(r)}]);for(let n in s)Object.assign(e,{[n](r,...i){let o=s[n];for(let l of o){if((r instanceof Event||r?.nativeEvent instanceof Event)&&r.defaultPrevented)return;l(r,...i)}}});return e}function $n(t){var e;return Object.assign(k.forwardRef(t),{displayName:(e=t.displayName)!=null?e:t.name})}function fa(t){let e=Object.assign({},t);for(let s in e)e[s]===void 0&&delete e[s];return e}function Cx(t,e=[]){let s=Object.assign({},t);for(let n of e)n in s&&delete s[n];return s}function LO(t){return k.version.split(".")[0]>="19"?t.props.ref:t.ref}function td(t){return t===k.Fragment||t===Symbol.for("react.fragment")}function zO(t){return td(t.type)}let BO="span";var xp=(t=>(t[t.None=1]="None",t[t.Focusable=2]="Focusable",t[t.Hidden=4]="Hidden",t))(xp||{});function UO(t,e){var s;let{features:n=1,...r}=t,i={ref:e,"aria-hidden":(n&2)===2?!0:(s=r["aria-hidden"])!=null?s:void 0,hidden:(n&4)===4?!0:void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(n&4)===4&&(n&2)!==2&&{display:"none"}}};return ir()({ourProps:i,theirProps:r,slot:{},defaultTag:BO,name:"Hidden"})}let Sx=$n(UO);function VO(t){return typeof t!="object"||t===null?!1:"nodeType"in t}function bo(t){return VO(t)&&"tagName"in t}function ma(t){return bo(t)&&"accessKey"in t}function yo(t){return bo(t)&&"tabIndex"in t}function WO(t){return bo(t)&&"style"in t}function GO(t){return ma(t)&&t.nodeName==="IFRAME"}function HO(t){return ma(t)&&t.nodeName==="INPUT"}let D2=Symbol();function qO(t,e=!0){return Object.assign(t,{[D2]:e})}function ei(...t){let e=k.useRef(t);k.useEffect(()=>{e.current=t},[t]);let s=Zt(n=>{for(let r of e.current)r!=null&&(typeof r=="function"?r(n):r.current=n)});return t.every(n=>n==null||n?.[D2])?void 0:s}let jx=k.createContext(null);jx.displayName="DescriptionContext";function _2(){let t=k.useContext(jx);if(t===null){let e=new Error("You used a <Description /> component, but it is not inside a relevant parent.");throw Error.captureStackTrace&&Error.captureStackTrace(e,_2),e}return t}function KO(){let[t,e]=k.useState([]);return[t.length>0?t.join(" "):void 0,k.useMemo(()=>function(s){let n=Zt(i=>(e(o=>[...o,i]),()=>e(o=>{let l=o.slice(),c=l.indexOf(i);return c!==-1&&l.splice(c,1),l}))),r=k.useMemo(()=>({register:n,slot:s.slot,name:s.name,props:s.props,value:s.value}),[n,s.slot,s.name,s.props,s.value]);return k.createElement(jx.Provider,{value:r},s.children)},[e])]}let XO="p";function YO(t,e){let s=k.useId(),n=PO(),{id:r=`headlessui-description-${s}`,...i}=t,o=_2(),l=ei(e);En(()=>o.register(r),[r,o.register]);let c=ed({...o.slot,disabled:n||!1}),d={ref:l,...o.props,id:r};return ir()({ourProps:d,theirProps:i,slot:c,defaultTag:XO,name:o.name||"Description"})}let ZO=$n(YO),JO=Object.assign(ZO,{});var R2=(t=>(t.Space=" ",t.Enter="Enter",t.Escape="Escape",t.Backspace="Backspace",t.Delete="Delete",t.ArrowLeft="ArrowLeft",t.ArrowUp="ArrowUp",t.ArrowRight="ArrowRight",t.ArrowDown="ArrowDown",t.Home="Home",t.End="End",t.PageUp="PageUp",t.PageDown="PageDown",t.Tab="Tab",t))(R2||{});let QO=k.createContext(()=>{});function eM({value:t,children:e}){return k.createElement(QO.Provider,{value:t},e)}let P2=class extends Map{constructor(e){super(),this.factory=e}get(e){let s=super.get(e);return s===void 0&&(s=this.factory(e),this.set(e,s)),s}};var tM=Object.defineProperty,sM=(t,e,s)=>e in t?tM(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,nM=(t,e,s)=>(sM(t,e+"",s),s),F2=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},or=(t,e,s)=>(F2(t,e,"read from private field"),s?s.call(t):e.get(t)),Ix=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},O2=(t,e,s,n)=>(F2(t,e,"write to private field"),e.set(t,s),s),ti,sd,nd;let rM=class{constructor(e){Ix(this,ti,{}),Ix(this,sd,new P2(()=>new Set)),Ix(this,nd,new Set),nM(this,"disposables",Wi()),O2(this,ti,e),Vi.isServer&&this.disposables.microTask(()=>{this.dispose()})}dispose(){this.disposables.dispose()}get state(){return or(this,ti)}subscribe(e,s){if(Vi.isServer)return()=>{};let n={selector:e,callback:s,current:e(or(this,ti))};return or(this,nd).add(n),this.disposables.add(()=>{or(this,nd).delete(n)})}on(e,s){return Vi.isServer?()=>{}:(or(this,sd).get(e).add(s),this.disposables.add(()=>{or(this,sd).get(e).delete(s)}))}send(e){let s=this.reduce(or(this,ti),e);if(s!==or(this,ti)){O2(this,ti,s);for(let n of or(this,nd)){let r=n.selector(or(this,ti));M2(n.current,r)||(n.current=r,n.callback(r))}for(let n of or(this,sd).get(e.type))n(or(this,ti),e)}}};ti=new WeakMap,sd=new WeakMap,nd=new WeakMap;function M2(t,e){return Object.is(t,e)?!0:typeof t!="object"||t===null||typeof e!="object"||e===null?!1:Array.isArray(t)&&Array.isArray(e)?t.length!==e.length?!1:Ex(t[Symbol.iterator](),e[Symbol.iterator]()):t instanceof Map&&e instanceof Map||t instanceof Set&&e instanceof Set?t.size!==e.size?!1:Ex(t.entries(),e.entries()):L2(t)&&L2(e)?Ex(Object.entries(t)[Symbol.iterator](),Object.entries(e)[Symbol.iterator]()):!1}function Ex(t,e){do{let s=t.next(),n=e.next();if(s.done&&n.done)return!0;if(s.done||n.done||!Object.is(s.value,n.value))return!1}while(!0)}function L2(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;let e=Object.getPrototypeOf(t);return e===null||Object.getPrototypeOf(e)===null}var iM=Object.defineProperty,oM=(t,e,s)=>e in t?iM(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,z2=(t,e,s)=>(oM(t,typeof e!="symbol"?e+"":e,s),s),aM=(t=>(t[t.Push=0]="Push",t[t.Pop=1]="Pop",t))(aM||{});let lM={0(t,e){let s=e.id,n=t.stack,r=t.stack.indexOf(s);if(r!==-1){let i=t.stack.slice();return i.splice(r,1),i.push(s),n=i,{...t,stack:n}}return{...t,stack:[...t.stack,s]}},1(t,e){let s=e.id,n=t.stack.indexOf(s);if(n===-1)return t;let r=t.stack.slice();return r.splice(n,1),{...t,stack:r}}},cM=class DR extends rM{constructor(){super(...arguments),z2(this,"actions",{push:e=>this.send({type:0,id:e}),pop:e=>this.send({type:1,id:e})}),z2(this,"selectors",{isTop:(e,s)=>e.stack[e.stack.length-1]===s,inStack:(e,s)=>e.stack.includes(s)})}static new(){return new DR({stack:[]})}reduce(e,s){return Gi(s.type,lM,e,s)}};const B2=new P2(()=>cM.new());var U2={exports:{}},V2={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rd=k;function dM(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var uM=typeof Object.is=="function"?Object.is:dM,hM=rd.useSyncExternalStore,pM=rd.useRef,fM=rd.useEffect,mM=rd.useMemo,gM=rd.useDebugValue;V2.useSyncExternalStoreWithSelector=function(t,e,s,n,r){var i=pM(null);if(i.current===null){var o={hasValue:!1,value:null};i.current=o}else o=i.current;i=mM(function(){function c(f){if(!d){if(d=!0,u=f,f=n(f),r!==void 0&&o.hasValue){var m=o.value;if(r(m,f))return h=m}return h=f}if(m=h,uM(u,f))return m;var b=n(f);return r!==void 0&&r(m,b)?(u=f,m):(u=f,h=b)}var d=!1,u,h,p=s===void 0?null:s;return[function(){return c(e())},p===null?void 0:function(){return c(p())}]},[e,s,n,r]);var l=hM(t,i[0],i[1]);return fM(function(){o.hasValue=!0,o.value=l},[l]),gM(l),l},U2.exports=V2;var xM=U2.exports;function W2(t,e,s=M2){return xM.useSyncExternalStoreWithSelector(Zt(n=>t.subscribe(bM,n)),Zt(()=>t.state),Zt(()=>t.state),Zt(e),s)}function bM(t){return t}function id(t,e){let s=k.useId(),n=B2.get(e),[r,i]=W2(n,k.useCallback(o=>[n.selectors.isTop(o,s),n.selectors.inStack(o,s)],[n,s]));return En(()=>{if(t)return n.actions.push(s),()=>n.actions.pop(s)},[n,t,s]),t?i?r:!0:!1}let $x=new Map,od=new Map;function G2(t){var e;let s=(e=od.get(t))!=null?e:0;return od.set(t,s+1),s!==0?()=>H2(t):($x.set(t,{"aria-hidden":t.getAttribute("aria-hidden"),inert:t.inert}),t.setAttribute("aria-hidden","true"),t.inert=!0,()=>H2(t))}function H2(t){var e;let s=(e=od.get(t))!=null?e:1;if(s===1?od.delete(t):od.set(t,s-1),s!==1)return;let n=$x.get(t);n&&(n["aria-hidden"]===null?t.removeAttribute("aria-hidden"):t.setAttribute("aria-hidden",n["aria-hidden"]),t.inert=n.inert,$x.delete(t))}function yM(t,{allowed:e,disallowed:s}={}){let n=id(t,"inert-others");En(()=>{var r,i;if(!n)return;let o=Wi();for(let c of(r=s?.())!=null?r:[])c&&o.add(G2(c));let l=(i=e?.())!=null?i:[];for(let c of l){if(!c)continue;let d=hp(c);if(!d)continue;let u=c.parentElement;for(;u&&u!==d.body;){for(let h of u.children)l.some(p=>h.contains(p))||o.add(G2(h));u=u.parentElement}}return o.dispose},[n,e,s])}function wM(t,e,s){let n=pa(r=>{let i=r.getBoundingClientRect();i.x===0&&i.y===0&&i.width===0&&i.height===0&&s()});k.useEffect(()=>{if(!t)return;let r=e===null?null:ma(e)?e:e.current;if(!r)return;let i=Wi();if(typeof ResizeObserver<"u"){let o=new ResizeObserver(()=>n.current(r));o.observe(r),i.add(()=>o.disconnect())}if(typeof IntersectionObserver<"u"){let o=new IntersectionObserver(()=>n.current(r));o.observe(r),i.add(()=>o.disconnect())}return()=>i.dispose()},[e,n,t])}let bp=["[contentEditable=true]","[tabindex]","a[href]","area[href]","button:not([disabled])","iframe","input:not([disabled])","select:not([disabled])","details>summary","textarea:not([disabled])"].map(t=>`${t}:not([tabindex='-1'])`).join(","),vM=["[data-autofocus]"].map(t=>`${t}:not([tabindex='-1'])`).join(",");var Hi=(t=>(t[t.First=1]="First",t[t.Previous=2]="Previous",t[t.Next=4]="Next",t[t.Last=8]="Last",t[t.WrapAround=16]="WrapAround",t[t.NoScroll=32]="NoScroll",t[t.AutoFocus=64]="AutoFocus",t))(Hi||{}),Tx=(t=>(t[t.Error=0]="Error",t[t.Overflow=1]="Overflow",t[t.Success=2]="Success",t[t.Underflow=3]="Underflow",t))(Tx||{}),NM=(t=>(t[t.Previous=-1]="Previous",t[t.Next=1]="Next",t))(NM||{});function kM(t=document.body){return t==null?[]:Array.from(t.querySelectorAll(bp)).sort((e,s)=>Math.sign((e.tabIndex||Number.MAX_SAFE_INTEGER)-(s.tabIndex||Number.MAX_SAFE_INTEGER)))}function CM(t=document.body){return t==null?[]:Array.from(t.querySelectorAll(vM)).sort((e,s)=>Math.sign((e.tabIndex||Number.MAX_SAFE_INTEGER)-(s.tabIndex||Number.MAX_SAFE_INTEGER)))}var q2=(t=>(t[t.Strict=0]="Strict",t[t.Loose=1]="Loose",t))(q2||{});function SM(t,e=0){var s;return t===((s=hp(t))==null?void 0:s.body)?!1:Gi(e,{0(){return t.matches(bp)},1(){let n=t;for(;n!==null;){if(n.matches(bp))return!0;n=n.parentElement}return!1}})}var jM=(t=>(t[t.Keyboard=0]="Keyboard",t[t.Mouse=1]="Mouse",t))(jM||{});typeof window<"u"&&typeof document<"u"&&(document.addEventListener("keydown",t=>{t.metaKey||t.altKey||t.ctrlKey||(document.documentElement.dataset.headlessuiFocusVisible="")},!0),document.addEventListener("click",t=>{t.detail===1?delete document.documentElement.dataset.headlessuiFocusVisible:t.detail===0&&(document.documentElement.dataset.headlessuiFocusVisible="")},!0));function qi(t){t?.focus({preventScroll:!0})}let IM=["textarea","input"].join(",");function EM(t){var e,s;return(s=(e=t?.matches)==null?void 0:e.call(t,IM))!=null?s:!1}function $M(t,e=s=>s){return t.slice().sort((s,n)=>{let r=e(s),i=e(n);if(r===null||i===null)return 0;let o=r.compareDocumentPosition(i);return o&Node.DOCUMENT_POSITION_FOLLOWING?-1:o&Node.DOCUMENT_POSITION_PRECEDING?1:0})}function ad(t,e,{sorted:s=!0,relativeTo:n=null,skipElements:r=[]}={}){let i=Array.isArray(t)?t.length>0?t[0].ownerDocument:document:t.ownerDocument,o=Array.isArray(t)?s?$M(t):t:e&64?CM(t):kM(t);r.length>0&&o.length>1&&(o=o.filter(f=>!r.some(m=>m!=null&&"current"in m?m?.current===f:m===f))),n=n??i.activeElement;let l=(()=>{if(e&5)return 1;if(e&10)return-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),c=(()=>{if(e&1)return 0;if(e&2)return Math.max(0,o.indexOf(n))-1;if(e&4)return Math.max(0,o.indexOf(n))+1;if(e&8)return o.length-1;throw new Error("Missing Focus.First, Focus.Previous, Focus.Next or Focus.Last")})(),d=e&32?{preventScroll:!0}:{},u=0,h=o.length,p;do{if(u>=h||u+h<=0)return 0;let f=c+u;if(e&16)f=(f+h)%h;else{if(f<0)return 3;if(f>=h)return 1}p=o[f],p?.focus(d),u+=l}while(p!==i.activeElement);return e&6&&EM(p)&&p.select(),2}function K2(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function TM(){return/Android/gi.test(window.navigator.userAgent)}function X2(){return K2()||TM()}function yp(t,e,s,n){let r=pa(s);k.useEffect(()=>{if(!t)return;function i(o){r.current(o)}return document.addEventListener(e,i,n),()=>document.removeEventListener(e,i,n)},[t,e,n])}function Y2(t,e,s,n){let r=pa(s);k.useEffect(()=>{if(!t)return;function i(o){r.current(o)}return window.addEventListener(e,i,n),()=>window.removeEventListener(e,i,n)},[t,e,n])}const Z2=30;function AM(t,e,s){let n=pa(s),r=k.useCallback(function(l,c){if(l.defaultPrevented)return;let d=c(l);if(d===null||!d.getRootNode().contains(d)||!d.isConnected)return;let u=function h(p){return typeof p=="function"?h(p()):Array.isArray(p)||p instanceof Set?p:[p]}(e);for(let h of u)if(h!==null&&(h.contains(d)||l.composed&&l.composedPath().includes(h)))return;return!SM(d,q2.Loose)&&d.tabIndex!==-1&&l.preventDefault(),n.current(l,d)},[n,e]),i=k.useRef(null);yp(t,"pointerdown",l=>{var c,d;X2()||(i.current=((d=(c=l.composedPath)==null?void 0:c.call(l))==null?void 0:d[0])||l.target)},!0),yp(t,"pointerup",l=>{if(X2()||!i.current)return;let c=i.current;return i.current=null,r(l,()=>c)},!0);let o=k.useRef({x:0,y:0});yp(t,"touchstart",l=>{o.current.x=l.touches[0].clientX,o.current.y=l.touches[0].clientY},!0),yp(t,"touchend",l=>{let c={x:l.changedTouches[0].clientX,y:l.changedTouches[0].clientY};if(!(Math.abs(c.x-o.current.x)>=Z2||Math.abs(c.y-o.current.y)>=Z2))return r(l,()=>yo(l.target)?l.target:null)},!0),Y2(t,"blur",l=>r(l,()=>GO(window.document.activeElement)?window.document.activeElement:null),!0)}function wp(...t){return k.useMemo(()=>hp(...t),[...t])}function J2(t,e,s,n){let r=pa(s);k.useEffect(()=>{t=t??window;function i(o){r.current(o)}return t.addEventListener(e,i,n),()=>t.removeEventListener(e,i,n)},[t,e,n])}function DM(t){return k.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getSnapshot)}function _M(t,e){let s=t(),n=new Set;return{getSnapshot(){return s},subscribe(r){return n.add(r),()=>n.delete(r)},dispatch(r,...i){let o=e[r].call(s,...i);o&&(s=o,n.forEach(l=>l()))}}}function RM(){let t;return{before({doc:e}){var s;let n=e.documentElement,r=(s=e.defaultView)!=null?s:window;t=Math.max(0,r.innerWidth-n.clientWidth)},after({doc:e,d:s}){let n=e.documentElement,r=Math.max(0,n.clientWidth-n.offsetWidth),i=Math.max(0,t-r);s.style(n,"paddingRight",`${i}px`)}}}function PM(){return K2()?{before({doc:t,d:e,meta:s}){function n(r){return s.containers.flatMap(i=>i()).some(i=>i.contains(r))}e.microTask(()=>{var r;if(window.getComputedStyle(t.documentElement).scrollBehavior!=="auto"){let l=Wi();l.style(t.documentElement,"scrollBehavior","auto"),e.add(()=>e.microTask(()=>l.dispose()))}let i=(r=window.scrollY)!=null?r:window.pageYOffset,o=null;e.addEventListener(t,"click",l=>{if(yo(l.target))try{let c=l.target.closest("a");if(!c)return;let{hash:d}=new URL(c.href),u=t.querySelector(d);yo(u)&&!n(u)&&(o=u)}catch{}},!0),e.addEventListener(t,"touchstart",l=>{if(yo(l.target)&&WO(l.target))if(n(l.target)){let c=l.target;for(;c.parentElement&&n(c.parentElement);)c=c.parentElement;e.style(c,"overscrollBehavior","contain")}else e.style(l.target,"touchAction","none")}),e.addEventListener(t,"touchmove",l=>{if(yo(l.target)){if(HO(l.target))return;if(n(l.target)){let c=l.target;for(;c.parentElement&&c.dataset.headlessuiPortal!==""&&!(c.scrollHeight>c.clientHeight||c.scrollWidth>c.clientWidth);)c=c.parentElement;c.dataset.headlessuiPortal===""&&l.preventDefault()}else l.preventDefault()}},{passive:!1}),e.add(()=>{var l;let c=(l=window.scrollY)!=null?l:window.pageYOffset;i!==c&&window.scrollTo(0,i),o&&o.isConnected&&(o.scrollIntoView({block:"nearest"}),o=null)})})}}:{}}function FM(){return{before({doc:t,d:e}){e.style(t.documentElement,"overflow","hidden")}}}function OM(t){let e={};for(let s of t)Object.assign(e,s(e));return e}let ga=_M(()=>new Map,{PUSH(t,e){var s;let n=(s=this.get(t))!=null?s:{doc:t,count:0,d:Wi(),meta:new Set};return n.count++,n.meta.add(e),this.set(t,n),this},POP(t,e){let s=this.get(t);return s&&(s.count--,s.meta.delete(e)),this},SCROLL_PREVENT({doc:t,d:e,meta:s}){let n={doc:t,d:e,meta:OM(s)},r=[PM(),RM(),FM()];r.forEach(({before:i})=>i?.(n)),r.forEach(({after:i})=>i?.(n))},SCROLL_ALLOW({d:t}){t.dispose()},TEARDOWN({doc:t}){this.delete(t)}});ga.subscribe(()=>{let t=ga.getSnapshot(),e=new Map;for(let[s]of t)e.set(s,s.documentElement.style.overflow);for(let s of t.values()){let n=e.get(s.doc)==="hidden",r=s.count!==0;(r&&!n||!r&&n)&&ga.dispatch(s.count>0?"SCROLL_PREVENT":"SCROLL_ALLOW",s),s.count===0&&ga.dispatch("TEARDOWN",s)}});function MM(t,e,s=()=>({containers:[]})){let n=DM(ga),r=e?n.get(e):void 0,i=r?r.count>0:!1;return En(()=>{if(!(!e||!t))return ga.dispatch("PUSH",e,s),()=>ga.dispatch("POP",e,s)},[t,e]),i}function LM(t,e,s=()=>[document.body]){let n=id(t,"scroll-lock");MM(n,e,r=>{var i;return{containers:[...(i=r.containers)!=null?i:[],s]}})}function zM(t=0){let[e,s]=k.useState(t),n=k.useCallback(c=>s(c),[]),r=k.useCallback(c=>s(d=>d|c),[]),i=k.useCallback(c=>(e&c)===c,[e]),o=k.useCallback(c=>s(d=>d&~c),[]),l=k.useCallback(c=>s(d=>d^c),[]);return{flags:e,setFlag:n,addFlag:r,hasFlag:i,removeFlag:o,toggleFlag:l}}var BM={},Q2,eN;typeof process<"u"&&typeof globalThis<"u"&&typeof Element<"u"&&((Q2=process==null?void 0:BM)==null?void 0:Q2.NODE_ENV)==="test"&&typeof((eN=Element?.prototype)==null?void 0:eN.getAnimations)>"u"&&(Element.prototype.getAnimations=function(){return console.warn(["Headless UI has polyfilled `Element.prototype.getAnimations` for your tests.","Please install a proper polyfill e.g. `jsdom-testing-mocks`, to silence these warnings.","","Example usage:","```js","import { mockAnimationsApi } from 'jsdom-testing-mocks'","mockAnimationsApi()","```"].join(`
`)),[]});var UM=(t=>(t[t.None=0]="None",t[t.Closed=1]="Closed",t[t.Enter=2]="Enter",t[t.Leave=4]="Leave",t))(UM||{});function VM(t){let e={};for(let s in t)t[s]===!0&&(e[`data-${s}`]="");return e}function WM(t,e,s,n){let[r,i]=k.useState(s),{hasFlag:o,addFlag:l,removeFlag:c}=zM(t&&r?3:0),d=k.useRef(!1),u=k.useRef(!1),h=fp();return En(()=>{var p;if(t){if(s&&i(!0),!e){s&&l(3);return}return(p=n?.start)==null||p.call(n,s),GM(e,{inFlight:d,prepare(){u.current?u.current=!1:u.current=d.current,d.current=!0,!u.current&&(s?(l(3),c(4)):(l(4),c(2)))},run(){u.current?s?(c(3),l(4)):(c(4),l(3)):s?c(1):l(1)},done(){var f;u.current&&typeof e.getAnimations=="function"&&e.getAnimations().length>0||(d.current=!1,c(7),s||i(!1),(f=n?.end)==null||f.call(n,s))}})}},[t,s,e,h]),t?[r,{closed:o(1),enter:o(2),leave:o(4),transition:o(2)||o(4)}]:[s,{closed:void 0,enter:void 0,leave:void 0,transition:void 0}]}function GM(t,{prepare:e,run:s,done:n,inFlight:r}){let i=Wi();return qM(t,{prepare:e,inFlight:r}),i.nextFrame(()=>{s(),i.requestAnimationFrame(()=>{i.add(HM(t,n))})}),i.dispose}function HM(t,e){var s,n;let r=Wi();if(!t)return r.dispose;let i=!1;r.add(()=>{i=!0});let o=(n=(s=t.getAnimations)==null?void 0:s.call(t).filter(l=>l instanceof CSSTransition))!=null?n:[];return o.length===0?(e(),r.dispose):(Promise.allSettled(o.map(l=>l.finished)).then(()=>{i||e()}),r.dispose)}function qM(t,{inFlight:e,prepare:s}){if(e!=null&&e.current){s();return}let n=t.style.transition;t.style.transition="none",s(),t.offsetHeight,t.style.transition=n}function Ax(t,e){let s=k.useRef([]),n=Zt(t);k.useEffect(()=>{let r=[...s.current];for(let[i,o]of e.entries())if(s.current[i]!==o){let l=n(e,r);return s.current=e,l}},[n,...e])}let vp=k.createContext(null);vp.displayName="OpenClosedContext";var _r=(t=>(t[t.Open=1]="Open",t[t.Closed=2]="Closed",t[t.Closing=4]="Closing",t[t.Opening=8]="Opening",t))(_r||{});function Np(){return k.useContext(vp)}function KM({value:t,children:e}){return k.createElement(vp.Provider,{value:t},e)}function XM({children:t}){return k.createElement(vp.Provider,{value:null},t)}function YM(t){function e(){document.readyState!=="loading"&&(t(),document.removeEventListener("DOMContentLoaded",e))}typeof window<"u"&&typeof document<"u"&&(document.addEventListener("DOMContentLoaded",e),e())}let wo=[];YM(()=>{function t(e){if(!yo(e.target)||e.target===document.body||wo[0]===e.target)return;let s=e.target;s=s.closest(bp),wo.unshift(s??e.target),wo=wo.filter(n=>n!=null&&n.isConnected),wo.splice(10)}window.addEventListener("click",t,{capture:!0}),window.addEventListener("mousedown",t,{capture:!0}),window.addEventListener("focus",t,{capture:!0}),document.body.addEventListener("click",t,{capture:!0}),document.body.addEventListener("mousedown",t,{capture:!0}),document.body.addEventListener("focus",t,{capture:!0})});function tN(t){let e=Zt(t),s=k.useRef(!1);k.useEffect(()=>(s.current=!1,()=>{s.current=!0,pp(()=>{s.current&&e()})}),[e])}let sN=k.createContext(!1);function ZM(){return k.useContext(sN)}function nN(t){return k.createElement(sN.Provider,{value:t.force},t.children)}function JM(t){let e=ZM(),s=k.useContext(iN),[n,r]=k.useState(()=>{var i;if(!e&&s!==null)return(i=s.current)!=null?i:null;if(Vi.isServer)return null;let o=t?.getElementById("headlessui-portal-root");if(o)return o;if(t===null)return null;let l=t.createElement("div");return l.setAttribute("id","headlessui-portal-root"),t.body.appendChild(l)});return k.useEffect(()=>{n!==null&&(t!=null&&t.body.contains(n)||t==null||t.body.appendChild(n))},[n,t]),k.useEffect(()=>{e||s!==null&&r(s.current)},[s,r,e]),n}let rN=k.Fragment,QM=$n(function(t,e){let{ownerDocument:s=null,...n}=t,r=k.useRef(null),i=ei(qO(p=>{r.current=p}),e),o=wp(r),l=s??o,c=JM(l),d=k.useContext(Dx),u=fp(),h=ir();return tN(()=>{var p;c&&c.childNodes.length<=0&&((p=c.parentElement)==null||p.removeChild(c))}),c?Nl.createPortal(k.createElement("div",{"data-headlessui-portal":"",ref:p=>{u.dispose(),d&&p&&u.add(d.register(p))}},h({ourProps:{ref:i},theirProps:n,slot:{},defaultTag:rN,name:"Portal"})),c):null});function eL(t,e){let s=ei(e),{enabled:n=!0,ownerDocument:r,...i}=t,o=ir();return n?k.createElement(QM,{...i,ownerDocument:r,ref:s}):o({ourProps:{ref:s},theirProps:i,slot:{},defaultTag:rN,name:"Portal"})}let tL=k.Fragment,iN=k.createContext(null);function sL(t,e){let{target:s,...n}=t,r={ref:ei(e)},i=ir();return k.createElement(iN.Provider,{value:s},i({ourProps:r,theirProps:n,defaultTag:tL,name:"Popover.Group"}))}let Dx=k.createContext(null);function nL(){let t=k.useContext(Dx),e=k.useRef([]),s=Zt(i=>(e.current.push(i),t&&t.register(i),()=>n(i))),n=Zt(i=>{let o=e.current.indexOf(i);o!==-1&&e.current.splice(o,1),t&&t.unregister(i)}),r=k.useMemo(()=>({register:s,unregister:n,portals:e}),[s,n,e]);return[e,k.useMemo(()=>function({children:i}){return k.createElement(Dx.Provider,{value:r},i)},[r])]}let rL=$n(eL),oN=$n(sL),iL=Object.assign(rL,{Group:oN});function oL(t,e=typeof document<"u"?document.defaultView:null,s){let n=id(t,"escape");J2(e,"keydown",r=>{n&&(r.defaultPrevented||r.key===R2.Escape&&s(r))})}function aL(){var t;let[e]=k.useState(()=>typeof window<"u"&&typeof window.matchMedia=="function"?window.matchMedia("(pointer: coarse)"):null),[s,n]=k.useState((t=e?.matches)!=null?t:!1);return En(()=>{if(!e)return;function r(i){n(i.matches)}return e.addEventListener("change",r),()=>e.removeEventListener("change",r)},[e]),s}function lL({defaultContainers:t=[],portals:e,mainTreeNode:s}={}){let n=wp(s),r=Zt(()=>{var i,o;let l=[];for(let c of t)c!==null&&(bo(c)?l.push(c):"current"in c&&bo(c.current)&&l.push(c.current));if(e!=null&&e.current)for(let c of e.current)l.push(c);for(let c of(i=n?.querySelectorAll("html > *, body > *"))!=null?i:[])c!==document.body&&c!==document.head&&bo(c)&&c.id!=="headlessui-portal-root"&&(s&&(c.contains(s)||c.contains((o=s?.getRootNode())==null?void 0:o.host))||l.some(d=>c.contains(d))||l.push(c));return l});return{resolveContainers:r,contains:Zt(i=>r().some(o=>o.contains(i)))}}let aN=k.createContext(null);function lN({children:t,node:e}){let[s,n]=k.useState(null),r=cN(e??s);return k.createElement(aN.Provider,{value:r},t,r===null&&k.createElement(Sx,{features:xp.Hidden,ref:i=>{var o,l;if(i){for(let c of(l=(o=hp(i))==null?void 0:o.querySelectorAll("html > *, body > *"))!=null?l:[])if(c!==document.body&&c!==document.head&&bo(c)&&c!=null&&c.contains(i)){n(c);break}}}}))}function cN(t=null){var e;return(e=k.useContext(aN))!=null?e:t}function cL(){let t=typeof document>"u";return"useSyncExternalStore"in we?(e=>e.useSyncExternalStore)(we)(()=>()=>{},()=>!1,()=>!t):!1}function kp(){let t=cL(),[e,s]=we.useState(Vi.isHandoffComplete);return e&&Vi.isHandoffComplete===!1&&s(!1),we.useEffect(()=>{e!==!0&&s(!0)},[e]),we.useEffect(()=>Vi.handoff(),[]),t?!1:e}function _x(){let t=k.useRef(!1);return En(()=>(t.current=!0,()=>{t.current=!1}),[]),t}var ld=(t=>(t[t.Forwards=0]="Forwards",t[t.Backwards=1]="Backwards",t))(ld||{});function dL(){let t=k.useRef(0);return Y2(!0,"keydown",e=>{e.key==="Tab"&&(t.current=e.shiftKey?1:0)},!0),t}function dN(t){if(!t)return new Set;if(typeof t=="function")return new Set(t());let e=new Set;for(let s of t.current)bo(s.current)&&e.add(s.current);return e}let uL="div";var xa=(t=>(t[t.None=0]="None",t[t.InitialFocus=1]="InitialFocus",t[t.TabLock=2]="TabLock",t[t.FocusLock=4]="FocusLock",t[t.RestoreFocus=8]="RestoreFocus",t[t.AutoFocus=16]="AutoFocus",t))(xa||{});function hL(t,e){let s=k.useRef(null),n=ei(s,e),{initialFocus:r,initialFocusFallback:i,containers:o,features:l=15,...c}=t;kp()||(l=0);let d=wp(s);gL(l,{ownerDocument:d});let u=xL(l,{ownerDocument:d,container:s,initialFocus:r,initialFocusFallback:i});bL(l,{ownerDocument:d,container:s,containers:o,previousActiveElement:u});let h=dL(),p=Zt(y=>{if(!ma(s.current))return;let w=s.current;(v=>v())(()=>{Gi(h.current,{[ld.Forwards]:()=>{ad(w,Hi.First,{skipElements:[y.relatedTarget,i]})},[ld.Backwards]:()=>{ad(w,Hi.Last,{skipElements:[y.relatedTarget,i]})}})})}),f=id(!!(l&2),"focus-trap#tab-lock"),m=fp(),b=k.useRef(!1),g={ref:n,onKeyDown(y){y.key=="Tab"&&(b.current=!0,m.requestAnimationFrame(()=>{b.current=!1}))},onBlur(y){if(!(l&4))return;let w=dN(o);ma(s.current)&&w.add(s.current);let v=y.relatedTarget;yo(v)&&v.dataset.headlessuiFocusGuard!=="true"&&(uN(w,v)||(b.current?ad(s.current,Gi(h.current,{[ld.Forwards]:()=>Hi.Next,[ld.Backwards]:()=>Hi.Previous})|Hi.WrapAround,{relativeTo:y.target}):yo(y.target)&&qi(y.target)))}},x=ir();return k.createElement(k.Fragment,null,f&&k.createElement(Sx,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:p,features:xp.Focusable}),x({ourProps:g,theirProps:c,defaultTag:uL,name:"FocusTrap"}),f&&k.createElement(Sx,{as:"button",type:"button","data-headlessui-focus-guard":!0,onFocus:p,features:xp.Focusable}))}let pL=$n(hL),fL=Object.assign(pL,{features:xa});function mL(t=!0){let e=k.useRef(wo.slice());return Ax(([s],[n])=>{n===!0&&s===!1&&pp(()=>{e.current.splice(0)}),n===!1&&s===!0&&(e.current=wo.slice())},[t,wo,e]),Zt(()=>{var s;return(s=e.current.find(n=>n!=null&&n.isConnected))!=null?s:null})}function gL(t,{ownerDocument:e}){let s=!!(t&8),n=mL(s);Ax(()=>{s||e?.activeElement===e?.body&&qi(n())},[s]),tN(()=>{s&&qi(n())})}function xL(t,{ownerDocument:e,container:s,initialFocus:n,initialFocusFallback:r}){let i=k.useRef(null),o=id(!!(t&1),"focus-trap#initial-focus"),l=_x();return Ax(()=>{if(t===0)return;if(!o){r!=null&&r.current&&qi(r.current);return}let c=s.current;c&&pp(()=>{if(!l.current)return;let d=e?.activeElement;if(n!=null&&n.current){if(n?.current===d){i.current=d;return}}else if(c.contains(d)){i.current=d;return}if(n!=null&&n.current)qi(n.current);else{if(t&16){if(ad(c,Hi.First|Hi.AutoFocus)!==Tx.Error)return}else if(ad(c,Hi.First)!==Tx.Error)return;if(r!=null&&r.current&&(qi(r.current),e?.activeElement===r.current))return;console.warn("There are no focusable elements inside the <FocusTrap />")}i.current=e?.activeElement})},[r,o,t]),i}function bL(t,{ownerDocument:e,container:s,containers:n,previousActiveElement:r}){let i=_x(),o=!!(t&4);J2(e?.defaultView,"focus",l=>{if(!o||!i.current)return;let c=dN(n);ma(s.current)&&c.add(s.current);let d=r.current;if(!d)return;let u=l.target;ma(u)?uN(c,u)?(r.current=u,qi(u)):(l.preventDefault(),l.stopPropagation(),qi(d)):qi(r.current)},!0)}function uN(t,e){for(let s of t)if(s.contains(e))return!0;return!1}function hN(t){var e;return!!(t.enter||t.enterFrom||t.enterTo||t.leave||t.leaveFrom||t.leaveTo)||!td((e=t.as)!=null?e:fN)||k.Children.count(t.children)===1}let Cp=k.createContext(null);Cp.displayName="TransitionContext";var yL=(t=>(t.Visible="visible",t.Hidden="hidden",t))(yL||{});function wL(){let t=k.useContext(Cp);if(t===null)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return t}function vL(){let t=k.useContext(Sp);if(t===null)throw new Error("A <Transition.Child /> is used but it is missing a parent <Transition /> or <Transition.Root />.");return t}let Sp=k.createContext(null);Sp.displayName="NestingContext";function jp(t){return"children"in t?jp(t.children):t.current.filter(({el:e})=>e.current!==null).filter(({state:e})=>e==="visible").length>0}function pN(t,e){let s=pa(t),n=k.useRef([]),r=_x(),i=fp(),o=Zt((f,m=xo.Hidden)=>{let b=n.current.findIndex(({el:g})=>g===f);b!==-1&&(Gi(m,{[xo.Unmount](){n.current.splice(b,1)},[xo.Hidden](){n.current[b].state="hidden"}}),i.microTask(()=>{var g;!jp(n)&&r.current&&((g=s.current)==null||g.call(s))}))}),l=Zt(f=>{let m=n.current.find(({el:b})=>b===f);return m?m.state!=="visible"&&(m.state="visible"):n.current.push({el:f,state:"visible"}),()=>o(f,xo.Unmount)}),c=k.useRef([]),d=k.useRef(Promise.resolve()),u=k.useRef({enter:[],leave:[]}),h=Zt((f,m,b)=>{c.current.splice(0),e&&(e.chains.current[m]=e.chains.current[m].filter(([g])=>g!==f)),e?.chains.current[m].push([f,new Promise(g=>{c.current.push(g)})]),e?.chains.current[m].push([f,new Promise(g=>{Promise.all(u.current[m].map(([x,y])=>y)).then(()=>g())})]),m==="enter"?d.current=d.current.then(()=>e?.wait.current).then(()=>b(m)):b(m)}),p=Zt((f,m,b)=>{Promise.all(u.current[m].splice(0).map(([g,x])=>x)).then(()=>{var g;(g=c.current.shift())==null||g()}).then(()=>b(m))});return k.useMemo(()=>({children:n,register:l,unregister:o,onStart:h,onStop:p,wait:d,chains:u}),[l,o,n,h,p,u,d])}let fN=k.Fragment,mN=mp.RenderStrategy;function NL(t,e){var s,n;let{transition:r=!0,beforeEnter:i,afterEnter:o,beforeLeave:l,afterLeave:c,enter:d,enterFrom:u,enterTo:h,entered:p,leave:f,leaveFrom:m,leaveTo:b,...g}=t,[x,y]=k.useState(null),w=k.useRef(null),v=hN(t),N=ei(...v?[w,e,y]:e===null?[]:[e]),C=(s=g.unmount)==null||s?xo.Unmount:xo.Hidden,{show:j,appear:I,initial:T}=wL(),[E,$]=k.useState(j?"visible":"hidden"),D=vL(),{register:P,unregister:_}=D;En(()=>P(w),[P,w]),En(()=>{if(C===xo.Hidden&&w.current){if(j&&E!=="visible"){$("visible");return}return Gi(E,{hidden:()=>_(w),visible:()=>P(w)})}},[E,w,P,_,j,C]);let O=kp();En(()=>{if(v&&O&&E==="visible"&&w.current===null)throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")},[w,E,O,v]);let R=T&&!I,X=I&&j&&T,L=k.useRef(!1),K=pN(()=>{L.current||($("hidden"),_(w))},D),B=Zt(H=>{L.current=!0;let ue=H?"enter":"leave";K.onStart(w,ue,F=>{F==="enter"?i?.():F==="leave"&&l?.()})}),G=Zt(H=>{let ue=H?"enter":"leave";L.current=!1,K.onStop(w,ue,F=>{F==="enter"?o?.():F==="leave"&&c?.()}),ue==="leave"&&!jp(K)&&($("hidden"),_(w))});k.useEffect(()=>{v&&r||(B(j),G(j))},[j,v,r]);let de=!(!r||!v||!O||R),[,ae]=WM(de,x,j,{start:B,end:G}),ve=fa({ref:N,className:((n=kx(g.className,X&&d,X&&u,ae.enter&&d,ae.enter&&ae.closed&&u,ae.enter&&!ae.closed&&h,ae.leave&&f,ae.leave&&!ae.closed&&m,ae.leave&&ae.closed&&b,!ae.transition&&j&&p))==null?void 0:n.trim())||void 0,...VM(ae)}),Ne=0;E==="visible"&&(Ne|=_r.Open),E==="hidden"&&(Ne|=_r.Closed),j&&E==="hidden"&&(Ne|=_r.Opening),!j&&E==="visible"&&(Ne|=_r.Closing);let le=ir();return k.createElement(Sp.Provider,{value:K},k.createElement(KM,{value:Ne},le({ourProps:ve,theirProps:g,defaultTag:fN,features:mN,visible:E==="visible",name:"Transition.Child"})))}function kL(t,e){let{show:s,appear:n=!1,unmount:r=!0,...i}=t,o=k.useRef(null),l=hN(t),c=ei(...l?[o,e]:e===null?[]:[e]);kp();let d=Np();if(s===void 0&&d!==null&&(s=(d&_r.Open)===_r.Open),s===void 0)throw new Error("A <Transition /> is used but it is missing a `show={true | false}` prop.");let[u,h]=k.useState(s?"visible":"hidden"),p=pN(()=>{s||h("hidden")}),[f,m]=k.useState(!0),b=k.useRef([s]);En(()=>{f!==!1&&b.current[b.current.length-1]!==s&&(b.current.push(s),m(!1))},[b,s]);let g=k.useMemo(()=>({show:s,appear:n,initial:f}),[s,n,f]);En(()=>{s?h("visible"):!jp(p)&&o.current!==null&&h("hidden")},[s,p]);let x={unmount:r},y=Zt(()=>{var N;f&&m(!1),(N=t.beforeEnter)==null||N.call(t)}),w=Zt(()=>{var N;f&&m(!1),(N=t.beforeLeave)==null||N.call(t)}),v=ir();return k.createElement(Sp.Provider,{value:p},k.createElement(Cp.Provider,{value:g},v({ourProps:{...x,as:k.Fragment,children:k.createElement(gN,{ref:c,...x,...i,beforeEnter:y,beforeLeave:w})},theirProps:{},defaultTag:k.Fragment,features:mN,visible:u==="visible",name:"Transition"})))}function CL(t,e){let s=k.useContext(Cp)!==null,n=Np()!==null;return k.createElement(k.Fragment,null,!s&&n?k.createElement(Rx,{ref:e,...t}):k.createElement(gN,{ref:e,...t}))}let Rx=$n(kL),gN=$n(NL),Px=$n(CL),Ip=Object.assign(Rx,{Child:Px,Root:Rx});var SL=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(SL||{}),jL=(t=>(t[t.SetTitleId=0]="SetTitleId",t))(jL||{});let IL={0(t,e){return t.titleId===e.id?t:{...t,titleId:e.id}}},Fx=k.createContext(null);Fx.displayName="DialogContext";function Ep(t){let e=k.useContext(Fx);if(e===null){let s=new Error(`<${t} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(s,Ep),s}return e}function EL(t,e){return Gi(e.type,IL,t,e)}let xN=$n(function(t,e){let s=k.useId(),{id:n=`headlessui-dialog-${s}`,open:r,onClose:i,initialFocus:o,role:l="dialog",autoFocus:c=!0,__demoMode:d=!1,unmount:u=!1,...h}=t,p=k.useRef(!1);l=function(){return l==="dialog"||l==="alertdialog"?l:(p.current||(p.current=!0,console.warn(`Invalid role [${l}] passed to <Dialog />. Only \`dialog\` and and \`alertdialog\` are supported. Using \`dialog\` instead.`)),"dialog")}();let f=Np();r===void 0&&f!==null&&(r=(f&_r.Open)===_r.Open);let m=k.useRef(null),b=ei(m,e),g=wp(m),x=r?0:1,[y,w]=k.useReducer(EL,{titleId:null,descriptionId:null,panelRef:k.createRef()}),v=Zt(()=>i(!1)),N=Zt(ae=>w({type:0,id:ae})),C=kp()?x===0:!1,[j,I]=nL(),T={get current(){var ae;return(ae=y.panelRef.current)!=null?ae:m.current}},E=cN(),{resolveContainers:$}=lL({mainTreeNode:E,portals:j,defaultContainers:[T]}),D=f!==null?(f&_r.Closing)===_r.Closing:!1;yM(d||D?!1:C,{allowed:Zt(()=>{var ae,ve;return[(ve=(ae=m.current)==null?void 0:ae.closest("[data-headlessui-portal]"))!=null?ve:null]}),disallowed:Zt(()=>{var ae;return[(ae=E?.closest("body > *:not(#headlessui-portal-root)"))!=null?ae:null]})});let P=B2.get(null);En(()=>{if(C)return P.actions.push(n),()=>P.actions.pop(n)},[P,n,C]);let _=W2(P,k.useCallback(ae=>P.selectors.isTop(ae,n),[P,n]));AM(_,$,ae=>{ae.preventDefault(),v()}),oL(_,g?.defaultView,ae=>{ae.preventDefault(),ae.stopPropagation(),document.activeElement&&"blur"in document.activeElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur(),v()}),LM(d||D?!1:C,g,$),wM(C,m,v);let[O,R]=KO(),X=k.useMemo(()=>[{dialogState:x,close:v,setTitleId:N,unmount:u},y],[x,v,N,u,y]),L=ed({open:x===0}),K={ref:b,id:n,role:l,tabIndex:-1,"aria-modal":d?void 0:x===0?!0:void 0,"aria-labelledby":y.titleId,"aria-describedby":O,unmount:u},B=!aL(),G=xa.None;C&&!d&&(G|=xa.RestoreFocus,G|=xa.TabLock,c&&(G|=xa.AutoFocus),B&&(G|=xa.InitialFocus));let de=ir();return k.createElement(XM,null,k.createElement(nN,{force:!0},k.createElement(iL,null,k.createElement(Fx.Provider,{value:X},k.createElement(oN,{target:m},k.createElement(nN,{force:!1},k.createElement(R,{slot:L},k.createElement(I,null,k.createElement(fL,{initialFocus:o,initialFocusFallback:m,containers:$,features:G},k.createElement(eM,{value:v},de({ourProps:K,theirProps:h,slot:L,defaultTag:$L,features:TL,visible:x===0,name:"Dialog"})))))))))))}),$L="div",TL=mp.RenderStrategy|mp.Static;function AL(t,e){let{transition:s=!1,open:n,...r}=t,i=Np(),o=t.hasOwnProperty("open")||i!==null,l=t.hasOwnProperty("onClose");if(!o&&!l)throw new Error("You have to provide an `open` and an `onClose` prop to the `Dialog` component.");if(!o)throw new Error("You provided an `onClose` prop to the `Dialog`, but forgot an `open` prop.");if(!l)throw new Error("You provided an `open` prop to the `Dialog`, but forgot an `onClose` prop.");if(!i&&typeof t.open!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${t.open}`);if(typeof t.onClose!="function")throw new Error(`You provided an \`onClose\` prop to the \`Dialog\`, but the value is not a function. Received: ${t.onClose}`);return(n!==void 0||s)&&!r.static?k.createElement(lN,null,k.createElement(Ip,{show:n,transition:s,unmount:r.unmount},k.createElement(xN,{ref:e,...r}))):k.createElement(lN,null,k.createElement(xN,{ref:e,open:n,...r}))}let DL="div";function _L(t,e){let s=k.useId(),{id:n=`headlessui-dialog-panel-${s}`,transition:r=!1,...i}=t,[{dialogState:o,unmount:l},c]=Ep("Dialog.Panel"),d=ei(e,c.panelRef),u=ed({open:o===0}),h=Zt(g=>{g.stopPropagation()}),p={ref:d,id:n,onClick:h},f=r?Px:k.Fragment,m=r?{unmount:l}:{},b=ir();return k.createElement(f,{...m},b({ourProps:p,theirProps:i,slot:u,defaultTag:DL,name:"Dialog.Panel"}))}let RL="div";function PL(t,e){let{transition:s=!1,...n}=t,[{dialogState:r,unmount:i}]=Ep("Dialog.Backdrop"),o=ed({open:r===0}),l={ref:e,"aria-hidden":!0},c=s?Px:k.Fragment,d=s?{unmount:i}:{},u=ir();return k.createElement(c,{...d},u({ourProps:l,theirProps:n,slot:o,defaultTag:RL,name:"Dialog.Backdrop"}))}let FL="h2";function OL(t,e){let s=k.useId(),{id:n=`headlessui-dialog-title-${s}`,...r}=t,[{dialogState:i,setTitleId:o}]=Ep("Dialog.Title"),l=ei(e);k.useEffect(()=>(o(n),()=>o(null)),[n,o]);let c=ed({open:i===0}),d={ref:l,id:n};return ir()({ourProps:d,theirProps:r,slot:c,defaultTag:FL,name:"Dialog.Title"})}let ML=$n(AL),LL=$n(_L);$n(PL);let zL=$n(OL),Ox=Object.assign(ML,{Panel:LL,Title:zL,Description:JO});const BL={async uploadDocument(t,e,s){try{const n=new FormData;return n.append("file",t),e&&n.append("filename",e),s&&n.append("customer_reference",s),(await Ae.post("undefined/documents",n,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(n){throw console.error("Error uploading document:",n),n}}},UL={async createAddress(t){try{return console.log(" Address service - data to send:",t),(await Ae.post("undefined/addresses",t)).data}catch(e){throw console.error("Error creating address:",e),e}}},VL={async updateRequirements(t,e){try{await Ae.patch(`undefined/requirement-groups/${t}/requirements`,{requirements:e})}catch(s){throw console.error("Error updating requirements:",s),s}},async updateTextValue(t,e,s){return this.updateRequirements(t,[{requirementId:e,value:s}])}},WL=({requirements:t,existingValues:e,requirementGroupId:s,destinationZone:n,onCancel:r})=>{const i=t.map(E=>{let $,D;switch(E.type){case"document":$=is,D=E.name;break;case"address":$=Zr,D=E.name;break;case"textual":$=$l,D=E.name;break;default:$=$l,D=E.name}return{id:E.id,label:D,icon:$,requirement:E}}),o=s||null,l=k.useCallback(()=>{if(!e)return 0;const E=new Set(e.filter($=>$.status==="completed").map($=>$.field));return i.findIndex($=>!E.has($.id))||0},[i,e]),[c,d]=k.useState(l),[u,h]=k.useState(()=>!e||!Array.isArray(e)?{}:e.reduce((E,$)=>{if(!$.value)return E;try{if(t.find(P=>P.id===$.field)?.type==="textual"){const P=$.value.replace(/^"|"$/g,"");E[$.field]=P,E[`${$.field}_details`]={value:P,status:$.status,submittedAt:$.submittedAt}}else{const P=JSON.parse($.value);typeof P=="object"&&P!==null&&(E[$.field]=P,E[`${$.field}_details`]={...P,status:$.status,submittedAt:$.submittedAt})}}catch(D){console.error("Error parsing value for field:",$.field,D)}return E},{})),[p,f]=k.useState({}),[m,b]=k.useState([]),[g,x]=k.useState(()=>{const E=e?.reduce(($,D)=>{if(D.value&&D.field)try{let P;typeof D.value=="string"?P=JSON.parse(D.value):P=D.value,typeof P=="object"&&P!==null&&(P.businessName||P.streetAddress||P.id)&&($[D.field]={businessName:P.businessName||"",streetAddress:P.streetAddress||"",locality:P.locality||"",postalCode:P.postalCode||"",countryCode:n,extendedAddress:P.extendedAddress||"",administrativeArea:P.administrativeArea||""})}catch{console.log("Not a valid address data for field:",D.field)}return $},{})||{};return console.log(" Initial address fields:",{existingValues:e,initialFields:E,destinationZone:n}),E}),y=i[c],w=y?.requirement;console.log("Current step data:",{currentStepIndex:c,currentStep:y,currentRequirement:w,requirementGroupId:o,values:u}),k.useEffect(()=>{if(!t||t.length===0){console.warn("No requirements found:",{requirements:t});return}if(i.length===0){console.warn("No steps available from requirements:",{requirements:t,steps:i});return}},[t,i]);const v=k.useCallback(async()=>{if(!w||!y)return!1;const E={};let $=!0;const D=u[y.id];!D&&!e?.find(_=>_.field===y.id)&&(E[y.id]="This field is required",$=!1);const P=e?.find(_=>_.field===y.id);if(P&&P.status==="completed")return!0;if(!$)return f(E),!1;try{switch(w.type){case"document":if(D instanceof File){if(D.size>5*1024*1024)throw new Error("File size must be less than 5MB");if(!["image/jpeg","image/png","application/pdf"].includes(D.type))throw new Error("Only JPG, PNG and PDF files are allowed")}break;case"address":if(!o)throw new Error("Requirement group ID is missing");const _=typeof D=="string"?JSON.parse(D):D;if(!_.businessName||!_.streetAddress||!_.locality||!_.postalCode)throw new Error("Required address fields are missing");break;case"textual":if(w.acceptance_criteria){const{min_length:O,max_length:R}=w.acceptance_criteria;if(O&&D.length<O)throw new Error(`Minimum length is ${O} characters`);if(R&&D.length>R)throw new Error(`Maximum length is ${R} characters`)}break}return!0}catch(_){return console.error("Validation error:",_),f({[y.id]:_ instanceof Error?_.message:"Validation failed"}),!1}},[y,w,u]),N=async()=>{if(!y||!w){console.error("Missing current step or requirement data");return}if(!o){console.error("Missing requirement group ID"),f({submit:"Configuration error: Missing requirement group ID"});return}if(console.log("Processing step:",{currentStep:y,currentRequirement:w,requirementGroupId:o,value:u[y.id]}),!await v()){console.error("Validation failed");return}try{const $=u[y.id];if(!$){console.error("No value provided for current step");return}let D=$;switch(w.type){case"document":if($ instanceof File){console.log("Uploading new document:",$.name);const _=`${w.name.toLowerCase().replace(/\s+/g,"_")}_${new Date().toISOString()}`,O=await BL.uploadDocument($,_,o);if(console.log("Upload result:",O),!O.id)throw new Error("Document upload failed - no ID received");D=O.id}else typeof $=="object"&&$!==null?(console.log("Using existing document ID:",$.id),D=$.id):typeof $=="string"&&(console.log("Using existing document ID (string):",$),D=$);break;case"address":if(typeof $=="object"&&$.id)console.log("Using existing address ID:",$.id),D=$.id;else{const O={...typeof $=="string"?JSON.parse($):$,countryCode:n};console.log(" Creating new address:",O);const R=await UL.createAddress(O);if(console.log(" Address creation response:",R),!R.id)throw new Error("Failed to create address - no ID received");D=R.id}break;case"textual":D=$;break;default:throw new Error(`Unsupported requirement type: ${w.type}`)}console.log("Updating requirement group:",{groupId:o,requirementId:w.id,value:D});const P={requirementId:w.id,value:D};console.log(" Update payload:",P),await VL.updateRequirements(o,[P]),m.includes(c)||b(_=>[..._,c]),c<i.length-1?d(_=>_+1):j()}catch($){console.error("Error processing step:",$),f(D=>({...D,[y.id]:$ instanceof Error?$.message:"Failed to process step"}))}},C=()=>{c>0&&d(E=>E-1)},j=async()=>{await v()&&r()},I=E=>{let $=g[E.id]||{};$.countryCode||($.countryCode=n);const D=p[E.id],P=(_,O)=>{const R={...$,[_]:O,countryCode:n};x(X=>({...X,[E.id]:R})),h(X=>({...X,[E.id]:JSON.stringify(R)}))};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:[a.jsxs("div",{className:"col-span-2",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 text-left",children:["Business Name ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",placeholder:"Enter your business name",className:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm transition-colors",value:$.businessName||"",onChange:_=>P("businessName",_.target.value)})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 text-left",children:["Street Address ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",placeholder:"Enter your street address",className:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm transition-colors",value:$.streetAddress||"",onChange:_=>P("streetAddress",_.target.value)})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 text-left",children:["City ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",placeholder:"Enter city name",className:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm transition-colors",value:$.locality||"",onChange:_=>P("locality",_.target.value)})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1 text-left",children:["Postal Code ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",placeholder:"Enter postal code",className:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm transition-colors",value:$.postalCode||"",onChange:_=>P("postalCode",_.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 text-left",children:"State/Province"}),a.jsx("input",{type:"text",placeholder:"Enter state or province (optional)",className:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm transition-colors",value:$.administrativeArea||"",onChange:_=>P("administrativeArea",_.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 text-left",children:"Country Code"}),a.jsx("input",{type:"text",className:"block w-full rounded-lg border-gray-300 bg-gray-50 shadow-sm text-sm transition-colors cursor-not-allowed",value:n.toUpperCase(),readOnly:!0,disabled:!0})]})]}),a.jsxs("div",{className:"pt-4",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[a.jsx("div",{className:"h-px flex-1 bg-gray-200"}),a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Optional Information"}),a.jsx("div",{className:"h-px flex-1 bg-gray-200"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1 text-left",children:"Extended Address"}),a.jsx("input",{type:"text",placeholder:"Apartment, Suite, Unit, Building, etc.",className:"block w-full rounded-lg border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm transition-colors",value:$.extendedAddress||"",onChange:_=>P("extendedAddress",_.target.value)})]})]}),D&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:D})]})},T=E=>{const $=p[E.id],D=u[E.id],P=e?.find(O=>O.field===E.id),_=P?.status==="completed";return a.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[a.jsxs("div",{className:"flex items-start justify-between mb-4",children:[a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"mt-1",children:(()=>{const O=E.type==="document"?is:E.type==="address"?Zr:$l;return a.jsx(O,{className:"h-5 w-5 text-indigo-500"})})()}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-base font-medium text-gray-900",children:E.name.replace(" (National)","")}),E.acceptance_criteria.time_limit&&a.jsxs("div",{className:"mt-1 inline-flex items-center px-2 py-1 rounded-full bg-yellow-100 text-yellow-800 text-xs",children:["Required within ",E.acceptance_criteria.time_limit]}),a.jsx("p",{className:"mt-1 text-sm text-gray-500 max-w-2xl",children:E.description})]})]}),(D||e?.find(O=>O.field===E.id)?.status==="approved")&&!$&&a.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[a.jsx(ht,{className:"h-5 w-5"}),a.jsx("span",{className:"text-sm font-medium",children:"Completed"})]})]}),a.jsx("div",{className:"border-t border-gray-200 my-4"}),E.type==="document"?a.jsx("div",{className:"mt-1 flex items-center space-x-3",children:_&&P?.value?a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:JSON.parse(P.value).filename}),a.jsx("span",{className:"text-xs text-gray-500",children:P?.submittedAt&&`Submitted: ${new Date(P.submittedAt).toLocaleString()}`})]}),a.jsx("a",{href:`undefined/documents/${JSON.parse(P.value).id}/download`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-3 py-1 border border-transparent text-sm leading-4 font-medium rounded-md text-indigo-700 bg-indigo-100 hover:bg-indigo-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"View Document"}),a.jsx(ht,{className:"h-5 w-5 text-green-500"})]})}),a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:O=>{const R=O.target.files?.[0];R&&(h(X=>({...X,[E.id]:R})),f(X=>({...X,[E.id]:""})))},className:"hidden",id:`file-${E.id}`}),a.jsxs("label",{htmlFor:`file-${E.id}`,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[a.jsx(Ri,{className:"-ml-1 mr-2 h-5 w-5"}),"Change Document"]}),u[E.id]instanceof File&&a.jsxs("span",{className:"text-sm text-gray-500",children:["New file selected: ",u[E.id].name]})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:O=>{const R=O.target.files?.[0];R&&(h(X=>({...X,[E.id]:R})),f(X=>({...X,[E.id]:""})))},className:"hidden",id:`file-${E.id}`}),a.jsxs("label",{htmlFor:`file-${E.id}`,className:"inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[a.jsx(Ri,{className:"-ml-1 mr-2 h-5 w-5"}),"Choose File"]}),D instanceof File&&a.jsx("span",{className:"text-sm text-gray-500",children:D.name})]})}):E.type==="address"?I(E):a.jsx("div",{className:"space-y-2",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex-grow",children:[a.jsx("input",{type:"text",className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:E.example,value:D||u[`${E.id}_details`]?.value||"",onChange:O=>{h(R=>({...R,[E.id]:O.target.value})),f(R=>({...R,[E.id]:""}))}}),P?.status==="completed"&&P?.submittedAt&&a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Last submitted: ",new Date(P.submittedAt).toLocaleString()]})]}),P?.status==="completed"&&a.jsx(ht,{className:"h-5 w-5 text-green-500"})]})}),$&&a.jsx("p",{className:"mt-1 text-sm text-red-600",children:$}),E.example&&!$&&a.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Example: ",E.example]})]},E.id)};return a.jsxs("div",{className:"space-y-6",children:[a.jsx("nav",{"aria-label":"Progress",className:"px-8 py-4 bg-white rounded-lg shadow-sm",children:a.jsx("ol",{role:"list",className:"flex items-center justify-between",children:i.map((E,$)=>{const D=E.icon,P=$===c,_=m.includes($),O=$===i.length-1;return a.jsxs("li",{className:`relative flex-1 ${O?"":"pr-8"}`,children:[a.jsxs("div",{className:"group flex items-center",children:[a.jsx("div",{className:"flex items-center justify-center",children:a.jsxs("div",{className:`
                        relative flex h-10 w-10 items-center justify-center rounded-full border-2 transition-all duration-200
                        ${P?"border-indigo-600 bg-indigo-600 ring-2 ring-indigo-100":_?"border-green-500 bg-green-500":"border-gray-300 bg-white"}
                      `,children:[a.jsx(D,{className:`h-5 w-5 transition-colors
                          ${P||_?"text-white":"text-gray-500"}
                        `}),_&&!P&&a.jsx(ht,{className:"absolute h-4 w-4 text-white"})]})}),!O&&a.jsx("div",{className:`absolute left-0 top-5 -z-10 h-0.5 w-full transition-colors duration-200
                        ${_?"bg-green-500":"bg-gray-300"}
                      `,style:{left:"50%",width:"100%"}})]}),a.jsx("div",{className:"mt-3",children:a.jsx("span",{className:`block text-center text-sm font-medium transition-colors duration-200
                      ${P?"text-indigo-600":_?"text-green-600":"text-gray-500"}
                    `,children:E.label})})]},E.id)})})}),a.jsx("div",{className:"mt-8 space-y-6",children:w&&T(w)}),p.submit&&a.jsx("div",{className:"rounded-md bg-red-50 p-4",children:a.jsxs("div",{className:"flex",children:[a.jsx(hs,{className:"h-5 w-5 text-red-400"}),a.jsxs("div",{className:"ml-3",children:[a.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error submitting requirements"}),a.jsx("div",{className:"mt-2 text-sm text-red-700",children:p.submit})]})]})}),a.jsxs("div",{className:"mt-8 flex justify-between",children:[a.jsx("button",{type:"button",onClick:r,className:"rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:"Cancel"}),a.jsxs("div",{className:"flex space-x-3",children:[c>0&&a.jsxs("button",{type:"button",onClick:C,className:"inline-flex items-center rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:[a.jsx(ra,{className:"mr-2 h-4 w-4"}),"Back"]}),a.jsx("button",{type:"button",onClick:N,className:"inline-flex items-center rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:c===i.length-1?"Finish":a.jsxs(a.Fragment,{children:["Next",a.jsx(js,{className:"ml-2 h-4 w-4"})]})})]})]})]})},GL=({isOpen:t,onClose:e,countryCode:s,requirements:n,existingValues:r,requirementGroupId:i,onSubmit:o})=>a.jsx(Ip,{appear:!0,show:t,as:k.Fragment,children:a.jsxs(Ox,{as:"div",className:"relative z-50",onClose:()=>{},static:!0,children:[a.jsx(Ip.Child,{as:k.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),a.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:a.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:a.jsx(Ip.Child,{as:k.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:a.jsxs(Ox.Panel,{className:"w-full max-w-4xl transform overflow-hidden rounded-2xl bg-white shadow-xl transition-all",children:[a.jsx("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4",children:a.jsxs(Ox.Title,{as:"div",className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-semibold text-white",children:"Complete Requirements"}),a.jsxs("p",{className:"mt-1 text-sm text-indigo-100",children:["Required information for ",s," phone numbers"]})]}),a.jsx("button",{type:"button",className:"rounded-full p-1 text-indigo-100 hover:bg-indigo-500 hover:text-white focus:outline-none focus:ring-2 focus:ring-white",onClick:e,children:a.jsx(Pi,{className:"h-6 w-6"})})]})}),a.jsx("div",{className:"px-6 py-4 bg-gray-50",children:a.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 rounded-r-lg",children:a.jsxs("div",{className:"flex",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:a.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),a.jsx("div",{className:"ml-3",children:a.jsx("p",{className:"text-sm text-yellow-700",children:"Please ensure all documents are clear, legible, and in the correct format."})})]})})}),a.jsx("div",{className:"px-6 pb-6",children:a.jsx(WL,{requirements:n,existingValues:r,requirementGroupId:i,destinationZone:s.toLowerCase(),onSubmit:o,onCancel:e})})]})})})})]})}),bN=({onBackToOnboarding:t})=>{const[e,s]=k.useState("twilio"),[n,r]=k.useState(null),[i,o]=k.useState(null),[l,c]=k.useState(null),[d,u]=k.useState([]),[h,p]=k.useState(!1),[f,m]=k.useState(!1);k.useEffect(()=>{const q=()=>{const fe=De.get("companyId");return console.log(" Reading companyId cookie:",fe),fe?(o(fe),c(null),!0):!1};if(!q()){console.log(" CompanyId cookie not found on first read, setting up retry interval");const fe=setInterval(()=>{q()?(console.log(" CompanyId cookie found on retry"),clearInterval(fe)):(console.log(" CompanyId cookie still not found on retry"),c("Required company ID not found. Please refresh the page if this persists."))},2e3);return()=>clearInterval(fe)}},[]);const[b,g]=k.useState([]),[x,y]=k.useState(""),[w,v]=k.useState([]),[N,C]=k.useState([]),[j,I]=k.useState("idle"),[T,E]=k.useState(null),[$,D]=k.useState(null),[P,_]=k.useState(!1),[O,R]=k.useState(!1),[X,L]=k.useState(null),[K,B]=k.useState({hasRequirements:!1}),[G,de]=k.useState({isChecking:!1,hasRequirements:!1,isComplete:!1,error:null}),ae=[{id:"twilio",name:"Twilio",logo:oa},{id:"telnyx",name:"Telnyx",logo:Ks}];k.useEffect(()=>{if(!i){console.log("Waiting for company ID...");return}console.log(" Company ID available, fetching initial data..."),ee(),F()},[i]),k.useEffect(()=>{n&&(console.log(" Selected gig changed, fetching existing numbers..."),re())},[n]),k.useEffect(()=>{if(n&&d.length>0){const q=d.find(fe=>fe._id===n);q&&q.destination_zone&&q.destination_zone.cca2&&(console.log(" Setting destination zone from selected gig:",q.destination_zone.cca2),y(q.destination_zone.cca2))}else y("")},[n,d]),k.useEffect(()=>{if(b.some(fe=>fe.status==="pending")){console.log(" Setting up auto-refresh for pending numbers");const fe=setInterval(re,3e4);return()=>clearInterval(fe)}},[b]);const[ve,Ne]=k.useState(null),le=async()=>{if(!n)return!1;try{console.log(" Checking if gig has a phone number:",n);const q=await nr.listPhoneNumbers(n);return q?.hasNumber&&q.number?(console.log(" Found existing number for gig"),g([q.number]),de({isChecking:!1,hasRequirements:!1,isComplete:!0,error:null}),(e==="telnyx"||e==="twilio")&&ce(),!0):!1}catch(q){return console.error(" Error checking gig numbers:",q),!1}},H=async q=>{if(!n||!i||await le())return;const Fe=d.find(Me=>Me._id===n);if(!Fe?.destination_zone?.cca2){console.error("No destination zone found for gig");return}const et=q||Fe.destination_zone.cca2;y(et),ce(et);try{de(Xe=>({...Xe,isChecking:!0}));const Me=await nr.getTwilioRequirements(et);if(console.log("Twilio Requirements:",Me),Me&&Me.requirements){const Xe=[];Me.endUserType&&Xe.push({id:"end_user",name:`${Me.endUserType} Information`,type:"textual",description:`Please provide details for ${Me.endUserType}`,example:"Business Name / Individual Name",acceptance_criteria:{}}),Array.isArray(Me.requirements)&&Me.requirements.forEach((it,Et)=>{Xe.push({id:it.sid||`doc_${Et}`,name:it.friendlyName||it.name||"Supporting Document",type:"document",description:it.description||"Upload required document",example:"Passport, Utility Bill",acceptance_criteria:{}})}),B({hasRequirements:Xe.length>0,requirements:Xe}),de({isChecking:!1,hasRequirements:Xe.length>0,isComplete:!1,error:null,groupId:Me.regulationSid,totalRequirements:Xe.length,pendingRequirements:Xe.length,completedRequirements:[]})}else de({isChecking:!1,hasRequirements:!1,isComplete:!0,error:null})}catch(Me){console.error("Error fetching Twilio requirements:",Me),de(Xe=>({...Xe,isChecking:!1,error:"Failed to fetch requirements"}))}},ue=async q=>{if(!n||!i||await le())return;const Fe=d.find(Xe=>Xe._id===n);if(!Fe?.destination_zone?.cca2){console.error("No destination zone found for gig");return}const et=q||Fe.destination_zone.cca2;y(et);try{const Xe=await nr.searchPhoneNumbers(et,"telnyx");if(v(Array.isArray(Xe)?Xe:[]),!Array.isArray(Xe)||Xe.length===0){console.log("No available numbers for this destination zone, skipping requirements check"),de({isChecking:!1,hasRequirements:!1,isComplete:!1,error:null});return}}catch(Xe){console.error("Error checking available numbers:",Xe)}const Me=De.get(`telnyxRequirementGroup_${i}_${et}`);if(Me)try{const{group:Xe}=await rr.getOrCreateGroup(i,et);await new Promise(yt=>setTimeout(yt,1e3));const it=await rr.getDetailedGroupStatus(Me),Et=Math.round(it.completedRequirements.length/it.totalRequirements*100);it.isComplete?de({isChecking:!1,hasRequirements:!1,isComplete:!0,error:null,groupId:Me,telnyxId:Xe.telnyxId,completionPercentage:100,completedRequirements:it.completedRequirements,totalRequirements:it.totalRequirements,pendingRequirements:0}):de({isChecking:!1,hasRequirements:!0,isComplete:!1,error:null,groupId:Me,telnyxId:Xe.telnyxId,completionPercentage:Et,completedRequirements:it.completedRequirements,totalRequirements:it.totalRequirements,pendingRequirements:it.pendingRequirements}),ce()}catch(Xe){console.error("Failed to load requirement group:",Xe),De.remove(`telnyxRequirementGroup_${i}_${et}`),ue()}else try{const Xe=await rr.checkCountryRequirements(et);if(B(Xe),Xe.hasRequirements){const{group:it,isNew:Et}=await rr.getOrCreateGroup(i,et);if(Et)de({isChecking:!1,hasRequirements:!0,isComplete:!1,error:null,groupId:it._id,telnyxId:it.telnyxId,completionPercentage:0,completedRequirements:[],totalRequirements:Xe.requirements?.length||0,pendingRequirements:Xe.requirements?.length||0});else{const yt=await rr.getDetailedGroupStatus(it._id),xe=Math.round(yt.completedRequirements.length/yt.totalRequirements*100);de({isChecking:!1,hasRequirements:!0,isComplete:yt.isComplete,error:null,groupId:it._id,telnyxId:it.telnyxId,completionPercentage:xe,completedRequirements:yt.completedRequirements,totalRequirements:yt.totalRequirements,pendingRequirements:yt.pendingRequirements})}De.set(`telnyxRequirementGroup_${i}_${et}`,it._id,{expires:30})}else de({isChecking:!1,hasRequirements:!1,isComplete:!0,error:null});ce()}catch(Xe){console.error("Failed to check country requirements:",Xe),de({isChecking:!1,hasRequirements:!1,isComplete:!1,error:"Failed to check requirements"})}};k.useEffect(()=>{if(de({isChecking:!1,hasRequirements:!1,isComplete:!1,error:null}),v([]),E(null),I("idle"),D(null),_(!1),R(!1),!n||!i)return;const fe=d.find(Fe=>Fe._id===n)?.destination_zone?.cca2;e==="telnyx"?ue(fe):e==="twilio"?H(fe):(le(),fe&&ce(fe))},[e]),k.useEffect(()=>{if(!n||!i)return;v([]),E(null),I("idle"),D(null),_(!1),R(!1);const fe=d.find(Fe=>Fe._id===n)?.destination_zone?.cca2;e==="telnyx"?ue(fe):e==="twilio"?H(fe):(le(),fe&&ce(fe))},[n]);const F=async()=>{try{if(!i)return;console.log(" Checking step 5 status for company:",i);try{const fe=await Ae.get(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${i}/onboarding`);if(console.log(" API response for onboarding:",fe.data),fe.data&&fe.data.completedSteps&&Array.isArray(fe.data.completedSteps)){const Fe=fe.data.completedSteps;if(Fe.includes(5)){console.log(" Step 5 is already completed according to API"),C(Fe);return}else console.log(" Step 5 is not completed according to API")}}catch{console.log(" Could not fetch onboarding status from API, falling back to localStorage")}const q=localStorage.getItem("companyOnboardingProgress");if(q)try{const fe=JSON.parse(q);fe.completedSteps&&Array.isArray(fe.completedSteps)&&(console.log(" Found completed steps in localStorage:",fe.completedSteps),C(fe.completedSteps))}catch(fe){console.error("Error parsing stored progress:",fe)}}catch(q){console.error("Error checking completed steps:",q)}},ee=async()=>{if(i)try{p(!0),console.log(" Fetching gigs for company:",i);const q=await Ae.get(`undefined/gigs/company/${i}`);console.log(" Gigs response:",q.data);const fe=q.data;fe&&Array.isArray(fe.data)?(u(fe.data),console.log(" Loaded gigs:",fe.data.length)):(u([]),console.log(" No gigs found in response"))}catch(q){console.error(" Error fetching gigs:",q),u([])}finally{p(!1)}},re=async()=>{try{if(!n){console.error(" No selectedGigId available"),g([]);return}console.log(" Checking numbers for gig:",n);const q=await nr.listPhoneNumbers(n);console.log(" Check result:",q),q?.hasNumber&&q.number?g([q.number]):g([])}catch(q){console.error(" Error checking gig numbers:",q),g([])}},te=q=>q.phoneNumber||q.phone_number||"",ce=async q=>{const fe=q||x;if(!fe){console.error("Destination zone not available");return}console.log(" Searching phone numbers with destination zone:",fe),console.log(" Using provider:",e);try{const Fe=await nr.searchPhoneNumbers(fe,e);console.log(" Phone numbers found:",Fe),v(Array.isArray(Fe)?Fe:[])}catch(Fe){console.error("Error searching numbers:",Fe),v([])}},Se=async(q,fe)=>{if(!n||!i){console.error(" Required IDs missing:",{selectedGigId:n,companyId:i}),E("Configuration error: Required IDs not found"),I("error");return}try{if(console.log(" Starting purchase process:",{phoneNumber:q,provider:e,selectedGigId:n,requirementStatus:G,options:fe}),e==="telnyx"){if(G.isChecking){E("Please wait while we check requirements..."),I("error");return}if(G.error){E("Cannot proceed: Failed to check requirements"),I("error");return}if(G.hasRequirements&&!G.isComplete){E("Please complete the requirements before purchasing"),I("error");return}if(G.hasRequirements&&!G.groupId){E("Missing requirement group ID. Please try again."),I("error");return}}if(E(null),I("purchasing"),!i)throw new Error("Company ID is required");const Fe={phoneNumber:q,provider:e,gigId:n,companyId:i,requirementGroupId:e==="telnyx"?G.telnyxId:void 0,bundleSid:fe?.bundleSid,addressSid:fe?.addressSid};console.log(" Purchase request data:",Fe);const et=await nr.purchasePhoneNumber(Fe);if(console.log(" Purchase response:",et),!et||et.error){const Me=et?.message||et?.error||"Failed to purchase number";throw new Error(Me)}console.log(" Number purchased successfully!"),v(Me=>Me.filter(Xe=>te(Xe)!==q)),await re(),I("success"),L(et?.data||{phoneNumber:q,status:e==="twilio"?"active":"pending",features:{voice:!0,sms:!0,mms:!0},provider:e})}catch(Fe){console.error(" Error purchasing number:",Fe),I("error"),E(Fe instanceof Error?Fe.message:"Failed to purchase number. Please try again.")}},Pe=async()=>{try{if(!i)throw console.error("Company ID not found in cookies"),new Error("Company ID not found. Please refresh the page and try again.");if(!n){alert(" Please select a gig before saving the configuration.");return}console.log(" Completing telephony setup...");try{const fe=(await Ae.get(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${i}/onboarding`)).data?.completedSteps||[],Fe=fe.includes(5)?fe:[...fe,5],et=await Ae.put(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${i}/onboarding`,{completedSteps:Fe,currentPhase:2});console.log(" Telephony setup step 5 marked as completed via general onboarding:",et.data)}catch{console.log(" Could not update via general onboarding API, trying individual step endpoint...");try{const fe=await Ae.put(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${i}/onboarding/phases/2/steps/5`,{status:"completed"});console.log(" Telephony setup step 5 marked as completed via individual endpoint:",fe.data)}catch{console.log(" Individual step endpoint also failed, proceeding with localStorage only")}}C(q=>{const fe=q.includes(5)?q:[...q,5],Fe={currentPhase:2,completedSteps:fe,lastUpdated:new Date().toISOString()};return localStorage.setItem("companyOnboardingProgress",JSON.stringify(Fe)),fe}),De.set("telephonyStepCompleted","true",{expires:7}),await new Promise(q=>setTimeout(q,200)),t?setTimeout(()=>{t()},100):window.history&&window.history.pushState?(window.history.pushState({},"","/app11"),window.dispatchEvent(new PopStateEvent("popstate"))):window.dispatchEvent(new CustomEvent("telephonySetupCompleted",{detail:{stepId:5,status:"completed"}}))}catch(q){console.error("Error updating onboarding progress:",q),q instanceof Error?console.log(`Error: ${q.message}`):console.log("An error occurred while saving the configuration. Please try again.")}},$e=async q=>{try{if(console.log(" Submitting requirements:",q),!i)throw new Error("Company ID is required");if(e==="twilio"){const fe=G.groupId;if(!fe)throw new Error("Regulation SID missing");const Fe=q.end_user;let et;Fe&&(et=(await nr.createTwilioEndUser({friendlyName:typeof Fe=="string"?Fe:"End User",type:K.requirements?.find(Et=>Et.id==="end_user")?.name.split(" ")[0].toLowerCase()||"individual",attributes:{}})).sid,console.log(" Created Twilio End User:",et));const Xe=(await nr.createTwilioBundle({friendlyName:`Bundle for ${x}`,email:"admin@example.com",regulationSid:fe,isoCountry:x})).sid;console.log(" Created Twilio Bundle:",Xe),et&&await nr.assignItemToBundle(Xe,et);for(const[it,Et]of Object.entries(q))if(it!=="end_user"&&Et instanceof File){const xe=await nr.createTwilioDocument(Et,Et.name,"supporting_document",{});console.log(` Uploaded Document ${it}:`,xe.sid),await nr.assignItemToBundle(Xe,xe.sid)}await nr.submitTwilioBundle(Xe),console.log(" Submitted Twilio Bundle"),Ne({bundleSid:Xe}),de(it=>({...it,isComplete:!0})),I("confirming")}else{let fe=G.groupId;if(fe)console.log(" Using existing requirement group:",fe);else{const{group:et}=await rr.getOrCreateGroup(i,x);fe=et._id,console.log(" Created new requirement group:",et)}for(const[et,Me]of Object.entries(q))Me instanceof File?await rr.submitDocument(fe,et,Me):await rr.submitTextValue(fe,et,Me);const Fe=await rr.validateRequirements(fe);if(console.log(" Validation result:",Fe),Fe.isValid)de(et=>({...et,isComplete:!0})),I("confirming");else throw new Error("Some requirements are still missing or invalid")}}catch(fe){console.error(" Error submitting requirements:",fe),E(fe instanceof Error?fe.message:"Failed to submit requirements"),I("error")}},rt=async q=>{if($){I("purchasing");try{await Se($,q||ve||{})}catch(fe){I("error"),E(fe instanceof Error?fe.message:"Failed to purchase number")}}};return a.jsxs("div",{className:"space-y-6",children:[l&&a.jsx("div",{className:"rounded-lg bg-yellow-50 p-4",children:a.jsxs("div",{className:"flex",children:[a.jsx(hs,{className:"h-5 w-5 text-yellow-400"}),a.jsxs("div",{className:"ml-3",children:[a.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Configuration Error"}),a.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:a.jsx("p",{children:l})})]})]})}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Telephony Setup"}),N.includes(5)&&a.jsx(ht,{className:"h-6 w-6 text-green-500"})]}),a.jsx("p",{className:"text-sm text-gray-500",children:"Configure your call center infrastructure"})]}),a.jsx("div",{className:"flex space-x-3",children:a.jsx("button",{className:`rounded-lg px-4 py-2 text-sm font-medium transition-all duration-200 ${N.includes(5)?"bg-green-600 text-white cursor-not-allowed":n?"bg-indigo-600 text-white hover:bg-indigo-700 hover:shadow-md":"bg-gray-400 text-white cursor-not-allowed"}`,onClick:N.includes(5)||!n?void 0:Pe,disabled:N.includes(5)||!n,title:n?"":"Please select a gig first",children:N.includes(5)?a.jsxs("span",{className:"flex items-center",children:[a.jsx(ht,{className:"mr-2 h-4 w-4"}),"Configuration Saved"]}):n?"Save Configuration":a.jsxs("span",{className:"flex items-center",children:[a.jsx(hs,{className:"mr-2 h-4 w-4"}),"Select Gig First"]})})})]}),a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-blue-50 to-indigo-100 p-6 shadow-lg border border-blue-200",children:[a.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"rounded-full bg-blue-500 p-2",children:a.jsx(Ir,{className:"h-5 w-5 text-white"})})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("h3",{className:"text-xl font-semibold text-blue-900",children:"Select Gig"}),a.jsx("span",{className:"inline-flex items-center rounded-full bg-red-500 px-3 py-1 text-xs font-semibold text-white shadow-sm",children:"Required"})]}),a.jsxs("p",{className:"mt-1 text-sm text-blue-700",children:["Choose the gig for which you want to configure telephony ",a.jsx("span",{className:"text-blue-600 font-medium",children:"*"})]})]})]}),h?a.jsxs("div",{className:"mt-6 flex items-center justify-center space-x-3 p-4 rounded-lg bg-white/50 backdrop-blur-sm",children:[a.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-2 border-blue-200 border-t-blue-600"}),a.jsx("span",{className:"text-sm font-medium text-blue-700",children:"Loading gigs..."})]}):d.length>0?a.jsx("div",{className:"mt-6",children:a.jsxs("div",{className:"relative gig-dropdown",children:[a.jsxs("button",{type:"button",className:`relative w-full rounded-xl border-2 py-4 pl-5 pr-12 text-left text-base font-medium transition-all duration-300 shadow-md ${n?"border-blue-400 bg-blue-50 text-blue-900 focus:border-blue-500 focus:ring-blue-500 shadow-blue-200/50":"border-blue-200 bg-white text-blue-800 focus:border-blue-400 focus:ring-blue-400 hover:border-blue-300"} focus:outline-none focus:ring-2 focus:ring-opacity-50`,onClick:()=>m(!f),children:[a.jsx("span",{className:"flex items-center",children:n?(()=>{const q=d.find(fe=>fe._id===n);return q?a.jsxs(a.Fragment,{children:[q.title," - ",q.destination_zone.name.common,a.jsx("img",{src:q.destination_zone.flags?.png,alt:q.destination_zone.flags?.alt,className:"inline-block w-6 h-4 ml-2 rounded-sm border border-gray-200 object-cover"})]}):"Select a gig..."})():" Select a gig (required)..."}),a.jsx("span",{className:"absolute inset-y-0 right-0 flex items-center pr-4",children:a.jsx(Cl,{className:`h-5 w-5 text-blue-400 transition-transform ${f?"rotate-180":""}`})})]}),f&&a.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white border-2 border-blue-200 rounded-xl shadow-lg max-h-60 overflow-auto",children:d.map(q=>a.jsx("button",{type:"button",className:"relative w-full px-5 py-4 text-left hover:bg-blue-50 focus:bg-blue-50 focus:outline-none transition-colors duration-150 first:rounded-t-xl last:rounded-b-xl",onClick:()=>{r(q._id),m(!1)},children:a.jsxs("div",{className:"flex items-center",children:[a.jsxs("span",{className:"text-blue-800 font-medium",children:[" ",q.title," - ",q.destination_zone.name.common]}),a.jsx("img",{src:q.destination_zone.flags?.png,alt:q.destination_zone.flags?.alt,className:"inline-block w-6 h-4 ml-2 rounded-sm border border-gray-200 object-cover"})]})},q._id))}),n&&a.jsx("div",{className:"absolute inset-y-0 right-10 flex items-center pointer-events-none",children:a.jsx(ht,{className:"h-6 w-6 text-blue-500 drop-shadow-sm"})})]})}):a.jsx("div",{className:"mt-6 rounded-xl bg-gradient-to-r from-blue-50 to-indigo-50 p-6 border-2 border-blue-200",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"rounded-full bg-blue-100 p-2",children:a.jsx(hs,{className:"h-6 w-6 text-blue-500"})})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"No Gigs Found"}),a.jsx("p",{className:"text-sm text-blue-700 leading-relaxed",children:"No gigs were found for this company. Please create a gig first before configuring telephony."})]})]})})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Select Provider"}),a.jsx("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-3",children:ae.map(q=>{const fe=q.logo;return a.jsxs("button",{className:`flex items-center justify-center rounded-lg border p-4 ${e===q.id?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:bg-gray-50"}`,onClick:()=>s(q.id),children:[a.jsx(fe,{className:"mr-2 h-5 w-5 text-indigo-600"}),a.jsx("span",{className:"font-medium text-gray-900",children:q.name})]},q.id)})})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Phone Numbers"}),x&&n&&(()=>{const q=d.find(fe=>fe._id===n);return q?a.jsxs("span",{className:"text-sm text-gray-600",children:["Destination Zone: ",a.jsx("span",{className:"font-medium",children:q.destination_zone.name.common})]}):null})()]}),e==="telnyx"&&G.hasRequirements&&!G.isComplete&&a.jsx("div",{className:"mb-4 rounded-lg bg-yellow-50 p-4",children:a.jsxs("div",{className:"flex",children:[a.jsx(hs,{className:"h-5 w-5 text-yellow-400"}),a.jsxs("div",{className:"ml-3 flex-grow",children:[a.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Requirements Needed"}),a.jsxs("div",{className:"mt-2 text-sm text-yellow-700",children:[a.jsx("p",{children:"To purchase numbers in this country, you need to complete all required information."}),G.completionPercentage!==void 0&&a.jsxs("div",{className:"mt-2",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsxs("span",{className:"text-xs font-medium text-yellow-800",children:["Progress: ",G.completionPercentage,"%"]}),a.jsxs("span",{className:"text-xs font-medium text-yellow-800",children:[G.completedRequirements?.length||0," / ",G.totalRequirements||0]})]}),a.jsx("div",{className:"w-full bg-yellow-200 rounded-full h-2",children:a.jsx("div",{className:"bg-yellow-600 h-2 rounded-full transition-all duration-300",style:{width:`${G.completionPercentage}%`}})})]}),a.jsx("button",{onClick:async()=>{if(K.requirements?.length)R(!0);else{const q=d.find(fe=>fe._id===n);if(q?.destination_zone?.cca2){const fe=await rr.checkCountryRequirements(q.destination_zone.cca2);B(fe),fe.requirements?.length?R(!0):console.warn("No requirements found for country:",q.destination_zone.cca2)}}},className:"mt-3 inline-flex items-center rounded-md bg-yellow-100 px-3 py-2 text-sm font-medium text-yellow-800 hover:bg-yellow-200 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2",children:G.completedRequirements?.length?"Continue Requirements":"Start Requirements"})]})]})]})}),e==="telnyx"?a.jsxs("div",{className:"mb-6 space-y-2",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Purchased Telnyx Numbers"}),a.jsx("div",{className:"grid gap-2",children:Array.isArray(b)&&b.filter(q=>q.provider==="telnyx").length>0?b.filter(q=>q.provider==="telnyx").map(q=>a.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"font-medium",children:q.phoneNumber}),a.jsxs("span",{className:"text-sm text-gray-500",children:["Status: ",q.status]})]}),a.jsx("div",{className:"flex items-center",children:a.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${q.status==="active"?"bg-green-100 text-green-800":q.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:q.status})})]},q.phoneNumber)):a.jsx("div",{className:"rounded-lg border border-gray-200 p-4 text-center text-gray-500",children:"No phone number purchased for this gig yet"})})]}):e==="twilio"&&a.jsxs("div",{className:"mb-6 space-y-2",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"Purchased Twilio Numbers"}),a.jsx("div",{className:"grid gap-2",children:Array.isArray(b)&&b.filter(q=>q.provider==="twilio").length>0?b.filter(q=>q.provider==="twilio").map(q=>a.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"font-medium",children:q.phoneNumber}),a.jsxs("span",{className:"text-sm text-gray-500",children:["Status: ",q.status]})]}),a.jsx("div",{className:"flex items-center",children:a.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${q.status==="active"?"bg-green-100 text-green-800":q.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:q.status})})]},q.phoneNumber)):a.jsx("div",{className:"rounded-lg border border-gray-200 p-4 text-center text-gray-500",children:"No Twilio numbers purchased yet"})}),Array.isArray(w)&&w.length>0?a.jsxs("div",{className:"mt-4",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Available Numbers"}),a.jsx("div",{className:"grid gap-2",children:w.map(q=>{const fe=te(q);return a.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"font-medium",children:fe}),q.locality&&a.jsxs("span",{className:"text-sm text-gray-500",children:[q.locality,", ",q.region]})]}),a.jsx("button",{onClick:()=>{D(fe),I("confirming"),_(!0)},disabled:b.length>0,className:`rounded-md px-3 py-1 text-sm text-white ${b.length>0?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,title:b.length>0?"A number is already purchased for this gig":void 0,children:"Purchase"})]},fe)})})]}):x&&a.jsx("div",{className:"mt-4 rounded-lg bg-yellow-50 p-4",children:a.jsxs("div",{className:"flex",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(hs,{className:"h-5 w-5 text-yellow-400"})}),a.jsxs("div",{className:"ml-3 flex-1",children:[a.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"No Numbers Available"}),a.jsxs("div",{className:"mt-2 text-sm text-yellow-700",children:[a.jsx("p",{children:"No phone numbers available for this destination with Twilio."}),a.jsx("p",{className:"mt-1",children:"Try Telnyx instead or contact support if the issue persists."})]}),a.jsx("div",{className:"mt-3",children:a.jsx("button",{onClick:()=>s("telnyx"),className:"rounded-md px-3 py-1 text-xs text-white bg-indigo-600 hover:bg-indigo-700",children:"Try Telnyx Instead"})})]})]})})]}),x&&e==="telnyx"&&a.jsxs("div",{className:"mb-6 space-y-2",children:[a.jsxs("h4",{className:"text-sm font-medium text-gray-700",children:["Available Numbers (Destination: ",(()=>{const q=d.find(fe=>fe._id===n);return q?q.destination_zone.name.common:x})(),")"]}),a.jsx("div",{className:"grid gap-2",children:Array.isArray(w)&&w.length>0?w.map(q=>{const fe=te(q),Fe=b.length>0||G.hasRequirements&&!G.isComplete,et=b.length>0?"A number is already purchased for this gig":G.hasRequirements&&!G.isComplete?"Please complete the requirements before purchasing":void 0;return a.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-3",children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"font-medium",children:fe}),q.locality&&a.jsxs("span",{className:"text-sm text-gray-500",children:[q.locality,", ",q.region]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[Fe&&a.jsx("span",{className:"text-xs text-gray-500 italic mr-2",children:et}),a.jsx("button",{onClick:()=>{D(fe),I("confirming"),_(!0)},disabled:Fe,className:`rounded-md px-3 py-1 text-sm text-white ${Fe?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"}`,title:et,children:"Purchase"})]})]},fe)}):a.jsxs("div",{className:"rounded-lg border border-gray-200 p-4",children:[a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx(hs,{className:"h-5 w-5 text-yellow-400 mr-2"}),a.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"No Numbers Available"})]}),a.jsxs("div",{className:"mt-2 text-sm text-center text-gray-500",children:[a.jsx("p",{className:"mb-2",children:"No Telnyx phone numbers are currently available for this destination."}),a.jsx("p",{className:"text-sm text-gray-400",children:"You can try again later or contact support if you need immediate assistance."})]})]})})]})]}),a.jsx(TO,{isOpen:P,onClose:async()=>{j==="success"&&await re(),e==="telnyx"&&await ce(),_(!1),I("idle"),D(null),L(null)},purchaseStatus:j,purchaseResponse:X,selectedNumber:$,countryReq:K,requirementStatus:G,provider:e,purchaseError:T,onSubmitRequirements:$e,onConfirmPurchase:rt,onSetPurchaseStatus:I,onSetSelectedNumber:D,onSetShowPurchaseModal:_}),a.jsx(GL,{isOpen:O,onClose:async()=>{if(G.groupId)try{const q=await rr.getDetailedGroupStatus(G.groupId),fe=Math.round(q.completedRequirements.length/q.totalRequirements*100);de(Fe=>({...Fe,isComplete:q.isComplete,completionPercentage:fe,completedRequirements:q.completedRequirements,totalRequirements:q.totalRequirements,pendingRequirements:q.pendingRequirements,hasRequirements:q.isComplete?!1:Fe.hasRequirements}))}catch(q){console.error("Error updating requirement status on close:",q)}R(!1)},countryCode:x,requirements:K.requirements||[],existingValues:G.completedRequirements?.map(q=>({field:q.id,value:JSON.stringify(q.value),status:q.status,submittedAt:q.submittedAt})),requirementGroupId:G.groupId,requirementStatus:G,onSubmit:async q=>{try{if(await $e(q),G.groupId){const fe=await rr.getDetailedGroupStatus(G.groupId),Fe=Math.round(fe.completedRequirements.length/fe.totalRequirements*100);de(et=>({...et,isComplete:fe.isComplete,completionPercentage:Fe,completedRequirements:fe.completedRequirements,totalRequirements:fe.totalRequirements,pendingRequirements:fe.pendingRequirements,hasRequirements:fe.isComplete?!1:et.hasRequirements}))}R(!1)}catch(fe){console.error("Error submitting requirements:",fe)}}})]})};/*!
* sweetalert2 v11.22.0
* Released under the MIT License.
*/function yN(t,e,s){if(typeof t=="function"?t===e:t.has(e))return arguments.length<3?e:s;throw new TypeError("Private element is not present on this object")}function HL(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function wN(t,e){return t.get(yN(t,e))}function qL(t,e,s){HL(t,e),e.set(t,s)}function KL(t,e,s){return t.set(yN(t,e),s),s}const XL=100,ot={},YL=()=>{ot.previousActiveElement instanceof HTMLElement?(ot.previousActiveElement.focus(),ot.previousActiveElement=null):document.body&&document.body.focus()},ZL=t=>new Promise(e=>{if(!t)return e();const s=window.scrollX,n=window.scrollY;ot.restoreFocusTimeout=setTimeout(()=>{YL(),e()},XL),window.scrollTo(s,n)}),vN="swal2-",ye=["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error","draggable","dragging"].reduce((t,e)=>(t[e]=vN+e,t),{}),$p=["success","warning","info","question","error"].reduce((t,e)=>(t[e]=vN+e,t),{}),NN="SweetAlert2:",Mx=t=>t.charAt(0).toUpperCase()+t.slice(1),xn=t=>{console.warn(`${NN} ${typeof t=="object"?t.join(" "):t}`)},ba=t=>{console.error(`${NN} ${t}`)},kN=[],JL=t=>{kN.includes(t)||(kN.push(t),xn(t))},CN=(t,e=null)=>{JL(`"${t}" is deprecated and will be removed in the next major release.${e?` Use "${e}" instead.`:""}`)},Tp=t=>typeof t=="function"?t():t,Lx=t=>t&&typeof t.toPromise=="function",cd=t=>Lx(t)?t.toPromise():Promise.resolve(t),zx=t=>t&&Promise.resolve(t)===t,bn=()=>document.body.querySelector(`.${ye.container}`),dd=t=>{const e=bn();return e?e.querySelector(t):null},Un=t=>dd(`.${t}`),Pt=()=>Un(ye.popup),Rl=()=>Un(ye.icon),QL=()=>Un(ye["icon-content"]),SN=()=>Un(ye.title),Bx=()=>Un(ye["html-container"]),jN=()=>Un(ye.image),Ux=()=>Un(ye["progress-steps"]),Ap=()=>Un(ye["validation-message"]),si=()=>dd(`.${ye.actions} .${ye.confirm}`),Pl=()=>dd(`.${ye.actions} .${ye.cancel}`),ya=()=>dd(`.${ye.actions} .${ye.deny}`),e5=()=>Un(ye["input-label"]),Fl=()=>dd(`.${ye.loader}`),ud=()=>Un(ye.actions),IN=()=>Un(ye.footer),Dp=()=>Un(ye["timer-progress-bar"]),Vx=()=>Un(ye.close),t5=`
  a[href],
  area[href],
  input:not([disabled]),
  select:not([disabled]),
  textarea:not([disabled]),
  button:not([disabled]),
  iframe,
  object,
  embed,
  [tabindex="0"],
  [contenteditable],
  audio[controls],
  video[controls],
  summary
`,Wx=()=>{const t=Pt();if(!t)return[];const e=t.querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])'),s=Array.from(e).sort((i,o)=>{const l=parseInt(i.getAttribute("tabindex")||"0"),c=parseInt(o.getAttribute("tabindex")||"0");return l>c?1:l<c?-1:0}),n=t.querySelectorAll(t5),r=Array.from(n).filter(i=>i.getAttribute("tabindex")!=="-1");return[...new Set(s.concat(r))].filter(i=>Tn(i))},Gx=()=>Ki(document.body,ye.shown)&&!Ki(document.body,ye["toast-shown"])&&!Ki(document.body,ye["no-backdrop"]),_p=()=>{const t=Pt();return t?Ki(t,ye.toast):!1},s5=()=>{const t=Pt();return t?t.hasAttribute("data-loading"):!1},Vn=(t,e)=>{if(t.textContent="",e){const n=new DOMParser().parseFromString(e,"text/html"),r=n.querySelector("head");r&&Array.from(r.childNodes).forEach(o=>{t.appendChild(o)});const i=n.querySelector("body");i&&Array.from(i.childNodes).forEach(o=>{o instanceof HTMLVideoElement||o instanceof HTMLAudioElement?t.appendChild(o.cloneNode(!0)):t.appendChild(o)})}},Ki=(t,e)=>{if(!e)return!1;const s=e.split(/\s+/);for(let n=0;n<s.length;n++)if(!t.classList.contains(s[n]))return!1;return!0},n5=(t,e)=>{Array.from(t.classList).forEach(s=>{!Object.values(ye).includes(s)&&!Object.values($p).includes(s)&&!Object.values(e.showClass||{}).includes(s)&&t.classList.remove(s)})},Wn=(t,e,s)=>{if(n5(t,e),!e.customClass)return;const n=e.customClass[s];if(n){if(typeof n!="string"&&!n.forEach){xn(`Invalid type of customClass.${s}! Expected string or iterable object, got "${typeof n}"`);return}zt(t,n)}},Rp=(t,e)=>{if(!e)return null;switch(e){case"select":case"textarea":case"file":return t.querySelector(`.${ye.popup} > .${ye[e]}`);case"checkbox":return t.querySelector(`.${ye.popup} > .${ye.checkbox} input`);case"radio":return t.querySelector(`.${ye.popup} > .${ye.radio} input:checked`)||t.querySelector(`.${ye.popup} > .${ye.radio} input:first-child`);case"range":return t.querySelector(`.${ye.popup} > .${ye.range} input`);default:return t.querySelector(`.${ye.popup} > .${ye.input}`)}},EN=t=>{if(t.focus(),t.type!=="file"){const e=t.value;t.value="",t.value=e}},$N=(t,e,s)=>{!t||!e||(typeof e=="string"&&(e=e.split(/\s+/).filter(Boolean)),e.forEach(n=>{Array.isArray(t)?t.forEach(r=>{s?r.classList.add(n):r.classList.remove(n)}):s?t.classList.add(n):t.classList.remove(n)}))},zt=(t,e)=>{$N(t,e,!0)},ar=(t,e)=>{$N(t,e,!1)},vo=(t,e)=>{const s=Array.from(t.children);for(let n=0;n<s.length;n++){const r=s[n];if(r instanceof HTMLElement&&Ki(r,e))return r}},wa=(t,e,s)=>{s===`${parseInt(s)}`&&(s=parseInt(s)),s||parseInt(s)===0?t.style.setProperty(e,typeof s=="number"?`${s}px`:s):t.style.removeProperty(e)},Bs=(t,e="flex")=>{t&&(t.style.display=e)},rn=t=>{t&&(t.style.display="none")},Hx=(t,e="block")=>{t&&new MutationObserver(()=>{hd(t,t.innerHTML,e)}).observe(t,{childList:!0,subtree:!0})},TN=(t,e,s,n)=>{const r=t.querySelector(e);r&&r.style.setProperty(s,n)},hd=(t,e,s="flex")=>{e?Bs(t,s):rn(t)},Tn=t=>!!(t&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)),r5=()=>!Tn(si())&&!Tn(ya())&&!Tn(Pl()),qx=t=>t.scrollHeight>t.clientHeight,i5=(t,e)=>{let s=t;for(;s&&s!==e;){if(qx(s))return!0;s=s.parentElement}return!1},AN=t=>{const e=window.getComputedStyle(t),s=parseFloat(e.getPropertyValue("animation-duration")||"0"),n=parseFloat(e.getPropertyValue("transition-duration")||"0");return s>0||n>0},Kx=(t,e=!1)=>{const s=Dp();s&&Tn(s)&&(e&&(s.style.transition="none",s.style.width="100%"),setTimeout(()=>{s.style.transition=`width ${t/1e3}s linear`,s.style.width="0%"},10))},o5=()=>{const t=Dp();if(!t)return;const e=parseInt(window.getComputedStyle(t).width);t.style.removeProperty("transition"),t.style.width="100%";const s=parseInt(window.getComputedStyle(t).width),n=e/s*100;t.style.width=`${n}%`},a5=()=>typeof window>"u"||typeof document>"u",l5=`
 <div aria-labelledby="${ye.title}" aria-describedby="${ye["html-container"]}" class="${ye.popup}" tabindex="-1">
   <button type="button" class="${ye.close}"></button>
   <ul class="${ye["progress-steps"]}"></ul>
   <div class="${ye.icon}"></div>
   <img class="${ye.image}" />
   <h2 class="${ye.title}" id="${ye.title}"></h2>
   <div class="${ye["html-container"]}" id="${ye["html-container"]}"></div>
   <input class="${ye.input}" id="${ye.input}" />
   <input type="file" class="${ye.file}" />
   <div class="${ye.range}">
     <input type="range" />
     <output></output>
   </div>
   <select class="${ye.select}" id="${ye.select}"></select>
   <div class="${ye.radio}"></div>
   <label class="${ye.checkbox}">
     <input type="checkbox" id="${ye.checkbox}" />
     <span class="${ye.label}"></span>
   </label>
   <textarea class="${ye.textarea}" id="${ye.textarea}"></textarea>
   <div class="${ye["validation-message"]}" id="${ye["validation-message"]}"></div>
   <div class="${ye.actions}">
     <div class="${ye.loader}"></div>
     <button type="button" class="${ye.confirm}"></button>
     <button type="button" class="${ye.deny}"></button>
     <button type="button" class="${ye.cancel}"></button>
   </div>
   <div class="${ye.footer}"></div>
   <div class="${ye["timer-progress-bar-container"]}">
     <div class="${ye["timer-progress-bar"]}"></div>
   </div>
 </div>
`.replace(/(^|\n)\s*/g,""),c5=()=>{const t=bn();return t?(t.remove(),ar([document.documentElement,document.body],[ye["no-backdrop"],ye["toast-shown"],ye["has-column"]]),!0):!1},va=()=>{ot.currentInstance.resetValidationMessage()},d5=()=>{const t=Pt(),e=vo(t,ye.input),s=vo(t,ye.file),n=t.querySelector(`.${ye.range} input`),r=t.querySelector(`.${ye.range} output`),i=vo(t,ye.select),o=t.querySelector(`.${ye.checkbox} input`),l=vo(t,ye.textarea);e.oninput=va,s.onchange=va,i.onchange=va,o.onchange=va,l.oninput=va,n.oninput=()=>{va(),r.value=n.value},n.onchange=()=>{va(),r.value=n.value}},u5=t=>typeof t=="string"?document.querySelector(t):t,h5=t=>{const e=Pt();e.setAttribute("role",t.toast?"alert":"dialog"),e.setAttribute("aria-live",t.toast?"polite":"assertive"),t.toast||e.setAttribute("aria-modal","true")},p5=t=>{window.getComputedStyle(t).direction==="rtl"&&zt(bn(),ye.rtl)},f5=t=>{const e=c5();if(a5()){ba("SweetAlert2 requires document to initialize");return}const s=document.createElement("div");s.className=ye.container,e&&zt(s,ye["no-transition"]),Vn(s,l5),s.dataset.swal2Theme=t.theme;const n=u5(t.target);n.appendChild(s),t.topLayer&&(s.setAttribute("popover",""),s.showPopover()),h5(t),p5(n),d5()},Xx=(t,e)=>{t instanceof HTMLElement?e.appendChild(t):typeof t=="object"?m5(t,e):t&&Vn(e,t)},m5=(t,e)=>{t.jquery?g5(e,t):Vn(e,t.toString())},g5=(t,e)=>{if(t.textContent="",0 in e)for(let s=0;s in e;s++)t.appendChild(e[s].cloneNode(!0));else t.appendChild(e.cloneNode(!0))},x5=(t,e)=>{const s=ud(),n=Fl();!s||!n||(!e.showConfirmButton&&!e.showDenyButton&&!e.showCancelButton?rn(s):Bs(s),Wn(s,e,"actions"),b5(s,n,e),Vn(n,e.loaderHtml||""),Wn(n,e,"loader"))};function b5(t,e,s){const n=si(),r=ya(),i=Pl();!n||!r||!i||(Zx(n,"confirm",s),Zx(r,"deny",s),Zx(i,"cancel",s),y5(n,r,i,s),s.reverseButtons&&(s.toast?(t.insertBefore(i,n),t.insertBefore(r,n)):(t.insertBefore(i,e),t.insertBefore(r,e),t.insertBefore(n,e))))}function y5(t,e,s,n){if(!n.buttonsStyling){ar([t,e,s],ye.styled);return}zt([t,e,s],ye.styled),n.confirmButtonColor&&t.style.setProperty("--swal2-confirm-button-background-color",n.confirmButtonColor),n.denyButtonColor&&e.style.setProperty("--swal2-deny-button-background-color",n.denyButtonColor),n.cancelButtonColor&&s.style.setProperty("--swal2-cancel-button-background-color",n.cancelButtonColor),Yx(t),Yx(e),Yx(s)}function Yx(t){const e=window.getComputedStyle(t);if(e.getPropertyValue("--swal2-action-button-focus-box-shadow"))return;const s=e.backgroundColor.replace(/rgba?\((\d+), (\d+), (\d+).*/,"rgba($1, $2, $3, 0.5)");t.style.setProperty("--swal2-action-button-focus-box-shadow",e.getPropertyValue("--swal2-outline").replace(/ rgba\(.*/,` ${s}`))}function Zx(t,e,s){const n=Mx(e);hd(t,s[`show${n}Button`],"inline-block"),Vn(t,s[`${e}ButtonText`]||""),t.setAttribute("aria-label",s[`${e}ButtonAriaLabel`]||""),t.className=ye[e],Wn(t,s,`${e}Button`)}const w5=(t,e)=>{const s=Vx();s&&(Vn(s,e.closeButtonHtml||""),Wn(s,e,"closeButton"),hd(s,e.showCloseButton),s.setAttribute("aria-label",e.closeButtonAriaLabel||""))},v5=(t,e)=>{const s=bn();s&&(N5(s,e.backdrop),k5(s,e.position),C5(s,e.grow),Wn(s,e,"container"))};function N5(t,e){typeof e=="string"?t.style.background=e:e||zt([document.documentElement,document.body],ye["no-backdrop"])}function k5(t,e){e&&(e in ye?zt(t,ye[e]):(xn('The "position" parameter is not valid, defaulting to "center"'),zt(t,ye.center)))}function C5(t,e){e&&zt(t,ye[`grow-${e}`])}var ts={innerParams:new WeakMap,domCache:new WeakMap};const S5=["input","file","range","select","radio","checkbox","textarea"],j5=(t,e)=>{const s=Pt();if(!s)return;const n=ts.innerParams.get(t),r=!n||e.input!==n.input;S5.forEach(i=>{const o=vo(s,ye[i]);o&&($5(i,e.inputAttributes),o.className=ye[i],r&&rn(o))}),e.input&&(r&&I5(e),T5(e))},I5=t=>{if(!t.input)return;if(!ws[t.input]){ba(`Unexpected type of input! Expected ${Object.keys(ws).join(" | ")}, got "${t.input}"`);return}const e=DN(t.input);if(!e)return;const s=ws[t.input](e,t);Bs(e),t.inputAutoFocus&&setTimeout(()=>{EN(s)})},E5=t=>{for(let e=0;e<t.attributes.length;e++){const s=t.attributes[e].name;["id","type","value","style"].includes(s)||t.removeAttribute(s)}},$5=(t,e)=>{const s=Pt();if(!s)return;const n=Rp(s,t);if(n){E5(n);for(const r in e)n.setAttribute(r,e[r])}},T5=t=>{if(!t.input)return;const e=DN(t.input);e&&Wn(e,t,"input")},Jx=(t,e)=>{!t.placeholder&&e.inputPlaceholder&&(t.placeholder=e.inputPlaceholder)},pd=(t,e,s)=>{if(s.inputLabel){const n=document.createElement("label"),r=ye["input-label"];n.setAttribute("for",t.id),n.className=r,typeof s.customClass=="object"&&zt(n,s.customClass.inputLabel),n.innerText=s.inputLabel,e.insertAdjacentElement("beforebegin",n)}},DN=t=>{const e=Pt();if(e)return vo(e,ye[t]||ye.input)},Pp=(t,e)=>{["string","number"].includes(typeof e)?t.value=`${e}`:zx(e)||xn(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof e}"`)},ws={};ws.text=ws.email=ws.password=ws.number=ws.tel=ws.url=ws.search=ws.date=ws["datetime-local"]=ws.time=ws.week=ws.month=(t,e)=>(Pp(t,e.inputValue),pd(t,t,e),Jx(t,e),t.type=e.input,t),ws.file=(t,e)=>(pd(t,t,e),Jx(t,e),t),ws.range=(t,e)=>{const s=t.querySelector("input"),n=t.querySelector("output");return Pp(s,e.inputValue),s.type=e.input,Pp(n,e.inputValue),pd(s,t,e),t},ws.select=(t,e)=>{if(t.textContent="",e.inputPlaceholder){const s=document.createElement("option");Vn(s,e.inputPlaceholder),s.value="",s.disabled=!0,s.selected=!0,t.appendChild(s)}return pd(t,t,e),t},ws.radio=t=>(t.textContent="",t),ws.checkbox=(t,e)=>{const s=Rp(Pt(),"checkbox");s.value="1",s.checked=!!e.inputValue;const n=t.querySelector("span");return Vn(n,e.inputPlaceholder||e.inputLabel),s},ws.textarea=(t,e)=>{Pp(t,e.inputValue),Jx(t,e),pd(t,t,e);const s=n=>parseInt(window.getComputedStyle(n).marginLeft)+parseInt(window.getComputedStyle(n).marginRight);return setTimeout(()=>{if("MutationObserver"in window){const n=parseInt(window.getComputedStyle(Pt()).width),r=()=>{if(!document.body.contains(t))return;const i=t.offsetWidth+s(t);i>n?Pt().style.width=`${i}px`:wa(Pt(),"width",e.width)};new MutationObserver(r).observe(t,{attributes:!0,attributeFilter:["style"]})}}),t};const A5=(t,e)=>{const s=Bx();s&&(Hx(s),Wn(s,e,"htmlContainer"),e.html?(Xx(e.html,s),Bs(s,"block")):e.text?(s.textContent=e.text,Bs(s,"block")):rn(s),j5(t,e))},D5=(t,e)=>{const s=IN();s&&(Hx(s),hd(s,e.footer,"block"),e.footer&&Xx(e.footer,s),Wn(s,e,"footer"))},_5=(t,e)=>{const s=ts.innerParams.get(t),n=Rl();if(!n)return;if(s&&e.icon===s.icon){PN(n,e),_N(n,e);return}if(!e.icon&&!e.iconHtml){rn(n);return}if(e.icon&&Object.keys($p).indexOf(e.icon)===-1){ba(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${e.icon}"`),rn(n);return}Bs(n),PN(n,e),_N(n,e),zt(n,e.showClass&&e.showClass.icon),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",RN)},_N=(t,e)=>{for(const[s,n]of Object.entries($p))e.icon!==s&&ar(t,n);zt(t,e.icon&&$p[e.icon]),F5(t,e),RN(),Wn(t,e,"icon")},RN=()=>{const t=Pt();if(!t)return;const e=window.getComputedStyle(t).getPropertyValue("background-color"),s=t.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let n=0;n<s.length;n++)s[n].style.backgroundColor=e},R5=`
  <div class="swal2-success-circular-line-left"></div>
  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>
  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>
  <div class="swal2-success-circular-line-right"></div>
`,P5=`
  <span class="swal2-x-mark">
    <span class="swal2-x-mark-line-left"></span>
    <span class="swal2-x-mark-line-right"></span>
  </span>
`,PN=(t,e)=>{if(!e.icon&&!e.iconHtml)return;let s=t.innerHTML,n="";e.iconHtml?n=FN(e.iconHtml):e.icon==="success"?(n=R5,s=s.replace(/ style=".*?"/g,"")):e.icon==="error"?n=P5:e.icon&&(n=FN({question:"?",warning:"!",info:"i"}[e.icon])),s.trim()!==n.trim()&&Vn(t,n)},F5=(t,e)=>{if(e.iconColor){t.style.color=e.iconColor,t.style.borderColor=e.iconColor;for(const s of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])TN(t,s,"background-color",e.iconColor);TN(t,".swal2-success-ring","border-color",e.iconColor)}},FN=t=>`<div class="${ye["icon-content"]}">${t}</div>`,O5=(t,e)=>{const s=jN();if(s){if(!e.imageUrl){rn(s);return}Bs(s,""),s.setAttribute("src",e.imageUrl),s.setAttribute("alt",e.imageAlt||""),wa(s,"width",e.imageWidth),wa(s,"height",e.imageHeight),s.className=ye.image,Wn(s,e,"image")}};let Qx=!1,ON=0,MN=0,LN=0,zN=0;const M5=t=>{t.addEventListener("mousedown",Fp),document.body.addEventListener("mousemove",Op),t.addEventListener("mouseup",Mp),t.addEventListener("touchstart",Fp),document.body.addEventListener("touchmove",Op),t.addEventListener("touchend",Mp)},L5=t=>{t.removeEventListener("mousedown",Fp),document.body.removeEventListener("mousemove",Op),t.removeEventListener("mouseup",Mp),t.removeEventListener("touchstart",Fp),document.body.removeEventListener("touchmove",Op),t.removeEventListener("touchend",Mp)},Fp=t=>{const e=Pt();if(t.target===e||Rl().contains(t.target)){Qx=!0;const s=BN(t);ON=s.clientX,MN=s.clientY,LN=parseInt(e.style.insetInlineStart)||0,zN=parseInt(e.style.insetBlockStart)||0,zt(e,"swal2-dragging")}},Op=t=>{const e=Pt();if(Qx){let{clientX:s,clientY:n}=BN(t);e.style.insetInlineStart=`${LN+(s-ON)}px`,e.style.insetBlockStart=`${zN+(n-MN)}px`}},Mp=()=>{const t=Pt();Qx=!1,ar(t,"swal2-dragging")},BN=t=>{let e=0,s=0;return t.type.startsWith("mouse")?(e=t.clientX,s=t.clientY):t.type.startsWith("touch")&&(e=t.touches[0].clientX,s=t.touches[0].clientY),{clientX:e,clientY:s}},z5=(t,e)=>{const s=bn(),n=Pt();if(!(!s||!n)){if(e.toast){wa(s,"width",e.width),n.style.width="100%";const r=Fl();r&&n.insertBefore(r,Rl())}else wa(n,"width",e.width);wa(n,"padding",e.padding),e.color&&(n.style.color=e.color),e.background&&(n.style.background=e.background),rn(Ap()),B5(n,e),e.draggable&&!e.toast?(zt(n,ye.draggable),M5(n)):(ar(n,ye.draggable),L5(n))}},B5=(t,e)=>{const s=e.showClass||{};t.className=`${ye.popup} ${Tn(t)?s.popup:""}`,e.toast?(zt([document.documentElement,document.body],ye["toast-shown"]),zt(t,ye.toast)):zt(t,ye.modal),Wn(t,e,"popup"),typeof e.customClass=="string"&&zt(t,e.customClass),e.icon&&zt(t,ye[`icon-${e.icon}`])},U5=(t,e)=>{const s=Ux();if(!s)return;const{progressSteps:n,currentProgressStep:r}=e;if(!n||n.length===0||r===void 0){rn(s);return}Bs(s),s.textContent="",r>=n.length&&xn("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),n.forEach((i,o)=>{const l=V5(i);if(s.appendChild(l),o===r&&zt(l,ye["active-progress-step"]),o!==n.length-1){const c=W5(e);s.appendChild(c)}})},V5=t=>{const e=document.createElement("li");return zt(e,ye["progress-step"]),Vn(e,t),e},W5=t=>{const e=document.createElement("li");return zt(e,ye["progress-step-line"]),t.progressStepsDistance&&wa(e,"width",t.progressStepsDistance),e},G5=(t,e)=>{const s=SN();s&&(Hx(s),hd(s,e.title||e.titleText,"block"),e.title&&Xx(e.title,s),e.titleText&&(s.innerText=e.titleText),Wn(s,e,"title"))},UN=(t,e)=>{z5(t,e),v5(t,e),U5(t,e),_5(t,e),O5(t,e),G5(t,e),w5(t,e),A5(t,e),x5(t,e),D5(t,e);const s=Pt();typeof e.didRender=="function"&&s&&e.didRender(s),ot.eventEmitter.emit("didRender",s)},H5=()=>Tn(Pt()),VN=()=>{var t;return(t=si())===null||t===void 0?void 0:t.click()},q5=()=>{var t;return(t=ya())===null||t===void 0?void 0:t.click()},K5=()=>{var t;return(t=Pl())===null||t===void 0?void 0:t.click()},Ol=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),WN=t=>{t.keydownTarget&&t.keydownHandlerAdded&&(t.keydownTarget.removeEventListener("keydown",t.keydownHandler,{capture:t.keydownListenerCapture}),t.keydownHandlerAdded=!1)},X5=(t,e,s)=>{WN(t),e.toast||(t.keydownHandler=n=>Z5(e,n,s),t.keydownTarget=e.keydownListenerCapture?window:Pt(),t.keydownListenerCapture=e.keydownListenerCapture,t.keydownTarget.addEventListener("keydown",t.keydownHandler,{capture:t.keydownListenerCapture}),t.keydownHandlerAdded=!0)},e0=(t,e)=>{var s;const n=Wx();if(n.length){t=t+e,t===-2&&(t=n.length-1),t===n.length?t=0:t===-1&&(t=n.length-1),n[t].focus();return}(s=Pt())===null||s===void 0||s.focus()},GN=["ArrowRight","ArrowDown"],Y5=["ArrowLeft","ArrowUp"],Z5=(t,e,s)=>{t&&(e.isComposing||e.keyCode===229||(t.stopKeydownPropagation&&e.stopPropagation(),e.key==="Enter"?J5(e,t):e.key==="Tab"?Q5(e):[...GN,...Y5].includes(e.key)?ez(e.key):e.key==="Escape"&&tz(e,t,s)))},J5=(t,e)=>{if(!Tp(e.allowEnterKey))return;const s=Rp(Pt(),e.input);if(t.target&&s&&t.target instanceof HTMLElement&&t.target.outerHTML===s.outerHTML){if(["textarea","file"].includes(e.input))return;VN(),t.preventDefault()}},Q5=t=>{const e=t.target,s=Wx();let n=-1;for(let r=0;r<s.length;r++)if(e===s[r]){n=r;break}t.shiftKey?e0(n,-1):e0(n,1),t.stopPropagation(),t.preventDefault()},ez=t=>{const e=ud(),s=si(),n=ya(),r=Pl();if(!e||!s||!n||!r)return;const i=[s,n,r];if(document.activeElement instanceof HTMLElement&&!i.includes(document.activeElement))return;const o=GN.includes(t)?"nextElementSibling":"previousElementSibling";let l=document.activeElement;if(l){for(let c=0;c<e.children.length;c++){if(l=l[o],!l)return;if(l instanceof HTMLButtonElement&&Tn(l))break}l instanceof HTMLButtonElement&&l.focus()}},tz=(t,e,s)=>{Tp(e.allowEscapeKey)&&(t.preventDefault(),s(Ol.esc))};var Ml={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const sz=()=>{const t=bn();Array.from(document.body.children).forEach(s=>{s.contains(t)||(s.hasAttribute("aria-hidden")&&s.setAttribute("data-previous-aria-hidden",s.getAttribute("aria-hidden")||""),s.setAttribute("aria-hidden","true"))})},HN=()=>{Array.from(document.body.children).forEach(e=>{e.hasAttribute("data-previous-aria-hidden")?(e.setAttribute("aria-hidden",e.getAttribute("data-previous-aria-hidden")||""),e.removeAttribute("data-previous-aria-hidden")):e.removeAttribute("aria-hidden")})},qN=typeof window<"u"&&!!window.GestureEvent,nz=()=>{if(qN&&!Ki(document.body,ye.iosfix)){const t=document.body.scrollTop;document.body.style.top=`${t*-1}px`,zt(document.body,ye.iosfix),rz()}},rz=()=>{const t=bn();if(!t)return;let e;t.ontouchstart=s=>{e=iz(s)},t.ontouchmove=s=>{e&&(s.preventDefault(),s.stopPropagation())}},iz=t=>{const e=t.target,s=bn(),n=Bx();return!s||!n||oz(t)||az(t)?!1:e===s||!qx(s)&&e instanceof HTMLElement&&!i5(e,n)&&e.tagName!=="INPUT"&&e.tagName!=="TEXTAREA"&&!(qx(n)&&n.contains(e))},oz=t=>t.touches&&t.touches.length&&t.touches[0].touchType==="stylus",az=t=>t.touches&&t.touches.length>1,lz=()=>{if(Ki(document.body,ye.iosfix)){const t=parseInt(document.body.style.top,10);ar(document.body,ye.iosfix),document.body.style.top="",document.body.scrollTop=t*-1}},cz=()=>{const t=document.createElement("div");t.className=ye["scrollbar-measure"],document.body.appendChild(t);const e=t.getBoundingClientRect().width-t.clientWidth;return document.body.removeChild(t),e};let Ll=null;const dz=t=>{Ll===null&&(document.body.scrollHeight>window.innerHeight||t==="scroll")&&(Ll=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${Ll+cz()}px`)},uz=()=>{Ll!==null&&(document.body.style.paddingRight=`${Ll}px`,Ll=null)};function KN(t,e,s,n){_p()?YN(t,n):(ZL(s).then(()=>YN(t,n)),WN(ot)),qN?(e.setAttribute("style","display:none !important"),e.removeAttribute("class"),e.innerHTML=""):e.remove(),Gx()&&(uz(),lz(),HN()),hz()}function hz(){ar([document.documentElement,document.body],[ye.shown,ye["height-auto"],ye["no-backdrop"],ye["toast-shown"]])}function No(t){t=fz(t);const e=Ml.swalPromiseResolve.get(this),s=pz(this);this.isAwaitingPromise?t.isDismissed||(fd(this),e(t)):s&&e(t)}const pz=t=>{const e=Pt();if(!e)return!1;const s=ts.innerParams.get(t);if(!s||Ki(e,s.hideClass.popup))return!1;ar(e,s.showClass.popup),zt(e,s.hideClass.popup);const n=bn();return ar(n,s.showClass.backdrop),zt(n,s.hideClass.backdrop),mz(t,e,s),!0};function XN(t){const e=Ml.swalPromiseReject.get(this);fd(this),e&&e(t)}const fd=t=>{t.isAwaitingPromise&&(delete t.isAwaitingPromise,ts.innerParams.get(t)||t._destroy())},fz=t=>typeof t>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},t),mz=(t,e,s)=>{var n;const r=bn(),i=AN(e);typeof s.willClose=="function"&&s.willClose(e),(n=ot.eventEmitter)===null||n===void 0||n.emit("willClose",e),i?gz(t,e,r,s.returnFocus,s.didClose):KN(t,r,s.returnFocus,s.didClose)},gz=(t,e,s,n,r)=>{ot.swalCloseEventFinishedCallback=KN.bind(null,t,s,n,r);const i=function(o){if(o.target===e){var l;(l=ot.swalCloseEventFinishedCallback)===null||l===void 0||l.call(ot),delete ot.swalCloseEventFinishedCallback,e.removeEventListener("animationend",i),e.removeEventListener("transitionend",i)}};e.addEventListener("animationend",i),e.addEventListener("transitionend",i)},YN=(t,e)=>{setTimeout(()=>{var s;typeof e=="function"&&e.bind(t.params)(),(s=ot.eventEmitter)===null||s===void 0||s.emit("didClose"),t._destroy&&t._destroy()})},zl=t=>{let e=Pt();if(e||new ka,e=Pt(),!e)return;const s=Fl();_p()?rn(Rl()):xz(e,t),Bs(s),e.setAttribute("data-loading","true"),e.setAttribute("aria-busy","true"),e.focus()},xz=(t,e)=>{const s=ud(),n=Fl();!s||!n||(!e&&Tn(si())&&(e=si()),Bs(s),e&&(rn(e),n.setAttribute("data-button-to-replace",e.className),s.insertBefore(n,e)),zt([t,s],ye.loading))},bz=(t,e)=>{e.input==="select"||e.input==="radio"?kz(t,e):["text","email","number","tel","textarea"].some(s=>s===e.input)&&(Lx(e.inputValue)||zx(e.inputValue))&&(zl(si()),Cz(t,e))},yz=(t,e)=>{const s=t.getInput();if(!s)return null;switch(e.input){case"checkbox":return wz(s);case"radio":return vz(s);case"file":return Nz(s);default:return e.inputAutoTrim?s.value.trim():s.value}},wz=t=>t.checked?1:0,vz=t=>t.checked?t.value:null,Nz=t=>t.files&&t.files.length?t.getAttribute("multiple")!==null?t.files:t.files[0]:null,kz=(t,e)=>{const s=Pt();if(!s)return;const n=r=>{e.input==="select"?Sz(s,Lp(r),e):e.input==="radio"&&jz(s,Lp(r),e)};Lx(e.inputOptions)||zx(e.inputOptions)?(zl(si()),cd(e.inputOptions).then(r=>{t.hideLoading(),n(r)})):typeof e.inputOptions=="object"?n(e.inputOptions):ba(`Unexpected type of inputOptions! Expected object, Map or Promise, got ${typeof e.inputOptions}`)},Cz=(t,e)=>{const s=t.getInput();s&&(rn(s),cd(e.inputValue).then(n=>{s.value=e.input==="number"?`${parseFloat(n)||0}`:`${n}`,Bs(s),s.focus(),t.hideLoading()}).catch(n=>{ba(`Error in inputValue promise: ${n}`),s.value="",Bs(s),s.focus(),t.hideLoading()}))};function Sz(t,e,s){const n=vo(t,ye.select);if(!n)return;const r=(i,o,l)=>{const c=document.createElement("option");c.value=l,Vn(c,o),c.selected=ZN(l,s.inputValue),i.appendChild(c)};e.forEach(i=>{const o=i[0],l=i[1];if(Array.isArray(l)){const c=document.createElement("optgroup");c.label=o,c.disabled=!1,n.appendChild(c),l.forEach(d=>r(c,d[1],d[0]))}else r(n,l,o)}),n.focus()}function jz(t,e,s){const n=vo(t,ye.radio);if(!n)return;e.forEach(i=>{const o=i[0],l=i[1],c=document.createElement("input"),d=document.createElement("label");c.type="radio",c.name=ye.radio,c.value=o,ZN(o,s.inputValue)&&(c.checked=!0);const u=document.createElement("span");Vn(u,l),u.className=ye.label,d.appendChild(c),d.appendChild(u),n.appendChild(d)});const r=n.querySelectorAll("input");r.length&&r[0].focus()}const Lp=t=>{const e=[];return t instanceof Map?t.forEach((s,n)=>{let r=s;typeof r=="object"&&(r=Lp(r)),e.push([n,r])}):Object.keys(t).forEach(s=>{let n=t[s];typeof n=="object"&&(n=Lp(n)),e.push([s,n])}),e},ZN=(t,e)=>!!e&&e.toString()===t.toString(),Iz=t=>{const e=ts.innerParams.get(t);t.disableButtons(),e.input?JN(t,"confirm"):s0(t,!0)},Ez=t=>{const e=ts.innerParams.get(t);t.disableButtons(),e.returnInputValueOnDeny?JN(t,"deny"):t0(t,!1)},$z=(t,e)=>{t.disableButtons(),e(Ol.cancel)},JN=(t,e)=>{const s=ts.innerParams.get(t);if(!s.input){ba(`The "input" parameter is needed to be set when using returnInputValueOn${Mx(e)}`);return}const n=t.getInput(),r=yz(t,s);s.inputValidator?Tz(t,r,e):n&&!n.checkValidity()?(t.enableButtons(),t.showValidationMessage(s.validationMessage||n.validationMessage)):e==="deny"?t0(t,r):s0(t,r)},Tz=(t,e,s)=>{const n=ts.innerParams.get(t);t.disableInput(),Promise.resolve().then(()=>cd(n.inputValidator(e,n.validationMessage))).then(i=>{t.enableButtons(),t.enableInput(),i?t.showValidationMessage(i):s==="deny"?t0(t,e):s0(t,e)})},t0=(t,e)=>{const s=ts.innerParams.get(t||void 0);s.showLoaderOnDeny&&zl(ya()),s.preDeny?(t.isAwaitingPromise=!0,Promise.resolve().then(()=>cd(s.preDeny(e,s.validationMessage))).then(r=>{r===!1?(t.hideLoading(),fd(t)):t.close({isDenied:!0,value:typeof r>"u"?e:r})}).catch(r=>ek(t||void 0,r))):t.close({isDenied:!0,value:e})},QN=(t,e)=>{t.close({isConfirmed:!0,value:e})},ek=(t,e)=>{t.rejectPromise(e)},s0=(t,e)=>{const s=ts.innerParams.get(t||void 0);s.showLoaderOnConfirm&&zl(),s.preConfirm?(t.resetValidationMessage(),t.isAwaitingPromise=!0,Promise.resolve().then(()=>cd(s.preConfirm(e,s.validationMessage))).then(r=>{Tn(Ap())||r===!1?(t.hideLoading(),fd(t)):QN(t,typeof r>"u"?e:r)}).catch(r=>ek(t||void 0,r))):QN(t,e)};function zp(){const t=ts.innerParams.get(this);if(!t)return;const e=ts.domCache.get(this);rn(e.loader),_p()?t.icon&&Bs(Rl()):Az(e),ar([e.popup,e.actions],ye.loading),e.popup.removeAttribute("aria-busy"),e.popup.removeAttribute("data-loading"),e.confirmButton.disabled=!1,e.denyButton.disabled=!1,e.cancelButton.disabled=!1}const Az=t=>{const e=t.popup.getElementsByClassName(t.loader.getAttribute("data-button-to-replace"));e.length?Bs(e[0],"inline-block"):r5()&&rn(t.actions)};function tk(){const t=ts.innerParams.get(this),e=ts.domCache.get(this);return e?Rp(e.popup,t.input):null}function sk(t,e,s){const n=ts.domCache.get(t);e.forEach(r=>{n[r].disabled=s})}function nk(t,e){const s=Pt();if(!(!s||!t))if(t.type==="radio"){const n=s.querySelectorAll(`[name="${ye.radio}"]`);for(let r=0;r<n.length;r++)n[r].disabled=e}else t.disabled=e}function rk(){sk(this,["confirmButton","denyButton","cancelButton"],!1)}function ik(){sk(this,["confirmButton","denyButton","cancelButton"],!0)}function ok(){nk(this.getInput(),!1)}function ak(){nk(this.getInput(),!0)}function lk(t){const e=ts.domCache.get(this),s=ts.innerParams.get(this);Vn(e.validationMessage,t),e.validationMessage.className=ye["validation-message"],s.customClass&&s.customClass.validationMessage&&zt(e.validationMessage,s.customClass.validationMessage),Bs(e.validationMessage);const n=this.getInput();n&&(n.setAttribute("aria-invalid","true"),n.setAttribute("aria-describedby",ye["validation-message"]),EN(n),zt(n,ye.inputerror))}function ck(){const t=ts.domCache.get(this);t.validationMessage&&rn(t.validationMessage);const e=this.getInput();e&&(e.removeAttribute("aria-invalid"),e.removeAttribute("aria-describedby"),ar(e,ye.inputerror))}const Bl={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,draggable:!1,animation:!0,theme:"light",showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0,topLayer:!1},Dz=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","draggable","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","theme","willClose"],_z={allowEnterKey:void 0},Rz=["allowOutsideClick","allowEnterKey","backdrop","draggable","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],dk=t=>Object.prototype.hasOwnProperty.call(Bl,t),uk=t=>Dz.indexOf(t)!==-1,hk=t=>_z[t],Pz=t=>{dk(t)||xn(`Unknown parameter "${t}"`)},Fz=t=>{Rz.includes(t)&&xn(`The parameter "${t}" is incompatible with toasts`)},Oz=t=>{const e=hk(t);e&&CN(t,e)},pk=t=>{t.backdrop===!1&&t.allowOutsideClick&&xn('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`'),t.theme&&!["light","dark","auto","minimal","borderless","embed-iframe","bulma","bulma-light","bulma-dark"].includes(t.theme)&&xn(`Invalid theme "${t.theme}"`);for(const e in t)Pz(e),t.toast&&Fz(e),Oz(e)};function fk(t){const e=bn(),s=Pt(),n=ts.innerParams.get(this);if(!s||Ki(s,n.hideClass.popup)){xn("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");return}const r=Mz(t),i=Object.assign({},n,r);pk(i),e.dataset.swal2Theme=i.theme,UN(this,i),ts.innerParams.set(this,i),Object.defineProperties(this,{params:{value:Object.assign({},this.params,t),writable:!1,enumerable:!0}})}const Mz=t=>{const e={};return Object.keys(t).forEach(s=>{uk(s)?e[s]=t[s]:xn(`Invalid parameter to update: ${s}`)}),e};function mk(){const t=ts.domCache.get(this),e=ts.innerParams.get(this);if(!e){gk(this);return}t.popup&&ot.swalCloseEventFinishedCallback&&(ot.swalCloseEventFinishedCallback(),delete ot.swalCloseEventFinishedCallback),typeof e.didDestroy=="function"&&e.didDestroy(),ot.eventEmitter.emit("didDestroy"),Lz(this)}const Lz=t=>{gk(t),delete t.params,delete ot.keydownHandler,delete ot.keydownTarget,delete ot.currentInstance},gk=t=>{t.isAwaitingPromise?(n0(ts,t),t.isAwaitingPromise=!0):(n0(Ml,t),n0(ts,t),delete t.isAwaitingPromise,delete t.disableButtons,delete t.enableButtons,delete t.getInput,delete t.disableInput,delete t.enableInput,delete t.hideLoading,delete t.disableLoading,delete t.showValidationMessage,delete t.resetValidationMessage,delete t.close,delete t.closePopup,delete t.closeModal,delete t.closeToast,delete t.rejectPromise,delete t.update,delete t._destroy)},n0=(t,e)=>{for(const s in t)t[s].delete(e)};var zz=Object.freeze({__proto__:null,_destroy:mk,close:No,closeModal:No,closePopup:No,closeToast:No,disableButtons:ik,disableInput:ak,disableLoading:zp,enableButtons:rk,enableInput:ok,getInput:tk,handleAwaitingPromise:fd,hideLoading:zp,rejectPromise:XN,resetValidationMessage:ck,showValidationMessage:lk,update:fk});const Bz=(t,e,s)=>{t.toast?Uz(t,e,s):(Wz(e),Gz(e),Hz(t,e,s))},Uz=(t,e,s)=>{e.popup.onclick=()=>{t&&(Vz(t)||t.timer||t.input)||s(Ol.close)}},Vz=t=>!!(t.showConfirmButton||t.showDenyButton||t.showCancelButton||t.showCloseButton);let Bp=!1;const Wz=t=>{t.popup.onmousedown=()=>{t.container.onmouseup=function(e){t.container.onmouseup=()=>{},e.target===t.container&&(Bp=!0)}}},Gz=t=>{t.container.onmousedown=e=>{e.target===t.container&&e.preventDefault(),t.popup.onmouseup=function(s){t.popup.onmouseup=()=>{},(s.target===t.popup||s.target instanceof HTMLElement&&t.popup.contains(s.target))&&(Bp=!0)}}},Hz=(t,e,s)=>{e.container.onclick=n=>{if(Bp){Bp=!1;return}n.target===e.container&&Tp(t.allowOutsideClick)&&s(Ol.backdrop)}},qz=t=>typeof t=="object"&&t.jquery,xk=t=>t instanceof Element||qz(t),Kz=t=>{const e={};return typeof t[0]=="object"&&!xk(t[0])?Object.assign(e,t[0]):["title","html","icon"].forEach((s,n)=>{const r=t[n];typeof r=="string"||xk(r)?e[s]=r:r!==void 0&&ba(`Unexpected type of ${s}! Expected "string" or "Element", got ${typeof r}`)}),e};function Xz(...t){return new this(...t)}function Yz(t){class e extends this{_main(n,r){return super._main(n,Object.assign({},t,r))}}return e}const Zz=()=>ot.timeout&&ot.timeout.getTimerLeft(),bk=()=>{if(ot.timeout)return o5(),ot.timeout.stop()},yk=()=>{if(ot.timeout){const t=ot.timeout.start();return Kx(t),t}},Jz=()=>{const t=ot.timeout;return t&&(t.running?bk():yk())},Qz=t=>{if(ot.timeout){const e=ot.timeout.increase(t);return Kx(e,!0),e}},eB=()=>!!(ot.timeout&&ot.timeout.isRunning());let wk=!1;const r0={};function tB(t="data-swal-template"){r0[t]=this,wk||(document.body.addEventListener("click",sB),wk=!0)}const sB=t=>{for(let e=t.target;e&&e!==document;e=e.parentNode)for(const s in r0){const n=e.getAttribute(s);if(n){r0[s].fire({template:n});return}}};class nB{constructor(){this.events={}}_getHandlersByEventName(e){return typeof this.events[e]>"u"&&(this.events[e]=[]),this.events[e]}on(e,s){const n=this._getHandlersByEventName(e);n.includes(s)||n.push(s)}once(e,s){const n=(...r)=>{this.removeListener(e,n),s.apply(this,r)};this.on(e,n)}emit(e,...s){this._getHandlersByEventName(e).forEach(n=>{try{n.apply(this,s)}catch(r){console.error(r)}})}removeListener(e,s){const n=this._getHandlersByEventName(e),r=n.indexOf(s);r>-1&&n.splice(r,1)}removeAllListeners(e){this.events[e]!==void 0&&(this.events[e].length=0)}reset(){this.events={}}}ot.eventEmitter=new nB;var rB=Object.freeze({__proto__:null,argsToParams:Kz,bindClickHandler:tB,clickCancel:K5,clickConfirm:VN,clickDeny:q5,enableLoading:zl,fire:Xz,getActions:ud,getCancelButton:Pl,getCloseButton:Vx,getConfirmButton:si,getContainer:bn,getDenyButton:ya,getFocusableElements:Wx,getFooter:IN,getHtmlContainer:Bx,getIcon:Rl,getIconContent:QL,getImage:jN,getInputLabel:e5,getLoader:Fl,getPopup:Pt,getProgressSteps:Ux,getTimerLeft:Zz,getTimerProgressBar:Dp,getTitle:SN,getValidationMessage:Ap,increaseTimer:Qz,isDeprecatedParameter:hk,isLoading:s5,isTimerRunning:eB,isUpdatableParameter:uk,isValidParameter:dk,isVisible:H5,mixin:Yz,off:(t,e)=>{if(!t){ot.eventEmitter.reset();return}e?ot.eventEmitter.removeListener(t,e):ot.eventEmitter.removeAllListeners(t)},on:(t,e)=>{ot.eventEmitter.on(t,e)},once:(t,e)=>{ot.eventEmitter.once(t,e)},resumeTimer:yk,showLoading:zl,stopTimer:bk,toggleTimer:Jz});class iB{constructor(e,s){this.callback=e,this.remaining=s,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.started&&this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=new Date().getTime()-this.started.getTime()),this.remaining}increase(e){const s=this.running;return s&&this.stop(),this.remaining+=e,s&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const vk=["swal-title","swal-html","swal-footer"],oB=t=>{const e=typeof t.template=="string"?document.querySelector(t.template):t.template;if(!e)return{};const s=e.content;return fB(s),Object.assign(aB(s),lB(s),cB(s),dB(s),uB(s),hB(s),pB(s,vk))},aB=t=>{const e={};return Array.from(t.querySelectorAll("swal-param")).forEach(n=>{Na(n,["name","value"]);const r=n.getAttribute("name"),i=n.getAttribute("value");!r||!i||(typeof Bl[r]=="boolean"?e[r]=i!=="false":typeof Bl[r]=="object"?e[r]=JSON.parse(i):e[r]=i)}),e},lB=t=>{const e={};return Array.from(t.querySelectorAll("swal-function-param")).forEach(n=>{const r=n.getAttribute("name"),i=n.getAttribute("value");!r||!i||(e[r]=new Function(`return ${i}`)())}),e},cB=t=>{const e={};return Array.from(t.querySelectorAll("swal-button")).forEach(n=>{Na(n,["type","color","aria-label"]);const r=n.getAttribute("type");!r||!["confirm","cancel","deny"].includes(r)||(e[`${r}ButtonText`]=n.innerHTML,e[`show${Mx(r)}Button`]=!0,n.hasAttribute("color")&&(e[`${r}ButtonColor`]=n.getAttribute("color")),n.hasAttribute("aria-label")&&(e[`${r}ButtonAriaLabel`]=n.getAttribute("aria-label")))}),e},dB=t=>{const e={},s=t.querySelector("swal-image");return s&&(Na(s,["src","width","height","alt"]),s.hasAttribute("src")&&(e.imageUrl=s.getAttribute("src")||void 0),s.hasAttribute("width")&&(e.imageWidth=s.getAttribute("width")||void 0),s.hasAttribute("height")&&(e.imageHeight=s.getAttribute("height")||void 0),s.hasAttribute("alt")&&(e.imageAlt=s.getAttribute("alt")||void 0)),e},uB=t=>{const e={},s=t.querySelector("swal-icon");return s&&(Na(s,["type","color"]),s.hasAttribute("type")&&(e.icon=s.getAttribute("type")),s.hasAttribute("color")&&(e.iconColor=s.getAttribute("color")),e.iconHtml=s.innerHTML),e},hB=t=>{const e={},s=t.querySelector("swal-input");s&&(Na(s,["type","label","placeholder","value"]),e.input=s.getAttribute("type")||"text",s.hasAttribute("label")&&(e.inputLabel=s.getAttribute("label")),s.hasAttribute("placeholder")&&(e.inputPlaceholder=s.getAttribute("placeholder")),s.hasAttribute("value")&&(e.inputValue=s.getAttribute("value")));const n=Array.from(t.querySelectorAll("swal-input-option"));return n.length&&(e.inputOptions={},n.forEach(r=>{Na(r,["value"]);const i=r.getAttribute("value");if(!i)return;const o=r.innerHTML;e.inputOptions[i]=o})),e},pB=(t,e)=>{const s={};for(const n in e){const r=e[n],i=t.querySelector(r);i&&(Na(i,[]),s[r.replace(/^swal-/,"")]=i.innerHTML.trim())}return s},fB=t=>{const e=vk.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(t.children).forEach(s=>{const n=s.tagName.toLowerCase();e.includes(n)||xn(`Unrecognized element <${n}>`)})},Na=(t,e)=>{Array.from(t.attributes).forEach(s=>{e.indexOf(s.name)===-1&&xn([`Unrecognized attribute "${s.name}" on <${t.tagName.toLowerCase()}>.`,`${e.length?`Allowed attributes are: ${e.join(", ")}`:"To set the value, use HTML within the element."}`])})},Nk=10,mB=t=>{const e=bn(),s=Pt();typeof t.willOpen=="function"&&t.willOpen(s),ot.eventEmitter.emit("willOpen",s);const r=window.getComputedStyle(document.body).overflowY;bB(e,s,t),setTimeout(()=>{gB(e,s)},Nk),Gx()&&(xB(e,t.scrollbarPadding,r),sz()),!_p()&&!ot.previousActiveElement&&(ot.previousActiveElement=document.activeElement),typeof t.didOpen=="function"&&setTimeout(()=>t.didOpen(s)),ot.eventEmitter.emit("didOpen",s),ar(e,ye["no-transition"])},Up=t=>{const e=Pt();if(t.target!==e)return;const s=bn();e.removeEventListener("animationend",Up),e.removeEventListener("transitionend",Up),s.style.overflowY="auto"},gB=(t,e)=>{AN(e)?(t.style.overflowY="hidden",e.addEventListener("animationend",Up),e.addEventListener("transitionend",Up)):t.style.overflowY="auto"},xB=(t,e,s)=>{nz(),e&&s!=="hidden"&&dz(s),setTimeout(()=>{t.scrollTop=0})},bB=(t,e,s)=>{zt(t,s.showClass.backdrop),s.animation?(e.style.setProperty("opacity","0","important"),Bs(e,"grid"),setTimeout(()=>{zt(e,s.showClass.popup),e.style.removeProperty("opacity")},Nk)):Bs(e,"grid"),zt([document.documentElement,document.body],ye.shown),s.heightAuto&&s.backdrop&&!s.toast&&zt([document.documentElement,document.body],ye["height-auto"])};var kk={email:(t,e)=>/^[a-zA-Z0-9.+_'-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]+$/.test(t)?Promise.resolve():Promise.resolve(e||"Invalid email address"),url:(t,e)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(t)?Promise.resolve():Promise.resolve(e||"Invalid URL")};function yB(t){t.inputValidator||(t.input==="email"&&(t.inputValidator=kk.email),t.input==="url"&&(t.inputValidator=kk.url))}function wB(t){(!t.target||typeof t.target=="string"&&!document.querySelector(t.target)||typeof t.target!="string"&&!t.target.appendChild)&&(xn('Target parameter is not valid, defaulting to "body"'),t.target="body")}function vB(t){yB(t),t.showLoaderOnConfirm&&!t.preConfirm&&xn(`showLoaderOnConfirm is set to true, but preConfirm is not defined.
showLoaderOnConfirm should be used together with preConfirm, see usage example:
https://sweetalert2.github.io/#ajax-request`),wB(t),typeof t.title=="string"&&(t.title=t.title.split(`
`).join("<br />")),f5(t)}let ni;var Vp=new WeakMap;class vs{constructor(...e){if(qL(this,Vp,void 0),typeof window>"u")return;ni=this;const s=Object.freeze(this.constructor.argsToParams(e));this.params=s,this.isAwaitingPromise=!1,KL(Vp,this,this._main(ni.params))}_main(e,s={}){if(pk(Object.assign({},s,e)),ot.currentInstance){const i=Ml.swalPromiseResolve.get(ot.currentInstance),{isAwaitingPromise:o}=ot.currentInstance;ot.currentInstance._destroy(),o||i({isDismissed:!0}),Gx()&&HN()}ot.currentInstance=ni;const n=kB(e,s);vB(n),Object.freeze(n),ot.timeout&&(ot.timeout.stop(),delete ot.timeout),clearTimeout(ot.restoreFocusTimeout);const r=CB(ni);return UN(ni,n),ts.innerParams.set(ni,n),NB(ni,r,n)}then(e){return wN(Vp,this).then(e)}finally(e){return wN(Vp,this).finally(e)}}const NB=(t,e,s)=>new Promise((n,r)=>{const i=o=>{t.close({isDismissed:!0,dismiss:o})};Ml.swalPromiseResolve.set(t,n),Ml.swalPromiseReject.set(t,r),e.confirmButton.onclick=()=>{Iz(t)},e.denyButton.onclick=()=>{Ez(t)},e.cancelButton.onclick=()=>{$z(t,i)},e.closeButton.onclick=()=>{i(Ol.close)},Bz(s,e,i),X5(ot,s,i),bz(t,s),mB(s),SB(ot,s,i),jB(e,s),setTimeout(()=>{e.container.scrollTop=0})}),kB=(t,e)=>{const s=oB(t),n=Object.assign({},Bl,e,s,t);return n.showClass=Object.assign({},Bl.showClass,n.showClass),n.hideClass=Object.assign({},Bl.hideClass,n.hideClass),n.animation===!1&&(n.showClass={backdrop:"swal2-noanimation"},n.hideClass={}),n},CB=t=>{const e={popup:Pt(),container:bn(),actions:ud(),confirmButton:si(),denyButton:ya(),cancelButton:Pl(),loader:Fl(),closeButton:Vx(),validationMessage:Ap(),progressSteps:Ux()};return ts.domCache.set(t,e),e},SB=(t,e,s)=>{const n=Dp();rn(n),e.timer&&(t.timeout=new iB(()=>{s("timer"),delete t.timeout},e.timer),e.timerProgressBar&&(Bs(n),Wn(n,e,"timerProgressBar"),setTimeout(()=>{t.timeout&&t.timeout.running&&Kx(e.timer)})))},jB=(t,e)=>{if(!e.toast){if(!Tp(e.allowEnterKey)){CN("allowEnterKey"),$B();return}IB(t)||EB(t,e)||e0(-1,1)}},IB=t=>{const e=Array.from(t.popup.querySelectorAll("[autofocus]"));for(const s of e)if(s instanceof HTMLElement&&Tn(s))return s.focus(),!0;return!1},EB=(t,e)=>e.focusDeny&&Tn(t.denyButton)?(t.denyButton.focus(),!0):e.focusCancel&&Tn(t.cancelButton)?(t.cancelButton.focus(),!0):e.focusConfirm&&Tn(t.confirmButton)?(t.confirmButton.focus(),!0):!1,$B=()=>{document.activeElement instanceof HTMLElement&&typeof document.activeElement.blur=="function"&&document.activeElement.blur()};if(typeof window<"u"&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|by|xn--p1ai)$/)){const t=new Date,e=localStorage.getItem("swal-initiation");e?(t.getTime()-Date.parse(e))/(1e3*60*60*24)>3&&setTimeout(()=>{document.body.style.pointerEvents="none";const s=document.createElement("audio");s.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",s.loop=!0,document.body.appendChild(s),setTimeout(()=>{s.play().catch(()=>{})},2500)},500):localStorage.setItem("swal-initiation",`${t}`)}vs.prototype.disableButtons=ik,vs.prototype.enableButtons=rk,vs.prototype.getInput=tk,vs.prototype.disableInput=ak,vs.prototype.enableInput=ok,vs.prototype.hideLoading=zp,vs.prototype.disableLoading=zp,vs.prototype.showValidationMessage=lk,vs.prototype.resetValidationMessage=ck,vs.prototype.close=No,vs.prototype.closePopup=No,vs.prototype.closeModal=No,vs.prototype.closeToast=No,vs.prototype.rejectPromise=XN,vs.prototype.update=fk,vs.prototype._destroy=mk,Object.assign(vs,rB),Object.keys(zz).forEach(t=>{vs[t]=function(...e){return ni&&ni[t]?ni[t](...e):null}}),vs.DismissReason=Ol,vs.version="11.22.0";const ka=vs;ka.default=ka,typeof document<"u"&&function(t,e){var s=t.createElement("style");if(t.getElementsByTagName("head")[0].appendChild(s),s.styleSheet)s.styleSheet.disabled||(s.styleSheet.cssText=e);else try{s.innerHTML=e}catch{s.innerText=e}}(document,':root{--swal2-outline: 0 0 0 3px rgba(100, 150, 200, 0.5);--swal2-container-padding: 0.625em;--swal2-backdrop: rgba(0, 0, 0, 0.4);--swal2-backdrop-transition: background-color 0.1s;--swal2-width: 32em;--swal2-padding: 0 0 1.25em;--swal2-border: none;--swal2-border-radius: 0.3125rem;--swal2-background: white;--swal2-color: #545454;--swal2-show-animation: swal2-show 0.3s;--swal2-hide-animation: swal2-hide 0.15s forwards;--swal2-icon-zoom: 1;--swal2-icon-animations: true;--swal2-title-padding: 0.8em 1em 0;--swal2-html-container-padding: 1em 1.6em 0.3em;--swal2-input-border: 1px solid #d9d9d9;--swal2-input-border-radius: 0.1875em;--swal2-input-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-background: transparent;--swal2-input-transition: border-color 0.2s, box-shadow 0.2s;--swal2-input-hover-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px transparent;--swal2-input-focus-border: 1px solid #b4dbed;--swal2-input-focus-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.06), 0 0 0 3px $swal2-outline-color;--swal2-progress-step-background: #add8e6;--swal2-validation-message-background: #f0f0f0;--swal2-validation-message-color: #666;--swal2-footer-border-color: #eee;--swal2-footer-background: transparent;--swal2-footer-color: inherit;--swal2-close-button-position: initial;--swal2-close-button-inset: auto;--swal2-close-button-font-size: 2.5em;--swal2-close-button-color: #ccc;--swal2-close-button-transition: color 0.2s, box-shadow 0.2s;--swal2-close-button-outline: initial;--swal2-close-button-box-shadow: inset 0 0 0 3px transparent;--swal2-close-button-focus-box-shadow: inset var(--swal2-outline);--swal2-close-button-hover-transform: none;--swal2-actions-justify-content: center;--swal2-actions-width: auto;--swal2-actions-margin: 1.25em auto 0;--swal2-actions-padding: 0;--swal2-actions-border-radius: 0;--swal2-actions-background: transparent;--swal2-action-button-transition: background-color 0.2s, box-shadow 0.2s;--swal2-action-button-hover: black 10%;--swal2-action-button-active: black 10%;--swal2-confirm-button-box-shadow: none;--swal2-confirm-button-border-radius: 0.25em;--swal2-confirm-button-background-color: #7066e0;--swal2-confirm-button-color: #fff;--swal2-deny-button-box-shadow: none;--swal2-deny-button-border-radius: 0.25em;--swal2-deny-button-background-color: #dc3741;--swal2-deny-button-color: #fff;--swal2-cancel-button-box-shadow: none;--swal2-cancel-button-border-radius: 0.25em;--swal2-cancel-button-background-color: #6e7881;--swal2-cancel-button-color: #fff;--swal2-toast-show-animation: swal2-toast-show 0.5s;--swal2-toast-hide-animation: swal2-toast-hide 0.1s forwards;--swal2-toast-border: none;--swal2-toast-box-shadow: 0 0 1px hsl(0deg 0% 0% / 0.075), 0 1px 2px hsl(0deg 0% 0% / 0.075), 1px 2px 4px hsl(0deg 0% 0% / 0.075), 1px 3px 8px hsl(0deg 0% 0% / 0.075), 2px 4px 16px hsl(0deg 0% 0% / 0.075)}[data-swal2-theme=dark]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}@media(prefers-color-scheme: dark){[data-swal2-theme=auto]{--swal2-dark-theme-black: #19191a;--swal2-dark-theme-white: #e1e1e1;--swal2-background: var(--swal2-dark-theme-black);--swal2-color: var(--swal2-dark-theme-white);--swal2-footer-border-color: #555;--swal2-input-background: color-mix(in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10%);--swal2-validation-message-background: color-mix( in srgb, var(--swal2-dark-theme-black), var(--swal2-dark-theme-white) 10% );--swal2-validation-message-color: var(--swal2-dark-theme-white)}}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px var(--swal2-backdrop)}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}@media print{body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop,.swal2-toast-shown) .swal2-container{position:static !important}}div:where(.swal2-container){display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:var(--swal2-container-padding);overflow-x:hidden;transition:var(--swal2-backdrop-transition);-webkit-overflow-scrolling:touch}div:where(.swal2-container).swal2-backdrop-show,div:where(.swal2-container).swal2-noanimation{background:var(--swal2-backdrop)}div:where(.swal2-container).swal2-backdrop-hide{background:rgba(0,0,0,0) !important}div:where(.swal2-container).swal2-top-start,div:where(.swal2-container).swal2-center-start,div:where(.swal2-container).swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}div:where(.swal2-container).swal2-top,div:where(.swal2-container).swal2-center,div:where(.swal2-container).swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}div:where(.swal2-container).swal2-top-end,div:where(.swal2-container).swal2-center-end,div:where(.swal2-container).swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}div:where(.swal2-container).swal2-top-start>.swal2-popup{align-self:start}div:where(.swal2-container).swal2-top>.swal2-popup{grid-column:2;place-self:start center}div:where(.swal2-container).swal2-top-end>.swal2-popup,div:where(.swal2-container).swal2-top-right>.swal2-popup{grid-column:3;place-self:start end}div:where(.swal2-container).swal2-center-start>.swal2-popup,div:where(.swal2-container).swal2-center-left>.swal2-popup{grid-row:2;align-self:center}div:where(.swal2-container).swal2-center>.swal2-popup{grid-column:2;grid-row:2;place-self:center center}div:where(.swal2-container).swal2-center-end>.swal2-popup,div:where(.swal2-container).swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;place-self:center end}div:where(.swal2-container).swal2-bottom-start>.swal2-popup,div:where(.swal2-container).swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}div:where(.swal2-container).swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;place-self:end center}div:where(.swal2-container).swal2-bottom-end>.swal2-popup,div:where(.swal2-container).swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;place-self:end end}div:where(.swal2-container).swal2-grow-row>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}div:where(.swal2-container).swal2-grow-column>.swal2-popup,div:where(.swal2-container).swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}div:where(.swal2-container).swal2-no-transition{transition:none !important}div:where(.swal2-container)[popover]{width:auto;border:0}div:where(.swal2-container) div:where(.swal2-popup){display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:var(--swal2-width);max-width:100%;padding:var(--swal2-padding);border:var(--swal2-border);border-radius:var(--swal2-border-radius);background:var(--swal2-background);color:var(--swal2-color);font-family:inherit;font-size:1rem;container-name:swal2-popup}div:where(.swal2-container) div:where(.swal2-popup):focus{outline:none}div:where(.swal2-container) div:where(.swal2-popup).swal2-loading{overflow-y:hidden}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable{cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-draggable div:where(.swal2-icon){cursor:grab}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging{cursor:grabbing}div:where(.swal2-container) div:where(.swal2-popup).swal2-dragging div:where(.swal2-icon){cursor:grabbing}div:where(.swal2-container) h2:where(.swal2-title){position:relative;max-width:100%;margin:0;padding:var(--swal2-title-padding);color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word;cursor:initial}div:where(.swal2-container) div:where(.swal2-actions){display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:var(--swal2-actions-justify-content);width:var(--swal2-actions-width);margin:var(--swal2-actions-margin);padding:var(--swal2-actions-padding);border-radius:var(--swal2-actions-border-radius);background:var(--swal2-actions-background)}div:where(.swal2-container) div:where(.swal2-loader){display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}div:where(.swal2-container) button:where(.swal2-styled){margin:.3125em;padding:.625em 1.1em;transition:var(--swal2-action-button-transition);border:none;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}div:where(.swal2-container) button:where(.swal2-styled):not([disabled]){cursor:pointer}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm){border-radius:var(--swal2-confirm-button-border-radius);background:initial;background-color:var(--swal2-confirm-button-background-color);box-shadow:var(--swal2-confirm-button-box-shadow);color:var(--swal2-confirm-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):hover{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-confirm):active{background-color:color-mix(in srgb, var(--swal2-confirm-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny){border-radius:var(--swal2-deny-button-border-radius);background:initial;background-color:var(--swal2-deny-button-background-color);box-shadow:var(--swal2-deny-button-box-shadow);color:var(--swal2-deny-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):hover{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-deny):active{background-color:color-mix(in srgb, var(--swal2-deny-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel){border-radius:var(--swal2-cancel-button-border-radius);background:initial;background-color:var(--swal2-cancel-button-background-color);box-shadow:var(--swal2-cancel-button-box-shadow);color:var(--swal2-cancel-button-color);font-size:1em}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):hover{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-hover))}div:where(.swal2-container) button:where(.swal2-styled):where(.swal2-cancel):active{background-color:color-mix(in srgb, var(--swal2-cancel-button-background-color), var(--swal2-action-button-active))}div:where(.swal2-container) button:where(.swal2-styled):focus-visible{outline:none;box-shadow:var(--swal2-action-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-styled)[disabled]:not(.swal2-loading){opacity:.4}div:where(.swal2-container) button:where(.swal2-styled)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-footer){margin:1em 0 0;padding:1em 1em 0;border-top:1px solid var(--swal2-footer-border-color);background:var(--swal2-footer-background);color:var(--swal2-footer-color);font-size:1em;text-align:center;cursor:initial}div:where(.swal2-container) .swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:var(--swal2-border-radius);border-bottom-left-radius:var(--swal2-border-radius)}div:where(.swal2-container) div:where(.swal2-timer-progress-bar){width:100%;height:.25em;background:rgba(0,0,0,.2)}div:where(.swal2-container) img:where(.swal2-image){max-width:100%;margin:2em auto 1em;cursor:initial}div:where(.swal2-container) button:where(.swal2-close){position:var(--swal2-close-button-position);inset:var(--swal2-close-button-inset);z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:var(--swal2-close-button-transition);border:none;border-radius:var(--swal2-border-radius);outline:var(--swal2-close-button-outline);background:rgba(0,0,0,0);color:var(--swal2-close-button-color);font-family:monospace;font-size:var(--swal2-close-button-font-size);cursor:pointer;justify-self:end}div:where(.swal2-container) button:where(.swal2-close):hover{transform:var(--swal2-close-button-hover-transform);background:rgba(0,0,0,0);color:#f27474}div:where(.swal2-container) button:where(.swal2-close):focus-visible{outline:none;box-shadow:var(--swal2-close-button-focus-box-shadow)}div:where(.swal2-container) button:where(.swal2-close)::-moz-focus-inner{border:0}div:where(.swal2-container) div:where(.swal2-html-container){z-index:1;justify-content:center;margin:0;padding:var(--swal2-html-container-padding);overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word;cursor:initial}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea),div:where(.swal2-container) select:where(.swal2-select),div:where(.swal2-container) div:where(.swal2-radio),div:where(.swal2-container) label:where(.swal2-checkbox){margin:1em 2em 3px}div:where(.swal2-container) input:where(.swal2-input),div:where(.swal2-container) input:where(.swal2-file),div:where(.swal2-container) textarea:where(.swal2-textarea){box-sizing:border-box;width:auto;transition:var(--swal2-input-transition);border:var(--swal2-input-border);border-radius:var(--swal2-input-border-radius);background:var(--swal2-input-background);box-shadow:var(--swal2-input-box-shadow);color:inherit;font-size:1.125em}div:where(.swal2-container) input:where(.swal2-input).swal2-inputerror,div:where(.swal2-container) input:where(.swal2-file).swal2-inputerror,div:where(.swal2-container) textarea:where(.swal2-textarea).swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}div:where(.swal2-container) input:where(.swal2-input):hover,div:where(.swal2-container) input:where(.swal2-file):hover,div:where(.swal2-container) textarea:where(.swal2-textarea):hover{box-shadow:var(--swal2-input-hover-box-shadow)}div:where(.swal2-container) input:where(.swal2-input):focus,div:where(.swal2-container) input:where(.swal2-file):focus,div:where(.swal2-container) textarea:where(.swal2-textarea):focus{border:var(--swal2-input-focus-border);outline:none;box-shadow:var(--swal2-input-focus-box-shadow)}div:where(.swal2-container) input:where(.swal2-input)::placeholder,div:where(.swal2-container) input:where(.swal2-file)::placeholder,div:where(.swal2-container) textarea:where(.swal2-textarea)::placeholder{color:#ccc}div:where(.swal2-container) .swal2-range{margin:1em 2em 3px;background:var(--swal2-background)}div:where(.swal2-container) .swal2-range input{width:80%}div:where(.swal2-container) .swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}div:where(.swal2-container) .swal2-range input,div:where(.swal2-container) .swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}div:where(.swal2-container) .swal2-input{height:2.625em;padding:0 .75em}div:where(.swal2-container) .swal2-file{width:75%;margin-right:auto;margin-left:auto;background:var(--swal2-input-background);font-size:1.125em}div:where(.swal2-container) .swal2-textarea{height:6.75em;padding:.75em}div:where(.swal2-container) .swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:var(--swal2-input-background);color:inherit;font-size:1.125em}div:where(.swal2-container) .swal2-radio,div:where(.swal2-container) .swal2-checkbox{align-items:center;justify-content:center;background:var(--swal2-background);color:inherit}div:where(.swal2-container) .swal2-radio label,div:where(.swal2-container) .swal2-checkbox label{margin:0 .6em;font-size:1.125em}div:where(.swal2-container) .swal2-radio input,div:where(.swal2-container) .swal2-checkbox input{flex-shrink:0;margin:0 .4em}div:where(.swal2-container) label:where(.swal2-input-label){display:flex;justify-content:center;margin:1em auto 0}div:where(.swal2-container) div:where(.swal2-validation-message){align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:var(--swal2-validation-message-background);color:var(--swal2-validation-message-color);font-size:1em;font-weight:300}div:where(.swal2-container) div:where(.swal2-validation-message)::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}div:where(.swal2-container) .swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}div:where(.swal2-container) .swal2-progress-steps li{display:inline-block;position:relative}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:var(--swal2-progress-step-background);color:#fff}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:var(--swal2-progress-step-background)}div:where(.swal2-container) .swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}div:where(.swal2-icon){position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;zoom:var(--swal2-icon-zoom);border:.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}div:where(.swal2-icon) .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}div:where(.swal2-icon).swal2-error{border-color:#f27474;color:#f27474}div:where(.swal2-icon).swal2-error .swal2-x-mark{position:relative;flex-grow:1}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}}div:where(.swal2-icon).swal2-warning{border-color:#f8bb86;color:#f8bb86}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}}div:where(.swal2-icon).swal2-info{border-color:#3fc3ee;color:#3fc3ee}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}}div:where(.swal2-icon).swal2-question{border-color:#87adbd;color:#87adbd}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}div:where(.swal2-icon).swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}}div:where(.swal2-icon).swal2-success{border-color:#a5dc86;color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;border-radius:50%}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}div:where(.swal2-icon).swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}div:where(.swal2-icon).swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}div:where(.swal2-icon).swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}div:where(.swal2-icon).swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}@container swal2-popup style(--swal2-icon-animations:true){div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}div:where(.swal2-icon).swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:var(--swal2-show-animation)}.swal2-hide{animation:var(--swal2-hide-animation)}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;border:var(--swal2-toast-border);background:var(--swal2-background);box-shadow:var(--swal2-toast-box-shadow);pointer-events:all}.swal2-toast>*{grid-column:2}.swal2-toast h2:where(.swal2-title){margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-toast .swal2-loading{justify-content:center}.swal2-toast input:where(.swal2-input){height:2em;margin:.5em;font-size:1em}.swal2-toast .swal2-validation-message{font-size:1em}.swal2-toast div:where(.swal2-footer){margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-toast button:where(.swal2-close){grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-toast div:where(.swal2-html-container){margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-toast div:where(.swal2-html-container):empty{padding:0}.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-toast div:where(.swal2-actions){justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-toast button:where(.swal2-styled){margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;border-radius:50%}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}@container swal2-popup style(--swal2-icon-animations:true){.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}}.swal2-toast.swal2-show{animation:var(--swal2-toast-show-animation)}.swal2-toast.swal2-hide{animation:var(--swal2-toast-hide-animation)}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}');class TB extends k.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,s){console.error("Uncaught error:",e,s)}render(){return this.state.hasError?a.jsxs("div",{className:"p-6 bg-red-50 border border-red-200 rounded-lg text-red-700",children:[a.jsx("h2",{className:"text-lg font-bold mb-2",children:"Something went wrong"}),a.jsx("p",{className:"mb-4",children:"We encountered an error while displaying this component."}),a.jsx("pre",{className:"text-xs bg-red-100 p-2 rounded overflow-auto max-h-40",children:this.state.error?.toString()}),a.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Reload Page"})]}):this.props.children}}const Ck=k.createContext(null),AB=(t,e)=>e.split(".").reduce((s,n)=>s&&s[n],t),on=({value:t,field:e,icon:s,className:n=""})=>{const{company:r,editingField:i,editMode:o,tempValues:l,setEditingField:c,setTempValues:d,handleApplyChanges:u}=k.useContext(Ck),h=i===e&&o,p=n.includes("text-white")||n.includes("text-5xl"),f=()=>{o&&(c(e),d(g=>({...g,[e]:AB(r,e)||""})))},m=g=>{g.stopPropagation(),u(e)},b=g=>{g.stopPropagation(),c(null),d(x=>({...x,[e]:void 0}))};return a.jsxs("div",{className:`relative group ${n}`,onClick:f,children:[s&&!h&&a.jsx(s,{size:18,className:"flex-shrink-0"}),h?a.jsxs("div",{className:"mt-2 w-full",children:[a.jsx("input",{type:"text",value:l[e]||"",onClick:g=>g.stopPropagation(),onChange:g=>d(x=>({...x,[e]:g.target.value})),className:`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none ${p?"border-white/30 bg-white/20 backdrop-blur-sm text-white placeholder-white/70":"border-indigo-300 bg-white !text-black"}`,placeholder:p?t||"Enter text...":""}),a.jsxs("div",{className:"absolute right-0 top-full mt-2 flex gap-2 z-50",children:[a.jsx("button",{onClick:m,className:"p-1.5 bg-green-500 text-white rounded-md hover:bg-green-600 shadow-lg",children:a.jsx(Yr,{size:14})}),a.jsx("button",{onClick:b,className:"p-1.5 bg-red-500 text-white rounded-md hover:bg-red-600 shadow-lg",children:a.jsx(Pi,{size:14})})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("span",{className:p?"":"text-gray-800",children:t||"Not set"}),o&&a.jsx("button",{className:`absolute -right-3 -top-3 opacity-0 group-hover:opacity-100 p-1 rounded-full shadow-md transition-all ${p?"bg-white/20 backdrop-blur-sm text-white hover:text-yellow-300":"bg-white text-gray-600 hover:text-indigo-600"}`,onClick:()=>f(),children:a.jsx(l1,{size:12})})]})]})};function DB(){const[t,e]=k.useState({}),[s,n]=k.useState(!0),[r,i]=k.useState(null),[o,l]=k.useState(null),[c,d]=k.useState({}),[u,h]=k.useState(!1),[p,f]=k.useState(!1),[m,b]=k.useState(!1),[g,x]=k.useState("");k.useState(!1);const[y,w]=k.useState(!1),v=De.get("companyId");console.log("Stored companyId from cookie:",v),k.useEffect(()=>{v&&(console.log(" CompanyProfile component loaded, checking step status..."),C())},[v]),k.useEffect(()=>{t&&Object.keys(t).length>0&&v&&(console.log(" Company data loaded, checking if step should be auto-completed..."),setTimeout(()=>{C()},500))},[t,v]),k.useEffect(()=>{console.log(" useEffect triggered:",{hasCompany:!!t,isStepCompleted:y,hasBasicInfo:N()}),t&&!y&&N()&&(console.log(" Triggering automatic step completion check"),C())},[t,y]);const N=()=>{const L=t.name&&t.industry&&t.contact?.email;return console.log(" Checking basic info:",{name:t.name,industry:t.industry,email:t.contact?.email,hasInfo:L}),L},C=async()=>{try{if(!v){console.log(" No companyId available for step status check");return}console.log(" Checking step 1 status for company:",v);const L=await Ae.get(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${v}/onboarding`);if(console.log(" API response for onboarding:",L.data),L.data&&L.data.completedSteps&&Array.isArray(L.data.completedSteps))if(L.data.completedSteps.includes(1)){console.log(" Step 1 is already completed according to API"),w(!0);return}else console.log(" Step 1 is not completed according to API");const K=localStorage.getItem("companyOnboardingProgress");if(K)try{const B=JSON.parse(K);if(console.log(" Stored progress from localStorage:",B),B.completedSteps&&Array.isArray(B.completedSteps)&&B.completedSteps.includes(1)){console.log(" Step 1 found in localStorage, setting as completed"),w(!0);return}}catch(B){console.error(" Error parsing stored progress:",B)}else console.log(" No stored progress found in localStorage");if(N()){console.log(" Auto-completing step 1 locally because basic info is present"),w(!0);const B=L.data?.completedSteps||[],G=B.includes(1)?B:[...B,1],de={currentPhase:1,completedSteps:G,lastUpdated:new Date().toISOString()};localStorage.setItem("companyOnboardingProgress",JSON.stringify(de)),De.set("companyProfileStepCompleted","true",{expires:7}),window.dispatchEvent(new CustomEvent("stepCompleted",{detail:{stepId:1,phaseId:1,status:"completed",completedSteps:G}})),console.log(" Step 1 marked as completed locally and parent component notified")}else console.log(" Cannot auto-complete step 1 because basic info is missing")}catch(L){console.error(" Error checking step status:",L)}},j=t.contact&&(t.contact.email||t.contact.phone||t.contact.website||t.contact.address),I=t.socialMedia&&(t.socialMedia.linkedin||t.socialMedia.twitter||t.socialMedia.facebook||t.socialMedia.instagram),T=t.location&&t.location.lat&&t.location.lng,E=()=>t.contact?.address?`https://www.google.com/maps/embed/v1/place?key=undefined&q=${encodeURIComponent(t.contact.address)}`:T?`https://www.google.com/maps/embed/v1/view?key=YOUR_API_KEY&center=${t.location.lat},${t.location.lng}&zoom=15`:null,$=()=>t.contact?.address?`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(t.contact.address)}`:T?`https://www.google.com/maps/dir/?api=1&destination=${t.location.lat},${t.location.lng}`:null,D=L=>{x(L.target.value)},P=async()=>{try{n(!0);const L=await Ae.get(`https://v25searchcompanywizardbackend-production.up.railway.app/api/companies/${v}/details`);e(L.data.data),L.data.data.logo?x(L.data.data.logo):L.data.data.logoUrl&&x(L.data.data.logoUrl)}catch{i("Erreur lors du chargement des dtails de l'entreprise.")}finally{n(!1)}},_=L=>{e(K=>{const B=JSON.parse(JSON.stringify(K));if(L.includes(".")){const G=L.split(".");let de=B;for(let ae=0;ae<G.length-1;ae++){const ve=G[ae];if(!de[ve]){const Ne=G[ae+1],le=!isNaN(Number(Ne));de[ve]=le?[]:{}}de=de[ve]}de[G[G.length-1]]=c[L]}else B[L]=c[L];return B}),l(null),d({}),f(!0)},O=async()=>{try{if(console.log(" Starting save process..."),console.log(" Current company data:",t),console.log(" Has basic info:",N()),console.log(" Is step completed:",y),await Ae.put(`https://v25searchcompanywizardbackend-production.up.railway.app/api/companies/${v}`,t),console.log(" Company data saved successfully"),!y&&N()){console.log(" Marking step 1 as completed...");try{console.log(" Marking step 1 as completed in onboarding...");const K=(await Ae.get(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${v}/onboarding`)).data?.completedSteps||[],B=K.includes(1)?K:[...K,1],G=await Ae.put(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${v}/onboarding`,{completedSteps:B,currentPhase:1});console.log(" Company Profile step 1 marked as completed:",G.data),w(!0);const de={currentPhase:1,completedSteps:B,lastUpdated:new Date().toISOString()};localStorage.setItem("companyOnboardingProgress",JSON.stringify(de)),De.set("companyProfileStepCompleted","true",{expires:7}),console.log(" Local state and storage updated after step completion")}catch(L){console.error(" Error updating onboarding progress:",L)}}else console.log(" Step not marked as completed because:",{isStepCompleted:y,hasBasicInfo:N()});f(!1),h(!0),ka.fire({title:"Success!",text:"Company profile updated successfully and step marked as completed!",icon:"success",confirmButtonText:"Ok"}),setTimeout(()=>h(!1),3e3)}catch(L){console.error("Erreur lors de la sauvegarde :",L),ka.fire({title:"Error!",text:"There was an error updating the company profile.",icon:"error",confirmButtonText:"Try Again"})}};if(k.useEffect(()=>{P()},[]),s)return a.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:a.jsx("div",{className:"bg-white rounded-2xl shadow-xl w-full p-8",children:a.jsxs("div",{className:"animate-pulse space-y-6",children:[a.jsx("div",{className:"h-20 bg-gray-200 rounded-xl w-full"}),a.jsxs("div",{className:"flex gap-6",children:[a.jsx("div",{className:"h-24 w-24 bg-gray-200 rounded-xl"}),a.jsxs("div",{className:"space-y-4 flex-1",children:[a.jsx("div",{className:"h-10 bg-gray-200 rounded w-3/4"}),a.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/2"})]})]}),a.jsx("div",{className:"space-y-4",children:[1,2,3].map(L=>a.jsx("div",{className:"h-16 bg-gray-200 rounded-xl"},L))})]})})});const R={...t,name:t.name||"Company Name",industry:t.industry||"",overview:t.overview||"",mission:t.mission||"",founded:t.founded||"",headquarters:t.headquarters||"",logoUrl:t.logo||t.logoUrl||"",contact:t.contact||{},socialMedia:t.socialMedia||{},culture:t.culture||{values:[],benefits:[],workEnvironment:"Our workplace promotes collaboration and innovation."},opportunities:t.opportunities||{roles:[],growthPotential:"We offer clear career paths and growth opportunities.",training:"We invest in continuous learning and professional development."},technology:t.technology||{stack:[],innovation:"We use cutting-edge technologies to solve complex problems."}},X={company:t,editingField:o,editMode:m,tempValues:c,setEditingField:l,setTempValues:d,handleApplyChanges:_};return a.jsx(Ck.Provider,{value:X,children:a.jsx(TB,{children:a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("div",{className:"bg-white shadow-xl",children:a.jsxs("div",{className:"relative h-80",children:[a.jsxs("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:"url('https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?auto=format&fit=crop&q=80')"},children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-900/90 via-indigo-800/85 to-blue-900/80"}),a.jsx("style",{children:`
                  @keyframes shine {
                    0% { transform: translateX(-200%); }
                    100% { transform: translateX(200%); }
                  }
                `})]}),a.jsx("div",{className:"relative h-full flex flex-col justify-end p-12 space-y-6",children:a.jsxs("div",{className:"flex items-center gap-6",children:[a.jsxs("div",{className:"relative group",children:[a.jsxs("div",{className:`w-24 h-24 bg-white rounded-2xl shadow-xl flex items-center justify-center p-4 overflow-hidden ${m?"cursor-pointer":""}`,children:[g?a.jsx("img",{src:g,alt:R.name,className:"w-full h-full object-contain",onError:L=>{L.currentTarget.src="",x("")}}):a.jsx(Ks,{className:"w-full h-full text-indigo-600"}),m&&a.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:a.jsxs("div",{className:"text-white text-center",children:[a.jsx(Ri,{size:20,className:"mx-auto mb-1"}),a.jsx("span",{className:"text-xs",children:"Edit Logo"})]})})]}),m&&o==="logo"&&a.jsx("div",{className:"absolute top-full left-0 mt-2 w-64 bg-white rounded-lg shadow-lg p-3 border border-gray-200",children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm text-gray-600 block",children:"Logo URL"}),a.jsx("input",{type:"text",value:g,onChange:D,placeholder:"Enter logo URL...",className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none !text-black !bg-white"}),a.jsxs("div",{className:"flex justify-end gap-2 mt-2",children:[a.jsx("button",{onClick:()=>l(null),className:"px-3 py-1 text-sm text-gray-600 hover:text-gray-800",children:"Cancel"}),a.jsx("button",{onClick:()=>{e(L=>({...L,logo:g})),l(null),f(!0)},className:"px-3 py-1 text-sm bg-indigo-600 text-white rounded-md hover:bg-indigo-700",children:"Save"})]})]})}),m&&a.jsx("button",{onClick:()=>l(o==="logo"?null:"logo"),className:"absolute -right-2 -top-2 w-6 h-6 bg-white rounded-full shadow-md flex items-center justify-center text-gray-600 hover:text-indigo-600 transition-colors",children:a.jsx(Hg,{size:12})})]}),a.jsxs("div",{children:[a.jsx("div",{className:"flex items-center gap-3 mb-2",children:a.jsx(on,{value:R.name,field:"name",className:"text-5xl font-bold text-white tracking-tight"})}),a.jsxs("div",{className:"flex flex-wrap gap-6 text-white/90",children:[R.industry&&a.jsx(on,{value:R.industry,field:"industry",icon:s4,className:"flex items-center gap-2 bg-white/10 px-4 py-2 rounded-full backdrop-blur-sm"}),R.founded&&a.jsx(on,{value:R.founded,field:"founded",icon:Er,className:"flex items-center gap-2 bg-white/10 px-4 py-2 rounded-full backdrop-blur-sm"}),R.headquarters&&a.jsx(on,{value:R.headquarters,field:"headquarters",icon:Zr,className:"flex items-center gap-2 bg-white/10 px-4 py-2 rounded-full backdrop-blur-sm"})]})]})]})}),a.jsx("div",{className:"absolute top-6 right-6 z-10",children:a.jsx("button",{onClick:()=>{const L=!m;b(L),!L&&p&&O()},className:`p-3 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 ${m?"bg-indigo-600 text-white":"bg-white/90 backdrop-blur-sm text-indigo-600 hover:bg-white"}`,children:m?a.jsx(c1,{size:20}):a.jsx(l1,{size:20})})})]})}),a.jsxs("div",{className:"flex",children:[a.jsx("div",{className:"w-80 flex-shrink-0 bg-gradient-to-b from-gray-50 to-white border-r border-gray-200",children:a.jsxs("div",{className:"p-6 space-y-8",children:[j&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[a.jsx(jl,{className:"text-blue-600",size:20}),"Contact Information"]}),a.jsxs("div",{className:"space-y-3",children:[R.contact?.email&&a.jsx(on,{value:R.contact.email,field:"contact.email",icon:jl,className:"flex items-center gap-3 text-gray-600 hover:text-blue-600 transition-colors text-sm"}),R.contact?.phone&&a.jsx(on,{value:R.contact.phone,field:"contact.phone",icon:oa,className:"flex items-center gap-3 text-gray-600 hover:text-blue-600 transition-colors text-sm"}),R.contact?.website&&a.jsx(on,{value:R.contact.website,field:"contact.website",icon:Ks,className:"flex items-center gap-3 text-gray-600 hover:text-blue-600 transition-colors text-sm"}),R.contact?.address&&a.jsx(on,{value:R.contact.address,field:"contact.address",icon:Zr,className:"flex items-start gap-3 text-gray-600 text-sm"})]}),(R.contact?.address||T)&&a.jsx("div",{className:"mt-4",children:a.jsx("div",{className:"relative w-full h-[160px] rounded-xl overflow-hidden border border-gray-200 bg-gray-50",children:E()?a.jsxs(a.Fragment,{children:[a.jsx("iframe",{src:E(),width:"100%",height:"100%",style:{border:0},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",className:"absolute inset-0"}),$()&&a.jsxs("a",{href:$(),target:"_blank",rel:"noopener noreferrer",className:"absolute bottom-2 right-2 px-3 py-1.5 bg-white/90 hover:bg-white text-sm text-blue-600 rounded-lg shadow-lg backdrop-blur-sm flex items-center gap-1.5 transition-all hover:scale-105",children:[a.jsx(Zr,{size:14}),"Get Directions"]})]}):a.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-gray-500 text-sm",children:a.jsx("span",{children:"Map not available"})})})})]}),I&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center gap-2",children:[a.jsx(Ks,{className:"text-blue-600",size:20}),"Digital Presence"]}),a.jsxs("div",{className:"flex gap-3",children:[R.socialMedia?.linkedin&&a.jsx("a",{href:R.socialMedia.linkedin,target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 flex items-center justify-center rounded-lg bg-white border border-gray-200 hover:border-blue-400 hover:text-blue-600 transition-all duration-300 text-gray-600",children:a.jsx(h4,{size:20})}),R.socialMedia?.twitter&&a.jsx("a",{href:R.socialMedia.twitter,target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 flex items-center justify-center rounded-lg bg-white border border-gray-200 hover:border-blue-400 hover:text-blue-600 transition-all duration-300 text-gray-600",children:a.jsx(k4,{size:20})}),R.socialMedia?.facebook&&a.jsx("a",{href:R.socialMedia.facebook,target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 flex items-center justify-center rounded-lg bg-white border border-gray-200 hover:border-blue-400 hover:text-blue-600 transition-all duration-300 text-gray-600",children:a.jsx(e1,{size:20})}),R.socialMedia?.instagram&&a.jsx("a",{href:R.socialMedia.instagram,target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 flex items-center justify-center rounded-lg bg-white border border-gray-200 hover:border-blue-400 hover:text-blue-600 transition-all duration-300 text-gray-600",children:a.jsx(u4,{size:20})})]})]})]})}),a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"p-12 space-y-16",children:[a.jsxs("section",{className:"relative",children:[a.jsx("div",{className:"absolute -left-6 top-0 bottom-0 w-1 bg-gradient-to-b from-indigo-500 to-blue-500 rounded-full"}),a.jsxs("div",{className:"space-y-8",children:[a.jsxs("div",{className:"flex items-start gap-6",children:[a.jsx("div",{className:"w-12 h-12 rounded-2xl bg-indigo-100 flex items-center justify-center flex-shrink-0",children:a.jsx(Mc,{className:"text-indigo-600",size:24})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Company Overview"}),a.jsx(on,{value:R.overview,field:"overview",className:"text-gray-700 leading-relaxed text-lg"})]})]}),R.mission&&a.jsx("div",{className:"ml-18 p-8 bg-gradient-to-br from-indigo-50 via-blue-50 to-white rounded-2xl border border-indigo-100/50 shadow-sm",children:a.jsxs("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:"w-12 h-12 rounded-2xl bg-indigo-500 flex items-center justify-center",children:a.jsx(Ys,{className:"text-white",size:24})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-bold text-indigo-700 mb-3",children:"Our Mission"}),a.jsx(on,{value:R.mission,field:"mission",className:"text-gray-700"})]})]})})]})]}),a.jsxs("div",{className:"grid md:grid-cols-2 gap-10",children:[a.jsx("section",{className:"space-y-8",children:a.jsxs("div",{className:"flex items-start gap-6",children:[a.jsx("div",{className:"w-12 h-12 rounded-2xl bg-rose-100 flex items-center justify-center flex-shrink-0",children:a.jsx(c4,{className:"text-rose-600",size:24})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Culture & Values"}),a.jsx("div",{className:"space-y-4",children:R.culture.values&&R.culture.values.map((L,K)=>a.jsx(on,{value:L,field:`culture.values.${K}`,icon:QR,className:"p-4 bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md hover:scale-[1.02] transition-all duration-300"},K))})]})]})}),a.jsx("section",{className:"space-y-8",children:a.jsxs("div",{className:"flex items-start gap-6",children:[a.jsx("div",{className:"w-12 h-12 rounded-2xl bg-emerald-100 flex items-center justify-center flex-shrink-0",children:a.jsx(N4,{className:"text-emerald-600",size:24})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Key Benefits"}),a.jsx("div",{className:"space-y-4",children:R.culture.benefits&&R.culture.benefits.map((L,K)=>a.jsx(on,{value:L,field:`culture.benefits.${K}`,icon:jr,className:"p-4 bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md hover:scale-[1.02] transition-all duration-300"},K))})]})]})})]}),a.jsxs("section",{className:"relative",children:[a.jsx("div",{className:"absolute -left-6 top-0 bottom-0 w-1 bg-gradient-to-b from-blue-500 to-indigo-500 rounded-full"}),a.jsxs("div",{className:"flex items-start gap-6",children:[a.jsx("div",{className:"w-12 h-12 rounded-2xl bg-blue-100 flex items-center justify-center flex-shrink-0",children:a.jsx(JR,{className:"text-blue-600",size:24})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Tech Stack"}),a.jsx("div",{className:"flex flex-wrap gap-3",children:R.technology.stack&&R.technology.stack.map((L,K)=>a.jsx(on,{value:L,field:`technology.stack.${K}`,className:"px-4 py-2 bg-gray-100/50 rounded-lg text-gray-700 font-medium hover:bg-indigo-50 hover:text-indigo-600 transition-colors"},K))}),R.technology.innovation&&a.jsx("div",{className:"mt-6 p-6 bg-blue-50 rounded-xl border border-blue-100",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx(Kg,{className:"text-blue-600 mt-1",size:20}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-blue-900 mb-1",children:"Innovation Focus"}),a.jsx(on,{value:R.technology.innovation,field:"technology.innovation",className:"text-blue-800"})]})]})})]})]})]}),a.jsx("section",{className:"space-y-8",children:a.jsxs("div",{className:"flex items-start gap-6",children:[a.jsx("div",{className:"w-12 h-12 rounded-2xl bg-purple-100 flex items-center justify-center flex-shrink-0",children:a.jsx(Ir,{className:"text-purple-600",size:24})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Career Growth"}),a.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"p-6 bg-white rounded-xl shadow-sm border border-gray-100",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:a.jsx(js,{className:"text-purple-600",size:18})}),a.jsx("h3",{className:"font-semibold text-gray-900",children:"Growth Potential"})]}),a.jsx(on,{value:R.opportunities.growthPotential,field:"opportunities.growthPotential",className:"text-gray-600"})]}),a.jsxs("div",{className:"p-6 bg-white rounded-xl shadow-sm border border-gray-100",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:a.jsx(a4,{className:"text-purple-600",size:18})}),a.jsx("h3",{className:"font-semibold text-gray-900",children:"Learning & Development"})]}),a.jsx(on,{value:R.opportunities.training,field:"opportunities.training",className:"text-gray-600"})]})]})]})]})})]})})]})]})})})}const _B=()=>{const[t,e]=k.useState("automatic"),[s,n]=k.useState([]),[r,i]=k.useState("pending"),[o,l]=k.useState(1),[c,d]=k.useState(!1),[u,h]=k.useState(null),[p,f]=k.useState(!1),m=De.get("companyId");k.useEffect(()=>{m&&b()},[m]),k.useEffect(()=>{m&&g()&&!p&&(console.log(" KYC data changed, checking if step should be auto-completed..."),b())},[s,r,o,m,p]);const b=async()=>{try{if(!m)return;console.log(" Checking step 2 status for company:",m);const C=await Ae.get(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${m}/onboarding/phases/1/steps/2`);if(console.log(" API response for step 2:",C.data),C.data&&C.data.status==="completed"){console.log(" Step 2 is already completed according to API"),f(!0);return}const j=localStorage.getItem("companyOnboardingProgress");if(j)try{const I=JSON.parse(j);if(I.completedSteps&&Array.isArray(I.completedSteps)&&I.completedSteps.includes(2)){console.log(" Step 2 found in localStorage, setting as completed"),f(!0);return}}catch(I){console.error(" Error parsing stored progress:",I)}if(g()&&!p){console.log(" Auto-completing step 2 locally because basic info is present"),f(!0);const I=[2],T={currentPhase:1,completedSteps:I,lastUpdated:new Date().toISOString()};localStorage.setItem("companyOnboardingProgress",JSON.stringify(T)),De.set("kycVerificationStepCompleted","true",{expires:7}),window.dispatchEvent(new CustomEvent("stepCompleted",{detail:{stepId:2,phaseId:1,status:"completed",completedSteps:I}})),console.log(" Step 2 marked as completed locally and parent component notified")}}catch(C){console.error(" Error checking step status:",C);const j=localStorage.getItem("companyOnboardingProgress");if(j)try{const I=JSON.parse(j);I.completedSteps&&Array.isArray(I.completedSteps)&&I.completedSteps.includes(2)&&f(!0)}catch(I){console.error(" Error parsing stored progress:",I)}}},g=()=>{const C=s.length>=3&&r==="completed";return console.log(" Checking basic info for KYC:",{uploadedFiles:s.length,verificationStatus:r,hasInfo:C}),C},x=async()=>{try{if(!m){console.error(" No companyId available");return}console.log(" Completing KYC verification...");const C=await Ae.put(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${m}/onboarding/phases/1/steps/2`,{status:"completed"});console.log(" Step 2 marked as completed:",C.data),f(!0);const j={currentPhase:1,completedSteps:[2],lastUpdated:new Date().toISOString()};localStorage.setItem("companyOnboardingProgress",JSON.stringify(j)),De.set("kycVerificationStepCompleted","true",{expires:7}),window.dispatchEvent(new CustomEvent("stepCompleted",{detail:{stepId:2,phaseId:1,status:"completed",completedSteps:[2]}})),console.log(" KYC verification completed and step 2 marked as completed")}catch(C){console.error(" Error completing KYC verification:",C)}},y=C=>{const j=C.target.files;if(j){const I=Array.from(j).map(T=>T.name);n([...s,...I])}},w=[{title:"Certificate of Incorporation",description:"Official document proving company registration",format:"PDF or Image",required:!0,type:"company"},{title:"Proof of Address",description:"Recent utility bill or bank statement (less than 3 months old)",format:"PDF or Image",required:!0,type:"company"},{title:"Director ID",description:"Government-issued ID of company director",format:"PDF or Image",required:!0,type:"personal"},{title:"Bank Statement",description:"Recent bank statement for account verification",format:"PDF",required:!0,type:"financial"},{title:"Tax Registration",description:"Company tax registration certificate",format:"PDF",required:!0,type:"company"},{title:"Ownership Structure",description:"Document showing company ownership structure",format:"PDF",required:!0,type:"company"}],v=[{title:"Document Collection",description:"Upload all required documents",status:o>1?"completed":o===1?"current":"pending"},{title:"Identity Verification",description:"Verify company director identity",status:o>2?"completed":o===2?"current":"pending"},{title:"Business Verification",description:"Verify business details and operations",status:o>3?"completed":o===3?"current":"pending"},{title:"Final Review",description:"Review and confirm all information",status:o>4?"completed":o===4?"current":"pending"}],N=C=>{h(C),d(!0)};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"KYC/KYB Verification"}),p&&a.jsxs("div",{className:"flex items-center gap-2 bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium",children:[a.jsx(Yr,{className:"w-4 h-4"}),"Completed"]})]}),a.jsx("p",{className:"text-sm text-gray-500",children:"Complete identity verification for your company"})]}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsx("button",{className:"rounded-lg bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:"Save Progress"}),p?a.jsxs("button",{className:"rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white shadow-sm cursor-not-allowed",children:[a.jsx(Yr,{className:"mr-2 h-4 w-4"}),"Verification Completed"]}):a.jsxs("button",{onClick:x,className:"rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-green-700",disabled:!g(),children:[a.jsx(ht,{className:"mr-2 h-4 w-4"}),"Complete Verification"]})]})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Verification Progress"}),a.jsxs("span",{className:"text-sm text-gray-500",children:["Step ",o," of 4"]})]}),a.jsx("div",{className:"mt-4",children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute left-0 top-2 h-0.5 w-full bg-gray-200",children:a.jsx("div",{className:"absolute h-0.5 bg-indigo-600 transition-all duration-500",style:{width:`${(o-1)*33.33}%`}})}),a.jsx("div",{className:"relative flex justify-between",children:v.map((C,j)=>a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx("div",{className:`flex h-8 w-8 items-center justify-center rounded-full border-2 ${C.status==="completed"?"border-indigo-600 bg-indigo-600":C.status==="current"?"border-indigo-600 bg-white":"border-gray-300 bg-white"}`,children:C.status==="completed"?a.jsx(ht,{className:"h-5 w-5 text-white"}):a.jsx("span",{className:`text-sm font-medium ${C.status==="current"?"text-indigo-600":"text-gray-500"}`,children:j+1})}),a.jsxs("div",{className:"mt-2 text-center",children:[a.jsx("p",{className:`text-sm font-medium ${C.status==="completed"?"text-indigo-600":C.status==="current"?"text-gray-900":"text-gray-500"}`,children:C.title}),a.jsx("p",{className:"mt-1 text-xs text-gray-500",children:C.description})]})]},j))})]})})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Choose Verification Method"}),a.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2",children:[a.jsxs("button",{className:`flex items-center justify-between rounded-lg border p-4 ${t==="automatic"?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:bg-gray-50"}`,onClick:()=>e("automatic"),children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(Xg,{className:"mr-3 h-6 w-6 text-indigo-600"}),a.jsxs("div",{className:"text-left",children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Automatic Verification"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Quick verification through our trusted partners"})]})]}),t==="automatic"&&a.jsx(ht,{className:"h-5 w-5 text-indigo-600"})]}),a.jsxs("button",{className:`flex items-center justify-between rounded-lg border p-4 ${t==="manual"?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:bg-gray-50"}`,onClick:()=>e("manual"),children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(Ri,{className:"mr-3 h-6 w-6 text-indigo-600"}),a.jsxs("div",{className:"text-left",children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Manual Document Upload"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Upload required documents manually"})]})]}),t==="manual"&&a.jsx(ht,{className:"h-5 w-5 text-indigo-600"})]})]})]}),t==="automatic"?a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Automatic Verification"}),a.jsxs("div",{className:"mt-4 space-y-4",children:[a.jsxs("div",{className:"rounded-lg bg-gray-50 p-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(XR,{className:"mr-2 h-5 w-5 text-indigo-600"}),a.jsx("span",{className:"font-medium text-gray-900",children:"Identity Verification"})]}),a.jsx("button",{className:"rounded-md bg-indigo-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",children:"Start Verification"})]}),a.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Complete the verification process through our secure partner platform"})]}),a.jsxs("div",{className:"rounded-lg bg-gray-50 p-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(Mc,{className:"mr-2 h-5 w-5 text-indigo-600"}),a.jsx("span",{className:"font-medium text-gray-900",children:"Business Verification"})]}),a.jsx("button",{className:"rounded-md bg-indigo-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",children:"Verify Business"})]}),a.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Verify your business through official registries and databases"})]}),a.jsxs("div",{className:"rounded-lg border border-gray-200 p-4",children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Verification Steps"}),a.jsxs("ul",{className:"mt-2 space-y-2",children:[a.jsxs("li",{className:"flex items-center text-sm text-gray-500",children:[a.jsx(ht,{className:"mr-2 h-4 w-4 text-green-500"}),"Prepare valid government-issued ID"]}),a.jsxs("li",{className:"flex items-center text-sm text-gray-500",children:[a.jsx(ht,{className:"mr-2 h-4 w-4 text-green-500"}),"Ensure good lighting for photo capture"]}),a.jsxs("li",{className:"flex items-center text-sm text-gray-500",children:[a.jsx(ht,{className:"mr-2 h-4 w-4 text-green-500"}),"Follow on-screen instructions"]}),a.jsxs("li",{className:"flex items-center text-sm text-gray-500",children:[a.jsx(ht,{className:"mr-2 h-4 w-4 text-green-500"}),"Complete facial recognition check"]})]})]})]})]}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Required Documents"}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("span",{className:"text-sm text-gray-500",children:[s.length," of ",w.length," uploaded"]}),a.jsx("div",{className:"h-2 w-24 rounded-full bg-gray-200",children:a.jsx("div",{className:"h-2 rounded-full bg-indigo-600",style:{width:`${s.length/w.length*100}%`}})})]})]}),a.jsx("div",{className:"space-y-4",children:["company","personal","financial"].map(C=>a.jsxs("div",{className:"rounded-lg border border-gray-200 p-4",children:[a.jsxs("h4",{className:"mb-3 font-medium text-gray-900 capitalize",children:[C," Documents"]}),a.jsx("div",{className:"space-y-3",children:w.filter(j=>j.type===C).map((j,I)=>a.jsxs("div",{className:"rounded-lg border border-gray-200 p-4",children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"mt-1",children:a.jsx(is,{className:"h-5 w-5 text-indigo-600"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:j.title}),a.jsx("p",{className:"text-sm text-gray-500",children:j.description}),a.jsxs("p",{className:"mt-1 text-xs text-gray-400",children:["Format: ",j.format]})]})]}),a.jsx("div",{className:"flex items-center space-x-2",children:s.includes(j.title)?a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("button",{onClick:()=>N(j.title),className:"rounded-md bg-gray-100 p-1 text-gray-600 hover:bg-gray-200",children:a.jsx(Bc,{className:"h-4 w-4"})}),a.jsx("span",{className:"text-sm text-green-600",children:"Uploaded"}),a.jsx(ht,{className:"h-5 w-5 text-green-500"})]}):a.jsx("button",{onClick:()=>document.getElementById(`file-${I}`)?.click(),className:"rounded-md bg-white px-3 py-2 text-sm font-medium text-indigo-600 shadow-sm ring-1 ring-inset ring-indigo-300 hover:bg-indigo-50",children:"Upload"})})]}),a.jsx("input",{id:`file-${I}`,type:"file",className:"hidden",onChange:y,accept:".pdf,.jpg,.jpeg,.png"})]},I))})]},C))})]}),c&&u&&a.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:a.jsxs("div",{className:"flex min-h-screen items-end justify-center px-4 pb-20 pt-4 text-center sm:block sm:p-0",children:[a.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:a.jsx("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),a.jsxs("div",{className:"inline-block transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",children:[a.jsx("div",{className:"absolute right-0 top-0 pr-4 pt-4",children:a.jsx("button",{onClick:()=>d(!1),className:"rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none",children:a.jsx(Pi,{className:"h-6 w-6"})})}),a.jsx("div",{className:"sm:flex sm:items-start",children:a.jsxs("div",{className:"mt-3 w-full text-center sm:ml-4 sm:mt-0 sm:text-left",children:[a.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:u}),a.jsx("div",{className:"mt-4",children:a.jsx("div",{className:"aspect-w-16 aspect-h-9 overflow-hidden rounded-lg bg-gray-100",children:a.jsx("div",{className:"flex h-64 items-center justify-center",children:a.jsx(is,{className:"h-16 w-16 text-gray-400"})})})})]})})]})]})}),a.jsx("div",{className:"mt-6 rounded-lg bg-yellow-50 p-4",children:a.jsxs("div",{className:"flex",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(hs,{className:"h-5 w-5 text-yellow-400"})}),a.jsxs("div",{className:"ml-3",children:[a.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Document Guidelines"}),a.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:a.jsxs("ul",{className:"list-disc space-y-1 pl-5",children:[a.jsx("li",{children:"All documents must be clear and legible"}),a.jsx("li",{children:"Files should not exceed 5MB in size"}),a.jsx("li",{children:"Supported formats: PDF, JPG, PNG"}),a.jsx("li",{children:"Documents must be in color and not black and white"}),a.jsx("li",{children:"No expired documents will be accepted"})]})})]})]})})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Verification Status"}),a.jsx("div",{className:"mt-4",children:a.jsxs("div",{className:"flex items-center justify-between rounded-lg bg-gray-50 p-4",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[r==="completed"?a.jsx(ht,{className:"h-6 w-6 text-green-500"}):r==="failed"?a.jsx(hs,{className:"h-6 w-6 text-red-500"}):r==="in_progress"?a.jsx($r,{className:"h-6 w-6 animate-spin text-indigo-600"}):a.jsx(St,{className:"h-6 w-6 text-gray-400"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:r==="completed"?"Verification Complete":r==="failed"?"Verification Failed":r==="in_progress"?"Verification in Progress":"Verification Pending"}),a.jsx("p",{className:"text-sm text-gray-500",children:r==="completed"?"Your company has been successfully verified":r==="failed"?"Please review and resubmit your documents":r==="in_progress"?"This process may take 1-2 business days":"Please submit all required documents"})]})]}),r==="completed"&&a.jsxs("button",{className:"flex items-center rounded-md bg-white px-3 py-2 text-sm font-medium text-indigo-600 shadow-sm ring-1 ring-inset ring-indigo-300 hover:bg-indigo-50",children:[a.jsx(Sl,{className:"mr-2 h-4 w-4"}),"Download Certificate"]})]})})]}),a.jsx("div",{className:"rounded-lg bg-white p-6 shadow",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx(n1,{className:"h-6 w-6 text-gray-400"})}),a.jsxs("div",{className:"ml-3",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-900",children:"Need Help?"}),a.jsx("div",{className:"mt-2 text-sm text-gray-500",children:a.jsx("p",{children:"If you're having trouble with the verification process, our support team is here to help. Contact us through our support portal or schedule a call with our verification specialists."})}),a.jsx("div",{className:"mt-3",children:a.jsxs("a",{href:"#",className:"text-sm font-medium text-indigo-600 hover:text-indigo-500",children:["Contact Support ",a.jsx(Fh,{className:"ml-1 inline-block h-4 w-4"})]})})]})]})})]})},RB=()=>{const[t,e]=k.useState(!1),[s,n]=k.useState(!1),r=De.get("companyId");k.useEffect(()=>{r&&(o(),i())},[r]);const i=async()=>{try{if(!r)return;const d=await Ae.get(`https://v25searchcompanywizardbackend-production.up.railway.app/api/companies/${r}/subscription`);if(d.data&&d.data.subscription&&!t)try{const u=await Ae.put(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${r}/onboarding/phases/1/steps/3`,{status:"completed"});console.log(" Subscription step 3 automatically marked as completed:",u.data),e(!0);const h={currentPhase:1,completedSteps:[3],lastUpdated:new Date().toISOString()};localStorage.setItem("companyOnboardingProgress",JSON.stringify(h)),De.set("subscriptionStepCompleted","true",{expires:7})}catch(u){console.error("Error auto-completing subscription step:",u)}}catch(d){console.error("Error checking existing subscription:",d)}},o=async()=>{try{if(!r)return;const d=await Ae.get(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${r}/onboarding/phases/1/steps/3`);if(d.data&&d.data.status==="completed"){e(!0);return}const u=localStorage.getItem("companyOnboardingProgress");if(u)try{const h=JSON.parse(u);if(h.completedSteps&&Array.isArray(h.completedSteps)&&h.completedSteps.includes(3)){e(!0);return}}catch(h){console.error("Error parsing stored progress:",h)}}catch(d){console.error("Error checking step status:",d)}},l={name:"Free",value:"free",price:"0",description:"Perfect for trying out our platform",features:["Up to 5 active gigs","Basic reporting","Email support","Community access","Standard support","Basic analytics","Single phone number"]},c=async()=>{try{n(!0),console.log("Starting plan activation..."),console.log("Company ID:",r);const d=await Ae.put(`https://v25searchcompanywizardbackend-production.up.railway.app/api/companies/${r}/subscription`,{subscription:"free"});if(!d.data)throw new Error("Pas de rponse du serveur pour la mise  jour du plan");console.log("Subscription update response:",d.data);const p=await Ae.put(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${r}/onboarding/phases/1/steps/3`,{status:"completed"});if(!p.data)throw new Error("Pas de rponse du serveur pour la mise  jour de l'tape");console.log("Step completion response:",p.data),e(!0);const f={currentPhase:1,completedSteps:[3],lastUpdated:new Date().toISOString()};localStorage.setItem("companyOnboardingProgress",JSON.stringify(f)),De.set("subscriptionStepCompleted","true",{expires:7}),await new Promise(m=>setTimeout(m,500)),window.location.reload()}catch(d){console.error("Error details:",d),d.response?(console.error("API Error:",{status:d.response.status,data:d.response.data,url:d.config?.url}),console.log(`Erreur lors de l'activation du plan: ${d.response.data?.message||d.message}`)):console.log("Une erreur est survenue lors de l'activation du plan")}finally{n(!1)}};return a.jsxs("div",{className:"space-y-4",children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Free Plan"})}),a.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Start using our platform with our comprehensive free plan."})]})}),a.jsx("div",{className:"max-w-md",children:a.jsxs("div",{className:"rounded-lg border border-indigo-600 p-4 shadow-sm ring-1 ring-indigo-600",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-xl font-bold text-gray-900",children:l.name}),a.jsx("span",{className:"inline-flex items-center rounded-full bg-indigo-100 px-2 py-0.5 text-xs font-medium text-indigo-800",children:"Recommended"})]}),a.jsx("p",{className:"mt-2 text-sm text-gray-500",children:l.description}),a.jsxs("p",{className:"mt-4",children:[a.jsxs("span",{className:"text-3xl font-bold text-gray-900",children:["$",l.price]}),a.jsx("span",{className:"text-sm font-medium text-gray-500",children:"/month"})]}),a.jsx("ul",{className:"mt-4 space-y-1",children:l.features.map(d=>a.jsxs("li",{className:"flex items-center",children:[a.jsx(YR,{className:"h-4 w-4 text-indigo-600"}),a.jsx("span",{className:"ml-2 text-sm text-gray-700",children:d})]},d))}),a.jsx("button",{onClick:t?void 0:c,disabled:t||s,className:`mt-6 w-full rounded-lg px-4 py-2 text-center text-sm font-semibold text-white shadow-sm transition-all ${t?"bg-green-600 cursor-not-allowed":s?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"}`,children:t?a.jsxs("span",{className:"flex items-center justify-center gap-2",children:[a.jsx(Yr,{className:"w-4 h-4"}),"Plan Already Activated"]}):s?"Activating Plan...":"Activate Free Plan"})]})})]})},PB=()=>{const[t,e]=k.useState(1),[s,n]=k.useState(1),[r,i]=k.useState(!1),[o,l]=k.useState(!1),[c,d]=k.useState([]),u=De.get("companyId");k.useEffect(()=>{u&&h()},[u]),k.useEffect(()=>{u&&p()&&!o&&(console.log(" Call script data changed, checking if step should be auto-completed..."),h())},[c,u,o]);const h=async()=>{try{if(!u)return;console.log(" Checking step 8 status for company:",u);const g=await Ae.get(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${u}/onboarding/phases/2/steps/8`);if(console.log(" API response for step 8:",g.data),g.data&&g.data.status==="completed"){console.log(" Step 8 is already completed according to API"),l(!0);return}const x=localStorage.getItem("companyOnboardingProgress");if(x)try{const y=JSON.parse(x);if(y.completedSteps&&Array.isArray(y.completedSteps)&&y.completedSteps.includes(8)){console.log(" Step 8 found in localStorage, setting as completed"),l(!0);return}}catch(y){console.error(" Error parsing stored progress:",y)}if(p()&&!o){console.log(" Auto-completing step 8 locally because basic info is present"),l(!0);const y=[8],w={currentPhase:2,completedSteps:y,lastUpdated:new Date().toISOString()};localStorage.setItem("companyOnboardingProgress",JSON.stringify(w)),De.set("callScriptStepCompleted","true",{expires:7}),window.dispatchEvent(new CustomEvent("stepCompleted",{detail:{stepId:8,phaseId:2,status:"completed",completedSteps:y}})),console.log(" Step 8 marked as completed locally and parent component notified")}}catch(g){console.error(" Error checking step status:",g);const x=localStorage.getItem("companyOnboardingProgress");if(x)try{const y=JSON.parse(x);y.completedSteps&&Array.isArray(y.completedSteps)&&y.completedSteps.includes(8)&&l(!0)}catch(y){console.error(" Error parsing stored progress:",y)}}},p=()=>{const g=c.filter(y=>y.status==="active"),x=g.length>=2&&g.every(y=>y.sections&&y.sections.length>0);return console.log(" Checking basic info for CallScript:",{activeScripts:g.length,hasInfo:x}),x},f=async()=>{try{if(!u){console.error(" No companyId available");return}console.log(" Completing call script setup...");const g=await Ae.put(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${u}/onboarding/phases/2/steps/8`,{status:"completed"});console.log(" Step 8 marked as completed:",g.data),l(!0);const x={currentPhase:2,completedSteps:[8],lastUpdated:new Date().toISOString()};localStorage.setItem("companyOnboardingProgress",JSON.stringify(x)),De.set("callScriptStepCompleted","true",{expires:7}),window.dispatchEvent(new CustomEvent("stepCompleted",{detail:{stepId:8,phaseId:2,status:"completed",completedSteps:[8]}})),console.log(" Call script setup completed and step 8 marked as completed")}catch(g){console.error(" Error completing call script setup:",g)}};k.useEffect(()=>{d([{id:1,name:"Product Introduction",description:"Initial call script for introducing our product to potential clients",status:"active",lastModified:"2 hours ago",sections:[{id:1,title:"Opening",content:"Hi, this is [REP_NAME] from [COMPANY]. I noticed you recently showed interest in [PRODUCT/SERVICE]. Is this a good time to talk?",type:"greeting",variations:2},{id:2,title:"Value Proposition",content:"We help companies like yours [BENEFIT_1] and [BENEFIT_2], resulting in [OUTCOME].",type:"pitch",variations:3},{id:3,title:"Qualification Questions",content:`1. What challenges are you currently facing with [PAIN_POINT]?
2. How are you currently handling [PROCESS]?
3. What would make this solution ideal for your needs?`,type:"questions",variations:1}]},{id:2,name:"Objection Handling",description:"Responses to common customer objections",status:"active",lastModified:"1 day ago",sections:[{id:4,title:"Price Objection",content:"I understand that price is a concern. Let me explain our ROI calculation...",type:"response",variations:2}]}])},[]);const m=g=>{e(g),n(null)},b=g=>{n(s===g?null:g)};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Call Script Builder"}),o&&a.jsxs("div",{className:"flex items-center gap-2 bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium",children:[a.jsx(Yr,{className:"w-4 h-4"}),"Completed"]})]}),a.jsx("p",{className:"text-sm text-gray-500",children:"Create and manage conversation flows for your REPS"})]}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsxs("button",{className:"flex items-center rounded-lg bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",onClick:()=>i(!r),children:[a.jsx(El,{className:"mr-2 h-4 w-4"}),"AI Assistant"]}),o?a.jsxs("button",{className:"flex items-center rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white shadow-sm cursor-not-allowed",children:[a.jsx(Yr,{className:"mr-2 h-4 w-4"}),"Setup Completed"]}):a.jsxs("button",{onClick:f,className:"flex items-center rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-green-700",disabled:!p(),children:[a.jsx(ht,{className:"mr-2 h-4 w-4"}),"Complete Setup"]}),a.jsxs("button",{className:"flex items-center rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",children:[a.jsx(Xs,{className:"mr-2 h-4 w-4"}),"New Script"]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[a.jsx("div",{className:"lg:col-span-1",children:a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h3",{className:"mb-4 text-lg font-medium text-gray-900",children:"Scripts"}),a.jsx("div",{className:"space-y-3",children:c.map(g=>a.jsxs("button",{className:`flex w-full items-center justify-between rounded-lg border p-3 text-left ${t===g.id?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:bg-gray-50"}`,onClick:()=>m(g.id),children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(is,{className:`h-5 w-5 ${t===g.id?"text-indigo-600":"text-gray-400"}`}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:g.name}),a.jsx("p",{className:"text-sm text-gray-500",children:g.description})]})]}),a.jsx("span",{className:`rounded-full px-2 py-1 text-xs font-medium ${g.status==="active"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:g.status})]},g.id))})]})}),a.jsx("div",{className:"lg:col-span-2",children:a.jsxs("div",{className:"rounded-lg bg-white shadow",children:[a.jsx("div",{className:"border-b border-gray-200 p-6",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:c.find(g=>g.id===t)?.name}),a.jsxs("p",{className:"text-sm text-gray-500",children:["Last modified ",c.find(g=>g.id===t)?.lastModified]})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("button",{className:"rounded-md p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-500",children:a.jsx(o4,{className:"h-5 w-5"})}),a.jsx("button",{className:"rounded-md p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-500",children:a.jsx(Qn,{className:"h-5 w-5"})}),a.jsx("button",{className:"rounded-md p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-500",children:a.jsx(Sl,{className:"h-5 w-5"})})]})]})}),a.jsxs("div",{className:"p-6",children:[a.jsx("div",{className:"space-y-4",children:c.find(g=>g.id===t)?.sections.map(g=>a.jsxs("div",{className:"rounded-lg border border-gray-200",children:[a.jsxs("div",{className:"flex cursor-pointer items-center justify-between p-4",onClick:()=>b(g.id),children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(_i,{className:"h-5 w-5 text-indigo-600"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:g.title}),a.jsxs("p",{className:"text-sm text-gray-500",children:[g.variations," variation",g.variations!==1?"s":""]})]})]}),s===g.id?a.jsx(Lc,{className:"h-5 w-5 text-gray-400"}):a.jsx(Cl,{className:"h-5 w-5 text-gray-400"})]}),s===g.id&&a.jsxs("div",{className:"border-t border-gray-200 p-4",children:[a.jsx("textarea",{className:"w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",rows:4,defaultValue:g.content}),a.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs("button",{className:"rounded-md bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:[a.jsx(i4,{className:"mr-2 h-4 w-4 inline"}),"Add Variation"]}),a.jsxs("button",{className:"rounded-md bg-white px-3 py-2 text-sm font-medium text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:[a.jsx(e4,{className:"mr-2 h-4 w-4 inline"}),"Duplicate"]})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs("button",{className:"rounded-md bg-white px-3 py-2 text-sm font-medium text-red-600 shadow-sm ring-1 ring-inset ring-red-300 hover:bg-red-50",children:[a.jsx(er,{className:"mr-2 h-4 w-4 inline"}),"Delete"]}),a.jsxs("button",{className:"rounded-md bg-indigo-600 px-3 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",children:[a.jsx(c1,{className:"mr-2 h-4 w-4 inline"}),"Save Changes"]})]})]})]})]},g.id))}),a.jsxs("button",{className:"mt-4 flex w-full items-center justify-center rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",children:[a.jsx(Xs,{className:"mr-2 h-4 w-4"}),"Add New Section"]})]})]})})]}),r&&a.jsx("div",{className:"rounded-lg bg-indigo-50 p-6",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(El,{className:"h-6 w-6 text-indigo-600"}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-indigo-900",children:"AI Script Suggestions"}),a.jsxs("div",{className:"mt-4 space-y-4",children:[a.jsxs("div",{className:"rounded-lg bg-white p-4 shadow-sm",children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Opening Improvements"}),a.jsxs("ul",{className:"mt-2 space-y-2",children:[a.jsxs("li",{className:"flex items-start",children:[a.jsx(js,{className:"mr-2 mt-1 h-4 w-4 text-indigo-600"}),a.jsx("span",{className:"text-sm text-gray-700",children:"Add a personalized element mentioning their industry"})]}),a.jsxs("li",{className:"flex items-start",children:[a.jsx(js,{className:"mr-2 mt-1 h-4 w-4 text-indigo-600"}),a.jsx("span",{className:"text-sm text-gray-700",children:"Include a relevant market trend or statistic"})]})]}),a.jsx("button",{className:"mt-3 text-sm font-medium text-indigo-600 hover:text-indigo-500",children:"Generate Variations "})]}),a.jsxs("div",{className:"rounded-lg bg-white p-4 shadow-sm",children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Value Proposition Enhancement"}),a.jsxs("ul",{className:"mt-2 space-y-2",children:[a.jsxs("li",{className:"flex items-start",children:[a.jsx(js,{className:"mr-2 mt-1 h-4 w-4 text-indigo-600"}),a.jsx("span",{className:"text-sm text-gray-700",children:"Add specific metrics or case study results"})]}),a.jsxs("li",{className:"flex items-start",children:[a.jsx(js,{className:"mr-2 mt-1 h-4 w-4 text-indigo-600"}),a.jsx("span",{className:"text-sm text-gray-700",children:"Include industry-specific pain points"})]})]}),a.jsx("button",{className:"mt-3 text-sm font-medium text-indigo-600 hover:text-indigo-500",children:"Generate Variations "})]})]})]})]})}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Script Writing Best Practices"}),a.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[a.jsx("div",{className:"rounded-lg border border-gray-200 p-4",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"rounded-full bg-green-100 p-2 text-green-600",children:a.jsx(ht,{className:"h-5 w-5"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Be Natural"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Write conversationally and avoid robotic language"})]})]})}),a.jsx("div",{className:"rounded-lg border border-gray-200 p-4",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"rounded-full bg-blue-100 p-2 text-blue-600",children:a.jsx(_i,{className:"h-5 w-5"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Active Listening"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Include prompts for REPs to acknowledge customer responses"})]})]})}),a.jsx("div",{className:"rounded-lg border border-gray-200 p-4",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"rounded-full bg-yellow-100 p-2 text-yellow-600",children:a.jsx(hs,{className:"h-5 w-5"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Handle Objections"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Prepare responses for common customer concerns"})]})]})})]})]})]})},FB=()=>{const[t,e]=k.useState(["calls","conversion"]),[s,n]=k.useState("weekly"),[r,i]=k.useState(["voice","email","chat"]),[o,l]=k.useState({email:!0,push:!1,threshold:!0}),[c,d]=k.useState(!1),u=De.get("companyId");k.useEffect(()=>{u&&h()},[u]),k.useEffect(()=>{u&&p()&&!c&&(console.log(" Reporting setup data changed, checking if step should be auto-completed..."),h())},[t,r,s,u,c]);const h=async()=>{try{if(!u)return;console.log(" Checking step 9 status for company:",u);const w=await Ae.get(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${u}/onboarding/phases/2/steps/9`);if(console.log(" API response for step 9:",w.data),w.data&&w.data.status==="completed"){console.log(" Step 9 is already completed according to API"),d(!0);return}const v=localStorage.getItem("companyOnboardingProgress");if(v)try{const N=JSON.parse(v);if(N.completedSteps&&Array.isArray(N.completedSteps)&&N.completedSteps.includes(9)){console.log(" Step 9 found in localStorage, setting as completed"),d(!0);return}}catch(N){console.error(" Error parsing stored progress:",N)}if(p()&&!c){console.log(" Auto-completing step 9 locally because basic info is present"),d(!0);const N=[9],C={currentPhase:2,completedSteps:N,lastUpdated:new Date().toISOString()};localStorage.setItem("companyOnboardingProgress",JSON.stringify(C)),De.set("reportingSetupStepCompleted","true",{expires:7}),window.dispatchEvent(new CustomEvent("stepCompleted",{detail:{stepId:9,phaseId:2,status:"completed",completedSteps:N}})),console.log(" Step 9 marked as completed locally and parent component notified")}}catch(w){console.error(" Error checking step status:",w);const v=localStorage.getItem("companyOnboardingProgress");if(v)try{const N=JSON.parse(v);N.completedSteps&&Array.isArray(N.completedSteps)&&N.completedSteps.includes(9)&&d(!0)}catch(N){console.error(" Error parsing stored progress:",N)}}},p=()=>{const w=t.length>0&&r.length>0&&s;return console.log(" Checking basic info for ReportingSetup:",{selectedMetrics:t.length,selectedChannels:r.length,reportSchedule:s,hasInfo:w}),w},f=async()=>{try{if(!u){console.error(" No companyId available");return}console.log(" Completing reporting setup...");const w=await Ae.put(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${u}/onboarding/phases/2/steps/9`,{status:"completed"});console.log(" Step 9 marked as completed:",w.data),d(!0);const v={currentPhase:2,completedSteps:[9],lastUpdated:new Date().toISOString()};localStorage.setItem("companyOnboardingProgress",JSON.stringify(v)),De.set("reportingSetupStepCompleted","true",{expires:7}),window.dispatchEvent(new CustomEvent("stepCompleted",{detail:{stepId:9,phaseId:2,status:"completed",completedSteps:[9]}})),console.log(" Reporting setup completed and step 9 marked as completed")}catch(w){console.error(" Error completing reporting setup:",w)}},m=[{id:"voice",name:"Voice Calls",description:"Traditional phone call metrics",icon:g4,metrics:["volume","duration","quality"]},{id:"email",name:"Email",description:"Email communication tracking",icon:jl,metrics:["response_time","resolution_rate","volume"]},{id:"chat",name:"Live Chat",description:"Web chat interactions",icon:_i,metrics:["response_time","satisfaction","volume"]},{id:"social",name:"Social Media",description:"Social platform engagement",icon:e1,metrics:["response_time","sentiment","engagement"]},{id:"video",name:"Video Calls",description:"Video conference metrics",icon:f1,metrics:["quality","duration","technical_issues"]},{id:"whatsapp",name:"WhatsApp",description:"WhatsApp business metrics",icon:o1,metrics:["response_time","volume","engagement"]}],b=[{id:"channel_performance",name:"Channel Performance",description:"Compare metrics across different channels",icon:Wg,category:"cross_channel"},{id:"response_times",name:"Response Times",description:"Track response times per channel",icon:St,category:"efficiency"},{id:"resolution_rates",name:"Resolution Rates",description:"First contact and overall resolution",icon:ht,category:"quality"},{id:"customer_satisfaction",name:"Customer Satisfaction",description:"CSAT scores across channels",icon:HR,category:"quality"},{id:"channel_utilization",name:"Channel Utilization",description:"Usage patterns across channels",icon:Yv,category:"efficiency"},{id:"cross_channel_journey",name:"Customer Journey",description:"Track multi-channel customer journeys",icon:Ks,category:"analysis"},{id:"queue_metrics",name:"Queue Metrics",description:"Wait times and queue management",icon:tr,category:"efficiency"},{id:"channel_costs",name:"Channel Costs",description:"Cost per contact by channel",icon:Gg,category:"financial"}],g=[{id:1,name:"Omnichannel Overview",description:"Cross-channel performance metrics",type:"standard",metrics:["channel_performance","response_times","customer_satisfaction"]},{id:2,name:"Channel Efficiency",description:"Response times and resolution rates",type:"custom",metrics:["response_times","resolution_rates","queue_metrics"]},{id:3,name:"Quality Monitoring",description:"Quality metrics across channels",type:"standard",metrics:["customer_satisfaction","resolution_rates"]},{id:4,name:"Customer Journey Analysis",description:"Multi-channel interaction tracking",type:"custom",metrics:["cross_channel_journey","channel_utilization"]}],x=w=>{t.includes(w)?e(t.filter(v=>v!==w)):e([...t,w])},y=w=>{r.includes(w)?i(r.filter(v=>v!==w)):i([...r,w])};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Multi-Channel Reporting Setup"}),c&&a.jsxs("div",{className:"flex items-center gap-2 bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium",children:[a.jsx(Yr,{className:"w-4 h-4"}),"Completed"]})]}),a.jsx("p",{className:"text-sm text-gray-500",children:"Configure reporting across all communication channels"})]}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsxs("button",{className:"flex items-center rounded-lg bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:[a.jsx(Qn,{className:"mr-2 h-4 w-4"}),"Settings"]}),c?a.jsxs("button",{className:"flex items-center rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white shadow-sm cursor-not-allowed",children:[a.jsx(Yr,{className:"mr-2 h-4 w-4"}),"Setup Completed"]}):a.jsxs("button",{onClick:f,className:"flex items-center rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-green-700",disabled:!p(),children:[a.jsx(ht,{className:"mr-2 h-4 w-4"}),"Complete Setup"]})]})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Communication Channels"}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Select channels to include in your reports"}),a.jsx("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:m.map(w=>{const v=w.icon,N=r.includes(w.id);return a.jsxs("div",{className:`cursor-pointer rounded-lg border p-4 ${N?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:bg-gray-50"}`,onClick:()=>y(w.id),children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:`rounded-lg p-2 ${N?"bg-indigo-500 text-white":"bg-gray-100 text-gray-500"}`,children:a.jsx(v,{className:"h-5 w-5"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:w.name}),a.jsx("p",{className:"text-sm text-gray-500",children:w.description})]})]}),N&&a.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:w.metrics.map(C=>a.jsx("span",{className:"inline-flex items-center rounded-full bg-indigo-100 px-2.5 py-0.5 text-xs font-medium text-indigo-800",children:C.replace("_"," ")},C))})]},w.id)})})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Cross-Channel Metrics"}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Select metrics to track across all channels"}),a.jsx("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:b.map(w=>{const v=w.icon,N=t.includes(w.id);return a.jsx("div",{className:`cursor-pointer rounded-lg border p-4 ${N?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:bg-gray-50"}`,onClick:()=>x(w.id),children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:`rounded-lg p-2 ${N?"bg-indigo-500 text-white":"bg-gray-100 text-gray-500"}`,children:a.jsx(v,{className:"h-5 w-5"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:w.name}),a.jsx("p",{className:"text-sm text-gray-500",children:w.description})]})]})},w.id)})})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Multi-Channel Dashboards"}),a.jsx("div",{className:"mt-4 space-y-4",children:g.map(w=>a.jsx("div",{className:"rounded-lg border border-gray-200 p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:w.name}),a.jsx("p",{className:"text-sm text-gray-500",children:w.description}),a.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:w.metrics.map(v=>{const N=b.find(C=>C.id===v);return N?a.jsx("span",{className:"inline-flex items-center rounded-full bg-indigo-100 px-2.5 py-0.5 text-xs font-medium text-indigo-800",children:N.name},v):null})})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("button",{className:"rounded-md p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-500",children:a.jsx(Oh,{className:"h-4 w-4"})}),a.jsx("button",{className:"rounded-md p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-500",children:a.jsx(po,{className:"h-4 w-4"})}),a.jsx("button",{className:"rounded-md p-2 text-gray-400 hover:bg-gray-100 hover:text-red-500",children:a.jsx(er,{className:"h-4 w-4"})})]})]})},w.id))})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Report Scheduling"}),a.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-6 lg:grid-cols-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Report Frequency"}),a.jsxs("select",{className:"mt-1 block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-base focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm",value:s,onChange:w=>n(w.target.value),children:[a.jsx("option",{value:"daily",children:"Daily"}),a.jsx("option",{value:"weekly",children:"Weekly"}),a.jsx("option",{value:"monthly",children:"Monthly"}),a.jsx("option",{value:"quarterly",children:"Quarterly"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Delivery Method"}),a.jsxs("div",{className:"mt-2 space-y-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{id:"email-notifications",type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500",checked:o.email,onChange:w=>l({...o,email:w.target.checked})}),a.jsxs("label",{htmlFor:"email-notifications",className:"ml-2 flex items-center text-sm text-gray-700",children:[a.jsx(jl,{className:"mr-2 h-4 w-4"}),"Email Reports"]})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{id:"push-notifications",type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500",checked:o.push,onChange:w=>l({...o,push:w.target.checked})}),a.jsxs("label",{htmlFor:"push-notifications",className:"ml-2 flex items-center text-sm text-gray-700",children:[a.jsx(KR,{className:"mr-2 h-4 w-4"}),"Push Notifications"]})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{id:"threshold-alerts",type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500",checked:o.threshold,onChange:w=>l({...o,threshold:w.target.checked})}),a.jsxs("label",{htmlFor:"threshold-alerts",className:"ml-2 flex items-center text-sm text-gray-700",children:[a.jsx(hs,{className:"mr-2 h-4 w-4"}),"Threshold Alerts"]})]})]})]})]})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Cross-Channel Visualization"}),a.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-3",children:[a.jsx("div",{className:"rounded-lg border border-gray-200 p-4",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(Wg,{className:"h-5 w-5 text-indigo-600"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Channel Comparison"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Compare metrics across channels"})]})]})}),a.jsx("div",{className:"rounded-lg border border-gray-200 p-4",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(i1,{className:"h-5 w-5 text-indigo-600"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Trend Analysis"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Track patterns over time"})]})]})}),a.jsx("div",{className:"rounded-lg border border-gray-200 p-4",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(x4,{className:"h-5 w-5 text-indigo-600"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Channel Distribution"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Volume distribution by channel"})]})]})})]})]}),a.jsx("div",{className:"rounded-lg bg-white p-6 shadow",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Export Options"}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Download or share your cross-channel reports"})]}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsxs("button",{className:"flex items-center rounded-lg bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:[a.jsx(Oh,{className:"mr-2 h-4 w-4"}),"Share"]}),a.jsxs("button",{className:"flex items-center rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",children:[a.jsx(Sl,{className:"mr-2 h-4 w-4"}),"Export"]})]})]})})]})},i0="https://harxv25comporchestratorfront.netlify.app/zoho-logo.png";class ri{static instance;config={accessToken:null,refreshToken:null,tokenExpiry:null,isConfigured:!1};constructor(){this.initializeFromServer().catch(e=>{console.debug("ZohoService: Initial configuration not found",e)})}static getInstance(){return ri.instance||(ri.instance=new ri),ri.instance}async initializeFromServer(){try{const e=De.get("userId");if(!e){console.debug("ZohoService: No userId found in cookies");return}const s=await fetch(`undefined/zoho/config/user/${e}`,{headers:{Authorization:`Bearer ${De.get("gigId")}:${e}`,"Content-Type":"application/json"}});if(s.ok){const n=await s.json();this.config.accessToken=n.access_token,this.config.refreshToken=n.refresh_token,this.config.tokenExpiry=Date.now()+n.expires_in*1e3,this.config.isConfigured=!0,console.debug("ZohoService: Configuration loaded successfully")}else s.status===404?console.debug("ZohoService: No configuration found for user"):console.debug("ZohoService: Failed to load configuration",s.status)}catch(e){console.debug("ZohoService: Error initializing from server",e)}}async refreshToken(){try{const e=De.get("userId");if(!e)return console.debug("ZohoService: No userId found for token refresh"),!1;const s=await fetch(`undefined/zoho/config/user/${e}/refresh-token`,{method:"POST",headers:{Authorization:`Bearer ${De.get("gigId")}:${e}`,"Content-Type":"application/json"}});if(s.ok){const n=await s.json();return this.config.accessToken=n.access_token,this.config.refreshToken=n.refresh_token,this.config.tokenExpiry=Date.now()+n.expires_in*1e3,console.debug("ZohoService: Token refreshed successfully"),!0}else return console.debug("ZohoService: Failed to refresh token",s.status),!1}catch(e){return console.debug("ZohoService: Error refreshing token",e),!1}}isConfigured(){return this.config.isConfigured}getAccessToken(){return this.config.accessToken}async getValidAccessToken(){try{return(!this.config.accessToken||!this.config.tokenExpiry||Date.now()>=this.config.tokenExpiry)&&!await this.refreshToken()?(console.debug("ZohoService: Failed to get valid access token"),null):this.config.accessToken}catch(e){return console.debug("ZohoService: Error getting valid access token",e),null}}resetConfiguration(){this.config={accessToken:null,refreshToken:null,tokenExpiry:null,isConfigured:!1},console.debug("ZohoService: Configuration reset")}}const Sk=k.memo(({onCancelProcessing:t})=>{const e=()=>{i.current&&(i.current.abort(),i.current=null),N(!1),je.current=!1,d(0),x(null),w(!1),He({current:0,total:0,status:"Cancelled by user (Back to Onboarding)",isProcessing:!1}),localStorage.removeItem("uploadProcessing"),localStorage.removeItem("parsedLeads"),localStorage.removeItem("validationResults"),sessionStorage.removeItem("uploadProcessing"),sessionStorage.removeItem("parsedLeads"),sessionStorage.removeItem("validationResults"),document.body.removeAttribute("data-processing"),l(null),j([]),Xt(null);const Q=document.getElementById("file-upload");Q&&(Q.value=""),t&&t()},s=()=>{i.current&&(i.current.abort(),i.current=null),je.current=!1,N(!1),localStorage.clear(),sessionStorage.clear(),d(0),x(null),w(!1),j([]),Xt(null),l(null),document.body.removeAttribute("data-processing"),He({current:0,total:0,status:"EMERGENCY CANCELLED",isProcessing:!1})};k.useEffect(()=>(window.cancelUploadProcessing=e,window.emergencyCancelUpload=s,()=>{delete window.cancelUploadProcessing,delete window.emergencyCancelUpload}),[]);const n=k.useRef(!1),r=k.useRef(!1),i=k.useRef(null),[o,l]=k.useState(null),[c,d]=k.useState(0),[u,h]=k.useState(["all"]),[p,f]=k.useState(""),[m,b]=k.useState("all"),[g,x]=k.useState(null),[y,w]=k.useState(!1),[v,N]=k.useState(!1),[C,j]=k.useState([]),[I,T]=k.useState(!0),[E,$]=k.useState(!0),[D,P]=k.useState(!1),[_,O]=k.useState(0),[R,X]=k.useState([]),[L,K]=k.useState(!1);k.useState({clientId:"",clientSecret:"",refreshToken:"",companyId:De.get("companyId")||""});const[B,G]=k.useState(!1),[de,ae]=k.useState(!1),[ve,Ne]=k.useState([]),[le,H]=k.useState([]),[ue,F]=k.useState(!1),[ee,re]=k.useState(null),[te,ce]=k.useState([]),[Se,Pe]=k.useState(1),[$e,rt]=k.useState(1);k.useState(50);const[q,fe]=k.useState(0),[Fe,et]=k.useState([]),[Me,Xe]=k.useState(""),[it,Et]=k.useState(!1),[yt,xe]=k.useState(!1),[Ve,qe]=k.useState(!1),[We,at]=k.useState(null),[Ct,ut]=k.useState(!0),[mt,Xt]=k.useState(null),[mn,S]=k.useState(null),[z,Y]=k.useState(!1),Ce=k.useRef(!1),je=k.useRef(!1),se=k.useRef(!1),_e=k.useRef(null),[Ke,He]=k.useState({current:0,total:0,status:"",isProcessing:!1}),gt=()=>{He({current:0,total:0,status:"",isProcessing:!1})},Yt=(Q,ke,Re=!1)=>{try{const ct=Bg(ke,50),Je=zg(ct),Qe=JSON.stringify(Je),Dt=Re?3*1024*1024:1*1024*1024;return Qe.length>Dt?Re?(console.warn(` Data for ${Q} too large for sessionStorage (${Math.round(Qe.length/1024/1024)}MB)`),!1):(console.warn(` Data for ${Q} too large for localStorage, using sessionStorage`),Yt(Q,ke,!0)):(Re?sessionStorage.setItem(Q,Qe):localStorage.setItem(Q,Qe),!0)}catch{console.warn(` Storage full for ${Q}, cleaning up and retrying`),Uv();try{const Je=Bg(ke,25),Qe=zg(Je),Dt=JSON.stringify(Qe);return Re?sessionStorage.setItem(Q,Dt):localStorage.setItem(Q,Dt),!0}catch{return Re?(console.error(` Both localStorage and sessionStorage are full for ${Q}`),!1):(console.warn(` Still full after cleanup, trying sessionStorage for ${Q}`),Yt(Q,ke,!0))}}},$i=Q=>{try{let ke=localStorage.getItem(Q);return ke||(ke=sessionStorage.getItem(Q),ke)?JSON.parse(ke):null}catch(ke){return console.error(` Error parsing data for ${Q}:`,ke),null}},zg=Q=>{try{return Array.isArray(Q)?Q.map(ke=>({_id:ke._id,gigId:ke.gigId,userId:ke.userId,companyId:ke.companyId,Email_1:ke.Email_1,Phone:ke.Phone,Deal_Name:ke.Deal_Name,Stage:ke.Stage,Pipeline:ke.Pipeline,updatedAt:ke.updatedAt})):Q}catch(ke){return console.error(" Error compressing data:",ke),Q}},Bg=(Q,ke=100)=>{try{return Array.isArray(Q)&&Q.length>ke?(console.warn(` Limiting data to ${ke} items (was ${Q.length})`),Q.slice(-ke)):Q}catch(Re){return console.error(" Error limiting data size:",Re),Q}},Uv=()=>{try{localStorage.removeItem("uploadProcessing"),sessionStorage.removeItem("uploadProcessing");const Q=["companyOnboardingProgress","kycVerificationStepCompleted"];Object.keys(localStorage).forEach(ct=>{!Q.includes(ct)&&(ct.includes("leads")||ct.includes("parsed"))&&localStorage.removeItem(ct)}),Object.keys(sessionStorage).forEach(ct=>{(ct.includes("leads")||ct.includes("parsed"))&&sessionStorage.removeItem(ct)}),console.log(" Cleaned up localStorage and sessionStorage to free space")}catch(Q){console.error(" Error cleaning up localStorage:",Q)}},Ug=(Q,ke)=>{je.current&&(d(Q),He({current:Q,total:100,status:ke,isProcessing:!0}))};k.useEffect(()=>{const Q=localStorage.getItem("uploadProcessing")==="true",ke=o!==null,Re=C.length>0;if(Q&&!ke&&!Re){N(!1),je.current=!1,localStorage.removeItem("uploadProcessing"),sessionStorage.removeItem("uploadProcessing");return}if(Q&&(ke||Re))return je.current=!0,N(!0),()=>{};if(!se.current&&!n.current){const ct=$i("parsedLeads"),Je=$i("validationResults");ct&&!C.length&&j(ct),Je&&!mt&&Xt(Je),se.current=!0,n.current=!0}},[]),k.useEffect(()=>{C.length>0&&(Yt("parsedLeads",C)||(console.warn(" Could not save parsed leads to storage - keeping in memory only"),j(ke=>ke.map(Re=>({...Re,_memoryOnly:!0}))))),window.cancelUploadProcessing||(window.cancelUploadProcessing=e),window.emergencyCancelUpload||(window.emergencyCancelUpload=s)}),k.useEffect(()=>{(C.length>0||localStorage.getItem("parsedLeads"))&&(r.current=!0)},[C.length]),k.useEffect(()=>()=>{const Q=!localStorage.getItem("parsedLeads")&&!sessionStorage.getItem("parsedLeads");C.length>0&&!Q&&Yt("parsedLeads",C)},[C]),k.useEffect(()=>{!o&&C.length===0&&localStorage.getItem("uploadProcessing")==="true"&&(N(!1),je.current=!1,localStorage.removeItem("uploadProcessing"),sessionStorage.removeItem("uploadProcessing"))},[o,C.length]);const Vg=[{id:"all",name:"All Channels",icon:Ks},{id:"voice",name:"Voice Calls",icon:oa}],Vv=async Q=>{try{if(!je.current)throw new Error("Processing cancelled by user");i.current=new AbortController;const ke=De.get("userId"),Re=Me,ct=De.get("companyId");if(!Re)throw new Error("Please select a gig first");if(!ke||!ct)throw new Error("Missing user or company information");const Je=new FormData;Je.append("file",Q),Ug(20,"Sending file to server...");const Qe=await fetch("undefined/file-processing/process",{method:"POST",body:Je,signal:i.current?.signal,headers:{Accept:"application/json"}});if(!Qe.ok){let Jn=`Backend error: ${Qe.status} ${Qe.statusText}`;try{const Wv=await Qe.json();Wv.error&&(Jn=Wv.error)}catch{}throw new Error(Jn)}const Dt=await Qe.json();if(!Dt.success)throw new Error(Dt.error||"Backend processing failed");const Rt=Dt.data;if(!Rt||!Rt.leads||!Array.isArray(Rt.leads))throw new Error("Invalid response format from backend");const ho=Rt.leads.map(Jn=>({...Jn,userId:{$oid:ke},companyId:{$oid:ct},gigId:{$oid:Re}}));return Ug(100,"Processing completed!"),{...Rt,leads:ho}}catch(ke){throw console.error(" Error in processFileWithBackend:",ke),ke}},ie=async Q=>{const ke=Q.target.files?.[0];if(ke){if(!Me){jt.error("Please select a gig first before uploading a file");return}const Re=[...ve],ct=[...le];l(null),x(null),w(!1),N(!1),d(0),j([]),Xt(null),T(!0),$(!0),gt(),localStorage.removeItem("parsedLeads"),localStorage.removeItem("validationResults"),localStorage.removeItem("uploadProcessing"),localStorage.removeItem("hasSeenImportChoiceModal"),sessionStorage.removeItem("uploadProcessing"),sessionStorage.removeItem("parsedLeads"),sessionStorage.removeItem("validationResults"),document.body.removeAttribute("data-processing"),je.current=!1;const Je=document.getElementById("file-upload");Je&&(Je.value=""),l(ke),x(null),w(!1),N(!0),d(10),j([]),document.body.setAttribute("data-processing","true"),je.current=!0,localStorage.setItem("uploadProcessing","true"),sessionStorage.setItem("uploadProcessing","true");try{if(!je.current)return;const Qe=await Vv(ke);if(Qe.leads.length===0){jt.error("No valid leads found in the file. Please check the file format and content."),x("No valid leads found"),N(!1),d(0);return}Qe.validation&&Xt(Qe.validation),j(Qe.leads);const Dt=Yt("parsedLeads",Qe.leads),Rt=Yt("validationResults",Qe.validation);Dt||(console.warn(" Could not save leads to storage - data too large, keeping in memory only"),Y(!0)),Rt||console.warn(" Could not save validation results to storage - data too large"),Re.length>0&&(Ne(Re),H(ct)),N(!1),d(100),document.body.removeAttribute("data-processing"),je.current=!1,localStorage.removeItem("uploadProcessing"),sessionStorage.removeItem("uploadProcessing")}catch(Qe){console.error("Error uploading file:",Qe);const Dt=Qe.message||"Error uploading file";x(Dt),jt.error(Dt),d(0),N(!1)}}},be=Q=>{if(Q==="all"){h(["all"]);return}if(u.includes("all")){h([Q]);return}if(u.includes(Q)){const ke=u.filter(Re=>Re!==Q);h(ke.length===0?["all"]:ke)}else h([...u.filter(ke=>ke!=="all"),Q])},me=async()=>{if(!(!C||C.length===0)){P(!0),O(0),X([]),T(!1),je.current=!0;try{const Q=De.get("userId"),ke=Me,Re=De.get("companyId");console.log(" Saving leads with IDs:"),console.log(`   currentUserId: ${Q}`),console.log(`   currentGigId: ${ke}`),console.log(`   currentCompanyId: ${Re}`),console.log(`   Cookie gigId: ${De.get("gigId")}`),console.log(`   selectedGigId: ${Me}`);const ct=C.map(Qe=>({userId:Qe.userId?.$oid||Q,companyId:Qe.companyId?.$oid||Re,gigId:Qe.gigId?.$oid||ke,Last_Activity_Time:Qe.Last_Activity_Time||null,Deal_Name:Qe.Deal_Name||"Unnamed Lead",Email_1:Qe.Email_1||"no-email@placeholder.com",Phone:Qe.Phone||"no-phone@placeholder.com",Stage:Qe.Stage||"New",Pipeline:Qe.Pipeline||"Sales Pipeline",Activity_Tag:Qe.Activity_Tag||"",Telephony:Qe.Telephony||"",Project_Tags:Qe.Project_Tags||[],First_Name:Qe.First_Name||"",Last_Name:Qe.Last_Name||"",Address:Qe.Address||"",Postal_Code:Qe.Postal_Code||"",City:Qe.City||"",Date_of_Birth:Qe.Date_of_Birth||""}));if(!je.current)throw new Error("Processing cancelled by user");d(30);const Je=await Ae.post("undefined/leads/bulk",{leads:ct},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${ke}:${Q}`},timeout:6e4});if(d(90),Je.status===201||Je.status===207){const Qe=Je.data,Dt=Qe.count||(Qe.data?Qe.data.length:0);w(!0),d(100),jt.success(`Successfully saved ${Dt} contacts!`),Qe.data&&Array.isArray(Qe.data)&&(X(Qe.data),Ne(Rt=>[...Rt,...Qe.data]),H(Rt=>[...Rt,...Qe.data]),fe(Rt=>Rt+Dt),O(Dt)),j([]),Xt(null),localStorage.removeItem("validationResults"),sessionStorage.removeItem("validationResults");try{const Rt=De.get("companyId");Rt&&(await Ae.put(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${Rt}/onboarding/phases/2/steps/6`,{status:"completed"}),localStorage.setItem("stepCompleted",JSON.stringify({stepId:6,phaseId:2,data:{success:!0,leadsSaved:Dt}})))}catch(Rt){console.error("Error updating onboarding progress:",Rt)}}else throw new Error(Je.statusText||"Bulk save failed")}catch(Q){console.error("Error in handleSaveLeads:",Q);const ke=Q.message||"Error saving leads";x(ke),jt.error(ke)}finally{P(!1),je.current=!1,T(!0),$(!0),setTimeout(()=>{l(null),d(0),w(!1),j([]),x(null),Xt(null),X([]),localStorage.removeItem("parsedLeads"),localStorage.removeItem("validationResults"),localStorage.removeItem("uploadProcessing"),sessionStorage.removeItem("uploadProcessing"),sessionStorage.removeItem("parsedLeads"),sessionStorage.removeItem("validationResults"),document.body.removeAttribute("data-processing"),je.current=!1;const Q=document.getElementById("file-upload");Q&&(Q.value="")},2e3)}}},ze=async()=>{try{const Q=De.get("userId");if(!Q){console.error("No userId found in cookies"),jt.error("User ID not found. Please log in again.");return}const Re=encodeURIComponent("undefined/zoho/auth/callback"),ct=encodeURIComponent(Q),Je=`undefined/zoho/auth?redirect_uri=${Re}&state=${ct}`,Qe=await fetch(Je,{method:"GET",headers:{Accept:"application/json",Authorization:`Bearer ${Q}`}});if(!Qe.ok){const ho=await Qe.json();throw console.error("Error response:",ho),new Error(ho.error||"Failed to get Zoho auth URL")}const Dt=await Qe.json(),Rt=new URL(Dt.authUrl);Rt.searchParams.set("state",Q),window.location.href=Rt.toString()}catch(Q){console.error("Error in handleZohoConnect:",Q),jt.error(Q?.message||"Failed to initiate Zoho authentication")}},Ge=async()=>{ae(!0);try{const Q=De.get("userId"),ke=Me||De.get("gigId");if(!Q){console.error("No userId found in cookies"),jt.error("User ID not found. Please log in again.");return}const Re=await fetch("undefined/zoho/disconnect",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ke}:${Q}`}});if(!Re.ok){const Je=await Re.json();throw console.error("Error response:",Je),new Error(Je.message||"Failed to disconnect from Zoho")}const ct=await Re.json();if(ct.success)ri.getInstance().resetConfiguration(),K(!1),xe(!1),ce([]),j([]);else throw new Error(ct.message||"Failed to disconnect from Zoho")}catch(Q){console.error("Error in handleZohoDisconnect:",Q),jt.error(Q?.message||"Failed to disconnect from Zoho")}finally{ae(!1)}};k.useEffect(()=>{const Q=()=>{const ke=new URLSearchParams(window.location.search),Re=ke.get("code"),ct=ke.get("state"),Je=ke.get("location"),Qe=ke.get("accounts-server"),Dt=new URLSearchParams(window.location.search);if(Dt.get("session")==="someGeneratedSessionId"){Dt.delete("session");const Rt=Dt.toString();window.history.replaceState({},"",`${window.location.pathname}${Rt?"?"+Rt:""}`)}if(Re){if(!ct){console.error("No state parameter found in URL"),jt.error("Authentication state not found. Please try connecting again.");return}pt(Re,ct,Je||void 0,Qe||void 0)}};Ce.current||(Ce.current=!0,Q())},[]);const pt=async(Q,ke,Re,ct)=>{try{const Je=ke||De.get("userId");if(!Je)throw new Error("User ID not found in state parameter or cookies");const Qe=new URLSearchParams({code:Q,state:Je,...Re&&{location:Re},...ct&&{accountsServer:ct}}).toString(),Dt=await fetch(`undefined/zoho/auth/callback?${Qe}`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${Me||De.get("gigId")}:${Je}`}}),Rt=await Dt.json();if(!Dt.ok)throw new Error(Rt.error||"Failed to exchange code for tokens");K(!0)}catch(Je){console.error("Error handling OAuth callback:",Je),jt.error(Je.message||"Failed to complete Zoho authentication")}};k.useEffect(()=>{v||je.current},[L,v]);const ys=async(Q,ke={},Re)=>{const ct=De.get("userId"),Qe={"Content-Type":"application/json",Authorization:`Bearer ${Re||Me||De.get("gigId")}:${ct}`,...ke.headers};let Dt=await fetch(Q,{...ke,headers:Qe});if(Dt.status===401)if((await fetch(`undefined/zoho/config/user/${ct}/refresh-token`,{method:"POST",headers:Qe})).ok)Dt=await fetch(Q,{...ke,headers:Qe});else throw jt.error("Session Zoho expire. Veuillez vous reconnecter."),new Error("Zoho token expired");return Dt},us=async()=>{if(!Me){jt.error("Please select a gig first");return}G(!0),ce([]);try{const Q=De.get("userId"),ke=De.get("companyId");if(!ke){jt.error("Configuration de l'entreprise non trouve. Veuillez vous reconnecter.");return}if(!await ri.getInstance().getValidAccessToken()){jt.error("Configuration Zoho non trouve. Veuillez configurer Zoho CRM d'abord.");return}j([]);const Je=Fe.find(Jn=>Jn._id===Me);if(!Je){jt.error("Gig slectionn non trouv");return}const Dt=await ys("undefined/zoho/leads/sync-all",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({userId:Q,companyId:ke,gigId:Me})},Me);if(!Dt.ok){const Jn=await Dt.json().catch(()=>null);throw new Error(Jn?.message||`Erreur lors de la synchronisation avec Zoho pour le gig ${Je.title}`)}const Rt=await Dt.json();if(!Rt.success)throw new Error(Rt.message||`Erreur lors de la synchronisation pour le gig ${Je.title}`);if(!Rt.data||!Array.isArray(Rt.data.leads)){ce([]),j([]),await gn(1,"");return}const ho=Rt.data.leads;if(console.log(" Leads imports de Zoho:",ho.length,"leads"),ce(ho),j(ho),console.log(" Appel fetchLeads aprs import Zoho"),await gn(1,""),ho.length>0)try{const Jn=De.get("companyId");Jn&&await Ae.put(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${Jn}/onboarding/phases/2/steps/6`,{status:"completed"})}catch(Jn){console.error("Error updating onboarding progress after Zoho import:",Jn)}}catch(Q){console.error("Error in handleImportFromZoho:",Q),jt.error(Q.message||"Une erreur est survenue lors de l'importation")}finally{G(!1)}},gn=async(Q=1,ke="")=>{if(!(v||je.current)&&localStorage.getItem("uploadProcessing")!=="true"){if(!Me){if(C.length>0||localStorage.getItem("parsedLeads"))return;!je.current&&localStorage.getItem("uploadProcessing")!=="true"&&(Ne([]),rt(0),Pe(1),fe(0));return}F(!0),re(null);try{let Re;ke.trim()?(Re=`undefined/leads/gig/${Me}/search?search=${encodeURIComponent(ke.trim())}`,console.log(" Recherche leads avec URL:",Re)):(Re=`undefined/leads/gig/${Me}?page=${Q}&limit=50`,console.log(" Rcupration leads avec URL:",Re));const ct=await fetch(Re,{headers:{Authorization:`Bearer ${Me}:${De.get("userId")}`,"Content-Type":"application/json"}});if(!ct.ok)throw new Error(`Failed to fetch leads: ${ct.statusText}`);const Je=await ct.json();if(console.log(" Rponse API leads:",Je),!Je.success)throw new Error("Failed to fetch leads: API returned unsuccessful response");if(!Array.isArray(Je.data))throw new Error("Invalid response format: expected data to be an array");Ne(Je.data),H(Je.data),Je.data.length>0&&(ce([]),j([])),ke.trim()?(rt(1),Pe(1),fe(Je.data.length)):(rt(Je.totalPages),Pe(Je.currentPage),fe(Je.total))}catch(Re){console.error("Error fetching leads:",Re);const ct=Re instanceof Error?Re.message:"Failed to fetch leads";re(ct),jt.error(ct)}finally{F(!1)}}};k.useEffect(()=>{if(console.log(" useEffect principal - selectedGigId:",Me,"isProcessing:",v,"parsedLeads:",C.length),v||je.current){console.log(" Skipping - processing in progress");return}if(Me)console.log(" Chargement des leads pour gigId:",Me),gn(1,"").catch(Q=>{console.error("Error in useEffect:",Q),re("Failed to load leads")});else{if(console.log(" Pas de selectedGigId, clearing leads"),je.current||localStorage.getItem("uploadProcessing")==="true"||sessionStorage.getItem("uploadProcessing")==="true"||C.length>0)return;!je.current&&localStorage.getItem("uploadProcessing")!=="true"&&(Ne([]),rt(0),Pe(1))}},[Me,v]),k.useEffect(()=>{console.log(" useEffect rechargement - realtimeLeads:",te.length,"selectedGigId:",Me,"isProcessing:",v),te.length>0&&Me&&!v&&(console.log(" Rechargement des leads aprs import Zoho"),gn(1,"").catch(Q=>{console.error("Error reloading leads after Zoho import:",Q)}))},[te.length,Me,v]),k.useEffect(()=>{console.log(" useEffect montage - selectedGigId:",Me,"parsedLeads:",C.length,"realtimeLeads:",te.length),Me&&ve.length===0&&te.length===0&&!v&&(console.log(" Chargement initial des leads"),gn(1,"").catch(Q=>{console.error("Error in initial load useEffect:",Q),re("Failed to load leads")}))},[]),k.useEffect(()=>{if(je.current||C.length>0)return;const Q=localStorage.getItem("parsedLeads");if(!Q){if(Q&&C.length===0)try{const ke=JSON.parse(Q);j(ke);return}catch(ke){console.error("Error restoring parsed leads during render:",ke)}C.length>0}},[ve,C.length]);const y0e=()=>{const Q=[];if($e<=5){for(let Je=1;Je<=$e;Je++)Q.push(a.jsx("button",{onClick:()=>gn(Je),className:`relative inline-flex items-center px-4 py-2 text-sm font-semibold ${Je===Se?"z-10 bg-indigo-600 text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"}`,children:Je},Je));return Q}Q.push(a.jsx("button",{onClick:()=>gn(1,p),className:`relative inline-flex items-center px-4 py-2 text-sm font-semibold ${Se===1?"z-10 bg-indigo-600 text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"}`,children:"1"},1));let Re=Math.max(2,Se-1),ct=Math.min($e-1,Se+1);Se<=3?ct=Math.min(4,$e-1):Se>=$e-2&&(Re=Math.max(2,$e-3)),Re>2&&Q.push(a.jsx("span",{className:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700 ring-1 ring-inset ring-gray-300",children:"..."},"start-ellipsis"));for(let Je=Re;Je<=ct;Je++)Q.push(a.jsx("button",{onClick:()=>gn(Je,p),className:`relative inline-flex items-center px-4 py-2 text-sm font-semibold ${Je===Se?"z-10 bg-indigo-600 text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"}`,children:Je},Je));return ct<$e-1&&Q.push(a.jsx("span",{className:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700 ring-1 ring-inset ring-gray-300",children:"..."},"end-ellipsis")),$e>1&&Q.push(a.jsx("button",{onClick:()=>gn($e,p),className:`relative inline-flex items-center px-4 py-2 text-sm font-semibold ${$e===Se?"z-10 bg-indigo-600 text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"}`,children:$e},$e)),Q},w0e=async()=>{Et(!0);try{const Q=De.get("companyId");if(!Q)throw new Error("Company ID not found in cookies");const ke=await fetch(`undefined/gigs/company/${Q}`,{headers:{Authorization:`Bearer ${Me||De.get("gigId")}:${De.get("userId")}`,"Content-Type":"application/json"}});if(!ke.ok)throw new Error("Failed to fetch gigs");const Re=await ke.json();Re.data&&(et(Re.data),Re.data.length>0&&Xe(Re.data[0]._id))}catch(Q){console.error("Error fetching gigs:",Q),jt.error("Failed to load gigs")}finally{Et(!1)}};k.useEffect(()=>{w0e()},[]),k.useEffect(()=>{const Q=ke=>{ke.data.zohoConnected&&K(!0)};return window.addEventListener("message",Q),()=>window.removeEventListener("message",Q)},[]),k.useEffect(()=>{(async()=>{const Re=ri.getInstance().isConfigured();xe(Re),K(Re)})()},[]),k.useEffect(()=>{localStorage.setItem("hasSeenImportChoiceModal","true"),qe(!1)},[]);const sa=(Q,ke,Re)=>{const ct=[...C];ct[Q]={...ct[Q],[ke]:Re},j(ct)},v0e=async Q=>{f(Q),_e.current&&clearTimeout(_e.current),_e.current=setTimeout(async()=>{Q.trim()?await gn(1,Q):await gn(1)},500)},N0e=(Q,ke)=>ke==="all"?Q:Q.filter(Re=>ke==="active"?Re.Stage!=="Closed":ke==="inactive"?Re.Stage==="Closed":!0);k.useEffect(()=>{const Q=N0e(ve,m);H(Q)},[ve,m]);const AR=()=>{localStorage.setItem("hasSeenImportChoiceModal","true"),qe(!1),at(null)};return a.jsxs("div",{className:"space-y-4 bg-gradient-to-br from-blue-50 to-white min-h-screen p-4",children:[a.jsx("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-6",children:a.jsx("div",{className:"flex items-start justify-between mb-6",children:a.jsxs("div",{className:"flex-1",children:[a.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-3 flex items-center",children:[a.jsx(p1,{className:"mr-3 h-8 w-8 text-blue-600"}),"Upload Contacts"]}),a.jsx("p",{className:"text-lg text-gray-600",children:"Import, manage, and organize your leads efficiently. Choose between connecting with your CRM system or uploading contact files directly."})]})})}),a.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-slate-200 p-6 transition-all duration-300 ease-in-out",children:[a.jsxs("h4",{className:"text-xl font-bold text-slate-900 mb-6 flex items-center",children:[a.jsx(Qn,{className:"mr-3 h-6 w-6 text-slate-600"}),"Select a Gig"]}),it?a.jsxs("div",{className:"flex items-center justify-center py-12",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-slate-600"}),a.jsx("span",{className:"ml-4 text-base text-slate-600 font-medium",children:"Loading gigs..."})]}):Fe.length===0?a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"mx-auto h-16 w-16 text-slate-300 mb-4",children:a.jsx(Qn,{className:"h-16 w-16"})}),a.jsx("p",{className:"text-base text-slate-500 font-medium",children:"No gigs available."})]}):a.jsx("div",{className:"max-w-lg",children:a.jsxs("select",{value:Me,onChange:Q=>Xe(Q.target.value),className:"w-full rounded-xl border-2 border-slate-300 py-4 px-5 text-base font-medium focus:border-slate-600 focus:outline-none focus:ring-2 focus:ring-slate-200 focus:ring-offset-2 bg-white shadow-sm hover:border-slate-400 transition-all duration-200",children:[a.jsx("option",{value:"",className:"text-slate-500",children:"Select a gig..."}),Fe.map(Q=>a.jsx("option",{value:Q._id,className:"text-slate-900",children:Q.title},Q._id))]})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-4",children:[a.jsxs("div",{className:"mb-4",children:[a.jsxs("h3",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[a.jsx(Qv,{className:"mr-2 h-5 w-5 text-blue-600"}),"Import Leads"]}),a.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Choose your preferred method to import leads into your selected gig."})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-4",children:[a.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-2xl p-6 hover:border-blue-300 hover:shadow-lg transition-all duration-300 transform hover:scale-[1.02] flex flex-col h-full",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx("div",{className:"w-12 h-12 bg-white rounded-xl flex items-center justify-center mr-4 border-2 border-blue-200 shadow-sm",children:a.jsx("img",{src:i0,alt:"Zoho CRM",className:"h-7 w-7 object-contain"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"text-xl font-bold text-blue-900",children:"Zoho CRM Integration"}),a.jsx("p",{className:"text-sm text-blue-700",children:"Connect and sync with your Zoho CRM"})]})]}),a.jsx("div",{className:"mb-4",children:yt?a.jsxs("div",{className:"flex items-center justify-between bg-green-50 border border-green-200 rounded-lg p-3",children:[a.jsx("span",{className:"text-sm font-medium text-green-800",children:" Connected to Zoho CRM"}),a.jsx("button",{onClick:Ge,disabled:de,className:"px-3 py-1 text-xs font-medium text-red-700 bg-red-100 hover:bg-red-200 rounded-lg transition-colors duration-200 disabled:opacity-50",children:de?"Disconnecting...":"Disconnect"})]}):a.jsxs("div",{className:"flex items-center justify-between bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[a.jsx("span",{className:"text-sm font-medium text-yellow-800",children:" Not connected"}),a.jsx("button",{onClick:ze,className:"px-3 py-1 text-xs font-medium text-blue-700 bg-blue-100 hover:bg-blue-200 rounded-lg transition-colors duration-200",children:"Connect"})]})}),a.jsx("div",{className:"mt-auto",children:a.jsx("button",{onClick:async()=>{if(!Me){jt.error("Please select a gig first");return}await us()},disabled:!yt||B,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold py-4 px-6 rounded-xl hover:from-blue-700 hover:to-indigo-700 disabled:opacity-50 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl flex items-center justify-center",children:B?a.jsxs(a.Fragment,{children:[a.jsx($r,{className:"mr-3 h-5 w-5 animate-spin"}),"Importing from Zoho..."]}):yt?a.jsxs(a.Fragment,{children:[a.jsx("img",{src:i0,alt:"Zoho",className:"h-5 w-5 mr-3 object-contain"}),"Sync with Zoho CRM"]}):a.jsxs(a.Fragment,{children:[a.jsx("img",{src:i0,alt:"Zoho",className:"h-5 w-5 mr-3 object-contain"}),"Connect to Zoho CRM First"]})})})]}),a.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-2xl p-6 hover:border-blue-300 hover:shadow-lg transition-all duration-300 transform hover:scale-[1.02] flex flex-col h-full","data-file-upload":!0,children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx("div",{className:"w-12 h-12 bg-white rounded-xl flex items-center justify-center mr-4 border-2 border-blue-200 shadow-sm",children:a.jsx(t1,{className:"h-6 w-6 text-blue-700"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"text-xl font-bold text-blue-900",children:"File Upload"}),a.jsx("p",{className:"text-sm text-blue-700",children:"Upload and process contact files"})]})]}),a.jsx("div",{className:"mb-4",children:a.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:a.jsx("span",{className:"text-sm font-medium text-blue-800",children:" Supported: CSV, Excel, JSON, TXT"})})}),a.jsx("div",{className:"mt-auto",children:a.jsx("div",{className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold py-4 px-6 rounded-xl hover:from-blue-700 hover:to-indigo-700 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl cursor-pointer flex items-center justify-center",children:a.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer flex items-center justify-center w-full",children:[a.jsx(t1,{className:"h-5 w-5 mr-3 text-white"}),a.jsx("span",{className:"text-base font-semibold text-white",children:v?a.jsxs("div",{className:"flex items-center",children:[a.jsx($r,{className:"mr-2 h-5 w-5 animate-spin"}),"Processing..."]}):"Click to upload or drag and drop"}),a.jsx("input",{id:"file-upload",type:"file",className:"hidden",accept:"*",onChange:ie,disabled:v})]})})})]})]}),o&&E&&a.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(is,{className:"mr-2 h-4 w-4 text-blue-600"}),a.jsx("span",{className:"font-medium text-gray-900",children:o.name})]}),a.jsx("button",{onClick:()=>{l(null),d(0),x(null),w(!1),j([]),Xt(null)},children:a.jsx(Pi,{className:"h-4 w-4 text-gray-400 hover:text-gray-600"})})]}),a.jsxs("div",{className:"mt-3",children:[a.jsx("div",{className:"relative",children:a.jsx("div",{className:"h-3 rounded-full bg-gray-200 overflow-hidden",children:a.jsx("div",{className:`h-3 rounded-full transition-all duration-300 ${g?"bg-red-500":y?"bg-green-500":"bg-gradient-to-r from-blue-500 to-indigo-500"}`,style:{width:`${c}%`,background:v&&!g&&!y?"linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%)":void 0}})})}),a.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs text-gray-500",children:[a.jsx("span",{children:v&&!g&&!y?`Analyse en cours... ${c}%`:c>0?`${c}% termin`:"Prt"}),a.jsxs("span",{children:[Math.round(o.size/1024)," KB"]})]}),v&&!g&&!y&&a.jsxs("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded-lg",children:[a.jsx("div",{className:"flex items-center justify-between text-xs",children:a.jsx("span",{className:"text-blue-700 font-medium",children:Ke.status||"Traitement OpenAI en cours..."})}),a.jsxs("div",{className:"mt-2 flex items-center space-x-1",children:[a.jsx("div",{className:"flex space-x-1",children:[0,1,2].map(Q=>a.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse",style:{animationDelay:`${Q*.2}s`,animationDuration:"1s"}},Q))}),a.jsx("span",{className:"text-xs text-blue-600 ml-2",children:"Traitement en cours..."})]})]})]}),g&&a.jsx("div",{className:"mt-3 p-3 bg-red-50 border border-red-200 rounded-lg text-sm text-red-600",children:g}),y&&a.jsx("div",{className:"mt-3 p-3 bg-green-50 border border-green-200 rounded-lg text-sm text-green-600",children:"File uploaded successfully!"}),C.length>0&&!y&&!g&&I&&a.jsxs("div",{className:"mt-4 space-y-4",children:[mt&&a.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-3",children:[a.jsxs("h4",{className:"text-sm font-semibold text-blue-800 mb-2 flex items-center",children:[a.jsx(d4,{className:"mr-2 h-4 w-4"}),"AI Processing Results"]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-blue-600 font-medium",children:"Total Rows:"})," ",mt.totalRows]}),a.jsxs("div",{children:[a.jsx("span",{className:"text-green-600 font-medium",children:"Valid Rows:"})," ",mt.validRows>0?mt.validRows:C.length]}),mt.invalidRows>0&&a.jsxs("div",{className:"col-span-2",children:[a.jsx("span",{className:"text-red-600 font-medium",children:"Invalid Rows:"})," ",mt.invalidRows]})]}),mt.errors&&mt.errors.length>0&&a.jsx("div",{className:"mt-3",children:a.jsxs("details",{className:"text-xs",children:[a.jsxs("summary",{className:"cursor-pointer text-blue-600 hover:text-blue-800",children:["View validation errors (",mt.errors.length,")"]}),a.jsx("div",{className:"mt-2 space-y-1",children:mt.errors.map((Q,ke)=>a.jsx("div",{className:"text-red-600 bg-red-50 p-2 rounded",children:Q},ke))})]})})]}),a.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(ht,{className:"mr-2 h-4 w-4"}),a.jsxs("h4",{className:"text-sm font-semibold text-gray-800",children:["Confirm & Edit Leads (",C.length,")"]}),z&&a.jsxs("span",{className:"ml-2 inline-flex items-center rounded-full px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800",children:[a.jsx(Oc,{className:"mr-1 h-3 w-3"}),"Large dataset - memory only"]})]}),a.jsx("button",{onClick:()=>ut(!Ct),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-all duration-200",title:Ct?"Hide leads preview":"Show leads preview",children:Ct?a.jsx(Lc,{className:"h-4 w-4"}):a.jsx(Cl,{className:"h-4 w-4"})})]}),Ct&&a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Review and edit your leads before saving. Click the edit icon to modify any field."}),a.jsx("div",{className:"max-h-60 overflow-y-auto",children:a.jsx("div",{className:"space-y-2",children:C.map((Q,ke)=>a.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-slate-50 rounded-lg p-3 border border-gray-200 hover:border-slate-300 transition-all duration-200",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center",children:a.jsx("span",{className:"text-xs font-bold text-slate-600",children:ke+1})}),a.jsx("span",{className:"text-sm font-semibold text-gray-900",children:Q.Deal_Name||"Unnamed Lead"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("button",{onClick:()=>S(mn===ke?null:ke),className:"text-slate-600 hover:text-slate-800 p-2 rounded-md hover:bg-slate-50 transition-colors duration-200",title:"Edit lead",children:a.jsx(po,{className:"h-4 w-4"})}),a.jsx("button",{onClick:()=>{const Re=[...C];Re.splice(ke,1),j(Re)},className:"text-red-500 hover:text-red-700 p-2 rounded-md hover:bg-red-50 transition-colors duration-200",title:"Delete lead",children:a.jsx(er,{className:"h-4 w-4"})})]})]}),mn===ke?a.jsxs("div",{className:"space-y-3 bg-white rounded-lg p-3 border border-slate-200 shadow-sm",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"First Name"}),a.jsx("input",{type:"text",value:Q.First_Name||"",onChange:Re=>sa(ke,"First_Name",Re.target.value),placeholder:"Enter first name",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-slate-700 focus:border-slate-700 transition-all duration-200 bg-white shadow-sm"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Last Name"}),a.jsx("input",{type:"text",value:Q.Last_Name||"",onChange:Re=>sa(ke,"Last_Name",Re.target.value),placeholder:"Enter last name",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-slate-700 focus:border-slate-700 transition-all duration-200 bg-white shadow-sm"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Email"}),a.jsx("input",{type:"email",value:Q.Email_1||"",onChange:Re=>sa(ke,"Email_1",Re.target.value),placeholder:"Enter email address",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-slate-700 focus:border-slate-700 transition-all duration-200 bg-white shadow-sm"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Phone"}),a.jsx("input",{type:"tel",value:Q.Phone||"",onChange:Re=>sa(ke,"Phone",Re.target.value),placeholder:"Enter phone number",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-slate-700 focus:border-slate-700 transition-all duration-200 bg-white shadow-sm"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Address"}),a.jsx("input",{type:"text",value:Q.Address||"",onChange:Re=>sa(ke,"Address",Re.target.value),placeholder:"Enter address",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-slate-700 focus:border-slate-700 transition-all duration-200 bg-white shadow-sm"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Postal Code"}),a.jsx("input",{type:"text",value:Q.Postal_Code||"",onChange:Re=>sa(ke,"Postal_Code",Re.target.value),placeholder:"Zip code",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-slate-700 focus:border-slate-700 transition-all duration-200 bg-white shadow-sm"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"City"}),a.jsx("input",{type:"text",value:Q.City||"",onChange:Re=>sa(ke,"City",Re.target.value),placeholder:"City",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-slate-700 focus:border-slate-700 transition-all duration-200 bg-white shadow-sm"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Date of Birth"}),a.jsx("input",{type:"text",value:Q.Date_of_Birth||"",onChange:Re=>sa(ke,"Date_of_Birth",Re.target.value),placeholder:"DD/MM/YYYY",className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-slate-700 focus:border-slate-700 transition-all duration-200 bg-white shadow-sm"})]}),a.jsxs("div",{className:"flex justify-end space-x-2 pt-2 border-t border-gray-100",children:[a.jsx("button",{onClick:()=>S(null),className:"px-3 py-1 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-all duration-200 border border-gray-300",children:"Cancel"}),a.jsx("button",{onClick:()=>{S(null)},className:"px-3 py-1 text-sm font-medium text-white bg-gradient-to-r from-slate-700 to-slate-900 rounded-lg hover:from-slate-800 hover:to-slate-950 transition-all duration-200 shadow-sm",children:"Save Changes"})]})]}):a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(jl,{className:"h-4 w-4 text-gray-400"}),a.jsxs("span",{className:"text-gray-600 truncate",children:[a.jsx("span",{className:"font-medium",children:"Email:"})," ",Q.Email_1||"No email"]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(oa,{className:"h-4 w-4 text-gray-400"}),a.jsxs("span",{className:"text-gray-600",children:[a.jsx("span",{className:"font-medium",children:"Phone:"})," ",Q.Phone||"No phone"]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Zr,{className:"h-4 w-4 text-gray-400"}),a.jsxs("span",{className:"text-gray-600 truncate",children:[a.jsx("span",{className:"font-medium",children:"Adresse:"})," ",Q.City||"N/A"]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Er,{className:"h-4 w-4 text-gray-400"}),a.jsxs("span",{className:"text-gray-600",children:[a.jsx("span",{className:"font-medium",children:"DOB:"})," ",Q.Date_of_Birth||"N/A"]})]})]})]},ke))})})]})]}),a.jsx("button",{className:"w-full rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 px-4 py-3 text-white font-bold hover:from-blue-700 hover:to-indigo-700 disabled:opacity-50 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",onClick:me,disabled:D,children:a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx(p1,{className:"mr-2 h-5 w-5"}),"Save ",C.length," Contacts"]})}),D&&a.jsxs("div",{className:"mt-4 space-y-3",children:[a.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx($r,{className:"mr-3 h-5 w-5 text-green-600 animate-spin"}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-sm font-semibold text-green-800",children:"Saving Contacts..."}),a.jsxs("p",{className:"text-xs text-green-600",children:[_," of ",C.length," contacts saved"]})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"text-sm font-bold text-green-700",children:[Math.round(_/C.length*100),"%"]}),a.jsx("div",{className:"w-16 h-2 bg-green-200 rounded-full overflow-hidden",children:a.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-emerald-500 transition-all duration-300",style:{width:`${_/C.length*100}%`}})})]})]})}),a.jsx("button",{className:"w-full rounded-xl bg-gradient-to-r from-green-600 to-emerald-600 px-4 py-3 text-white font-bold hover:from-green-700 hover:to-emerald-700 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl",disabled:!0,children:a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsx($r,{className:"mr-2 h-5 w-5 animate-spin"}),"Saving ",_,"/",C.length," Contacts..."]})})]})]})]})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-4",children:[a.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center",children:[a.jsx(Ks,{className:"mr-2 h-5 w-5 text-blue-600"}),"Channel Filter"]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:Vg.map(Q=>{const ke=Q.icon,Re=u.includes(Q.id);return a.jsxs("button",{className:`flex items-center space-x-2 rounded-full px-3 py-2 text-sm font-medium transition-all duration-200 transform hover:scale-105 ${Re?"bg-gradient-to-r from-blue-600 to-indigo-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200 hover:shadow-md"}`,onClick:()=>be(Q.id),children:[a.jsx(ke,{className:"h-4 w-4"}),a.jsx("span",{children:Q.name})]},Q.id)})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100",children:[a.jsx("div",{className:"border-b border-gray-200 p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-xl font-semibold text-gray-900 flex items-center",children:[a.jsx(is,{className:"mr-2 h-5 w-5 text-blue-600"}),"Leads List"]}),a.jsx("div",{className:"mt-2",children:Me?a.jsx("div",{className:"text-sm text-gray-600",children:C.length>0&&ve.length===0?a.jsxs("span",{className:"bg-green-50 text-green-700 px-3 py-1 rounded-full text-xs font-medium",children:[C.length," leads ready to save"]}):D&&R.length>0?a.jsxs("span",{className:"bg-emerald-50 text-emerald-700 px-3 py-1 rounded-full text-xs font-medium",children:["Showing ",R.length," recently saved leads (saving in progress...)"]}):ve.length>0?a.jsxs("span",{className:"bg-indigo-50 text-indigo-700 px-3 py-1 rounded-full text-xs font-medium",children:["Showing ",le.length," of ",ve.length," leads ",p&&`(filtered by "${p}")`]}):a.jsx("span",{className:"bg-gray-50 text-gray-600 px-3 py-1 rounded-full text-xs font-medium",children:"No leads found"})}):a.jsx("p",{className:"text-sm text-gray-500",children:"Please select a gig to view leads"})})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:a.jsx(Il,{className:"h-5 w-5 text-gray-400"})}),a.jsx("input",{type:"text",className:"block w-full rounded-lg border-gray-300 pl-10 focus:border-blue-600 focus:ring-blue-600 sm:text-sm shadow-sm",placeholder:"Search leads...",value:p,onChange:Q=>v0e(Q.target.value)})]}),a.jsxs("select",{className:"rounded-lg border-gray-300 py-2 pl-3 pr-10 text-base focus:border-blue-600 focus:outline-none focus:ring-blue-600 sm:text-sm shadow-sm",value:m,onChange:Q=>b(Q.target.value),children:[a.jsx("option",{value:"all",children:"All Status"}),a.jsx("option",{value:"active",children:"Active (Not Closed)"}),a.jsx("option",{value:"inactive",children:"Inactive (Closed)"})]}),a.jsx("button",{onClick:()=>{f(""),gn(1)},className:"flex items-center rounded-lg bg-gradient-to-r from-blue-600 to-indigo-600 px-3 py-2 text-sm font-medium text-white shadow-md hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 transform hover:scale-105",disabled:ue||!Me,children:ue?a.jsxs(a.Fragment,{children:[a.jsx($r,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading..."]}):a.jsxs(a.Fragment,{children:[a.jsx($r,{className:"mr-2 h-4 w-4"}),"Refresh"]})})]})]})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsx("div",{className:"max-h-96 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 hover:scrollbar-thumb-gray-400",children:a.jsx("div",{className:"relative",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50 sticky top-0 z-10 shadow-sm text-center",children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",className:"px-3 py-3 text-xs font-semibold uppercase tracking-wider text-gray-500 bg-gray-50",children:"Nom"}),a.jsx("th",{scope:"col",className:"px-3 py-3 text-xs font-semibold uppercase tracking-wider text-gray-500 bg-gray-50",children:"Prnom"}),a.jsx("th",{scope:"col",className:"px-3 py-3 text-xs font-semibold uppercase tracking-wider text-gray-500 bg-gray-50",children:"Email"}),a.jsx("th",{scope:"col",className:"px-3 py-3 text-xs font-semibold uppercase tracking-wider text-gray-500 bg-gray-50",children:"Adresse"}),a.jsx("th",{scope:"col",className:"px-3 py-3 text-xs font-semibold uppercase tracking-wider text-gray-500 bg-gray-50",children:"MOBILE"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:ee?a.jsx("tr",{children:a.jsx("td",{colSpan:3,className:"px-6 py-4 text-center text-sm text-red-500",children:ee})}):ue?a.jsx("tr",{children:a.jsx("td",{colSpan:3,className:"px-6 py-4 text-center text-sm text-gray-500",children:a.jsxs("div",{className:"flex items-center justify-center py-8",children:[a.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-3"}),"Loading leads..."]})})}):ve.length===0&&te.length===0&&!D?a.jsx("tr",{children:a.jsx("td",{colSpan:3,className:"px-6 py-4 text-center text-sm text-gray-500",children:a.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[a.jsx(is,{className:"h-12 w-12 text-gray-300 mb-2"}),a.jsx("p",{children:"No leads found"}),a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Try importing some leads or check your filters"})]})})}):le.length===0&&te.length===0&&!D?a.jsx("tr",{children:a.jsx("td",{colSpan:3,className:"px-6 py-4 text-center text-sm text-gray-500",children:a.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[a.jsx(Il,{className:"h-12 w-12 text-gray-300 mb-2"}),a.jsx("p",{children:"No leads match your search"}),a.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Try adjusting your search terms or filters"})]})})}):(D&&R.length>0?R:le.length>0?le:te.length>0?te:[]).map((Q,ke)=>a.jsxs("tr",{className:`hover:bg-gray-50 transition-colors duration-150 text-center ${ke%2===0?"bg-white":"bg-gray-50"} ${Q._isPlaceholder?"opacity-75 border-l-4 border-orange-400":""}`,children:[a.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900 border-r border-gray-100",children:Q.Last_Name||"-"}),a.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900 border-r border-gray-100",children:Q.First_Name||"-"}),a.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-900 border-r border-gray-100 italic text-blue-600",children:Q.Email_1||"-"}),a.jsx("td",{className:"whitespace-nowrap px-3 py-4 text-sm text-gray-600 border-r border-gray-100",children:Q.Address||"-"}),a.jsxs("td",{className:"whitespace-nowrap px-3 py-4 text-sm font-semibold text-gray-900",children:["+",Q.Phone||"-"]})]},Q._id))})]})})})}),(le.length>0||te.length>0)&&a.jsx("div",{className:"bg-white px-4 py-3 border-t border-gray-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"flex items-center text-sm text-gray-700",children:a.jsx("span",{children:p?a.jsxs(a.Fragment,{children:["Showing ",a.jsx("span",{className:"font-medium",children:le.length}),' results for "',p,'"']}):a.jsxs(a.Fragment,{children:["Showing ",a.jsx("span",{className:"font-medium",children:le.length>0?le.length:te.length})," of"," ",a.jsx("span",{className:"font-medium",children:q>0?q:te.length})," leads"]})})}),!p&&$e>1&&a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("button",{onClick:()=>gn(Se-1),disabled:Se===1,className:"relative inline-flex items-center px-3 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),a.jsx("div",{className:"flex items-center space-x-1",children:y0e()}),a.jsx("button",{onClick:()=>gn(Se+1),disabled:Se===$e,className:"relative inline-flex items-center px-3 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})})]}),te.length>0&&a.jsxs("div",{className:"bg-white rounded-xl shadow-lg border border-gray-100 p-4",children:[a.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-3 flex items-center",children:[a.jsx($r,{className:"mr-2 h-5 w-5 text-blue-600 animate-spin"}),"Leads en temps rel"]}),a.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-3 mb-3",children:a.jsxs("p",{className:"text-sm font-medium text-blue-700",children:["Nombre de leads reus: ",a.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-bold",children:te.length})]})}),a.jsx("div",{className:"max-h-48 overflow-y-auto border border-gray-200 rounded-lg",children:a.jsxs("div",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 sticky top-0",children:a.jsxs("div",{className:"grid grid-cols-3 px-6 py-3",children:[a.jsx("div",{className:"text-left text-xs font-semibold text-blue-700 uppercase tracking-wider",children:"Email"}),a.jsx("div",{className:"text-left text-xs font-semibold text-blue-700 uppercase tracking-wider",children:"Tlphone"}),a.jsx("div",{className:"text-left text-xs font-semibold text-blue-700 uppercase tracking-wider",children:"Lead"})]})}),a.jsx("div",{className:"bg-white divide-y divide-gray-100",children:te.map((Q,ke)=>a.jsxs("div",{className:"grid grid-cols-3 px-6 py-4 hover:bg-gray-50 transition-colors duration-150",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:Q.Email_1||"N/A"}),a.jsx("div",{className:"text-sm text-gray-700",children:Q.Phone||"N/A"}),a.jsx("div",{className:"text-sm text-gray-700",children:Q.Deal_Name||"N/A"})]},ke))})]})})]}),Ve&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:a.jsxs("div",{className:"relative w-full max-w-md transform rounded-lg bg-white p-6 text-left shadow-xl transition-all",children:[a.jsx("div",{className:"absolute right-4 top-4",children:a.jsx("button",{onClick:AR,className:"text-gray-400 hover:text-gray-600",children:a.jsx(Pi,{className:"h-6 w-6"})})}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-blue-100",children:a.jsx(Qv,{className:"h-6 w-6 text-blue-700"})}),a.jsx("h3",{className:"mb-2 text-lg font-semibold text-gray-900",children:"Choose your import method"}),a.jsxs("p",{className:"mb-6 text-sm text-gray-600",children:["You can import your leads using ",a.jsx("b",{children:"Zoho CRM"})," or by uploading an ",a.jsx("b",{children:"Excel/CSV file"}),".",a.jsx("br",{}),"Click Next to continue."]})]}),a.jsxs("div",{className:"mt-6 flex justify-between space-x-3",children:[a.jsx("button",{onClick:AR,className:"flex-1 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Cancel"}),a.jsx("button",{onClick:()=>{localStorage.setItem("hasSeenImportChoiceModal","true"),qe(!1)},className:"flex-1 rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-600",children:"Next"})]})]})})]})}),OB=()=>a.jsx("div",{className:"h-[calc(100vh-100px)] w-full",children:a.jsx(SP,{children:a.jsx(N1,{})})}),MB=()=>{const[t,e]=k.useState(1);k.useState(1),k.useState([]);const[s,n]=k.useState([]),[r,i]=k.useState(!1),[o,l]=k.useState(null),c=[{id:1,title:"Profile Setup",description:"Complete REP profile and documentation",status:"completed"},{id:2,title:"Training & Certification",description:"Complete required training modules",status:"current"},{id:3,title:"Channel Setup",description:"Configure communication channels",status:"pending"},{id:4,title:"Skills Assessment",description:"Validate skills and expertise",status:"pending"}],d=x=>{let y="N/A";if(x.modules&&Array.isArray(x.modules)){const v=x.modules.reduce((N,C)=>N+(C.duration||0),0);if(v>0){const N=Math.floor(v/60),C=v%60;y=N>0?`${N}h ${C}min`:`${C} min`}}let w="not_started";return x.status==="completed"||x.journeyStatus==="completed"?w="completed":(x.status==="in_progress"||x.journeyStatus==="in_progress"||x.status==="active")&&(w="in_progress"),{id:x._id||x.id,title:x.title||x.name||"Untitled Training",description:x.description||"",duration:y,type:x.type||"course",required:x.required!==!1,status:w,progress:x.progress||(w==="completed"?100:w==="in_progress"?50:0),modules:x.modules||[]}},h=(()=>{const x=[];return s.forEach(w=>{w.modules&&Array.isArray(w.modules)&&w.modules.forEach(v=>{v.sections&&Array.isArray(v.sections)&&v.sections.forEach(N=>{if(N.content&&N.content.file){const C=N.content.file,j=C.name||N.title||"Untitled Document",I=C.type||C.mimeType?.split("/")[1]?.toUpperCase()||"FILE",T=C.size?C.size>1024*1024?`${(C.size/(1024*1024)).toFixed(1)} MB`:`${(C.size/1024).toFixed(1)} KB`:"Unknown size";x.push({id:C.id||C.publicId||`${w.id}-${v._id}-${N._id}`,title:j,type:I,size:T,url:C.url})}})})}),x.filter((w,v,N)=>v===N.findIndex(C=>C.id===w.id||C.url===w.url))})(),p=x=>{const y={pdf:"PDF",doc:"DOC",docx:"DOCX",xls:"XLS",xlsx:"XLSX",ppt:"PPT",pptx:"PPTX",mp4:"VIDEO",mov:"VIDEO",avi:"VIDEO",zip:"ZIP",rar:"RAR",jpg:"IMAGE",jpeg:"IMAGE",png:"IMAGE",gif:"IMAGE"},w=x.toLowerCase();return y[w]||x.toUpperCase()},f=[{id:1,title:"Communication Skills",type:"practical",status:"pending",score:null},{id:2,title:"Technical Knowledge",type:"written",status:"completed",score:92},{id:3,title:"Platform Proficiency",type:"practical",status:"in_progress",score:null}],m=()=>typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?"http://localhost:5010":"https://v25platformtrainingbackend-production.up.railway.app",b=k.useCallback(async()=>{if(!o){console.log("[RepOnboarding] No companyId available, skipping training fetch");return}i(!0);try{const x=m(),y=`${x}/training_journeys/trainer/companyId/${o}`;console.log("[RepOnboarding] Fetching trainings from:",y),console.log("[RepOnboarding] Company ID:",o),console.log("[RepOnboarding] Training Backend URL:",x);const w=await Ae.get(y);if(console.log("[RepOnboarding] Training API Response:",w.data),w.data&&w.data.success&&w.data.data){const v=Array.isArray(w.data.data)?w.data.data:[];console.log("[RepOnboarding] Found",v.length,"trainings"),n(v)}else Array.isArray(w.data)?(console.log("[RepOnboarding] Response is array, found",w.data.length,"trainings"),n(w.data)):(console.log("[RepOnboarding] No trainings found in response"),n([]))}catch(x){console.error("[RepOnboarding] Error fetching company trainings:",x),x.response&&(console.error("[RepOnboarding] Error response status:",x.response.status),console.error("[RepOnboarding] Error response data:",x.response.data),console.error("[RepOnboarding] Requested URL:",x.config?.url)),n([])}finally{i(!1)}},[o]),g=x=>{window.location.href=x};return k.useEffect(()=>{const x=De.get("companyId");if(x)l(x);else{const y=De.get("userId");y&&Ae.get(`https://v25searchcompanywizardbackend-production.up.railway.app/api/companies/user/${y}`).then(w=>{if(w.data.success&&w.data.data){const v=w.data.data._id;l(v),De.set("companyId",v)}}).catch(w=>{console.error("Error fetching company ID:",w)})}},[]),k.useEffect(()=>{o&&b()},[o,b]),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"REP Onboarding"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Guide new REPS through the onboarding process"})]}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsxs("button",{className:"flex items-center rounded-lg bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:[a.jsx(Qn,{className:"mr-2 h-4 w-4"}),"Settings"]}),a.jsxs("button",{className:"flex items-center rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",children:[a.jsx(Xs,{className:"mr-2 h-4 w-4"}),"New REP"]})]})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Onboarding Progress"}),a.jsxs("span",{className:"text-sm text-gray-500",children:["Step ",t," of 4"]})]}),a.jsx("div",{className:"mt-4",children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"absolute left-0 top-2 h-0.5 w-full bg-gray-200",children:a.jsx("div",{className:"absolute h-0.5 bg-indigo-600 transition-all duration-500",style:{width:`${(t-1)/3*100}%`}})}),a.jsx("div",{className:"relative flex justify-between",children:c.map((x,y)=>a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx("div",{className:`flex h-8 w-8 items-center justify-center rounded-full border-2 ${x.status==="completed"?"border-indigo-600 bg-indigo-600":x.status==="current"?"border-indigo-600 bg-white":"border-gray-300 bg-white"}`,children:x.status==="completed"?a.jsx(ht,{className:"h-5 w-5 text-white"}):a.jsx("span",{className:`text-sm font-medium ${x.status==="current"?"text-indigo-600":"text-gray-500"}`,children:y+1})}),a.jsxs("div",{className:"mt-2 text-center",children:[a.jsx("p",{className:`text-sm font-medium ${x.status==="completed"?"text-indigo-600":x.status==="current"?"text-gray-900":"text-gray-500"}`,children:x.title}),a.jsx("p",{className:"mt-1 text-xs text-gray-500",children:x.description})]})]},y))})]})})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Training & Certification"}),a.jsx("div",{className:"mt-4 space-y-4",children:r?a.jsx("div",{className:"text-center py-8",children:a.jsx("p",{className:"text-sm text-gray-500",children:"Loading trainings..."})}):s.length>0?s.map(x=>{const y=d(x);return a.jsx("div",{className:"rounded-lg border border-gray-200 bg-white",children:a.jsxs("div",{className:"flex items-center justify-between p-4",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:`rounded-lg p-2 ${y.status==="completed"?"bg-green-100 text-green-600":y.status==="in_progress"?"bg-yellow-100 text-yellow-600":"bg-gray-100 text-gray-600"}`,children:y.type==="video"?a.jsx(f1,{className:"h-5 w-5"}):y.type==="interactive"?a.jsx(_i,{className:"h-5 w-5"}):a.jsx(Ti,{className:"h-5 w-5"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:y.title}),a.jsxs("div",{className:"mt-1 flex items-center space-x-2 text-sm text-gray-500",children:[a.jsx(St,{className:"h-4 w-4"}),a.jsx("span",{children:y.duration}),y.required&&a.jsx("span",{className:"rounded-full bg-red-100 px-2 py-0.5 text-xs font-medium text-red-800",children:"Required"})]}),y.description&&a.jsx("p",{className:"mt-1 text-xs text-gray-400 line-clamp-1",children:y.description})]})]}),a.jsx("div",{className:"flex items-center space-x-4",children:y.status==="completed"?a.jsxs("span",{className:"inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-sm font-medium text-green-800",children:[a.jsx(ht,{className:"mr-1 h-4 w-4"}),"Completed"]}):y.status==="in_progress"?a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"h-2 w-24 rounded-full bg-gray-200",children:a.jsx("div",{className:"h-2 rounded-full bg-indigo-600",style:{width:`${y.progress}%`}})}),a.jsxs("span",{className:"text-sm text-gray-500",children:[y.progress,"%"]})]}):a.jsxs("button",{onClick:()=>g(`/training/${y.id}`),className:"flex items-center rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",children:[a.jsx(qg,{className:"mr-1 h-4 w-4"}),"Start"]})})]})},y.id)}):a.jsxs("div",{className:"text-center py-8",children:[a.jsx(Ti,{className:"mx-auto h-12 w-12 text-gray-400"}),a.jsx("p",{className:"mt-4 text-sm text-gray-500",children:"No trainings available yet."})]})})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Company Trainings"}),a.jsxs("button",{onClick:()=>g("/training"),className:"rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700 flex items-center space-x-2",children:[a.jsx(Ti,{className:"h-4 w-4"}),a.jsx("span",{children:"Go to Training"})]})]}),r?a.jsx("div",{className:"text-center py-8",children:a.jsx("p",{className:"text-sm text-gray-500",children:"Loading trainings..."})}):s.length>0?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Your company has ",s.length," training",s.length>1?"s":""," available:"]}),a.jsx("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3",children:s.map(x=>a.jsx("div",{className:"rounded-lg border border-gray-200 p-4 hover:border-indigo-300 hover:shadow-md transition-all",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"rounded-full bg-indigo-100 p-2",children:a.jsx(Ti,{className:"h-5 w-5 text-indigo-600"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 truncate",children:x.title||x.name||"Untitled Training"}),x.description&&a.jsx("p",{className:"mt-1 text-xs text-gray-500 line-clamp-2",children:x.description}),x.duration&&a.jsxs("p",{className:"mt-2 text-xs text-gray-400",children:["Duration: ",x.duration]})]})]})},x._id||x.id))})]}):a.jsxs("div",{className:"text-center py-8",children:[a.jsx(Ti,{className:"mx-auto h-12 w-12 text-gray-400"}),a.jsx("p",{className:"mt-4 text-sm text-gray-500",children:"No trainings available for your company yet."}),a.jsx("button",{onClick:()=>g("/training"),className:"mt-4 rounded-lg bg-indigo-600 px-4 py-2 text-sm text-white hover:bg-indigo-700",children:"Create Training"})]})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Skills Assessment"}),a.jsx("div",{className:"mt-4 space-y-4",children:f.map(x=>a.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:`rounded-lg p-2 ${x.status==="completed"?"bg-green-100 text-green-600":x.status==="in_progress"?"bg-yellow-100 text-yellow-600":"bg-gray-100 text-gray-600"}`,children:a.jsx(jr,{className:"h-5 w-5"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:x.title}),a.jsx("p",{className:"text-sm text-gray-500",children:x.type==="practical"?"Practical Assessment":"Written Test"})]})]}),a.jsx("div",{children:x.status==="completed"?a.jsxs("div",{className:"text-right",children:[a.jsxs("span",{className:"text-2xl font-bold text-green-600",children:[x.score,"%"]}),a.jsx("p",{className:"text-sm text-gray-500",children:"Score"})]}):x.status==="in_progress"?a.jsxs("span",{className:"inline-flex items-center rounded-full bg-yellow-100 px-2.5 py-0.5 text-sm font-medium text-yellow-800",children:[a.jsx(St,{className:"mr-1 h-4 w-4"}),"In Progress"]}):a.jsx("button",{className:"rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",children:"Start Assessment"})})]})},x.id))})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Channel Configuration"}),a.jsx("div",{className:"mt-4 space-y-4",children:[{id:"voice",name:"Voice Channel",icon:oa,status:"configured"},{id:"email",name:"Email Integration",icon:jl,status:"pending"},{id:"chat",name:"Live Chat",icon:_i,status:"configured"},{id:"social",name:"Social Media",icon:Ks,status:"not_started"}].map(x=>{const y=x.icon;return a.jsx("div",{className:"rounded-lg border border-gray-200 bg-white p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:`rounded-lg p-2 ${x.status==="configured"?"bg-green-100 text-green-600":x.status==="pending"?"bg-yellow-100 text-yellow-600":"bg-gray-100 text-gray-600"}`,children:a.jsx(y,{className:"h-5 w-5"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:x.name}),a.jsx("p",{className:"text-sm text-gray-500",children:x.status==="configured"?"Ready to use":x.status==="pending"?"Configuration pending":"Not configured"})]})]}),a.jsx("button",{className:`rounded-md px-3 py-1.5 text-sm font-medium shadow-sm ${x.status==="configured"?"bg-gray-100 text-gray-700 hover:bg-gray-200":"bg-indigo-600 text-white hover:bg-indigo-700"}`,children:x.status==="configured"?"Reconfigure":"Configure"})]})},x.id)})})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Documentation & Resources"}),h.length>0&&a.jsxs("button",{onClick:()=>{h.forEach(x=>{x.url&&window.open(x.url,"_blank")})},className:"flex items-center text-sm font-medium text-indigo-600 hover:text-indigo-500",children:[a.jsx(Sl,{className:"mr-1 h-4 w-4"}),"Download All"]})]}),a.jsx("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2",children:h.length>0?h.map(x=>a.jsxs("div",{className:"flex items-center justify-between rounded-lg border border-gray-200 p-4 hover:border-indigo-300 hover:shadow-md transition-all",children:[a.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[a.jsx(is,{className:"h-5 w-5 text-gray-400 flex-shrink-0"}),a.jsxs("div",{className:"ml-3 min-w-0 flex-1",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:x.title}),a.jsxs("p",{className:"text-xs text-gray-500",children:[p(x.type),"  ",x.size]})]})]}),x.url&&a.jsx("button",{onClick:()=>window.open(x.url,"_blank"),className:"rounded-full p-1 text-gray-400 hover:bg-gray-100 hover:text-indigo-600 flex-shrink-0 ml-2",title:"Download",children:a.jsx(Sl,{className:"h-4 w-4"})})]},x.id)):a.jsxs("div",{className:"col-span-2 text-center py-8",children:[a.jsx(is,{className:"mx-auto h-12 w-12 text-gray-400"}),a.jsx("p",{className:"mt-4 text-sm text-gray-500",children:"No documents available in training modules yet."})]})})]})]})};function Ns(t){const e=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&e==="[object Date]"?new t.constructor(+t):typeof t=="number"||e==="[object Number]"||typeof t=="string"||e==="[object String]"?new Date(t):new Date(NaN)}function ii(t,e){return t instanceof Date?new t.constructor(e):new Date(e)}function Ca(t,e){const s=Ns(t);return isNaN(e)?ii(t,NaN):(e&&s.setDate(s.getDate()+e),s)}function jk(t,e){const s=Ns(t);if(isNaN(e))return ii(t,NaN);if(!e)return s;const n=s.getDate(),r=ii(t,s.getTime());r.setMonth(s.getMonth()+e+1,0);const i=r.getDate();return n>=i?r:(s.setFullYear(r.getFullYear(),r.getMonth(),n),s)}const Ik=6048e5,LB=864e5,Ek=6e4,$k=36e5;let zB={};function md(){return zB}function Rr(t,e){const s=md(),n=e?.weekStartsOn??e?.locale?.options?.weekStartsOn??s.weekStartsOn??s.locale?.options?.weekStartsOn??0,r=Ns(t),i=r.getDay(),o=(i<n?7:0)+i-n;return r.setDate(r.getDate()-o),r.setHours(0,0,0,0),r}function Wp(t){return Rr(t,{weekStartsOn:1})}function Tk(t){const e=Ns(t),s=e.getFullYear(),n=ii(t,0);n.setFullYear(s+1,0,4),n.setHours(0,0,0,0);const r=Wp(n),i=ii(t,0);i.setFullYear(s,0,4),i.setHours(0,0,0,0);const o=Wp(i);return e.getTime()>=r.getTime()?s+1:e.getTime()>=o.getTime()?s:s-1}function Gp(t){const e=Ns(t);return e.setHours(0,0,0,0),e}function Ak(t){const e=Ns(t),s=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return s.setUTCFullYear(e.getFullYear()),+t-+s}function BB(t,e){const s=Gp(t),n=Gp(e),r=+s-Ak(s),i=+n-Ak(n);return Math.round((r-i)/LB)}function UB(t){const e=Tk(t),s=ii(t,0);return s.setFullYear(e,0,4),s.setHours(0,0,0,0),Wp(s)}function Dk(t,e){const s=Gp(t),n=Gp(e);return+s==+n}function VB(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function WB(t){if(!VB(t)&&typeof t!="number")return!1;const e=Ns(t);return!isNaN(Number(e))}function o0(t){const e=Ns(t),s=e.getMonth();return e.setFullYear(e.getFullYear(),s+1,0),e.setHours(23,59,59,999),e}function gd(t){const e=Ns(t);return e.setDate(1),e.setHours(0,0,0,0),e}function GB(t){const e=Ns(t),s=ii(t,0);return s.setFullYear(e.getFullYear(),0,1),s.setHours(0,0,0,0),s}function HB(t,e){const s=md(),n=s.weekStartsOn??s.locale?.options?.weekStartsOn??0,r=Ns(t),i=r.getDay(),o=(i<n?-7:0)+6-(i-n);return r.setDate(r.getDate()+o),r.setHours(23,59,59,999),r}const qB={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},KB=(t,e,s)=>{let n;const r=qB[t];return typeof r=="string"?n=r:e===1?n=r.one:n=r.other.replace("{{count}}",e.toString()),s?.addSuffix?s.comparison&&s.comparison>0?"in "+n:n+" ago":n};function a0(t){return(e={})=>{const s=e.width?String(e.width):t.defaultWidth;return t.formats[s]||t.formats[t.defaultWidth]}}const XB={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},YB={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},ZB={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},JB={date:a0({formats:XB,defaultWidth:"full"}),time:a0({formats:YB,defaultWidth:"full"}),dateTime:a0({formats:ZB,defaultWidth:"full"})},QB={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},e6=(t,e,s,n)=>QB[t];function xd(t){return(e,s)=>{const n=s?.context?String(s.context):"standalone";let r;if(n==="formatting"&&t.formattingValues){const o=t.defaultFormattingWidth||t.defaultWidth,l=s?.width?String(s.width):o;r=t.formattingValues[l]||t.formattingValues[o]}else{const o=t.defaultWidth,l=s?.width?String(s.width):t.defaultWidth;r=t.values[l]||t.values[o]}const i=t.argumentCallback?t.argumentCallback(e):e;return r[i]}}const t6={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},s6={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},n6={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},r6={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},i6={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},o6={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},a6={ordinalNumber:(t,e)=>{const s=Number(t),n=s%100;if(n>20||n<10)switch(n%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},era:xd({values:t6,defaultWidth:"wide"}),quarter:xd({values:s6,defaultWidth:"wide",argumentCallback:t=>t-1}),month:xd({values:n6,defaultWidth:"wide"}),day:xd({values:r6,defaultWidth:"wide"}),dayPeriod:xd({values:i6,defaultWidth:"wide",formattingValues:o6,defaultFormattingWidth:"wide"})};function bd(t){return(e,s={})=>{const n=s.width,r=n&&t.matchPatterns[n]||t.matchPatterns[t.defaultMatchWidth],i=e.match(r);if(!i)return null;const o=i[0],l=n&&t.parsePatterns[n]||t.parsePatterns[t.defaultParseWidth],c=Array.isArray(l)?c6(l,h=>h.test(o)):l6(l,h=>h.test(o));let d;d=t.valueCallback?t.valueCallback(c):c,d=s.valueCallback?s.valueCallback(d):d;const u=e.slice(o.length);return{value:d,rest:u}}}function l6(t,e){for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&e(t[s]))return s}function c6(t,e){for(let s=0;s<t.length;s++)if(e(t[s]))return s}function d6(t){return(e,s={})=>{const n=e.match(t.matchPattern);if(!n)return null;const r=n[0],i=e.match(t.parsePattern);if(!i)return null;let o=t.valueCallback?t.valueCallback(i[0]):i[0];o=s.valueCallback?s.valueCallback(o):o;const l=e.slice(r.length);return{value:o,rest:l}}}const u6=/^(\d+)(th|st|nd|rd)?/i,h6=/\d+/i,p6={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},f6={any:[/^b/i,/^(a|c)/i]},m6={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},g6={any:[/1/i,/2/i,/3/i,/4/i]},x6={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},b6={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},y6={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},w6={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},v6={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},N6={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},k6={ordinalNumber:d6({matchPattern:u6,parsePattern:h6,valueCallback:t=>parseInt(t,10)}),era:bd({matchPatterns:p6,defaultMatchWidth:"wide",parsePatterns:f6,defaultParseWidth:"any"}),quarter:bd({matchPatterns:m6,defaultMatchWidth:"wide",parsePatterns:g6,defaultParseWidth:"any",valueCallback:t=>t+1}),month:bd({matchPatterns:x6,defaultMatchWidth:"wide",parsePatterns:b6,defaultParseWidth:"any"}),day:bd({matchPatterns:y6,defaultMatchWidth:"wide",parsePatterns:w6,defaultParseWidth:"any"}),dayPeriod:bd({matchPatterns:v6,defaultMatchWidth:"any",parsePatterns:N6,defaultParseWidth:"any"})},C6={code:"en-US",formatDistance:KB,formatLong:JB,formatRelative:e6,localize:a6,match:k6,options:{weekStartsOn:0,firstWeekContainsDate:1}};function S6(t){const e=Ns(t);return BB(e,GB(e))+1}function j6(t){const e=Ns(t),s=+Wp(e)-+UB(e);return Math.round(s/Ik)+1}function _k(t,e){const s=Ns(t),n=s.getFullYear(),r=md(),i=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??r.firstWeekContainsDate??r.locale?.options?.firstWeekContainsDate??1,o=ii(t,0);o.setFullYear(n+1,0,i),o.setHours(0,0,0,0);const l=Rr(o,e),c=ii(t,0);c.setFullYear(n,0,i),c.setHours(0,0,0,0);const d=Rr(c,e);return s.getTime()>=l.getTime()?n+1:s.getTime()>=d.getTime()?n:n-1}function I6(t,e){const s=md(),n=e?.firstWeekContainsDate??e?.locale?.options?.firstWeekContainsDate??s.firstWeekContainsDate??s.locale?.options?.firstWeekContainsDate??1,r=_k(t,e),i=ii(t,0);return i.setFullYear(r,0,n),i.setHours(0,0,0,0),Rr(i,e)}function E6(t,e){const s=Ns(t),n=+Rr(s,e)-+I6(s,e);return Math.round(n/Ik)+1}function Gt(t,e){const s=t<0?"-":"",n=Math.abs(t).toString().padStart(e,"0");return s+n}const ko={y(t,e){const s=t.getFullYear(),n=s>0?s:1-s;return Gt(e==="yy"?n%100:n,e.length)},M(t,e){const s=t.getMonth();return e==="M"?String(s+1):Gt(s+1,2)},d(t,e){return Gt(t.getDate(),e.length)},a(t,e){const s=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return s.toUpperCase();case"aaa":return s;case"aaaaa":return s[0];case"aaaa":default:return s==="am"?"a.m.":"p.m."}},h(t,e){return Gt(t.getHours()%12||12,e.length)},H(t,e){return Gt(t.getHours(),e.length)},m(t,e){return Gt(t.getMinutes(),e.length)},s(t,e){return Gt(t.getSeconds(),e.length)},S(t,e){const s=e.length,n=t.getMilliseconds(),r=Math.trunc(n*Math.pow(10,s-3));return Gt(r,e.length)}},Ul={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Rk={G:function(t,e,s){const n=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return s.era(n,{width:"abbreviated"});case"GGGGG":return s.era(n,{width:"narrow"});case"GGGG":default:return s.era(n,{width:"wide"})}},y:function(t,e,s){if(e==="yo"){const n=t.getFullYear(),r=n>0?n:1-n;return s.ordinalNumber(r,{unit:"year"})}return ko.y(t,e)},Y:function(t,e,s,n){const r=_k(t,n),i=r>0?r:1-r;if(e==="YY"){const o=i%100;return Gt(o,2)}return e==="Yo"?s.ordinalNumber(i,{unit:"year"}):Gt(i,e.length)},R:function(t,e){const s=Tk(t);return Gt(s,e.length)},u:function(t,e){const s=t.getFullYear();return Gt(s,e.length)},Q:function(t,e,s){const n=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(n);case"QQ":return Gt(n,2);case"Qo":return s.ordinalNumber(n,{unit:"quarter"});case"QQQ":return s.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return s.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(n,{width:"wide",context:"formatting"})}},q:function(t,e,s){const n=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(n);case"qq":return Gt(n,2);case"qo":return s.ordinalNumber(n,{unit:"quarter"});case"qqq":return s.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return s.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(n,{width:"wide",context:"standalone"})}},M:function(t,e,s){const n=t.getMonth();switch(e){case"M":case"MM":return ko.M(t,e);case"Mo":return s.ordinalNumber(n+1,{unit:"month"});case"MMM":return s.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return s.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(n,{width:"wide",context:"formatting"})}},L:function(t,e,s){const n=t.getMonth();switch(e){case"L":return String(n+1);case"LL":return Gt(n+1,2);case"Lo":return s.ordinalNumber(n+1,{unit:"month"});case"LLL":return s.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return s.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(n,{width:"wide",context:"standalone"})}},w:function(t,e,s,n){const r=E6(t,n);return e==="wo"?s.ordinalNumber(r,{unit:"week"}):Gt(r,e.length)},I:function(t,e,s){const n=j6(t);return e==="Io"?s.ordinalNumber(n,{unit:"week"}):Gt(n,e.length)},d:function(t,e,s){return e==="do"?s.ordinalNumber(t.getDate(),{unit:"date"}):ko.d(t,e)},D:function(t,e,s){const n=S6(t);return e==="Do"?s.ordinalNumber(n,{unit:"dayOfYear"}):Gt(n,e.length)},E:function(t,e,s){const n=t.getDay();switch(e){case"E":case"EE":case"EEE":return s.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return s.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(n,{width:"short",context:"formatting"});case"EEEE":default:return s.day(n,{width:"wide",context:"formatting"})}},e:function(t,e,s,n){const r=t.getDay(),i=(r-n.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return Gt(i,2);case"eo":return s.ordinalNumber(i,{unit:"day"});case"eee":return s.day(r,{width:"abbreviated",context:"formatting"});case"eeeee":return s.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(r,{width:"short",context:"formatting"});case"eeee":default:return s.day(r,{width:"wide",context:"formatting"})}},c:function(t,e,s,n){const r=t.getDay(),i=(r-n.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return Gt(i,e.length);case"co":return s.ordinalNumber(i,{unit:"day"});case"ccc":return s.day(r,{width:"abbreviated",context:"standalone"});case"ccccc":return s.day(r,{width:"narrow",context:"standalone"});case"cccccc":return s.day(r,{width:"short",context:"standalone"});case"cccc":default:return s.day(r,{width:"wide",context:"standalone"})}},i:function(t,e,s){const n=t.getDay(),r=n===0?7:n;switch(e){case"i":return String(r);case"ii":return Gt(r,e.length);case"io":return s.ordinalNumber(r,{unit:"day"});case"iii":return s.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return s.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return s.day(n,{width:"short",context:"formatting"});case"iiii":default:return s.day(n,{width:"wide",context:"formatting"})}},a:function(t,e,s){const r=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return s.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(t,e,s){const n=t.getHours();let r;switch(n===12?r=Ul.noon:n===0?r=Ul.midnight:r=n/12>=1?"pm":"am",e){case"b":case"bb":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbb":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return s.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(t,e,s){const n=t.getHours();let r;switch(n>=17?r=Ul.evening:n>=12?r=Ul.afternoon:n>=4?r=Ul.morning:r=Ul.night,e){case"B":case"BB":case"BBB":return s.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return s.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(t,e,s){if(e==="ho"){let n=t.getHours()%12;return n===0&&(n=12),s.ordinalNumber(n,{unit:"hour"})}return ko.h(t,e)},H:function(t,e,s){return e==="Ho"?s.ordinalNumber(t.getHours(),{unit:"hour"}):ko.H(t,e)},K:function(t,e,s){const n=t.getHours()%12;return e==="Ko"?s.ordinalNumber(n,{unit:"hour"}):Gt(n,e.length)},k:function(t,e,s){let n=t.getHours();return n===0&&(n=24),e==="ko"?s.ordinalNumber(n,{unit:"hour"}):Gt(n,e.length)},m:function(t,e,s){return e==="mo"?s.ordinalNumber(t.getMinutes(),{unit:"minute"}):ko.m(t,e)},s:function(t,e,s){return e==="so"?s.ordinalNumber(t.getSeconds(),{unit:"second"}):ko.s(t,e)},S:function(t,e){return ko.S(t,e)},X:function(t,e,s){const n=t.getTimezoneOffset();if(n===0)return"Z";switch(e){case"X":return Fk(n);case"XXXX":case"XX":return Sa(n);case"XXXXX":case"XXX":default:return Sa(n,":")}},x:function(t,e,s){const n=t.getTimezoneOffset();switch(e){case"x":return Fk(n);case"xxxx":case"xx":return Sa(n);case"xxxxx":case"xxx":default:return Sa(n,":")}},O:function(t,e,s){const n=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+Pk(n,":");case"OOOO":default:return"GMT"+Sa(n,":")}},z:function(t,e,s){const n=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+Pk(n,":");case"zzzz":default:return"GMT"+Sa(n,":")}},t:function(t,e,s){const n=Math.trunc(t.getTime()/1e3);return Gt(n,e.length)},T:function(t,e,s){const n=t.getTime();return Gt(n,e.length)}};function Pk(t,e=""){const s=t>0?"-":"+",n=Math.abs(t),r=Math.trunc(n/60),i=n%60;return i===0?s+String(r):s+String(r)+e+Gt(i,2)}function Fk(t,e){return t%60===0?(t>0?"-":"+")+Gt(Math.abs(t)/60,2):Sa(t,e)}function Sa(t,e=""){const s=t>0?"-":"+",n=Math.abs(t),r=Gt(Math.trunc(n/60),2),i=Gt(n%60,2);return s+r+e+i}const Ok=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Mk=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},$6={p:Mk,P:(t,e)=>{const s=t.match(/(P+)(p+)?/)||[],n=s[1],r=s[2];if(!r)return Ok(t,e);let i;switch(n){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",Ok(n,e)).replace("{{time}}",Mk(r,e))}},T6=/^D+$/,A6=/^Y+$/,D6=["D","DD","YY","YYYY"];function _6(t){return T6.test(t)}function R6(t){return A6.test(t)}function P6(t,e,s){const n=F6(t,e,s);if(console.warn(n),D6.includes(t))throw new RangeError(n)}function F6(t,e,s){const n=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${n} to the input \`${s}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const O6=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,M6=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,L6=/^'([^]*?)'?$/,z6=/''/g,B6=/[a-zA-Z]/;function Bt(t,e,s){const n=md(),r=n.locale??C6,i=n.firstWeekContainsDate??n.locale?.options?.firstWeekContainsDate??1,o=n.weekStartsOn??n.locale?.options?.weekStartsOn??0,l=Ns(t);if(!WB(l))throw new RangeError("Invalid time value");let c=e.match(M6).map(u=>{const h=u[0];if(h==="p"||h==="P"){const p=$6[h];return p(u,r.formatLong)}return u}).join("").match(O6).map(u=>{if(u==="''")return{isToken:!1,value:"'"};const h=u[0];if(h==="'")return{isToken:!1,value:U6(u)};if(Rk[h])return{isToken:!0,value:u};if(h.match(B6))throw new RangeError("Format string contains an unescaped latin alphabet character `"+h+"`");return{isToken:!1,value:u}});r.localize.preprocessor&&(c=r.localize.preprocessor(l,c));const d={firstWeekContainsDate:i,weekStartsOn:o,locale:r};return c.map(u=>{if(!u.isToken)return u.value;const h=u.value;(R6(h)||_6(h))&&P6(h,e,String(t));const p=Rk[h[0]];return p(l,h,r.localize,d)}).join("")}function U6(t){const e=t.match(L6);return e?e[1].replace(z6,"'"):t}function Lk(t,e){const s=Ns(t),n=Ns(e);return s.getFullYear()===n.getFullYear()&&s.getMonth()===n.getMonth()}function l0(t,e){const s=+Ns(t),[n,r]=[+Ns(e.start),+Ns(e.end)].sort((i,o)=>i-o);return s>=n&&s<=r}function V6(t,e){const n=q6(t);let r;if(n.date){const c=K6(n.date,2);r=X6(c.restDateString,c.year)}if(!r||isNaN(r.getTime()))return new Date(NaN);const i=r.getTime();let o=0,l;if(n.time&&(o=Y6(n.time),isNaN(o)))return new Date(NaN);if(n.timezone){if(l=Z6(n.timezone),isNaN(l))return new Date(NaN)}else{const c=new Date(i+o),d=new Date(0);return d.setFullYear(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),d.setHours(c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds(),c.getUTCMilliseconds()),d}return new Date(i+o+l)}const Hp={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},W6=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,G6=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,H6=/^([+-])(\d{2})(?::?(\d{2}))?$/;function q6(t){const e={},s=t.split(Hp.dateTimeDelimiter);let n;if(s.length>2)return e;if(/:/.test(s[0])?n=s[0]:(e.date=s[0],n=s[1],Hp.timeZoneDelimiter.test(e.date)&&(e.date=t.split(Hp.timeZoneDelimiter)[0],n=t.substr(e.date.length,t.length))),n){const r=Hp.timezone.exec(n);r?(e.time=n.replace(r[1],""),e.timezone=r[1]):e.time=n}return e}function K6(t,e){const s=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),n=t.match(s);if(!n)return{year:NaN,restDateString:""};const r=n[1]?parseInt(n[1]):null,i=n[2]?parseInt(n[2]):null;return{year:i===null?r:i*100,restDateString:t.slice((n[1]||n[2]).length)}}function X6(t,e){if(e===null)return new Date(NaN);const s=t.match(W6);if(!s)return new Date(NaN);const n=!!s[4],r=yd(s[1]),i=yd(s[2])-1,o=yd(s[3]),l=yd(s[4]),c=yd(s[5])-1;if(n)return sU(e,l,c)?J6(e,l,c):new Date(NaN);{const d=new Date(0);return!eU(e,i,o)||!tU(e,r)?new Date(NaN):(d.setUTCFullYear(e,i,Math.max(r,o)),d)}}function yd(t){return t?parseInt(t):1}function Y6(t){const e=t.match(G6);if(!e)return NaN;const s=c0(e[1]),n=c0(e[2]),r=c0(e[3]);return nU(s,n,r)?s*$k+n*Ek+r*1e3:NaN}function c0(t){return t&&parseFloat(t.replace(",","."))||0}function Z6(t){if(t==="Z")return 0;const e=t.match(H6);if(!e)return 0;const s=e[1]==="+"?-1:1,n=parseInt(e[2]),r=e[3]&&parseInt(e[3])||0;return rU(n,r)?s*(n*$k+r*Ek):NaN}function J6(t,e,s){const n=new Date(0);n.setUTCFullYear(t,0,4);const r=n.getUTCDay()||7,i=(e-1)*7+s+1-r;return n.setUTCDate(n.getUTCDate()+i),n}const Q6=[31,null,31,30,31,30,31,31,30,31,30,31];function zk(t){return t%400===0||t%4===0&&t%100!==0}function eU(t,e,s){return e>=0&&e<=11&&s>=1&&s<=(Q6[e]||(zk(t)?29:28))}function tU(t,e){return e>=1&&e<=(zk(t)?366:365)}function sU(t,e,s){return e>=1&&e<=53&&s>=0&&s<=6}function nU(t,e,s){return t===24?e===0&&s===0:s>=0&&s<60&&e>=0&&e<60&&t>=0&&t<25}function rU(t,e){return e>=0&&e<=59}function iU(t,e){return jk(t,-e)}function Bk({selectedDate:t,onDateSelect:e,slots:s,view:n="month"}){const[r,i]=k.useState(n==="2-weeks"?t:gd(t));k.useEffect(()=>{if(n==="2-weeks"){const h=Rr(r),p=Ca(h,13);(t<h||t>p)&&i(t)}else Lk(r,t)||i(gd(t))},[t,n]);const o=()=>{i(n==="2-weeks"?Ca(r,14):jk(r,1))},l=()=>{i(n==="2-weeks"?Ca(r,-14):iU(r,1))},c=()=>a.jsxs("div",{className:"flex items-center justify-between mb-6 px-2",children:[a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:"p-2 bg-blue-50 rounded-lg text-blue-600",children:a.jsx(Er,{className:"w-6 h-6"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-black text-gray-900 tracking-tight",children:n==="2-weeks"?`${Bt(Rr(r),"MMMM d")} - ${Bt(Ca(Rr(r),13),"MMMM d, yyyy")}`:Bt(r,"MMMM yyyy")}),a.jsxs("div",{className:"flex items-center mt-1",children:[a.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 mr-2 animate-pulse"}),a.jsx("p",{className:"text-sm font-medium text-gray-500 uppercase tracking-wide",children:"Live Schedule Overview"})]})]})]}),a.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1 space-x-1",children:[a.jsx("button",{onClick:l,className:"p-2 hover:bg-white hover:shadow-sm rounded-md transition-all text-gray-600 hover:text-gray-900","aria-label":"Previous",children:a.jsx(ZR,{className:"w-5 h-5"})}),a.jsx("button",{onClick:o,className:"p-2 hover:bg-white hover:shadow-sm rounded-md transition-all text-gray-600 hover:text-gray-900","aria-label":"Next",children:a.jsx(Fh,{className:"w-5 h-5"})})]})]}),d=()=>{const h=[],p="EEEE",f=Rr(r);for(let m=0;m<7;m++)h.push(a.jsx("div",{className:"text-center font-bold text-gray-400 text-[10px] uppercase tracking-[0.2em] py-4",children:Bt(Ca(f,m),p)},m));return a.jsx("div",{className:"grid grid-cols-7 mb-4 bg-gray-50/50 rounded-t-xl",children:h})},u=()=>{let h,p;const f=gd(r);if(n==="2-weeks")h=Rr(r),p=Ca(h,13);else{const w=o0(f);h=Rr(f),p=HB(w)}const m="d",b=[];let g=[],x=h,y="";for(;x<=p;){for(let w=0;w<7;w++){y=Bt(x,m);const v=x,N=Dk(x,t),C=Lk(x,f),j=Dk(x,new Date),I=s.filter($=>$.date===Bt(v,"yyyy-MM-dd")),T=I.filter($=>$.status==="reserved").length,E=I.filter($=>$.status==="available").length;g.push(a.jsxs("button",{onClick:()=>e(v),className:`
                            min-h-[140px] p-4 border border-gray-100 flex flex-col justify-start transition-all duration-300 relative group
                            ${C?"bg-white text-gray-700":"bg-gray-50/30 text-gray-300"}
                            ${N?"ring-2 ring-blue-600 shadow-xl z-10 bg-blue-50/30":"hover:bg-gray-50/80 hover:scale-[1.02] hover:z-10 hover:shadow-lg"}
                        `,children:[a.jsxs("div",{className:"flex justify-between items-start w-full mb-3",children:[a.jsx("span",{className:`
                                text-sm font-black rounded-xl w-10 h-10 flex items-center justify-center transition-all duration-300
                                ${j?"bg-blue-600 text-white shadow-lg shadow-blue-200":N?"bg-blue-100 text-blue-700":"bg-transparent text-gray-900 group-hover:bg-white group-hover:shadow-sm"}
                            `,children:y}),j&&a.jsxs("span",{className:"flex h-2 w-2 relative",children:[a.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"}),a.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-blue-500"})]})]}),a.jsx("div",{className:"w-full space-y-2 mt-auto",children:I.length>0&&a.jsxs(a.Fragment,{children:[T>0&&a.jsxs("div",{className:"flex items-center justify-between text-[10px] px-2.5 py-1.5 bg-purple-50 text-purple-700 rounded-lg border border-purple-100 shadow-sm transition-all",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(St,{className:"w-3 h-3 mr-1.5 font-bold"}),a.jsx("span",{className:"font-extrabold",children:T}),a.jsx("span",{className:"ml-1 font-bold uppercase tracking-tight opacity-70",children:"Booked"})]}),a.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-purple-400"})]}),E>0&&a.jsx("div",{className:"flex items-center justify-between text-[10px] px-2.5 py-1.5 bg-green-50 text-green-700 rounded-lg border border-green-100 shadow-sm transition-all",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 mr-2 shadow-sm shadow-green-200"}),a.jsx("span",{className:"font-extrabold",children:E}),a.jsx("span",{className:"ml-1 font-bold uppercase tracking-tight opacity-70",children:"Open"})]})})]})})]},x.toString())),x=Ca(x,1)}b.push(a.jsx("div",{className:"grid grid-cols-7 border-l border-t border-gray-100 overflow-hidden",children:g},x.toString())),g=[]}return a.jsx("div",{className:"border border-gray-200 rounded-2xl overflow-hidden bg-white shadow-2xl transition-all duration-500 hover:shadow-blue-900/10",children:b})};return a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 p-8 transition-all hover:shadow-2xl",children:[c(),a.jsxs("div",{className:"relative",children:[d(),u()]}),a.jsxs("div",{className:"mt-6 flex items-center justify-end space-x-6 text-xs font-semibold text-gray-500 bg-gray-50 p-3 rounded-xl border border-gray-100",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-blue-500 mr-2 shadow-sm shadow-blue-200"}),a.jsx("span",{children:"Today"})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-purple-500 mr-2 shadow-sm shadow-purple-200"}),a.jsx("span",{children:"Booked Sessions"})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-green-500 mr-2 shadow-sm shadow-green-200"}),a.jsx("span",{children:"Open Slots"})]})]})]})}function oU({slots:t,onSlotClick:e,selectedSlotId:s,projects:n=[]}){const r=Array.from({length:13},(l,c)=>c+8),i=l=>{let c="bg-white border-gray-200 text-gray-500 hover:border-gray-300",d="Available",u="transparent";if(l.status==="reserved"){const h=n.find(p=>p.id===l.gigId);h?(u=h.color,c="bg-blue-50 text-blue-700 font-medium",d=h.name):(c="bg-blue-50 border-blue-200 text-blue-700 font-medium",d="Reserved")}else l.status==="cancelled"&&(c="bg-red-50 border-red-200 text-red-700 opacity-50 cursor-not-allowed",d="Cancelled");return s===l.id&&(c+=" ring-2 ring-blue-500 ring-offset-1"),{style:c,label:d,borderColor:u}},o=l=>{const c=`${l.toString().padStart(2,"0")}:00`;return t.find(d=>d.startTime===c)};return a.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx(St,{className:"w-5 h-5 text-gray-600 mr-2"}),a.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Daily Schedule"})]}),a.jsx("div",{className:"space-y-2",children:r.map(l=>{const c=o(l);if(!c)return null;const{style:d,label:u,borderColor:h}=i(c);return a.jsxs("button",{onClick:()=>e(c.id),disabled:c.status==="cancelled",className:`w-full flex items-center p-3 rounded-lg border transition-all ${d}`,style:{borderLeftColor:h,borderLeftWidth:h!=="transparent"?"4px":"1px"},children:[a.jsx("div",{className:"w-16 text-sm font-medium",children:c.startTime}),a.jsx("div",{className:"flex-1 text-left truncate",children:u}),c.duration>1&&a.jsxs("div",{className:"text-xs px-2 py-1 bg-gray-200 rounded-full text-gray-600",children:[c.duration,"h"]})]},c.id)})})]})}function aU({slot:t,availableProjects:e,onUpdate:s,onClear:n}){const[r,i]=k.useState(!1),[o,l]=k.useState(t.gigId||""),[c,d]=k.useState(t.notes||""),u=()=>{s({gigId:o||void 0,notes:c||void 0,status:o?"reserved":"available"}),i(!1)},h=()=>{l(t.gigId||""),d(t.notes||""),i(!1)};if(!r&&!t.gigId)return a.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border border-dashed border-gray-300 text-center",children:[a.jsx("p",{className:"text-gray-500 mb-2",children:"No project assigned to this slot"}),a.jsx("button",{onClick:()=>i(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Assign Gig"})]});if(r)return a.jsxs("div",{className:"mt-4 p-4 bg-white rounded-lg shadow-md border border-gray-200",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"Edit Slot Details"}),a.jsxs("div",{className:"mb-3",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Gig"}),a.jsxs("select",{value:o,onChange:f=>l(f.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"Select a project..."}),e.map(f=>a.jsxs("option",{value:f.id,children:[f.name," (",f.company,")"]},f.id))]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),a.jsx("textarea",{value:c,onChange:f=>d(f.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",rows:3,placeholder:"Add notes about this session..."})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("button",{onClick:u,className:"flex-1 px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium",children:"Save"}),a.jsx("button",{onClick:h,className:"flex-1 px-3 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 font-medium",children:"Cancel"})]})]});const p=e.find(f=>f.id===t.gigId);return a.jsxs("div",{className:"mt-4 p-4 bg-white rounded-lg shadow-md border border-l-4",style:{borderLeftColor:p?.color||"#ccc"},children:[a.jsxs("div",{className:"flex justify-between items-start mb-2",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-bold text-lg",children:p?.name}),a.jsx("p",{className:"text-sm text-gray-600",children:p?.company})]}),a.jsxs("div",{className:"flex space-x-1",children:[a.jsx("button",{onClick:()=>i(!0),className:"p-1 text-gray-500 hover:text-blue-600 rounded-full hover:bg-blue-50",title:"Edit details",children:a.jsx(Hg,{className:"w-4 h-4"})}),a.jsx("button",{onClick:n,className:"p-1 text-gray-500 hover:text-red-600 rounded-full hover:bg-red-50",title:"Clear slot",children:a.jsx(er,{className:"w-4 h-4"})})]})]}),t.notes&&a.jsx("div",{className:"mt-2 text-sm bg-gray-50 p-2 rounded",children:a.jsxs("p",{className:"text-gray-500 italic",children:['"',t.notes,'"']})}),a.jsx("div",{className:"mt-3 flex flex-wrap gap-1",children:p?.skills.map(f=>a.jsx("span",{className:"text-xs px-2 py-1 bg-gray-100 rounded-full text-gray-600",children:f},f))})]})}function lU({reps:t,selectedRepId:e,onSelectRep:s}){return a.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx(tr,{className:"w-5 h-5 text-blue-600 mr-2"}),a.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Select Team Member"})]}),a.jsx("div",{className:"space-y-2",children:t.map(n=>a.jsxs("button",{onClick:()=>s(n.id),className:`w-full flex items-center p-3 rounded-lg transition-colors ${e===n.id?"bg-blue-50 border-blue-500 border":"hover:bg-gray-50 border border-transparent"}`,children:[n.avatar?a.jsx("img",{src:n.avatar,alt:n.name,className:"w-10 h-10 rounded-full object-cover"}):a.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold",children:n.name.charAt(0)}),a.jsxs("div",{className:"ml-3 text-left",children:[a.jsx("div",{className:"font-medium text-gray-900",children:n.name}),a.jsx("div",{className:"text-sm text-gray-500 line-clamp-1",children:n.specialties.join(", ")})]}),e===n.id&&a.jsx("div",{className:"ml-auto",children:a.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full"})})]},n.id))})]})}function cU({company:t,slots:e,projects:s,reps:n,selectedDate:r}){const i=k.useMemo(()=>e.filter(c=>s.find(u=>u.id===c.gigId)?.company===t&&c.date===Bt(r,"yyyy-MM-dd")&&c.status==="reserved"),[e,s,t,r]),o=k.useMemo(()=>{const c={};return i.forEach(d=>{c[d.repId]||(c[d.repId]=0),c[d.repId]+=d.duration||1}),c},[i]),l=Object.values(o).reduce((c,d)=>c+d,0);return a.jsxs("div",{className:"bg-white rounded-lg p-8 shadow-sm border border-gray-100",children:[a.jsxs("div",{className:"flex items-center mb-8 border-b border-gray-100 pb-6",children:[a.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center mr-4 shadow-lg shadow-blue-200",children:a.jsx(Ai,{className:"w-7 h-7 text-white"})}),a.jsxs("h2",{className:"text-3xl font-extrabold text-gray-900 tracking-tight",children:[t," Dashboard"]})]}),a.jsxs("div",{className:"mb-10",children:[a.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-6",children:["Schedule for ",Bt(r,"MMMM d, yyyy")]}),a.jsxs("div",{className:"flex items-center justify-between bg-blue-50/50 border border-blue-100 px-6 py-4 rounded-xl mb-12",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"bg-white p-2.5 rounded-xl shadow-sm mr-4",children:a.jsx(St,{className:"w-6 h-6 text-blue-600"})}),a.jsx("span",{className:"text-blue-900 font-bold text-lg",children:"Total Hours Scheduled"})]}),a.jsxs("span",{className:"text-2xl font-black text-blue-900",children:[l,"h"]})]}),a.jsxs("div",{className:"space-y-16",children:[Object.entries(o).map(([c,d])=>{const u=n.find(p=>p.id===c),h=i.filter(p=>p.repId===c);return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between pb-4 border-b border-gray-100",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-14 h-14 rounded-full overflow-hidden mr-4 border-2 border-white shadow-md bg-gray-50 flex-shrink-0",children:u?.avatar?a.jsx("img",{src:u.avatar,alt:u.name,className:"w-full h-full object-cover"}):a.jsx("div",{className:"w-full h-full flex items-center justify-center bg-blue-100 text-blue-600 font-black text-xl",children:u?.name?.charAt(0)||"R"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-xl font-black text-gray-900 leading-tight",children:u?.name||`Agent ${c.substring(0,4)}`}),a.jsx("p",{className:"text-gray-500 text-sm font-semibold",children:u?.specialties?.join(", ")||"Expert"})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"text-2xl font-black text-gray-900 leading-none mb-1",children:[d,"h"]}),a.jsxs("div",{className:"text-gray-400 text-sm font-bold",children:[h.length," slots"]})]})]}),a.jsx("div",{className:"space-y-4",children:h.map(p=>{const f=s.find(m=>m.id===p.gigId);return a.jsxs("div",{className:"group relative py-4 px-6 rounded-xl bg-gray-50/50 hover:bg-gray-100 transition-all duration-200 border-l-[6px]",style:{borderLeftColor:f?.color||"#3b82f6"},children:[a.jsxs("h5",{className:"font-extrabold text-gray-800 text-base mb-1",children:[f?.name," - ",t]}),a.jsxs("div",{className:"flex items-center text-gray-500 text-sm font-bold",children:[a.jsx(St,{className:"w-4 h-4 mr-2 opacity-60"}),p.startTime," - ",p.endTime," (",p.duration||1,"h)"]}),p.notes&&a.jsxs("div",{className:"mt-3 text-sm text-gray-600 bg-white/60 p-3 rounded-lg border border-gray-100 italic",children:['"',p.notes,'"']})]},p.id)})})]},c)}),Object.keys(o).length===0&&a.jsxs("div",{className:"flex flex-col items-center justify-center py-20 bg-gray-50/50 rounded-3xl border-2 border-dashed border-gray-200",children:[a.jsx(St,{className:"w-12 h-12 text-gray-300 mb-4"}),a.jsx("p",{className:"text-gray-500 font-black text-xl",children:"No REPs scheduled for this date"}),a.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Assignments will appear here once reserved."})]})]})]})]})}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dU=1e-7,uU=1e-4;class Uk{constructor(e,s){this.backend=e,this.dataMover=s,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,s){this.dataIdsCount++,this.data.set(e,s)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class d0{refCount(e){return An("refCount")}incRef(e){return An("incRef")}timerAvailable(){return!0}time(e){return An("time")}read(e){return An("read")}readSync(e){return An("readSync")}readToGPU(e,s){return An("readToGPU")}numDataIds(){return An("numDataIds")}disposeData(e,s){return An("disposeData")}write(e,s,n){return An("write")}move(e,s,n,r,i){return An("move")}createTensorFromGPUData(e,s,n){return An("createTensorFromGPUData")}memory(){return An("memory")}floatPrecision(){return An("floatPrecision")}epsilon(){return this.floatPrecision()===32?dU:uU}dispose(){return An("dispose")}}function An(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hU(t){let e=t.length,s=0;for(;e>0;)s=Math.random()*e|0,e--,Vl(t,e,s)}function ja(t,e,s){return Math.max(t,Math.min(e,s))}function u0(t){return t%2===0?t:t+1}function Vl(t,e,s){const n=t[e];t[e]=t[s],t[s]=n}function pU(t){let e=0;for(let s=0;s<t.length;s++)e+=t[s];return e}function A(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function h0(t,e,s=""){A(Ft(t,e),()=>s+` Shapes ${t} and ${e} must match`)}function Vk(t){A(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function pe(t){if(t.length===0)return 1;let e=t[0];for(let s=1;s<t.length;s++)e*=t[s];return e}function Ft(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==e[s])return!1;return!0}function Wl(t){return t%1===0}function p0(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function Gl(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function Wk(t,e=r=>0,s,n){return new Promise((r,i)=>{let o=0;const l=()=>{if(t()){r();return}o++;const c=e(o);if(s!=null&&o>=s){i();return}n!=null?n(l,c):setTimeout(l,c)};l()})}function Gk(t,e){let s=1,n=-1;for(let i=0;i<t.length;++i)if(t[i]>=0)s*=t[i];else if(t[i]===-1){if(n!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${n} and dim ${i}`);n=i}else if(t[i]<0)throw Error(`Shapes can not be < 0. Found ${t[i]} at dim ${i}`);if(n===-1){if(e>0&&e!==s)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(s===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%s!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${s}`);const r=t.slice();return r[n]=e/s,r}function vt(t,e){const s=e.length;return t=t==null?e.map((n,r)=>r):[].concat(t),A(t.every(n=>n>=-s&&n<s),()=>`All values in axis param must be in range [-${s}, ${s}) but got axis ${t}`),A(t.every(n=>Wl(n)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(n=>n<0?s+n:n)}function Co(t,e){const s=[],n=[],r=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||r?null:vt(e,t).sort();let o=0;for(let l=0;l<t.length;++l){if(i!=null){if(i[o]===l&&t[l]!==1)throw new Error(`Can't squeeze axis ${l} since its dim '${t[l]}' is not 1`);(i[o]==null||i[o]>l)&&t[l]===1&&(s.push(t[l]),n.push(l)),i[o]<=l&&o++}t[l]!==1&&(s.push(t[l]),n.push(l))}return{newShape:s,keptDims:n}}function Zs(t,e){return ps(t,e)}function ps(t,e){let s=null;if(t==null||t==="float32")s=new Float32Array(e);else if(t==="int32")s=new Int32Array(e);else if(t==="bool")s=new Uint8Array(e);else if(t==="string")s=new Array(e);else throw new Error(`Unknown data type ${t}`);return s}function fU(t,e){for(let s=0;s<t.length;s++){const n=t[s];if(isNaN(n)||!isFinite(n))throw Error(`A tensor of type ${e} being uploaded contains ${n}.`)}}function mU(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function Hk(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function qp(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function gU(t){if(t==null)return 0;let e=0;return t.forEach(s=>e+=s.length),e}function wd(t){return typeof t=="string"||t instanceof String}function xU(t){return typeof t=="boolean"}function f0(t){return typeof t=="number"}function Hl(t){return Array.isArray(t)?Hl(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":f0(t)?"float32":wd(t)?"string":xU(t)?"bool":"float32"}function m0(t){return!!(t&&t.constructor&&t.call&&t.apply)}function g0(t,e){for(let s=e;s<t;++s)if(t%s===0)return s;return t}function tt(t){const e=t.length;if(e<2)return[];const s=new Array(e-1);s[e-2]=t[e-1];for(let n=e-3;n>=0;--n)s[n]=s[n+1]*t[n+1];return s}function qk(t,e,s,n=!1){const r=new Array;if(e.length===1){const i=e[0]*(n?2:1);for(let o=0;o<i;o++)r[o]=s[t+o]}else{const i=e[0],o=e.slice(1),l=o.reduce((c,d)=>c*d)*(n?2:1);for(let c=0;c<i;c++)r[c]=qk(t+c*l,o,s,n)}return r}function Pr(t,e,s=!1){if(t.length===0)return e[0];const n=t.reduce((r,i)=>r*i)*(s?2:1);if(n===0)return[];if(n!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${s?" for a complex tensor":""}.`);return qk(0,t,e,s)}function bU(t,e){if(Array.isArray(t))return t;if(e==="float32")return t instanceof Float32Array?t:new Float32Array(t);if(e==="int32")return t instanceof Int32Array?t:new Int32Array(t);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}function x0(t,e){const s=Js(t,e);for(let n=0;n<s.length;n++)s[n]=1;return s}function Js(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function Kk(t,e){const s=t.reduce((n,r)=>n*r,1);if(e==null||e==="float32")return Pr(t,new Float32Array(s));if(e==="int32")return Pr(t,new Int32Array(s));if(e==="bool")return Pr(t,new Uint8Array(s));throw new Error(`Unknown data type ${e}`)}function Xi(t){t.forEach(e=>{A(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function oi(t,e,s){if(e===0)return 0;if(e===1)return t[0];let n=t[t.length-1];for(let r=0;r<t.length-1;++r)n+=s[r]*t[r];return n}function ql(t,e,s){if(e===0)return[];if(e===1)return[t];const n=new Array(e);for(let r=0;r<n.length-1;++r)n[r]=Math.floor(t/s[r]),t-=n[r]*s[r];return n[n.length-1]=t,n}function b0(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xk="tfjsflags";class yU{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=wU,this.populateURLFlags()}setPlatform(e,s){this.platform!=null&&(oe().getBool("IS_TEST")||oe().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=s}registerFlag(e,s,n){if(this.flagRegistry[e]={evaluationFn:s,setHook:n},this.urlFlags[e]!=null){const r=this.urlFlags[e];oe().getBool("IS_TEST")||oe().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const s=this.evaluateFlag(e);if(b0(s))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=s,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,s){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=s,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(s)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);Xk in e&&e[Xk].split(",").forEach(n=>{const[r,i]=n.split(":");this.urlFlags[r]=NU(r,i)})}}function wU(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(s,...n)=>(vU(e,n[0],n[1]),n.join("="))),e}function vU(t,e,s){t[decodeURIComponent(e)]=decodeURIComponent(s||"")}function NU(t,e){const s=e.toLowerCase();return s==="true"||s==="false"?s==="true":`${+s}`===s?+s:e}function oe(){return Yk}let Yk=null;function kU(t){Yk=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let y0;function Zk(){if(y0==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");y0=t}return y0}function CU(){const t=Zk();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function w0(t,e){const s=CU();if(s.has(t))return s.get(t);{const n=e();return s.set(t,n),s.get(t)}}const Kp="Abs",vd="Acos",Nd="Acosh",Kl="Add",v0="AddN",N0="All",k0="Any",Xp="ArgMax",Yp="ArgMin",kd="Asin",Cd="Asinh",Sd="Atan",jd="Atanh",Id="Atan2",Zp="AvgPool",C0="AvgPoolGrad",Jp="AvgPool3D",S0="AvgPool3DGrad",Qp="BatchMatMul",ef="BatchToSpaceND",j0="Bincount",I0="BitwiseAnd",SU="BroadcastTo",Jk="BroadcastArgs",Ed="Cast",$d="Ceil",Td="ClipByValue",E0="Complex",tf="ComplexAbs",sf="Concat",nf="Conv2D",$0="Conv2DBackpropFilter",rf="Conv2DBackpropInput",of="Conv3D",T0="Conv3DBackpropFilterV2",A0="Conv3DBackpropInputV2",Ad="Cos",Dd="Cosh",D0="Cumprod",af="Cumsum",_0="CropAndResize",R0="DenseBincount",P0="DepthToSpace",lf="DepthwiseConv2dNative",F0="DepthwiseConv2dNativeBackpropFilter",O0="DepthwiseConv2dNativeBackpropInput",Qk="Diag",cf="Dilation2D",M0="Dilation2DBackpropInput",L0="Dilation2DBackpropFilter",jU="Draw",_d="RealDiv",z0="Einsum",Rd="Elu",B0="EluGrad",Pd="Erf",df="Equal",Fd="Exp",uf="ExpandDims",Od="Expm1",U0="FFT",V0="Fill",W0="FlipLeftRight",Md="Floor",Ld="FloorDiv",hf="FusedBatchNorm",pf="GatherV2",eC="GatherNd",ff="Greater",zd="GreaterEqual",Bd="Identity",G0="IFFT",H0="Imag",Ud="IsFinite",Vd="IsInf",Wd="IsNan",mf="LeakyRelu",gf="Less",xf="LessEqual",tC="LinSpace",Gd="Log",Hd="Log1p",bf="LogicalAnd",yf="LogicalNot",wf="LogicalOr",IU="LogSoftmax",vf="LRN",q0="LRNGrad",Nf="Max",qd="Maximum",kf="MaxPool",K0="MaxPoolGrad",Cf="MaxPool3D",X0="MaxPool3DGrad",sC="MaxPoolWithArgmax",Sf="Mean",jf="Min",Kd="Minimum",If="MirrorPad",Xd="Mod",nC="Multinomial",Yd="Multiply",Ef="Neg",$f="NotEqual",Y0="NonMaxSuppressionV3",Z0="NonMaxSuppressionV4",J0="NonMaxSuppressionV5",Tf="OnesLike",Af="OneHot",Df="Pack",_f="PadV2",Zd="Pow",Rf="Prelu",Pf="Prod",rC="RaggedGather",iC="RaggedRange",oC="RaggedTensorToTensor",Q0="Range",eb="Real",Jd="Reciprocal",Qd="Relu",Ff="Reshape",Of="ResizeNearestNeighbor",tb="ResizeNearestNeighborGrad",Mf="ResizeBilinear",sb="ResizeBilinearGrad",eu="Relu6",Lf="Reverse",tu="Round",su="Rsqrt",aC="ScatterNd",lC="TensorScatterUpdate",cC="SearchSorted",zf="Select",nu="Selu",Bf="Slice",ru="Sin",iu="Sinh",ou="Sign",au="Sigmoid",lu="Softplus",cu="Sqrt",Uf="Sum",Vf="SpaceToBatchND",Wf="SplitV",Gf="Softmax",dC="SparseFillEmptyRows",uC="SparseReshape",hC="SparseSegmentMean",pC="SparseSegmentSum",fC="SparseToDense",du="SquaredDifference",nb="Square",rb="StaticRegexReplace",ib="StridedSlice",mC="StringNGrams",gC="StringSplit",xC="StringToHashBucketFast",uu="Sub",hu="Tan",pu="Tanh",fu="Tile",ob="TopK",ab="Transform",Xl="Transpose",lb="Unique",Hf="Unpack",qf="UnsortedSegmentSum",Kf="ZerosLike",mu="Step",EU="FromPixels",cb="RotateWithOffset",Xf="_FusedMatMul",Yf="FusedConv2D",bC="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gn(...t){oe().getBool("IS_TEST")||oe().getBool("PROD")||console.warn(...t)}function $U(...t){oe().getBool("IS_TEST")||oe().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zf=w0("kernelRegistry",()=>new Map),db=w0("gradRegistry",()=>new Map);function yC(t,e){const s=kC(t,e);return Zf.get(s)}function wC(t){return db.get(t)}function vC(t){const e=Zf.entries(),s=[];for(;;){const{done:n,value:r}=e.next();if(n)break;const[i,o]=r,[l]=i.split("_");l===t&&s.push(o)}return s}function NC(t){const{kernelName:e,backendName:s}=t,n=kC(e,s);Zf.has(n)&&Gn(`The kernel '${e}' for backend '${s}' is already registered`),Zf.set(n,t)}function TU(t){const{kernelName:e}=t;db.has(e)&&oe().getBool("DEBUG")&&Gn(`Overriding the gradient for '${e}'`),db.set(e,t)}function kC(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CC(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var SC=ss,lr=null;try{lr=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ss(t,e,s){this.low=t|0,this.high=e|0,this.unsigned=!!s}ss.prototype.__isLong__,Object.defineProperty(ss.prototype,"__isLong__",{value:!0});function Dn(t){return(t&&t.__isLong__)===!0}ss.isLong=Dn;var jC={},IC={};function Ia(t,e){var s,n,r;return e?(t>>>=0,(r=0<=t&&t<256)&&(n=IC[t],n)?n:(s=ns(t,(t|0)<0?-1:0,!0),r&&(IC[t]=s),s)):(t|=0,(r=-128<=t&&t<128)&&(n=jC[t],n)?n:(s=ns(t,t<0?-1:0,!1),r&&(jC[t]=s),s))}ss.fromInt=Ia;function cr(t,e){if(isNaN(t))return e?Ea:dr;if(e){if(t<0)return Ea;if(t>=$C)return RC}else{if(t<=-TC)return _n;if(t+1>=TC)return _C}return t<0?cr(-t,e).neg():ns(t%Yl|0,t/Yl|0,e)}ss.fromNumber=cr;function ns(t,e,s){return new ss(t,e,s)}ss.fromBits=ns;var Jf=Math.pow;function ub(t,e,s){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return dr;if(typeof e=="number"?(s=e,e=!1):e=!!e,s=s||10,s<2||36<s)throw RangeError("radix");var n;if((n=t.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return ub(t.substring(1),e,s).neg();for(var r=cr(Jf(s,8)),i=dr,o=0;o<t.length;o+=8){var l=Math.min(8,t.length-o),c=parseInt(t.substring(o,o+l),s);if(l<8){var d=cr(Jf(s,l));i=i.mul(d).add(cr(c))}else i=i.mul(r),i=i.add(cr(c))}return i.unsigned=e,i}ss.fromString=ub;function Fr(t,e){return typeof t=="number"?cr(t,e):typeof t=="string"?ub(t,e):ns(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}ss.fromValue=Fr;var EC=65536,AU=1<<24,Yl=EC*EC,$C=Yl*Yl,TC=$C/2,AC=Ia(AU),dr=Ia(0);ss.ZERO=dr;var Ea=Ia(0,!0);ss.UZERO=Ea;var Zl=Ia(1);ss.ONE=Zl;var DC=Ia(1,!0);ss.UONE=DC;var hb=Ia(-1);ss.NEG_ONE=hb;var _C=ns(-1,2147483647,!1);ss.MAX_VALUE=_C;var RC=ns(-1,-1,!0);ss.MAX_UNSIGNED_VALUE=RC;var _n=ns(0,-2147483648,!1);ss.MIN_VALUE=_n;var Le=ss.prototype;Le.toInt=function(){return this.unsigned?this.low>>>0:this.low},Le.toNumber=function(){return this.unsigned?(this.high>>>0)*Yl+(this.low>>>0):this.high*Yl+(this.low>>>0)},Le.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(_n)){var s=cr(e),n=this.div(s),r=n.mul(s).sub(this);return n.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=cr(Jf(e,6),this.unsigned),o=this,l="";;){var c=o.div(i),d=o.sub(c.mul(i)).toInt()>>>0,u=d.toString(e);if(o=c,o.isZero())return u+l;for(;u.length<6;)u="0"+u;l=""+u+l}},Le.getHighBits=function(){return this.high},Le.getHighBitsUnsigned=function(){return this.high>>>0},Le.getLowBits=function(){return this.low},Le.getLowBitsUnsigned=function(){return this.low>>>0},Le.getNumBitsAbs=function(){if(this.isNegative())return this.eq(_n)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,s=31;s>0&&!(e&1<<s);s--);return this.high!=0?s+33:s+1},Le.isZero=function(){return this.high===0&&this.low===0},Le.eqz=Le.isZero,Le.isNegative=function(){return!this.unsigned&&this.high<0},Le.isPositive=function(){return this.unsigned||this.high>=0},Le.isOdd=function(){return(this.low&1)===1},Le.isEven=function(){return(this.low&1)===0},Le.equals=function(e){return Dn(e)||(e=Fr(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low},Le.eq=Le.equals,Le.notEquals=function(e){return!this.eq(e)},Le.neq=Le.notEquals,Le.ne=Le.notEquals,Le.lessThan=function(e){return this.comp(e)<0},Le.lt=Le.lessThan,Le.lessThanOrEqual=function(e){return this.comp(e)<=0},Le.lte=Le.lessThanOrEqual,Le.le=Le.lessThanOrEqual,Le.greaterThan=function(e){return this.comp(e)>0},Le.gt=Le.greaterThan,Le.greaterThanOrEqual=function(e){return this.comp(e)>=0},Le.gte=Le.greaterThanOrEqual,Le.ge=Le.greaterThanOrEqual,Le.compare=function(e){if(Dn(e)||(e=Fr(e)),this.eq(e))return 0;var s=this.isNegative(),n=e.isNegative();return s&&!n?-1:!s&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},Le.comp=Le.compare,Le.negate=function(){return!this.unsigned&&this.eq(_n)?_n:this.not().add(Zl)},Le.neg=Le.negate,Le.add=function(e){Dn(e)||(e=Fr(e));var s=this.high>>>16,n=this.high&65535,r=this.low>>>16,i=this.low&65535,o=e.high>>>16,l=e.high&65535,c=e.low>>>16,d=e.low&65535,u=0,h=0,p=0,f=0;return f+=i+d,p+=f>>>16,f&=65535,p+=r+c,h+=p>>>16,p&=65535,h+=n+l,u+=h>>>16,h&=65535,u+=s+o,u&=65535,ns(p<<16|f,u<<16|h,this.unsigned)},Le.subtract=function(e){return Dn(e)||(e=Fr(e)),this.add(e.neg())},Le.sub=Le.subtract,Le.multiply=function(e){if(this.isZero())return dr;if(Dn(e)||(e=Fr(e)),lr){var s=lr.mul(this.low,this.high,e.low,e.high);return ns(s,lr.get_high(),this.unsigned)}if(e.isZero())return dr;if(this.eq(_n))return e.isOdd()?_n:dr;if(e.eq(_n))return this.isOdd()?_n:dr;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(AC)&&e.lt(AC))return cr(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,r=this.high&65535,i=this.low>>>16,o=this.low&65535,l=e.high>>>16,c=e.high&65535,d=e.low>>>16,u=e.low&65535,h=0,p=0,f=0,m=0;return m+=o*u,f+=m>>>16,m&=65535,f+=i*u,p+=f>>>16,f&=65535,f+=o*d,p+=f>>>16,f&=65535,p+=r*u,h+=p>>>16,p&=65535,p+=i*d,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=n*u+r*d+i*c+o*l,h&=65535,ns(f<<16|m,h<<16|p,this.unsigned)},Le.mul=Le.multiply,Le.divide=function(e){if(Dn(e)||(e=Fr(e)),e.isZero())throw Error("division by zero");if(lr){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var s=(this.unsigned?lr.div_u:lr.div_s)(this.low,this.high,e.low,e.high);return ns(s,lr.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Ea:dr;var n,r,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Ea;if(e.gt(this.shru(1)))return DC;i=Ea}else{if(this.eq(_n)){if(e.eq(Zl)||e.eq(hb))return _n;if(e.eq(_n))return Zl;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(dr)?e.isNegative()?Zl:hb:(r=this.sub(e.mul(n)),i=n.add(r.div(e)),i)}else if(e.eq(_n))return this.unsigned?Ea:dr;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=dr}for(r=this;r.gte(e);){n=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var l=Math.ceil(Math.log(n)/Math.LN2),c=l<=48?1:Jf(2,l-48),d=cr(n),u=d.mul(e);u.isNegative()||u.gt(r);)n-=c,d=cr(n,this.unsigned),u=d.mul(e);d.isZero()&&(d=Zl),i=i.add(d),r=r.sub(u)}return i},Le.div=Le.divide,Le.modulo=function(e){if(Dn(e)||(e=Fr(e)),lr){var s=(this.unsigned?lr.rem_u:lr.rem_s)(this.low,this.high,e.low,e.high);return ns(s,lr.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))},Le.mod=Le.modulo,Le.rem=Le.modulo,Le.not=function(){return ns(~this.low,~this.high,this.unsigned)},Le.and=function(e){return Dn(e)||(e=Fr(e)),ns(this.low&e.low,this.high&e.high,this.unsigned)},Le.or=function(e){return Dn(e)||(e=Fr(e)),ns(this.low|e.low,this.high|e.high,this.unsigned)},Le.xor=function(e){return Dn(e)||(e=Fr(e)),ns(this.low^e.low,this.high^e.high,this.unsigned)},Le.shiftLeft=function(e){return Dn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ns(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ns(0,this.low<<e-32,this.unsigned)},Le.shl=Le.shiftLeft,Le.shiftRight=function(e){return Dn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ns(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ns(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},Le.shr=Le.shiftRight,Le.shiftRightUnsigned=function(e){if(Dn(e)&&(e=e.toInt()),e&=63,e===0)return this;var s=this.high;if(e<32){var n=this.low;return ns(n>>>e|s<<32-e,s>>>e,this.unsigned)}else return e===32?ns(s,0,this.unsigned):ns(s>>>e-32,0,this.unsigned)},Le.shru=Le.shiftRightUnsigned,Le.shr_u=Le.shiftRightUnsigned,Le.toSigned=function(){return this.unsigned?ns(this.low,this.high,!1):this},Le.toUnsigned=function(){return this.unsigned?this:ns(this.low,this.high,!0)},Le.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},Le.toBytesLE=function(){var e=this.high,s=this.low;return[s&255,s>>>8&255,s>>>16&255,s>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]},Le.toBytesBE=function(){var e=this.high,s=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,s>>>24,s>>>16&255,s>>>8&255,s&255]},ss.fromBytes=function(e,s,n){return n?ss.fromBytesLE(e,s):ss.fromBytesBE(e,s)},ss.fromBytesLE=function(e,s){return new ss(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,s)},ss.fromBytesBE=function(e,s){return new ss(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],s)};const PC=PR(SC),DU=RR({__proto__:null,default:PC},[SC]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $a=PC||DU;function Qf(t){return $a.fromString(t,!0,16)}const FC=Qf("c3a5c85c97cb3127"),Ta=Qf("b492b66fbe98f273"),an=Qf("9ae16a3b2f90404f");function pb(t){return t.xor(t.shru(47))}function OC(t,e,s){const n=t.slice(e,e+s);return $a.fromBytes(Array.from(n),!0,!0)}function Jt(t,e){return OC(t,e,8)}function MC(t,e){return OC(t,e,4)}function Rs(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function So(t,e,s=Qf("9ddfea08eb382d69")){let n=t.xor(e).mul(s);n=n.xor(n.shru(47));let r=e.xor(n).mul(s);return r=r.xor(r.shru(47)),r=r.mul(s),r}function _U(t,e,s,n,r,i){r=r.add(t),i=Rs(i.add(r).add(n),21);const o=r;return r=r.add(e),r=r.add(s),i=i.add(Rs(r,44)),[r.add(n),i.add(o)]}function em(t,e,s,n){return _U(Jt(t,e),Jt(t,e+8),Jt(t,e+16),Jt(t,e+24),s,n)}function RU(t,e=t.length){if(e>=8){const s=an.add(e*2),n=Jt(t,0).add(an),r=Jt(t,e-8),i=Rs(r,37).mul(s).add(n),o=Rs(n,25).add(r).mul(s);return So(i,o,s)}if(e>=4){const s=an.add(e*2),n=MC(t,0);return So(n.shl(3).add(e),MC(t,e-4),s)}if(e>0){const s=t[0],n=t[e>>1],r=t[e-1],i=s+(n<<8),o=e+(r<<2);return pb(an.mul(i).xor(FC.mul(o))).mul(an)}return an}function PU(t,e=t.length){const s=an.add(e*2),n=Jt(t,0).mul(Ta),r=Jt(t,8),i=Jt(t,e-8).mul(s),o=Jt(t,e-16).mul(an);return So(Rs(n.add(r),43).add(Rs(i,30)).add(o),n.add(Rs(r.add(an),18)).add(i),s)}function FU(t,e=t.length){const s=an.add(e*2),n=Jt(t,0).mul(an),r=Jt(t,8),i=Jt(t,e-8).mul(s),o=Jt(t,e-16).mul(an),l=Rs(n.add(r),43).add(Rs(i,30)).add(o),c=So(l,n.add(Rs(r.add(an),18)).add(i),s),d=Jt(t,16).mul(s),u=Jt(t,24),h=l.add(Jt(t,e-32)).mul(s),p=c.add(Jt(t,e-24)).mul(s);return So(Rs(d.add(u),43).add(Rs(h,30)).add(p),d.add(Rs(u.add(n),18)).add(h),s)}function OU(t,e=t.length){const s=$a.fromNumber(81,!0);if(e<=32)return e<=16?RU(t,e):PU(t,e);if(e<=64)return FU(t,e);let n=s,r=s.mul(Ta).add(113),i=pb(r.mul(an).add(113)).mul(an),o=[$a.UZERO,$a.UZERO],l=[$a.UZERO,$a.UZERO];n=n.mul(an).add(Jt(t,0));let c=0;const d=(e-1>>6)*64,u=d+(e-1&63)-63;do n=Rs(n.add(r).add(o[0]).add(Jt(t,c+8)),37).mul(Ta),r=Rs(r.add(o[1]).add(Jt(t,c+48)),42).mul(Ta),n=n.xor(l[1]),r=r.add(o[0]).add(Jt(t,c+40)),i=Rs(i.add(l[0]),33).mul(Ta),o=em(t,c,o[1].mul(Ta),n.add(l[0])),l=em(t,c+32,i.add(l[1]),r.add(Jt(t,c+16))),[i,n]=[n,i],c+=64;while(c!==d);const h=Ta.add(i.and(255).shl(1));return c=u,l[0]=l[0].add(e-1&63),o[0]=o[0].add(l[0]),l[0]=l[0].add(o[0]),n=Rs(n.add(r).add(o[0]).add(Jt(t,c+8)),37).mul(h),r=Rs(r.add(o[1]).add(Jt(t,c+48)),42).mul(h),n=n.xor(l[1].mul(9)),r=r.add(o[0].mul(9).add(Jt(t,c+40))),i=Rs(i.add(l[0]),33).mul(h),o=em(t,c,o[1].mul(h),n.add(l[0])),l=em(t,c+32,i.add(l[1]),r.add(Jt(t,c+16))),[i,n]=[n,i],So(So(o[0],l[0],h).add(pb(r).mul(FC)).add(i),So(o[1],l[1],h).add(n),h)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jo(t,e){return e==="string"?Io(t):Aa([t],e)}function MU(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function Aa(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Da(t)),oe().getBool("DEBUG")&&fU(t,e),MU(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const s=new Uint8Array(t.length);for(let n=0;n<s.length;++n)Math.round(t[n])!==0&&(s[n]=1);return s}else throw new Error(`Unknown data type ${e}`)}function yn(){return oe().platform.now()}function Io(t,e="utf-8"){return e=e||"utf-8",oe().platform.encode(t,e)}function Eo(t,e="utf-8"){return e=e||"utf-8",oe().platform.decode(t,e)}function ur(t){return oe().platform.isTypedArray!=null?oe().platform.isTypedArray(t):CC(t)}function Da(t,e=[],s=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||b0(t)||t==null||ur(t)&&s)e.push(t);else if(Array.isArray(t)||ur(t))for(let n=0;n<t.length;++n)Da(t[n],e,s);else{let n=-1;for(const r of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(r)&&(n=Math.max(n,Number(r)));for(let r=0;r<=n;r++)Da(t[r],e,s)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LU{constructor(e,s){this.backendTimer=e,this.logger=s,s==null&&(this.logger=new BU)}profileKernel(e,s,n){let r;const i=()=>{r=n()};let o;const l=yn();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const d of r)d.dataSync();o=Promise.resolve({kernelMs:yn()-l})}if(oe().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let d=0;d<r.length;d++){const u=r[d];u.data().then(h=>{zU(h,u.dtype,e)})}return{kernelName:e,outputs:r,inputs:s,timeMs:o.then(d=>d.kernelMs),extraInfo:o.then(d=>d.getExtraProfileInfo!=null?d.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:s,outputs:n,timeMs:r,inputs:i,extraInfo:o}=e;n.forEach(l=>{Promise.all([l.data(),r,o]).then(c=>{this.logger.logKernelProfile(s,l,c[0],c[1],i,c[2])})})}}function zU(t,e,s){if(e!=="float32")return!1;for(let n=0;n<t.length;n++){const r=t[n];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${s}'`),!0}return!1}class BU{logKernelProfile(e,s,n,r,i,o){const l=typeof r=="number"?Gl(`${r}ms`,9):r.error,c=Gl(e,25),d=s.rank,u=s.size,h=Gl(s.shape.toString(),14);let p="";for(const f in i){const m=i[f];if(m!=null){const b=m.shape||s.shape,g=b.length;p+=`${f}: ${g}D ${g>0?b:""} `}}console.log(`%c${c}	%c${l}	%c${d}D ${h}	%c${u}	%c${p}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UU(t,e,s){const n={},r={};for(let c=0;c<e.length;c++)n[e[c].id]=!0;for(let c=0;c<t.length;c++){const d=t[c],u=d.inputs;for(const h in u){const p=u[h];let f=!1;for(let m=0;m<e.length;m++)if(n[p.id]){d.outputs.forEach(b=>n[b.id]=!0),f=!0,r[d.id]=!0;break}if(f)break}}const i={};i[s.id]=!0;const o={};for(let c=t.length-1;c>=0;c--){const d=t[c],u=d.inputs;for(let h=0;h<d.outputs.length;h++)if(i[d.outputs[h].id]){for(const p in u)i[u[p].id]=!0,o[d.id]=!0;break}}const l=[];for(let c=0;c<t.length;c++){const d=t[c];if(r[d.id]&&o[d.id]){const u={};for(const p in d.inputs){const f=d.inputs[p];n[f.id]&&(u[p]=f)}const h=Object.assign({},d);h.inputs=u,h.outputs=d.outputs,l.push(h)}}return l}function VU(t,e,s,n){for(let r=e.length-1;r>=0;r--){const i=e[r],o=[];if(i.outputs.forEach(c=>{const d=t[c.id];d!=null?o.push(d):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const l=i.gradient(o);for(const c in i.inputs){if(!(c in l))throw new Error(`Cannot backprop through input ${c}. Available gradients found: ${Object.keys(l)}.`);const d=s(()=>l[c]());if(d.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${c} must have 'float32' dtype, but has '${d.dtype}'`);const u=i.inputs[c];if(!Ft(d.shape,u.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${c}' has shape '${d.shape}', which does not match the shape of the input '${u.shape}'`);if(t[u.id]==null)t[u.id]=d;else{const h=t[u.id];t[u.id]=n(h,d),h.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LC=20,gu=3,fb=7;function WU(t,e,s,n){const r=tt(e),i=GU(t,e,s,r),o=e.length,l=tm(t,e,s,r,i),c=["Tensor"];return n&&(c.push(`  dtype: ${s}`),c.push(`  rank: ${o}`),c.push(`  shape: [${e}]`),c.push("  values:")),c.push(l.map(d=>"    "+d).join(`
`)),c.join(`
`)}function GU(t,e,s,n){const r=pe(e),i=n[n.length-1],o=new Array(i).fill(0),l=e.length,c=s==="complex64"?bu(t):t;if(l>1)for(let d=0;d<r/i;d++){const u=d*i;for(let h=0;h<i;h++)o[h]=Math.max(o[h],xu(c[u+h],0,s).length)}return o}function xu(t,e,s){let n;return Array.isArray(t)?n=`${parseFloat(t[0].toFixed(fb))} + ${parseFloat(t[1].toFixed(fb))}j`:wd(t)?n=`'${t}'`:s==="bool"?n=zC(t):n=parseFloat(t.toFixed(fb)).toString(),Gl(n,e)}function zC(t){return t===0?"false":"true"}function tm(t,e,s,n,r,i=!0){const o=s==="complex64"?2:1,l=e[0],c=e.length;if(c===0){if(s==="complex64"){const b=bu(t);return[xu(b[0],0,s)]}return s==="bool"?[zC(t[0])]:[t[0].toString()]}if(c===1){if(l>LC){const g=gu*o;let x=Array.from(t.slice(0,g)),y=Array.from(t.slice((l-gu)*o,l*o));return s==="complex64"&&(x=bu(x),y=bu(y)),["["+x.map((w,v)=>xu(w,r[v],s)).join(", ")+", ..., "+y.map((w,v)=>xu(w,r[l-gu+v],s)).join(", ")+"]"]}return["["+(s==="complex64"?bu(t):Array.from(t)).map((g,x)=>xu(g,r[x],s)).join(", ")+"]"]}const d=e.slice(1),u=n.slice(1),h=n[0]*o,p=[];if(l>LC){for(let b=0;b<gu;b++){const g=b*h,x=g+h;p.push(...tm(t.slice(g,x),d,s,u,r,!1))}p.push("...");for(let b=l-gu;b<l;b++){const g=b*h,x=g+h;p.push(...tm(t.slice(g,x),d,s,u,r,b===l-1))}}else for(let b=0;b<l;b++){const g=b*h,x=g+h;p.push(...tm(t.slice(g,x),d,s,u,r,b===l-1))}const f=c===2?",":"";p[0]="["+(l>0?p[0]+f:"");for(let b=1;b<p.length-1;b++)p[b]=" "+p[b]+f;let m=`,
`;for(let b=2;b<c;b++)m+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(i?"":m),p}function bu(t){const e=[];for(let s=0;s<t.length;s+=2)e.push([t[s],t[s+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Us{constructor(e,s,n){if(this.dtype=s,this.shape=e.slice(),this.size=pe(e),n!=null){const r=n.length;A(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(s==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||ps(s,this.size),this.strides=tt(e)}set(e,...s){s.length===0&&(s=[0]),A(s.length===this.rank,()=>`The number of provided coordinates (${s.length}) must match the rank (${this.rank})`);const n=this.locToIndex(s);this.values[n]=e}get(...e){e.length===0&&(e=[0]);let s=0;for(const r of e){if(r<0||r>=this.shape[s]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}s++}let n=e[e.length-1];for(let r=0;r<e.length-1;++r)n+=this.strides[r]*e[r];return this.values[n]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let s=e[e.length-1];for(let n=0;n<e.length-1;++n)s+=this.strides[n]*e[n];return s}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const s=new Array(this.shape.length);for(let n=0;n<s.length-1;++n)s[n]=Math.floor(e/this.strides[n]),e-=s[n]*this.strides[n];return s[s.length-1]=e,s}get rank(){return this.shape.length}toTensor(){return Or().makeTensor(this.values,this.shape,this.dtype)}}let Or=null,Jl=null;function HU(t){Or=t}function qU(t){Jl=t}class Is{constructor(e,s,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=s||"float32",this.size=pe(e),this.strides=tt(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Jl.buffer(this.shape,this.dtype,e)}bufferSync(){return Jl.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Pr(this.shape,e,this.dtype==="complex64")}arraySync(){return Pr(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Or().read(this.dataId);if(this.dtype==="string"){const s=await e;try{return s.map(n=>Eo(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Or().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Or().readSync(this.dataId);if(this.dtype==="string")try{return e.map(s=>Eo(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Or().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Or().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Jl.print(this,e)}clone(){return this.throwIfDisposed(),Jl.clone(this)}toString(e=!1){const s=this.dataSync();return WU(s,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Jl.cast(this,e)}variable(e=!0,s,n){return this.throwIfDisposed(),Or().makeVariable(this,e,s,n)}}Object.defineProperty(Is,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function he(){return w0("Tensor",()=>Is)}he();class sm extends Is{constructor(e,s,n,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=s,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Ft(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Or().disposeTensor(this),this.dataId=e.dataId,Or().incRef(this,null)}dispose(){Or().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(sm,Symbol.hasInstance,{value:t=>t instanceof Is&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var BC;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(BC||(BC={}));var mb;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(mb||(mb={}));var gb;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(gb||(gb={}));var xb;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(xb||(xb={}));var bb;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(bb||(bb={}));const KU={float32:xb,int32:mb,bool:gb,complex64:bb};function Rn(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return KU[t][e]}function yb(t){return Rn(t,"int32")}function UC(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function VC(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fs(t,e){if(t.dtype===e.dtype)return[t,e];const s=Rn(t.dtype,e.dtype);return[t.cast(s),e.cast(s)]}function WC(t){const e=[];return GC(t,e,new Set),e}function GC(t,e,s){if(t==null)return;if(t instanceof Is){e.push(t);return}if(!XU(t))return;const n=t;for(const r in n){const i=n[r];s.has(i)||(s.add(i),GC(i,e,s))}}function XU(t){return Array.isArray(t)||typeof t=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wb(t){return t.kernelName!=null}class HC{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class Ql{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new HC}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let s=0;s<e.length;s++){const n=e[s];if(await this.initializeBackend(n).success){await this.setBackend(n);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:s}=this.initializeBackendsAndReturnBest();if(s)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:s}=this.initializeBackend(e);if(s)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,s,n=1){return e in this.registryFactory?(Gn(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:s,priority:n},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:s,asyncInit:n}=this.initializeBackend(e);if(!(n?await s:s))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new LU(this.backendInstance),!0}setupRegisteredKernels(){vC(this.backendName).forEach(s=>{s.setupFunc!=null&&s.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){vC(e).forEach(n=>{n.disposeFunc!=null&&n.disposeFunc(this.registry[e])})}initializeBackend(e){const s=this.registryFactory[e];if(s==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const n=s.factory();if(n&&!(n instanceof d0)&&typeof n.then=="function"){const r=++this.pendingBackendInitId,i=n.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,Gn(`Initialization of backend ${e} failed`),Gn(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=n,{success:!0,asyncInit:!1}}catch(n){return Gn(`Initialization of backend ${e} failed`),Gn(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,s)=>this.registryFactory[s].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let s=0;s<e.length;s++){const n=e[s],{success:r,asyncInit:i}=this.initializeBackend(n);if(i||r)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,s){const n=this.state.tensorInfo.get(s),r=n.backend,i=this.readSync(s),o=r.refCount(s);r.disposeData(s,!0),n.backend=e,e.move(s,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,s){let n=null;if(s==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");s=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof s!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");n=e}let r;return this.scopedRun(()=>this.startScope(n),()=>this.endScope(r),()=>(r=s(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,s,n){e();try{const r=n();return s(),r}catch(r){throw s(),r}}nextTensorId(){return Ql.nextTensorId++}nextVariableId(){return Ql.nextVariableId++}clone(e){const s=W.runKernel(Bd,{x:e}),n={x:e},r=o=>({x:()=>{const l="float32",c={x:o},d={dtype:l};return W.runKernel(Ed,c,d)}}),i=[];return this.addTapeNode(this.state.activeScope.name,n,[s],r,i,{}),s}runKernel(e,s,n){if(this.backendName==null&&this.backend,!(yC(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:s,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,s,n){const r=this.backend.numDataIds();let i=0;n.forEach(c=>{i+=c.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],l=r-s-i-o;if(l>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${l} data ids) after running '${e}'`)}runKernelFunc(e){let s,n=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let l;this.backendName==null&&this.backend;let c;const d=wb(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(wb(e)){const{kernelName:m,inputs:b,attrs:g}=e;this.backendName==null&&this.backend;const x=yC(m,this.backendName);A(x!=null,()=>`Cannot find registered kernel '${m}' for backend '${this.backendName}'`),l=()=>{const y=this.backend.numDataIds();c=x.kernelFunc({inputs:b,attrs:g,backend:this.backend});const w=Array.isArray(c)?c:[c];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(m,y,w);const v=w.map(N=>N.rank!=null?N:this.makeTensorFromTensorInfo(N));if(r){const N=this.getTensorsForGradient(m,b,v);n=this.saveTensorsForBackwardMode(N)}return v}}else{const{forwardFunc:m}=e,b=g=>{r&&(n=g.map(x=>this.keep(this.clone(x))))};l=()=>{const g=this.backend.numDataIds();c=this.tidy(()=>m(this.backend,b));const x=Array.isArray(c)?c:[c];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(d,g,x),x}}const{inputs:u,attrs:h}=e,p=wb(e)?null:e.backwardsFunc;let f;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?s=l():(f=this.profiler.profileKernel(d,u,()=>l()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(f),s=f.outputs)}),r&&this.addTapeNode(d,u,s,p,n,h),this.state.profiling&&this.state.activeProfile.kernels.push({name:d,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(m=>u[m]!=null?u[m].shape:null),outputShapes:s.map(m=>m.shape),kernelTimeMs:f.timeMs,extraInfo:f.extraInfo}),Array.isArray(c)?s:s[0]}saveTensorsForBackwardMode(e){return e.map(n=>this.keep(this.clone(n)))}getTensorsForGradient(e,s,n){const r=wC(e);if(r!=null){const i=r.inputsToSave||[],o=r.outputsToSave||[];let l;r.saveAllInputs?(A(Array.isArray(s),()=>"saveAllInputs is true, expected inputs to be an array."),l=Object.keys(s).map(d=>s[d])):l=i.map(d=>s[d]);const c=n.filter((d,u)=>o[u]);return l.concat(c)}return[]}makeTensor(e,s,n,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;let i=e;n==="string"&&wd(e[0])&&(i=e.map(c=>Io(c)));const o=r.write(i,s,n),l=new Is(s,n,o,this.nextTensorId());if(this.trackTensor(l,r),n==="string"){const c=this.state.tensorInfo.get(o),d=gU(i);this.state.numBytes+=d-c.bytes,c.bytes=d}return l}makeTensorFromDataId(e,s,n,r){n=n||"float32";const i={dataId:e,shape:s,dtype:n};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,s){const{dataId:n,shape:r,dtype:i}=e,o=new Is(r,i,n,this.nextTensorId());return this.trackTensor(o,s),o}makeVariable(e,s=!0,n,r){n=n||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const i=new sm(e,s,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,s){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*qp(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:s||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof sm||this.track(e)}incRef(e,s){this.trackTensor(e,s),this.backend.incRef(e.dataId)}removeDataId(e,s){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===s&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const s=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=s.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const n=e.size*qp(e.dtype);this.state.numBytes-=n}s.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,s.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const s=this.state.registeredVariables[e];this.disposeVariable(s)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const s=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-s,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,s,n,r,i,o){const l={id:this.state.nextTapeNodeId++,kernelName:e,inputs:s,outputs:n,saved:i},c=wC(e);c!=null&&(r=c.gradFunc),r!=null&&(l.gradient=d=>(d=d.map((u,h)=>{if(u==null){const p=n[h],f=Js(p.size,p.dtype);return this.makeTensor(f,p.shape,p.dtype)}return u}),r(d.length>1?d:d[0],i,o))),this.state.activeTape.push(l)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const s={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(s.name=e),this.state.scopeStack.push(s),this.state.activeScope=s}endScope(e){const s=WC(e),n=new Set(s.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!n.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],s.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(e,s,n,r=!1){if(A(s.length>0,()=>"gradients() received an empty list of xs."),n!=null&&n.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));A(i instanceof Is,()=>"The result y returned by f() must be a tensor.");const o=UU(this.state.activeTape,s,i);if(!r&&o.length===0&&s.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const l={};l[i.id]=n??YU(i.shape),VU(l,o,d=>this.tidy(d),ZU);const c=s.map(d=>l[d.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(d=>{for(const u of d.saved)u.dispose()}),this.state.activeTape=null),{value:i,grads:c}})}customGrad(e){return A(m0(e),()=>"The f passed in customGrad(f) must be a function."),(...s)=>{A(s.every(l=>l instanceof Is),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let n;const r={};s.forEach((l,c)=>{r[c]=l});const i=(l,c)=>(n=e(...s,c),A(n.value instanceof Is,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),A(m0(n.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n.value),o=(l,c)=>{const d=n.gradFunc(l,c),u=Array.isArray(d)?d:[d];A(u.length===s.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),A(u.every(p=>p instanceof Is),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const h={};return u.forEach((p,f)=>{h[f]=()=>p}),h};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,s){return this.state.tensorInfo.get(e).backend.readToGPU(e,s)}async time(e){const s=yn(),n=await this.backend.time(e);return n.wallMs=yn()-s,n}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new HC;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}Ql.nextTensorId=0,Ql.nextVariableId=0;function YU(t){const e=x0(pe(t),"float32");return W.makeTensor(e,t,"float32")}function qC(){const t=Zk();if(t._tfengine==null){const e=new yU(t);t._tfengine=new Ql(e)}return kU(t._tfengine.ENV),HU(()=>t._tfengine),t._tfengine}const W=qC();function ZU(t,e){const s={a:t,b:e};return W.runKernel(Kl,s)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JU(){return typeof navigator<"u"&&navigator!=null}function KC(t){if(t||JU()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const s=t;return s.userAgentData&&s.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function XC(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wn=oe();wn.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),wn.registerFlag("IS_BROWSER",()=>XC()),wn.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"),wn.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)),wn.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)),wn.registerFlag("PROD",()=>!1),wn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>wn.getBool("DEBUG")),wn.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0),wn.registerFlag("IS_TEST",()=>!1),wn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>wn.getBool("DEBUG")),wn.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1),wn.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1),wn.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nm(t,e){let s=t;if(ur(t))return e==="string"?[]:[t.length];if(UC(t)){const r=t.channels||"RGBA";return[t.height,t.width*r.length]}else if(VC(t))return[t.buffer.size/(e==null?4:qp(e))];if(!Array.isArray(t))return[];const n=[];for(;Array.isArray(s)||ur(s)&&e!=="string";)n.push(s.length),s=s[0];return Array.isArray(t)&&oe().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&YC(t,n,[]),n}function YC(t,e,s){if(s=s||[],!Array.isArray(t)&&!ur(t)){A(e.length===0,()=>`Element arr[${s.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}A(e.length>0,()=>`Element arr[${s.join("][")}] should be a primitive, but is an array of ${t.length} elements`),A(t.length===e[0],()=>`Element arr[${s.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const n=e.slice(1);for(let r=0;r<t.length;++r)YC(t[r],n,s.concat(r))}function ZC(t,e,s,n){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${s}' passed to '${n}' must be ${t} tensor, but got ${e} tensor`)}}function M(t,e,s,n="numeric"){if(t instanceof he())return ZC(n,t.dtype,e,s),t;let r=Hl(t);if(r!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(r=n),ZC(n,r,e,s),t==null||!ur(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const c=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${s}' must be a Tensor or TensorLike, but got '${c}'`)}const i=nm(t,r);!ur(t)&&!Array.isArray(t)&&(t=[t]);const l=r!=="string"?Aa(t,r):Da(t,[],!0);return W.makeTensor(l,i,r)}function JC(t,e,s,n="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${s} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((i,o)=>M(i,`${e}[${o}]`,s,n))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QU="__op";function J(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let s=e[0];const n=t[s];s.endsWith("_")&&(s=s.substring(0,s.length-1)),s=s+QU;const r=(...i)=>{W.startScope(s);try{const o=n(...i);return b0(o)&&console.error("Cannot return a Promise inside of tidy."),W.endScope(o),o}catch(o){throw W.endScope(null),o}};return Object.defineProperty(r,"name",{value:s,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eV(t,e){const s=M(t,"real","complex"),n=M(e,"imag","complex");h0(s.shape,n.shape,`real and imag shapes, ${s.shape} and ${n.shape}, must match in call to tf.complex().`);const r={real:s,imag:n};return W.runKernel(E0,r)}const _a=J({complex_:eV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rm(t,e,s,n){if(n==null)n=Hl(t);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(VC(t)||UC(t)){if(n!=="float32"&&n!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${n}.`);return W.backend.createTensorFromGPUData(t,e||s,n)}if(!ur(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Xi(e);const r=pe(e),i=pe(s);A(r===i,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${i}`);for(let o=0;o<s.length;++o){const l=s[o],c=o===s.length-1?l!==pe(e.slice(o)):!0;A(s[o]===e[o]||!c,()=>`Error creating a new Tensor. Inferred shape (${s}) does not match the provided shape (${e}). `)}}return!ur(t)&&!Array.isArray(t)&&(t=[t]),e=e||s,t=n!=="string"?Aa(t,n):Da(t,[],!0),W.makeTensor(t,e,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yu(t,e,s){const n=nm(t,s);return rm(t,e,n,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const im={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class $o{static join(e){return new $o(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(n=>ur(n)?n.buffer:n),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let s=0;for(let n=0;n<e.length;n++){const r=e[n];n!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=s+r.byteLength;this.shards.push({buffer:r,start:s,end:i}),s=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,s=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,s=isNaN(Number(s))?0:s,e=Math.max(0,e),s=Math.min(this.byteLength,s),s<=e)return new ArrayBuffer(0);const n=this.findShardForByte(e);if(n===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=s-e,i=new ArrayBuffer(r),o=new Uint8Array(i);let l=0;for(let c=n;c<this.shards.length;c++){const d=this.shards[c],h=e+l-d.start,p=l,m=Math.min(s,d.end)-d.start,b=new Uint8Array(d.buffer,h,m-h);if(o.set(b,p),l+=b.length,s<d.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function s(r){return e<r.start?-1:e>=r.end?1:0}if(s(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const n=tV(this.shards,s);return n===-1?-1:(this.previousShardIndex=n,this.previousShardIndex)}}function tV(t,e){let s=0,n=t.length;for(;s<=n;){const r=Math.floor((n-s)/2)+s,i=e(t[r]);if(i===0)return r;i<0?n=r:s=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ai(){return W}function QC(){return W.memory()}function ne(t,e){return W.tidy(t,e)}function wt(t){WC(t).forEach(s=>s.dispose())}function li(t){return W.keep(t)}function eS(t,e,s=1){return W.registerBackend(t,e,s)}function sV(){return W.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ec=4;async function tS(t,e){const s=[],n=[],r=Array.isArray(t)?t.map(o=>o.name):Object.keys(t);for(let o=0;o<r.length;++o){const l=r[o],c=Array.isArray(t)?t[o].tensor:t[l];if(c.dtype!=="float32"&&c.dtype!=="int32"&&c.dtype!=="bool"&&c.dtype!=="string"&&c.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${l}': ${c.dtype}`);const d={name:l,shape:c.shape,dtype:c.dtype};if(c.dtype==="string"){const u=new Promise(async h=>{const p=await c.bytes(),f=p.reduce((g,x)=>g+x.length,0)+ec*p.length,m=new Uint8Array(f);let b=0;for(let g=0;g<p.length;g++){const x=p[g],y=new Uint8Array(new Uint32Array([x.length]).buffer);m.set(y,b),b+=ec,m.set(x,b),b+=x.length}h(m)});n.push(u)}else n.push(c.data());e!=null&&(d.group=e),s.push(d)}const i=await Promise.all(n);return{data:oV(i),specs:s}}function nV(t,e){const s=new $o(t),n={};let r=0;for(const i of e){const o=rV(i,(l,c)=>s.slice(r+l,r+c));n[i.name]=iV(i,s.slice(r,r+o)),r+=o}return n}function rV(t,e){const s=pe(t.shape);let n;if("quantization"in t){const r=t.quantization;n=im[r.dtype]}else if(t.dtype==="string"){let r=0;for(let i=0;i<s;i++)r+=ec+new Uint32Array(e(r,r+ec))[0];return r}else n=im[t.dtype];return s*n}function iV(t,e){const s=t.name,n=t.dtype,r=t.shape,i=pe(r);let o,l=0;if("quantization"in t){const c=t.quantization;if(c.dtype==="uint8"||c.dtype==="uint16"){if(!("min"in c&&"scale"in c))throw new Error(`Weight ${t.name} with quantization ${c.dtype} doesn't have corresponding metadata min and scale.`)}else if(c.dtype==="float16"){if(n!=="float32")throw new Error(`Weight ${t.name} is quantized with ${c.dtype} which only supports weights of type float32 not ${n}.`)}else throw new Error(`Weight ${t.name} has unknown quantization dtype ${c.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const d=im[c.dtype],u=c.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(n==="float32")if(c.dtype==="uint8"||c.dtype==="uint16"){o=new Float32Array(u.length);for(let h=0;h<u.length;h++){const p=u[h];o[h]=p*c.scale+c.min}}else if(c.dtype==="float16")o=gV()(u);else throw new Error(`Unsupported quantization type ${c.dtype} for weight type float32.`);else if(n==="int32"){if(c.dtype!=="uint8"&&c.dtype!=="uint16")throw new Error(`Unsupported quantization type ${c.dtype} for weight type int32.`);o=new Int32Array(u.length);for(let h=0;h<u.length;h++){const p=u[h];o[h]=Math.round(p*c.scale+c.min)}}else throw new Error(`Unsupported dtype in weight '${s}': ${n}`);l+=i*d}else if(n==="string"){const c=pe(t.shape);o=[];for(let d=0;d<c;d++){const u=new Uint32Array(e.slice(l,l+ec))[0];l+=ec;const h=new Uint8Array(e.slice(l,l+u));o.push(h),l+=u}}else{const c=im[n];if(n==="float32")o=new Float32Array(e);else if(n==="int32")o=new Int32Array(e);else if(n==="bool")o=new Uint8Array(e);else if(n==="complex64"){o=new Float32Array(e);const d=new Float32Array(o.length/2),u=new Float32Array(o.length/2);for(let m=0;m<d.length;m++)d[m]=o[m*2],u[m]=o[m*2+1];const h=yu(d,r,"float32"),p=yu(u,r,"float32"),f=_a(h,p);return h.dispose(),p.dispose(),f}else throw new Error(`Unsupported dtype in weight '${s}': ${n}`);l+=i*c}return yu(o,r,n)}function oV(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const s=[];t.forEach(i=>{if(e+=i.byteLength,s.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const n=new Uint8Array(e);let r=0;return s.forEach(i=>{n.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),n.buffer}const vb=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function sS(t){return vb?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function aV(t){if(vb)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let s="";for(let n=0,r=e.length;n<r;n++)s+=String.fromCharCode(e[n]);return btoa(s)}function lV(t){if(vb){const n=Buffer.from(t,"base64");return n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}const e=atob(t),s=new Uint8Array(e.length);for(let n=0;n<e.length;++n)s.set([e.charCodeAt(n)],n);return s.buffer}function cV(t){return $o.join(t)}function dV(t,e){const s={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(s.signature=t.signature),t.userDefinedMetadata!=null&&(s.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(s.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(s.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(s.trainingConfig=t.trainingConfig),s}function uV(t,e,s){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!s)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=s}return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),n}async function hV(t,e){let s,n;return t.weightsManifest!=null&&([s,n]=await e(t.weightsManifest)),uV(t,s,n)}function Nb(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:sS(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:sS(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new $o(t.weightData).byteLength}}function nS(t){const e=[];for(const s of t)e.push(...s.weights);return e}function pV(){const t=s=>{let n=s<<13,r=0;for(;!(n&8388608);)r-=8388608,n<<=1;return n&=-8388609,r+=947912704,n|r},e=new Uint32Array(2048);e[0]=0;for(let s=1;s<1024;s++)e[s]=t(s);for(let s=1024;s<2048;s++)e[s]=939524096+(s-1024<<13);return e}function fV(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function mV(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function gV(){const t=pV(),e=fV(),s=mV();return n=>{const r=new ArrayBuffer(4*n.length),i=new Uint32Array(r);for(let o=0;o<n.length;o++){const l=n[o],c=t[s[l>>10]+(l&1023)]+e[l>>10];i[o]=c}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ps{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Ps.instance==null&&(Ps.instance=new Ps),Ps.instance}static registerSaveRouter(e){Ps.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Ps.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Ps.getHandlers(e,"save")}static getLoadHandlers(e,s){return Ps.getHandlers(e,"load",s)}static getHandlers(e,s,n){const r=[];return(s==="load"?Ps.getInstance().loadRouters:Ps.getInstance().saveRouters).forEach(o=>{const l=o(e,n);l!==null&&r.push(l)}),r}}const xV=t=>Ps.getSaveHandlers(t),bV=(t,e)=>Ps.getLoadHandlers(t,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kb="tensorflowjs",Cb=1,Ra="models_store",To="model_info_store";function rS(){if(!oe().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Sb(t){const e=t.result;e.createObjectStore(Ra,{keyPath:"modelPath"}),e.createObjectStore(To,{keyPath:"modelPath"})}class Pa{constructor(e){if(this.indexedDB=rS(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,s){return new Promise((n,r)=>{const i=this.indexedDB.open(kb,Cb);i.onupgradeneeded=()=>Sb(i),i.onsuccess=()=>{const o=i.result;if(s==null){const l=o.transaction(Ra,"readonly"),d=l.objectStore(Ra).get(this.modelPath);d.onsuccess=()=>{if(d.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));n(d.result.modelArtifacts)},d.onerror=u=>(o.close(),r(d.error)),l.oncomplete=()=>o.close()}else{s.weightData=$o.join(s.weightData);const l=Nb(s),c=o.transaction(To,"readwrite");let d=c.objectStore(To),u;try{u=d.put({modelPath:this.modelPath,modelArtifactsInfo:l})}catch(p){return r(p)}let h;u.onsuccess=()=>{h=o.transaction(Ra,"readwrite");const p=h.objectStore(Ra);let f;try{f=p.put({modelPath:this.modelPath,modelArtifacts:s,modelArtifactsInfo:l})}catch(m){return r(m)}f.onsuccess=()=>n({modelArtifactsInfo:l}),f.onerror=m=>{d=c.objectStore(To);const b=d.delete(this.modelPath);b.onsuccess=()=>(o.close(),r(f.error)),b.onerror=g=>(o.close(),r(f.error))}},u.onerror=p=>(o.close(),r(u.error)),c.oncomplete=()=>{h==null?o.close():h.oncomplete=()=>o.close()}}},i.onerror=o=>r(i.error)})}}Pa.URL_SCHEME="indexeddb://";const iS=t=>oe().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Pa.URL_SCHEME)?yV(t.slice(Pa.URL_SCHEME.length)):null;Ps.registerSaveRouter(iS),Ps.registerLoadRouter(iS);function yV(t){return new Pa(t)}function wV(t){return t.startsWith(Pa.URL_SCHEME)?t.slice(Pa.URL_SCHEME.length):t}class vV{constructor(){this.indexedDB=rS()}async listModels(){return new Promise((e,s)=>{const n=this.indexedDB.open(kb,Cb);n.onupgradeneeded=()=>Sb(n),n.onsuccess=()=>{const r=n.result,i=r.transaction(To,"readonly"),l=i.objectStore(To).getAll();l.onsuccess=()=>{const c={};for(const d of l.result)c[d.modelPath]=d.modelArtifactsInfo;e(c)},l.onerror=c=>(r.close(),s(l.error)),i.oncomplete=()=>r.close()},n.onerror=r=>s(n.error)})}async removeModel(e){return e=wV(e),new Promise((s,n)=>{const r=this.indexedDB.open(kb,Cb);r.onupgradeneeded=()=>Sb(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(To,"readwrite"),l=o.objectStore(To),c=l.get(e);let d;c.onsuccess=()=>{if(c.result==null)return i.close(),n(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const u=l.delete(e),h=()=>{d=i.transaction(Ra,"readwrite");const f=d.objectStore(Ra).delete(e);f.onsuccess=()=>s(c.result.modelArtifactsInfo),f.onerror=m=>n(c.error)};u.onsuccess=h,u.onerror=p=>(h(),i.close(),n(c.error))}},c.onerror=u=>(i.close(),n(c.error)),o.oncomplete=()=>{d==null?i.close():d.oncomplete=()=>i.close()}},r.onerror=i=>n(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yi="/",tc="tensorflowjs_models",oS="info",NV="model_topology",kV="weight_specs",CV="weight_data",SV="model_metadata";function aS(t){return{info:[tc,t,oS].join(Yi),topology:[tc,t,NV].join(Yi),weightSpecs:[tc,t,kV].join(Yi),weightData:[tc,t,CV].join(Yi),modelMetadata:[tc,t,SV].join(Yi)}}function lS(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function jV(t){const e=t.split(Yi);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(Yi)}function IV(t){return t.startsWith(Fa.URL_SCHEME)?t.slice(Fa.URL_SCHEME.length):t}class Fa{constructor(e){if(!oe().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=aS(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const s=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=Nb(e),i=$o.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,s),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,aV(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw lS(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const s={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(n==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);s.modelTopology=n;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);s.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const l=JSON.parse(i);s.format=l.format,s.generatedBy=l.generatedBy,s.convertedBy=l.convertedBy,l.signature!=null&&(s.signature=l.signature),l.userDefinedMetadata!=null&&(s.userDefinedMetadata=l.userDefinedMetadata),l.modelInitializer!=null&&(s.modelInitializer=l.modelInitializer),l.initializerSignature!=null&&(s.initializerSignature=l.initializerSignature),l.trainingConfig!=null&&(s.trainingConfig=l.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return s.weightData=lV(o),s}}Fa.URL_SCHEME="localstorage://";const cS=t=>oe().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Fa.URL_SCHEME)?EV(t.slice(Fa.URL_SCHEME.length)):null;Ps.registerSaveRouter(cS),Ps.registerLoadRouter(cS);function EV(t){return new Fa(t)}class $V{constructor(){A(oe().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),A(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},s=tc+Yi,n=Yi+oS;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(s)&&i.endsWith(n)){const o=jV(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=IV(e);const s=aS(e);if(this.LS.getItem(s.info)==null)throw new Error(`Cannot find model at path '${e}'`);const n=JSON.parse(this.LS.getItem(s.info));return lS(s),n}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dS="://";class ci{constructor(){this.managers={}}static getInstance(){return ci.instance==null&&(ci.instance=new ci),ci.instance}static registerManager(e,s){A(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(dS)&&(e=e.slice(0,e.indexOf(dS))),A(e.length>0,()=>"scheme must not be an empty string.");const n=ci.getInstance();A(n.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),n.managers[e]=s}static getManager(e){const s=ci.getInstance().managers[e];if(s==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return s}static getSchemes(){return Object.keys(ci.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TV{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,s){return fetch(e,s)}now(){return performance.now()}encode(e,s){if(s!=="utf-8"&&s!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${s}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,s){return new TextDecoder(s).decode(e)}setTimeoutCustom(e,s){if(typeof window>"u"||!oe().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,s);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},s),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",n=>{if(n.source===window&&n.data.name===this.messageName){n.stopPropagation();const r=this.functionRefs[n.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return CC(e)}}if(oe().get("IS_BROWSER")){oe().setPlatform("browser",new TV);try{ci.registerManager(Fa.URL_SCHEME,new $V)}catch{}try{ci.registerManager(Pa.URL_SCHEME,new vV)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AV={importFetch:()=>require("node-fetch")};let jb;class DV{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,s){return oe().global.fetch!=null?oe().global.fetch(e,s):(jb==null&&(jb=AV.importFetch()),jb(e,s))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,s){if(s!=="utf-8"&&s!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${s}`);return this.textEncoder.encode(e)}decode(e,s){return e.length===0?"":new this.util.TextDecoder(s).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}oe().get("IS_NODE")&&!oe().get("IS_BROWSER")&&oe().setPlatform("node",new DV);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nt(t,e="float32",s){return e=e||"float32",Xi(t),new Us(t,e,s)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _V(t,e){const s=M(t,"x","cast");if(!mU(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&s.dtype!=="string"||e!=="string"&&s.dtype==="string")throw new Error("Only strings can be casted to strings");const n={x:s},r={dtype:e};return W.runKernel(Ed,n,r)}const Be=J({cast_:_V});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RV(t){const s={x:M(t,"x","clone","string_or_numeric")};return W.runKernel(Bd,s)}const Oa=J({clone_:RV});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PV(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */qC(),qU({buffer:Nt,cast:Be,clone:Oa,print:PV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FV(t,e){let s=M(t,"a","add"),n=M(e,"b","add");[s,n]=fs(s,n);const r={a:s,b:n};return W.runKernel(Kl,r)}const Te=J({add_:FV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OV(t,e){let s=M(t,"a","floorDiv"),n=M(e,"b","floorDiv");[s,n]=fs(s,n);const r={a:s,b:n};return W.runKernel(Ld,r)}const uS=J({floorDiv_:OV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MV(t,e){let s=M(t,"a","div"),n=M(e,"b","div");if([s,n]=fs(s,n),s.dtype==="int32"&&n.dtype==="int32")return uS(s,n);const r={a:s,b:n},i={};return W.runKernel(_d,r,i)}const nt=J({div_:MV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LV(t,e){let s=M(t,"a","mul"),n=M(e,"b","mul");[s,n]=fs(s,n);const r={a:s,b:n};return W.runKernel(Yd,r)}const V=J({mul_:LV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zV(t){const e=M(t,"x","abs");if(e.dtype==="complex64"){const s={x:e};return W.runKernel(tf,s)}else{const s={x:e};return W.runKernel(Kp,s)}}const ln=J({abs_:zV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BV(t){const s={x:M(t,"x","acos")};return W.runKernel(vd,s)}const UV=J({acos_:BV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VV(t){const s={x:M(t,"x","acosh")};return W.runKernel(Nd,s)}const WV=J({acosh_:VV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GV(t,e=null,s=!1){const r={x:M(t,"x","all","bool")},i={axis:e,keepDims:s};return W.runKernel(N0,r,i)}const hS=J({all_:GV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HV(t,e=null,s=!1){const r={x:M(t,"x","any","bool")},i={axis:e,keepDims:s};return W.runKernel(k0,r,i)}const Ib=J({any_:HV});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qV(t,e=0){const n={x:M(t,"x","argMax")},r={axis:e};return W.runKernel(Xp,n,r)}const wu=J({argMax_:qV});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KV(t,e=0){const n={x:M(t,"x","argMin")},r={axis:e};return W.runKernel(Yp,n,r)}const XV=J({argMin_:KV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YV(t){const s={x:M(t,"x","asin")};return W.runKernel(kd,s)}const ZV=J({asin_:YV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JV(t){const s={x:M(t,"x","asinh")};return W.runKernel(Cd,s)}const QV=J({asinh_:JV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eW(t){const s={x:M(t,"x","atan")};return W.runKernel(Sd,s)}const tW=J({atan_:eW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sW(t,e){let s=M(t,"a","atan2"),n=M(e,"b","atan2");[s,n]=fs(s,n);const r={a:s,b:n};return W.runKernel(Id,r)}const nW=J({atan2_:sW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rW(t){const s={x:M(t,"x","atanh")};return W.runKernel(jd,s)}const iW=J({atanh_:rW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vu(t,e,s,n,r="NHWC",i){const o=t[3],l=[...e,o],c=Ji(r);return Vs(t,l,s,i,n,null,null,c)}function hr(t,e,s,n,r,i,o="channelsLast"){const[l,c]=Nu(e);let d;if(o==="channelsLast")d=[l,c,t[3],t[3]];else if(o==="channelsFirst")d=[l,c,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return Vs(t,d,s,n,r,i,!1,o)}function Zi(t,e,s,n,r,i,o="NDHWC"){const[l,c,d]=$b(e);let u,h;if(o==="NDHWC")h="channelsLast",u=[l,c,d,t[4],t[4]];else if(o==="NCDHW")h="channelsFirst",u=[l,c,d,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return Ao(t,u,s,n,r,!1,h,i)}function Vs(t,e,s,n,r,i,o=!1,l="channelsLast"){let[c,d,u,h]=[-1,-1,-1,-1];if(l==="channelsLast")[c,d,u,h]=t;else if(l==="channelsFirst")[c,h,d,u]=t;else throw new Error(`Unknown dataFormat ${l}`);const[p,f,,m]=e,[b,g]=Nu(s),[x,y]=Nu(n),w=sc(p,x),v=sc(f,y),{padInfo:N,outHeight:C,outWidth:j}=lW(r,d,u,b,g,w,v,i,l),I=o?m*h:m;let T;return l==="channelsFirst"?T=[c,I,C,j]:l==="channelsLast"&&(T=[c,C,j,I]),{batchSize:c,dataFormat:l,inHeight:d,inWidth:u,inChannels:h,outHeight:C,outWidth:j,outChannels:I,padInfo:N,strideHeight:b,strideWidth:g,filterHeight:p,filterWidth:f,effectiveFilterHeight:w,effectiveFilterWidth:v,dilationHeight:x,dilationWidth:y,inShape:t,outShape:T,filterShape:e}}function Ao(t,e,s,n,r,i=!1,o="channelsLast",l){let[c,d,u,h,p]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[c,d,u,h,p]=t;else if(o==="channelsFirst")[c,p,d,u,h]=t;else throw new Error(`Unknown dataFormat ${o}`);const[f,m,b,,g]=e,[x,y,w]=$b(s),[v,N,C]=$b(n),j=sc(f,v),I=sc(m,N),T=sc(b,C),{padInfo:E,outDepth:$,outHeight:D,outWidth:P}=cW(r,d,u,h,x,y,w,j,I,T,l),_=i?g*p:g;let O;return o==="channelsFirst"?O=[c,_,$,D,P]:o==="channelsLast"&&(O=[c,$,D,P,_]),{batchSize:c,dataFormat:o,inDepth:d,inHeight:u,inWidth:h,inChannels:p,outDepth:$,outHeight:D,outWidth:P,outChannels:_,padInfo:E,strideDepth:x,strideHeight:y,strideWidth:w,filterDepth:f,filterHeight:m,filterWidth:b,effectiveFilterDepth:j,effectiveFilterHeight:I,effectiveFilterWidth:T,dilationDepth:v,dilationHeight:N,dilationWidth:C,inShape:t,outShape:O,filterShape:e}}function oW(t,e,s,n,r){n==null&&(n=Eb(t,e,s));const i=t[0],o=t[1],l=ku((i-e+2*n)/s+1,r),c=ku((o-e+2*n)/s+1,r);return[l,c]}function aW(t,e,s,n,r,i){r==null&&(r=Eb(t,e[0],n[0]));const o=[0,0,0,s];for(let l=0;l<3;l++)t[l]+2*r>=e[l]&&(o[l]=ku((t[l]-e[l]+2*r)/n[l]+1,i));return o}function Eb(t,e,s,n=1){const r=sc(e,n);return Math.floor((t[0]*(s-1)-s+r)/2)}function Nu(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function $b(t){return typeof t=="number"?[t,t,t]:t}function sc(t,e){return e<=1?t:t+(t-1)*(e-1)}function lW(t,e,s,n,r,i,o,l,c){let d,u,h;if(typeof t=="number"){d={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const f=oW([e,s],i,n,t,l);u=f[0],h=f[1]}else if(t==="same"){u=Math.ceil(e/n),h=Math.ceil(s/r);const p=Math.max(0,(u-1)*n+i-e),f=Math.max(0,(h-1)*r+o-s),m=Math.floor(p/2),b=p-m,g=Math.floor(f/2),x=f-g;d={top:m,bottom:b,left:g,right:x,type:"SAME"}}else if(t==="valid")d={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((e-i+1)/n),h=Math.ceil((s-o+1)/r);else if(typeof t=="object"){const p=c==="channelsLast"?t[1][0]:t[2][0],f=c==="channelsLast"?t[1][1]:t[2][1],m=c==="channelsLast"?t[2][0]:t[3][0],b=c==="channelsLast"?t[2][1]:t[3][1];d={top:p,bottom:f,left:m,right:b,type:p===0&&f===0&&m===0&&b===0?"VALID":"EXPLICIT"},u=ku((e-i+p+f)/n+1,l),h=ku((s-o+m+b)/r+1,l)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:d,outHeight:u,outWidth:h}}function cW(t,e,s,n,r,i,o,l,c,d,u){let h,p,f,m;if(t==="valid"&&(t=0),typeof t=="number"){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const g=aW([e,s,n,1],[l,c,d],1,[r,i,o],t,u);p=g[0],f=g[1],m=g[2]}else if(t==="same"){p=Math.ceil(e/r),f=Math.ceil(s/i),m=Math.ceil(n/o);const b=(p-1)*r+l-e,g=(f-1)*i+c-s,x=(m-1)*o+d-n,y=Math.floor(b/2),w=b-y,v=Math.floor(g/2),N=g-v,C=Math.floor(x/2),j=x-C;h={top:v,bottom:N,left:C,right:j,front:y,back:w,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:h,outDepth:p,outHeight:f,outWidth:m}}function ku(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function Ma(t){const[e,s,n]=Nu(t);return e===1&&s===1&&n===1}function Qs(t,e){return Ma(t)||Ma(e)}function La(t){return Nu(t).every(e=>e>0)}function Ji(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function vn(t,e,s){if(s!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${s} but got pad ${e}.`);if(typeof e=="number")A(Wl(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${s} but got pad ${e}.`);else if(typeof e=="object")e.forEach(n=>{n.forEach(r=>{A(Wl(r),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${s} but got pad ${r}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dW(t,e){const n={x:M(t,"x","reshape","string_or_numeric")},r={shape:e};return W.runKernel(Ff,n,r)}const Z=J({reshape_:dW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uW(t,e,s,n,r){const i=M(t,"x","avgPool","float32"),o=1;A(Qs(s,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${o}'`);let l=i,c=!1;i.rank===3&&(c=!0,l=Z(i,[1,i.shape[0],i.shape[1],i.shape[2]])),A(l.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${l.rank}.`),vn("avgPool",n,r);const d={x:l},u={filterSize:e,strides:s,pad:n,dimRoundingMode:r};let h=W.runKernel(Zp,d,u);return h=Be(h,i.dtype),c?Z(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Tb=J({avgPool_:uW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hW(t,e,s,n,r,i="NDHWC"){const o=M(t,"x","avgPool3d","float32");let l=o,c=!1;o.rank===4&&(c=!0,l=Z(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),A(l.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${l.rank}.`),A(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),A(typeof s=="number"&&s>0||Array.isArray(s)&&s[0]>0&&s[1]>0&&s[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${s}'`),vn("avgPool3d",n,r);const d={x:l},u={filterSize:e,strides:s,pad:n,dimRoundingMode:r,dataFormat:i};let h=W.runKernel(Jp,d,u);return h=Be(h,l.dtype),c?Z(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const pW=J({avgPool3d_:hW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fW(t,e=0){A(t.length>=1,()=>"Pass at least one tensor to concat");const s=JC(t,"tensors","concat","string_or_numeric");if(s[0].dtype==="complex64"&&s.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),s.length===1)return Oa(s[0]);const n=s,r={axis:e};return W.runKernel(sf,n,r)}const Nn=J({concat_:fW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mW(t,e,s=!1,n=!1){let r=M(t,"a","matMul"),i=M(e,"b","matMul");[r,i]=fs(r,i);const o={a:r,b:i},l={transposeA:s,transposeB:n};return W.runKernel(Qp,o,l)}const Ot=J({matMul_:mW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gW(t){const s={x:M(t,"x","sigmoid","float32")};return W.runKernel(au,s)}const nc=J({sigmoid_:gW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xW(t,e,s){const n=M(t,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");const r={x:n},i={begin:e,size:s};return W.runKernel(Bf,r,i)}const Qt=J({slice_:xW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bW(t){const s={x:M(t,"x","tanh","float32")};return W.runKernel(pu,s)}const om=J({tanh_:bW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yW(t,e,s){const n=M(t,"x","batchToSpaceND"),r=e.reduce((l,c)=>l*c);A(n.rank>=1+e.length,()=>`input rank is ${n.rank} but should be > than blockShape.length ${e.length}`),A(s.length===e.length,()=>`crops.length is ${s.length} but should be equal to blockShape.length  ${e.length}`),A(n.shape[0]%r===0,()=>`input tensor batch is ${n.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const i={x:n},o={blockShape:e,crops:s};return W.runKernel(ef,i,o)}const Ab=J({batchToSpaceND_:yW});function wW(t){let e;return t.rank===0||t.rank===1?e=Z(t,[1,1,1,t.size]):t.rank===2?e=Z(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=Z(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vW(t,e,s,n,r,i){i==null&&(i=.001);const o=M(t,"x","batchNorm"),l=M(e,"mean","batchNorm"),c=M(s,"variance","batchNorm");let d;r!=null&&(d=M(r,"scale","batchNorm"));let u;n!=null&&(u=M(n,"offset","batchNorm")),A(l.rank===c.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),A(u==null||l.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),A(d==null||l.rank===d.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const p={x:wW(o),scale:d,offset:u,mean:l,variance:c},f={varianceEpsilon:i},m=W.runKernel(hf,p,f);return Z(m,o.shape)}const am=J({batchNorm_:vW});function NW(t,e,s,n,r,i){const o=M(t,"x","batchNorm"),l=M(e,"mean","batchNorm"),c=M(s,"variance","batchNorm");let d;r!=null&&(d=M(r,"scale","batchNorm"));let u;return n!=null&&(u=M(n,"offset","batchNorm")),A(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),A(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${l.rank}.`),A(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${c.rank}.`),d!=null&&A(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${d.rank}.`),u!=null&&A(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),am(o,l,c,u,d,i)}const kW=J({batchNorm2d_:NW});function CW(t,e,s,n,r,i){const o=M(t,"x","batchNorm"),l=M(e,"mean","batchNorm"),c=M(s,"variance","batchNorm");let d;r!=null&&(d=M(r,"scale","batchNorm"));let u;return n!=null&&(u=M(n,"offset","batchNorm")),A(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),A(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${l.rank}.`),A(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${c.rank}.`),d!=null&&A(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${d.rank}.`),u!=null&&A(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),am(o,l,c,u,d,i)}const SW=J({batchNorm3d_:CW});function jW(t,e,s,n,r,i){const o=M(t,"x","batchNorm"),l=M(e,"mean","batchNorm"),c=M(s,"variance","batchNorm");let d;r!=null&&(d=M(r,"scale","batchNorm"));let u;return n!=null&&(u=M(n,"offset","batchNorm")),A(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),A(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${l.rank}.`),A(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${c.rank}.`),d!=null&&A(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${d.rank}.`),u!=null&&A(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),am(o,l,c,u,d,i)}const IW=J({batchNorm4d_:jW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EW(t,e,s){const n=M(t,"x","bincount"),r=M(e,"weights","bincount");A(n.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${n.dtype}`),A(s>=0,()=>`size must be non-negative, but got ${s}.`),A(r.size===n.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${n.shape}, weights shape: ${r.shape}.`);const i={x:n,weights:r},o={size:s};return W.runKernel(j0,i,o)}const $W=J({bincount_:EW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TW(t,e){let s=M(t,"broadcastTo","x");const n=s.shape;if(Xi(e),e.length<s.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${s.rank}.`);if(e.length>s.rank){const d=s.shape.slice();for(;d.length<e.length;)d.unshift(1);s=Z(s,d)}const r=s.shape,i=Array.from(e);for(let d=e.length-1;d>=0;d--)if(r[d]===e[d])i[d]=1;else if(s.shape[d]!==1)throw new Error(`broadcastTo(): [${n}] cannot be broadcast to [${e}].`);if(i.map((d,u)=>d>1?u:-1).filter(d=>d>=0).length===0)return Oa(s);const l={x:s},c={reps:i};return W.runKernel(fu,l,c)}const Cu=J({broadcastTo_:TW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AW(t){const s={x:M(t,"x","ceil","float32")};return W.runKernel($d,s)}const DW=J({ceil_:AW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lm(t,e,s){Xi(t),s=s||Hl(e);const n={shape:t,value:e,dtype:s};return W.runKernel(V0,{},n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _W(t,e,s){const n=M(t,"x","clipByValue");if(A(e<=s,()=>`Error in clip: min (${e}) must be less than or equal to max (${s}).`),e===s)return lm(n.shape,e,n.dtype);const r={x:n},i={clipValueMin:e,clipValueMax:s};return W.runKernel(Td,r,i)}const Hn=J({clipByValue_:_W});function RW(t){return Nn(t,0)}const PW=J({concat1d_:RW});function FW(t,e){return Nn(t,e)}const OW=J({concat2d_:FW});function MW(t,e){return Nn(t,e)}const LW=J({concat3d_:MW});function zW(t,e){return Nn(t,e)}const BW=J({concat4d_:zW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UW(t,e,s,n,r="NHWC",i=[1,1],o){const l=M(t,"x","conv2d","float32"),c=M(e,"filter","conv2d","float32");let d=l,u=!1;l.rank===3&&(u=!0,d=Z(l,[1,l.shape[0],l.shape[1],l.shape[2]])),A(d.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${d.rank}.`),A(c.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${c.rank}.`),vn("conv2d",n,o);const h=r==="NHWC"?d.shape[3]:d.shape[1];A(h===c.shape[2],()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${c.shape[2]}.`),A(Qs(s,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${s} and dilations '${i}'`),A(La(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),A(La(s),()=>"Error in conv2D: Strides should be larger than 0.");const p={x:d,filter:c},f={strides:s,pad:n,dataFormat:r,dilations:i,dimRoundingMode:o},m=W.runKernel(nf,p,f);return u?Z(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const za=J({conv2d_:UW});function VW(t,e,s,n,r="NWC",i=1,o){const l=M(t,"x","conv1d"),c=M(e,"filter","conv1d");let d=l,u=!1;l.rank===2&&(u=!0,d=Z(l,[1,l.shape[0],l.shape[1]])),A(d.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${d.rank}.`),A(c.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${c.rank}.`),vn("conv1d",n,o),A(d.shape[2]===c.shape[1],()=>`Error in conv1d: depth of input (${d.shape[2]}) must match input depth for filter ${c.shape[1]}.`),A(Qs(s,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${s} and dilation '${i}'`),A(La(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),A(La(s),()=>"Error in conv1D: Stride should be larger than 0."),A(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const h=Z(c,[1,c.shape[0],c.shape[1],c.shape[2]]),p=Z(d,[d.shape[0],1,d.shape[1],d.shape[2]]),g=za(p,h,[1,s],n,"NHWC",[1,i],o);return u?Z(g,[g.shape[2],g.shape[3]]):Z(g,[g.shape[0],g.shape[2],g.shape[3]])}const pS=J({conv1d_:VW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WW(t,e,s,n,r,i="NHWC",o){A(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let l=t,c=e,d=!1;e.rank===3&&(d=!0,c=Z(e,[1,e.shape[0],e.shape[1],e.shape[2]]),l=[1,t[0],t[1],t[2]]),A(l.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${l.length}.`),A(c.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${c.rank}`),A(s.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${s.rank}`);const u=i==="NHWC"?l[3]:l[1],h=i==="NHWC"?c.shape[3]:c.shape[1];A(u===s.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${s.shape[2]}.`),A(h===s.shape[3],()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${s.shape[3]}.`),vn("conv2dDerInput",r,o);const p={dy:c,filter:s},f={strides:n,pad:r,dataFormat:i,dimRoundingMode:o,inputShape:l},m=W.runKernel(rf,p,f);return d?Z(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const Db=J({conv2DBackpropInput_:WW});function GW(t,e,s,n,r,i){const o=M(t,"x","conv2dTranspose"),l=M(e,"filter","conv2dTranspose");return Db(s,o,l,n,r,"NHWC",i)}const fS=J({conv2dTranspose_:GW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HW(t,e,s,n,r="NDHWC",i=[1,1,1]){const o=M(t,"x","conv3d"),l=M(e,"filter","conv3d");let c=o,d=!1;o.rank===4&&(d=!0,c=Z(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),A(c.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${c.rank}.`),A(l.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${l.rank}.`),A(c.shape[4]===l.shape[3],()=>`Error in conv3d: depth of input (${c.shape[4]}) must match input depth for filter ${l.shape[3]}.`),A(Qs(s,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${s} and dilations '${i}'`),A(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),A(La(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),A(La(s),()=>"Error in conv3D: Strides should be larger than 0.");const u={x:c,filter:l},h={strides:s,pad:n,dataFormat:r,dilations:i},p=W.runKernel(of,u,h);return d?Z(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const qW=J({conv3d_:HW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KW(t,e,s,n,r){A(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let i=t,o=e,l=!1;e.rank===4&&(l=!0,o=Z(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,t[0],t[1],t[2],t[3]]);const c=i[4],d=o.shape[4];A(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),A(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),A(s.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${s.rank}`),A(c===s.shape[3],()=>`Error in conv3dDerInput: depth of input (${c}) must match input depth for filter ${s.shape[3]}.`),A(d===s.shape[4],()=>`Error in conv3dDerInput: depth of output (${d}) must match output depth for filter ${s.shape[4]}.`);const u={dy:o,filter:s},h={pad:r,strides:n,inputShape:i},p=W.runKernel(A0,u,h);return l?Z(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const mS=J({conv3DBackpropInput_:KW});function XW(t,e,s,n,r){const i=M(t,"x","conv3dTranspose"),o=M(e,"filter","conv3dTranspose");return mS(s,i,o,n,r)}const YW=J({conv3dTranspose_:XW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZW(t){const s={x:M(t,"x","cos","float32")};return W.runKernel(Ad,s)}const _b=J({cos_:ZW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JW(t){const s={x:M(t,"x","cosh","float32")};return W.runKernel(Dd,s)}const gS=J({cosh_:JW});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QW(t,e=0,s=!1,n=!1){const i={x:M(t,"x","cumprod")},o={axis:e,exclusive:s,reverse:n};return W.runKernel(D0,i,o)}const Rb=J({cumprod_:QW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eG(t,e=0,s=!1,n=!1){const i={x:M(t,"x","cumsum")},o={axis:e,exclusive:s,reverse:n};return W.runKernel(af,i,o)}const xS=J({cumsum_:eG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tG(t,e,s,n=!1){const r=M(t,"x","denseBincount"),i=M(e,"weights","denseBincount");A(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),A(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),A(s>=0,()=>`size must be non-negative, but got ${s}.`),A(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},l={size:s,binaryOutput:n};return W.runKernel(R0,o,l)}const bS=J({denseBincount_:tG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sG(t,e,s="NHWC"){const n=M(t,"x","depthToSpace","float32"),r=s==="NHWC"?n.shape[1]:n.shape[2],i=s==="NHWC"?n.shape[2]:n.shape[3],o=s==="NHWC"?n.shape[3]:n.shape[1];A(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),A(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${n.shape}`),A(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${n.shape}`),A(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${n.shape}`);const l={x:n},c={blockSize:e,dataFormat:s};return W.runKernel(P0,l,c)}const nG=J({depthToSpace_:sG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rG(t,e,s,n,r="NHWC",i=[1,1],o){const l=M(t,"x","depthwiseConv2d","float32"),c=M(e,"filter","depthwiseConv2d","float32");let d=l,u=!1;l.rank===3&&(u=!0,d=Z(l,[1,l.shape[0],l.shape[1],l.shape[2]])),A(d.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${d.rank}.`),A(c.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${c.rank}.`);const h=r==="NHWC"?d.shape[3]:d.shape[1];A(h===c.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${h}) must match the inChannels dimension in filter ${c.shape[2]}.`),vn("depthwiseConv2d",n,o);const p={x:d,filter:c},f={strides:s,pad:n,dataFormat:r,dilations:i,dimRoundingMode:o},m=W.runKernel(lf,p,f);return u?Z(m,[m.shape[1],m.shape[2],m.shape[3]]):m}const Pb=J({depthwiseConv2d_:rG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iG(t,e,s,n,r=[1,1],i="NHWC"){const o=M(t,"x","dilation2d"),l=M(e,"filter","dilation2d");A(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),A(l.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${l.rank}.`),A(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let c=o,d=!1;o.rank===3&&(c=Z(o,[1,o.shape[0],o.shape[1],o.shape[2]]),d=!0),A(c.shape[3]===l.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${c.shape[3]} vs ${l.shape[2]}`);const u={x:c,filter:l},h={strides:s,pad:n,dilations:r},p=W.runKernel(cf,u,h);return d?Z(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const oG=J({dilation2d_:iG});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rc(t,e){const s=t.length,n=[];for(let r=0;r<s;r++){const i=s-1-r,o=t[i]||1;(e[e.length-1-r]||1)>1&&o===1&&n.unshift(i)}return n}function Es(t,e){const s=[];for(let n=0;n<e.length;n++){const r=t[t.length-n-1],i=e.length-n-1,o=e[i];(r==null||r===1&&o>1)&&s.unshift(i)}return s}function ft(t,e){const s=Math.max(t.length,e.length),n=new Array(s);for(let r=0;r<s;r++){let i=t[t.length-r-1];i==null&&(i=1);let o=e[e.length-r-1];if(o==null&&(o=1),i===1)n[s-r-1]=o;else if(o===1)n[s-r-1]=i;else if(i!==o){const l=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(l)}else n[s-r-1]=i}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aG(t,e){let s=M(t,"a","equal","string_or_numeric"),n=M(e,"b","equal","string_or_numeric");[s,n]=fs(s,n),ft(s.shape,n.shape);const r={a:s,b:n};return W.runKernel(df,r)}const di=J({equal_:aG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lG(t,e,s){const n=M(e,"a","where"),r=M(s,"b","where"),i=M(t,"condition","where","bool"),o=ft(ft(i.shape,n.shape),r.shape),l=Cu(i,o),c=Cu(n,o),d=Cu(r,o),u={condition:l,t:c,e:d};return W.runKernel(zf,u)}const cn=J({where_:lG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cG(t){const s={x:M(t,"x","zerosLike")};return W.runKernel(Kf,s)}const $t=J({zerosLike_:cG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dG(t,e){let s=M(t,"a","div"),n=M(e,"b","div");[s,n]=fs(s,n);const r=nt(s,n),i=$t(r),o=di(n,i);return cn(o,i,r)}const uG=J({divNoNan_:dG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hG(t,e){const s=M(t,"t1","dot"),n=M(e,"t2","dot");A((s.rank===1||s.rank===2)&&(n.rank===1||n.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${s.rank} and ${n.rank}.`);const r=s.rank===1?s.size:s.shape[1],i=n.rank===1?n.size:n.shape[0];if(A(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),s.rank===1&&n.rank===1){const o=Z(s,[1,-1]),l=Z(n,[-1,1]),c=Ot(o,l);return Z(c,[])}else if(s.rank===1&&n.rank===2){const o=Z(s,[1,-1]),l=Z(n,[n.shape[0],n.shape[1]]),c=Ot(o,l);return Z(c,[c.size])}else if(s.rank===2&&n.rank===1){const o=Z(n,[-1,1]),l=Ot(s,o);return Z(l,[l.size])}else{const o=Z(n,[n.shape[0],n.shape[1]]);return Ot(s,o)}}const pG=J({dot_:hG});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fG(t,...e){const s=e.map((r,i)=>M(r,`tensors${i}`,"einsum")),n={equation:t};return W.runKernel(z0,s,n)}const Su=J({einsum_:fG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mG(t){const s={x:M(t,"x","elu","float32")};return W.runKernel(Rd,s)}const cm=J({elu_:mG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gG(t){let e=M(t,"x","erf");A(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Be(e,"float32"));const s={x:e};return W.runKernel(Pd,s)}const yS=J({erf_:gG});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fb(t,e){for(let s=0;s<t.length;++s)if(t[t.length-s-1]!==e-1-s)return!1;return!0}function wS(t,e,s){const n=t.length+e.length,r=[];let i=0,o=0;for(let l=0;l<n;l++)s.indexOf(l)===-1?r.push(t[i++]):r.push(e[o++]);return r}function Fs(t,e){const s=[],n=t.length;for(let i=0;i<n;i++)e.indexOf(i)===-1&&s.push(t[i]);const r=e.map(i=>t[i]);return[s,r]}function ks(t,e){const s=e.map(n=>1);return wS(t,s,e)}function Ws(t,e,s){A(Fb(e,s),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${s} input.`)}function cs(t,e){if(Fb(t,e))return null;const s=[];for(let n=0;n<e;++n)t.indexOf(n)===-1&&s.push(n);return t.forEach(n=>s.push(n)),s}function Do(t){return t.map((e,s)=>[s,e]).sort((e,s)=>e[1]-s[1]).map(e=>e[0])}function ms(t,e){const s=[];for(let n=e-t;n<e;++n)s.push(n);return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xG(t,e=null,s=!1){const r={x:M(t,"x","max")},i={reductionIndices:e,keepDims:s};return W.runKernel(Nf,r,i)}const Mr=J({max_:xG});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bG(t,e=null,s=!1){const r={x:M(t,"x","min")},i={axis:e,keepDims:s};return W.runKernel(jf,r,i)}const dm=J({min_:bG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yG(t,e){let s=M(t,"base","pow"),n=M(e,"exp","pow");[s,n]=fs(s,n);const r={a:s,b:n};return W.runKernel(Zd,r)}const Ba=J({pow_:yG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mt(t,e){if((ur(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&ur(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return rm(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wG(t){const s={x:M(t,"x","sqrt","float32")};return W.runKernel(cu,s)}const en=J({sqrt_:wG});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vG(t){const e=M(t,"x","square"),s={};return W.runKernel("Square",{x:e},s)}const rs=J({square_:vG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NG(t,e=null,s=!1){let n=M(t,"x","sum");n.dtype==="bool"&&(n=Be(n,"int32"));const r={x:n},i={axis:e,keepDims:s};return W.runKernel(Uf,r,i)}const st=J({sum_:NG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kG(t,e="euclidean",s=null,n=!1){t=M(t,"x","norm");const r=vS(t,e,s);let i=r.shape;if(n){const o=vt(s,t.shape);i=ks(r.shape,o)}return Z(r,i)}function vS(t,e,s=null){if(t.rank===0)return ln(t);if(t.rank!==1&&s===null)return vS(Z(t,[-1]),e,s);if(t.rank===1||typeof s=="number"||Array.isArray(s)&&s.length===1){if(e===1)return st(ln(t),s);if(e===1/0)return Mr(ln(t),s);if(e===-1/0)return dm(ln(t),s);if(e==="euclidean"||e===2)return en(st(Ba(ln(t),Mt(2,"int32")),s));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(s)&&s.length===2){if(e===1)return Mr(st(ln(t),s[0]),s[1]-1);if(e===1/0)return Mr(st(ln(t),s[1]),s[0]);if(e===-1/0)return dm(st(ln(t),s[1]),s[0]);if(e==="fro"||e==="euclidean")return en(st(rs(t),s));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${s}`)}const um=J({norm_:kG});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CG(t,e=null,s=!1){return um(t,"euclidean",e,s)}const SG=J({euclideanNorm_:CG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jG(t){const s={x:M(t,"x","exp")};return W.runKernel(Fd,s)}const ui=J({exp_:jG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IG(t,e=0){const s=M(t,"x","expandDims","string_or_numeric");A(e<=s.rank,()=>"Axis must be <= rank of the tensor");const n={input:s},r={dim:e};return W.runKernel(uf,n,r)}const kn=J({expandDims_:IG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EG(t){const s={x:M(t,"x","expm1")};return W.runKernel(Od,s)}const $G=J({expm1_:EG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TG(t,e){const s=M(t,"x","tile","string_or_numeric");A(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of reps ${e}.`);const n={x:s},r={reps:e};return W.runKernel(fu,n,r)}const Lr=J({tile_:TG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AG(t,e,s,n="float32"){e==null&&(e=t);const r=Nt([t,e],n),i=t<=e?t:e;for(let l=0;l<i;++l)r.set(1,l,l);const o=Z(r.toTensor(),[t,e]);if(s==null)return o;if(s.length===1)return Lr(kn(o,0),[s[0],1,1]);if(s.length===2)return Lr(kn(kn(o,0),0),[s[0],s[1],1,1]);if(s.length===3)return Lr(kn(kn(kn(o,0),0),0),[s[0],s[1],s[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${s.length}D.`)}const NS=J({eye_:AG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DG(t){const s={x:M(t,"x","floor","float32")};return W.runKernel(Md,s)}const hm=J({floor_:DG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _G(t,e,s=0,n=0){const r=M(t,"x","gather"),i=M(e,"indices","gather","int32"),o={x:r,indices:i},l={axis:s,batchDims:n};return W.runKernel(pf,o,l)}const Ob=J({gather_:_G});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RG(t,e){let s=M(t,"a","greater","string_or_numeric"),n=M(e,"b","greater","string_or_numeric");[s,n]=fs(s,n),ft(s.shape,n.shape);const r={a:s,b:n};return W.runKernel(ff,r)}const qn=J({greater_:RG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PG(t,e){let s=M(t,"a","greaterEqual","string_or_numeric"),n=M(e,"b","greaterEqual","string_or_numeric");[s,n]=fs(s,n),ft(s.shape,n.shape);const r={a:s,b:n};return W.runKernel(zd,r)}const Ua=J({greaterEqual_:PG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FG(t){const s={input:M(t,"input","imag")};return W.runKernel(H0,s)}const Mb=J({imag_:FG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OG(t){const s={x:M(t,"x","isFinite")};return W.runKernel(Ud,s)}const MG=J({isFinite_:OG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LG(t){const s={x:M(t,"x","isInf")};return W.runKernel(Vd,s)}const zG=J({isInf_:LG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BG(t){const s={x:M(t,"x","isNaN")};return W.runKernel(Wd,s)}const UG=J({isNaN_:BG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VG(t,e=.2){const n={x:M(t,"x","leakyRelu")},r={alpha:e};return W.runKernel(mf,n,r)}const Lb=J({leakyRelu_:VG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WG(t,e){let s=M(t,"a","less","string_or_numeric"),n=M(e,"b","less","string_or_numeric");[s,n]=fs(s,n),ft(s.shape,n.shape);const r={a:s,b:n};return W.runKernel(gf,r)}const pm=J({less_:WG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GG(t,e){let s=M(t,"a","lessEqual","string_or_numeric"),n=M(e,"b","lessEqual","string_or_numeric");[s,n]=fs(s,n),ft(s.shape,n.shape);const r={a:s,b:n};return W.runKernel(xf,r)}const ic=J({lessEqual_:GG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HG(t,e=5,s=1,n=1,r=.5){const i=M(t,"x","localResponseNormalization");A(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),A(Wl(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,l=!1;i.rank===3&&(l=!0,o=Z(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const c={x:o},d={depthRadius:e,bias:s,alpha:n,beta:r},u=W.runKernel(vf,c,d);return l?Z(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const qG=J({localResponseNormalization_:HG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KG(t){const s={x:M(t,"x","log","float32")};return W.runKernel(Gd,s)}const hi=J({log_:KG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XG(t){const s={x:M(t,"x","log1p")};return W.runKernel(Hd,s)}const kS=J({log1p_:XG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YG(t,e){A(m0(t),()=>"The f passed in variableGrads(f) must be a function"),A(e==null||Array.isArray(e)&&e.every(d=>d instanceof sm),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const s=e!=null;if(!s){e=[];for(const d in W.registeredVariables)e.push(W.registeredVariables[d])}const n=s?e.filter(d=>!d.trainable):null,r=e.length;e=e.filter(d=>d.trainable),A(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:o,grads:l}=W.gradients(t,e,null,i);A(l.some(d=>d!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),A(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const c={};return e.forEach((d,u)=>{l[u]!=null&&(c[d.name]=l[u])}),n?.forEach(d=>c[d.name]=null),{value:o,grads:c}}function oc(t){return W.customGrad(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZG(t){const s={x:M(t,"x","neg")};return W.runKernel(Ef,s)}const gs=J({neg_:ZG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JG(t){const s={x:M(t,"x","softplus")};return W.runKernel(lu,s)}const ju=J({softplus_:JG});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QG(t){const e=M(t,"x","logSigmoid");return oc(n=>({value:gs(ju(gs(n))),gradFunc:o=>V(o,nc(gs(n)))}))(e)}const eH=J({logSigmoid_:QG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tH(t,e){let s=M(t,"a","sub"),n=M(e,"b","sub");[s,n]=fs(s,n);const r={a:s,b:n};return W.runKernel(uu,r)}const lt=J({sub_:tH});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sH(t,e=-1){const s=M(t,"logits","logSoftmax");if(e===-1&&(e=s.rank-1),e!==s.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${s.rank} and axis was ${e}`);return oc((r,i)=>{const l=Mr(r,e,!0),c=lt(r,l),d=lt(Be(c,"float32"),hi(st(ui(c),e,!0)));return i([d]),{value:d,gradFunc:(h,p)=>{const[f]=p,m=!0,b=ui(f);return lt(h,V(st(h,e,m),b))}}})(s)}const CS=J({logSoftmax_:sH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nH(t,e=null,s=!1){const n=M(t,"x","logSumExp"),r=vt(e,n.shape),i=Mr(n,r,!0),o=lt(n,i),l=ui(o),c=st(l,r),d=hi(c),u=Te(Z(i,d.shape),d);if(s){const h=ks(u.shape,r);return Z(u,h)}return u}const SS=J({logSumExp_:nH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rH(t,e){const s=M(t,"a","logicalAnd","bool"),n=M(e,"b","logicalAnd","bool");ft(s.shape,n.shape);const r={a:s,b:n};return W.runKernel(bf,r)}const Qi=J({logicalAnd_:rH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iH(t){const s={x:M(t,"x","logicalNot","bool")};return W.runKernel(yf,s)}const zb=J({logicalNot_:iH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oH(t,e){const s=M(t,"a","logicalOr","bool"),n=M(e,"b","logicalOr","bool");ft(s.shape,n.shape);const r={a:s,b:n};return W.runKernel(wf,r)}const jS=J({logicalOr_:oH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aH(t,e){const s=M(t,"a","logicalXor","bool"),n=M(e,"b","logicalXor","bool");return ft(s.shape,n.shape),Qi(jS(t,e),zb(Qi(t,e)))}const lH=J({logicalXor_:aH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cH(t,e,s,n,r){const i=M(t,"x","maxPool"),o=1;let l=i,c=!1;i.rank===3&&(c=!0,l=Z(i,[1,i.shape[0],i.shape[1],i.shape[2]])),A(l.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${l.rank}.`),A(Qs(s,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${o}'`),vn("maxPool",n,r);const d={x:l},u={filterSize:e,strides:s,pad:n,dimRoundingMode:r},h=W.runKernel(kf,d,u);return c?Z(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Bb=J({maxPool_:cH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dH(t,e=[1,1,1],s,n,r,i="NDHWC"){const o=M(t,"x","maxPool3d");let l=o,c=!1;o.rank===4&&(c=!0,l=Z(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),A(l.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${l.rank}.`),A(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),vn("maxPool3d",n,r);const d={x:l},u={filterSize:e,strides:s,pad:n,dimRoundingMode:r,dataFormat:i},h=W.runKernel(Cf,d,u);return c?Z(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const uH=J({maxPool3d_:dH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hH(t,e){let s=M(t,"a","maximum"),n=M(e,"b","maximum");[s,n]=fs(s,n),s.dtype==="bool"&&(s=Be(s,"int32"),n=Be(n,"int32")),ft(s.shape,n.shape);const r={a:s,b:n};return W.runKernel(qd,r)}const _o=J({maximum_:hH});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pH(t,e=null,s=!1){const r={x:M(t,"x","mean")},i={axis:e,keepDims:s};return W.runKernel(Sf,r,i)}const Cs=J({mean_:pH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Os(t,e="float32"){if(Xi(t),e==="complex64"){const n=Os(t,"float32"),r=Os(t,"float32");return _a(n,r)}const s=Js(pe(t),e);return W.makeTensor(s,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ro(t,e="float32"){if(Xi(t),e==="complex64"){const n=Ro(t,"float32"),r=Os(t,"float32");return _a(n,r)}const s=x0(pe(t),e);return W.makeTensor(s,t,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fH(t,e){let s=M(t,"a","minimum"),n=M(e,"b","minimum");[s,n]=fs(s,n),s.dtype==="bool"&&(s=Be(s,"int32"),n=Be(n,"int32")),ft(s.shape,n.shape);const r={a:s,b:n};return W.runKernel(Kd,r)}const Iu=J({minimum_:fH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mH(t,e,s){A(s==="reflect"||s==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${s}.`);const n=M(t,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");A(e.length===n.rank,()=>`Padding doesn't match input. Must be ${n.rank}. Got ${e.length}.`);const r=s==="reflect"?1:0;for(let l=0;l<n.rank;l++)A(e[l].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),A(e[l][0]>=0&&e[l][0]<=n.shape[l]-r&&e[l][1]>=0&&e[l][1]<=n.shape[l]-r,()=>`Padding in dimension ${l} cannot be greater than or equal to ${n.shape[l]-r} or less than 0 for input of shape ${n.shape}`);const i={paddings:e,mode:s},o={x:n};return W.runKernel(If,o,i)}const gH=J({mirrorPad_:mH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xH(t,e){let s=M(t,"a","mod"),n=M(e,"b","mod");[s,n]=fs(s,n);const r={a:s,b:n};return W.runKernel(Xd,r)}const bH=J({mod_:xH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yH(t,e=null,s=!1){t=M(t,"x","moments");const n=vt(e,t.shape),r=Cs(t,n,s);let i=r.shape;s||(i=ks(r.shape,n));const o=rs(lt(Be(t,"float32"),Z(r,i))),l=Cs(o,n,s);return{mean:r,variance:l}}const Ub=J({moments_:yH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wH(t,e){let s=M(t,"a","notEqual","string_or_numeric"),n=M(e,"b","notEqual","string_or_numeric");[s,n]=fs(s,n),ft(s.shape,n.shape);const r={a:s,b:n};return W.runKernel($f,r)}const fm=J({notEqual_:wH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vH(t,e,s=1,n=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:M(t,"indices","oneHot","int32")},l={dtype:r,depth:e,onValue:s,offValue:n};return W.runKernel(Af,o,l)}const IS=J({oneHot_:vH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NH(t){const s={x:M(t,"x","onesLike")};return W.runKernel(Tf,s)}const pr=J({onesLike_:NH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kH(t,e,s=0){const n=M(t,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:s},i={x:n};return W.runKernel(_f,i,r)}const Vb=J({pad_:kH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CH(t,e,s){const n=M(t,"x","spaceToBatchND");A(n.rank>=1+e.length,()=>`input rank ${n.rank} should be > than [blockShape] ${e.length}`),A(s.length===e.length,()=>`paddings.shape[0] ${s.length} must be equal to [blockShape] ${e.length}`),A(n.shape.reduce((o,l,c)=>c>0&&c<=e.length?o&&(l+s[c-1][0]+s[c-1][1])%e[c-1]===0:o,!0),()=>`input spatial dimensions ${n.shape.slice(1)} with paddings ${s.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:n},i={blockShape:e,paddings:s};return W.runKernel(Vf,r,i)}const Wb=J({spaceToBatchND_:CH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SH(t,e,s,n,r,i,o){r==null&&(r=[1,1]),i==null&&(i=1),n===0&&(n="valid");const l=M(t,"x","maxPool");let c=l,d=!1;l.rank===3&&(d=!0,c=Z(l,[1,l.shape[0],l.shape[1],l.shape[2]])),A(Qs(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const u=hr(c.shape,e,i,r,n),h=[u.dilationHeight,u.dilationWidth];let p;n==="same"?p=IH([u.filterHeight,u.filterWidth],h):p=[[0,0],[0,0]];const f=h[0]===1&&h[1]===1,[m,b]=jH([u.inHeight,u.inWidth],h,p),g=f?n:"valid",x=f?c:Wb(c,h,m),w=(s==="avg"?()=>Tb(x,e,i,g,o):()=>Bb(x,e,i,g,o))(),v=f?w:Ab(w,h,b);return d?Z(v,[v.shape[1],v.shape[2],v.shape[3]]):v}function jH(t,e,s){const n=s.map(u=>u[0]),r=s.map(u=>u[1]),i=t.concat(n,r),o=e.map((u,h)=>(u-i[h]%u)%u),l=r.map((u,h)=>u+o[h]),c=e.map((u,h)=>[n[h],l[h]]),d=e.map((u,h)=>[0,o[h]]);return[c,d]}function IH(t,e){const n=t.map((o,l)=>o+(o-1)*(e[l]-1)).map(o=>o-1),r=n.map(o=>Math.floor(o/2)),i=n.map((o,l)=>o-r[l]);return n.map((o,l)=>[r[l],i[l]])}const EH=J({pool_:SH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $H(t,e){const s=M(t,"x","prelu"),n=M(e,"alpha","prelu"),r={x:s,alpha:n};return W.runKernel(Rf,r)}const Gb=J({prelu_:$H});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TH(t,e=null,s=!1){let n=M(t,"x","prod");n.dtype==="bool"&&(n=Be(n,"int32"));const r={x:n},i={axis:e,keepDims:s};return W.runKernel(Pf,r,i)}const AH=J({prod_:TH});var Hb={exports:{}};Hb.exports,function(t){(function(e,s,n){function r(c){var d=this,u=l();d.next=function(){var h=2091639*d.s0+d.c*23283064365386963e-26;return d.s0=d.s1,d.s1=d.s2,d.s2=h-(d.c=h|0)},d.c=1,d.s0=u(" "),d.s1=u(" "),d.s2=u(" "),d.s0-=u(c),d.s0<0&&(d.s0+=1),d.s1-=u(c),d.s1<0&&(d.s1+=1),d.s2-=u(c),d.s2<0&&(d.s2+=1),u=null}function i(c,d){return d.c=c.c,d.s0=c.s0,d.s1=c.s1,d.s2=c.s2,d}function o(c,d){var u=new r(c),h=d&&d.state,p=u.next;return p.int32=function(){return u.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,h&&(typeof h=="object"&&i(h,u),p.state=function(){return i(u,{})}),p}function l(){var c=4022871197,d=function(u){u=String(u);for(var h=0;h<u.length;h++){c+=u.charCodeAt(h);var p=.02519603282416938*c;c=p>>>0,p-=c,p*=c,c=p>>>0,p-=c,c+=p*4294967296}return(c>>>0)*23283064365386963e-26};return d}s&&s.exports?s.exports=o:this.alea=o})(na,t)}(Hb);var DH=Hb.exports,qb={exports:{}};qb.exports,function(t){(function(e,s,n){function r(l){var c=this,d="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var h=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^h^h>>>8},l===(l|0)?c.x=l:d+=l;for(var u=0;u<d.length+64;u++)c.x^=d.charCodeAt(u)|0,c.next()}function i(l,c){return c.x=l.x,c.y=l.y,c.z=l.z,c.w=l.w,c}function o(l,c){var d=new r(l),u=c&&c.state,h=function(){return(d.next()>>>0)/4294967296};return h.double=function(){do var p=d.next()>>>11,f=(d.next()>>>0)/4294967296,m=(p+f)/(1<<21);while(m===0);return m},h.int32=d.next,h.quick=h,u&&(typeof u=="object"&&i(u,d),h.state=function(){return i(d,{})}),h}s&&s.exports?s.exports=o:this.xor128=o})(na,t)}(qb);var _H=qb.exports,Kb={exports:{}};Kb.exports,function(t){(function(e,s,n){function r(l){var c=this,d="";c.next=function(){var h=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(h^h<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,l===(l|0)?c.x=l:d+=l;for(var u=0;u<d.length+64;u++)c.x^=d.charCodeAt(u)|0,u==d.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function i(l,c){return c.x=l.x,c.y=l.y,c.z=l.z,c.w=l.w,c.v=l.v,c.d=l.d,c}function o(l,c){var d=new r(l),u=c&&c.state,h=function(){return(d.next()>>>0)/4294967296};return h.double=function(){do var p=d.next()>>>11,f=(d.next()>>>0)/4294967296,m=(p+f)/(1<<21);while(m===0);return m},h.int32=d.next,h.quick=h,u&&(typeof u=="object"&&i(u,d),h.state=function(){return i(d,{})}),h}s&&s.exports?s.exports=o:this.xorwow=o})(na,t)}(Kb);var RH=Kb.exports,Xb={exports:{}};Xb.exports,function(t){(function(e,s,n){function r(l){var c=this;c.next=function(){var u=c.x,h=c.i,p,f;return p=u[h],p^=p>>>7,f=p^p<<24,p=u[h+1&7],f^=p^p>>>10,p=u[h+3&7],f^=p^p>>>3,p=u[h+4&7],f^=p^p<<7,p=u[h+7&7],p=p^p<<13,f^=p^p<<9,u[h]=f,c.i=h+1&7,f};function d(u,h){var p,f=[];if(h===(h|0))f[0]=h;else for(h=""+h,p=0;p<h.length;++p)f[p&7]=f[p&7]<<15^h.charCodeAt(p)+f[p+1&7]<<13;for(;f.length<8;)f.push(0);for(p=0;p<8&&f[p]===0;++p);for(p==8?f[7]=-1:f[p],u.x=f,u.i=0,p=256;p>0;--p)u.next()}d(c,l)}function i(l,c){return c.x=l.x.slice(),c.i=l.i,c}function o(l,c){l==null&&(l=+new Date);var d=new r(l),u=c&&c.state,h=function(){return(d.next()>>>0)/4294967296};return h.double=function(){do var p=d.next()>>>11,f=(d.next()>>>0)/4294967296,m=(p+f)/(1<<21);while(m===0);return m},h.int32=d.next,h.quick=h,u&&(u.x&&i(u,d),h.state=function(){return i(d,{})}),h}s&&s.exports?s.exports=o:this.xorshift7=o})(na,t)}(Xb);var PH=Xb.exports,Yb={exports:{}};Yb.exports,function(t){(function(e,s,n){function r(l){var c=this;c.next=function(){var u=c.w,h=c.X,p=c.i,f,m;return c.w=u=u+1640531527|0,m=h[p+34&127],f=h[p=p+1&127],m^=m<<13,f^=f<<17,m^=m>>>15,f^=f>>>12,m=h[p]=m^f,c.i=p,m+(u^u>>>16)|0};function d(u,h){var p,f,m,b,g,x=[],y=128;for(h===(h|0)?(f=h,h=null):(h=h+"\0",f=0,y=Math.max(y,h.length)),m=0,b=-32;b<y;++b)h&&(f^=h.charCodeAt((b+32)%h.length)),b===0&&(g=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,b>=0&&(g=g+1640531527|0,p=x[b&127]^=f+g,m=p==0?m+1:0);for(m>=128&&(x[(h&&h.length||0)&127]=-1),m=127,b=4*128;b>0;--b)f=x[m+34&127],p=x[m=m+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,x[m]=f^p;u.w=g,u.X=x,u.i=m}d(c,l)}function i(l,c){return c.i=l.i,c.w=l.w,c.X=l.X.slice(),c}function o(l,c){l==null&&(l=+new Date);var d=new r(l),u=c&&c.state,h=function(){return(d.next()>>>0)/4294967296};return h.double=function(){do var p=d.next()>>>11,f=(d.next()>>>0)/4294967296,m=(p+f)/(1<<21);while(m===0);return m},h.int32=d.next,h.quick=h,u&&(u.X&&i(u,d),h.state=function(){return i(d,{})}),h}s&&s.exports?s.exports=o:this.xor4096=o})(na,t)}(Yb);var FH=Yb.exports,Zb={exports:{}};Zb.exports,function(t){(function(e,s,n){function r(l){var c=this,d="";c.next=function(){var h=c.b,p=c.c,f=c.d,m=c.a;return h=h<<25^h>>>7^p,p=p-f|0,f=f<<24^f>>>8^m,m=m-h|0,c.b=h=h<<20^h>>>12^p,c.c=p=p-f|0,c.d=f<<16^p>>>16^m,c.a=m-h|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,l===Math.floor(l)?(c.a=l/4294967296|0,c.b=l|0):d+=l;for(var u=0;u<d.length+20;u++)c.b^=d.charCodeAt(u)|0,c.next()}function i(l,c){return c.a=l.a,c.b=l.b,c.c=l.c,c.d=l.d,c}function o(l,c){var d=new r(l),u=c&&c.state,h=function(){return(d.next()>>>0)/4294967296};return h.double=function(){do var p=d.next()>>>11,f=(d.next()>>>0)/4294967296,m=(p+f)/(1<<21);while(m===0);return m},h.int32=d.next,h.quick=h,u&&(typeof u=="object"&&i(u,d),h.state=function(){return i(d,{})}),h}s&&s.exports?s.exports=o:this.tychei=o})(na,t)}(Zb);var OH=Zb.exports,ES={exports:{}};const MH=FR(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));(function(t){(function(e,s,n){var r=256,i=6,o=52,l="random",c=n.pow(r,i),d=n.pow(2,o),u=d*2,h=r-1,p;function f(v,N,C){var j=[];N=N==!0?{entropy:!0}:N||{};var I=x(g(N.entropy?[v,w(s)]:v??y(),3),j),T=new m(j),E=function(){for(var $=T.g(i),D=c,P=0;$<d;)$=($+P)*r,D*=r,P=T.g(1);for(;$>=u;)$/=2,D/=2,P>>>=1;return($+P)/D};return E.int32=function(){return T.g(4)|0},E.quick=function(){return T.g(4)/4294967296},E.double=E,x(w(T.S),s),(N.pass||C||function($,D,P,_){return _&&(_.S&&b(_,T),$.state=function(){return b(T,{})}),P?(n[l]=$,D):$})(E,I,"global"in N?N.global:this==n,N.state)}function m(v){var N,C=v.length,j=this,I=0,T=j.i=j.j=0,E=j.S=[];for(C||(v=[C++]);I<r;)E[I]=I++;for(I=0;I<r;I++)E[I]=E[T=h&T+v[I%C]+(N=E[I])],E[T]=N;(j.g=function($){for(var D,P=0,_=j.i,O=j.j,R=j.S;$--;)D=R[_=h&_+1],P=P*r+R[h&(R[_]=R[O=h&O+D])+(R[O]=D)];return j.i=_,j.j=O,P})(r)}function b(v,N){return N.i=v.i,N.j=v.j,N.S=v.S.slice(),N}function g(v,N){var C=[],j=typeof v,I;if(N&&j=="object")for(I in v)try{C.push(g(v[I],N-1))}catch{}return C.length?C:j=="string"?v:v+"\0"}function x(v,N){for(var C=v+"",j,I=0;I<C.length;)N[h&I]=h&(j^=N[h&I]*19)+C.charCodeAt(I++);return w(N)}function y(){try{var v;return p&&(v=p.randomBytes)?v=v(r):(v=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(v)),w(v)}catch{var N=e.navigator,C=N&&N.plugins;return[+new Date,e,C,e.screen,w(s)]}}function w(v){return String.fromCharCode.apply(0,v)}if(x(n.random(),s),t.exports){t.exports=f;try{p=MH}catch{}}else n["seed"+l]=f})(typeof self<"u"?self:na,[],Math)})(ES);var LH=ES.exports,zH=DH,BH=_H,UH=RH,VH=PH,WH=FH,GH=OH,Va=LH;Va.alea=zH,Va.xor128=BH,Va.xorwow=UH,Va.xorshift7=VH,Va.xor4096=WH,Va.tychei=GH;var Jb=Va;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $S{constructor(e,s,n,r,i){this.mean=e,this.stdDev=s,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=Jb.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,s,n=!1;for(;!n;){let r,i,o;do r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i;while(o>=1||o===0);const l=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*r*l,s=this.mean+this.stdDev*i*l,(!this.truncated||this.isValidTruncated(e))&&(n=!0)}return(!this.truncated||this.isValidTruncated(s))&&(this.nextVal=this.convertValue(s)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class HH{constructor(e=0,s=1,n,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=s-e,this.dtype=n,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${s} <= 1 and dtype is not float`);this.random=Jb.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qH(t,e=0,s=1,n,r){if(Xi(t),n!=null&&n==="bool")throw new Error(`Unsupported data type ${n}`);const i=new $S(e,s,n,!1,r),o=Nt(t,n);for(let l=0;l<o.values.length;l++)o.values[l]=i.nextValue();return o.toTensor()}const KH=J({randomNormal_:qH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XH(t,e=0,s=1,n="float32",r){Xi(t);const i=Nt(t,n),o=new HH(e,s,null,r);for(let l=0;l<i.values.length;l++)i.values[l]=o.nextValue();return i.toTensor()}const Eu=J({randomUniform_:XH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $u(t,e,s=1,n="float32"){if(s===0)throw new Error("Cannot have a step of zero");const r={start:t,stop:e,step:s,dtype:n};return W.runKernel(Q0,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YH(t){const s={input:M(t,"input","real")};return W.runKernel(eb,s)}const mm=J({real_:YH});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZH(t){const s={x:M(t,"x","reciprocal")};return W.runKernel(Jd,s)}const JH=J({reciprocal_:ZH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QH(t){const s={x:M(t,"x","relu")};return W.runKernel(Qd,s)}const Wa=J({relu_:QH});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e7(t){const s={x:M(t,"x","relu6")};return W.runKernel(eu,s)}const TS=J({relu6_:e7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t7(t,e){const n={x:M(t,"x","reverse")},r={dims:e};return W.runKernel(Lf,n,r)}const Ga=J({reverse_:t7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s7(t){const s={x:M(t,"x","round")};return W.runKernel(tu,s)}const AS=J({round_:s7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n7(t){const s={x:M(t,"x","rsqrt","float32")};return W.runKernel(su,s)}const DS=J({rsqrt_:n7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r7(t){const s={x:M(t,"x","selu")};return W.runKernel(nu,s)}const _S=J({selu_:r7});function i7(t,e,s,n,r,i=[1,1],o="NHWC"){const l=M(t,"x","separableConv2d"),c=M(e,"depthwiseFilter","separableConv2d"),d=M(s,"pointwiseFilter","separableConv2d");let u=l,h=!1;if(l.rank===3&&(h=!0,u=Z(l,[1,l.shape[0],l.shape[1],l.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");A(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),A(c.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${c.rank}.`),A(d.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${c.rank}.`),A(d.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${d.shape[0]}.`),A(d.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${d.shape[1]}.`);const p=c.shape[2],f=c.shape[3];A(d.shape[2]===p*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*f}, but got ${d.shape[2]}.`);const m=Pb(u,c,n,r,o,i),g=za(m,d,1,"valid",o);return h?Z(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const RS=J({separableConv2d_:i7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o7(t){const s={x:M(t,"x","sign")};return W.runKernel(ou,s)}const a7=J({sign_:o7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l7(t){const s={x:M(t,"x","sin","float32")};return W.runKernel(ru,s)}const PS=J({sin_:l7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c7(t){const s={x:M(t,"x","sinh")};return W.runKernel(iu,s)}const FS=J({sinh_:c7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d7(t,e,s){const n=M(t,"x","slice1d");return A(n.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${n.rank} tensor`),Qt(n,[e],[s])}const Qb=J({slice1d_:d7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u7(t,e,s){const n=M(t,"x","slice2d");return A(n.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${n.rank} tensor`),Qt(n,e,s)}const OS=J({slice2d_:u7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h7(t,e,s){const n=M(t,"x","slice3d");return A(n.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${n.rank} tensor`),Qt(n,e,s)}const ey=J({slice3d_:h7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p7(t,e,s){const n=M(t,"x","slice4d");return A(n.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${n.rank} tensor`),Qt(n,e,s)}const gm=J({slice4d_:p7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f7(t,e=-1){const s=M(t,"logits","softmax","float32");if(e===-1&&(e=s.rank-1),e!==s.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${s.rank} and dim was ${e}`);const n={logits:s},r={dim:e};return W.runKernel(Gf,n,r)}const ty=J({softmax_:f7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m7(t){A(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return W.runKernel(U0,e)}const MS=J({fft_:m7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g7(t){A(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return W.runKernel(G0,e)}const sy=J({ifft_:g7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x7(t){const e=t.shape[t.shape.length-1],s=t.size/e;let n;if(e<=2){const r=Z(t,[s,e]);n=sy(r)}else{const r=[s,2*(e-1)],i=Z(mm(t),[s,e]),o=Z(Mb(t),[s,e]),l=Ga(Qt(i,[0,1],[s,e-2]),1),c=V(Ga(Qt(o,[0,1],[s,e-2]),1),Mt(-1)),d=Nn([i,l],1),u=Nn([o,c],1),h=Z(_a(d,u),[r[0],r[1]]);n=sy(h)}if(n=mm(n),t.rank===3&&t.shape[0]!==0){const r=n,i=t.shape[0];n=Z(n,[i,n.shape[0]/i,n.shape[1]]),r.dispose()}return n}const b7=J({irfft_:x7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y7(t,e,s=0){const r={x:M(t,"x","split")},i={numOrSizeSplits:e,axis:s};return W.runKernel(Wf,r,i)}const Kn=J({split_:y7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w7(t,e){A(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let s=t.shape[t.shape.length-1];const n=t.size/s;let r;if(e!=null&&e<s){const m=t.shape.map(g=>0),b=t.shape.map(g=>g);b[t.shape.length-1]=e,r=Qt(t,m,b),s=e}else if(e!=null&&e>s){const m=t.shape.map(b=>b);m[t.shape.length-1]=e-s,r=Nn([t,Os(m)],t.shape.length-1),s=e}else r=t;const i=$t(r),o=Z(_a(r,i),[n,s]),l=MS(o),c=Math.floor(s/2)+1,d=mm(l),u=Mb(l),h=Kn(d,[c,s-c],d.shape.length-1),p=Kn(u,[c,s-c],u.shape.length-1),f=r.shape.slice();return f[r.shape.length-1]=c,Z(_a(h[0],p[0]),f)}const v7=J({rfft_:w7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N7(t,e){let s=M(t,"a","squaredDifference"),n=M(e,"b","squaredDifference");[s,n]=fs(s,n),ft(s.shape,n.shape);const r={a:s,b:n},i={};return W.runKernel(du,r,i)}const k7=J({squaredDifference_:N7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C7(t,e){const s=M(t,"x","squeeze","string_or_numeric");return Z(s,Co(s.shape,e).newShape)}const Tu=J({squeeze_:C7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S7(t,e=0){const s=JC(t,"tensors","stack","string_or_numeric");A(s.length>=1,()=>"Pass at least one tensor to tf.stack"),s.length>0&&A(e<=s[0].rank,()=>"Axis must be <= rank of the tensor");const n=s,r={axis:e};return W.runKernel(Df,n,r)}const eo=J({stack_:S7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j7(t,e=0){const n={x:M(t,"x","step")},r={alpha:e};return W.runKernel(mu,n,r)}const Au=J({step_:j7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I7(t,e,s,n,r=0,i=0,o=0,l=0,c=0){const u={x:M(t,"x","stridedSlice","string_or_numeric")},h={begin:e,end:s,strides:n,beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:l,shrinkAxisMask:c};return W.runKernel(ib,u,h)}const E7=J({stridedSlice_:I7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $7(t){const s={x:M(t,"x","tan","float32")};return W.runKernel(hu,s)}const T7=J({tan_:$7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pn(t,e){Vk(t);const s=nm(t,e);if(s.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return rm(t,null,s,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ny(t,e,s){if(Vk(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const n=nm(t,s);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return rm(t,e,n,s)}function LS(t,e,s){const n=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${s.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${n}, and batchDim: ${r}.`;if(s.rank<r)throw new Error(i+` update.rank < ${r}. `);if(t.length<n+(s.rank-r))throw new Error(i+` Output shape length < ${n+(s.rank-r)}`);if(s.rank!==r+t.length-n)throw new Error(i+` update.rank != ${r+t.length-n}`);for(let o=0;o<r;++o)if(s.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${s.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<s.rank-r;++o)if(s.shape[o+r]!==t[o+n])throw new Error(i+` updates.shape[${o+r}] (${s.shape[o+r]}) != shape[${o+r}] (${t[o+r]})`)}function A7(t,e,s){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(s.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${s}`);if(s.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}LS(s,e,t)}function Ha(t,e,s){const n=e.shape.length,r=n>1?e.shape[n-1]:1,i=s.length;let o=1;for(let h=r;h<i;++h)o*=s[h];const l=r<1?1:r,c=pe(e.shape)/l,d=[...tt(s.slice(0,r)),1],u=pe(s);return{sliceRank:r,numUpdates:c,sliceSize:o,strides:d,outputSize:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D7(t,e=1,s=!0){const n=M(t,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=n.shape[n.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const i={x:n},o={k:e,sorted:s},[l,c]=W.runKernel(ob,i,o);return{values:l,indices:c}}const _7=J({topk_:D7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R7(t,e=0,s=1,n,r){if(Xi(t),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new $S(e,s,n,!0,r),o=Nt(t,n);for(let l=0;l<o.values.length;l++)o.values[l]=i.nextValue();return o.toTensor()}const zS=J({truncatedNormal_:R7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P7(t,e=0){const s=M(t,"x","unique","string_or_numeric");A(s.rank>0,()=>"The input tensor must be at least 1D");const n={x:s},r={axis:e},[i,o]=W.runKernel(lb,n,r);return{values:i,indices:o}}const F7=J({unique_:P7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O7(t,e,s){const n=M(t,"x","unsortedSegmentSum"),r=M(e,"segmentIds","unsortedSegmentSum","int32");A(Wl(s),()=>"numSegments must be of dtype int");const i={x:n,segmentIds:r},o={numSegments:s};return W.runKernel(qf,i,o)}const BS=J({unsortedSegmentSum_:O7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M7(t,e=0){const s=M(t,"x","unstack","string_or_numeric");A(e>=-s.shape.length&&e<s.shape.length,()=>`Axis = ${e} is not in [-${s.shape.length}, ${s.shape.length})`);const n={value:s},r={axis:e};return W.runKernel(Hf,n,r)}const qa=J({unstack_:M7});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L7(t,e=!0,s,n){return W.makeVariable(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function US(t,e){const s=[];for(let i=0;i<e.length;i++)e[i]&&s.push(i);const n=Nt(t,"int32"),r=Nt([s.length,t.length],"int32");for(let i=0;i<s.length;i++){const o=n.indexToLoc(s[i]),l=i*t.length;r.values.set(o,l)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z7(t,e,s){const n=M(t,"x","transpose");if(e==null&&(e=n.shape.map((o,l)=>l).reverse()),A(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${e}.`),e.forEach(o=>{A(o>=0&&o<n.rank,()=>`All entries in 'perm' must be between 0 and ${n.rank-1} but got ${e}`)}),n.rank<=1)return n.clone();const r={x:n},i={perm:e};return n.dtype==="complex64"?ne(()=>{let o=mm(n),l=Mb(n);return o=W.runKernel(Xl,{x:o},i),l=W.runKernel(Xl,{x:l},i),s&&(l=gs(l)),_a(o,l)}):W.runKernel(Xl,r,i)}const Tt=J({transpose_:z7});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B7(t,e){if(e==null)return t.shape.slice();if(Ft(t.shape,e))return e;if(t.shape.length===e.length){const s=[];for(let n=0;n<t.shape.length;n++)e[n]==null&&t.shape[n]!=null?s.push(t.shape[n]):s.push(e[n]);return s}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U7(t,e,s,n){const r=M(t,"x","dropout");if(A(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),A(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof Is?r.clone():r;const i=B7(r,s),o=1-e,l=nt(hm(Te(Eu(i,0,1,"float32",n),o)),o);return V(r,l)}const V7=J({dropout_:U7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W7(t,e,s,n,r,i="NHWC",o){let l=t;t.rank===3&&(l=Z(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let c=e;c.rank===3&&(c=Z(e,[1,e.shape[0],e.shape[1],e.shape[2]])),A(l.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${l.shape}.`),A(c.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${c.shape}.`),A(s.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${s}.`);const d=i==="NHWC"?l.shape[3]:l.shape[1],u=i==="NHWC"?c.shape[3]:c.shape[1];A(d===s[2],()=>`Error in conv2dDerFilter: depth of input ${d}) must match input depth in filter (${s[2]}.`),A(u===s[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${s[3]}).`),vn("conv2dDerFilter",r,o);const h={x:l,dy:c},p={strides:n,pad:r,dataFormat:i,dimRoundingMode:o,filterShape:s};return W.runKernel($0,h,p)}const ry=J({conv2DBackpropFilter_:W7});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iy(t,e,s){if(s==null||s==="linear")return t;if(s==="relu")return V(t,Au(e));throw new Error(`Cannot compute gradient for fused activation ${s}.`)}function oy(t,e){let s=e;const n=Es(t.shape,e.shape);return n.length>0&&(s=st(s,n)),Z(s,t.shape)}function ay(t,e,s,n){if(e==="linear")return t;if(e==="relu")return Wa(t);if(e==="elu")return cm(t);if(e==="relu6")return TS(t);if(e==="prelu")return Gb(t,s);if(e==="leakyrelu")return Lb(t,n);if(e==="sigmoid")return nc(t);throw new Error(`Unknown fused activation ${e}.`)}const ly=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G7({x:t,filter:e,strides:s,pad:n,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:l,activation:c="linear",preluActivationWeights:d,leakyreluAlpha:u}){if(c=c||"linear",ly(W.state.gradientDepth,c)===!1){A(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let C=za(t,e,s,n,r,i,o);return l!=null&&(C=Te(C,l)),ay(C,c,d,u)}const h=M(t,"x","conv2d","float32"),p=M(e,"filter","conv2d","float32");let f=h,m=!1;h.rank===3&&(m=!0,f=Z(h,[1,h.shape[0],h.shape[1],h.shape[2]])),A(f.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`),A(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),vn("fused conv2d",n,o);const b=r==="NHWC"?f.shape[3]:f.shape[1];A(p.shape[2]===b,()=>`Error in conv2d: depth of input (${b}) must match input depth for filter ${p.shape[2]}.`),A(Qs(s,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${s} and dilations '${i}'`);const g=Vs(f.shape,p.shape,s,i,n,o);let x;l!=null&&(x=M(l,"bias","fused conv2d"),[x]=fs(x,h),r==="NHWC"?ft(g.outShape,x.shape):(A(x.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${x.shape.length}.`),A(x.shape.length===0||x.shape[0]===g.outChannels||x.shape[0]===1,()=>`Error in fused conv2d: bias shape (${x.shape}) is not compatible with the number of output channels (${g.outChannels})`)));let y;if(d!=null){const C=d.shape;if(A(C.length<=1||C.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${C.length}.`),C.length===1)A(C[0]===1||C[0]===g.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the number of output channels (${g.outChannels}).`);else if(C.length===3)try{ft(C,g.outShape)}catch{const I=`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(I)}y=M(d,"prelu weights","fused conv2d")}const w=(C,j)=>{A(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[I,T,E,$]=j,D=iy(C,E,c);A(Ma(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const P=Db(T.shape,D,I,s,n),_=ry(T,D,I.shape,s,n),O=[P,_];if($!=null){const R=oy($,D);O.push(R)}return O},v={x:f,filter:p,bias:x,preluActivationWeights:y},N={strides:s,pad:n,dataFormat:r,dilations:i,dimRoundingMode:o,activation:c,leakyreluAlpha:u};return l==null?oc((j,I,T)=>{let E=W.runKernel(Yf,v,N);return T([I,j,E]),m&&(E=Z(E,[E.shape[1],E.shape[2],E.shape[3]])),{value:E,gradFunc:w}})(f,p):oc((j,I,T,E)=>{let $=W.runKernel(Yf,v,N);return E([I,j,$,T]),m&&($=Z($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:w}})(f,p,x)}const H7=J({fusedConv2d_:G7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q7(t,e,s,n,r,i=[1,1],o){let l=t;t.rank===3&&(l=Z(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let c=e;c.rank===3&&(c=Z(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const d={x:l,dy:c},u={strides:n,pad:r,dimRoundingMode:o,dilations:i,filterShape:s};return W.runKernel(F0,d,u)}const K7=J({depthwiseConv2dNativeBackpropFilter_:q7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X7(t,e,s,n,r,i=[1,1],o){let l=e,c=!1;e.rank===3&&(c=!0,l=Z(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const d={dy:l,filter:s},u={strides:n,pad:r,dimRoundingMode:o,dilations:i,inputShape:t},h=W.runKernel(O0,d,u);return c?Z(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Y7=J({depthwiseConv2dNativeBackpropInput_:X7});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z7({a:t,b:e,transposeA:s=!1,transposeB:n=!1,bias:r,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:l=.2}){if(ly(W.state.gradientDepth,i)===!1){let $=Ot(t,e,s,n);return r!=null&&($=Te($,r)),ay($,i,o,l)}let c=M(t,"a","fused matMul"),d=M(e,"b","fused matMul");[c,d]=fs(c,d);const u=s?c.shape[c.rank-2]:c.shape[c.rank-1],h=n?d.shape[d.rank-1]:d.shape[d.rank-2],p=s?c.shape[c.rank-1]:c.shape[c.rank-2],f=n?d.shape[d.rank-2]:d.shape[d.rank-1],m=c.shape.slice(0,-2),b=d.shape.slice(0,-2),g=pe(m),x=pe(b);A(u===h,()=>`Error in fused matMul: inner shapes (${u}) and (${h}) of Tensors with shapes ${c.shape} and ${d.shape} and transposeA=${s} and transposeB=${n} must match.`);const w=ft(c.shape.slice(0,-2),d.shape.slice(0,-2)).concat([p,f]),v=s?Z(c,[g,u,p]):Z(c,[g,p,u]),N=n?Z(d,[x,f,h]):Z(d,[x,h,f]);let C;r!=null&&(C=M(r,"bias","fused matMul"),[C]=fs(C,c),ft(w,C.shape));let j;o!=null&&(j=M(o,"prelu weights","fused matMul"));const I=($,D)=>{const[P,_,O,R]=D,X=iy(Z($,O.shape),O,i);let L,K;if(!s&&!n?(L=Ot(X,_,!1,!0),K=Ot(P,X,!0,!1)):!s&&n?(L=Ot(X,_,!1,!1),K=Ot(X,P,!0,!1)):s&&!n?(L=Ot(_,X,!1,!0),K=Ot(P,X,!1,!1)):(L=Ot(_,X,!0,!0),K=Ot(X,P,!0,!0)),r!=null){const B=oy(R,X);return[L,K,B]}else return[L,K]},T={a:v,b:N,bias:C,preluActivationWeights:j},E={transposeA:s,transposeB:n,activation:i,leakyreluAlpha:l};return r==null?oc((D,P,_)=>{const O=W.runKernel(Xf,T,E);return _([D,P,O]),{value:Z(O,w),gradFunc:I}})(v,N):oc((D,P,_,O)=>{const R=W.runKernel(Xf,T,E);return O([D,P,R,_]),{value:Z(R,w),gradFunc:I}})(v,N,C)}const VS=J({fusedMatMul_:Z7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J7(t,e,s,n,r="bilinear",i=0){const o=M(t,"image","cropAndResize"),l=M(e,"boxes","cropAndResize","float32"),c=M(s,"boxInd","cropAndResize","int32"),d=l.shape[0];A(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),A(l.rank===2&&l.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${d},4] but had shape ${l.shape}.`),A(c.rank===1&&c.shape[0]===d,()=>`Error in cropAndResize: boxInd must be have size [${d}] but had shape ${l.shape}.`),A(n.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${n.length}.`),A(n[0]>=1&&n[1]>=1,()=>`cropSize must be atleast [1,1], but was ${n}`),A(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const u={image:o,boxes:l,boxInd:c},h={method:r,extrapolationValue:i,cropSize:n};return W.runKernel(_0,u,h)}const Q7=J({cropAndResize_:J7});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e8(t){const e=M(t,"image","flipLeftRight","float32");A(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const s={image:e};return W.runKernel(W0,s,{})}const t8=J({flipLeftRight_:e8});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s8(t){const e=M(t,"image","grayscaleToRGB"),s=e.rank-1,n=e.shape[s];A(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),A(n===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${n}.`);const r=new Array(e.rank);return r.fill(1,0,s),r[s]=3,Lr(e,r)}const n8=J({grayscaleToRGB_:s8});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r8(t){const e=M(t,"image","RGBToGrayscale"),s=e.rank-1,n=e.shape[s];A(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),A(n===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${n}.`);const r=e.dtype,i=Be(e,"float32"),o=Pn([.2989,.587,.114]);let l;switch(e.rank){case 2:l=Su("ij,j->i",i,o);break;case 3:l=Su("ijk,k->ij",i,o);break;case 4:l=Su("ijkl,l->ijk",i,o);break;case 5:l=Su("ijklm,m->ijkl",i,o);break;case 6:l=Su("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return l=kn(l,-1),Be(l,r)}const i8=J({rgbToGrayscale_:r8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o8(t,e,s=0,n=.5){const r=M(t,"image","rotateWithOffset","float32");A(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},o={radians:e,fillValue:s,center:n};return W.runKernel(cb,i,o)}const a8=J({rotateWithOffset_:o8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ac(t,e,s,n,r,i){n==null&&(n=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=t.shape[0];return s=Math.min(s,o),A(0<=n&&n<=1,()=>`iouThreshold must be in [0, 1], but was '${n}'`),A(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),A(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),A(e.rank===1,()=>"scores must be a 1D tensor"),A(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),A(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:s,iouThreshold:n,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l8(t,e,s,n=.5,r=Number.NEGATIVE_INFINITY){const i=M(t,"boxes","nonMaxSuppression","float32"),o=M(e,"scores","nonMaxSuppression","float32"),l=ac(i,o,s,n,r);s=l.maxOutputSize,n=l.iouThreshold,r=l.scoreThreshold;const c={maxOutputSize:s,iouThreshold:n,scoreThreshold:r};return W.runKernel(Y0,{boxes:i,scores:o},c)}const c8=J({nonMaxSuppression_:l8});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d8(t,e,s){const n=u8(t,e,s),r=n<0?-(n+1):n;t.splice(r,0,e)}function u8(t,e,s){return p8(t,e,s||h8)}function h8(t,e){return t>e?1:t<e?-1:0}function p8(t,e,s){let n=0,r=t.length,i=0,o=!1;for(;n<r;){i=n+(r-n>>>1);const l=s(e,t[i]);l>0?n=i+1:(r=i,o=!l)}return o?n:-n-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cy(t,e,s,n,r){return hy(t,e,s,n,r,0)}function dy(t,e,s,n,r,i){return hy(t,e,s,n,r,0,!1,i,!0)}function uy(t,e,s,n,r,i){return hy(t,e,s,n,r,i,!0)}function hy(t,e,s,n,r,i,o=!1,l=!1,c=!1){const d=[];for(let g=0;g<e.length;g++)e[g]>r&&d.push({score:e[g],boxIndex:g,suppressBeginIndex:0});d.sort(WS);const u=i>0?-.5/i:0,h=[],p=[];for(;h.length<s&&d.length>0;){const g=d.pop(),{score:x,boxIndex:y,suppressBeginIndex:w}=g;if(x<r)break;let v=!1;for(let N=h.length-1;N>=w;--N){const C=f8(t,y,h[N]);if(C>=n){v=!0;break}if(g.score=g.score*m8(n,u,C),g.score<=r)break}g.suppressBeginIndex=h.length,v||(g.score===x?(h.push(y),p.push(g.score)):g.score>r&&d8(d,g,WS))}const f=h.length,m=s-f;l&&m>0&&(h.push(...new Array(m).fill(0)),p.push(...new Array(m).fill(0)));const b={selectedIndices:h};return o&&(b.selectedScores=p),c&&(b.validOutputs=f),b}function f8(t,e,s){const n=t.subarray(e*4,e*4+4),r=t.subarray(s*4,s*4+4),i=Math.min(n[0],n[2]),o=Math.min(n[1],n[3]),l=Math.max(n[0],n[2]),c=Math.max(n[1],n[3]),d=Math.min(r[0],r[2]),u=Math.min(r[1],r[3]),h=Math.max(r[0],r[2]),p=Math.max(r[1],r[3]),f=(l-i)*(c-o),m=(h-d)*(p-u);if(f<=0||m<=0)return 0;const b=Math.max(i,d),g=Math.max(o,u),x=Math.min(l,h),y=Math.min(c,p),w=Math.max(x-b,0)*Math.max(y-g,0);return w/(f+m-w)}function m8(t,e,s){const n=Math.exp(e*s*s);return s<=t?n:0}function WS(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function g8(t,e,s,n=.5,r=Number.NEGATIVE_INFINITY){const i=M(t,"boxes","nonMaxSuppressionAsync"),o=M(e,"scores","nonMaxSuppressionAsync"),l=ac(i,o,s,n,r);s=l.maxOutputSize,n=l.iouThreshold,r=l.scoreThreshold;const c=await Promise.all([i.data(),o.data()]),d=c[0],u=c[1],{selectedIndices:h}=cy(d,u,s,n,r);return i!==t&&i.dispose(),o!==e&&o.dispose(),Pn(h,"int32")}const x8=g8;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b8(t,e,s,n=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=M(t,"boxes","nonMaxSuppression"),l=M(e,"scores","nonMaxSuppression"),c=ac(o,l,s,n,r,i);s=c.maxOutputSize,n=c.iouThreshold,r=c.scoreThreshold,i=c.softNmsSigma;const d={boxes:o,scores:l},u={maxOutputSize:s,iouThreshold:n,scoreThreshold:r,softNmsSigma:i},h=W.runKernel(J0,d,u);return{selectedIndices:h[0],selectedScores:h[1]}}const y8=J({nonMaxSuppressionWithScore_:b8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function w8(t,e,s,n=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=M(t,"boxes","nonMaxSuppressionAsync"),l=M(e,"scores","nonMaxSuppressionAsync"),c=ac(o,l,s,n,r,i);s=c.maxOutputSize,n=c.iouThreshold,r=c.scoreThreshold,i=c.softNmsSigma;const d=await Promise.all([o.data(),l.data()]),u=d[0],h=d[1],{selectedIndices:p,selectedScores:f}=uy(u,h,s,n,r,i);return o!==t&&o.dispose(),l!==e&&l.dispose(),{selectedIndices:Pn(p,"int32"),selectedScores:Pn(f)}}const v8=w8;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N8(t,e,s,n=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=M(t,"boxes","nonMaxSuppression"),l=M(e,"scores","nonMaxSuppression"),c=ac(o,l,s,n,r,null),d=c.maxOutputSize,u=c.iouThreshold,h=c.scoreThreshold,p={boxes:o,scores:l},f={maxOutputSize:d,iouThreshold:u,scoreThreshold:h,padToMaxOutputSize:i},m=W.runKernel(Z0,p,f);return{selectedIndices:m[0],validOutputs:m[1]}}const k8=J({nonMaxSuppressionPadded_:N8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function C8(t,e,s,n=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=M(t,"boxes","nonMaxSuppressionAsync"),l=M(e,"scores","nonMaxSuppressionAsync"),c=ac(o,l,s,n,r,null),d=c.maxOutputSize,u=c.iouThreshold,h=c.scoreThreshold,[p,f]=await Promise.all([o.data(),l.data()]),{selectedIndices:m,validOutputs:b}=dy(p,f,d,u,h,i);return o!==t&&o.dispose(),l!==e&&l.dispose(),{selectedIndices:Pn(m,"int32"),validOutputs:Mt(b,"int32")}}const S8=C8;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j8(t,e,s=!1,n=!1){const r=M(t,"images","resizeBilinear");A(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),A(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),A(n===!1||s===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=Z(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const l={images:i},c={alignCorners:s,halfPixelCenters:n,size:e},d=W.runKernel(Mf,l,c);return o?Z(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const GS=J({resizeBilinear_:j8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I8(t,e,s=!1,n=!1){const r=M(t,"images","resizeNearestNeighbor");A(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),A(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),A(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),A(n===!1||s===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=Z(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const l={images:i},c={alignCorners:s,halfPixelCenters:n,size:e},d=W.runKernel(Of,l,c);return o?Z(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const HS=J({resizeNearestNeighbor_:I8});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E8(t,e="binary",s=!1,n=.5){const r=M(t,"image","threshold"),i=.2989,o=.587,l=.114,c=r.shape[0]*r.shape[1];let d=V(Pn([n]),255),u,h,p,f;if(A(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),A(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),A(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),A(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[u,h,p]=Kn(r,[1,1,1],-1);const g=V(u,i),x=V(h,o),y=V(p,l);f=Te(Te(g,x),y)}else f=t;if(e==="otsu"){const g=$W(Be(AS(f),"int32"),yu([]),256);d=$8(g,c)}const m=s?ic(f,d):qn(f,d);return Be(V(m,255),"int32")}function $8(t,e){let s=Pn([-1]),n=Pn([0]),r=Pn([0]),i,o,l,c,d,u;for(let h=0;h<t.size-1;h++){i=Qt(t,0,h+1),o=Qt(t,h+1),d=nt(st(i),e),u=nt(st(o),e);const p=st(V(i,$u(0,i.size)));l=nt(p,st(i));const f=lm(o.shape,i.size),m=Te($u(0,o.size),f),b=V(o,m);c=nt(st(b),st(o));const g=lt(l,c),x=lt(l,c),y=V(d,u);r=V(V(y,g),x);const w=qn(r,n);n=cn(w,r,n),s=cn(w,Pn([h]),s)}return s}const T8=J({threshold_:E8});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A8(t,e,s="nearest",n="constant",r=0,i){const o=M(t,"image","transform","float32"),l=M(e,"transforms","transform","float32");A(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),A(l.rank===2&&(l.shape[0]===o.shape[0]||l.shape[0]===1)&&l.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),A(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const c={image:o,transforms:l},d={interpolation:s,fillMode:n,fillValue:r,outputShape:i};return W.runKernel(ab,c,d)}const D8=J({transform_:A8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _8(t,e,s){const n=M(t,"a","bandPart");A(n.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${n.rank}.`);const r=n.shape,[i,o]=n.shape.slice(-2);let l,c;typeof e=="number"?(A(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),A(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),l=M(e<0?i:e,"numLower","bandPart")):(A(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),l=cn(pm(e,0),i,Iu(e,i))),typeof s=="number"?(A(s%1===0,()=>`bandPart(): numUpper must be an integer, got ${s}.`),A(s<=o,()=>`bandPart(): numUpper (${s}) must not be greater than the number of columns (${o}).`),c=M(s<0?o:s,"numUpper","bandPart")):(A(s.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),c=cn(pm(s,0),o,Iu(s,o)));const d=Z($u(0,i,1,"int32"),[-1,1]),u=$u(0,o,1,"int32"),h=lt(d,u),p=Qi(ic(h,l),Ua(h,gs(c))),f=Os([i,o],n.dtype);return Z(eo(qa(Z(n,[-1,i,o])).map(m=>cn(p,m,f))),r)}const R8=J({bandPart_:_8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P8(t){let e;if(Array.isArray(t)){e=!1,A(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=t[0].shape[0];for(let i=1;i<t.length;++i)A(t[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[i].shape[0]} vs. ${r})`)}else e=!0,t=Kn(t,t.shape[0],0).map(r=>Tu(r,[0]));A(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const s=[],n=t;for(let r=0;r<t.length;++r)s.push(W.tidy(()=>{let i=n[r];if(r>0)for(let o=0;o<r;++o){const l=V(st(V(s[o],i)),s[o]);i=lt(i,l)}return nt(i,um(i,"euclidean"))}));return e?eo(s,0):s}const F8=J({gramSchmidt_:P8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O8(t,e=!1){if(A(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return qS(t,e);{const s=t.shape.slice(0,t.shape.length-2).reduce((c,d)=>c*d),n=qa(Z(t,[s,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),r=[],i=[];n.forEach(c=>{const[d,u]=qS(c,e);r.push(d),i.push(u)});const o=Z(eo(r,0),t.shape),l=Z(eo(i,0),t.shape);return[o,l]}}function qS(t,e=!1){return W.tidy(()=>{A(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const s=t.shape[0],n=t.shape[1];let r=NS(s),i=Oa(t);const o=ny([[1]],[1,1]);let l=Oa(o);const c=s>=n?n:s;for(let d=0;d<c;++d){const u=i,h=l,p=r;[l,i,r]=W.tidy(()=>{const f=Qt(i,[d,d],[s-d,1]),m=um(f),b=Qt(i,[d,d],[1,1]),g=cn(qn(b,0),ny([[-1]]),ny([[1]])),x=lt(b,V(g,m)),y=nt(f,x);y.shape[0]===1?l=Oa(o):l=Nn([o,Qt(y,[1,0],[y.shape[0]-1,y.shape[1]])],0);const w=gs(nt(Ot(g,x),m)),v=Qt(i,[d,0],[s-d,n]),N=V(w,l),C=Tt(l);if(d===0)i=lt(v,Ot(N,Ot(C,v)));else{const T=lt(v,Ot(N,Ot(C,v)));i=Nn([Qt(i,[0,0],[d,n]),T],0)}const j=Tt(N),I=Qt(r,[0,d],[s,r.shape[1]-d]);if(d===0)r=lt(I,Ot(Ot(I,l),j));else{const T=lt(I,Ot(Ot(I,l),j));r=Nn([Qt(r,[0,0],[s,d]),T],1)}return[l,i,r]}),wt([u,h,p])}return!e&&s>n&&(r=Qt(r,[0,0],[s,n]),i=Qt(i,[0,0],[n,n])),[r,i]})}const M8=J({qr_:O8});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const to={flipLeftRight:t8,grayscaleToRGB:n8,resizeNearestNeighbor:HS,resizeBilinear:GS,rgbToGrayscale:i8,rotateWithOffset:a8,cropAndResize:Q7,nonMaxSuppression:c8,nonMaxSuppressionAsync:x8,nonMaxSuppressionWithScore:y8,nonMaxSuppressionWithScoreAsync:v8,nonMaxSuppressionPadded:k8,nonMaxSuppressionPaddedAsync:S8,threshold:T8,transform:D8},L8={bandPart:R8,gramSchmidt:F8,qr:M8};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z8=new Map,B8=new Map;class lc{getClassName(){return this.constructor.className}static fromConfig(e,s){return new e(s)}}class fr{constructor(){this.classNameMap={}}static getMap(){return fr.instance==null&&(fr.instance=new fr),fr.instance}static register(e){fr.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Ie(t,e,s){A(t.className!=null,()=>"Class being registered does not have the static className property defined."),A(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),A(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof s>"u"&&(s=t.className);const n=s,r=e+">"+n;return fr.register(t),z8.set(r,t),B8.set(t,r),t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Po extends lc{minimize(e,s=!1,n){const{value:r,grads:i}=this.computeGradients(e,n);if(n!=null){const o=n.map(l=>({name:l.name,tensor:i[l.name]}));this.applyGradients(o)}else this.applyGradients(i);return wt(i),s?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,s){return YG(e,s)}dispose(){this.iterations_!=null&&wt(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Mt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Po,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KS extends Po{static get className(){return"Adadelta"}constructor(e,s,n=null){super(),this.learningRate=e,this.rho=s,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],n==null&&(this.epsilon=W.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,r)=>{const i=W.registeredVariables[n],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${n}/accum_grad`,variable:ne(()=>$t(i).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${n}/accum_var`,variable:ne(()=>$t(i).variable(o))});const l=Array.isArray(e)?e[r].tensor:e[n];if(l==null)return;const c=this.accumulatedGrads[r].variable,d=this.accumulatedUpdates[r].variable;ne(()=>{const u=Te(V(c,this.rho),V(rs(l),1-this.rho)),h=V(nt(en(Te(d,this.epsilon)),en(Te(c,this.epsilon))),l),p=Te(V(d,this.rho),V(rs(h),1-this.rho));c.assign(u),d.assign(p);const f=Te(V(h,-this.learningRate),i);i.assign(f)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(wt(this.accumulatedGrads.map(e=>e.variable)),wt(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(s=>({name:s.originalName,tensor:s.variable})))}async setWeights(e){e=await this.extractIterations(e);const s=e.length/2,n=!1;this.accumulatedGrads=e.slice(0,s).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})),this.accumulatedUpdates=e.slice(s,s*2).map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,s){return new e(s.learningRate,s.rho,s.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XS extends Po{static get className(){return"Adagrad"}constructor(e,s=.1){super(),this.learningRate=e,this.initialAccumulatorValue=s,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,r)=>{const i=W.registeredVariables[n];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${n}/accumulator`,variable:ne(()=>lm(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[n];if(o==null)return;const l=this.accumulatedGrads[r].variable;ne(()=>{const c=Te(l,rs(o));l.assign(c);const d=Te(V(nt(o,en(Te(c,W.backend.epsilon()))),-this.learningRate),i);i.assign(d)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&wt(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const s=!1;this.accumulatedGrads=e.map(n=>({originalName:n.name,variable:n.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,s){return new e(s.learningRate,s.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YS extends Po{static get className(){return"Adam"}constructor(e,s,n,r=null){super(),this.learningRate=e,this.beta1=s,this.beta2=n,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],ne(()=>{this.accBeta1=Mt(s).variable(),this.accBeta2=Mt(n).variable()}),r==null&&(this.epsilon=W.backend.epsilon())}applyGradients(e){const s=Array.isArray(e)?e.map(n=>n.name):Object.keys(e);ne(()=>{const n=lt(1,this.accBeta1),r=lt(1,this.accBeta2);s.forEach((i,o)=>{const l=W.registeredVariables[i],c=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:ne(()=>$t(l).variable(c))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:ne(()=>$t(l).variable(c))});const d=Array.isArray(e)?e[o].tensor:e[i];if(d==null)return;const u=this.accumulatedFirstMoment[o].variable,h=this.accumulatedSecondMoment[o].variable,p=Te(V(u,this.beta1),V(d,1-this.beta1)),f=Te(V(h,this.beta2),V(rs(d),1-this.beta2)),m=nt(p,n),b=nt(f,r);u.assign(p),h.assign(f);const g=Te(V(nt(m,Te(en(b),this.epsilon)),-this.learningRate),l);l.assign(g)}),this.accBeta1.assign(V(this.accBeta1,this.beta1)),this.accBeta2.assign(V(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&wt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&wt(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(s=>({name:s.originalName,tensor:s.variable})))}async setWeights(e){e=await this.extractIterations(e),ne(()=>{this.accBeta1.assign(Ba(this.beta1,this.iterations_+1)),this.accBeta2.assign(Ba(this.beta2,this.iterations_+1))});const s=e.length/2,n=!1;this.accumulatedFirstMoment=e.slice(0,s).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})),this.accumulatedSecondMoment=e.slice(s,s*2).map(r=>({originalName:r.name,variable:r.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,s){return new e(s.learningRate,s.beta1,s.beta2,s.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZS extends Po{static get className(){return"Adamax"}constructor(e,s,n,r=null,i=0){super(),this.learningRate=e,this.beta1=s,this.beta2=n,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],ne(()=>{this.iteration=Mt(0).variable(),this.accBeta1=Mt(s).variable()}),r==null&&(this.epsilon=W.backend.epsilon())}applyGradients(e){const s=Array.isArray(e)?e.map(n=>n.name):Object.keys(e);ne(()=>{const n=lt(1,this.accBeta1),r=nt(-this.learningRate,Te(V(this.iteration,this.decay),1));s.forEach((i,o)=>{const l=W.registeredVariables[i],c=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:$t(l).variable(c)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:$t(l).variable(c)});const d=Array.isArray(e)?e[o].tensor:e[i];if(d==null)return;const u=this.accumulatedFirstMoment[o].variable,h=this.accumulatedWeightedInfNorm[o].variable,p=Te(V(u,this.beta1),V(d,1-this.beta1)),f=V(h,this.beta2),m=ln(d),b=_o(f,m);u.assign(p),h.assign(b);const g=Te(V(nt(r,n),nt(p,Te(b,this.epsilon))),l);l.assign(g)}),this.iteration.assign(Te(this.iteration,1)),this.accBeta1.assign(V(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&wt(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&wt(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,s){return new e(s.learningRate,s.beta1,s.beta2,s.epsilon,s.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class py extends Po{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,r)=>{const i=Array.isArray(e)?e[r].tensor:e[n];if(i==null)return;const o=W.registeredVariables[n];ne(()=>{const l=Te(V(this.c,i),o);o.assign(l)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=li(Mt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,s){return new e(s.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JS extends py{static get className(){return"Momentum"}constructor(e,s,n=!1){super(e),this.learningRate=e,this.momentum=s,this.useNesterov=n,this.accumulations=[],this.m=Mt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,r)=>{const i=W.registeredVariables[n];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${n}/momentum`,variable:ne(()=>$t(i).variable(!1))});const o=this.accumulations[r].variable,l=Array.isArray(e)?e[r].tensor:e[n];l!=null&&ne(()=>{let c;const d=Te(V(this.m,o),l);this.useNesterov?c=Te(V(this.c,Te(l,V(d,this.m))),i):c=Te(V(this.c,d),i),o.assign(d),i.assign(c)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&wt(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const s=!1;this.accumulations=e.map(n=>({originalName:n.name,variable:n.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,s){return new e(s.learningRate,s.momentum,s.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QS extends Po{static get className(){return"RMSProp"}constructor(e,s=.9,n=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=s,this.momentum=n,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=W.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,r)=>{const i=W.registeredVariables[n],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${n}/rms`,variable:ne(()=>$t(i).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${n}/momentum`,variable:ne(()=>$t(i).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${n}/mg`,variable:ne(()=>$t(i).variable(o))});const l=Array.isArray(e)?e[r].tensor:e[n];if(l==null)return;const c=this.accumulatedMeanSquares[r].variable,d=this.accumulatedMoments[r].variable;ne(()=>{const u=Te(V(c,this.decay),V(rs(l),1-this.decay));if(this.centered){const h=this.accumulatedMeanGrads[r].variable,p=Te(V(h,this.decay),V(l,1-this.decay)),f=nt(V(l,this.learningRate),en(lt(u,Te(rs(p),this.epsilon)))),m=Te(V(d,this.momentum),f);c.assign(u),h.assign(p),d.assign(m);const b=lt(i,m);i.assign(b)}else{const h=Te(V(c,this.decay),V(rs(l),1-this.decay)),p=Te(V(d,this.momentum),nt(V(l,this.learningRate),en(Te(h,this.epsilon))));c.assign(h),d.assign(p);const f=lt(i,p);i.assign(f)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&wt(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&wt(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&wt(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(s=>({name:s.originalName,tensor:s.variable})))}async setWeights(e){e=await this.extractIterations(e);const s=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,s).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})),this.accumulatedMoments=e.slice(s,s*2).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})),this.centered&&(this.accumulatedMeanGrads=e.slice(s*2,s*3).map(r=>({originalName:r.name,variable:r.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,s){return new e(s.learningRate,s.decay,s.momentum,s.epsilon,s.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U8=[KS,XS,YS,ZS,JS,QS,py];function V8(){for(const t of U8)Ie(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ej(t,e,s,n){o(t),s=s??0,n=n??1,l(s,n);let r=0;const i=c=>(c.then(d=>{const u=s+ ++r/t.length*(n-s);return e(u),d}),c);function o(c){A(c!=null&&Array.isArray(c)&&c.length>0,()=>"promises must be a none empty array")}function l(c,d){A(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${c}`),A(d>=0&&d<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${d}`),A(d>=c,()=>`startFraction must be no more than endFraction, but got startFraction ${c} and endFraction ${d}`)}return Promise.all(t.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function W8(t,e){e==null&&(e={});const s=e.fetchFunc==null?oe().platform.fetch:e.fetchFunc,n=t.map(h=>s(h,e.requestInit,{isBinary:!0})),l=(e.onProgress==null?await Promise.all(n):await ej(n,e.onProgress,0,.5)).map(h=>h.arrayBuffer());return e.onProgress==null?await Promise.all(l):await ej(l,e.onProgress,.5,1)}function G8(t,e){var s;const n=e.fetchFunc==null?oe().platform.fetch:e.fetchFunc;let r=0,i;return(s=e.onProgress)===null||s===void 0||s.call(e,0),new ReadableStream({pull:async o=>{for(var l;r<t.length;){i||(i=(await n(t[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:c,value:d}=await i.read();if(c){r++,i=void 0,(l=e.onProgress)===null||l===void 0||l.call(e,r/t.length);continue}o.enqueue(d);return}o.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H8="application/octet-stream",q8="application/json";class fy{constructor(e,s){if(this.DEFAULT_METHOD="POST",s==null&&(s={}),this.weightPathPrefix=s.weightPathPrefix,this.weightUrlConverter=s.weightUrlConverter,s.fetchFunc!=null?(A(typeof s.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=s.fetchFunc):this.fetch=oe().platform.fetch,A(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&A(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,s.requestInit!=null&&s.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=s.requestInit||{},this.loadOptions=s}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const s=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);s.body=new FormData;const n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=dV(e,n);if(s.body.append("model.json",new Blob([JSON.stringify(r)],{type:q8}),"model.json"),e.weightData!=null){const o=$o.join(e.weightData);s.body.append("model.weights.bin",new Blob([o],{type:H8}),"model.weights.bin")}const i=await this.fetch(this.path,s);if(i.ok)return{modelArtifactsInfo:Nb(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let s;try{s=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const n=s.modelTopology,r=s.weightsManifest;if(n==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return s}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return hV(e,s=>this.loadWeights(s))}async loadStream(){const e=await this.loadModelJSON(),s=await this.getWeightUrls(e.weightsManifest),n=nS(e.weightsManifest),r=()=>G8(s,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:r})}async getWeightUrls(e){const s=Array.isArray(this.path)?this.path[1]:this.path,[n,r]=K8(s),i=this.weightPathPrefix||n,o=[],l=[];for(const c of e)for(const d of c.paths)this.weightUrlConverter!=null?l.push(this.weightUrlConverter(d)):o.push(i+d+r);return this.weightUrlConverter&&o.push(...await Promise.all(l)),o}async loadWeights(e){const s=await this.getWeightUrls(e),n=nS(e),r=await W8(s,this.loadOptions);return[n,r]}}fy.URL_SCHEME_REGEX=/^https?:\/\//;function K8(t){const e=t.lastIndexOf("/"),s=t.lastIndexOf("?"),n=t.substring(0,e),r=s>e?t.substring(s):"";return[n+"/",r]}function tj(t){return t.match(fy.URL_SCHEME_REGEX)!=null}const sj=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let s=!0;if(Array.isArray(t)?s=t.every(n=>tj(n)):s=tj(t),s)return nj(t,e)}return null};Ps.registerSaveRouter(sj),Ps.registerLoadRouter(sj);function nj(t,e){return new fy(t,e)}function X8(t,e){return nj(t,e)}function my(t,e){const s=t.shape.length,n=e.shape.length;if(s<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${s}.`);if(n<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${n}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[n-1]>s)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[n-1]} vs. ${s}`);if(pe(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const r=e.shape,i=r[r.length-1];let o=1;for(let h=0;h<r.length-1;++h)o*=r[h];const l=t.shape,c=r.slice();c.pop();let d=1;for(let h=i;h<s;++h)d*=l[h],c.push(l[h]);const u=[...tt(t.shape).map(h=>h/d),1].slice(0,i);return[c,o,d,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gy=-2,Y8=-1;function xy(t,e,s){const n=t.shape.length;A(n===e.length,()=>`Error in slice${n}D: Length of begin ${e} must match the rank of the array (${n}).`),A(n===s.length,()=>`Error in slice${n}D: Length of size ${s} must match the rank of the array (${n}).`);for(let r=0;r<n;++r)A(e[r]+s[r]<=t.shape[r],()=>`Error in slice${n}D: begin[${r}] + size[${r}] (${e[r]+s[r]}) would overflow input.shape[${r}] (${t.shape[r]})`)}function Z8(t){const e=[];let s=0;for(;t>0;)t&1&&e.push(s),t/=2,s++;return e}function by(t,e,s){const n=[];for(let r=0;r<t.length;r++)n[r]=Math.ceil((e[r]-t[r])/s[r]);return n}function rj(t,e,s,n){const r=[...t];for(let i=r.length;i<n.length;i++)r.push(1);for(let i=0;i<s;i++)i===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function ij(t,e,s){return s<=t?s:s-(e-1)}function oj(t,e){const s=[];for(let n=0;n<t;n++)s.push(e+n);return s}function J8(t,e,s,n,r,i,o,l,c){const d=t.length;let u=new Array(d),h=new Array(d),p=new Array(d);if(e.length&&s>0){const f=e[0],m=s+1;u=aj(o,f,m,n,t),h=lj(l,f,m,r,t),p=rj(i,f,m,t)}else for(let f=0;f<d;f++)u[f]=dj(o,n,i,t,f,c),h[f]=uj(l,r,i,t,f,c),p[f]=cj(i,f,c);return{begin:u,end:h,strides:p}}function aj(t,e,s,n,r){const i=[...r],o=oj(s,e);for(let l=0;l<i.length;l++)if(o.indexOf(l)>-1)i[l]=0;else{const c=ij(e,s,l);let d=n[c];t&1<<c&&(d=0),i[l]=d}return i}function lj(t,e,s,n,r){const i=[...r],o=oj(s,e);for(let l=0;l<i.length;l++)if(o.indexOf(l)>-1)i[l]=Number.MAX_SAFE_INTEGER;else{const c=ij(e,s,l);let d=n[c];t&1<<c&&(d=Number.MAX_SAFE_INTEGER),i[l]=d}for(let l=0;l<i.length;l++){const c=r[l];i[l]<0&&(i[l]+=c),i[l]=ja(0,i[l],r[l])}return i}function cj(t,e,s){let n=t[e];return(s&1<<e||n==null)&&(n=1),n}function dj(t,e,s,n,r,i){let o=e[r];const l=s[r]||1;(t&1<<r||i&1<<r||o==null)&&(l>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const c=n[r];return o<0&&(o+=c),o=ja(0,o,c-1),o}function uj(t,e,s,n,r,i){let o=e[r];const l=s[r]||1;(t&1<<r||i&1<<r||o==null)&&(l>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const c=n[r];return o<0&&(o+=c),l>0?o=ja(0,o,c):o=ja(-1,o,c-1),o}function yy(t,e,s){let n=s.length;for(let r=0;r<s.length;r++)if(s[r]>1){n=r;break}for(let r=n+1;r<s.length;r++)if(e[r]>0||s[r]!==t[r])return!1;return!0}function wy(t,e){let s=t.length>0?t[t.length-1]:1;for(let n=0;n<t.length-1;n++)s+=t[n]*e[n];return s}function xm(t,e,s){let n;const r=t.shape.length;typeof e=="number"?n=[e,...new Array(r-1).fill(0)]:e.length<r?n=e.concat(new Array(r-e.length).fill(0)):n=e.slice(),n.forEach(o=>{A(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return s==null?i=new Array(r).fill(-1):typeof s=="number"?i=[s,...new Array(r-1).fill(-1)]:s.length<r?i=s.concat(new Array(r-s.length).fill(-1)):i=s,i=i.map((o,l)=>o>=0?o:(A(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${l}.`),t.shape[l]-n[l])),[n,i]}function vy(t,e,s,n,r,i,o,l,c){let d;if(n==null?(d=new Array(e.length),d.fill(1)):d=n,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const h={dims:d.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:s.slice(),strides:d.slice(),beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:l,shrinkAxisMask:c};for(let w=0;w<h.dims;w++)u&&1<<w&l&&h.numAddAxisAfterEllipsis++,1<<w&o&&(u=!0);u||(h.ellipsisMask|=1<<h.dims,h.dims++);const p={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};Q8(h,p);let f=!0,m=!0,b=!0;const g=[],x=[];for(let w=0;w<t.length;++w){if(p.strides[w]===0)throw Error(`strides[${w}] must be non-zero`);const v=!!(p.shrinkAxisMask&1<<w),N=t[w];if(N===-1){g.push(v?1:-1);continue}const C=[p.beginMask&1<<w,p.endMask&1<<w],j=[p.strides[w]>0?0:-1,p.strides[w]>0?N:N-1];if(v&&p.strides[w]<=0)throw Error("only stride 1 allowed on non-range indexing.");b=b&&p.strides[w]===1;const I=!!(p.beginMask&1<<w&&p.endMask&1<<w);if(p.beginValid&&p.endValid){if(v){const D=p.begin[w]<0?N+p.begin[w]:p.begin[w];if(p.begin[w]=D,p.end[w]=p.begin[w]+1,D<0||D>=N)throw Error(`slice index ${p.begin[w]} of dimension ${w} out of bounds.`)}else p.begin[w]=hj(p.begin[w],0,p.strides[w],N,C,j),p.end[w]=hj(p.end[w],1,p.strides[w],N,C,j);const $=p.strides[w]===1&&p.begin[w]===0&&p.end[w]===N;f=f&&$,m=m&&(w===0&&p.strides[w]===1||$)}else f=f&&p.strides[w]===1&&I,m=m&&(w===0&&p.strides[w]===1||I);let T,E=!1;if(p.beginValid&&p.endValid?(T=p.end[w]-p.begin[w],E=!0):v?(T=1,E=!0):I&&N>=0&&(p.strides[w]<0?T=-N:T=N,E=!0),E){let $;T===0||T<0!=p.strides[w]<0?$=0:$=Math.trunc(T/p.strides[w])+(T%p.strides[w]!==0?1:0),g.push($)}else g.push(-1)}for(let w=0;w<p.finalShapeGatherIndices.length;++w){const v=p.finalShapeGatherIndices[w];v>=0?x.push(g[v]):v===gy&&x.push(1)}return{finalShapeSparse:x.filter((w,v)=>p.finalShapeGatherIndices[v]!==gy),finalShape:x,isIdentity:f,sliceDim0:m,isSimpleSlice:b,begin:p.begin,end:p.end,strides:p.strides}}function Q8(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let s=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let n=0;n<t.dims;n++)if(1<<n&t.ellipsisMask){const r=Math.min(e.dims-(t.dims-n)+1+t.numAddAxisAfterEllipsis,e.dims);for(;s<r;s++)e.begin[s]=0,e.end[s]=0,e.strides[s]=1,e.beginMask|=1<<s,e.endMask|=1<<s,e.finalShapeGatherIndices.push(s),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[s]=n}else if(1<<n&t.newAxisMask)e.finalShapeGatherIndices.push(gy),e.finalShapeGatherIndicesSparse.push(-1);else{if(s===e.begin.length)throw Error(`Index out of range using input dim ${s}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[s]=t.begin[n]),t.end!=null&&(e.end[s]=t.end[n]),e.strides[s]=t.strides[n],t.beginMask&1<<n&&(e.beginMask|=1<<s),t.endMask&1<<n&&(e.endMask|=1<<s),t.shrinkAxisMask&1<<n?(e.finalShapeGatherIndices.push(Y8),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<s):(e.finalShapeGatherIndices.push(s),e.finalShapeGatherIndicesSparse.push(n)),e.inputShapeGatherIndicesSparse[s]=n,s++}}function hj(t,e,s,n,r,i){if(r[e])return s>0?i[e]:i[e+1&1];{const o=t<0?n+t:t;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const e9=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:xy,computeFlatOffset:wy,computeOutShape:by,getNormalizedAxes:J8,isSliceContinous:yy,maskToAxes:Z8,parseSliceParams:xm,sliceInfo:vy,startForAxis:dj,startIndicesWithElidedDims:aj,stopForAxis:uj,stopIndicesWithElidedDims:lj,stridesForAxis:cj,stridesWithElidedDims:rj},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class t9{static sgd(e){return new py(e)}static momentum(e,s,n=!1){return new JS(e,s,n)}static rmsprop(e,s=.9,n=0,r=null,i=!1){return new QS(e,s,n,r,i)}static adam(e=.001,s=.9,n=.999,r=null){return new YS(e,s,n,r)}static adadelta(e=.001,s=.95,n=null){return new KS(e,s,n)}static adamax(e=.002,s=.9,n=.999,r=null,i=0){return new ZS(e,s,n,r,i)}static adagrad(e,s=.1){return new XS(e,s)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cc=t9;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s9=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function pj(){return new Promise(t=>s9(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ny(t,e){const s=t[0].length;t.forEach((r,i)=>{A(r.length===s,()=>`Error in concat${s}D: rank of tensors[${i}] must be the same as the rank of the rest (${s})`)}),A(e>=0&&e<s,()=>`Error in concat${s}D: axis must be between 0 and ${s-1}.`);const n=t[0];t.forEach((r,i)=>{for(let o=0;o<s;o++)A(o===e||r[o]===n[o],()=>`Error in concat${s}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${n}) along the non-concatenated axis ${i}.`)})}function pi(t,e){const s=t[0].slice();for(let n=1;n<t.length;n++)s[e]+=t[n][e];return s}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var zr;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(zr||(zr={}));function fj(t,e,s){let n=new Array;if(s==null&&e==null)return n;if(e==null)for(;n.length<t+s.length;)n.push(-1);else n=e.slice();if(s==null)return n;if(t+s.length!==n.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+s.length}, but shape.rank = ${n.length}`);for(let r=1;r<s.length;++r){const i=s[r],o=n[n.length-s.length+r],l=n[o];if(i>=0)if(l>=0){if(l!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+t}] = ${i} but shape[${r+t}] = ${l}`)}else n[o]=i}return n}function mj(t){const e={FIRST_DIM_SIZE:zr.FIRST_DIM_SIZE,VALUE_ROWIDS:zr.VALUE_ROWIDS,ROW_LENGTHS:zr.ROW_LENGTHS,ROW_SPLITS:zr.ROW_SPLITS,ROW_LIMITS:zr.ROW_LIMITS,ROW_STARTS:zr.ROW_STARTS},s=[];for(const n of t)if(n in e)s.push(e[n]);else break;return s}function gj(t){return t.length===0?0:t[0]===zr.FIRST_DIM_SIZE?t.length-1:t.length}function xj(t,e){if(t==null||e==null)return;const s=t.length,n=e.length;if(s>=n)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${s} must be less than ragged tensor input flatValues.rank = ${n})`);for(let r=0;r<Math.min(s,n-1);++r){const i=t[r],o=e[r+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-t.length}] = ${i} but ragged tensor input.flatValues.shape[${r-t.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ky=30;function bm(t){return t<=ky?t:g0(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cy(t,e,s){const n=s*(typeof t=="number"?t:t[0]),r=e*(typeof t=="number"?t:t[1]);return[n,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Du(t,e,s,n=!0){let r=[];if(n)r=r.concat(e.slice(0)),r.push(t[0]/s),r=r.concat(t.slice(1));else{r=r.concat(t[0]);const i=e.length;for(let o=0;o<i;++o)r=r.concat([t[o+1]/e[o],e[o]]);r=r.concat(t.slice(i+1))}return r}function _u(t,e,s=!0){const n=[];if(s){n.push(e);for(let r=e+1;r<t;++r)r<=2*e?(n.push(r),n.push(r-(e+1))):n.push(r)}else{const r=[],i=[];for(let o=1;o<t;++o)o>=e*2+1||o%2===1?i.push(o):r.push(o);n.push(...r),n.push(0),n.push(...i)}return n}function Ru(t,e,s,n=!0){const r=[];n?r.push(t[0]/s):r.push(t[0]*s);for(let i=1;i<t.length;++i)i<=e.length?n?r.push(e[i-1]*t[i]):r.push(t[i]/e[i-1]):r.push(t[i]);return r}function Sy(t,e){const s=[0];for(let n=0;n<e;++n)s.push(t[n][0]);return s}function jy(t,e,s){const n=t.slice(0,1);for(let r=0;r<s;++r)n.push(t[r+1]-e[r][0]-e[r][1]);return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ym=1.7580993408473768,wm=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iy=.3275911,Ey=.254829592,$y=-.284496736,Ty=1.421413741,Ay=-1.453152027,Dy=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function so(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const s=new Float32Array(t.length*2);for(let n=0;n<s.length;n+=2)s[n]=t[n/2],s[n+1]=e[n/2];return s}function bj(t){const e=new Float32Array(t.length/2),s=new Float32Array(t.length/2);for(let n=0;n<t.length;n+=2)e[n/2]=t[n],s[n/2]=t[n+1];return{real:e,imag:s}}function yj(t){const e=Math.ceil(t.length/4),s=new Float32Array(e),n=new Float32Array(e);for(let r=0;r<t.length;r+=4)s[Math.floor(r/4)]=t[r],n[Math.floor(r/4)]=t[r+1];return{real:s,imag:n}}function wj(t){const e=Math.floor(t.length/4),s=new Float32Array(e),n=new Float32Array(e);for(let r=2;r<t.length;r+=4)s[Math.floor(r/4)]=t[r],n[Math.floor(r/4)]=t[r+1];return{real:s,imag:n}}function _y(t,e){const s=t[e*2],n=t[e*2+1];return{real:s,imag:n}}function vj(t,e,s,n){t[n*2]=e,t[n*2+1]=s}function Nj(t,e){const s=new Float32Array(t/2),n=new Float32Array(t/2);for(let r=0;r<Math.ceil(t/2);r++){const i=(e?2:-2)*Math.PI*(r/t);s[r]=Math.cos(i),n[r]=Math.sin(i)}return{real:s,imag:n}}function kj(t,e,s){const n=(s?2:-2)*Math.PI*(t/e),r=Math.cos(n),i=Math.sin(n);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ry="->",n9=/->/g,Cj=",",Sj="...";function Py(t,e){t=t.replace(/\s/g,"");const s=(t.length-t.replace(n9,"").length)/Ry.length;if(s<1)throw new Error("Equations without an arrow are not supported.");if(s>1)throw new Error(`Equation must contain exactly one arrow ("${Ry}").`);const[n,r]=t.split(Ry);A(n.indexOf(Sj)===-1,()=>`The ellipsis notation ("${Sj}") is not supported yet.`);const i=n.split(Cj),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const l=[];for(let p=0;p<r.length;++p){const f=r[p];if(!i.some(m=>m.indexOf(f)!==-1))throw new Error(`Output subscripts contain the label ${f} not present in the input subscripts.`);l.indexOf(f)===-1&&l.push(f)}for(let p=0;p<n.length;++p){const f=n[p];l.indexOf(f)===-1&&f!==Cj&&l.push(f)}const c=new Array(i.length);for(let p=0;p<o;++p){if(new Set(i[p].split("")).size!==i[p].length)throw new Error(`Found duplicate axes in input component ${i[p]}. Support for duplicate axes in input is not implemented yet.`);c[p]=[];for(let f=0;f<i[p].length;++f)c[p].push(l.indexOf(i[p][f]))}const d=l.length,u=r.length,h=[];for(let p=u;p<d;++p)h.push(p);return{allDims:l,summedDims:h,idDims:c}}function Fy(t,e){let s=new Array(t);s.fill(-1);for(let r=0;r<e.length;++r)s[e[r]]=r;const n=[];for(let r=0;r<t;++r)s[r]===-1&&n.push(r);return s=s.filter(r=>r!==-1),{permutationIndices:s,expandDims:n}}function Oy(t,e,s){const n=new Array(t);for(let r=0;r<s.length;++r){const i=s[r].shape;for(let o=0;o<e[r].length;++o)n[e[r][o]]===void 0?n[e[r][o]]=i[o]:A(n[e[r][o]]===i[o],()=>`Expected dimension ${n[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function My(t,e){const s=t,n=[];let r=0;t.length===0&&s.push(-1),r=t.length+1;for(let o=0;o<r;++o)n.push([]);const i=[];for(let o=0;o<s.length;++o){const l=s[o],c=r9(e,l);for(const d of c)i.indexOf(d)===-1&&(n[o].push(d),i.push(d))}return{path:s,steps:n}}function Ly(t){return t.every((e,s)=>e===s)}function r9(t,e){const s=[];for(let n=0;n<t.length;++n)(t[n].length===0||t[n].indexOf(e)!==-1||e===-1)&&s.push(n);return s}function zy(t,e,s=0){let n=[];if(typeof e=="number")A(t.shape[s]%e===0,()=>"Number of splits must evenly divide the axis."),n=new Array(e).fill(t.shape[s]/e);else{const r=e.reduce((o,l)=>(l===-1&&(o+=1),o),0);A(r<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((l,c)=>c>0?l+c:l);e[i]=t.shape[s]-o}A(t.shape[s]===e.reduce((o,l)=>o+l),()=>"The sum of sizes must match the size of the axis dimension."),n=e}return n}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jj(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function Ij(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function Ej(t,e,s){return`indices(${t}, 0) is invalid: ${e} >= ${s}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $j(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function Tj(t,e){return`size ${t} must be non-negative, not ${e}`}function Aj(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Dj(t,e){const s=pe(t),n=pe(e);return`Input to reshape is a SparseTensor with ${s}
  dense values, but the requested shape requires a multiple of ${n}. inputShape=${t} outputShape= ${e}`}function _j(t,e){const s=pe(t),n=pe(e);return`Input to reshape is a tensor with ${s} dense values, but the requested shape has ${n}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function By(){return"segment ids must be >= 0"}function Rj(){return"segment ids are not increasing"}function Pj(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function Fj(t,e,s){return`Bad: indices[${t}] == ${e} out of range [0, ${s})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oj(t,e){let s=!1,n;for(t<=ky?(n=t,s=!0):n=g0(t,Math.floor(Math.sqrt(t)));!s;)n>e||n===t?s=!0:n=g0(t,n+1);return n}function Mj(t,e,s){const n=[],r=t.length;for(let i=0;i<r;i++)i!==e?n.push(t[i]):n.push(s);return n}function Uy(t,e,s,n){const r=e.shape.length,i=t.shape.length;if(n!==0&&(n<-r||n>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${n}`);if(n<0&&(n+=r),n>i)throw new Error(`batchDims (${n}) must be less than rank(x) (
    ${i}).`);if(s<n)throw new Error(`batchDims (${n}) must be less than or equal to axis (${s}).`);for(let h=0;h<n;++h)if(t.shape[h]!==e.shape[h])throw new Error(`x.shape[${h}]: ${t.shape[h]} should be equal to indices.shape[${h}]: ${e.shape[h]}.`);const o=t.shape[s],l=[];let c=1,d=1,u=1;for(let h=0;h<n;++h)l.push(t.shape[h]),c*=t.shape[h];for(let h=n;h<s;h++)l.push(t.shape[h]),d*=t.shape[h];for(let h=n;h<r;h++)l.push(e.shape[h]);for(let h=s+1;h<i;h++)l.push(t.shape[h]),u*=t.shape[h];return{batchSize:c,sliceSize:u,outerSize:d,dimSize:o,outputShape:l}}const i9=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:Uy,computeOutShape:Mj,segOpComputeOptimalWindowSize:Oj},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function no(t){try{return t.map(e=>Eo(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function Lj(t){return t.map(e=>Io(e))}const o9=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:Ey,ERF_A2:$y,ERF_A3:Ty,ERF_A4:Ay,ERF_A5:Dy,ERF_P:Iy,PARALLELIZE_THRESHOLD:ky,get RowPartitionType(){return zr},SELU_SCALE:wm,SELU_SCALEALPHA:ym,applyActivation:ay,assertAndGetBroadcastShape:ft,assertAxesAreInnerMostDims:Ws,assertParamsConsistent:Ny,assignToTypedArray:vj,axesAreInnerMostDims:Fb,calculateShapes:Ha,checkEinsumDimSizes:Oy,checkPadOnDimRoundingMode:vn,combineLocations:wS,combineRaggedTensorToTensorShapes:fj,complexWithEvenIndex:yj,complexWithOddIndex:wj,computeConv2DInfo:Vs,computeConv3DInfo:Ao,computeDefaultPad:Eb,computeDilation2DInfo:vu,computeOptimalWindowSize:bm,computeOutAndReduceShapes:Fs,computeOutShape:pi,computePool2DInfo:hr,computePool3DInfo:Zi,convertConv2DDataFormat:Ji,decodeEinsumEquation:Py,eitherStridesOrDilationsAreOne:Qs,expandShapeToKeepDim:ks,exponent:kj,exponents:Nj,fromStringArrayToUint8:Lj,fromUint8ToStringArray:no,getAxesPermutation:cs,getBroadcastDims:rc,getComplexWithIndex:_y,getEinsumComputePath:My,getEinsumPermutation:Fy,getFusedBiasGradient:oy,getFusedDyActivation:iy,getImageCenter:Cy,getInnerMostAxes:ms,getPermuted:_u,getRaggedRank:gj,getReductionAxes:Es,getReshaped:Du,getReshapedPermuted:Ru,getRowPartitionTypesHelper:mj,getSliceBeginCoords:Sy,getSliceSize:jy,getSparseFillEmptyRowsIndicesDenseShapeMismatch:jj,getSparseFillEmptyRowsNegativeIndexErrorMessage:Ij,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:Ej,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Aj,getSparseReshapeInputOutputMismatchErrorMessage:_j,getSparseReshapeInputOutputMultipleErrorMessage:Dj,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:$j,getSparseReshapeNegativeOutputDimErrorMessage:Tj,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:Fj,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:By,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:Rj,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Pj,getUndoAxesPermutation:Do,isIdentityPermutation:Ly,log:$U,mergeRealAndImagArrays:so,prepareAndValidate:my,prepareSplitSize:zy,segment_util:i9,shouldFuse:ly,slice_util:e9,splitRealAndImagArrays:bj,stridesOrDilationsArePositive:La,tupleValuesAreOne:Ma,upcastType:Rn,validateDefaultValueShape:xj,validateInput:A7,validateUpdateShape:LS,warn:Gn},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */V8();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zj={kernelName:Kp,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>V(t,Au(Be(s,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a9={kernelName:vd,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>{const n=rs(Be(s,"float32")),r=en(lt(Mt(1),n));return gs(nt(t,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l9={kernelName:Nd,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>{const n=en(lt(rs(Be(s,"float32")),1));return nt(t,n)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c9={kernelName:Kl,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[s,n]=e,r=ft(s.shape,n.shape);return{a:()=>{let l=t;const c=Es(s.shape,r);return c.length>0&&(l=st(l,c)),Z(l,s.shape)},b:()=>{let l=t;const c=Es(n.shape,r);return c.length>0&&(l=st(l,c)),Z(l,n.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d9={kernelName:v0,saveAllInputs:!0,gradFunc:(t,e)=>{const s={};return e.forEach((n,r)=>{s[r]=()=>t.clone()}),s}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u9={kernelName:Xp,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>$t(s)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h9={kernelName:Yp,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>$t(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p9={kernelName:kd,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>nt(t,en(lt(Mt(1),rs(Be(s,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f9={kernelName:Cd,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>{const n=en(Te(Mt(1),rs(Be(s,"float32"))));return nt(t,n)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m9={kernelName:Id,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[s,n]=e,r=ft(s.shape,n.shape);return{a:()=>{const l=Te(rs(s),rs(n));let c=V(t,nt(n,l));const d=Es(s.shape,r);return d.length>0&&(c=st(c,d)),Z(c,s.shape)},b:()=>{const l=Te(rs(s),rs(n));let c=gs(V(t,nt(s,l)));const d=Es(n.shape,r);return d.length>0&&(c=st(c,d)),Z(c,n.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g9={kernelName:Sd,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>nt(t,Te(rs(Be(s,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x9={kernelName:jd,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>nt(t,lt(Mt(1),rs(Be(s,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b9(t,e,s,n,r,i){const o=M(t,"dy","avgPool3dGrad"),l=M(e,"input","avgPool3dGrad");let c=o,d=l,u=!1;l.rank===4&&(u=!0,c=Z(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),d=Z(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),A(c.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),A(d.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),vn("avgPool3dGrad",r,i);const h={dy:c,input:d},p={filterSize:s,strides:n,pad:r,dimRoundingMode:i},f=W.runKernel(S0,h,p);return u?Z(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const y9=J({avgPool3dGrad_:b9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w9={kernelName:Jp,inputsToSave:["x"],gradFunc:(t,e,s)=>{const[n]=e,{filterSize:r,strides:i,pad:o,dimRoundingMode:l}=s;return{x:()=>y9(t,n,r,i,o,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v9(t,e,s,n,r){const i=M(t,"dy","avgPoolGrad"),o=M(e,"input","avgPoolGrad");A(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let l=o,c=i,d=!1;o.rank===3&&(d=!0,l=Z(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=Z(i,[1,i.shape[0],i.shape[1],i.shape[2]])),A(c.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${c.rank}.`),A(l.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${l.rank}.`);const u={dy:c,input:l},h={filterSize:s,strides:n,pad:r},p=W.runKernel(C0,u,h);return d?Z(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const N9=J({avgPoolGrad_:v9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k9={kernelName:Zp,inputsToSave:["x"],gradFunc:(t,e,s)=>{const[n]=e,{filterSize:r,strides:i,pad:o}=s;return{x:()=>N9(t,n,r,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C9={kernelName:Qp,inputsToSave:["a","b"],gradFunc:(t,e,s)=>{const[n,r]=e,{transposeA:i,transposeB:o}=s;return!i&&!o?{a:()=>Ot(t,r,!1,!0),b:()=>Ot(n,t,!0,!1)}:!i&&o?{a:()=>Ot(t,r,!1,!1),b:()=>Ot(t,n,!0,!1)}:i&&!o?{a:()=>Ot(r,t,!1,!0),b:()=>Ot(n,t,!1,!1)}:{a:()=>Ot(r,t,!0,!0),b:()=>Ot(t,n,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S9={kernelName:ef,gradFunc:(t,e,s)=>{const{blockShape:n,crops:r}=s;return{x:()=>Wb(t,n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const j9={kernelName:SU,gradFunc:(t,e,s)=>{const n=s,r=n.inputShape,i=n.shape,o=Array.from(i);for(let c=r.length-1;c>=0;c--)if(r[c]===i[c])o[c]=1;else if(r[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const l=[];for(let c=0;c<o.length;c++)o[c]>1&&l.push(c);return{x:()=>st(t,l,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I9={kernelName:Ed,gradFunc:t=>({x:()=>t.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E9={kernelName:$d,gradFunc:t=>({x:()=>$t(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $9={kernelName:Td,inputsToSave:["x"],gradFunc:(t,e,s)=>{const[n]=e,{clipValueMin:r,clipValueMax:i}=s;return{x:()=>cn(Qi(Ua(n,r),ic(n,i)),t,$t(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T9={kernelName:tf,inputsToSave:["x"],gradFunc:zj.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A9={kernelName:sf,saveAllInputs:!0,gradFunc:(t,e,s)=>{const n=e.map(c=>c.shape),{axis:r}=s,i=vt(r,e[0].shape)[0],o=n.map(c=>c[i]);return Kn(t,o,i).map(c=>()=>c)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const D9={kernelName:nf,inputsToSave:["x","filter"],gradFunc:(t,e,s)=>{const[n,r]=e,{dilations:i,strides:o,pad:l,dataFormat:c}=s;return A(Ma(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>Db(n.shape,t,r,o,l,c),filter:()=>ry(n,t,r.shape,o,l,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _9={kernelName:rf,inputsToSave:["dy","filter"],gradFunc:(t,e,s)=>{const[n,r]=e,{strides:i,pad:o,dataFormat:l,dimRoundingMode:c}=s;return{dy:()=>za(t,r,i,o,l,1,c),filter:()=>ry(t,n,r.shape,i,o,l,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R9(t,e,s,n,r){let i=t;t.rank===4&&(i=Z(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let o=e;o.rank===4&&(o=Z(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),A(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),A(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),A(s.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${s}.`),A(i.shape[4]===s[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${s[3]}.`),A(o.shape[4]===s[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${s[4]}).`);const l={x:i,dy:o},c={strides:n,pad:r,filterShape:s};return W.runKernel(T0,l,c)}const P9=J({conv3DBackpropFilter_:R9});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const F9={kernelName:of,inputsToSave:["x","filter"],gradFunc:(t,e,s)=>{const{dilations:n,strides:r,pad:i}=s;A(Ma(n),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${n}'`);const[o,l]=e;return{x:()=>mS(o.shape,t,l,r,i),filter:()=>P9(o,t,l.shape,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O9={kernelName:Ad,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>V(gs(PS(Be(s,"float32"))),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M9={kernelName:Dd,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>V(FS(Be(s,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L9={kernelName:af,inputsToSave:["x"],gradFunc:(t,e,s)=>{const[n]=e,{axis:r,exclusive:i,reverse:o}=s;return{x:()=>{const l=cs([r],n.rank);let c=xS(t,r,i,!o);return l!=null&&(c=Tt(c,l)),c}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z9={kernelName:lf,inputsToSave:["x","filter"],gradFunc:(t,e,s)=>{const{dilations:n,strides:r,pad:i,dimRoundingMode:o}=s,l=n??[1,1];A(Ma(l),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${l}'`);const[c,d]=e;return A(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${c.rank}.`),A(d.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${d.rank}.`),A(c.shape[3]===d.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${d.shape[2]}.`),A(Qs(r,l),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${l}'.`),vn("depthwiseConv2d",i,o),{x:()=>Y7(c.shape,t,d,r,i,l,o),filter:()=>K7(c,t,d.shape,r,i,l,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B9={kernelName:cf,inputsToSave:["x","filter"],gradFunc:(t,e,s)=>{const[n,r]=e,i={x:n,filter:r,dy:t},o={x:n,filter:r,dy:t};return{x:()=>W.runKernel(M0,i,s),filter:()=>W.runKernel(L0,o,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U9={kernelName:Rd,outputsToSave:[!0],gradFunc:(t,e)=>{const[s]=e,n={dy:t,y:s};return{x:()=>W.runKernel(B0,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V9={kernelName:Pd,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e,n=V(ui(gs(rs(s))),2/Math.sqrt(Math.PI));return{x:()=>V(t,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W9={kernelName:Fd,outputsToSave:[!0],gradFunc:(t,e)=>{const[s]=e;return{x:()=>V(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G9={kernelName:uf,inputsToSave:["input"],gradFunc:(t,e)=>{const[s]=e;return{input:()=>Z(t,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H9={kernelName:Od,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>V(t,ui(s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q9={kernelName:Md,gradFunc:t=>({x:()=>$t(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const K9={kernelName:Ld,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[s,n]=e,r=ft(s.shape,n.shape);return{a:()=>{const l=nt(t,Be(n,"float32")),c=Es(s.shape,r);return c.length>0?Z(st(l,c),s.shape):l},b:()=>{let l=V(t,Be(s,"float32"));const c=Es(n.shape,r);c.length>0&&(l=Z(st(l,c),n.shape));const d=rs(n);return gs(nt(l,Be(d,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X9={kernelName:hf,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,s)=>{const{varianceEpsilon:n}=s,[r,i,o,l]=e,c=l??Mt(1),d=Es(i.shape,r.shape),u=[];if(i.rank===1){for(let v=0;v<r.shape.length-1;++v)u.push(r.shape[v]);u.push(1)}const h=lt(r,i),p=V(t,c),f=DS(Te(o,Mt(n))),m=V(V(V(f,f),f),Mt(-.5));return{x:()=>i.rank===1?Z(V(V(t,Lr(Z(f,[1,1,1,i.shape[0]]),u)),c),r.shape):Z(V(V(t,f),c),r.shape),mean:()=>{let v=V(V(f,Mt(-1)),p);return i.rank===1&&(v=st(v,d)),Z(v,i.shape)},variance:()=>{let v=V(V(m,h),p);return i.rank===1&&(v=st(v,d)),Z(v,i.shape)},scale:()=>{const v=V(h,f);let N=V(t,v);return i.rank===1&&(N=st(N,d)),Z(N,i.shape)},offset:()=>{let v=t;return i.rank===1&&(v=st(v,d)),Z(v,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y9={kernelName:pf,inputsToSave:["x","indices"],gradFunc:(t,e,s)=>{const[n,r]=e,{axis:i,batchDims:o}=s,l=vt(i,n.shape)[0],c=(d,u,h)=>()=>{const p=d.shape,f=u.size,m=p.slice(0,l),b=m.length,g=p.slice(i,p.length).slice(1),x=g.length,y=Bj(0,b),w=Bj(b+1,b+1+x),v=Uj([m,[f],g]),N=Z(h,v),C=Z(u,[f]),j=Uj([[b],y,w]),I=Tt(N,j);let T=BS(I,C,d.shape[l]);const E=Do(j);return T=Tt(T,E),T};if(o===1){const d=n.shape[0],u=n.split(d,0);return{x:()=>eo(u.map((f,m)=>c(f,r.slice(m,1),t.slice(m,1))())).reshape(n.shape),indices:()=>r}}else return{x:c(n,r,t),indices:()=>r}}};function Bj(t,e){const s=[];for(let n=t;n<e;++n)s.push(n);return s}function Uj(t){const e=[];for(let s=0;s<t.length;++s)for(let n=0;n<t[s].length;++n)e.push(t[s][n]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z9={kernelName:zd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[s,n]=e;return{a:()=>$t(s),b:()=>$t(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J9={kernelName:Bd,gradFunc:t=>({x:()=>Be(t,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Q9={kernelName:Ud,gradFunc:t=>({x:()=>$t(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eq={kernelName:Vd,gradFunc:t=>({x:()=>$t(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tq={kernelName:Wd,gradFunc:t=>({x:()=>$t(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sq={kernelName:mf,inputsToSave:["x"],gradFunc:(t,e,s)=>{const[n]=e,{alpha:r}=s,i=qn(n,0);return{x:()=>cn(i,t,V(t,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nq={kernelName:Hd,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>nt(t,Te(s,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rq={kernelName:Gd,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>nt(t,Be(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iq={kernelName:IU,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,s)=>{const[n]=e,{axis:r}=s;return{logits:()=>{const o=ui(n);return lt(t,V(st(t,r,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oq(t,e,s,n=5,r=1,i=1,o=.5){const l={x:t,y:e,dy:s},c={depthRadius:n,bias:r,alpha:i,beta:o};return W.runKernel(q0,l,c)}const aq=J({localResponseNormalizationBackprop_:oq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lq={kernelName:vf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,s)=>{const[n,r]=e,{depthRadius:i,bias:o,alpha:l,beta:c}=s;return{x:()=>aq(n,r,t,i,o,l,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vj(t,e,s,n){return e.rank<s.rank&&(e=Z(e,ks(e.shape,n))),t.rank<s.rank&&(t=Z(t,ks(t.shape,n))),{x:()=>V(t,Be(di(s,e),t.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wj={kernelName:Nf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,s)=>{const n=s,{reductionIndices:r}=n,i=e[0],o=e[1],l=vt(r,i.shape),c=Vj(t,o,i,l);return{x:()=>c.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cq={kernelName:qd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[s,n]=e;return{a:()=>V(t,Be(Ua(s,n),"float32")),b:()=>V(t,Be(pm(s,n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dq(t,e,s,n,r,i,o){const l=M(t,"dy","maxPool3dGrad"),c=M(e,"input","maxPool3dGrad"),d=M(s,"output","maxPool3dGrad");let u=l,h=c,p=d,f=!1;c.rank===4&&(f=!0,u=Z(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),h=Z(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),p=Z(d,[1,d.shape[0],d.shape[1],d.shape[2],d.shape[3]])),A(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),A(h.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${h.rank}.`),A(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),vn("maxPool3dGrad",i,o);const m={dy:u,input:h,output:p},b={filterSize:n,strides:r,pad:i,dimRoundingMode:o},g=W.runKernel(X0,m,b);return f?Z(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const uq=J({maxPool3dGrad_:dq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hq={kernelName:Cf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,s)=>{const[n,r]=e,{filterSize:i,strides:o,pad:l,dimRoundingMode:c}=s;return{x:()=>uq(t,n,r,i,o,l,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pq(t,e,s,n,r,i,o){const l=M(t,"dy","maxPoolGrad"),c=M(e,"input","maxPoolGrad"),d=M(s,"output","maxPoolGrad");A(c.rank===l.rank,()=>`Rank of input (${c.rank}) does not match rank of dy (${l.rank})`),A(l.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),A(c.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${c.rank}.`),vn("maxPoolGrad",i,o);const u={dy:l,input:c,output:d},h={filterSize:n,strides:r,pad:i,dimRoundingMode:o};return W.runKernel(K0,u,h)}const fq=J({maxPoolGrad_:pq});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mq={kernelName:kf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,s)=>{const[n,r]=e,{filterSize:i,strides:o,pad:l}=s;return{x:()=>fq(t,n,r,i,o,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gq={kernelName:Sf,inputsToSave:["x"],gradFunc:(t,e,s)=>{const[n]=e,{axis:r}=s,i=vt(r,n.shape),l=Fs(n.shape,i)[1],c=pe(l);return{x:()=>{const u=n.shape.slice();i.forEach(f=>{u[f]=1});const h=Z(t,u);return nt(V(h,Ro(n.shape,"float32")),c)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xq={kernelName:jf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,s)=>{const n=s,{axis:r}=n,[i,o]=e,l=vt(r,i.shape),c=Vj(t,o,i,l);return{x:()=>c.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bq={kernelName:Kd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[s,n]=e;return{a:()=>V(t,Be(ic(s,n),"float32")),b:()=>V(t,Be(qn(s,n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yq={kernelName:If,inputsToSave:["x"],gradFunc:(t,e,s)=>{const n=e[0],{paddings:r}=s,i=r.map(o=>o[0]);return{x:()=>Qt(t,i,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wq={kernelName:Xd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[s,n]=e,r=ft(s.shape,n.shape);return{a:()=>{const l=Es(s.shape,r);return l.length>0?Z(st(t,l),s.shape):t},b:()=>{const l=V(t,gs(hm(nt(s,n)))),c=Es(n.shape,r);return c.length>0?Z(st(l,c),n.shape):l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vq={kernelName:Yd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[s,n]=e,r=ft(s.shape,n.shape);return{a:()=>{const l=V(t,Be(n,"float32")),c=Es(s.shape,r);return c.length>0?Z(st(l,c),s.shape):l},b:()=>{const l=V(t,Be(s,"float32")),c=Es(n.shape,r);return c.length>0?Z(st(l,c),n.shape):l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nq={kernelName:Ef,gradFunc:t=>({x:()=>gs(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kq={kernelName:Af,inputsToSave:["indices"],gradFunc:(t,e)=>{const s=e[0];return{indices:()=>Os(s.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cq={kernelName:Tf,gradFunc:t=>({x:()=>$t(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sq={kernelName:Df,saveAllInputs:!0,gradFunc:(t,e,s)=>{const{axis:n}=s;return qa(t,n).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gj={kernelName:_f,inputsToSave:["x"],gradFunc:(t,e,s)=>{const n=e[0],{paddings:r}=s,i=r.map(o=>o[0]);return{x:()=>Qt(t,i,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jq={kernelName:Zd,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[s,n,r]=e,i=s,o=n,l=ft(i.shape,o.shape);return{a:()=>{const u=Be(o,"float32");let h=V(t,V(u,Ba(i,lt(u,Mt(1)))));const p=Es(i.shape,l);return p.length>0&&(h=st(h,p)),Z(h,i.shape)},b:()=>{const u=qn(i,0),h=cn(u,hi(i),$t(i));let p=V(t,V(r,h));const f=Es(o.shape,l);return f.length>0&&(p=st(p,f)),Z(p,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iq={kernelName:Rf,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[s,n]=e,r=qn(s,0);return{x:()=>cn(r,t,V(t,n)),alpha:()=>{let i=cn(r,$t(t),V(t,s));const o=Es(n.shape,t.shape);return o.length>0&&(i=st(i,o)),Z(i,n.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eq(t,e,s){const n=t.shape.slice();n[s]=1;const r=Z(e,n),i=Rb(t,s,!0,!1),o=Rb(t,s,!0,!0),l=V(i,o);return V(r,l)}function $q(t,e,s){const n=t.shape.length,r=n-s.length,i=cs(s,n);let o=t;i!=null&&(o=Tt(t,i));const l=o.shape.slice(),d=l.splice(n-s.length,s.length).reduce((p,f)=>p*f,1);l.push(d);const u=o.reshape(l);let h=Eq(u,e,r);if(h=h.reshape(o.shape),i!=null){const p=Do(i);h=Tt(h,p)}return h}const Tq={kernelName:Pf,inputsToSave:["x"],gradFunc:(t,e,s)=>{const[n]=e,{axis:r}=s;let i=[];return r==null?i=n.shape.map((o,l)=>l):typeof r=="number"?i=[r]:i=r,{x:()=>$q(n,t,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aq={kernelName:_d,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[s,n]=e,r=ft(s.shape,n.shape);return{a:()=>{const l=nt(t,Be(n,"float32")),c=Es(s.shape,r);return c.length>0?Z(st(l,c),s.shape):l},b:()=>{let l=V(t,Be(s,"float32"));const c=Es(n.shape,r);c.length>0&&(l=Z(st(l,c),n.shape));const d=rs(n);return gs(nt(l,Be(d,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dq={kernelName:Jd,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>nt(t,gs(rs(s)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _q={kernelName:eu,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e,n=V(ic(s,6),Au(s));return{x:()=>V(t,Be(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rq={kernelName:Qd,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>V(t,Be(Au(s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pq={kernelName:Ff,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>Z(t,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fq={kernelName:Mf,inputsToSave:["images"],gradFunc:(t,e,s)=>{const[n]=e,r={dy:t,images:n};return{images:()=>W.runKernel(sb,r,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oq={kernelName:Of,inputsToSave:["images"],gradFunc:(t,e,s)=>{const[n]=e,r={dy:t,images:n};return{images:()=>W.runKernel(tb,r,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mq={kernelName:Lf,gradFunc:(t,e,s)=>{const{dims:n}=s,r=vt(n,t.shape);return{x:()=>Ga(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lq={kernelName:tu,gradFunc:t=>({x:()=>$t(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zq={kernelName:su,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>gs(nt(t,V(Ba(s,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bq={kernelName:zf,inputsToSave:["condition"],gradFunc:(t,e)=>{const[s]=e;return{condition:()=>Be($t(s),"float32"),t:()=>V(t,Be(s,t.dtype)),e:()=>V(t,Be(zb(s),t.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uq={kernelName:nu,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>{const n=qn(s,Mt(0)),r=Mt(ym),i=Mt(wm),o=V(t,i),l=V(V(t,r),ui(Be(s,"float32")));return cn(n,o,l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vq={kernelName:au,outputsToSave:[!0],gradFunc:(t,e)=>{const[s]=e;return{x:()=>V(t,V(s,lt(Mt(1),s)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wq={kernelName:ou,gradFunc:t=>({x:()=>$t(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gq={kernelName:ru,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>V(_b(Be(s,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hq={kernelName:iu,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>V(gS(Be(s,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qq={kernelName:Bf,inputsToSave:["x"],gradFunc:(t,e,s)=>{const[n]=e,{begin:r,size:i}=s,o=n.shape,[l,c]=xm(n,r,i),d=[];for(let u=0;u<t.rank;u++)d.push([l[u],o[u]-l[u]-c[u]]);return{x:()=>Vb(t,d)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kq={kernelName:Gf,outputsToSave:[!0],gradFunc:(t,e,s)=>{const[n]=e,{dim:r}=s,i=!0,o=V(t,n);return{logits:()=>lt(o,V(st(o,[r],i),n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xq={kernelName:lu,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>V(t,nc(s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hj={kernelName:Vf,gradFunc:(t,e,s)=>{const{blockShape:n,paddings:r}=s;return{x:()=>Ab(t,n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qj={kernelName:Wf,gradFunc:(t,e,s)=>{const{axis:n}=s;return{x:()=>Nn(t,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yq={kernelName:cu,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>nt(t,V(en(Be(s,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zq={kernelName:nb,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>V(t,V(Be(s,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jq={kernelName:du,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[s,n]=e,r=Mt(2);return{a:()=>V(t,V(r,lt(s,n))),b:()=>V(t,V(r,lt(n,s)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qq={kernelName:mu,gradFunc:t=>({x:()=>$t(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eK={kernelName:uu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[s,n]=e,r=ft(s.shape,n.shape);return{a:()=>{let l=t;const c=Es(s.shape,r);return c.length>0&&(l=st(l,c)),Z(l,s.shape)},b:()=>{let l=t;const c=Es(n.shape,r);return c.length>0&&(l=st(l,c)),Z(gs(l),n.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tK={kernelName:Uf,inputsToSave:["x"],gradFunc:(t,e,s)=>{const[n]=e,r=n.shape.slice(),{axis:i}=s;vt(i,n.shape).forEach(d=>{r[d]=1});const l=Z(t,r),c=V(l,Ro(n.shape,"float32"));return{x:()=>c}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sK={kernelName:hu,inputsToSave:["x"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>nt(t,rs(_b(s)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nK={kernelName:pu,outputsToSave:[!0],gradFunc:(t,e)=>{const[s]=e;return{x:()=>V(lt(Mt(1),rs(s)),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rK={kernelName:fu,inputsToSave:["x"],gradFunc:(t,e,s)=>{const[n]=e,{reps:r}=s;return{x:()=>{let o=$t(n);if(n.rank===1)for(let l=0;l<r[0];++l)o=Te(o,Qt(t,[l*n.shape[0]],[n.shape[0]]));else if(n.rank===2)for(let l=0;l<r[0];++l)for(let c=0;c<r[1];++c)o=Te(o,Qt(t,[l*n.shape[0],c*n.shape[1]],[n.shape[0],n.shape[1]]));else if(n.rank===3)for(let l=0;l<r[0];++l)for(let c=0;c<r[1];++c)for(let d=0;d<r[2];++d)o=Te(o,Qt(t,[l*n.shape[0],c*n.shape[1],d*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else if(n.rank===4)for(let l=0;l<r[0];++l)for(let c=0;c<r[1];++c)for(let d=0;d<r[2];++d)for(let u=0;u<r[3];++u)o=Te(o,Qt(t,[l*n.shape[0],c*n.shape[1],d*n.shape[2],u*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${n.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iK={kernelName:Xl,gradFunc:(t,e,s)=>{const n=s,{perm:r}=n,i=Do(r);return{x:()=>Tt(t,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oK={kernelName:Hf,gradFunc:(t,e,s)=>{const n=s,{axis:r}=n;return{value:()=>eo(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aK={kernelName:qf,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[s]=e;return{x:()=>lK(t,s)}}};function lK(t,e){const s=_o(e,$t(e)),n=Ob(t,s);let r=Ua(e,Mt(0,"int32"));const i=n.rank-r.rank;for(let l=0;l<i;++l)r=kn(r,l+1);r=Qi(r,Ro(n.shape,"bool"));const o=$t(n);return cn(r,n,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cK={kernelName:Kf,gradFunc:t=>({x:()=>$t(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dK=[zj,a9,l9,c9,d9,u9,h9,p9,f9,m9,g9,x9,w9,k9,C9,S9,j9,I9,E9,$9,T9,A9,_9,D9,F9,O9,M9,L9,z9,B9,Aq,U9,V9,W9,G9,H9,K9,q9,X9,Y9,Z9,J9,Q9,eq,tq,sq,nq,rq,iq,lq,Wj,Wj,cq,hq,mq,gq,xq,bq,yq,wq,vq,Nq,kq,Cq,Sq,Gj,Gj,jq,Iq,Tq,Dq,_q,Rq,Pq,Fq,Oq,Mq,Lq,zq,Bq,Uq,Vq,Wq,Gq,Hq,qq,Kq,Xq,Hj,Hj,qj,qj,Yq,Jq,Zq,Qq,eK,tK,sK,nK,rK,iK,oK,aK,cK];for(const t of dK)TU(t);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.abs=function(){return this.throwIfDisposed(),ln(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.acos=function(){return this.throwIfDisposed(),UV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.acosh=function(){return this.throwIfDisposed(),WV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.add=function(t){return this.throwIfDisposed(),Te(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.all=function(t,e){return this.throwIfDisposed(),hS(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.any=function(t,e){return this.throwIfDisposed(),Ib(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.argMax=function(t){return this.throwIfDisposed(),wu(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.argMin=function(t){return this.throwIfDisposed(),XV(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.asScalar=function(){return this.throwIfDisposed(),A(this.size===1,()=>"The array must have only 1 element."),Z(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.asType=function(t){return this.throwIfDisposed(),Be(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.as1D=function(){return this.throwIfDisposed(),Z(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.as2D=function(t,e){return this.throwIfDisposed(),Z(this,[t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.as3D=function(t,e,s){return this.throwIfDisposed(),Z(this,[t,e,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.as4D=function(t,e,s,n){return this.throwIfDisposed(),Z(this,[t,e,s,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.as5D=function(t,e,s,n,r){return this.throwIfDisposed(),Z(this,[t,e,s,n,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.asin=function(){return this.throwIfDisposed(),ZV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.asinh=function(){return this.throwIfDisposed(),QV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.atan=function(){return this.throwIfDisposed(),tW(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.atan2=function(t){return this.throwIfDisposed(),nW(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.atanh=function(){return this.throwIfDisposed(),iW(this)},he().prototype.avgPool=function(t,e,s,n){return this.throwIfDisposed(),Tb(this,t,e,s,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),Ab(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.batchNorm=function(t,e,s,n,r){return this.throwIfDisposed(),am(this,t,e,s,n,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.broadcastTo=function(t){return this.throwIfDisposed(),Cu(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.cast=function(t){return this.throwIfDisposed(),Be(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.ceil=function(){return this.throwIfDisposed(),DW(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),Hn(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof Is&&(t=[t]),Nn([this,...t],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.conv1d=function(t,e,s,n,r,i){return this.throwIfDisposed(),pS(this,t,e,s,n,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.conv2dTranspose=function(t,e,s,n,r){return this.throwIfDisposed(),fS(this,t,e,s,n,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.conv2d=function(t,e,s,n,r,i){return this.throwIfDisposed(),za(this,t,e,s,n,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.cos=function(){return this.throwIfDisposed(),_b(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.cosh=function(){return this.throwIfDisposed(),gS(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.cumprod=function(t,e,s){return this.throwIfDisposed(),Rb(this,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.cumsum=function(t,e,s){return this.throwIfDisposed(),xS(this,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),nG(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.depthwiseConv2d=function(t,e,s,n,r,i){return this.throwIfDisposed(),Pb(this,t,e,s,n,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.dilation2d=function(t,e,s,n,r){return this.throwIfDisposed(),oG(this,t,e,s,n,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.divNoNan=function(t){return this.throwIfDisposed(),uG(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.div=function(t){return this.throwIfDisposed(),nt(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.dot=function(t){return this.throwIfDisposed(),pG(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.elu=function(){return this.throwIfDisposed(),cm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.equal=function(t){return this.throwIfDisposed(),di(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.erf=function(){return this.throwIfDisposed(),yS(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),SG(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.exp=function(){return this.throwIfDisposed(),ui(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.expandDims=function(t){return this.throwIfDisposed(),kn(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.expm1=function(){return this.throwIfDisposed(),$G(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.fft=function(){return this.throwIfDisposed(),MS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.flatten=function(){return this.throwIfDisposed(),Z(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.floor=function(){return this.throwIfDisposed(),hm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.floorDiv=function(t){return this.throwIfDisposed(),uS(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.gather=function(t,e,s){return this.throwIfDisposed(),Ob(this,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.greaterEqual=function(t){return this.throwIfDisposed(),Ua(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.greater=function(t){return this.throwIfDisposed(),qn(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.ifft=function(){return this.throwIfDisposed(),sy(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.irfft=function(){return this.throwIfDisposed(),b7(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.isFinite=function(){return this.throwIfDisposed(),MG(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.isInf=function(){return this.throwIfDisposed(),zG(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.isNaN=function(){return this.throwIfDisposed(),UG(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.leakyRelu=function(t){return this.throwIfDisposed(),Lb(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.lessEqual=function(t){return this.throwIfDisposed(),ic(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.less=function(t){return this.throwIfDisposed(),pm(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.localResponseNormalization=function(t,e,s,n){return this.throwIfDisposed(),qG(this,t,e,s,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.logSigmoid=function(){return this.throwIfDisposed(),eH(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.logSoftmax=function(t){return this.throwIfDisposed(),CS(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),SS(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.log=function(){return this.throwIfDisposed(),hi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.log1p=function(){return this.throwIfDisposed(),kS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.logicalAnd=function(t){return this.throwIfDisposed(),Qi(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.logicalNot=function(){return this.throwIfDisposed(),zb(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.logicalOr=function(t){return this.throwIfDisposed(),jS(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.logicalXor=function(t){return this.throwIfDisposed(),lH(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.matMul=function(t,e,s){return this.throwIfDisposed(),Ot(this,t,e,s)},he().prototype.maxPool=function(t,e,s,n){return this.throwIfDisposed(),Bb(this,t,e,s,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.max=function(t,e){return this.throwIfDisposed(),Mr(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.maximum=function(t){return this.throwIfDisposed(),_o(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.mean=function(t,e){return this.throwIfDisposed(),Cs(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.min=function(t,e){return this.throwIfDisposed(),dm(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.minimum=function(t){return this.throwIfDisposed(),Iu(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),gH(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.mod=function(t){return this.throwIfDisposed(),bH(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.mul=function(t){return this.throwIfDisposed(),V(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.neg=function(){return this.throwIfDisposed(),gs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.norm=function(t,e,s){return this.throwIfDisposed(),um(this,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.notEqual=function(t){return this.throwIfDisposed(),fm(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.oneHot=function(t,e=1,s=0){return this.throwIfDisposed(),IS(this,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.onesLike=function(){return this.throwIfDisposed(),pr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.pad=function(t,e){return this.throwIfDisposed(),Vb(this,t,e)},he().prototype.pool=function(t,e,s,n,r,i){return this.throwIfDisposed(),EH(this,t,e,s,n,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.pow=function(t){return this.throwIfDisposed(),Ba(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.prelu=function(t){return this.throwIfDisposed(),Gb(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.prod=function(t,e){return this.throwIfDisposed(),AH(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.reciprocal=function(){return this.throwIfDisposed(),JH(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.relu=function(){return this.throwIfDisposed(),Wa(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.relu6=function(){return this.throwIfDisposed(),TS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.reshapeAs=function(t){return this.throwIfDisposed(),Z(this,t.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.reshape=function(t){return this.throwIfDisposed(),Z(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.resizeBilinear=function(t,e,s){return this.throwIfDisposed(),GS(this,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.resizeNearestNeighbor=function(t,e,s){return this.throwIfDisposed(),HS(this,t,e,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.reverse=function(t){return this.throwIfDisposed(),Ga(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.rfft=function(){return this.throwIfDisposed(),v7(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.round=function(){return this.throwIfDisposed(),AS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.rsqrt=function(){return this.throwIfDisposed(),DS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.selu=function(){return this.throwIfDisposed(),_S(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.separableConv2d=function(t,e,s,n,r,i){return this.throwIfDisposed(),RS(this,t,e,s,n,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.sigmoid=function(){return this.throwIfDisposed(),nc(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.sign=function(){return this.throwIfDisposed(),a7(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.sin=function(){return this.throwIfDisposed(),PS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.sinh=function(){return this.throwIfDisposed(),FS(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.slice=function(t,e){return this.throwIfDisposed(),Qt(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.softmax=function(t){return this.throwIfDisposed(),ty(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.softplus=function(){return this.throwIfDisposed(),ju(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),Wb(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.split=function(t,e){return this.throwIfDisposed(),Kn(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.sqrt=function(){return this.throwIfDisposed(),en(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.square=function(){return this.throwIfDisposed(),rs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.squaredDifference=function(t){return this.throwIfDisposed(),k7(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.squeeze=function(t){return this.throwIfDisposed(),Tu(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.stack=function(t,e){this.throwIfDisposed();const s=t instanceof Is?[this,t]:[this,...t];return eo(s,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.step=function(t){return this.throwIfDisposed(),Au(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.stridedSlice=function(t,e,s,n,r,i,o,l){return this.throwIfDisposed(),E7(this,t,e,s,n,r,i,o,l)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.sub=function(t){return this.throwIfDisposed(),lt(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.sum=function(t,e){return this.throwIfDisposed(),st(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.tan=function(){return this.throwIfDisposed(),T7(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.tanh=function(){return this.throwIfDisposed(),om(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.tile=function(t){return this.throwIfDisposed(),Lr(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.toBool=function(){return this.throwIfDisposed(),Be(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.toFloat=function(){return this.throwIfDisposed(),Be(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.toInt=function(){return this.throwIfDisposed(),Be(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.topk=function(t,e){return this.throwIfDisposed(),_7(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.transpose=function(t){return this.throwIfDisposed(),Tt(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.unique=function(t){return this.throwIfDisposed(),F7(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),BS(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.unstack=function(t){return this.throwIfDisposed(),qa(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.where=function(t,e){return this.throwIfDisposed(),cn(t,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */he().prototype.zerosLike=function(){return this.throwIfDisposed(),$t(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class fi extends Error{constructor(e){super(e),Object.setPrototypeOf(this,fi.prototype)}}class mr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,mr.prototype)}}class U extends Error{constructor(e){super(e),Object.setPrototypeOf(this,U.prototype)}}class bt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,bt.prototype)}}class Vy extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Vy.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Kj{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let s;return this.cache.has(e)&&(s=this.cache.get(e),this.cache.delete(e),this.cache.set(e,s)),s}put(e,s){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,s)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let s=0;s<this.maxEntries-e;s++){const n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ka(t,e){if(Array.isArray(t)){let s=[];for(let n=0;n<e;n++)s=s.concat(t);return s}else{const s=new Array(e);return s.fill(t),s}}function mi(t,e){if(!t)throw new Vy(e)}function Xj(t,e){let s=0;for(const n of t)n===e&&s++;return s}function Cn(t){return t.length===1?t[0]:t}function Ut(t){return Array.isArray(t)?t:[t]}function ro(t){const s=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return s[0]!=="_"?s:"private"+s}function Xa(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(e,s)=>s.toUpperCase())}let gr={};function Wy(t){if(t==null)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function Gy(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(e=>Gy(e));else{const e=Object.keys(t);for(const s of e){const n=t[s];n!=null&&typeof n=="object"&&(!Array.isArray(n)&&n.type==="ndarray"&&typeof n.value=="number"?t[s]=n.value:Gy(n))}}}function Pu(t,e={},s={},n="object",r=!1){if(typeof t=="string"){const i=t;let o;if(i in s)o=s[i];else if(i in gr)o=gr[i];else if(o=e[i],o==null)throw new U(`Unknown ${n}: ${t}. This may be due to one of the following reasons:
1. The ${n} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${n} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=t;if(i.className==null||i.config==null)throw new U(`${n}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let l,c;if(o in s?[l,c]=s[o]:o in gr?[l,c]=gr.className:o in e&&([l,c]=e[o]),l==null)throw new U(`Unknown ${n}: ${o}. This may be due to one of the following reasons:
1. The ${n} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${n} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(c!=null){const d={};for(const f of Object.keys(gr))d[f]=gr[f];for(const f of Object.keys(s))d[f]=s[f];const u=i.config;u.customObjects=d;const h=Object.assign({},gr);for(const f of Object.keys(s))gr[f]=s[f];Gy(i.config);const p=c(l,i.config,s,r);return gr=Object.assign({},h),p}else{const d=Object.assign({},gr);for(const h of Object.keys(s))gr[h]=s[h];const u=new l(i.config);return gr=Object.assign({},d),u}}}function uK(t,e){return t<e?-1:t>e?1:0}function vm(t,e){return-1*uK(t,e)}function Fo(t){if(t==null)return t;const e=[];for(const s of t)e.indexOf(s)===-1&&e.push(s);return e}function hK(t){if(t==null)throw new U(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function Ya(t,e,s){if(s!=null&&t.indexOf(s)<0)throw new U(`${s} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function Hy(t,e,s=0,n=1/0){return mi(s>=0),mi(n>=s),Array.isArray(t)&&t.length>=s&&t.length<=n&&t.every(r=>typeof r===e)}function Ms(t,e){Array.isArray(t)?(A(t.length>0,()=>`${e} is unexpectedly an empty array.`),t.forEach((s,n)=>Ms(s,`element ${n+1} of ${e}`))):A(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got ${Yj(t)}.`)}function Yj(t){return t===null?"null":Array.isArray(t)?"["+t.map(e=>Yj(e)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function pK(t,e,s){let n=s!=null?s():yn(),r;return(...o)=>{const l=s!=null?s():yn();return l-n<e||(n=l,r=t(...o)),r}}function Zj(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let fK=0;function Jj(){return fK++}const Nm={};function km(t=""){return t in Nm||(Nm[t]=0),Nm[t]+=1,t+Nm[t].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const mK=["channelsFirst","channelsLast"],gK=["nearest","bilinear"],xK=["valid","same","causal"],bK=["max","avg"],yK=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const dc=new Map;function xs(t){Ya(mK,"DataFormat",t)}function wK(t){Ya(gK,"InterpolationFormat",t)}function Xn(t){Ya(xK,"PaddingMode",t)}function Qj(t){Ya(bK,"PoolMode",t)}const Fu=[],eI="/";function Za(t,e){Fu.push(t);try{const s=e();return Fu.pop(),s}catch(s){throw Fu.pop(),s}}function vK(){return Fu.length===0?"":Fu.join(eI)+eI}function tI(t){if(!nI(t))throw new Error("Not a valid tensor name: '"+t+"'");return vK()+t}function sI(t){if(!nI(t))throw new Error("Not a valid tensor name: '"+t+"'");dc.has(t)||dc.set(t,0);const e=dc.get(t);if(dc.set(t,dc.get(t)+1),e>0){const s=`${t}_${e}`;return dc.set(s,1),s}else return t}const NK=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function nI(t){return!!t.match(NK)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function kK(t){return t===parseInt(t.toString(),10)}function Oo(t,e,s){e==null&&(e=0),s==null&&(s=t.length);let n=1;for(let r=e;r<s;++r)n*=t[r];return n}function uc(t){if(t.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let s=0;s<t.length;s++){const n=t[s];n<e&&(e=n)}return e}function Mo(t){if(t.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;s++){const n=t[s];n>e&&(e=n)}return e}function Br(t,e){if(e<t)throw new U(`end (${e}) < begin (${t}) is forbidden.`);const s=[];for(let n=t;n<e;++n)s.push(n);return s}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let qy;function $s(){return qy==null&&(qy=sV().epsilon()),qy}function Ur(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function gi(t,e){return Be(t,e)}function Ou(t,e=-1){const s=t.shape.slice();return e<0&&(e=s.length+e+1),s.splice(e,0,1),Z(t,s)}function CK(t,e){return ne(()=>{if(t.shape.length!==2)throw new U(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);const s=Ou(t,1);return Yy(s,[1,e,1])})}function SK(t){const e=[Oo(t.shape)];return Z(t,e)}function jK(t){if(t.rank<=1)throw new U(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],Oo(t.shape,1)];return Z(t,e)}function Ja(t,e,s){return ne(()=>{switch(t.rank){case 1:return Qb(t,e,s);case 2:return OS(t,[e,0],[s,t.shape[1]]);case 3:return ey(t,[e,0,0],[s,t.shape[1],t.shape[2]]);case 4:return gm(t,[e,0,0,0],[s,t.shape[1],t.shape[2],t.shape[3]]);case 5:return Qt(t,[e,0,0,0,0],[s,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return Qt(t,[e,0,0,0,0,0],[s,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new U(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Ky(t,e,s){return ne(()=>{switch(t.rank){case 1:return Qb(t,e,s);case 2:return OS(t,[0,e],[t.shape[0],s]);case 3:return ey(t,[0,0,e],[t.shape[0],t.shape[1],s]);case 4:return gm(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],s]);default:throw new U(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Cm(t,e,s,n){return ne(()=>{switch(t.rank){case 1:return Qb(t,e,s);case 2:switch(n){case 1:return Ja(t,e,s);case 2:return Ky(t,e,s);default:throw new U(`The axis is not within the rank of the tensor ${n}`)}case 3:switch(n){case 1:return Ja(t,e,s);case 2:return ey(t,[0,e,0],[t.shape[0],s,t.shape[2]]);case 3:return Ky(t,e,s);default:throw new U(`The axis is not within the rank of the tensor ${n}`)}case 4:switch(n){case 1:return Ja(t,e,s);case 2:return gm(t,[0,e,0,0],[t.shape[0],s,t.shape[2],t.shape[3]]);case 3:return gm(t,[0,0,e,0],[t.shape[0],t.shape[1],s,t.shape[3]]);case 4:return Ky(t,e,s);default:throw new U(`The axis is not within the rank of the tensor ${n}`)}default:throw new U(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Xy(t,e=-1){let s;return e<0&&(s=t[0].rank,s!==0?e=s:e=0),e===t[0].rank&&(e=-1),Nn(t,e)}function rI(t,e){switch(t.rank){case 1:return PW([t,e]);case 2:return OW([t,e],0);case 3:return LW([t,e],0);case 4:return BW([t,e],0);default:throw new U(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function Yy(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new U(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return Lr(t,e)}function Sm(t,e=0,s=1,n,r){return KH(t,e,s,n,r)}function xi(t,e,s,n){if(t.rank<2||e.rank<2)throw new bt(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=t.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(r!==i)throw new bt(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(t.rank===2&&e.rank===2)return VS({a:t,b:e,transposeA:!1,transposeB:!1,bias:n?Zy(t.rank,n,Ur()):null,activation:s});{const r=t.shape.slice(),i=r.pop();t=Z(t,[-1,i]);const o=e.shape.slice(),l=o.pop(),c=o.pop(),d=[...o,l],u=Array.from({length:e.rank},(m,b)=>b===0?e.rank-2:b<=e.rank-2?b-1:b);e=Z(Tt(e,u),[c,-1]);const h=[...r,...d];return Z(VS({a:t,b:e,transposeA:!1,transposeB:!1,bias:n?Zy(t.rank,n,Ur()):null,activation:s}),h)}}function iI(t,e,s){return ne(()=>(Array.isArray(e)?e=Pn(e,"int32"):e=Be(e,"int32"),Ob(t,e,s)))}function Mu(t){return V(t,t)}function Zy(t,e,s){const n=e.shape;if(e.rank!==1&&e.rank!==t)throw new U(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(t===5){if(s==="channelsFirst")return n.length===1?Z(e,[1,n[0],1,1,1]):Z(e,[1,n[3],n[0],n[1],n[2]]);if(s==="channelsLast")return n.length===1?Z(e,[1,1,1,1,n[0]]):Z(e,[1].concat(n))}else if(t===4){if(s==="channelsFirst")return n.length===1?Z(e,[1,n[0],1,1]):Z(e,[1,n[2],n[0],n[1]]);if(s==="channelsLast")return n.length===1?Z(e,[1,1,1,n[0]]):Z(e,[1].concat(n))}else if(t===3){if(s==="channelsFirst")return n.length===1?Z(e,[1,n[0],1]):Z(e,[1,n[1],n[0]]);if(s==="channelsLast")return n.length===1?Z(e,[1,1,n[0]]):Z(e,[1].concat(n))}else if(t<3)return e;throw new U(`Unsupported input rank by biasAdd: ${e.rank}`)}function Vr(t,e,s){return ne(()=>(s==null&&(s=Ur()),xs(s),Te(t,Zy(t.rank,e,s))))}function IK(t,e=1){if(e!==1)throw new bt(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return cm(t)}function EK(t){return ne(()=>nt(t,Te(ln(t),1)))}function oI(t,e,s,n){return ne(()=>V7(t,e,s,n))}function $K(t){return ne(()=>{const e=Te(.5,V(.2,t));return Hn(e,0,1)})}function Lu(t,e,s=!1){return s?t():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const TK=["fanIn","fanOut","fanAvg"],AK=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function DK(t){Ya(TK,"FanMode",t)}function _K(t){Ya(AK,"Distribution",t)}class xr extends lc{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class aI extends xr{apply(e,s){return Os(e,s)}}aI.className="Zeros",Ie(aI);class Jy extends xr{apply(e,s){return Ro(e,s)}}Jy.className="Ones",Ie(Jy);class lI extends xr{constructor(e){if(super(),typeof e!="object")throw new U(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new U(`config must have value set but got ${e}`);this.value=e.value}apply(e,s){return ne(()=>V(Mt(this.value),Ro(e,s)))}getConfig(){return{value:this.value}}}lI.className="Constant",Ie(lI);class cI extends xr{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,s){return Eu(e,this.minval,this.maxval,s,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}cI.className="RandomUniform",Ie(cI);class dI extends xr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,s){if(s=s||"float32",s!=="float32"&&s!=="int32")throw new bt(`randomNormal does not support dType ${s}.`);return Sm(e,this.mean,this.stddev,s,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}dI.className="RandomNormal",Ie(dI);class uI extends xr{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,s){if(s=s||"float32",s!=="float32"&&s!=="int32")throw new bt(`truncatedNormal does not support dType ${s}.`);return zS(e,this.mean,this.stddev,s,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}uI.className="TruncatedNormal",Ie(uI);class hI extends xr{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,s){return ne(()=>{if(e.length!==2||e[0]!==e[1])throw new U("Identity matrix initializer can only be used for 2D square matrices.");return V(this.gain,NS(e[0]))})}getConfig(){return{gain:this.gain}}}hI.className="Identity",Ie(hI);function RK(t,e="channelsLast"){let s,n;if(xs(e),t.length===2)s=t[0],n=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(e==="channelsFirst"){const r=Oo(t,2);s=t[1]*r,n=t[0]*r}else if(e==="channelsLast"){const r=Oo(t,0,t.length-2);s=t[t.length-2]*r,n=t[t.length-1]*r}}else{const r=Oo(t);s=Math.sqrt(r),n=Math.sqrt(r)}return[s,n]}class Fn extends xr{constructor(e){if(super(),e.scale<0)throw new U(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,DK(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,_K(this.distribution),this.seed=e.seed}apply(e,s){const n=RK(e),r=n[0],i=n[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,r):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),this.distribution==="normal"){const l=Math.sqrt(o);if(s=s||"float32",s!=="float32"&&s!=="int32")throw new bt(`${this.getClassName()} does not support dType ${s}.`);return zS(e,0,l,s,this.seed)}else{const l=Math.sqrt(3*o);return Eu(e,-l,l,s,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}Fn.className="VarianceScaling",Ie(Fn);class Qy extends Fn{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Fn.className}}Qy.className="GlorotUniform",Ie(Qy);class ew extends Fn{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Fn.className}}ew.className="GlorotNormal",Ie(ew);class tw extends Fn{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Fn.className}}tw.className="HeNormal",Ie(tw);class sw extends Fn{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Fn.className}}sw.className="HeUniform",Ie(sw);class nw extends Fn{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Fn.className}}nw.className="LeCunNormal",Ie(nw);class rw extends Fn{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Fn.className}}rw.className="LeCunUniform",Ie(rw);class pI extends xr{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,s){return ne(()=>{if(e.length<2)throw new bt("Shape must be at least 2D.");if(s!=="int32"&&s!=="float32"&&s!==void 0)throw new TypeError(`Unsupported data type ${s}.`);s=s;const n=pe(e.slice(0,-1)),r=e[e.length-1],i=n*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(r,n),Math.min(r,n)],l=Sm(o,0,1,s,this.seed),c=L8.qr(l,!1);let d=c[0];const h=c[1].flatten().stridedSlice([0],[Math.min(r,n)*Math.min(r,n)],[Math.min(r,n)+1]);return d=V(d,h.sign()),n<r&&(d=d.transpose()),V(Mt(this.gain),d.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}pI.className="Orthogonal",Ie(pI);const fI={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function mI(t,e={}){return Pu(t,fr.getMap().classNameMap,e,"initializer")}function ds(t){return Wy(t)}function os(t){if(typeof t=="string"){const e=t in fI?fI[t]:t;if(e==="GlorotNormal")return new ew;if(e==="GlorotUniform")return new Qy;if(e==="HeNormal")return new tw;if(e==="HeUniform")return new sw;if(e==="LeCunNormal")return new nw;if(e==="LeCunUniform")return new rw;{const s={};return s.className=e,s.config={},mI(s)}}else return t instanceof xr?t:mI(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function iw(t){return Array.isArray(t)&&Array.isArray(t[0])}function jm(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function dt(t){let e;if(Array.isArray(t)){if(t.length!==1)throw new U(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function _t(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new U(`Expected exactly 1 Shape; got ${t.length}`)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Im(t){let e=0;for(const s of t)s.shape.length===0?e+=1:e+=s.shape.reduce((n,r)=>n*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const gI="Variable";class PK{constructor(e,s="float32",n=gI,r=!0,i=null){this.dtype=s??"float32",this.shape=e.shape,this.id=Jj(),n=n??gI,this.originalName=tI(n),this.name=sI(this.originalName),this.trainable_=r,this.constraint=i,this.val=L7(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),FK(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function FK(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function ow(t){return t.map(e=>e.read())}function aw(t){t.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Ts{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class bi{constructor(e,s,n,r,i,o,l){this.dtype=e,this.shape=s,this.sourceLayer=n,this.inputs=r,this.callArgs=i,this.outputTensorIndex=l,this.id=Jj(),o!=null&&(this.originalName=tI(o),this.name=sI(this.originalName)),this.rank=s.length}}let OK=0,Em=class{constructor(e,s){this.callArgs=s,this.id=OK++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const n of e.inboundLayers)n?.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const s of this.inboundLayers)s!=null?e.push(s.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},MK=0;class kt extends lc{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=MK++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let s=e.name;if(!s){const n=this.getClassName();s=ro(n)+"_"+km(n)}if(this.name=s,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let n;if(e.batchInputShape!=null)n=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),n=[i].concat(e.inputShape)}this.batchInputShape=n;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,s){return e.name+"_ib-"+s.toString()}getNodeAtIndex(e,s){if(this.inboundNodes.length===0)throw new mr(`The layer has never been called and thus has no defined ${s}.`);if(this.inboundNodes.length<=e)throw new U(`Asked to get ${s} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Cn(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Cn(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new fi(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new fi(`Layer ${this.name} is not connected, no input to return.`);return Cn(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new fi(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new fi(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Cn(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(s=>s.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const s=Ut(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const n=Ut(this.inputSpec);if(s.length!==n.length)throw new U(`Layer ${this.name} expects ${n.length} inputs, but it received ${s.length} input tensors. Input received: ${e}`);for(let r=0;r<s.length;r++){const i=s[r],o=n[r];if(o==null)continue;const l=i.rank;if(o.ndim!=null&&l!==o.ndim)throw new U(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${l}`);if(o.maxNDim!=null&&l>o.maxNDim)throw new U(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${l}`);if(o.minNDim!=null&&l<o.minNDim)throw new U(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${l}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new U(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const c=i.shape;for(const d in o.axes){const u=Number(d),h=o.axes[d],p=u>=0?c[u]:c[c.length+u];if(h!=null&&[h,null].indexOf(p)===-1)throw new U(`Input ${r} is incompatible with layer ${this.name}: expected axis ${u} of input shape to have value ${h} but got shape ${c}.`)}}if(o.shape!=null)for(let c=0;c<o.shape.length;++c){const d=o.shape[c],u=i.shape[c];if(d!=null&&u!=null&&d!==u)throw new U(`Input ${r} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(e,s){return e}invokeCallHook(e,s){this._callHook!=null&&this._callHook(e,s)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,s){s=s||{},this.assertNotDisposed();const n=Ut(e),r=BK(e),i=UK(e);if(r===i)throw new U("Arguments to apply() must be all SymbolicTensors or all Tensors");return Za(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const l of Ut(e))o.push(l.shape);this.build(Cn(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let o=this.call(e,s);this.supportsMasking&&this.setMaskMetadata(e,o);const l=Ut(o),c=[];for(let d of l)n.indexOf(d)!==-1&&(d=d.clone()),c.push(d);if(o=Cn(c),this.activityRegularizer!=null)throw new bt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=LK(e),l=this.computeOutputShape(o);let c;const d=zK(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),l!=null&&l.length>0&&Array.isArray(l[0])?c=l.map((u,h)=>new bi(d,u,this,Ut(e),s,this.name,h)):c=new bi(d,l,this,Ut(e),s,this.name),this.addInboundNode(e,c,null,null,o,l,s),this._refCount++,this.activityRegularizer!=null)throw new bt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return c}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let s=!1;this.batchInputShape.forEach((n,r)=>{n!=null&&e[r]!=null&&e[r]!==n&&(s=!0)}),s&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new fi(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const s of this.inboundNodes){const n=JSON.stringify(s.outputShapes);e.indexOf(n)===-1&&e.push(n)}if(e.length===1){const s=this.inboundNodes[0].outputShapes;return Array.isArray(s)&&Array.isArray(s[0])&&s.length===1?s[0]:s}else throw new fi(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new mr(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Im(this.weights)}build(e){this.built=!0}getWeights(e=!1){return ow(e?this.trainableWeights:this.weights)}setWeights(e){ne(()=>{const s=this.weights;if(s.length!==e.length)throw new U(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${s.length} weights. Provided weights: ${e}...`);if(s.length===0)return;const n=[],r=ow(s);for(let i=0;i<r.length;++i){const o=r[i],l=s[i],c=e[i];if(!Ft(o.shape,c.shape))throw new U(`Layer weight shape ${o.shape} not compatible with provided weight shape ${c.shape}`);n.push([l,c])}aw(n)})}addWeight(e,s,n,r,i,o,l,c){if(this._addedWeightNames.indexOf(e)!==-1)throw new U(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),n==null&&(n="float32"),this.fastWeightInitDuringBuild&&(r=c!=null?c():os("zeros"));const d=r.apply(s,n),u=new PK(d,n,e,o,l);return d.dispose(),i!=null&&this.addLoss(()=>i.apply(u.read())),o==null&&(o=!0),o?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=Ut(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,s){if(!this.supportsMasking){if(s!=null)if(Array.isArray(s))s.forEach(n=>{if(n!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return s}setMaskMetadata(e,s,n){if(!this.supportsMasking)return;const r=this.computeMask(e,n),i=Ut(s),o=Ut(r);if(i.length!==o.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let l=0;l<i.length;l++)i[l].kerasMask=o[l]}addInboundNode(e,s,n,r,i,o,l=null){const c=Ut(e);s=Ut(s),n=Ut(n),r=Ut(r),i=jm(i),o=jm(o);const d=[],u=[],h=[];for(const p of c)d.push(p.sourceLayer),u.push(p.nodeIndex),h.push(p.tensorIndex);new Em({outboundLayer:this,inboundLayers:d,nodeIndices:u,tensorIndices:h,inputTensors:c,outputTensors:s,inputMasks:n,outputMasks:r,inputShapes:i,outputShapes:o},l);for(let p=0;p<s.length;p++)s[p].sourceLayer=this,s[p].nodeIndex=this.inboundNodes.length-1,s[p].tensorIndex=p}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function LK(t){t=Ut(t);const e=[];for(const s of t)e.push(s.shape);return Cn(e)}function zK(t){return"float32"}function xI(t,e,s){if((e==null||s!=null&&s>0)&&(e=t.sourceLayer,s=t.nodeIndex),e.inboundNodes.length===0)return[t];{const n=e.inboundNodes[s];if(n.inboundLayers.length===0)return n.inputTensors;{const r=[];for(let i=0;i<n.inboundLayers.length;i++){const o=n.inputTensors[i],l=n.inboundLayers[i],c=n.nodeIndices[i],d=xI(o,l,c);for(const u of d)r.indexOf(u)===-1&&r.push(u)}return r}}}function BK(t){let e=!0;for(const s of Ut(t))if(!(s instanceof bi)){e=!1;break}return e}function UK(t){let e=!0;for(const s of Ut(t))if(s instanceof bi){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class zu extends kt{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:km("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new U("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let s=e.batchInputShape;if(s==null){if(e.inputShape==null)throw new U("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");s=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new U("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=e.dtype||"float32";this.batchInputShape=s,this.dtype=n,this.inputSpec=[{shape:s}];const r=new bi(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Em({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[s],outputShapes:[s]})}apply(e,s){throw new U(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}zu.className="InputLayer",Ie(zu);function VK(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new U("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;t.shape!=null&&e==null&&(e=[null].concat(t.shape));let s=t.dtype;return s==null&&(s="float32"),new zu({batchInputShape:e,name:t.name,dtype:s,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function WK(t,e){if(t.dtype==null||t.dtype===e.dtype)return e;try{return Be(e,t.dtype)}catch{throw new U(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}class Lo{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Lo)for(const s in e.id2Value)this.id2Value[s]=e.id2Value[s],s in e.id2Mask&&(this.id2Mask[s]=e.id2Mask[s]);else{if(e==null)return;for(const s of e)this.add(s.key,s.value)}}add(e,s,n){if(this.id2Value[e.id]==null)this.id2Value[e.id]=WK(e,s),this.name2Id[e.name]=e.id,n!=null&&(this.id2Mask[e.id]=n);else throw new U(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof bi){if(this.id2Value[e.id]==null)throw new U(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const s=this.name2Id[e];if(s==null)throw new U(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[s]}}getMask(e){if(e instanceof bi){if(this.id2Value[e.id]==null)throw new U(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const s=this.name2Id[e];if(s==null)throw new U(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[s]}}disposeMasks(){this.id2Mask!=null&&wt(this.id2Mask)}}const $m=new Kj,Tm=new Kj;function GK(t){$m?.setMaxEntries(t),Tm?.setMaxEntries(t)}function Bu(t,e,s,n){const r=s==null?!1:s.training,i=Array.isArray(t),o=i?t:[t],l=o.map(m=>m.name),c=[],d=e.names();for(const m of l)d.indexOf(m)!==-1?c.push(e.getValue(m)):c.push(null);const u=l.join(",")+"|"+e.names().sort().join(",");let h=$m.get(u),p;if(h==null){const m=HK(o,e);h=m.sorted,p=m.recipientCounts,$m.put(u,h),Tm.put(u,p)}p={},r||Object.assign(p,Tm.get(u));const f=new Lo(e);for(let m=0;m<h.length;++m){const b=h[m],g=b.sourceLayer;if(g instanceof zu)continue;const x=[],y=[],w=[];let v=!1;for(const T of b.inputs){const E=f.getValue(T),$=f.getMask(T);x.push(E),y.push($),$!=null&&(v=!0),r||(p[T.name]--,p[T.name]===0&&!e.hasKey(T)&&l.indexOf(T.name)===-1&&!E.isDisposed&&T.sourceLayer.stateful!==!0&&w.push(E))}v&&(s=s||{},s.mask=y[0]);const N=Ut(g.apply(x,s));let C=null;g.supportsMasking&&(C=g.computeMask(x,y));const j=KK(b),I=Array.isArray(j)?j:[j];for(let T=0;T<I.length;++T){f.hasKey(I[T])||f.add(I[T],N[T],Array.isArray(C)?C[0]:C);const E=l.indexOf(I[T].name);E!==-1&&(c[E]=N[T])}r||wt(w)}return f.disposeMasks(),i?c:c[0]}function HK(t,e){A(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let s=[],n={};if(t.length===1){const r=bI(t[0],e);s=r.sorted,n=r.recipientMap}else{const r=new Set;for(const i of t){const{sorted:o,recipientMap:l}=bI(i,e);for(const c of o)r.has(c.name)||(s.push(c),r.add(c.name));for(const c in l)n[c]==null&&(n[c]=new Set),l[c].forEach(d=>n[c].add(d))}}return{sorted:s,recipientCounts:qK(n)}}function qK(t){const e={};for(const s in t)e[s]=t[s].size;return e}function bI(t,e){const s=new Set,n=[],r={};for(const l of e.names())s.add(l);const i=[],o=[];for(i.push(t);i.length>0;){const l=i[i.length-1];if(s.has(l.name)){i.pop();continue}const c=o[o.length-1]===i.length-1;if(l.inputs.length===0||c)i.pop(),n.push(l),s.add(l.name),c&&o.pop();else{o.push(i.length-1);for(const d of l.inputs)r[d.name]==null&&(r[d.name]=new Set),r[d.name].add(l.name),!s.has(d.name)&&i.push(d)}}return{sorted:n,recipientMap:r}}function KK(t){let e;if(t.sourceLayer.inboundNodes.length===1)e=t.sourceLayer.output;else{let s=null;for(let n=0;n<t.sourceLayer.inboundNodes.length;++n)for(const r of t.sourceLayer.inboundNodes[n].outputTensors)if(r.id===t.id){s=n;break}e=t.sourceLayer.getOutputAt(s)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,GK);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function lw(t,e){return ne(()=>en(st(V(t,t),e,!0)))}class Uu extends lc{getConfig(){return{}}}class yI extends Uu{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ne(()=>{const s=lw(e,this.axis),n=Hn(s,0,this.maxValue);return V(e,nt(n,Te($s(),s)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}yI.className="MaxNorm",Ie(yI);class wI extends Uu{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ne(()=>nt(e,Te($s(),lw(e,this.axis))))}getConfig(){return{axis:this.axis}}}wI.className="UnitNorm",Ie(wI);class vI extends Uu{apply(e){return Wa(e)}}vI.className="NonNeg",Ie(vI);class NI extends Uu{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return ne(()=>{const s=lw(e,this.axis),n=Te(V(this.rate,Hn(s,this.minValue,this.maxValue)),V(1-this.rate,s));return V(e,nt(n,Te($s(),s)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}NI.className="MinMaxNorm",Ie(NI);const kI={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function As(t){return Wy(t)}function CI(t,e={}){return Pu(t,fr.getMap().classNameMap,e,"constraint")}function Ds(t){if(t==null)return null;if(typeof t=="string"){const s={className:t in kI?kI[t]:t,config:{}};return CI(s)}else return t instanceof Uu?t:CI(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Qa(t){if(t==null)return;const e=[],s=[],n=[];for(const r in t){const i=t[r];if(typeof i!="number"){const o=i;e.push(o.data()),s.push(r),n.push(o)}}if(e.length>0){const r=await Promise.all(e);for(let i=0;i<r.length;++i)t[s[i]]=r[i][0];wt(n)}}function SI(t){if(t!=null)for(const e in t){const s=t[e];typeof s!="number"&&s.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var jI;(function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"})(jI||(jI={}));const XK=125;class Vu{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,s){}async onEpochEnd(e,s){}async onBatchBegin(e,s){}async onBatchEnd(e,s){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class YK{constructor(e,s=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=s}append(e){this.callbacks.push(e)}setParams(e){for(const s of this.callbacks)s.setParams(e)}setModel(e){for(const s of this.callbacks)s.setModel(e)}async onEpochBegin(e,s){s==null&&(s={});for(const n of this.callbacks)await n.onEpochBegin(e,s)}async onEpochEnd(e,s){s==null&&(s={});for(const n of this.callbacks)await n.onEpochEnd(e,s)}async onBatchBegin(e,s){s==null&&(s={});for(const n of this.callbacks)await n.onBatchBegin(e,s)}async onBatchEnd(e,s){s==null&&(s={});for(const n of this.callbacks)await n.onBatchEnd(e,s)}async onTrainBegin(e){e==null&&(e={});for(const s of this.callbacks)await s.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const s of this.callbacks)await s.onTrainEnd(e)}}class ZK extends Vu{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,s){s==null&&(s={});const n=s.size==null?0:s.size;this.seen+=n;for(const r in s){const i=s[r];if(typeof i=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+i*n;else{let o;r in this.totals?o=this.totals[r]:this.totals[r]=0;const l=ne(()=>Te(this.totals[r],V(i,n)));this.totals[r]=l,o?.dispose()}}}async onEpochEnd(e,s){if(s!=null)for(const n of this.params.metrics)this.totals[n]!=null&&(typeof this.totals[n]=="number"?s[n]=this.totals[n]/this.seen:ne(()=>{const r=V(nt(1,this.seen),this.totals[n]);s[n]=r,this.totals[n].dispose(),li(s[n])}))}}class JK extends Vu{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,s){s==null&&(s={}),this.epoch.push(e);for(const n in s)this.history[n]==null&&(this.history[n]=[]),this.history[n].push(s[n])}async syncData(){const e=[],s=[],n=[];for(const i in this.history){const o=this.history[i];for(let l=0;l<o.length;++l)if(typeof o[l]!="number"){const c=o[l];e.push(c.data()),s.push(i),n.push(l)}}const r=await Promise.all(e);for(let i=0;i<r.length;++i)this.history[s[i]][n[i]].dispose(),this.history[s[i]][n[i]]=r[i][0]}}class QK extends Vu{constructor(e,s){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||pj,this.yieldEvery=s||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=XK),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");f0(this.yieldEvery)&&(this.maybeWait=pK(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,s,n){const r=[];this.yield!=null&&(await Qa(n),r.push(this.yield(e,s,n))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,s){this.currentEpoch=e,this.epochBegin!=null&&(await Qa(s),await this.epochBegin(e,s))}async onEpochEnd(e,s){const n=[];this.epochEnd!=null&&(await Qa(s),n.push(this.epochEnd(e,s))),this.yieldEvery==="epoch"&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(e,s){this.batchBegin!=null&&(await Qa(s),await this.batchBegin(e,s))}async onBatchEnd(e,s){const n=[];this.batchEnd!=null&&(await Qa(s),n.push(this.batchEnd(e,s))),this.yieldEvery==="batch"?n.push(this.nextFrameFunc()):f0(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,s)),await Promise.all(n)}async onTrainBegin(e){this.trainBegin!=null&&(await Qa(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Qa(e),await this.trainEnd(e))}}function II(t,e){return t==null&&(t={}),t instanceof Vu?[t]:Array.isArray(t)&&t[0]instanceof Vu?t:Ut(t).map(n=>new QK(n,e))}class br{constructor(){}static registerCallbackConstructor(e,s){A(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),br.checkForDuplicate(s),br.constructors[e]==null&&(br.constructors[e]=[]),br.constructors[e].push(s)}static checkForDuplicate(e){for(const s in br.constructors)br.constructors[+s].forEach(r=>{if(r===e)throw new U("Duplicate callback constructor.")})}static clear(){br.constructors={}}static createCallbacks(e){const s=[];for(const n in br.constructors){const r=+n;e>=r&&s.push(...br.constructors[r])}return s.map(n=>new n)}}br.constructors={};function EI(t,e,s,n,r,i,o,l,c){const d=new JK,u=[new ZK,...br.createCallbacks(e)];t!=null&&u.push(...t),u.push(d);const h=new YK(u);return h.setParams({epochs:s,initialEpoch:n,samples:r,steps:i,batchSize:o,verbose:e,doValidation:l,metrics:c}),{callbackList:h,history:d}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yi(t,e={},s=!1){return Pu(t,fr.getMap().classNameMap,e,"layer",s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Am(t,e){return ne(()=>{t.dtype!=="float32"&&(t=Be(t,"float32"));const s=st(Mu(t),e,!0),n=lm(s.shape,$s()),r=en(_o(s,n));return nt(t,r)})}function Dm(t,e){return ne(()=>Cs(Mu(lt(e,t)),-1))}function cw(t,e){return ne(()=>Cs(ln(lt(e,t)),-1))}function dw(t,e){return ne(()=>{const s=lt(t,e),n=Hn(ln(t),$s(),Number.MAX_VALUE),r=ln(nt(s,n));return V(100,Cs(r,-1))})}function eX(t,e){return ne(()=>{const s=Hn(e,$s(),Number.MAX_VALUE),n=hi(Te(1,s)),r=Hn(t,$s(),Number.MAX_VALUE),i=hi(Te(1,r));return Cs(Mu(lt(n,i)),-1)})}function tX(t,e){return ne(()=>{const s=_o(0,lt(1,V(t,e)));return Cs(Mu(s),-1)})}function sX(t,e){return ne(()=>{const s=_o(0,lt(1,V(t,e)));return Cs(s,-1)})}function nX(t,e){return ne(()=>{const s=st(V(t,e),-1),n=Mr(V(lt(1,t),e),-1);return _o(0,Te(1,lt(n,s)))})}function rX(t,e){return ne(()=>{const s=Math.log(2),n=lt(e,t),r=lt(Te(n,ju(V(-2,n))),s);return Cs(r,-1)})}function Wu(t,e,s=!1){return ne(()=>{if(s)e=ty(e);else{const n=st(e,e.shape.length-1,!0);e=nt(e,n)}return e=Hn(e,$s(),1-$s()),gs(st(V(Be(t,"float32"),hi(e)),e.shape.length-1))})}function _m(t,e,s=!1){return ne(()=>{const n=Be(hm(SK(t)),"int32");e=Hn(e,$s(),1-$s());const r=e.shape,i=Z(IS(n,r[r.length-1]),r);return Wu(i,e,s)})}function iX(t,e){if(!Ft(t.shape,e.shape))throw new U(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return ne(()=>{const s=Wa(e),n=gs(ln(e));return Te(lt(s,V(e,t)),kS(ui(n)))})}function Rm(t,e){return ne(()=>{let s;return s=Hn(e,$s(),1-$s()),s=hi(nt(s,lt(1,s))),Cs(iX(t,s),-1)})}function oX(t,e){return ne(()=>{const s=Hn(t,$s(),1),n=Hn(e,$s(),1);return st(V(t,hi(nt(s,n))),-1)})}function aX(t,e){return ne(()=>{const s=hi(Te($s(),e));return Cs(lt(e,V(t,s)),-1)})}function $I(t,e){return ne(()=>{const s=Am(t,-1),n=Am(e,-1),r=V(s,n);return gs(st(r,-1))})}const Pm={meanSquaredError:Dm,meanAbsoluteError:cw,meanAbsolutePercentageError:dw,meanSquaredLogarithmicError:eX,squaredHinge:tX,hinge:sX,categoricalHinge:nX,logcosh:rX,categoricalCrossentropy:Wu,sparseCategoricalCrossentropy:_m,binaryCrossentropy:Rm,kullbackLeiblerDivergence:oX,poisson:aX,cosineProximity:$I};function uw(t){if(typeof t=="string"){if(t in Pm)return Pm[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new U(e)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function TI(t,e){return ne(()=>{const s=V(.5,pr(e)),n=gi(qn(e,s),t.dtype);return Cs(di(t,n),-1)})}function AI(t,e){return ne(()=>gi(di(wu(t,-1),wu(e,-1)),"float32"))}function lX(t,e){return ne(()=>Be(st(Qi(di(t,1),di(e,1))),"float32"))}function cX(t,e){return ne(()=>Be(st(Qi(di(t,0),di(e,1))),"float32"))}function dX(t,e){return ne(()=>{const s=lX(t,e),n=cX(t,e),r=Te(s,n);return Be(cn(qn(r,0),nt(s,r),0),"float32")})}function uX(t,e){return Rm(t,e)}function hX(t,e){return t.rank===e.rank&&(t=Tu(t,[t.rank-1])),e=wu(e,-1),e.dtype!==t.dtype&&(e=Be(e,t.dtype)),Be(di(t,e),"float32")}const pX=Dm,fX=Dm,mX=cw,gX=cw,xX=dw,bX=dw,DI=Wu,yX=$I,_I=_m,Fm={binaryAccuracy:TI,categoricalAccuracy:AI,precision:dX,categoricalCrossentropy:DI,sparseCategoricalCrossentropy:_I,mse:pX,MSE:fX,mae:mX,MAE:gX,mape:xX,MAPE:bX,cosine:yX};function wX(t){if(typeof t=="string"&&t in Fm)return Fm[t];if(typeof t!="string"&&t!=null)return t;throw new U(`Unknown metric ${t}`)}function Om(t){if(mi(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let e;for(const s of Object.keys(Pm))if(Pm[s]===t){e=s;break}if(e!==void 0)return e;for(const s of Object.keys(Fm))if(Fm[s]===t){e=s;break}return e!==void 0?e:t.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function vX(t){const e={Adagrad:()=>cc.adagrad(.01),Adadelta:()=>cc.adadelta(1,.95,$s()),Adam:()=>cc.adam(.001,.9,.999,$s()),Adamax:()=>cc.adamax(.002,.9,.999,$s(),0),RMSProp:()=>cc.rmsprop(.001,.9,0,$s()),SGD:()=>cc.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new U(`Unknown Optimizer ${t}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const RI=1*1024*1024;function PI(t,e,s=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!hw(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(s){const n=JSON.stringify(t);n.length>RI&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${n.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${RI}.`)}}function hw(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const s of e)if(typeof s!="string"||!hw(t[s]))return!1;return!0}else if(Array.isArray(t)){for(const e of t)if(!hw(e))return!1;return!0}else return!1;else{const e=typeof t;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function NX(t,e,s,n=console.log){const r=CX(t),i=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,s=s||[.32,.61,.89,1]):(e=e||115,s=s||[.24,.48,.7,.8,1]),s[s.length-1]<=1&&(s=s.map(u=>Math.floor(e*u)));let o;if(!r){i.push("Receives inputs"),o=[];for(const u in t.nodesByDepth)o.push(...t.nodesByDepth[u])}n("_".repeat(e)),Mm(i,s,n),n("=".repeat(e));const l=t.layers;for(let u=0;u<l.length;++u)r?SX(l[u],s,n):jX(l[u],s,o,n),n((u===l.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const c=kX(t),d=Im(t.nonTrainableWeights);n(`Total params: ${c+d}`),n(`Trainable params: ${c}`),n(`Non-trainable params: ${d}`),n("_".repeat(e))}function kX(t){let e;return t.collectedTrainableWeights!=null?e=Im(t.collectedTrainableWeights):e=Im(t.trainableWeights),e}function CX(t){let e=!0;const s=[],n=[];for(const r in t.nodesByDepth)s.push(t.nodesByDepth[r]);for(const r of s){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}n.push(...r)}if(e)for(const r of t.layers){let i=!1;for(const o of r.inboundNodes)if(n.indexOf(o)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function Mm(t,e,s=console.log){let n="";for(let r=0;r<t.length;++r)r>0&&(n=n.slice(0,n.length-1)+" "),n+=t[r],n=n.slice(0,e[r]),n+=" ".repeat(e[r]-n.length);s(n)}function SX(t,e,s){let n,r;try{r=t.inboundNodes.map(c=>JSON.stringify(c.inputShapes)).join(",")}catch{r="multiple"}try{n=JSON.stringify(t.outputShape)}catch{n="multiple"}const i=t.name,o=t.getClassName(),l=[`${i} (${o})`,r,n,t.countParams().toString()];Mm(l,e,s)}function jX(t,e,s,n){let r,i;try{i=t.inboundNodes.map(h=>JSON.stringify(h.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(t.outputShape)}catch{r="multiple"}const o=[];for(const h of t.inboundNodes)if(!(s!=null&&s.length>0&&s.indexOf(h)===-1))for(let p=0;p<h.inboundLayers.length;++p){const f=h.inboundLayers[p].name,m=h.nodeIndices[p],b=h.tensorIndices[p];o.push(`${f}[${m}][${b}]`)}const l=t.name,c=t.getClassName(),d=o.length===0?"":o[0],u=[`${l} (${c})`,i,r,t.countParams().toString(),d];Mm(u,e,n);for(let h=1;h<o.length;++h)Mm(["","","","",o[h]],e,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function FI(t,e,s){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&e===0&&typeof s=="string"}function Lm(t,e){if(t===null)return null;if(typeof t=="string")return Xa(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const s=[],n=t.length;for(let r=0;r<n;++r){const i=t[r];FI(e,r,i)?s.push(i):s.push(Lm(i,e))}return s}else{const s={};for(const n of Object.keys(t)){const r=t[n];if(n==="name"&&typeof r=="string")s[n]=r;else{const i=Xa(n);s[i]=Lm(r,i)}}return s}}function pw(t,e){if(t==null)return null;if(typeof t=="string")return ro(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const s=[],n=t.length;for(let r=0;r<n;++r){const i=t[r];FI(e,r,i)?s.push(i):s.push(pw(i,e))}return s}else{const s={};for(const n of Object.keys(t)){const r=t[n],i=ro(n);(n==="name"||n==="className")&&typeof r=="string"?s[i]=r:s[i]=pw(r,n)}return s}}/** @license See the LICENSE file. */const OI="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const IX=t=>{const e=Object.keys(t);if(e.length===0)return!1;const s=e[0].split("/");return!isNaN(parseInt(s[s.length-1],10))};class Wr extends kt{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const y=this.getClassName().toLowerCase();this.name=km(y)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Fo(this.inputs).length!==this.inputs.length)throw new U(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(y=>y.name)}`);Fo(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(y=>y.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const y of this.outputs){const w=y.sourceLayer,v=y.nodeIndex,N=y.tensorIndex;this.outputLayers.push(w),this.outputLayersNodeIndices.push(v),this.outputLayersTensorIndices.push(N)}for(const y of this.inputs){const w=y.sourceLayer,v=y.nodeIndex,N=y.tensorIndex;mi(v===0,"input layer has >1 nodes"),mi(N===0,"input layer has >1 tensors"),this.inputLayers.push(w),this.inputLayersNodeIndices.push(v),this.inputLayersTensorIndices.push(N)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let y=0;y<this.inputLayers.length;y++){const w=this.inputLayers[y];if(!(w instanceof zu))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${y} (0-based) originates from layer type ${w.getClassName()}.`);this.inputNames.push(w.name),this.feedInputShapes.push(w.batchInputShape),this.feedInputNames.push(w.name)}for(const y of this.outputLayers)this.outputNames.push(y.name);this.internalInputShapes=this.inputs.map(y=>y.shape),this.internalOutputShapes=this.outputs.map(y=>y.shape);const s={},n={},r={},i={},o={},l=[],c=(y,w,v,N,C,j)=>{(N==null||C==null||j==null)&&(N=y.sourceLayer,C=y.nodeIndex,j=y.tensorIndex);const I=N.inboundNodes[C];if(v.indexOf(I)!==-1)throw new mr(`The tensor ${y.name} at layer "${N.name}" is part of a cycle.`);if(w.indexOf(I)!==-1)return;this.containerNodes.add(Wr.nodeKey(N,C)),N.id in o||(o[N.id]=Object.keys(o).length),v.indexOf(I)===-1&&v.push(I);const T=I.inboundLayers.length;for(let E=0;E<T;E++){const $=I.inputTensors[E],D=I.inboundLayers[E],P=I.nodeIndices[E],_=I.tensorIndices[E];c($,w,v,D,P,_)}for(w.push(I);v.indexOf(I)>=0;)v.splice(v.indexOf(I),1);l.push(I)},d=[],u=[];for(const y of this.outputs)c(y,d,u);const h=l.slice().reverse();for(const y of h){n[y.id]=y,y.id in s||(s[y.id]=0);let w=s[y.id];const v=r[y.outboundLayer.id]==null?0:r[y.outboundLayer.id];w=Math.max(w,v),r[y.outboundLayer.id]=w,i[y.outboundLayer.id]=y.outboundLayer,s[y.id]=w;for(let N=0;N<y.inboundLayers.length;N++){const C=y.inboundLayers[N],j=y.nodeIndices[N],I=C.inboundNodes[j],T=s[I.id]==null?0:s[I.id];s[I.id]=Math.max(w+1,T),n[I.id]=I}}const p={};for(const y in s){const w=s[y];w in p||(p[w]=[]),p[w].push(n[y])}const f={};for(const y in r){const w=r[y];w in f||(f[w]=[]),f[w].push(i[y])}let m=Object.keys(f).map(y=>parseInt(y,10)).sort(vm);this.layers=[];for(const y of m){const w=f[y];w.sort((v,N)=>{const C=o[v.id],j=o[N.id];return C<j?-1:C>j?1:0});for(const v of w)v instanceof Wr&&this.internalContainerRefs.push(v),this.layers.push(v)}this.layersByDepth=f,m=Object.keys(p).map(y=>parseInt(y,10)).sort(vm);const b=this.inputs.slice(),g=[];for(const y of m)for(const w of p[y]){const v=w.outboundLayer;if(v!=null){for(const N of w.inputTensors)if(b.indexOf(N)===-1)throw new mr(`Graph disconnected: cannot obtain value for tensor ${N} at layer "${v.name}". The following previous layers were accessed without issue: ${g}`);for(const N of w.outputTensors)b.push(N);g.push(v.name)}}this.nodesByDepth=p;const x=this.layers.map(y=>y.name);for(const y of x){const w=x.filter(v=>v===y).length;if(w!==1)throw new mr(`The name "${y}" is used ${w} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(x))}this.outboundNodes=[],this.inboundNodes=[],new Em({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(y=>null),outputMasks:this.outputs.map(y=>null),inputShapes:this.inputs.map(y=>y.shape),outputShapes:this.outputs.map(y=>y.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const s of this.layers)e.numDisposedVariables+=s.dispose().numDisposedVariables;for(const s of this.internalContainerRefs)e.numDisposedVariables+=s.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(s=>{s._trainableWeights.forEach(n=>n.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new U("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const s of this.layers)e=e.concat(s.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const s of this.layers)e.push(...s.nonTrainableWeights);if(!this.trainable){const s=[];for(const n of this.layers)s.push(...n.trainableWeights);return s.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,s=!0){const n={};let r=0;const i=IX(e);i&&this.parseWeights(e);for(const l of this.layers)for(const[c,d]of l.weights.entries()){const u=i?`${d.name.split("/").slice(0,-1).join("/")+"/"}${c}`:d.originalName;if(n[u]!=null)throw new U(`Duplicate weight name: ${u}`);n[u]=d,r++}const o=[];for(const l in e){let c=l;if(n[l]==null){const d=l.split("/");c=d.slice(0,-2).concat([d[d.length-1]]).join("/")}if(n[c]!=null)o.push([n[c],e[l]]);else if(s)throw new U(`Provided weight data has no target variable: ${l}`);delete n[c]}if(s){const l=[];for(const c in n)l.push(c);if(l.length>0)throw new U(`${l.length} of ${r} weights are not set: ${l}`)}aw(o)}parseWeights(e){for(const s in Object.keys(e)){const n=s.split("/"),r=["vars","layer_checkpoint_dependencies"],i=n.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!r.includes(o)).join("/");i!==s&&(e[i]=e[s],delete e[s])}}updatedConfig(){const e=this.getConfig(),s={};return s.className=this.getClassName(),s.config=e,s.kerasVersion=`tfjs-layers ${OI}`,s.backend="TensorFlow.js",s}toJSON(e,s=!0){const n=pw(this.updatedConfig());return s?JSON.stringify(n):n}call(e,s){return ne(()=>{e=Ut(e);const n=new Lo;for(let r=0;r<this.inputs.length;++r)n.add(this.inputs[r],e[r]);return Bu(this.outputs,n,s)})}computeMask(e,s){return ne(()=>{e=Ut(e);let n;return s==null?n=Ka(null,e.length):n=Ut(s),this.runInternalGraph(e,n)[1]})}computeOutputShape(e){const s=jm(e);if(s.length!==this.inputLayers.length)throw new U(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const n={};for(let l=0;l<s.length;l++){const c=this.inputLayers[l],d=s[l],u=c.name+"_0_0";n[u]=d}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(vm);if(r.length>1)for(const l of r){const c=this.nodesByDepth[l];for(const d of c){const u=d.outboundLayer;if(this.inputLayers.map(b=>b.id).indexOf(u.id)!==-1)continue;const h=[];for(let b=0;b<d.inboundLayers.length;b++){const g=d.inboundLayers[b],x=d.nodeIndices[b],y=d.tensorIndices[b],w=`${g.name}_${x}_${y}`,v=n[w];h.push(v)}const p=u.computeOutputShape(Cn(h)),f=jm(p),m=u.inboundNodes.indexOf(d);for(let b=0;b<f.length;b++){const g=`${u.name}_${m}_${b}`;n[g]=f[b]}}}const i=[],o=[];for(let l=0;l<this.outputLayers.length;l++){const c=this.outputLayers[l],d=this.outputLayersNodeIndices[l],u=this.outputLayersTensorIndices[l],h=`${c.name}_${d}_${u}`;o.push(h)}for(let l=0;l<o.length;l++){const c=o[l];mi(c in n),i.push(n[c])}return Cn(i)}runInternalGraph(e,s){s==null&&(s=Ka(null,e.length));const n={};for(let c=0;c<this.inputs.length;++c){const d=this.inputs[c],u=e[c],h=s[c];n[d.id]=[u,h]}const r=Object.keys(this.nodesByDepth).map(c=>parseInt(c,10)).sort(vm);for(const c of r){const d=this.nodesByDepth[c];for(const u of d){const h=u.outboundLayer,p=u.inputTensors,f=u.outputTensors,m=new Array;for(const b of p)b.id in n&&m.push(n[b.id]);if(m.length===p.length){let b={},g,x,y,w;if(u.callArgs!=null&&(b=u.callArgs),m.length===1){const[v,N]=m[0];b.mask==null&&(b.mask=N),y=Ut(h.call(v,b)),w=Ut(h.computeMask(v,N)),g=[v],x=[N]}else g=m.map(v=>v[0]),x=m.map(v=>v[1]),b.mask==null&&(b.mask=x),y=Ut(h.call(g,b)),w=Ut(h.computeMask(g,x));if(h.activityRegularizer)throw new bt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let v=0;v<f.length;++v){const N=f[v],C=y[v],j=w[v];n[N.id]=[C,j]}}}}const i=[],o=[],l=[];for(const c of this.outputs){mi(c.id in n,`Could not compute output ${c.name} : ${c.id}`);const[d,u]=n[c.id];l.push(d.shape),i.push(d),o.push(u)}return[i,o,l]}buildNodeConversionMap(e){const s={};let n;for(const r of this.layers){n=r instanceof Wr?1:0;for(let i=0;i<r.inboundNodes.length;i++){const o=Wr.nodeKey(r,i);this.containerNodes.has(o)&&(s[o]=n,n+=1)}}return s}getLayer(e,s){if(s!=null)return this.findLayer(s);if(e==null)throw new U("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const n of this.layers)if(n.name===e)return n;throw new U(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new U(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return ne(()=>{const e=[];for(const s of this.layers)for(let n=0;n<s.inboundNodes.length;++n){const r=Wr.nodeKey(s,n);this.containerNodes.has(r)&&e.push(...s.calculateLosses())}return e})}getConfig(){const e={name:this.name},s=this.buildNodeConversionMap(this.layers),n=[];for(const o of this.layers){const l=o.getClassName(),c=o.getConfig(),d=[];for(let h=0;h<o.inboundNodes.length;h++){const p=o.inboundNodes[h],f=Wr.nodeKey(o,h);let m={};if(this.containerNodes.has(f)){if(p.callArgs)try{JSON.stringify(p.callArgs),m=p.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),m={}}if(p.inboundLayers.length>0){const b=[];for(let g=0;g<p.inboundLayers.length;g++){const x=p.inboundLayers[g],y=p.nodeIndices[g],w=p.tensorIndices[g],v=Wr.nodeKey(x,y);let N=s[v];N==null&&(N=0),b.push([x.name,N,w,m])}d.push(b)}}}const u={};u.name=o.name,u.className=l,u.config=c,u.inboundNodes=d,n.push(u)}e.layers=n;const r=[];for(let o=0;o<this.inputLayers.length;o++){const l=this.inputLayers[o],c=this.inputLayersNodeIndices[o],d=Wr.nodeKey(l,c);if(!this.containerNodes.has(d))continue;let u=s[d];u==null&&(u=0);const h=this.inputLayersTensorIndices[o];r.push([l.name,u,h])}e.inputLayers=r;const i=[];for(let o=0;o<this.outputLayers.length;o++){const l=this.outputLayers[o],c=this.outputLayersNodeIndices[o],d=Wr.nodeKey(l,c);if(!this.containerNodes.has(d))continue;let u=s[d];u==null&&(u=0);const h=this.outputLayersTensorIndices[o];i.push([l.name,u,h])}return e.outputLayers=i,e}static fromConfig(e,s,n={},r=!1){const i={},o={};function l(g,x){g.name in o?o[g.name].push(x):o[g.name]=[x]}function c(g,x){const y=[];let w;for(const v of x){const N=v[0],C=v[1],j=v[2];if(w=v[3]==null?{}:v[3],!(N in i)){l(g,x);return}const I=i[N];if(I.inboundNodes.length<=C){l(g,x);return}const T=I.inboundNodes[C];y.push(T.outputTensors[j])}y.length>0&&g.apply(Cn(y),w)}function d(g){const x=g.name,y=yi(g,s.customObjects!=null?s.customObjects:{});y.setFastWeightInitDuringBuild(r),i[x]=y,g.inboundNodes.forEach(v=>{if(!(v instanceof Array))throw new U(`Corrupted configuration, expected array for nodeData: ${v}`);l(y,v)})}const u=s.name,h=s.layers;for(const g of h)d(g);for(;!hK(o);)for(const g of h){const x=i[g.name];if(x.name in o){const y=o[x.name];delete o[x.name];for(const w of y)c(x,w)}}const p=[],f=[],m=s.inputLayers;for(const g of m){const x=g[0],y=g[1],w=g[2];mi(x in i);const N=i[x].inboundNodes[y].outputTensors;p.push(N[w])}const b=s.outputLayers;for(const g of b){const x=g[0],y=g[1],w=g[2];mi(x in i);const N=i[x].inboundNodes[y].outputTensors;f.push(N[w])}return new e({inputs:p,outputs:f,name:u})}get stateful(){if(this._stateful)throw new U("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){ne(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function EX(t,e,s){const n=e.length;if(t==null||Array.isArray(t)&&t.length===0)return e.map(r=>null);if(n===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==n)throw new Error(`Provided ${s} is an array of ${t.length} element(s), but the model has ${n} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){const r=[];return e.forEach(i=>{i in t?r.push(t[i]):r.push(null)}),r}else throw new Error(`The model has multiple (${n}) outputs, so ${s} must be either an array with ${n} elements or an object with ${e} keys. Provided ${s} not understood: ${JSON.stringify(t)}`)}function MI(t,e){return EX(t,e,"classWeight")}async function LI(t,e,s,n){if(s!=null){const r=ne(()=>{if(t.shape.length===1)return Oa(t);if(t.shape.length===2){if(t.shape[1]>1)return wu(t,1);if(t.shape[1]===1)return Z(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await r.data());wt(r);const o=[];return i.forEach(l=>{if(s[l]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${l} exists in the data but not in classWeight`);o.push(s[l])}),Pn(o,"float32")}else return null}function $X(t,e){return V(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const TX=32;function zI(t,e){let s,n;const r=e;s=r.xs,n=r.ys,A(s!=null&&n!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=BI("input",t.inputNames,s),o=BI("output",t.outputNames,n),l=i[0].shape[0];A(i.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),A(o.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let c=0;c<i.length;c++)A(i[c].shape[0]===l,()=>`Batch size mismatch: input ${t.inputNames[c]} has ${i[c].shape[0]}; expected  ${l} based on input ${t.inputNames[0]}.`);for(let c=0;c<o.length;c++)A(o[c].shape[0]===l,()=>`Batch size mismatch: output ${t.outputNames[c]} has ${o[c].shape[0]}; expected  ${l} based on input ${t.inputNames[0]}.`);return{xs:i,ys:o}}function BI(t,e,s){if(s instanceof Is)return[s];if(Array.isArray(s))return A(s.length===e.length,()=>`Received an array of ${s.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),s;{const n=[];for(const r of e){if(s[r]==null)throw new U(`The feature data generated by the dataset lacks the required ${t} key '${r}'.`);n.push(s[r])}return n}}function AX(t){if(t.length===3)throw new bt("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function DX(t,e,s){const n=s.batchesPerEpoch!=null;if(A(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),A(s!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),A(s.epochs!=null&&s.epochs>0&&Number.isInteger(s.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${s.epochs}`),A(!n||s.batchesPerEpoch>0&&Number.isInteger(s.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${s.batchesPerEpoch}`),A(s.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const r=s.validationData!=null;let i,o;if(r)if(UI(s.validationData))A(s.validationBatches==null||s.validationBatches>0&&Number.isInteger(s.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${s.validationBatches}`);else{const g=AX(s.validationData);i=g.xs,o=g.ys}const l=t.makeTrainFunction(),c=t.getDedupedMetricsNames();let d;r?d=c.slice().concat(c.map(g=>"val_"+g)):d=c.slice();const u=II(s.callbacks,s.yieldEvery),h=s.verbose==null?1:s.verbose,{callbackList:p,history:f}=EI(u,h,s.epochs,null,null,_X(e,s),null,r,d);p.setModel(t),t.history=f,await p.onTrainBegin(),t.stopTraining_=!1;let m=s.initialEpoch==null?0:s.initialEpoch,b=await e.iterator();for(;m<s.epochs;){const g={};await p.onEpochBegin(m);let x=0,y=0;for(n||(b=await e.iterator());!n||x<s.batchesPerEpoch;){const w=await b.next();if(n&&w.done){console.warn(`You provided \`batchesPerEpoch\` as ${s.batchesPerEpoch}, but your dataset iterator ran out of data after ${x} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${s.batchesPerEpoch*s.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(w.value!=null){const{xs:v,ys:N}=zI(t,w.value),C={};C.batch=y,C.size=v[0].shape[0],await p.onBatchBegin(y,C);const j=[];if(s.classWeight!=null){const E=MI(s.classWeight,t.outputNames);for(let $=0;$<E.length;++$)j.push(await LI(N[$],null,E[$]))}const I=v.concat(N).concat(j),T=l(I);wt(I);for(let E=0;E<c.length;++E){const $=c[E],D=T[E];C[$]=D,li(D)}await p.onBatchEnd(y,C),SI(C),y++,x++}if(n?x>=s.batchesPerEpoch:w.done){if(r){let v;UI(s.validationData)?v=Ut(await t.evaluateDataset(s.validationData,{batches:s.validationBatches})):v=Ut(t.evaluate(i,o,{batchSize:s.validationBatchSize==null?TX:s.validationBatchSize,verbose:0}));for(let N=0;N<t.metricsNames.length;++N)g[`val_${t.metricsNames[N]}`]=v[N]}break}if(t.stopTraining_)break}if(await p.onEpochEnd(m,g),m++,t.stopTraining_)break}return await p.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function _X(t,e){let s=null;return e.batchesPerEpoch!=null?s=e.batchesPerEpoch:Number.isFinite(t.size)&&(s=t.size),s}function UI(t){return typeof t.iterator=="function"}function RX(t){return typeof t.next=="function"}async function PX(t,e,s){s=s||{};const n=s.batches!=null,r=t.testFunction;let i=[];if(s.verbose>0)throw new bt("Verbose mode is not implemented yet.");A(!n||s.batches>0&&Number.isInteger(s.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(s.batches)}`);const o=RX(e)?e:await e.iterator();let l=0,c=0;for(;!n||c<s.batches;){const d=await o.next();if(i=ne(()=>{if(d.value){const{xs:u,ys:h}=zI(t,d.value),p=u.concat(h),f=ne(()=>r(p));if(wt(p),c===0)for(let b=0;b<f.length;++b)i.push(Mt(0));const m=p[0].shape[0];for(let b=0;b<f.length;++b){const g=f[b],x=i[b];i[b]=ne(()=>Te(i[b],V(m,g))),c>0&&wt(x)}wt(f),l+=m,++c}return i}),d.done){n&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${s.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let d=0;d<i.length;++d){const u=i[d];i[d]=nt(i[d],l),wt(u)}return Cn(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fw(t){A(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function Gu(t,e,s){return t==null?[null]:Array.isArray(t)?t.map(n=>Ja(n,e,s-e)):Ja(t,e,s-e)}function mw(t,e){return ne(()=>t==null?null:Array.isArray(t)?t.map(s=>mw(s,e)):iI(t,e.dtype==="int32"?e:Be(e,"int32")))}function gw(t,e){const s=[];let n=0,r=null;for(;n<t;)r=n+e,r>=t&&(r=t),s.push([n,r]),n=r;return s}function VI(t){const e=[];t instanceof Is&&(t=[t]);for(let s=0;s<t.length;++s){const n=t[s];if(n.rank===1)e.push(Ou(n,1));else{if(n.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(n)}}return e}function Gr(t,e){if(t==null)return;const s=[];if(e instanceof Is)s.push(e.id);else if(Array.isArray(e))e.forEach(r=>s.push(r.id));else if(e!=null)for(const r in e){const i=e[r];s.push(i.id)}const n=[];if(t instanceof Is)s.indexOf(t.id)===-1&&n.push(t);else if(Array.isArray(t))t.forEach(r=>{s.indexOf(r.id)===-1&&n.push(r)});else if(t!=null)for(const r in t){const i=t[r];s.indexOf(i.id)===-1&&n.push(i)}n.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function FX(t){return t instanceof Is}function xw(t){return Array.isArray(t)}function WI(t){return!FX(t)&&!xw(t)}function GI(t,e,s,n=!0,r=""){if(e==null||e.length===0){if(t!=null){let o=!1;if(xw(t)&&t.length>0)o=!0;else if(WI(t)){for(const l in t)if(t.hasOwnProperty(l)){o=!0;break}}else o=!0;if(o)throw new U(`Error when checking model ${r} expected no data, but got ${t}`)}return[]}if(t==null)return e.map(o=>null);let i;if(WI(t)){t=t,i=[];for(const o of e){if(t[o]==null)throw new U(`No data provided for "${o}". Need data for each key in: ${e}`);i.push(t[o])}}else if(xw(t)){if(t=t,t.length!==e.length)throw new U(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);i=t}else{if(t=t,e.length>1)throw new U(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);i=[t]}if(i=VI(i),s!=null)for(let o=0;o<e.length;++o){if(s[o]==null)continue;const l=i[o];if(l.shape.length!==s[o].length)throw new U(`Error when checking ${r}: expected ${e[o]} to have ${s[o].length} dimension(s). but got array with shape ${l.shape}`);for(let c=0;c<s[o].length;++c){if(c===0&&!n)continue;const d=l.shape[c],u=s[o][c];if(u!=null&&u>=0&&d!==u)throw new U(`${r} expected a batch of elements where each example has shape [${s[o].slice(1,s[o].length)}] (i.e.,tensor shape [*,${s[o].slice(1,s[o].length)}]) but the ${r} received an input with ${l.shape[0]} examples, each with shape [${l.shape.slice(1,l.shape.length)}] (tensor shape [${l.shape}])`)}}return i}function OX(t,e,s){const n=Fo(t.map(i=>i.shape[0]));n.sort();const r=Fo(e.map(i=>i.shape[0]));if(r.sort(),n.length>1)throw new U(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(i=>i.shape))}`);if(r.length>1)throw new U(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(n.length>0&&r.length>0&&!Ft(n,r))throw new U(`Input Tensors should have the same number of samples as target Tensors. Found ${n[0]} input sample(s) and ${r[0]} target sample(s).`)}function MX(t,e,s){const n=[Dm,Rm,Wu];for(let r=0;r<t.length;++r){const i=t[r],o=e[r],l=s[r];if(o!=null){if(o===Wu&&i.shape[i.shape.length-1]===1)throw new U(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(n.indexOf(o)!==-1){const c=i.shape.slice(1),d=l.slice(1);for(let u=0;u<c.length;++u){const h=c[u],p=d[u];if(p!=null&&h!==p)throw new U(`A target Tensor with shape ${i.shape} was passed for an output of shape ${l}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function HI(t,e,s,n=!0,r=""){let i;if(Array.isArray(t)){if(t.length!==e.length)throw new U(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);i=t}else{if(e.length>1)throw new U(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);i=[t]}if(s!=null)for(let o=0;o<e.length;++o){if(s[o]==null)continue;const l=i[o];if(l.shape.length!==s[o].length)throw new U(`Error when checking ${r}: expected ${e[o]} to have ${s[o].length} dimension(s), but got array with shape ${JSON.stringify(l.shape)}`);for(let c=0;c<s[o].length;++c){if(c===0&&!n)continue;const d=l.shape[c],u=s[o][c];if(u!=null&&u!==d)throw new U(`Error when checking ${r}: expected ${e[o]} to have shape ${JSON.stringify(s[o])} but got array with shape ${JSON.stringify(l.shape)}.`)}}}function LX(t,e){if(t==null||Array.isArray(t)&&t.length===0)return e.map(n=>[]);let s;if(typeof t=="string"||typeof t=="function")s=[t];else if(Array.isArray(t)||typeof t=="object")s=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(s))return e.map(n=>s);{const n=[];for(const r of e){let i=s.hasOwnProperty(r)?s[r]:[];Array.isArray(i)||(i=[i]),n.push(i)}return n}}const zX="layers-model";class hc extends Wr{constructor(e){super(e),this.isTraining=!1}summary(e,s,n=console.log){if(!this.built)throw new U("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");NX(this,e,s,n)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=vX(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Po))throw new U("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let s=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new U(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),s.push(uw(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new U(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);s=e.loss.map(l=>uw(l))}else{const o=uw(e.loss);this.outputs.forEach(l=>{s.push(o)})}this.lossFunctions=s,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const l=this.internalOutputShapes[o],c=this.outputNames[o];this.feedOutputNames.push(c),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[o])}const n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Za("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(n.indexOf(o)!==-1)continue;const l=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([l,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const r=LX(e.metrics,this.outputNames),i=(o,l,c)=>{this.outputNames.length>1&&(l=this.outputNames[o]+"_"+l),this.metricsNames.push(l),this.metricsTensors.push([c,o])};Za("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(n.indexOf(o)!==-1)continue;const l=r[o];(d=>{const u="";let h,p,f;for(const m of d){if(typeof m=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(m)!==-1){const g=this.internalOutputShapes[o];g[g.length-1]===1||this.lossFunctions[o]===Rm?["accuracy","acc"].indexOf(m)!==-1?p=TI:["crossentropy","ce"].indexOf(m)!==-1&&(p=uX):this.lossFunctions[o]===_m?["accuracy","acc"].indexOf(m)!==-1?p=hX:["crossentropy","ce"].indexOf(m)!==-1&&(p=_I):["accuracy","acc"].indexOf(m)!==-1?p=AI:["crossentropy","ce"].indexOf(m)!==-1&&(p=DI);let x;["accuracy","acc"].indexOf(m)!==-1?x="acc":["crossentropy","ce"].indexOf(m)!==-1&&(x="ce"),f=p,h=u+x}else f=wX(m),h=u+Om(m);let b;Za(h,()=>{b=f}),i(o,h,b)}})(l)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,s,n={}){const r=n.batchSize==null?32:n.batchSize;fw(r);const o=this.standardizeUserDataXY(e,s,!0,r);try{const l=o[0].concat(o[1]);this.makeTestFunction();const c=this.testFunction,d=this.testLoop(c,l,r,n.verbose,n.steps);return Cn(d)}finally{Gr(o[0],e),Gr(o[1],s)}}async evaluateDataset(e,s){return this.makeTestFunction(),PX(this,e,s)}checkNumSamples(e,s,n,r="steps"){let i;if(n!=null){if(i=null,s!=null)throw new U(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${s}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new U(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return i}execute(e,s){if(Array.isArray(s)&&s.length===0)throw new U("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(s),r=n?s:[s],i=this.retrieveSymbolicTensors(r),o=new Lo;if(e instanceof Is&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new U(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let c=0;c<this.inputs.length;++c)o.add(this.inputs[c],e[c])}else for(const c of this.inputs){const d=e[c.name];if(d==null)throw new U(`No value is provided for the model's input ${c.name}`);o.add(c,d)}const l=Bu(i,o);return n?l:l[0]}retrieveSymbolicTensors(e){const s=Ka(null,e.length);let n=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],o=i.map(l=>l.name);for(let l=0;l<e.length;++l){const c=o.indexOf(e[l]);if(c!==-1&&(s[l]=i[c],n--),n===0)break}if(n===0)break}if(n>0){const r=[];throw s.forEach((i,o)=>{i==null&&r.push(e[o])}),new U(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return s}predictLoop(e,s=32,n=!1){return ne(()=>{const r=this.checkNumSamples(e);if(n)throw new bt("Verbose predictLoop() is not implemented yet.");const i=gw(r,s),o=this.outputs.map(l=>[]);for(let l=0;l<i.length;++l)ne(()=>{const d=i[l][0],u=i[l][1],h=Gu(e,d,u),p=[];if(Array.isArray(h))for(let m=0;m<h.length;++m)p.push({key:this.inputs[m],value:h[m]});else p.push({key:this.inputs[0],value:h});const f=new Lo(p);return Bu(this.outputs,f)}).forEach((d,u)=>o[u].push(d));return Cn(o.map(l=>Nn(l,0)))})}predict(e,s={}){const n=VI(e);HI(n,this.inputNames,this.feedInputShapes,!1);try{const r=s.batchSize==null?32:s.batchSize;return fw(r),this.predictLoop(n,r)}finally{Gr(n,e)}}predictOnBatch(e){HI(e,this.inputNames,this.feedInputShapes,!0);const s=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,s)}standardizeUserDataXY(e,s,n=!0,r){if(this.optimizer_==null)throw new mr("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const l=this.feedOutputShapes[o];this.feedLossFns[o]===_m?i.push(l.slice(0,l.length-1).concat([1])):i.push(l)}if(e=GI(e,this.feedInputNames,this.feedInputShapes,!1,"input"),s=GI(s,this.feedOutputNames,i,!1,"target"),OX(e,s),MX(s,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new U(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,s]}async standardizeUserData(e,s,n,r,i=!0,o){const[l,c]=this.standardizeUserDataXY(e,s,i,o);if(n!=null)throw new Error("sample weight is not supported yet.");let d=null;if(r!=null){const u=MI(r,this.outputNames);d=[];for(let h=0;h<u.length;++h)d.push(await LI(c[h],null,u[h]))}return[l,c,d]}testLoop(e,s,n,r=0,i){return ne(()=>{const o=this.checkNumSamples(s,n,i,"steps"),l=[];if(r>0)throw new bt("Verbose mode is not implemented yet.");if(i!=null)throw new bt("steps mode in testLoop() is not implemented yet");{const c=gw(o,n),d=Pn(Br(0,o));for(let u=0;u<c.length;++u){const h=c[u][0],p=c[u][1],f=Ja(d,h,p-h),m=mw(s,f),b=e(m);if(u===0)for(let g=0;g<b.length;++g)l.push(Mt(0));for(let g=0;g<b.length;++g){const x=b[g];l[g]=Te(l[g],V(p-h,x))}}for(let u=0;u<l.length;++u)l[u]=nt(l[u],o)}return l})}getDedupedMetricsNames(){const e=this.metricsNames,s=[];for(let n=0;n<e.length;++n){const r=e[n];let i=r;if(Xj(e,r)>1){const o=Xj(e.slice(0,n),r);i+=`_${o}`}s.push(i)}return s}makeTrainFunction(){return e=>{const s=[],n=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],l=()=>{const h=[];for(let b=0;b<this.inputs.length;++b)h.push({key:this.inputs[b],value:n[b]});const p=new Lo(h),f=Bu(this.outputs,p,{training:!0});let m;for(let b=0;b<this.lossFunctions.length;++b){const g=this.lossFunctions[b];let x=g(r[b],f[b]);i[b]!=null&&(x=$X(x,i[b]));const y=Cs(x);s.push(y),b===0?m=x:m=Te(m,x)}for(let b=0;b<this.metricsTensors.length;++b){let g;if(this.outputs.length>1&&b<this.outputs.length)g=s[b];else{const x=this.metricsTensors[b][0],y=this.metricsTensors[b][1];g=Cs(x(r[y],f[y]))}li(g),o.push(g)}return m=Cs(m),this.calculateLosses().forEach(b=>{m=Te(m,b)}),m},c=this.collectedTrainableWeights.map(h=>h.read());return[this.optimizer_.minimize(l,!0,c)].concat(o)}}makeTestFunction(){this.testFunction=e=>ne(()=>{const s=[];let n;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let d=0;d<this.inputs.length;++d)o.push({key:this.inputs[d],value:r[d]});const l=new Lo(o),c=Bu(this.outputs,l);for(let d=0;d<this.lossFunctions.length;++d){const u=this.lossFunctions[d],h=Cs(u(i[d],c[d]));d===0?n=h:n=Te(n,h),s.push(n)}for(let d=0;d<this.metricsTensors.length;++d){const u=this.metricsTensors[d][0],h=this.metricsTensors[d][1],p=Cs(u(i[h],c[h]));s.push(p)}return s})}async fit(e,s,n={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,i,o,l,c,d,u,h,p;try{const f=n.batchSize==null?32:n.batchSize;fw(f);const b=await this.standardizeUserData(e,s,n.sampleWeight,n.classWeight,!1,f);r=b[0],i=b[1],p=b[2];let g=!1,x;if(n.validationData!=null&&n.validationData.length>0){if(g=!0,n.validationData.length===2)c=n.validationData[0],d=n.validationData[1];else throw n.validationData.length===3?new bt("validationData including sample weights is not supported yet."):new U(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${n.validationData} is invalid.`);const E=await this.standardizeUserData(c,d,null,null,!0,f);u=E[0],h=E[1],x=u.concat(h)}else if(n.validationSplit!=null&&n.validationSplit>0&&n.validationSplit<1){g=!0;const T=Math.floor(r[0].shape[0]*(1-n.validationSplit)),E=r[0].shape[0];u=Gu(r,T,E),o=r,r=Gu(r,0,T),h=Gu(i,T,E),l=i,i=Gu(i,0,T),x=u.concat(h)}else n.validationSteps!=null&&(g=!0);const y=r.concat(i).concat(p);this.checkTrainableWeightsConsistency();const w=this.makeTrainFunction(),v=this.getDedupedMetricsNames();let N,C;g?(this.makeTestFunction(),N=this.testFunction,C=v.slice().concat(v.map(T=>"val_"+T))):(N=null,x=[],C=v.slice());const j=II(n.callbacks,n.yieldEvery);return await this.fitLoop(w,y,v,f,n.epochs,n.verbose,j,N,x,n.shuffle,C,n.initialEpoch,null,null)}finally{this.isTraining=!1,Gr(r,e),Gr(i,s),Gr(o,e),Gr(l,s),Gr(u,c),Gr(h,d),p!=null&&wt(p)}}async fitLoop(e,s,n,r,i,o,l,c,d,u,h,p,f,m){r==null&&(r=32),i==null&&(i=1),u==null&&(u=!0),p==null&&(p=0);let b=!1;if(c!=null&&d!=null&&(b=!0),m!=null&&(b=!0,f==null))throw new U("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const g=this.checkNumSamples(s,r,f,"steps_per_epoch");let x;g!=null&&(x=Br(0,g)),o==null&&(o=1);const{callbackList:y,history:w}=EI(l,o,i,p,g,f,r,b,h);y.setModel(this),this.history=w,await y.onTrainBegin(),this.stopTraining_=!1;for(let v=p;v<i;++v){await y.onEpochBegin(v);const N={};if(f!=null)throw new bt("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new bt("batch shuffling is not implemneted yet");u&&hU(x);const C=Pn(x),j=gw(g,r);for(let I=0;I<j.length;++I){const T={};if(await y.onBatchBegin(I,T),ne(()=>{const E=j[I][0],$=j[I][1],D=Ja(C,E,$-E);T.batch=I,T.size=$-E;const P=mw(s,D),_=e(P);for(let O=0;O<n.length;++O){const R=n[O],X=_[O];T[R]=X,li(X)}if(I===j.length-1&&b){const O=this.testLoop(c,d,r);for(let R=0;R<n.length;++R){const X=n[R],L=O[R];li(L),N["val_"+X]=L}}}),await y.onBatchEnd(I,T),SI(T),this.stopTraining_)break}C.dispose()}if(await y.onEpochEnd(v,N),this.stopTraining_)break}return await y.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,s){return DX(this,e,s)}async trainOnBatch(e,s){const n=await this.standardizeUserData(e,s),r=n[0],i=n[1],l=this.makeTrainFunction()(r.concat(i)),c=[];for(const d of l){const u=await d.data();c.push(u[0])}return wt(l),Gr(n[0],e),Gr(n[1],s),Cn(c)}getNamedWeights(e){const s=[],n=e!=null&&e.trainableOnly,r=n?this.trainableWeights:this.weights,i=this.getWeights(n);for(let o=0;o<r.length;++o)n&&!r[o].trainable||s.push({name:r[o].originalName,tensor:i[o]});return s}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const s=QC().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=s-QC().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=ro(this.loss);else if(Array.isArray(this.loss)){for(const s of this.loss)if(typeof s!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(s=>ro(s))}else{const s=Object.keys(this.loss);e={};const n=this.loss;for(const r of s)if(typeof n[r]=="string")e[r]=ro(n[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[ro(Om(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>ro(Om(e)));{const e={};for(const s in this.metrics)e[s]=ro(Om(this.metrics[s]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const s=Lm(e.optimizer_config),n=yi(s);let r;if(typeof e.loss=="string")r=Xa(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(o=>Xa(o));else if(e.loss!=null){r={};for(const o in e.loss)r[o]=Xa(e.loss[o])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(o=>Xa(o));else if(e.metrics!=null){i={};for(const o in e.metrics)i[o]=Xa(e.metrics[o])}this.compile({loss:r,metrics:i,optimizer:n})}async save(e,s){if(typeof e=="string"){const d=xV(e);if(d.length===0)throw new U(`Cannot find any save handlers for URL '${e}'`);if(d.length>1)throw new U(`Found more than one (${d.length}) save handlers for URL '${e}'`);e=d[0]}if(e.save==null)throw new U("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await tS(this.getNamedWeights(s)),l={modelTopology:this.toJSON(null,!1),format:zX,generatedBy:`TensorFlow.js tfjs-layers v${OI}`,convertedBy:null};if((s==null?!1:s.includeOptimizer)&&this.optimizer!=null){l.trainingConfig=this.getTrainingConfig();const d="optimizer",{data:u,specs:h}=await tS(await this.optimizer.getWeights(),d);n.specs.push(...h),n.data=cV([n.data,u])}return this.userDefinedMetadata!=null&&(PI(this.userDefinedMetadata,this.name,!0),l.userDefinedMetadata=this.userDefinedMetadata),l.weightData=n.data,l.weightSpecs=n.specs,e.save(l)}setUserDefinedMetadata(e){PI(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}hc.className="Model",Ie(hc);class qI extends hc{}qI.className="Functional",Ie(qI);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function BX(t,e){if(e==null&&(e={}),typeof t=="string"){const s=bV(t,e);if(s.length===0)s.push(X8(t,e));else if(s.length>1)throw new U(`Found more than one (${s.length}) load handlers for URL '${t}'`);t=s[0]}return UX(t,void 0,e)}async function UX(t,e,s){if(s==null&&(s={}),t.load==null)throw new U("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const n=await t.load();let r=n.modelTopology;r.model_config!=null&&(r=r.model_config);const i=s.strict==null?!0:s.strict,o=n.weightData!=null&&n.weightSpecs!=null&&i,l=yi(Lm(r),e,o),c=n.trainingConfig;if(c!=null&&l.loadTrainingConfig(c),n.userDefinedMetadata!=null&&l.setUserDefinedMetadata(n.userDefinedMetadata),n.weightData!=null){if(n.weightSpecs==null)throw new U("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:d,optimizerWeights:u}=VX(n.weightData,n.weightSpecs);l.loadWeights(d,i),l.optimizer!=null&&u.length>0&&await l.optimizer.setWeights(u),wt(d),wt(u.map(h=>h.tensor))}return l}function VX(t,e){const s=nV(t,e),n={},r=[];return e.forEach(i=>{i.group==="optimizer"?r.push({name:i.name,tensor:s[i.name]}):n[i.name]=s[i.name]}),{modelWeights:n,optimizerWeights:r}}class pc extends hc{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:km("sequential_"),e.layers!=null)for(const s of e.layers)this.add(s)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(n=>n<0))throw new U(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const s=e instanceof pc||e instanceof hc;let n;if(s){if(n=e,n.outputs.length!==1)throw new U("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(n.inputs.length!==1)throw new U("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new U("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=VK({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(s)this.outputs=n.outputs,this.inputs=n.inputs;else{if(e.inboundNodes.length!==1)throw new U(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new U("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=xI(this.outputs[0])}this.inboundNodes=[],new Em({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Ka(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,s){return this.model==null&&this.build(),this.model.call(e,s)}build(e){if(_t(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new hc({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,s,n=console.log){this.built||this.build(),super.summary(e,s,n)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,s,n={}){if(!this.built)throw new mr("The model needs to be compiled before being used.");return this.model.evaluate(e,s,n)}async evaluateDataset(e,s){if(!this.built)throw new mr("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,s)}predict(e,s={}){return this.model==null&&this.build(),this.model.predict(e,s)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,s,n={}){if(!this.built)throw new mr("The model needs to be compiled before being used.");return this.model.fit(e,s,n)}async fitDataset(e,s){if(!this.built)throw new mr("The model needs to be compiled before being used.");return this.model.fitDataset(e,s)}async trainOnBatch(e,s){return this.model.trainOnBatch(e,s)}static fromConfig(e,s,n={},r=!1){let i,o={};if(s instanceof Array){if(s[0].className==null||s[0].className==="Merge")throw new U("Legacy serialization format not supported yet.");i=s}else A(s.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=s.layers,delete s.layers,o=s;const l=new e(o);if(!(l instanceof pc))throw new bt(`Sequential.fromConfig called on non-Sequential input: ${l}`);for(const c of i){const u=yi(c,void 0,r);r&&u.setFastWeightInitDuringBuild(!0),l.add(u)}return l}set stopTraining(e){if(this.model==null)throw new U("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new U("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const s of this.layers){const n={};n.className=s.getClassName(),n.config=s.getConfig(),e.push(n)}return{name:this.name,layers:e}}}pc.className="Sequential",Ie(pc);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function WX(t){return new pc(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let tn=class extends lc{getConfig(){return{}}};class KI extends tn{apply(e,s=1){return IK(e,s)}}KI.className="elu",Ie(KI);class XI extends tn{apply(e){return _S(e)}}XI.className="selu",Ie(XI);class YI extends tn{apply(e){return Wa(e)}}YI.className="relu",Ie(YI);class ZI extends tn{apply(e){return ne(()=>Iu(6,Wa(e)))}}ZI.className="relu6",Ie(ZI);class JI extends tn{apply(e){return e}}JI.className="linear",Ie(JI);class QI extends tn{apply(e){return nc(e)}}QI.className="sigmoid",Ie(QI);class eE extends tn{apply(e){return $K(e)}}eE.className="hardSigmoid",Ie(eE);class tE extends tn{apply(e){return ju(e)}}tE.className="softplus",Ie(tE);class sE extends tn{apply(e){return EK(e)}}sE.className="softsign",Ie(sE);class nE extends tn{apply(e){return om(e)}}nE.className="tanh",Ie(nE);let bw=class extends tn{apply(e,s=-1){return ty(e,s)}};bw.className="softmax",Ie(bw);class rE extends tn{apply(e,s=-1){return CS(e,s)}}rE.className="logSoftmax",Ie(rE);class iE extends tn{apply(e){return ne(()=>ne(()=>{const s=Math.sqrt(2),n=V(.5,Te(1,yS(nt(e,s))));return V(e,n)}))}}iE.className="gelu",Ie(iE);class oE extends tn{apply(e){return ne(()=>V(.5,V(e,Te(1,om(V(en(nt(2,Math.PI)),Te(e,V(.044715,Ba(e,3)))))))))}}oE.className="gelu_new",Ie(oE);class aE extends tn{apply(e){return ne(()=>V(e,om(ju(e))))}}aE.className="mish",Ie(aE);class lE extends tn{apply(e,s=1){return ne(()=>V(nc(V(e,s)),e))}}lE.className="swish",Ie(lE);function zo(t){return t.getClassName()}function yw(t,e={}){return Pu(t,fr.getMap().classNameMap,e,"activation")}function Bo(t){if(t==null){const e={};return e.className="linear",e.config={},yw(e)}if(typeof t=="string"){const e={};return e.className=t,e.config={},yw(e)}else return t instanceof tn?t:yw(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function GX(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}class cE extends lc{}class dE extends cE{constructor(e){super(),GX(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return ne(()=>{let s=Os([1]);return this.hasL1&&(s=Te(s,st(V(this.l1,ln(e))))),this.hasL2&&(s=Te(s,st(V(this.l2,Mu(e))))),Z(s,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,s){return new e({l1:s.l1,l2:s.l2})}}dE.className="L1L2",Ie(dE);const uE={l1l2:"L1L2"};function Kt(t){return Wy(t)}function hE(t,e={}){return Pu(t,fr.getMap().classNameMap,e,"regularizer")}function as(t){if(t==null)return null;if(typeof t=="string"){const s={className:t in uE?uE[t]:t,config:{}};return hE(s)}else return t instanceof cE?t:hE(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class pE extends kt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,s){e=dt(e);let n=Wa(e);return this.maxValue!=null&&(n=Hn(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},s=super.getConfig();return Object.assign(e,s),e}}pE.className="ReLU",Ie(pE);class fE extends kt{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,s){const n=dt(e);return Lb(n,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},s=super.getConfig();return Object.assign(e,s),e}}fE.className="LeakyReLU",Ie(fE);class mE extends kt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=os(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=as(e.alphaRegularizer),this.alphaConstraint=Ds(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new U(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=_t(e);const s=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)s[r-1]=1;this.alpha=this.addWeight("alpha",s,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)n[r]=e[r];this.inputSpec=[new Ts({ndim:e.length,axes:n})],this.built=!0}call(e,s){return e=dt(e),Gb(e,this.alpha.read())}getConfig(){const e={alphaInitializer:ds(this.alphaInitializer),alphaRegularizer:Kt(this.alphaRegularizer),alphaConstraint:As(this.alphaConstraint),sharedAxes:this.sharedAxes},s=super.getConfig();return Object.assign(e,s),e}}mE.className="PReLU",Ie(mE);let gE=class extends kt{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new bt(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,s){const n=dt(e);return cm(n)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},s=super.getConfig();return Object.assign(e,s),e}};gE.className="ELU",Ie(gE);class xE extends kt{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,s){const n=dt(e);return V(n,Be(qn(n,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},s=super.getConfig();return Object.assign(e,s),e}}xE.className="ThresholdedReLU",Ie(xE);class bE extends kt{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new bw().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,s){return ne(()=>{let n=dt(e);const r=s.mask;if(r!=null){const i=V(lt(Ro(n.shape),Be(r,n.dtype)),Mt(-1e9));n=Te(n,i)}return this.axis instanceof Array?this.axis.length>1?ui(lt(n,SS(n,this.axis,!0))):this.softmax(n,this.axis[0]):this.softmax(n,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},s=super.getConfig();return Object.assign(e,s),e}}bE.className="Softmax",Ie(bE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function fc(t,e,s){if(typeof t=="number")return Ka(t,e);if(t.length!==e)throw new U(`The ${s} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let n=0;n<e;++n){const r=t[n];if(!kK(r))throw new U(`The ${s} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${r}`)}return t}function Hr(t,e,s,n,r=1){if(t==null)return t;const i=e+(e-1)*(r-1);let o;return s==="same"?o=t:o=t-i+1,Math.floor((o+n-1)/n)}function wi(t,e,s,n){if(t==null)return null;if(n==="valid")t=t*e+Mo([s-e,0]);else if(n==="same")t=t*e;else throw new U(`Unsupport padding mode: ${n}.`);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ww(t,e){return ne(()=>(xs(e),e==="channelsFirst"?Tt(t,[0,2,3,1]):t))}function yE(t,e){return ne(()=>(xs(e),e==="channelsFirst"?Tt(t,[0,2,3,4,1]):t))}function HX(t,e,s,n=1,r="valid",i,o=1){return ne(()=>{if(i==null&&(i=Ur()),xs(i),t.shape.length!==3)throw new U(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(e.shape.length!==3)throw new U(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(s!=null&&s.shape.length!==1)throw new U(`The bias for a conv1dWithBias operation should be 1, but is ${s.shape.length} instead`);if(i==="channelsFirst"&&(t=Tt(t,[0,2,1])),r==="causal")throw new bt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let l=pS(t,e,n,r==="same"?"same":"valid","NWC",o);return s!=null&&(l=Vr(l,s)),l})}function wE(t,e,s,n=[1,1],r="valid",i,o,l=null){return ne(()=>{if(i==null&&(i=Ur()),xs(i),t.rank!==3&&t.rank!==4)throw new U(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(e.rank!==3&&e.rank!==4)throw new U(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let c=ww(t,i);if(r==="causal")throw new bt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return c=H7({x:c,filter:e,strides:n,pad:r==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:s,activation:l}),i==="channelsFirst"&&(c=Tt(c,[0,3,1,2])),c})}function qX(t,e,s,n=[1,1,1],r="valid",i,o){return ne(()=>{if(i==null&&(i=Ur()),xs(i),t.rank!==4&&t.rank!==5)throw new U(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(e.rank!==4&&e.rank!==5)throw new U(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let l=yE(t,i);if(r==="causal")throw new bt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return l=qW(l,e,n,r==="same"?"same":"valid","NDHWC",o),s!=null&&(l=Vr(l,s)),i==="channelsFirst"&&(l=Tt(l,[0,4,1,2,3])),l})}class zm extends kt{constructor(e,s){if(super(s),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",zm.verifyArgs(s),this.rank=e,Ms(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new bt(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=fc(s.kernelSize,e,"kernelSize"),this.strides=fc(s.strides==null?1:s.strides,e,"strides"),this.padding=s.padding==null?"valid":s.padding,Xn(this.padding),this.dataFormat=s.dataFormat==null?"channelsLast":s.dataFormat,xs(this.dataFormat),this.activation=Bo(s.activation),this.useBias=s.useBias==null?!0:s.useBias,this.biasInitializer=os(s.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Ds(s.biasConstraint),this.biasRegularizer=as(s.biasRegularizer),this.activityRegularizer=as(s.activityRegularizer),this.dilationRate=fc(s.dilationRate==null?1:s.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new U(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new U(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new U(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(mi("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!Hy(e.kernelSize,"number",1,3))throw new U(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:zo(this.activation),useBias:this.useBias,biasInitializer:ds(this.biasInitializer),biasRegularizer:Kt(this.biasRegularizer),activityRegularizer:Kt(this.activityRegularizer),biasConstraint:As(this.biasConstraint)},s=super.getConfig();return Object.assign(e,s),e}}class mc extends zm{constructor(e,s){super(e,s),this.kernel=null,mc.verifyArgs(s),this.filters=s.filters,Ms(this.filters,"filters"),this.kernelInitializer=os(s.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Ds(s.kernelConstraint),this.kernelRegularizer=as(s.kernelRegularizer)}build(e){e=_t(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new U(`The channel dimension of the input should be defined. Found ${e[s]}`);const n=e[s],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[s]:n}}],this.built=!0}call(e,s){return ne(()=>{e=dt(e);let n;const r=this.bias==null?null:this.bias.read(),i=Zj(this.activation.getClassName());if(i!=null&&this.rank===2)n=wE(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)n=HX(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)n=wE(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)n=qX(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new bt("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(n=this.activation.apply(n))}return n})}computeOutputShape(e){e=_t(e);const s=[],n=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<n.length;++i){const o=Hr(n[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);s.push(o)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(s),r.push(this.filters)):(r.push(this.filters),r=r.concat(s)),r}getConfig(){const e={filters:this.filters,kernelInitializer:ds(this.kernelInitializer),kernelRegularizer:Kt(this.kernelRegularizer),kernelConstraint:As(this.kernelConstraint)},s=super.getConfig();return Object.assign(e,s),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new U(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Hu extends mc{constructor(e){super(2,e),Hu.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Hy(e.kernelSize,"number",1,2))throw new U(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Hu.className="Conv2D",Ie(Hu);class qu extends mc{constructor(e){super(3,e),qu.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new U(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}qu.className="Conv3D",Ie(qu);class vE extends Hu{constructor(e){if(super(e),this.inputSpec=[new Ts({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new U(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=_t(e),e.length!==4)throw new U("Input should have rank 4; Received input shape: "+JSON.stringify(e));const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new U("The channel dimension of the inputs should be defined. Found `None`.");const n=e[s],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Ts({ndim:4,axes:{[s]:n}})],this.built=!0}call(e,s){return ne(()=>{let n=dt(e);if(n.shape.length!==4)throw new U(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${n.shape.length}`);const r=n.shape,i=r[0];let o,l;this.dataFormat==="channelsFirst"?(o=2,l=3):(o=1,l=2);const c=r[o],d=r[l],u=this.kernelSize[0],h=this.kernelSize[1],p=this.strides[0],f=this.strides[1],m=wi(c,p,u,this.padding),b=wi(d,f,h,this.padding),g=[i,m,b,this.filters];this.dataFormat!=="channelsLast"&&(n=Tt(n,[0,2,3,1]));let x=fS(n,this.kernel.read(),g,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(x=Tt(x,[0,3,1,2])),this.bias!=null&&(x=Vr(x,this.bias.read(),this.dataFormat)),this.activation!=null&&(x=this.activation.apply(x)),x})}computeOutputShape(e){e=_t(e);const s=e.slice();let n,r,i;this.dataFormat==="channelsFirst"?(n=1,r=2,i=3):(n=3,r=1,i=2);const o=this.kernelSize[0],l=this.kernelSize[1],c=this.strides[0],d=this.strides[1];return s[n]=this.filters,s[r]=wi(s[r],c,o,this.padding),s[i]=wi(s[i],d,l,this.padding),s}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}vE.className="Conv2DTranspose",Ie(vE);class NE extends qu{constructor(e){if(super(e),this.inputSpec=[new Ts({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new U(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=_t(e),e.length!==5)throw new U("Input should have rank 5; Received input shape: "+JSON.stringify(e));const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new U("The channel dimension of the inputs should be defined. Found `None`.");const n=e[s],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Ts({ndim:5,axes:{[s]:n}})],this.built=!0}call(e,s){return ne(()=>{let n=dt(e);if(n.shape.length!==5)throw new U(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${n.shape.length}`);const r=n.shape,i=r[0];let o,l,c;this.dataFormat==="channelsFirst"?(c=2,o=3,l=4):(c=1,o=2,l=3);const d=r[c],u=r[o],h=r[l],p=this.kernelSize[0],f=this.kernelSize[1],m=this.kernelSize[2],b=this.strides[0],g=this.strides[1],x=this.strides[2],y=wi(d,b,p,this.padding),w=wi(u,g,f,this.padding),v=wi(h,x,m,this.padding),N=[i,y,w,v,this.filters];this.dataFormat!=="channelsLast"&&(n=Tt(n,[0,2,3,4,1]));let C=YW(n,this.kernel.read(),N,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(C=Tt(C,[0,4,1,2,3])),this.bias!==null&&(C=Vr(C,this.bias.read(),this.dataFormat)),this.activation!==null&&(C=this.activation.apply(C)),C})}computeOutputShape(e){e=_t(e);const s=e.slice();let n,r,i,o;this.dataFormat==="channelsFirst"?(n=1,r=2,i=3,o=4):(n=4,r=1,i=2,o=3);const l=this.kernelSize[0],c=this.kernelSize[1],d=this.kernelSize[2],u=this.strides[0],h=this.strides[1],p=this.strides[2];return s[n]=this.filters,s[r]=wi(s[r],u,l,this.padding),s[i]=wi(s[i],h,c,this.padding),s[o]=wi(s[o],p,d,this.padding),s}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}NE.className="Conv3DTranspose",Ie(NE);class kE extends mc{constructor(e,s){if(super(e,s),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,s.filters==null)throw new U("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(s.kernelInitializer!=null||s.kernelRegularizer!=null||s.kernelConstraint!=null)throw new U("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(s.padding!=null&&s.padding!=="same"&&s.padding!=="valid")throw new U(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(s.padding)}`);this.depthMultiplier=s.depthMultiplier==null?1:s.depthMultiplier,this.depthwiseInitializer=os(s.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=as(s.depthwiseRegularizer),this.depthwiseConstraint=Ds(s.depthwiseConstraint),this.pointwiseInitializer=os(s.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=as(s.pointwiseRegularizer),this.pointwiseConstraint=Ds(s.pointwiseConstraint)}build(e){if(e=_t(e),e.length<this.rank+2)throw new U(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null||e[s]<0)throw new U(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[s])}`);const n=e[s],r=this.kernelSize.concat([n,this.depthMultiplier]),i=[];for(let l=0;l<this.rank;++l)i.push(1);i.push(n*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new Ts({ndim:this.rank+2,axes:{[s]:n}})],this.built=!0}call(e,s){return ne(()=>{e=dt(e);let n;if(this.rank===1)throw new bt("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Tt(e,[0,2,3,1])),n=RS(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(n=Vr(n,this.bias.read(),this.dataFormat)),this.activation!=null&&(n=this.activation.apply(n)),this.dataFormat==="channelsFirst"&&(n=Tt(n,[0,3,1,2])),n})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=ds(this.depthwiseInitializer),e.pointwiseInitializer=ds(this.pointwiseInitializer),e.depthwiseRegularizer=Kt(this.depthwiseRegularizer),e.pointwiseRegularizer=Kt(this.pointwiseRegularizer),e.depthwiseConstraint=As(this.depthwiseConstraint),e.pointwiseConstraint=As(this.pointwiseConstraint),e}}kE.className="SeparableConv";class CE extends kE{constructor(e){super(2,e)}}CE.className="SeparableConv2D",Ie(CE);class Bm extends mc{constructor(e){super(1,e),Bm.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Hy(e.kernelSize,"number",1,1))throw new U(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Bm.className="Conv1D",Ie(Bm);class SE extends kt{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,s){return ne(()=>{if(e=dt(e),this.dataFormat==="channelsLast"){const n=Cm(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Cm(n,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const n=Cm(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Cm(n,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},s=super.getConfig();return Object.assign(e,s),e}}SE.className="Cropping2D",Ie(SE);class jE extends kt{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,xs(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,wK(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const s=e[2]==null?null:this.size[0]*e[2],n=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],s,n]}else{const s=e[1]==null?null:this.size[0]*e[1],n=e[2]==null?null:this.size[1]*e[2];return[e[0],s,n,e[3]]}}call(e,s){return ne(()=>{let n=dt(e);const r=n.shape;if(this.dataFormat==="channelsFirst"){n=Tt(n,[0,2,3,1]);const i=this.size[0]*r[2],o=this.size[1]*r[3],l=this.interpolation==="nearest"?to.resizeNearestNeighbor(n,[i,o]):to.resizeBilinear(n,[i,o]);return Tt(l,[0,3,1,2])}else{const i=this.size[0]*r[1],o=this.size[1]*r[2];return this.interpolation==="nearest"?to.resizeNearestNeighbor(n,[i,o]):to.resizeBilinear(n,[i,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},s=super.getConfig();return Object.assign(e,s),e}}jE.className="UpSampling2D",Ie(jE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function KX(t,e,s=[1,1],n="valid",r,i){return ne(()=>{r==null&&(r=Ur()),xs(r);let o=ww(t,r);if(t.rank!==4)throw new U(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(e.rank!==4)throw new U(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=Pb(o,e,s,n==="same"?"same":"valid","NHWC",i),r==="channelsFirst"&&(o=Tt(o,[0,3,1,2])),o})}class IE extends zm{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=os(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Ds(e.depthwiseConstraint),this.depthwiseRegularizer=as(e.depthwiseRegularizer)}build(e){if(e=_t(e),e.length<4)throw new U(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const s=this.dataFormat==="channelsFirst"?1:3;if(e[s]==null||e[s]<0)throw new U(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[s]}).`);const n=e[s],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,s){return ne(()=>{e=dt(e);let n=KX(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(n=Vr(n,this.bias.read(),this.dataFormat)),this.activation!=null&&(n=this.activation.apply(n)),n})}computeOutputShape(e){e=_t(e);const s=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=Hr(s,this.kernelSize[0],this.padding,this.strides[0]),o=Hr(n,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,i,o]:[e[0],i,o,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=ds(this.depthwiseInitializer),e.depthwiseRegularizer=Kt(this.depthwiseRegularizer),e.depthwiseConstraint=As(this.depthwiseRegularizer),e}}IE.className="DepthwiseConv2D",Ie(IE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function EE(t,e,s,n){if(Array.isArray(t)){if(e!=null||s!=null)throw new U("When inputs is an array, neither initialState or constants should be provided");n!=null&&(s=t.slice(t.length-n,t.length),t=t.slice(0,t.length-n)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function r(i){return i==null||Array.isArray(i)?i:[i]}return e=r(e),s=r(s),{inputs:t,initialState:e,constants:s}}function $E(t,e,s,n=!1,r,i,o=!1,l=!1){return ne(()=>{const c=e.shape.length;if(c<3)throw new U(`Input should be at least 3D, but is ${c}D.`);const d=[1,0].concat(Br(2,c));e=Tt(e,d),o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=Be(Be(r,"bool"),"float32"),r.rank===c-1&&(r=kn(r,-1)),r=Tt(r,d)),n&&(e=Ga(e,0),r!=null&&(r=Ga(r,0)));const u=[];let h,p=s;const f=e.shape[0],m=qa(e);let b;r!=null&&(b=qa(r));for(let x=0;x<f;++x){const y=m[x],w=ne(()=>t(y,p));if(r==null)h=w[0],p=w[1];else{const v=ne(()=>{const N=b[x],C=lt(pr(N),N),j=Te(V(w[0],N),V(p[0],C)),I=p.map((T,E)=>Te(V(w[1][E],N),V(T,C)));return{output:j,newStates:I}});h=v.output,p=v.newStates}l&&u.push(h)}let g;return l&&(g=eo(u,1)),[h,g,p]})}class Uo extends kt{constructor(e){super(e);let s;if(e.cell==null)throw new U("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?s=new kw({cells:e.cell}):s=e.cell,s.stateSize==null)throw new U("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=s,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Ts({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Br(0,e).map(s=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){iw(e)&&(e=e[0]),e=e;let s=this.cell.stateSize;Array.isArray(s)||(s=[s]);const n=s[0];let r;if(this.returnSequences?r=[e[0],e[1],n]:r=[e[0],n],this.returnState){const i=[];for(const o of s)i.push([e[0],o]);return[r].concat(i)}else return r}computeMask(e,s){return ne(()=>{Array.isArray(s)&&(s=s[0]);const n=this.returnSequences?s:null;if(this.returnState){const r=this.states.map(i=>null);return[n].concat(r)}else return n})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,s=[];for(let n=0;n<e;++n)s.push(null);return s}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new bt("Constants support is not implemented in RNN yet.");iw(e)&&(e=e[0]),e=e;const s=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new Ts({shape:[s,null,...n]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!Ft(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new U(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new Ts({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,s=!1){ne(()=>{if(!this.stateful)throw new fi("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(n==null)throw new U("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Os([n,r])):this.states_=[Os([n,this.cell.stateSize])];else if(e==null)wt(this.states_),this.keptStates!=null&&(wt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Os([n,r])):this.states_[0]=Os([n,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new U(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);s===!0?this.keptStates.push(this.states_.slice()):wt(this.states_);for(let r=0;r<this.states_.length;++r){const i=e[r],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,l=[n,o];if(!Ft(i.shape,l))throw new U(`State ${r} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${i.shape}`);this.states_[r]=i}}this.states_=this.states_.map(r=>li(r.clone()))})}apply(e,s){let n=s==null?null:s.initialState,r=s==null?null:s.constants;s==null&&(s={});const i=EE(e,n,r,this.numConstants);e=i.inputs,n=i.initialState,r=i.constants;let o=[],l=[];if(n!=null){s.initialState=n,o=o.concat(n),this.stateSpec=[];for(const d of n)this.stateSpec.push(new Ts({shape:d.shape}));l=l.concat(this.stateSpec)}if(r!=null&&(s.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof bi){const d=[e].concat(o),u=this.inputSpec.concat(l),h=this.inputSpec;this.inputSpec=u;const p=super.apply(d,s);return this.inputSpec=h,p}else return super.apply(e,s)}call(e,s){return ne(()=>{const n=s==null?null:s.mask,r=s==null?null:s.training;let i=s==null?null:s.initialState;e=dt(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new U(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const l={training:r},d=$E((m,b)=>{const g=this.cell.call([m].concat(b),l);return[g[0],g.slice(1)]},e,i,this.goBackwards,n,null,this.unroll,this.returnSequences),u=d[0],h=d[1],p=d[2];this.stateful&&this.resetStates(p,r);const f=this.returnSequences?h:u;return this.returnState?[f].concat(p):f})}getInitialState(e){return ne(()=>{let s=Os(e.shape);return s=st(s,[1,2]),s=Ou(s),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(n=>n>1?Yy(s,[1,n]):s):this.cell.stateSize>1?[Yy(s,[1,this.cell.stateSize])]:[s]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),s={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(s.numConstants=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===Uo.className&&(s.cell={className:this.cell.getClassName(),config:n}),Object.assign(Object.assign(Object.assign({},n),e),s)}static fromConfig(e,s,n={}){const r=s.cell,i=yi(r,n);return new e(Object.assign(s,{cell:i}))}}Uo.className="RNN",Ie(Uo);class Um extends kt{}class vw extends Um{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Ms(this.units,"units"),this.activation=Bo(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=os(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=os(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=os(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=as(e.kernelRegularizer),this.recurrentRegularizer=as(e.recurrentRegularizer),this.biasRegularizer=as(e.biasRegularizer),this.kernelConstraint=Ds(e.kernelConstraint),this.recurrentConstraint=Ds(e.recurrentConstraint),this.biasConstraint=Ds(e.biasConstraint),this.dropout=uc([1,Mo([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=uc([1,Mo([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=_t(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,s){return ne(()=>{if(e=e,e.length!==2)throw new U(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let n=e[1];e=e[0];const r=s.training==null?!1:s.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Vo({ones:()=>pr(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Vo({ones:()=>pr(n),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,l=this.recurrentDropoutMask;o!=null?i=xi(V(e,o),this.kernel.read()):i=xi(e,this.kernel.read()),this.bias!=null&&(i=Vr(i,this.bias.read())),l!=null&&(n=V(n,l));let c=Te(i,xi(n,this.recurrentKernel.read()));return this.activation!=null&&(c=this.activation.apply(c)),[c,c]})}getConfig(){const e=super.getConfig(),s={units:this.units,activation:zo(this.activation),useBias:this.useBias,kernelInitializer:ds(this.kernelInitializer),recurrentInitializer:ds(this.recurrentInitializer),biasInitializer:ds(this.biasInitializer),kernelRegularizer:Kt(this.kernelRegularizer),recurrentRegularizer:Kt(this.recurrentRegularizer),biasRegularizer:Kt(this.biasRegularizer),activityRegularizer:Kt(this.activityRegularizer),kernelConstraint:As(this.kernelConstraint),recurrentConstraint:As(this.recurrentConstraint),biasConstraint:As(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),s)}}vw.className="SimpleRNNCell",Ie(vw);class TE extends Uo{constructor(e){e.cell=new vw(e),super(e)}call(e,s){return ne(()=>{this.cell.dropoutMask!=null&&(wt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(wt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=s==null?null:s.mask,r=s==null?null:s.training,i=s==null?null:s.initialState;return super.call(e,{mask:n,training:r,initialState:i})})}static fromConfig(e,s){return new e(s)}}TE.className="SimpleRNN",Ie(TE);class Nw extends Um{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new U("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Ms(this.units,"units"),this.activation=Bo(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Bo(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=os(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=os(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=os(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=as(e.kernelRegularizer),this.recurrentRegularizer=as(e.recurrentRegularizer),this.biasRegularizer=as(e.biasRegularizer),this.kernelConstraint=Ds(e.kernelConstraint),this.recurrentConstraint=Ds(e.recurrentConstraint),this.biasConstraint=Ds(e.biasConstraint),this.dropout=uc([1,Mo([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=uc([1,Mo([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=_t(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,s){return ne(()=>{if(e=e,e.length!==2)throw new U(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const n=s.training==null?!1:s.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Vo({ones:()=>pr(e),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Vo({ones:()=>pr(r),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let l,c,d;0<this.dropout&&this.dropout<1&&(e=V(e,i[0]));let u=xi(e,this.kernel.read());this.useBias&&(u=Vr(u,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=V(r,o[0]));const h=this.recurrentKernel.read(),[p,f]=Kn(h,[2*this.units,this.units],h.rank-1),m=xi(r,p),[b,g,x]=Kn(u,3,u.rank-1),[y,w]=Kn(m,2,m.rank-1);l=this.recurrentActivation.apply(Te(b,y)),c=this.recurrentActivation.apply(Te(g,w));const v=xi(V(c,r),f);d=this.activation.apply(Te(x,v));const N=Te(V(l,r),V(Te(1,gs(l)),d));return[N,N]})}getConfig(){const e=super.getConfig(),s={units:this.units,activation:zo(this.activation),recurrentActivation:zo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ds(this.kernelInitializer),recurrentInitializer:ds(this.recurrentInitializer),biasInitializer:ds(this.biasInitializer),kernelRegularizer:Kt(this.kernelRegularizer),recurrentRegularizer:Kt(this.recurrentRegularizer),biasRegularizer:Kt(this.biasRegularizer),activityRegularizer:Kt(this.activityRegularizer),kernelConstraint:As(this.kernelConstraint),recurrentConstraint:As(this.recurrentConstraint),biasConstraint:As(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),s)}}Nw.className="GRUCell",Ie(Nw);class AE extends Uo{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Nw(e),super(e)}call(e,s){return ne(()=>{this.cell.dropoutMask!=null&&(wt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(wt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=s==null?null:s.mask,r=s==null?null:s.training,i=s==null?null:s.initialState;return super.call(e,{mask:n,training:r,initialState:i})})}static fromConfig(e,s){return s.implmentation===0&&(s.implementation=1),new e(s)}}AE.className="GRU",Ie(AE);class Vm extends Um{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Ms(this.units,"units"),this.activation=Bo(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Bo(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=os(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=os(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=os(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=as(e.kernelRegularizer),this.recurrentRegularizer=as(e.recurrentRegularizer),this.biasRegularizer=as(e.biasRegularizer),this.kernelConstraint=Ds(e.kernelConstraint),this.recurrentConstraint=Ds(e.recurrentConstraint),this.biasConstraint=Ds(e.biasConstraint),this.dropout=uc([1,Mo([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=uc([1,Mo([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var s;e=_t(e);const n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;r=new(s=class extends xr{apply(c,d){const u=i.apply([o]),h=new Jy().apply([o]),p=i.apply([o*2]);return rI(rI(u,h),p)}},s.className="CustomInit",s)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,s){return ne(()=>{const n=s.training==null?!1:s.training;if(e=e,e.length!==3)throw new U(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Vo({ones:()=>pr(e),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Vo({ones:()=>pr(r),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,l=this.recurrentDropoutMask;let c,d,u,h;0<this.dropout&&this.dropout<1&&(e=V(e,o[0]));let p=xi(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=V(r,l[0])),p=Te(p,xi(r,this.recurrentKernel.read())),this.useBias&&(p=Vr(p,this.bias.read()));const[f,m,b,g]=Kn(p,4,p.rank-1);c=this.recurrentActivation.apply(f),d=this.recurrentActivation.apply(m),u=Te(V(d,i),V(c,this.activation.apply(b))),h=this.recurrentActivation.apply(g);const x=V(h,this.activation.apply(u));return[x,x,u]})}getConfig(){const e=super.getConfig(),s={units:this.units,activation:zo(this.activation),recurrentActivation:zo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:ds(this.kernelInitializer),recurrentInitializer:ds(this.recurrentInitializer),biasInitializer:ds(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Kt(this.kernelRegularizer),recurrentRegularizer:Kt(this.recurrentRegularizer),biasRegularizer:Kt(this.biasRegularizer),activityRegularizer:Kt(this.activityRegularizer),kernelConstraint:As(this.kernelConstraint),recurrentConstraint:As(this.recurrentConstraint),biasConstraint:As(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),s)}}Vm.className="LSTMCell",Ie(Vm);class DE extends Uo{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Vm(e),super(e)}call(e,s){return ne(()=>{this.cell.dropoutMask!=null&&(wt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(wt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=s==null?null:s.mask,r=s==null?null:s.training,i=s==null?null:s.initialState;return super.call(e,{mask:n,training:r,initialState:i})})}static fromConfig(e,s){return s.implmentation===0&&(s.implementation=1),new e(s)}}DE.className="LSTM",Ie(DE);class kw extends Um{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const s of this.cells.slice().reverse())Array.isArray(s.stateSize)?e.push(...s.stateSize):e.push(s.stateSize);return e}call(e,s){return ne(()=>{e=e;let n=e.slice(1);const r=[];for(const l of this.cells.slice().reverse())Array.isArray(l.stateSize)?r.push(n.splice(0,l.stateSize.length)):r.push(n.splice(0,1));r.reverse();const i=[];let o;for(let l=0;l<this.cells.length;++l){const c=this.cells[l];n=r[l],l===0?o=[e[0]].concat(n):o=[o[0]].concat(n),o=c.call(o,s),i.push(o.slice(1))}n=[];for(const l of i.slice().reverse())n.push(...l);return[o[0]].concat(n)})}build(e){iw(e)&&(e=e[0]),e=e;let s;this.cells.forEach((n,r)=>{Za(`RNNCell_${r}`,()=>{n.build(e),Array.isArray(n.stateSize)?s=n.stateSize[0]:s=n.stateSize,e=[e[0],s]})}),this.built=!0}getConfig(){const e=super.getConfig(),s=i=>({className:i.getClassName(),config:i.getConfig()}),r={cells:this.cells.map(s)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,s,n={}){const r=[];for(const i of s.cells)r.push(yi(i,n));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const s of this.cells)e.push(...s.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const s of this.cells)e.push(...s.nonTrainableWeights);if(!this.trainable){const s=[];for(const n of this.cells)s.push(...n.trainableWeights);return s.concat(e)}return e}getWeights(){const e=[];for(const s of this.cells)e.push(...s.weights);return ow(e)}setWeights(e){const s=[];for(const n of this.cells){const r=n.weights.length,i=e.splice(r);for(let o=0;o<n.weights.length;++o)s.push([n.weights[o],i[o]])}aw(s)}}kw.className="StackedRNNCells",Ie(kw);function Vo(t){const{ones:e,rate:s,training:n=!1,count:r=1,dropoutFunc:i}=t,o=()=>i!=null?i(e(),s):oI(e(),s),l=()=>Lu(o,e,n);return!r||r<=1?li(l().clone()):Array(r).fill(void 0).map(l).map(d=>li(d.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var XX=function(t,e){var s={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(s[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(s[n[r]]=t[n[r]]);return s};class _E extends Uo{constructor(e){if(e.unroll)throw new bt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new bt("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Ts({ndim:5})]}call(e,s){return ne(()=>{if(this.cell.dropoutMask!=null&&(wt(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(wt(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),s&&s.constants)throw new U("ConvRNN2D cell does not support constants");const n=s==null?null:s.mask,r=s==null?null:s.training,i=s==null?null:s.initialState;return super.call(e,{mask:n,training:r,initialState:i})})}computeOutputShape(e){let s=this.computeSingleOutputShape(e);return this.returnSequences||(s=[s[0],...s.slice(2)]),this.returnState&&(s=[s,...Array(2).fill([e[0],...s.slice(-3)])]),s}getInitialState(e){return ne(()=>{const{stateSize:s}=this.cell,n=e.shape,r=this.computeSingleOutputShape(n),i=[r[0],...r.slice(2)],o=Os(i);return Array.isArray(s)?Array(s.length).fill(o):[o]})}resetStates(e,s=!1){ne(()=>{if(!this.stateful)throw new fi("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,r=this.computeSingleOutputShape(n),i=[r[0],...r.slice(2)];if(n[0]==null)throw new U("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Os(i)):this.states_=[Os(i)];else if(e==null)wt(this.states_),this.keptStates!=null&&(wt(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Os(i)):this.states_[0]=Os(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new U(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);s?this.keptStates.push(this.states_.slice()):wt(this.states_);for(let l=0;l<this.states_.length;++l){const c=e[l],d=i;if(!Ft(c.shape,d))throw new U(`State ${l} is incompatible with layer ${this.name}: expected shape=${d}, received shape=${c.shape}`);this.states_[l]=c}}this.states_=this.states_.map(l=>li(l.clone()))})}computeSingleOutputShape(e){const{dataFormat:s,filters:n,kernelSize:r,padding:i,strides:o,dilationRate:l}=this.cell,c=s==="channelsFirst",d=e[c?3:2],u=e[c?4:3],h=Hr(d,r[0],i,o[0],l[0]),p=Hr(u,r[1],i,o[1],l[1]);return[...e.slice(0,2),...c?[n,h,p]:[h,p,n]]}}_E.className="ConvRNN2D";class Cw extends Vm{constructor(e){const{filters:s,kernelSize:n,strides:r,padding:i,dataFormat:o,dilationRate:l}=e;super(Object.assign(Object.assign({},e),{units:s})),this.filters=s,Ms(this.filters,"filters"),this.kernelSize=fc(n,2,"kernelSize"),this.kernelSize.forEach(c=>Ms(c,"kernelSize")),this.strides=fc(r||1,2,"strides"),this.strides.forEach(c=>Ms(c,"strides")),this.padding=i||"valid",Xn(this.padding),this.dataFormat=o||"channelsLast",xs(this.dataFormat),this.dilationRate=fc(l||1,2,"dilationRate"),this.dilationRate.forEach(c=>Ms(c,"dilationRate"))}build(e){var s;e=_t(e);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new U(`The channel dimension of the input should be defined. Found ${e[n]}`);const r=e[n],i=4,o=this.kernelSize.concat([r,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const l=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",l,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let c;if(this.unitForgetBias){const d=this.biasInitializer,u=this.filters;c=new(s=class extends xr{apply(p,f){const m=d.apply([u]),b=Ro([u]),g=d.apply([u*2]);return Xy([m,b,g])}},s.className="CustomInit",s)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,s){return ne(()=>{if(e.length!==3)throw new U(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const n=s.training||!1,r=e[0],i=e[1],o=e[2],l=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Vo({ones:()=>pr(r),rate:this.dropout,training:n,count:l,dropoutFunc:this.dropoutFunc}));const c=this.dropoutMask,d=(B,G,de)=>!G||!G[de]?B:V(G[de],B);let u=d(r,c,0),h=d(r,c,1),p=d(r,c,2),f=d(r,c,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Vo({ones:()=>pr(i),rate:this.recurrentDropout,training:n,count:l,dropoutFunc:this.dropoutFunc}));const m=this.recurrentDropoutMask;let b=d(i,m,0),g=d(i,m,1),x=d(i,m,2),y=d(i,m,3);const w=3,[v,N,C,j]=Kn(this.kernel.read(),l,w),[I,T,E,$]=this.useBias?Kn(this.bias.read(),l):[null,null,null,null];u=this.inputConv(u,v,I,this.padding),h=this.inputConv(h,N,T,this.padding),p=this.inputConv(p,C,E,this.padding),f=this.inputConv(f,j,$,this.padding);const[D,P,_,O]=Kn(this.recurrentKernel.read(),l,w);b=this.recurrentConv(b,D),g=this.recurrentConv(g,P),x=this.recurrentConv(x,_),y=this.recurrentConv(y,O);const R=this.recurrentActivation.apply(Te(u,b)),X=this.recurrentActivation.apply(Te(h,g)),L=Te(V(X,o),V(R,this.activation.apply(Te(p,x)))),K=V(this.recurrentActivation.apply(Te(f,y)),this.activation.apply(L));return[K,K,L]})}getConfig(){const e=super.getConfig(),s=XX(e,["units"]),n={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),n)}inputConv(e,s,n,r){const i=za(e,s,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return n?Vr(i,n,this.dataFormat):i}recurrentConv(e,s){return za(e,s,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Cw.className="ConvLSTM2DCell",Ie(Cw);class RE extends _E{constructor(e){const s=new Cw(e);super(Object.assign(Object.assign({},e),{cell:s}))}static fromConfig(e,s){return new e(s)}}RE.className="ConvLSTM2D",Ie(RE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Sw extends kt{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const s=e.shape,n=[];for(let r=0;r<this.noiseShape.length;++r)n.push(this.noiseShape[r]==null?s[r]:this.noiseShape[r]);return n}call(e,s){return ne(()=>{this.invokeCallHook(e,s);const n=dt(e);if(0<this.rate&&this.rate<1){const r=s.training==null?!1:s.training,i=this.getNoiseShape(n);return Lu(()=>oI(n,this.rate,i,this.seed),()=>n,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},s=super.getConfig();return Object.assign(e,s),e}dispose(){return super.dispose()}}Sw.className="Dropout",Ie(Sw);class PE extends Sw{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const s=e.shape;return[s[0],1,s[2]]}}PE.className="SpatialDropout1D",Ie(PE);class jw extends kt{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let s=null;e.batchSize!=null&&(s=e.batchSize),this.batchInputShape=[s,e.inputDim]}this.units=e.units,Ms(this.units,"units"),this.activation=Bo(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=os(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=os(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Ds(e.kernelConstraint),this.biasConstraint=Ds(e.biasConstraint),this.kernelRegularizer=as(e.kernelRegularizer),this.biasRegularizer=as(e.biasRegularizer),this.activityRegularizer=as(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=_t(e);const s=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[s,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:s}}],this.built=!0}computeOutputShape(e){e=_t(e);const s=e.slice();return s[s.length-1]=this.units,s}call(e,s){return ne(()=>{this.invokeCallHook(e,s);const n=dt(e),r=Zj(this.activation.getClassName());let i;return r!=null?i=xi(n,this.kernel.read(),r,this.bias?this.bias.read():null):(i=xi(n,this.kernel.read()),this.bias!=null&&(i=Vr(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:zo(this.activation),useBias:this.useBias,kernelInitializer:ds(this.kernelInitializer),biasInitializer:ds(this.biasInitializer),kernelRegularizer:Kt(this.kernelRegularizer),biasRegularizer:Kt(this.biasRegularizer),activityRegularizer:Kt(this.activityRegularizer),kernelConstraint:As(this.kernelConstraint),biasConstraint:As(this.biasConstraint)},s=super.getConfig();return Object.assign(e,s),e}}jw.className="Dense",Ie(jw);class FE extends kt{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=_t(e);for(const s of e.slice(1))if(s==null)throw new U(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Oo(e,1)]}call(e,s){return ne(()=>{this.invokeCallHook(e,s);let n=dt(e);if(this.dataFormat==="channelsFirst"&&n.rank>1){const r=[0];for(let i=2;i<n.rank;++i)r.push(i);r.push(1),n=Tt(n,r)}return jK(n)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const s=super.getConfig();return Object.assign(e,s),e}}FE.className="Flatten",Ie(FE);class OE extends kt{constructor(e){super(e),this.supportsMasking=!0,this.activation=Bo(e.activation)}call(e,s){return ne(()=>{this.invokeCallHook(e,s);const n=dt(e);return this.activation.apply(n)})}getConfig(){const e={activation:zo(this.activation)},s=super.getConfig();return Object.assign(e,s),e}}OE.className="Activation",Ie(OE);class ME extends kt{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,s){return ne(()=>(e=dt(e),CK(e,this.n)))}getConfig(){const e={n:this.n},s=super.getConfig();return Object.assign(e,s),e}}ME.className="RepeatVector",Ie(ME);class LE extends kt{constructor(e){super(e),this.targetShape=e.targetShape;for(let s=0;s<this.targetShape.length;++s)this.isUnknown(this.targetShape[s])&&(this.targetShape[s]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,s){const n="Total size of new array must be unchanged.",r=s.slice();let i=1,o=null;for(let c=0;c<r.length;++c){const d=r[c];if(this.isUnknown(d))if(o===null)o=c;else throw new U("Can only specifiy one unknown dimension.");else i*=d}const l=Oo(e);if(o!==null){if(i===0||l%i!==0)throw new U(n);r[o]=l/i}else if(l!==i)throw new U(n);return r}computeOutputShape(e){let s=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){s=!0;break}return s?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,s){return ne(()=>{this.invokeCallHook(e,s);const n=dt(e),r=n.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return Z(n,i)})}getConfig(){const e={targetShape:this.targetShape},s=super.getConfig();return Object.assign(e,s),e}}LE.className="Reshape",Ie(LE);class zE extends kt{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const s=Br(1,e.dims.length+1);if(!Ft(e.dims.slice().sort(),s))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Ts({ndim:this.dims.length+1})]}computeOutputShape(e){e=_t(e);const s=e.slice();return this.dims.forEach((n,r)=>{s[r+1]=e[n]}),s}call(e,s){return Tt(dt(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},s=super.getConfig();return Object.assign(e,s),e}}zE.className="Permute",Ie(zE);class BE extends kt{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),s={maskValue:this.maskValue};return Object.assign(s,e),s}computeMask(e,s){const n=dt(e);return Ib(fm(n,this.maskValue),-1)}call(e,s){return ne(()=>{this.invokeCallHook(e,s);const n=dt(e),o=Ib(fm(n,this.maskValue),-1,!0);return V(n,Be(o,n.dtype))})}}BE.className="Masking",Ie(BE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class UE extends kt{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let s=null;e.batchSize!=null&&(s=e.batchSize),e.inputLength==null?this.batchInputShape=[s,null]:this.batchInputShape=[s].concat(Ut(e.inputLength))}this.inputDim=e.inputDim,Ms(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Ms(this.outputDim,"outputDim"),this.embeddingsInitializer=os(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=as(e.embeddingsRegularizer),this.activityRegularizer=as(e.activityRegularizer),this.embeddingsConstraint=Ds(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,s){return ne(()=>this.maskZero?(e=dt(e),fm(e,$t(e))):null)}computeOutputShape(e){if(e=_t(e),this.inputLength==null)return[...e,this.outputDim];const s=Ut(this.inputLength);if(s.length!==e.length-1)throw new U(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let n=0;for(let r=0;r<s.length;++r){const i=s[r],o=e[r+1];if(i!=null&&o!=null&&i!==o)throw new U(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(s[n]=o),n++}}return[e[0],...s,this.outputDim]}call(e,s){return ne(()=>{this.invokeCallHook(e,s);let n=dt(e);n.dtype!=="int32"&&(n=gi(n,"int32"));const r=iI(this.embeddings.read(),Z(n,[n.size]));return Z(r,_t(this.computeOutputShape(n.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:ds(this.embeddingsInitializer),embeddingsRegularizer:Kt(this.embeddingsRegularizer),activityRegularizer:Kt(this.activityRegularizer),embeddingsConstraint:As(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},s=super.getConfig();return Object.assign(e,s),e}}UE.className="Embedding",Ie(UE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class el extends kt{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new bt}computeElementwiseOpOutputShape(e,s){if(e==null||s==null)return null;if(e.length<s.length)return this.computeElementwiseOpOutputShape(s,e);if(s.length===0)return e;const n=e.slice(0,e.length-s.length);for(let r=0;r<s.length;++r){const i=e[e.length-s.length+r],o=s[r];if(i==null||o==null||i<0||o<0)n.push(null);else if(i===1)n.push(o);else if(o===1)n.push(i);else{if(i!==o)throw new U("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(s));n.push(i)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[_t(e)]),e=e,e.length<2)throw new U(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let s=[];for(const i of e)i!=null&&i[0]!==null&&s.push(i[0]);if(s=Fo(s),s.length>1)throw new U(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let n=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);n=this.computeElementwiseOpOutputShape(n,o)}const r=e.map(i=>i.length);e.indexOf(null)===-1&&Fo(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,s){return ne(()=>{if(e=e,this.reshapeRequired){const n=[],r=e.map(i=>i.rank);if(r.indexOf(null)===-1){const i=Mo(r);for(let o of e){const l=o.rank;for(let c=0;c<i-l;++c)o=Ou(o,1);n.push(o)}return this.mergeFunction(n)}else{let i=!1;for(const c of e){const d=c.rank;if(d==null){const u=c.shape,h=u[0],p=u.slice(1).concat([h]);let f=Z(c,[h].concat(Oo(u.slice(1))));f=Tt(f,[1,0]),f=Z(f,p),n.push(f),i=!0}else if(d>1){const u=Br(1,d).concat([0]);n.push(Tt(c,u)),i=!0}else n.push(c)}let o=this.mergeFunction(n);const l=o.rank;if(i){if(l==null){const c=o.shape,d=c.length,u=c[d-1],h=[u].concat(c.slice(0,c.length-1));o=Z(Tt(Z(o,[-1,u]),[1,0]),h)}else if(l>1){const c=[l-1].concat(Br(0,l-1));o=Tt(o,c)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let s;e[0]==null?s=null:s=e[0].slice(1);for(let r=1;r<e.length;++r){const i=e[r]==null?null:e[r].slice(1);s=this.computeElementwiseOpOutputShape(s,i)}let n=[];for(const r of e)r!=null&&r[0]!==null&&n.push(r[0]);return n=Fo(n),n.length===1?s=n.concat(s):s=[null].concat(s),s}computeMask(e,s){return ne(()=>{if(s==null)return null;if(!Array.isArray(s))throw new U("`mask` should be an Array");if(!Array.isArray(e))throw new U("`inputs` should be an Array");if(s.length!==e.length)throw new U(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${s.length})`);if(s.every(r=>r==null))return null;s=s.map(r=>r==null?r:kn(r,0));let n=s[0];for(let r=1;r<s.length-1;++r)n=Qi(n,s[r]);return n})}}class VE extends el{constructor(e){super(e)}mergeFunction(e){return ne(()=>{let s=e[0].clone();for(let n=1;n<e.length;++n)s=Te(s,e[n]);return s})}}VE.className="Add",Ie(VE);class WE extends el{constructor(e){super(e)}mergeFunction(e){return ne(()=>{let s=e[0].clone();for(let n=1;n<e.length;++n)s=V(s,e[n]);return s})}}WE.className="Multiply",Ie(WE);class GE extends el{constructor(e){super(e)}mergeFunction(e){return ne(()=>{let s=e[0].clone();for(let n=1;n<e.length;++n)s=Te(s,e[n]);return V(1/e.length,s)})}}GE.className="Average",Ie(GE);class HE extends el{constructor(e){super(e)}mergeFunction(e){return ne(()=>{let s=e[0];for(let n=1;n<e.length;++n)s=_o(s,e[n]);return s})}}HE.className="Maximum",Ie(HE);class qE extends el{constructor(e){super(e)}mergeFunction(e){return ne(()=>{let s=e[0];for(let n=1;n<e.length;++n)s=Iu(s,e[n]);return s})}}qE.className="Minimum",Ie(qE);class KE extends el{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new U("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let s=!0;for(const r of e)if(r!=null){s=!1;break}if(s)return;const n=[];for(let r=0;r<e.length;++r){const i=e[r].slice();i.splice(this.axis,1);let o=!1;for(const l of n)if(Ft(l,i)){o=!0;break}o||n.push(i)}if(n.length>1)throw new U("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return ne(()=>Xy(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new U("A `Concatenate` layer should be called on a list of inputs.");const s=e,n=s[0].slice(),r=this.axis<0?n.length+this.axis:this.axis;for(const i of s.slice(1)){if(n[r]==null||i[r]==null){n[r]=null;break}n[r]+=i[r]}return n}computeMask(e,s){if(s==null)return null;if(!Array.isArray(s))throw new U("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new U("`inputs` should be an array for Concatenate");if(s.length!==e.length)throw new U(`Mismatch in the length of mask (${s.length}) and the legnth of inputs (${e.length})`);return ne(()=>{let n=!0;if(s.forEach(o=>{if(o!=null){n=!1;return}}),n)return null;const r=[];for(let o=0;o<e.length;++o)s[o]==null?r.push(Be(pr(e[o]),"bool")):s[o].rank<e[o].rank?r.push(kn(s[o],-1)):r.push(s[o]);const i=Nn(r,this.axis);return hS(i,-1,!1)})}getConfig(){const e={axis:this.axis},s=super.getConfig();return Object.assign(e,s),e}}KE.className="Concatenate",Ie(KE);function Ku(t,e){for(;t<0;)t+=e;return t}function YX(t,e,s){if(t.shape.length>3||e.shape.length>3)throw new bt("batchDot is not implemented for tensors of 4D or higher rank yet");if(A(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),A(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof s=="number"&&(s=[s,s]),t.dtype==="complex64"||e.dtype==="complex64")throw new bt("batchDot is not implemented for complex64-type Tensors yet.");const n=t.shape.length,r=e.shape.length;s==null&&(s=[n-1,r-2]);const i=s;return ne(()=>{let o;if(n>r){o=n-r;const c=[];for(let d=0;d<o;++d)c.push(1);e=Z(e,e.shape.concat(c))}else if(r>n){o=r-n;const c=[];for(let d=0;d<o;++d)c.push(1);t=Z(t,t.shape.concat(c))}else o=0;let l;if(t.shape.length===2&&e.shape.length===2)i[0]===i[1]?l=st(V(t,e),i[0]):l=st(V(Tt(t,[1,0]),e),i[1]);else{const c=i[0]!==t.shape.length-1,d=i[1]===e.shape.length-1;l=Ot(t,e,c,d)}if(o>0){let c;n>r?c=n+r-3:c=n-1;const d=[];for(let u=c;u<c+o;++u)d.push(u);l=Tu(l,d)}return l.shape.length===1&&(l=kn(l,1)),l})}class XE extends el{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){A(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const s=e[0],n=e[1];if(s.length>3||n.length>3)throw new bt("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(s,n);if(s[r[0]]!==n[r[1]])throw new U(`Dimension incompatibility: ${s[r[0]]} !== ${n[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new U(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let s=e[0],n=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((i,o)=>Ku(i,e[o].shape.length)):r=[Ku(this.axes,s.shape.length),Ku(this.axes,n.shape.length)],this.normalize&&(s=Am(s,r[0]),n=Am(n,r[1])),YX(s,n,r)}interpretAxes(e,s){let n;return Array.isArray(this.axes)?n=this.axes:n=[Ku(this.axes,e.length),Ku(this.axes,s.length)],n}computeOutputShape(e){A(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const s=e[0].slice(),n=e[1].slice();if(s.length>3||n.length>3)throw new bt("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(s,n);s.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);const i=s.concat(n);return i.length===1&&i.push(1),i}computeMask(e,s){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},s=super.getConfig();return Object.assign(e,s),e}}XE.className="Dot",Ie(XE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class YE extends kt{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),s={stddev:this.stddev};return Object.assign(s,e),s}call(e,s){return ne(()=>{this.invokeCallHook(e,s);const n=dt(e);return Lu(()=>Te(Sm(n.shape,0,this.stddev),n),()=>n,s.training||!1)})}}YE.className="GaussianNoise",Ie(YE);class ZE extends kt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),s={rate:this.rate};return Object.assign(s,e),s}call(e,s){return ne(()=>{this.invokeCallHook(e,s);const n=dt(e);return this.rate>0&&this.rate<1?Lu(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return V(n,Sm(n.shape,1,i))},()=>n,s.training||!1):n})}}ZE.className="GaussianDropout",Ie(ZE);class JE extends kt{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||dt(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),s={rate:this.rate};return Object.assign(s,e),s}call(e,s){return ne(()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(e);return Lu(()=>{const i=dt(e),c=-1.6732632423543772*1.0507009873554805;let d=Ua(Eu(n),this.rate);d=gi(d,"float32");const u=((1-this.rate)*(1+this.rate*c**2))**-.5,h=-u*c*this.rate,p=Te(V(i,d),V(Te(d,-1),c));return Te(V(p,u),h)},()=>dt(e),s.training||!1)}return e})}}JE.className="AlphaDropout",Ie(JE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Xu(t,e,s,n,r,i=.001){let o;if(t.rank===2)o=kW(t,e,s,n,r,i);else if(t.rank===3)o=SW(t,e,s,n,r,i);else if(t.rank===4)o=IW(t,e,s,n,r,i);else throw new bt(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return o}function ZX(t,e,s,n,r=.001){return ne(()=>{const i=Ub(t,n),o=i.mean,l=i.variance;return[Xu(t,o,l,s,e,r),o,l]})}function JX(t,e,s,n,r=.001){return ne(()=>{const i=Ub(t,n),o=i.mean,l=i.variance,c=[];for(const m of Br(0,t.rank))n.indexOf(m)!==-1?c.push(1):c.push(t.shape[m]);const d=Z(o,c),u=Z(l,c),h=e==null?null:Z(e,c),p=s==null?null:Z(s,c);return[Xu(t,d,u,p,h,r),o,l]})}function QX(t,e,s,n,r=.001){return Ft(n.slice().sort(),Br(0,t.rank-1))?ZX(t,e,s,n,r):JX(t,e,s,n,r)}class QE extends kt{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=os(e.betaInitializer||"zeros"),this.gammaInitializer=os(e.gammaInitializer||"ones"),this.movingMeanInitializer=os(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=os(e.movingVarianceInitializer||"ones"),this.betaConstraint=Ds(e.betaConstraint),this.gammaConstraint=Ds(e.gammaConstraint),this.betaRegularizer=as(e.betaRegularizer),this.gammaRegularizer=as(e.gammaRegularizer)}build(e){e=_t(e);const s=this.axis>=0?this.axis:this.axis+e.length,n=e[s];if(n==null)throw new U(`Axis ${s} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Ts({ndim:e.length,axes:{[s]:n}})];const r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,s){return ne(()=>{const n=s.training==null?!1:s.training,r=dt(e),i=r.shape,o=i.length,l=Br(0,o),c=this.axis>=0?this.axis:this.axis+o;l.splice(c,1);const d=Ka(1,o);d[c]=i[c];const u=l.slice();u.sort();const h=!Ft(u,Br(0,o).slice(0,o-1)),p=()=>{if(h){const y=Z(this.movingMean.read(),d),w=Z(this.movingVariance.read(),d),v=this.center?Z(this.beta.read(),d):null,N=this.scale?Z(this.gamma.read(),d):null;return Xu(r,y,w,v,N,this.epsilon)}else return Xu(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!n)return p();const[f,m,b]=QX(r,this.gamma.read(),this.beta.read(),l,this.epsilon),g=(y,w,v)=>{ne(()=>{const N=1-v,C=y.read(),j=V(lt(C,w),N);y.write(lt(C,j))})};return(()=>{g(this.movingMean,m,this.momentum),g(this.movingVariance,b,this.momentum)})(),f})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ds(this.betaInitializer),gammaInitializer:ds(this.gammaInitializer),movingMeanInitializer:ds(this.movingMeanInitializer),movingVarianceInitializer:ds(this.movingVarianceInitializer),betaRegularizer:Kt(this.betaRegularizer),gammaRegularizer:Kt(this.gammaRegularizer),betaConstraint:As(this.betaConstraint),gammaConstraint:As(this.gammaConstraint)},s=super.getConfig();return Object.assign(e,s),e}}QE.className="BatchNormalization",Ie(QE);class e$ extends kt{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const s of this.axis)if(!Number.isInteger(s))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=os(e.betaInitializer||"zeros"),this.gammaInitializer=os(e.gammaInitializer||"ones"),this.betaRegularizer=as(e.betaRegularizer),this.gammaRegularizer=as(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=_t(e);const s=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=s);for(const i of this.axis)if(i<0||i>=s)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==Fo(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const n=this.axis.map(i=>e[i]),r=!0;this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,s){const n=dt(e),r=n.shape,i=r.length;return ne(()=>{let{mean:l,variance:c}=Ub(n,this.axis,!0);const d=Ka(1,i);for(const b of this.axis)d[b]=r[b];const u=b=>b!=null&&b.shape.length!==i?Z(b,d):b;let h=this.scale?u(this.gamma.read()):null,p=this.center?u(this.beta.read()):null;const f=[],m=[];for(let b=0;b<i;++b)this.axis.indexOf(b)!==-1?(f.push(r[b]),m.push(1)):(f.push(1),m.push(r[b]));return l=Lr(l,f),c=Lr(c,f),h!=null&&(h=Lr(h,m)),p!=null&&(p=Lr(p,m)),Xu(n,l,c,p,h,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:ds(this.betaInitializer),gammaInitializer:ds(this.gammaInitializer),betaRegularizer:Kt(this.betaRegularizer),gammaRegularizer:Kt(this.gammaRegularizer)},s=super.getConfig();return Object.assign(e,s),e}}e$.className="LayerNormalization",Ie(e$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function eY(t,e,s){return ne(()=>{if(t.rank!==4)throw new U(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new U("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(s==null&&(s=Ur()),s!=="channelsLast"&&s!=="channelsFirst")throw new U(`Unknown data format: ${s}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let n;return s==="channelsFirst"?n=[[0,0],[0,0],e[0],e[1]]:n=[[0,0],e[0],e[1],[0,0]],Vb(t,n)})}class t$ extends kt{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Ur():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new U(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let s,n;if(typeof e.padding[0]=="number")s=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new U(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(s=e.padding[0],e.padding[1].length!==2)throw new U(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);n=e.padding[1]}this.padding=[s,n]}this.inputSpec=[new Ts({ndim:4})]}computeOutputShape(e){e=_t(e);let s,n;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?s=e[2]+this.padding[0][0]+this.padding[0][1]:s=null,e[3]!=null&&e[3]>=0?n=e[3]+this.padding[1][0]+this.padding[1][1]:n=null,[e[0],e[1],s,n]):(e[1]!=null&&e[1]>=0?s=e[1]+this.padding[0][0]+this.padding[0][1]:s=null,e[2]!=null&&e[2]>=0?n=e[2]+this.padding[1][0]+this.padding[1][1]:n=null,[e[0],s,n,e[3]])}call(e,s){return ne(()=>eY(dt(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},s=super.getConfig();return Object.assign(e,s),e}}t$.className="ZeroPadding2D",Ie(t$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Wm(t,e,s,n,r,i){return ne(()=>{xs(r),Qj(i),Xn(n),s==null&&(s=[1,1]),n==null&&(n="valid"),r==null&&(r=Ur()),i==null&&(i="max"),t=ww(t,r);let o;const l=n==="same"?"same":"valid";return i==="max"?o=Bb(t,e,s,l):o=Tb(t,e,s,l),r==="channelsFirst"&&(o=Tt(o,[0,3,1,2])),o})}function s$(t,e,s,n,r,i){return ne(()=>{xs(r),Qj(i),Xn(n),s==null&&(s=[1,1,1]),n==null&&(n="valid"),r==null&&(r=Ur()),i==null&&(i="max"),t=yE(t,r);let o;const l=n==="same"?"same":"valid";return i==="max"?o=uH(t,e,s,l):o=pW(t,e,s,l),r==="channelsFirst"&&(o=Tt(o,[0,4,1,2,3])),o})}class n$ extends kt{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new U(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Ms(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new U(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Ms(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Xn(this.padding),this.inputSpec=[new Ts({ndim:3})]}computeOutputShape(e){e=_t(e);const s=Hr(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],s,e[2]]}call(e,s){return ne(()=>{this.invokeCallHook(e,s),e=Ou(dt(e),2);const n=this.poolingFunction(dt(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Tu(n,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},s=super.getConfig();return Object.assign(e,s),e}}class r$ extends n${constructor(e){super(e)}poolingFunction(e,s,n,r,i){return xs(i),Xn(r),Wm(e,s,n,r,i,"max")}}r$.className="MaxPooling1D",Ie(r$);class i$ extends n${constructor(e){super(e)}poolingFunction(e,s,n,r,i){return xs(i),Xn(r),Wm(e,s,n,r,i,"avg")}}i$.className="AveragePooling1D",Ie(i$);class o$ extends kt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new U(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Ms(this.poolSize,"poolSize"),Ms(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,xs(this.dataFormat),Xn(this.padding),this.inputSpec=[new Ts({ndim:4})]}computeOutputShape(e){e=_t(e);let s=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2];return s=Hr(s,this.poolSize[0],this.padding,this.strides[0]),n=Hr(n,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],s,n]:[e[0],s,n,e[3]]}call(e,s){return ne(()=>(this.invokeCallHook(e,s),this.poolingFunction(dt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},s=super.getConfig();return Object.assign(e,s),e}}class a$ extends o${constructor(e){super(e)}poolingFunction(e,s,n,r,i){return xs(i),Xn(r),Wm(e,s,n,r,i,"max")}}a$.className="MaxPooling2D",Ie(a$);class l$ extends o${constructor(e){super(e)}poolingFunction(e,s,n,r,i){return xs(i),Xn(r),Wm(e,s,n,r,i,"avg")}}l$.className="AveragePooling2D",Ie(l$);class c$ extends kt{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new U(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Ms(this.poolSize,"poolSize"),Ms(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,xs(this.dataFormat),Xn(this.padding),this.inputSpec=[new Ts({ndim:5})]}computeOutputShape(e){e=_t(e);let s=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return s=Hr(s,this.poolSize[0],this.padding,this.strides[0]),n=Hr(n,this.poolSize[1],this.padding,this.strides[1]),r=Hr(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],s,n,r]:[e[0],s,n,r,e[4]]}call(e,s){return ne(()=>(this.invokeCallHook(e,s),this.poolingFunction(dt(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},s=super.getConfig();return Object.assign(e,s),e}}class d$ extends c${constructor(e){super(e)}poolingFunction(e,s,n,r,i){return xs(i),Xn(r),s$(e,s,n,r,i,"max")}}d$.className="MaxPooling3D",Ie(d$);class u$ extends c${constructor(e){super(e)}poolingFunction(e,s,n,r,i){return xs(i),Xn(r),s$(e,s,n,r,i,"avg")}}u$.className="AveragePooling3D",Ie(u$);class h$ extends kt{constructor(e){super(e),this.inputSpec=[new Ts({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,s){throw new bt}}class p$ extends h${constructor(e){super(e||{})}call(e,s){return ne(()=>{const n=dt(e);return Cs(n,1)})}}p$.className="GlobalAveragePooling1D",Ie(p$);class f$ extends h${constructor(e){super(e||{})}call(e,s){return ne(()=>{const n=dt(e);return Mr(n,1)})}}f$.className="GlobalMaxPooling1D",Ie(f$);class m$ extends kt{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,xs(this.dataFormat),this.inputSpec=[new Ts({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,s){throw new bt}getConfig(){const e={dataFormat:this.dataFormat},s=super.getConfig();return Object.assign(e,s),e}}class g$ extends m${call(e,s){return ne(()=>{const n=dt(e);return this.dataFormat==="channelsLast"?Cs(n,[1,2]):Cs(n,[2,3])})}}g$.className="GlobalAveragePooling2D",Ie(g$);class x$ extends m${call(e,s){return ne(()=>{const n=dt(e);return this.dataFormat==="channelsLast"?Mr(n,[1,2]):Mr(n,[2,3])})}}x$.className="GlobalMaxPooling2D",Ie(x$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class b$ extends kt{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},s=super.getConfig();return Object.assign(e,s),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,s,n={}){const r=s.layer,i=yi(r,n);delete s.layer;const o={layer:i};return Object.assign(o,s),new e(o)}}class y$ extends b${constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=_t(e),e.length<3)throw new U(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const s=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(s),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=_t(e);const s=[e[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(s),r=e[1];return[n[0],r].concat(n.slice(1))}call(e,s){return ne(()=>(e=dt(e),$E((o,l)=>[dt(this.layer.call(o,s)),[]],e,[],!1,null,null,!1,!0)[1]))}}y$.className="TimeDistributed",Ie(y$);function tY(t){Ya(yK,"BidirectionalMergeMode",t)}const sY="concat";class w$ extends b${constructor(e){super(e);const s=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=s,this.forwardLayer=yi(n),s.goBackwards=s.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=s,this.backwardLayer=yi(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?sY:e.mergeMode,tY(this.mergeMode),e.weights)throw new bt("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const s=e.length,n=Math.floor(s/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}computeOutputShape(e){let s=this.forwardLayer.computeOutputShape(e);Array.isArray(s)&&Array.isArray(s[0])||(s=[s]),s=s;let n,r,i;return this.returnState&&(i=s.slice(1)),n=s[0],n=n,this.mergeMode==="concat"?(n[n.length-1]*=2,r=[n]):this.mergeMode==null?r=[n,n.slice()]:r=[n],this.returnState?this.mergeMode==null?r.concat(i).concat(i.slice()):[n].concat(i).concat(i.slice()):Cn(r)}apply(e,s){let n=s==null?null:s.initialState,r=s==null?null:s.constants;s==null&&(s={});const i=EE(e,n,r,this.numConstants);if(e=i.inputs,n=i.initialState,r=i.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(n==null||n.length===0)&&r==null)return super.apply(e,s);const o=[],l=[];if(n!=null){const d=n.length;if(d%2>0)throw new U("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");s.initialState=n,o.push(...n);const u=n.map(h=>new Ts({shape:h.shape}));this.forwardLayer.stateSpec=u.slice(0,d/2),this.backwardLayer.stateSpec=u.slice(d/2),l.push(...u)}if(r!=null)throw new bt("Support for constants in Bidirectional layers is not implemented yet.");const c=o[0]instanceof bi;for(const d of o)if(d instanceof bi!==c)throw new U("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){const d=[e].concat(o),u=this.inputSpec.concat(l),h=this.inputSpec;this.inputSpec=u;const p=super.apply(d,s);return this.inputSpec=h,p}else return super.apply(e,s)}call(e,s){return ne(()=>{const n=s.initialState;let r,i;if(n==null)r=this.forwardLayer.call(e,s),i=this.backwardLayer.call(e,s);else{const c=n.slice(0,n.length/2),d=n.slice(n.length/2);r=this.forwardLayer.call(e,Object.assign(s,{initialState:c})),i=this.backwardLayer.call(e,Object.assign(s,{initialState:d}))}let o;this.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=Ga(i,1));let l;return this.mergeMode==="concat"?l=Xy([r,i]):this.mergeMode==="sum"?l=Te(r,i):this.mergeMode==="ave"?l=V(.5,Te(r,i)):this.mergeMode==="mul"?l=V(r,i):this.mergeMode==null&&(l=[r,i]),this.returnState?this.mergeMode==null?l.concat(o):[l].concat(o):l})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Za(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Za(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,s){Array.isArray(s)&&(s=s[0]);let n;if(this.returnSequences?this.mergeMode==null?n=[s,s]:n=s:this.mergeMode==null?n=[null,null]:n=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(n)?n.concat(i).concat(i):[n].concat(i).concat(i)}else return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},s=super.getConfig();return Object.assign(e,s),e}static fromConfig(e,s){const n=yi(s.layer);if(delete s.layer,s.numConstants!=null)throw new bt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=s;return r.layer=n,new e(r)}}w$.className="Bidirectional",Ie(w$);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class v$ extends kt{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},s=super.getConfig();return Object.assign(e,s),e}call(e,s){return ne(()=>(e=dt(e),e.dtype!=="float32"&&(e=gi(e,"float32")),Te(V(e,this.scale),this.offset)))}}v$.className="Rescaling",Ie(v$);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:nY,cropAndResize:rY}=to;class N$ extends kt{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,s,n,r,i,o,l,c){return ne(()=>{let d,u=!1;const h=s/o,p=n/l,f=(r+s)/o,m=(i+n)/l,b=[h,p,f,m],g=[];e.rank===3?(u=!0,d=eo([e])):d=e;for(let N=0;N<d.shape[0];N++)g.push(b);const x=yu(g,[g.length,4]),y=$u(0,g.length,1,"int32"),v=rY(d,x,y,[r,i],"nearest");return gi(u?dt(qa(v)):v,c)})}upsize(e,s,n,r){return ne(()=>{const i=nY(e,[s,n]);return gi(i,r)})}call(e,s){return ne(()=>{const n=dt(e),r=n.dtype,i=n.shape,o=i[i.length-3],l=i[i.length-2];let c=0;o!==this.height&&(c=Math.floor((o-this.height)/2));let d=0;return l!==this.width&&(d=Math.floor((l-this.width)/2),d===0&&(d=1)),c>=0&&d>=0?this.centerCrop(n,c,d,this.height,this.width,o,l,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},s=super.getConfig();return Object.assign(e,s),e}computeOutputShape(e){e=_t(e);const s=e.length-3,n=e.length-2;return e[s]=this.height,e[n]=this.width,e}}N$.className="CenterCrop",Ie(N$);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function iY(t,e,s,n){let r=dt(t);if(r.dtype!=="int32"&&(r=gi(r,"int32")),e==="int")return r;const i=r.shape;if(r.rank===0&&(r=kn(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=kn(r,-1)),r.rank>2)throw new U(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${r.rank}.`);const o=["multiHot","oneHot"].includes(e),l=r;let c;if(typeof n<"u"&&e==="count"?c=bS(l,n,s,o):c=bS(l,[],s,o),e!=="tfIdf")return c;if(n)return V(c,n);throw new U("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class k$ extends kt{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},s=super.getConfig();return Object.assign(e,s),e}computeOutputShape(e){return e=_t(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,s){return ne(()=>{e=dt(e),e.dtype!=="int32"&&(e=gi(e,"int32"));let n;if(typeof s.countWeights<"u"){if(this.outputMode!=="count")throw new U(`countWeights is not used when outputMode !== count.
              Received countWeights=${s.countWeights}`);n=dt(s.countWeights)}const r=Mr(e),i=dm(e),o=qn(this.numTokens,r).bufferSync().get(0),l=Ua(i,0).bufferSync().get(0);if(!(o&&l))throw new U(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return iY(e,this.outputMode,this.numTokens,n)})}}k$.className="CategoryEncoding",Ie(k$);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const oY=["bilinear","nearest"],C$=new Set(oY);class S$ extends kt{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(C$.has(e.interpolation))this.interpolation=e.interpolation;else throw new U(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=_t(e);const s=e[2];return[this.height,this.width,s]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},s=super.getConfig();return Object.assign(e,s),e}call(e,s){return ne(()=>{const n=[this.height,this.width];if(this.interpolation==="bilinear")return to.resizeBilinear(e,n,!this.cropToAspectRatio);if(this.interpolation==="nearest")return to.resizeNearestNeighbor(e,n,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...C$]} are supported`)})}}S$.className="Resizing",Ie(S$);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class j${constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}j$.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class I$ extends kt{constructor(e){super(e),this.randomGenerator=new j$(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},s=super.getConfig();return Object.assign(e,s),e}}I$.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const aY=["bilinear","nearest"],E$=new Set(aY);class $$ extends I${constructor(e){super(e);const{factor:s,interpolation:n="bilinear"}=e;if(this.factor=s,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new U(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new U(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new U(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(n)if(E$.has(n))this.interpolation=n;else throw new U(`Invalid interpolation parameter: ${n} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},s=super.getConfig();return Object.assign(e,s),e}computeOutputShape(e){e=_t(e);const s=e[2];return[this.imgHeight,-1,s]}call(e,s){return ne(()=>{const n=dt(e);this.imgHeight=n.shape[n.shape.length-3];const r=n.shape[n.shape.length-2];this.widthFactor=Eu([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*r;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return to.resizeBilinear(e,o);case"nearest":return to.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...E$]} are supported`)}})}}$$.className="RandomWidth",Ie($$);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Iw(t){return new jw(t)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */oe().registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var T$;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(T$||(T$={}));var A$;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(A$||(A$={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var D$;(function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"})(D$||(D$={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ye(t,e){Array.isArray(t)||(t=[t]),t.forEach(s=>{s!=null&&A(s.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lY=US;class Gm extends d0{nextDataId(){return Gm.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new Uk(this,ai())}write(e,s,n){this.firstUse&&(this.firstUse=!1,oe().get("IS_NODE")&&Gn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}makeTensorInfo(e,s,n){let r;if(s==="string"&&n!=null&&n.length>0&&wd(n[0])){const i=n.map(o=>Io(o));r=this.write(i,e,s)}else r=this.write(n,e,s);return{dataId:r,shape:e,dtype:s}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const s=this.data.get(e);s.refCount++}decRef(e){if(this.data.has(e)){const s=this.data.get(e);s.refCount--}}move(e,s,n,r,i){this.data.set(e,{values:s,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:s,complexTensorInfos:n}=this.data.get(e);if(s==="complex64"){const r=this.readSync(n.real.dataId),i=this.readSync(n.imag.dataId);return so(r,i)}return bU(this.data.get(e).values,s)}bufferSync(e){const s=this.readSync(e.dataId);if(e.dtype==="string")try{const n=s.map(r=>Eo(r));return Nt(e.shape,e.dtype,n)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Nt(e.shape,e.dtype,s)}makeOutput(e,s,n){return ai().makeTensorFromTensorInfo(this.makeTensorInfo(s,n,e),this)}disposeData(e,s=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!s&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:n}=this.data.get(e);n!=null&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const s=yn();return e(),{kernelMs:yn()-s}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Ye([e],"where");const s=this.readSync(e.dataId);return lY(e.shape,s)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Gm.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _$(t){const e=new Float32Array(t.length);for(let s=0;s<t.length;++s)e[s]=Math.abs(t[s]);return e}const cY={kernelName:Kp,backendName:"cpu",kernelFunc:t=>{const{x:e}=t.inputs,s=t.backend;Ye(e,"abs");let n=new Float32Array(pe(e.shape));const r=s.data.get(e.dataId).values;return n=_$(r),s.makeOutput(n,e.shape,e.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bs(t){return(e,s,n,r,i)=>{const o=ft(e,s),l=o.length,c=tt(o),d=pe(o),u=Zs(i,d),h=e.length,p=s.length,f=tt(e),m=tt(s),b=rc(e,o),g=rc(s,o);if(b.length+g.length===0)for(let x=0;x<u.length;++x)u[x]=t(n[x%n.length],r[x%r.length]);else for(let x=0;x<u.length;++x){const y=ql(x,l,c),w=y.slice(-h);b.forEach(j=>w[j]=0);const v=oi(w,h,f),N=y.slice(-p);g.forEach(j=>N[j]=0);const C=oi(N,p,m);u[x]=t(n[v],r[C])}return[u,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function On(t){const{inputs:e,backend:s}=t,{real:n,imag:r}=e,i=s.data.get(n.dataId).values,o=s.data.get(r.dataId).values,l=s.makeTensorInfo(n.shape,"complex64"),c=s.data.get(l.dataId);return c.complexTensorInfos={real:s.makeTensorInfo(n.shape,"float32",i),imag:s.makeTensorInfo(r.shape,"float32",o)},l}const dY={kernelName:E0,backendName:"cpu",kernelFunc:On};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hm(t,e,s="float32"){if(s==="complex64"){const r=Hm(t,e,"float32"),i=Hm(t,e,"float32");return On({inputs:{real:r,imag:i},backend:t})}const n=Js(pe(e),s);return t.makeTensorInfo(e,s,n)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vi(t){const{inputs:e,backend:s}=t,{x:n}=e;return s.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}const uY={kernelName:Bd,backendName:"cpu",kernelFunc:vi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tl(t){const{inputs:e,backend:s}=t,{input:n}=e,r=s.data.get(n.dataId).complexTensorInfos.real,i=s.data.get(r.dataId).values;return s.makeTensorInfo(r.shape,r.dtype,i)}const hY={kernelName:eb,backendName:"cpu",kernelFunc:tl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R$(t,e,s,n){if(n==="int32"){const r=Int32Array.from(t);return[e,"int32",r]}if(n==="bool"){const r=Aa([0],s),[i,o]=bs((l,c)=>l!==c?1:0)(e,[],t,r,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${s} to ${n}`)}function Wo(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{dtype:i}=n;if(i==="complex64"){if(r.dtype==="complex64")return vi({inputs:{x:r},backend:s});const u=Hm(s,r.shape,r.dtype),h=Wo({inputs:{x:r},backend:s,attrs:{dtype:"float32"}}),p=On({inputs:{real:h,imag:u},backend:s});return s.disposeIntermediateTensorInfo(u),s.disposeIntermediateTensorInfo(h),p}if(r.dtype==="complex64"){const u=tl({inputs:{input:r},backend:s}),h=Wo({inputs:{x:u},backend:s,attrs:{dtype:i}});return s.disposeIntermediateTensorInfo(u),h}if(!Hk(r.dtype,i)){const u=vi({inputs:{x:r},backend:s});return{dataId:u.dataId,shape:u.shape,dtype:i}}const o=s.data.get(r.dataId).values,[l,c,d]=R$(o,r.shape,r.dtype,i);return s.makeTensorInfo(l,c,d)}const pY={kernelName:Ed,backendName:"cpu",kernelFunc:Wo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _s(t,e,s,n){return s==null?({inputs:r,backend:i})=>{const{a:o,b:l}=r,c=i;Ye([o,l],t);const d=c.data.get(o.dataId).values,u=c.data.get(l.dataId).values,h=o.dtype==="string"?no(d):d,p=o.dtype==="string"?no(u):u,f=n||o.dtype,[m,b]=e(o.shape,l.shape,h,p,f);return c.makeTensorInfo(b,f,m)}:({inputs:r,backend:i})=>{const{a:o,b:l}=r,c=i;if(o.dtype==="complex64"||l.dtype==="complex64"){const d=Wo({inputs:{x:o},backend:c,attrs:{dtype:"complex64"}}),u=c.data.get(d.dataId),h=u.complexTensorInfos.real,p=u.complexTensorInfos.imag,f=c.data.get(h.dataId).values,m=c.data.get(p.dataId).values,b=Wo({inputs:{x:l},backend:c,attrs:{dtype:"complex64"}}),g=c.data.get(b.dataId),x=g.complexTensorInfos.real,y=g.complexTensorInfos.imag,w=c.data.get(x.dataId).values,v=c.data.get(y.dataId).values,[N,C,j]=s(o.shape,l.shape,f,m,w,v),I=c.makeTensorInfo(j,"float32",N),T=c.makeTensorInfo(j,"float32",C),E=On({inputs:{real:I,imag:T},backend:c});return c.disposeIntermediateTensorInfo(d),c.disposeIntermediateTensorInfo(b),c.disposeIntermediateTensorInfo(I),c.disposeIntermediateTensorInfo(T),E}else{const d=c.data.get(o.dataId).values,u=c.data.get(l.dataId).values,h=n||o.dtype,[p,f]=e(o.shape,l.shape,d,u,h);return c.makeTensorInfo(f,h,p)}}}function Ew(t){return(e,s,n,r,i,o)=>{const l=ft(e,s),c=pe(l),d=l.length,u=tt(l),h=Zs("float32",c),p=Zs("float32",c),f=rc(e,l),m=rc(s,l),b=so(n,r),g=so(i,o),x=e.length,y=tt(e),w=s.length,v=tt(s);if(f.length+m.length===0)for(let N=0;N<h.length;N++){const C=N%b.length,j=N%g.length,I=t(b[C*2],b[C*2+1],g[j*2],g[j*2+1]);h[N]=I.real,p[N]=I.imag}else for(let N=0;N<h.length;N++){const C=ql(N,d,u),j=C.slice(-x);f.forEach(D=>j[D]=0);const I=oi(j,x,y),T=C.slice(-w);m.forEach(D=>T[D]=0);const E=oi(T,w,v),$=t(b[I*2],b[I*2+1],g[E*2],g[E*2+1]);h[N]=$.real,p[N]=$.imag}return[h,p,l]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P$=bs((t,e)=>t+e),fY=Ew((t,e,s,n)=>({real:t+s,imag:e+n})),gc=_s(Kl,P$,fY),mY={kernelName:Kl,backendName:"cpu",kernelFunc:gc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $w(t,e,s,n,r){const i=pe(n),o=Js(r,s);for(let l=0;l<t.length;l++){const c=t[l];if(c<0)throw new Error("Input x must be non-negative!");c>=r||(i>0?o[c]+=e[l]:o[c]+=1)}return o}function F$(t,e,s,n=!1){const r=t.shape[0],i=t.shape[1],o=Nt([r,s],e.dtype);for(let l=0;l<r;l++)for(let c=0;c<i;c++){const d=t.get(l,c);if(d<0)throw new Error("Input x must be non-negative!");d>=s||(n?o.set(1,l,d):e.size>0?o.set(o.get(l,d)+e.get(l,c),l,d):o.set(o.get(l,d)+1,l,d))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const O$=bs((t,e)=>t&e),gY=_s(I0,O$),xY={kernelName:I0,backendName:"cpu",kernelFunc:gY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ni(t){return(e,s,n)=>{const r=ps(s,e.length);for(let i=0;i<e.length;++i)r[i]=t(e[i],n);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vt(t,e,s){const n=Ni(e);return Go(t,n,s)}function Go(t,e,s){return({inputs:n,attrs:r,backend:i})=>{const{x:o}=n;Ye(o,t);const l=i,c=l.data.get(o.dataId).values;let d;if(o.dtype==="string"){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");d=no(c)}else d=c;const u=s||o.dtype,h=e(d,u,r);return l.makeTensorInfo(o.shape,u,h)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M$=Ni(t=>Math.ceil(t)),bY=Go($d,M$),yY={kernelName:$d,backendName:"cpu",kernelFunc:bY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L$(t,e,s,n){const r=ps(s,pe(e));if(n&&s!=="string"){let i=0;t.forEach(o=>{const l=pe(o.shape);r.set(o.vals,i),i+=l})}else{let i=0;t.forEach(o=>{const l=s==="string"?no(o.vals):o.vals;let c=0;for(let d=0;d<o.shape[0];++d){const u=d*e[1]+i;for(let h=0;h<o.shape[1];++h)r[u+h]=l[c++]}i+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const z$=bs((t,e)=>t===e?1:0),B$=_s(df,z$,null,"bool"),wY={kernelName:df,backendName:"cpu",kernelFunc:B$};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const U$=Ni(t=>Math.exp(t)),V$=Go(Fd,U$,"float32"),vY={kernelName:Fd,backendName:"cpu",kernelFunc:V$};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W$=Ni(t=>Math.expm1(t)),NY=Go(Od,W$),kY={kernelName:Od,backendName:"cpu",kernelFunc:NY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G$=Ni(t=>Math.floor(t)),CY=Go(Md,G$),SY={kernelName:Md,backendName:"cpu",kernelFunc:CY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const H$=bs((t,e)=>Math.floor(t/e)),jY=_s(Ld,H$,null,"int32"),IY={kernelName:Ld,backendName:"cpu",kernelFunc:jY};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q$(t,e,s,n,r,i,o,l,c){const d=Nt([n,i],s);for(let u=0;u<n;u++){const h=[];let p=0;for(let f=0;f<r;f++){const m=t[u*r+f];p+=m*o[f],h.push(m)}if(p<0||p>=c/i)throw new Error(`Invalid indices: ${h} does not index into ${l}`);for(let f=0;f<i;f++)d.values[u*i+f]=e.get(...e.indexToLoc(p*i+f))}return d}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K$(t,e,s){const n=Nt(s,t.dtype);for(let r=0;r<n.size;++r){const o=n.indexToLoc(r).slice(),l=o[0],c=o[2],d=e.locToIndex([l,c]);o[2]=e.values[d];const u=t.locToIndex(o);0<=u&&u<t.values.length&&(n.values[r]=t.values[u])}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X$=bs((t,e)=>t>e?1:0),EY=_s(ff,X$,null,"bool"),$Y={kernelName:ff,backendName:"cpu",kernelFunc:EY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y$=bs((t,e)=>t>=e?1:0),TY=_s(zd,Y$,null,"bool"),AY={kernelName:zd,backendName:"cpu",kernelFunc:TY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Z$=bs((t,e)=>t<e?1:0),DY=_s(gf,Z$,null,"bool"),_Y={kernelName:gf,backendName:"cpu",kernelFunc:DY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const J$=bs((t,e)=>t<=e?1:0),RY=_s(xf,J$,null,"bool"),PY={kernelName:xf,backendName:"cpu",kernelFunc:RY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q$(t,e,s){const n=(e-t)/(s-1),r=Js(s,"float32");r[0]=t;for(let i=1;i<r.length;i++)r[i]=r[i-1]+n;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eT=Ni(t=>Math.log(t)),FY=Go(Gd,eT),OY={kernelName:Gd,backendName:"cpu",kernelFunc:FY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tT(t,e,s,n){const r=Zs(n,pe(s));for(let i=0;i<r.length;++i){const o=i*e;let l=t[o];for(let c=0;c<e;++c){const d=t[o+c];(Number.isNaN(d)||d>l)&&(l=d)}r[i]=l}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sT=bs((t,e)=>Math.max(t,e)),MY=_s(qd,sT),LY={kernelName:qd,backendName:"cpu",kernelFunc:MY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nT=bs((t,e)=>Math.min(t,e)),zY=_s(Kd,nT),BY={kernelName:Kd,backendName:"cpu",kernelFunc:zY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tw=bs((t,e)=>t*e),UY=Ew((t,e,s,n)=>({real:t*s-e*n,imag:t*n+e*s})),qm=_s(Yd,Tw,UY),VY={kernelName:Yd,backendName:"cpu",kernelFunc:qm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rT(t,e,s){const n=jo(-1,s);return Tw([],e,n,t,s)}function WY(t){const{inputs:e,backend:s}=t,{x:n}=e;Ye(n,"neg");const r=s.data.get(n.dataId).values,[i,o]=rT(r,n.shape,n.dtype);return s.makeTensorInfo(o,n.dtype,i)}const GY={kernelName:Ef,backendName:"cpu",kernelFunc:WY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iT=bs((t,e)=>t!==e?1:0),HY=_s($f,iT,null,"bool"),qY={kernelName:$f,backendName:"cpu",kernelFunc:HY};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aw(t,e,s,n,r){const i=e.length,o=pe(e),l=tt(e),c=tt(r),d=Zs(s,pe(r));for(let u=0;u<o;++u){const h=ql(u,i,l),p=new Array(h.length);for(let m=0;m<p.length;m++)p[m]=h[n[m]];const f=oi(p,i,c);d[f]=t[u]}return d}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sn(t){const{inputs:e,attrs:s,backend:n}=t,{x:r}=e,{perm:i}=s;Ye(r,"transpose");const o=r.shape.length,l=new Array(o);for(let h=0;h<l.length;h++)l[h]=r.shape[i[h]];const c=n.data.get(r.dataId).values,d=Aw(c,r.shape,r.dtype,i,l);return{dataId:n.write(d,l,r.dtype),shape:l,dtype:r.dtype}}const KY={kernelName:Xl,backendName:"cpu",kernelFunc:Sn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oT(t,e,s,n){const[r,i]=Fs(t,n),o=Rn(e,"int32"),l=Js(pe(r),o),c=pe(i);for(let d=0;d<l.length;++d){const u=d*c;let h=1;for(let p=0;p<c;++p)h*=s[u+p];l[d]=h}return{outVals:l,outShape:r,outDtype:o}}function XY(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i,keepDims:o}=n;Ye(r,"prod");const l=r.shape.length,c=vt(i,r.shape),d=cs(c,l);let u=c,h=r;const p=[];d!=null&&(h=Sn({inputs:{x:r},backend:s,attrs:{perm:d}}),p.push(h),u=ms(u.length,l));const f=s.data.get(h.dataId).values,{outVals:m,outShape:b,outDtype:g}=oT(h.shape,h.dtype,f,u);let x=b;return o&&(x=ks(b,c)),p.forEach(y=>s.disposeIntermediateTensorInfo(y)),s.makeTensorInfo(x,g,m)}const YY={kernelName:Pf,backendName:"cpu",kernelFunc:XY};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZY(t,e,s){t.forEach((n,r)=>{if(n<0||n>=s){const i=ql(r,e.length,tt(e)).join(",");throw new Error(`indices[${i}] = ${n} is not in [0, ${s})`)}})}function JY(t,e){for(let s=0;s<t.length;++s){const n=t[s],r=s===t.length-1?e:t[s+1].length;if(n.length===0)throw new Error("Ragged splits may not be empty");if(n[0]<0)throw new Error("Ragged splits must be non-negative");if(n[n.length-1]>r)throw new Error("Ragged splits must not point past values");for(let i=1;i<n.length;++i)if(n[i-1]>n[i])throw new Error("Ragged splits must be sorted in ascending order")}}function QY(t,e,s,n){const r=[];let i=0;const o=e.length-1+s.length,l=new Array(o).fill(null).map(()=>[0]);JY(s,n);let c=1;for(let d=0;d<e.length-1;++d){c*=e[d];const u=e[d+1];for(let h=1;h<c+1;++h)l[d].push(h*u)}for(let d=0;d<t.length;++d){let u=t[d],h=t[d]+1;for(let p=0;p<s.length;++p){const f=s[p],m=p+e.length-1;if(m>=0){const b=l[m],g=b[b.length-1]-f[u];for(let x=u;x<h;++x)l[m].push(f[x+1]+g)}u=f[u],h=f[h]}h!==u&&(r.push([u,h]),i+=h-u)}return{outSplits:l,valueSlices:r,numValues:i}}function eZ(t){const e=[];for(let s=0;s<t.length;++s){const n=t[s].length,r=ps("int32",n);e.push(r),t[s].forEach((i,o)=>r[o]=i)}return e}function aT(t,e){const s=t.slice(0,e);for(;s.length<e;)s.push(1);for(let n=e;n<t.length;n++)s[e-1]*=t[n];return s}function tZ(t,e,s,n,r,i){const o=aT(e,2)[1],l=aT(i,2)[1];let c=0;for(const d of s)for(let u=d[0];u<d[1];++u){for(let h=0;h<n;++h)r[c*l+h]=t[u*o+h];++c}}function sZ(t,e,s,n,r){const i=e.slice();i[0]=r;const o=ps(s,pe(i)),l=t.length,c=l===0?0:l/e[0];return tZ(t,e,n,c,o,i),[o,i]}function lT(t,e,s,n,r,i,o,l){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const c=e[0][0]-1;if(ZY(i,o,c),n.length===0)throw new Error("params.rank must be nonzero");const d=n[0],{outSplits:u,valueSlices:h,numValues:p}=QY(i,o,t,d),f=eZ(u),m=sZ(s,n,r,h,p);return[f,m[0],m[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cT=2147483647;function dT(t,e,s,n,r,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const l=e.length===0,c=r.length===0,d=o.length===0,u=[];l||u.push(e[0]),c||u.push(r[0]),d||u.push(o[0]);for(let g=1;g<u.length;++g)if(u[g]!==u[g-1])throw new Error("starts, limits, and deltas must have the same shape");const h=u.length===0?1:u[0],p=ps("int32",h+1);p[0]=0;for(let g=0;g<h;++g){const x=l?t[0]:t[g],y=c?n[0]:n[g],w=d?i[0]:i[g];if(w===0)throw new Error("Requires delta != 0");let v;if(w>0&&y<x||w<0&&y>x)v=0;else if(v=Math.ceil(Math.abs((y-x)/w)),v>cT)throw new Error(`Requires ((limit - start) / delta) <= ${cT}`);p[g+1]=p[g]+v}const f=p[h],m=ps(s,f);let b=0;for(let g=0;g<h;++g){const x=p[g+1]-p[g];let y=l?t[0]:t[g];const w=d?i[0]:i[g];for(let v=0;v<x;++v)m[b++]=y,y+=w}return[p,m]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var yr=zr;class Km{constructor(e,s,n,r,i,o,l,c,d,u){this.shape=e,this.shapeShape=s,this.values=n,this.valuesShape=r,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=l,this.rowPartitionValues=c,this.rowPartitionValuesShapes=d,this.rowPartitionTypes=mj(u),this.raggedRank=gj(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===yr.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===yr.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const s=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case yr.VALUE_ROWIDS:return Km.getMaxWidthValueRowID(s);case yr.ROW_SPLITS:return Km.getMaxWidthRowSplit(s);default:throw new Error(`Cannot handle partition type ${yr[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const s=e.length;if(s===0||s===1)return 0;let n=0;for(let r=0;r<s-1;++r){const i=e[r+1]-e[r];i>n&&(n=i)}return n}static getMaxWidthValueRowID(e){const s=e.length;if(s===0)return 0;let n=0,r=e[0],i=0;for(let o=1;o<s;++o){const l=e[o];l!==r&&(r=l,i=Math.max(o-n,i),n=o)}return Math.max(s-n,i)}tensorShapeFromTensor(e,s,n=!0){if(s.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return hT(e,n)}calculateOutputSize(e){const s=this.valuesShape,n=this.defaultValueShape;xj(n,s);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=fj(this.raggedRank,r,s);o[0]<0&&(o[0]=e);for(let l=1;l<=this.raggedRank;++l)o[l]<0&&(o[l]=this.getMaxWidth(l));return o}calculateFirstParentOutputIndex(e,s,n){const r=Math.min(e,n),i=[];let o=0;for(let l=0;l<r;++l,o+=s)i.push(o);for(let l=r;l<e;++l)i.push(-1);return A(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,s,n,r){const i=e.length,o=[];for(let l=0;l<i-1;++l){const c=e[l+1]-e[l];let d=Math.min(r,c),u=s[l];u===-1&&(d=0);for(let h=0;h<d;++h)o.push(u),u+=n;for(let h=0;h<c-d;++h)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,s,n,r){const i=e.length,o=[];if(i===0)return[];let l=0,c=e[0];if(c>=s.length)throw new Error(`Got currentValueRowId=${c}, which is not less than ${s.length}`);let d=s[c];o.push(d);for(let u=1;u<i;++u){const h=e[u];if(h===c)d>=0&&(++l,l<r?d+=n:d=-1);else{if(l=0,c=h,h>=s.length)throw new Error(`Got nextValueRowId=${h} which is not less than ${s.length}`);d=s[h]}o.push(d)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,s,n,r){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case yr.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,s,n,r);case yr.ROW_SPLITS:if(i.length-1>s.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${s.length}`);return this.calculateOutputIndexRowSplit(i,s,n,r);default:throw new Error(`Unsupported partition type: ${yr[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const s=this.rowPartitionTypes[0];switch(s){case yr.FIRST_DIM_SIZE:return e[0];case yr.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case yr.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${yr[s]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const s=this.getFirstDimensionSize(),n=this.calculateOutputSize(s),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let c=r.length-2;c>=0;--c)r[c]=r[c+1]*n[c+1];const i=hT(n,!1),o=ps(this.valuesDType,pe(i));if(r[0]*n[0]>0){let c=this.calculateFirstParentOutputIndex(s,r[0],n[0]);for(let d=1;d<=this.raggedRank;++d)c=this.calculateOutputIndex(d-1,c,r[d],n[d]);this.setOutput(this.raggedRank,c,o,i)}return[i,o]}setOutput(e,s,n,r){if(n.length===0)return;const i=this.values,o=n;let l=r.slice();l=l.slice(e+1);const c=pe(l),d=s.length;let u=this.defaultValue;if(u.length!==c&&u.length!==1){const m=this.defaultValueShape;ne(()=>{const b=Z(u,m);u=Cu(b,l).dataSync()})}let h=0,p=0,f=0;for(let m=0;m<=d;++m){let b=m<d?s[m]:-1;if(b===f){++f;continue}if(p<f){const g=i.subarray(h*c),x=o.subarray(p*c),y=(f-p)*c;uT(x,g,y)}if(m>=d){const g=n.length;b=Math.floor(g/c)}if(b>f)if(this.defaultValue.length===1)o.subarray(f*c,b*c).fill(this.defaultValue[0]),f=b;else for(;b>f;){const g=o.slice(f*c);uT(g,u,c),++f}b<0?(h=m+1,p=f):(h=m,p=f,f=p+1)}}}function uT(t,e,s){for(let n=0;n<s;n++)t[n]=e[n]}function hT(t,e){const s=[];for(let n of t){if(n<0){if(!e)throw new Error(`Dimension ${n} must be >= 0`);if(n<-1)throw new Error(`Dimension ${n} must be >= -1`);n=-1}s.push(n)}return s}function pT(t,e,s,n,r,i,o,l,c,d){return new Km(t,e,s,n,r,i,o,l,c,d).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fT(t,e,s,n){const r=t===e,i=t<e&&s<0,o=e<t&&s>1;if(r||i||o)return Js(0,n);const l=Math.abs(Math.ceil((e-t)/s)),c=Js(l,n);e<t&&s===1&&(s=-1),c[0]=t;for(let d=1;d<c.length;d++)c[d]=c[d-1]+s;return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mT=Ni(t=>1/Math.sqrt(t)),nZ=Go(su,mT),rZ={kernelName:su,backendName:"cpu",kernelFunc:nZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sl(t,e,s,n,r,i,o,l,c,d){const u=[n/r,r],h=t.values,p=e.values;if(n===0)return Nt(s,e.dtype);const f=c instanceof Us?c:Nt(u,e.dtype);typeof c=="string"||typeof c=="number"?f.values.fill(c):typeof c=="boolean"&&f.values.fill(+c);for(let m=0;m<i;m++){const b=[];let g=0;for(let x=0;x<o;x++){const y=h[m*o+x];b.push(y),g+=y*l[x]}if(g<0||g>=n/r)throw new Error(`Invalid indices: ${b} does not index into ${s}`);for(let x=0;x<r;x++)d?f.values[g*r+x]+=p[m*r+x]:f.values[g*r+x]=e.rank===0?p[0]:p[m*r+x]}return f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iZ=Ni(t=>1/(1+Math.exp(-t))),gT=Vt(au,t=>1/(1+Math.exp(-t))),oZ={kernelName:au,backendName:"cpu",kernelFunc:gT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xT(t,e,s,n,r){const i=yy(n,e,s),o=pe(s),l=tt(n);if(i){const h=wy(e,l);return r==="string"?t.slice(h,h+o):t.subarray(h,h+o)}const c=r==="string"?no(t):t,d=Nt(n,r,c),u=Nt(s,r);for(let h=0;h<u.size;++h){const p=u.indexToLoc(h),f=p.map((m,b)=>m+e[b]);u.set(d.get(...f),...p)}return r==="string"?Lj(u.values):u.values}function nl(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{begin:i,size:o}=n;Ye(r,"slice");const[l,c]=xm(r,i,o);xy(r,l,c);const d=s.data.get(r.dataId).values,u=xT(d,l,c,r.shape,r.dtype);return s.makeTensorInfo(c,r.dtype,u)}const aZ={kernelName:Bf,backendName:"cpu",kernelFunc:nl};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bT(t,e,s,n,r,i,o){const l=e[0],c=i[0],d=new Array(c),u=new Array(l),h=e[1];if(c===0){if(l!==0)throw new Error(jj(l));const g=ps(s,0),x=ps(r,0);return[g,[0,h],x,d,u]}let p=!0,f=0;const m=new Array(c).fill(0);for(let g=0;g<l;++g){const x=t[g*h];if(x<0)throw new Error(Ij(g,x));if(x>=c)throw new Error(Ej(g,x,c));++m[x],p=p&&x>=f,f=x}let b=!0;for(let g=0;g<c;++g){const x=m[g]===0;d[g]=x,b=b&&!x,m[g]=Math.max(m[g],1),g>0&&(m[g]+=m[g-1])}if(b&&p){const g=t,x=n;for(let y=0;y<l;++y)u[y]=y;return[g,[l,h],x,d,u]}else{const g=m[c-1],x=ps(s,g*h),y=ps(r,g),w=new Array(c).fill(0);for(let v=0;v<l;++v){const N=t[v*h],C=w[N],j=(N===0?0:m[N-1])+C;w[N]++;for(let I=0;I<h;++I)x[j*h+I]=t[v*h+I];y[j]=n[v],u[v]=j}for(let v=0;v<c;++v)if(w[v]===0){const C=v===0?0:m[v-1];x[C*h+0]=v;for(let j=1;j<h;++j)x[C*h+j]=0;y[C]=o}return[x,[g,h],y,d,u]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yT(t,e,s,n,r){const i=pe(n),o=e[0],l=r.length,c=[];let d=1,u=-1;for(let g=0;g<l;++g){const x=r[g];if(x===-1){if(u!==-1)throw new Error($j(u,g));u=g,c.push(1)}else{if(x<0)throw new Error(Tj(g,x));d*=x,c.push(x)}}if(u!==-1){if(d<=0)throw new Error(Aj());const g=Math.trunc(i/d);if(d*g!==i)throw new Error(Dj(n,c));c[u]=g}if(pe(c)!==i)throw new Error(_j(n,c));const p=n.length,f=[];if(p>0){f[p-1]=1;for(let g=p-2;g>=0;--g)f[g]=f[g+1]*n[g+1]}const m=[];if(l>0){m[l-1]=1;for(let g=l-2;g>=0;--g)m[g]=m[g+1]*c[g+1]}const b=ps(s,o*l);for(let g=0;g<o;++g){let x=0;for(let y=0;y<p;++y)x+=t[g*p+y]*f[y];for(let y=0;y<l;++y)b[g*l+y]=Math.trunc(x/m[y]),x%=m[y]}return[b,[o,l],c]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dw(t,e,s,n,r,i=!1,o=0){const l=n.length,c=[e[0],t.length/e[0]],d=c[1],h=l>0?r[l-1]+1:0;if(h<0)throw new Error(By());const p=e.slice();p[0]=h;const f=p.reduce((w,v)=>w*v,1),m=ps(s,f);if(l===0)return h>0&&m.fill(o),[m,p];if(h<=0)throw new Error(By());let b=0,g=1,x=0,y=r[b];for(;;){let w=0;if(g<l){if(w=r[g],y===w){++g;continue}if(y>=w)throw new Error(Rj())}if(y<0||y>=h)throw new Error(Pj(y,h));y>x&&m.fill(o,x*d,y*d);for(let v=b;v<g;++v){const N=n[v];if(N<0||N>=c[0])throw new Error(Fj(v,n[v],c[0]));for(let C=0;C<d;C++)m[y*d+C]+=t[N*d+C]}if(i)for(let v=0;v<d;v++)m[y*d+v]/=g-b;if(b=g,++g,x=y+1,y=w,g>l)break}return x<h&&m.fill(o,x*d,h*d),[m,p]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lZ=Ni(t=>Math.sqrt(t)),cZ=Vt(cu,t=>Math.sqrt(t)),dZ={kernelName:cu,backendName:"cpu",kernelFunc:cZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wT=bs((t,e)=>{const s=t-e;return s*s}),uZ=_s(du,wT),hZ={kernelName:du,backendName:"cpu",kernelFunc:uZ};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vT=Ni((t,e)=>{const{pattern:s,replaceGlobal:n,rewrite:r}=e;return t.replace(new RegExp(s,n?"g":""),r)}),pZ=Go(rb,vT),fZ={kernelName:rb,backendName:"cpu",kernelFunc:pZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NT(t,e,s,n){const r=Nt(t,e.dtype);for(let i=0;i<r.size;i++){const o=r.indexToLoc(i),l=new Array(o.length);for(let c=0;c<l.length;c++)l[c]=o[c]*s[c]+n[c];r.set(e.get(...l),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mZ{constructor(e,s,n,r,i,o){this.separator=Io(e),this.nGramWidths=s,this.leftPad=Io(n),this.rightPad=Io(r),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,s){const n=this.getPadWidth(s);return Math.max(0,e+2*n-s+1)}createNGrams(e,s,n,r,i,o){for(let l=0;l<i;++l){const c=this.getPadWidth(o),d=Math.max(0,c-l),u=Math.max(0,c-(i-(l+1))),h=o-(d+u),p=s+(d>0?0:l-c);let f=0;f+=d*this.leftPad.length;for(let y=0;y<h;++y)f+=e[p+y].length;f+=u*this.rightPad.length;const m=d+u+h-1;f+=m*this.separator.length,n[r+l]=new Uint8Array(f);const b=n[r+l];let g=0;const x=y=>y.forEach(w=>b[g++]=w);for(let y=0;y<d;++y)x(this.leftPad),x(this.separator);for(let y=0;y<h-1;++y)x(e[p+y]),x(this.separator);if(h>0){x(e[p+h-1]);for(let y=0;y<u;++y)x(this.separator),x(this.rightPad)}else{for(let y=0;y<u-1;++y)x(this.rightPad),x(this.separator);x(this.rightPad)}}}compute(e,s){const n=e.length,r=s.length;if(r>0){let c=s[0];if(c!==0)throw new Error(`First split value must be 0, got ${c}`);for(let d=1;d<r;++d){let u=s[d]>=c;if(u=u&&s[d]<=n,!u)throw new Error(`Invalid split value ${s[d]}, must be in [${c}, ${n}]`);c=s[d]}if(c!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${c}`)}const i=r-1,o=ps("int32",r);if(n===0||r===0){const c=new Array(n);for(let d=0;d<=i;++d)o[d]=0;return[c,o]}o[0]=0;for(let c=1;c<=i;++c){const d=s[c]-s[c-1];let u=0;this.nGramWidths.forEach(h=>{u+=this.getNumNGrams(d,h)}),this.preserveShort&&d>0&&u===0&&(u=1),o[c]=o[c-1]+u}const l=new Array(o[i]);for(let c=0;c<i;++c){const d=s[c];let u=o[c];if(this.nGramWidths.forEach(h=>{const p=s[c+1]-s[c],f=this.getNumNGrams(p,h);this.createNGrams(e,d,l,u,f,h),u+=f}),this.preserveShort&&u===o[c]){const h=s[c+1]-s[c];if(h===0)continue;const p=h+2*this.padWidth;this.createNGrams(e,d,l,u,1,p)}}return[l,o]}}function kT(t,e,s,n,r,i,o,l){return new mZ(s,n,r,i,o,l).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gZ(t,e,s,n){if(!t.length)return;if(e.length===0){for(let i=0;i<t.length;++i)n.push(t.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=t.indexOf(i);for(;o!==-1;){const l=t.subarray(0,o);(!s||l.length!==0)&&n.push(l),t=t.subarray(o+1),o=t.indexOf(i)}(!s||t.length!==0)&&n.push(t);return}let r=0;for(let i=0;i<t.length+1;i++)if(i===t.length||e.indexOf(t[i])!==-1){const o=t.subarray(r,i);(!s||o.length!==0)&&n.push(o),r=i+1}}function CT(t,e,s){const n=t.length,r=[];let i=0,o=0;const l=new Array(n);for(let p=0;p<n;++p){const f=r.length;gZ(t[p],e,s,r);const m=r.length-f;l[p]=m,i+=m,o=Math.max(o,m)}const c=ps("int32",i*2),d=new Array(i),u=[n,o];let h=0;for(let p=0;p<n;++p)for(let f=0;f<l[p];++f)c[h*2]=p,c[h*2+1]=f,d[h]=r[h],++h;return[c,d,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ST(t,e){const s=ps("int32",t.length);for(let n=0;n<t.length;++n)s[n]=OU(t[n]).modulo(e).getLowBitsUnsigned();return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jT=bs((t,e)=>t-e),xZ=Ew((t,e,s,n)=>({real:t-s,imag:e-n})),_w=_s(uu,jT,xZ),bZ={kernelName:uu,backendName:"cpu",kernelFunc:_w};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IT(t,e){const s=new Array(t.rank);for(let r=0;r<s.length;r++)s[r]=t.shape[r]*e[r];const n=Nt(s,t.dtype);for(let r=0;r<n.values.length;++r){const i=n.indexToLoc(r),o=new Array(t.rank);for(let c=0;c<o.length;c++)o[c]=i[c]%t.shape[c];const l=t.locToIndex(o);n.values[r]=t.values[l]}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yu=(t,e)=>{const s=e.value-t.value;return s===0?t.index-e.index:s};function ET(t,e,s=0,n=t.length-1){for(;n>s;){if(n-s>600){const l=n-s+1,c=e-s+1,d=Math.log(l),u=.5*Math.exp(2*d/3),h=.5*Math.sqrt(d*u*(l-u)/l)*Math.sign(c-l/2),p=Math.max(s,Math.floor(e-c*u/l+h)),f=Math.min(n,Math.floor(e+(l-c)*u/l+h));ET(t,e,p,f)}const r=t[e];let i=s,o=n;for(Vl(t,s,e),Yu(t[n],r)>0&&Vl(t,s,n);i<o;){for(Vl(t,i,o),i++,o--;Yu(t[i],r)<0;)i=i+1;for(;Yu(t[o],r)>0;)o=o-1}Yu(t[s],r)===0?Vl(t,s,o):(o=o+1,Vl(t,o,n)),o<=e&&(s=o+1),e<=o&&(n=o-1)}}function $T(t,e,s,n,r){const i=e[e.length-1],[o,l]=[t.length/i,i],c=Zs(s,o*n),d=Zs("int32",o*n);for(let h=0;h<o;h++){const p=h*l,f=t.subarray(p,p+l);let m=new Array(f.length);f.forEach((y,w)=>m[w]={value:y,index:w}),n<m.length&&(ET(m,n),m=m.slice(0,n)),r&&m.sort(Yu);const b=h*n,g=c.subarray(b,b+n),x=d.subarray(b,b+n);for(let y=0;y<n;y++)g[y]=m[y].value,x[y]=m[y].index}const u=e.slice();return u[u.length-1]=n,[Nt(u,s,c),Nt(u,"int32",d)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TT(t,e,s,n){const r=vt(e,s)[0],i=[1,s[0],1];for(let m=0;m<r;m++)i[0]*=s[m];i[1]=s[r];for(let m=r+1;m<s.length;m++)i[2]*=s[m];const o=new Map,l=new Int32Array(s[r]),c=new Us(i,n,t),d=[],u=i[0]===1&&i[2]===1;for(let m=0;m<s[r];m++){let b;if(u)b=t[m].toString();else{const x=[];for(let y=0;y<i[0];y++)for(let w=0;w<i[2];w++)x.push(c.get(y,m,w));b=x.join(",")}const g=o.get(b);if(g!=null)l[m]=g;else{const x=o.size;o.set(b,x),l[m]=x,d.push(m)}}const h=i.slice();h[1]=o.size;const p=new Us(h,n);d.forEach((m,b)=>{for(let g=0;g<i[0];g++)for(let x=0;x<i[2];x++)p.set(c.get(g,m,x),g,b,x)});const f=s.slice();return f[r]=h[1],{outputValues:p.values,outputShape:f,indices:l}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yZ=Object.freeze(Object.defineProperty({__proto__:null,addImpl:P$,bincountImpl:$w,bincountReduceImpl:F$,bitwiseAndImpl:O$,castImpl:R$,ceilImpl:M$,concatImpl:L$,equalImpl:z$,expImpl:U$,expm1Impl:W$,floorDivImpl:H$,floorImpl:G$,gatherNdImpl:q$,gatherV2Impl:K$,greaterEqualImpl:Y$,greaterImpl:X$,lessEqualImpl:J$,lessImpl:Z$,linSpaceImpl:Q$,logImpl:eT,maxImpl:tT,maximumImpl:sT,minimumImpl:nT,multiplyImpl:Tw,negImpl:rT,notEqualImpl:iT,prodImpl:oT,raggedGatherImpl:lT,raggedRangeImpl:dT,raggedTensorToTensorImpl:pT,rangeImpl:fT,rsqrtImpl:mT,scatterImpl:sl,sigmoidImpl:iZ,simpleAbsImpl:_$,sliceImpl:xT,sparseFillEmptyRowsImpl:bT,sparseReshapeImpl:yT,sparseSegmentReductionImpl:Dw,sqrtImpl:lZ,squaredDifferenceImpl:wT,staticRegexReplaceImpl:vT,stridedSliceImpl:NT,stringNGramsImpl:kT,stringSplitImpl:CT,stringToHashBucketFastImpl:ST,subImpl:jT,tileImpl:IT,topKImpl:$T,transposeImpl:Aw,uniqueImpl:TT},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */eS("cpu",()=>new Gm,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AT=Vt(Rd,t=>t>=0?t:Math.exp(t)-1),wZ={kernelName:Rd,backendName:"cpu",kernelFunc:AT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DT(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{alpha:i}=n;Ye([r],"leakyRelu");const o=pe(r.shape),l=s.data.get(r.dataId).values,c=Zs("float32",o);for(let d=0;d<l.length;d++)c[d]=l[d]<0?i*l[d]:l[d];return s.makeTensorInfo(r.shape,"float32",c)}const vZ={kernelName:mf,backendName:"cpu",kernelFunc:DT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NZ=bs((t,e)=>t<0?e*t:t);function _T(t){const{inputs:e,backend:s}=t,{x:n,alpha:r}=e;Ye([n,r],"prelu");const i=s.data.get(n.dataId).values,o=s.data.get(r.dataId).values,[l,c]=NZ(n.shape,r.shape,i,o,"float32");return s.makeTensorInfo(c,"float32",l)}const kZ={kernelName:Rf,backendName:"cpu",kernelFunc:_T};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RT=Vt(Qd,t=>Math.max(0,t)),CZ={kernelName:Qd,backendName:"cpu",kernelFunc:RT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PT=Vt(eu,t=>Math.min(Math.max(0,t),6)),SZ={kernelName:eu,backendName:"cpu",kernelFunc:PT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xm(t,e,s,n,r){if(s==="linear")return vi({inputs:{x:e},backend:t});if(s==="relu")return RT({inputs:{x:e},backend:t});if(s==="elu")return AT({inputs:{x:e},backend:t});if(s==="relu6")return PT({inputs:{x:e},backend:t});if(s==="prelu")return _T({inputs:{x:e,alpha:n},backend:t});if(s==="leakyrelu")return DT({inputs:{x:e},backend:t,attrs:{alpha:r}});if(s==="sigmoid")return gT({inputs:{x:e},backend:t});throw new Error(`Activation ${s} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function es(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{shape:i}=n,o=pe(r.shape),l=Gk(i,o),c=pe(l);A(o===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),s.incRef(r.dataId);const d=s.data.get(r.dataId);if(d.complexTensorInfos!=null){const u=d.complexTensorInfos.real,h=d.complexTensorInfos.imag;u.shape=l,h.shape=l}return{dataId:r.dataId,shape:l,dtype:r.dtype}}const jZ={kernelName:Ff,backendName:"cpu",kernelFunc:es};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FT(t){const{inputs:e,backend:s,attrs:n}=t,{a:r,b:i}=e,{transposeA:o,transposeB:l}=n;Ye([r,i],"matMul");const c=r.shape.length,d=i.shape.length,u=o?r.shape[c-2]:r.shape[c-1],h=l?i.shape[d-1]:i.shape[d-2],p=o?r.shape[c-1]:r.shape[c-2],f=l?i.shape[d-2]:i.shape[d-1],m=r.shape.slice(0,-2),b=i.shape.slice(0,-2),g=pe(m),x=pe(b),w=ft(r.shape.slice(0,-2),i.shape.slice(0,-2)).concat([p,f]);A(u===h,()=>`Error in matMul: inner shapes (${u}) and (${h}) of Tensors with shapes ${r.shape} and ${i.shape} and transposeA=${o} and transposeB=${l} must match.`);const v=o?[g,u,p]:[g,p,u],N=l?[x,f,h]:[x,h,f],C=es({inputs:{x:r},backend:s,attrs:{shape:v}}),j=es({inputs:{x:i},backend:s,attrs:{shape:N}}),I=o?C.shape[1]:C.shape[2],T=o?C.shape[2]:C.shape[1],E=l?j.shape[1]:j.shape[2],$=Math.max(g,x),D=s.data.get(C.dataId).values,P=s.data.get(j.dataId).values,_=tt(C.shape),O=tt(j.shape),[R,X,L]=o?[_[0],1,_[1]]:[_[0],_[1],1],[K,B,G]=l?[1,O[1],O[0]]:[O[1],1,O[0]],de=T*E,ae=Nt([$,T,E],C.dtype),ve=ae.values,Ne=s.blockSize;for(let le=0;le<$;le++){const H=le%g,ue=le%x;for(let F=0;F<T;F+=Ne){const ee=Math.min(F+Ne,T);for(let re=0;re<E;re+=Ne){const te=Math.min(re+Ne,E);for(let ce=0;ce<I;ce+=Ne){const Se=Math.min(ce+Ne,I);for(let Pe=F;Pe<ee;Pe++)for(let $e=re;$e<te;$e++){let rt=0;for(let q=ce;q<Se;q++){const fe=D[H*R+Pe*X+q*L],Fe=P[q*K+$e*B+ue*G];rt+=fe*Fe}ve[le*de+(Pe*E+$e)]+=rt}}}}}return s.disposeIntermediateTensorInfo(C),s.disposeIntermediateTensorInfo(j),s.makeTensorInfo(w,ae.dtype,ae.values)}const IZ={kernelName:Qp,backendName:"cpu",kernelFunc:FT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EZ(t){const{inputs:e,backend:s,attrs:n}=t,{a:r,b:i,bias:o,preluActivationWeights:l}=e,{transposeA:c,transposeB:d,activation:u,leakyreluAlpha:h}=n;let p,f,m;const b=[];p=FT({inputs:{a:r,b:i},attrs:{transposeA:c,transposeB:d},backend:s}),o&&(f=gc({inputs:{a:p,b:o},backend:s}),b.push(p),p=f),u&&(m=Xm(s,p,u,l,h),b.push(p),p=m);for(const x of b)s.disposeIntermediateTensorInfo(x);return p}const $Z={kernelName:Xf,backendName:"cpu",kernelFunc:EZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TZ=Vt(vd,t=>Math.acos(t)),AZ={kernelName:vd,backendName:"cpu",kernelFunc:TZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DZ=Vt(Nd,t=>Math.acosh(t)),_Z={kernelName:Nd,backendName:"cpu",kernelFunc:DZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RZ(t){const{inputs:e,backend:s}=t,n=e;Ye(e,"addN");const r=n.map(l=>s.data.get(l.dataId).values),i=Nt(n[0].shape,n[0].dtype),o=i.values;for(let l=0;l<n.length;l++){const c=r[l];for(let d=0;d<o.length;d++)o[d]+=c[d]}return s.makeTensorInfo(i.shape,i.dtype,i.values)}const PZ={kernelName:v0,backendName:"cpu",kernelFunc:RZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FZ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i,keepDims:o}=n;Ye(r,"all");const l=vt(i,r.shape);let c=l;const d=cs(c,r.shape.length);let u=r;d!=null&&(u=Sn({inputs:{x:r},backend:s,attrs:{perm:d}}),c=ms(c.length,r.shape.length)),Ws("all",c,u.shape.length);const[h,p]=Fs(u.shape,c),f=pe(p),m=Js(pe(h),u.dtype),b=s.data.get(u.dataId).values;for(let x=0;x<m.length;++x){const y=x*f;let w=b[y];for(let v=0;v<f;++v){const N=b[y+v];w=w&&N}m[x]=w}d!=null&&s.disposeIntermediateTensorInfo(u);const g=s.makeTensorInfo(h,u.dtype,m);if(o){const x=ks(h,l),y=es({inputs:{x:g},backend:s,attrs:{shape:x}});return s.disposeIntermediateTensorInfo(g),y}return g}const OZ={kernelName:N0,backendName:"cpu",kernelFunc:FZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MZ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i,keepDims:o}=n;Ye(r,"any");const l=vt(i,r.shape);let c=l;const d=cs(c,r.shape.length);let u=r;d!=null&&(u=Sn({inputs:{x:r},backend:s,attrs:{perm:d}}),c=ms(c.length,r.shape.length)),Ws("any",c,u.shape.length);const[h,p]=Fs(u.shape,c),f=pe(p),m=Js(pe(h),u.dtype),b=s.data.get(u.dataId).values;for(let x=0;x<m.length;++x){const y=x*f;let w=b[y];for(let v=0;v<f;++v){const N=b[y+v];w=w||N}m[x]=w}d!=null&&s.disposeIntermediateTensorInfo(u);const g=s.makeTensorInfo(h,u.dtype,m);if(o){const x=ks(h,l),y=es({inputs:{x:g},backend:s,attrs:{shape:x}});return s.disposeIntermediateTensorInfo(g),y}return g}const LZ={kernelName:k0,backendName:"cpu",kernelFunc:MZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zZ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i}=n;Ye(r,"argMax");let o=vt(i,r.shape);const l=cs(o,r.shape.length);let c=r;const d=[];l!=null&&(c=Sn({inputs:{x:r},backend:s,attrs:{perm:l}}),d.push(c),o=ms(o.length,c.shape.length)),o=[o[0]],Ws("argMax",o,c.shape.length);const[u,h]=Fs(c.shape,o),p=pe(u),f=Js(p,"int32"),m=pe(h),b=s.data.get(c.dataId).values;for(let g=0;g<f.length;++g){const x=g*m;let y=b[x],w=0;for(let v=0;v<m;++v){const N=b[x+v];N>y&&(y=N,w=v)}f[g]=w}return d.forEach(g=>s.disposeIntermediateTensorInfo(g)),s.makeTensorInfo(u,"int32",f)}const BZ={kernelName:Xp,backendName:"cpu",kernelFunc:zZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UZ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i}=n;Ye(r,"argMin");let o=vt(i,r.shape);const l=cs(o,r.shape.length);let c=r;const d=[];l!=null&&(c=Sn({inputs:{x:r},backend:s,attrs:{perm:l}}),d.push(c),o=ms(o.length,c.shape.length)),o=[o[0]],Ws("argMin",o,c.shape.length);const[u,h]=Fs(c.shape,o),p=pe(u),f=Js(p,"int32"),m=pe(h),b=s.data.get(c.dataId).values;for(let g=0;g<f.length;++g){const x=g*m;let y=b[x],w=0;for(let v=0;v<m;++v){const N=b[x+v];N<y&&(y=N,w=v)}f[g]=w}return d.forEach(g=>s.disposeIntermediateTensorInfo(g)),s.makeTensorInfo(u,"int32",f)}const VZ={kernelName:Yp,backendName:"cpu",kernelFunc:UZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WZ=Vt(kd,t=>Math.asin(t)),GZ={kernelName:kd,backendName:"cpu",kernelFunc:WZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HZ=Vt(Cd,t=>Math.asinh(t)),qZ={kernelName:Cd,backendName:"cpu",kernelFunc:HZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KZ=Vt(Sd,t=>Math.atan(t)),XZ={kernelName:Sd,backendName:"cpu",kernelFunc:KZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YZ=bs((t,e)=>Math.atan2(t,e)),ZZ=_s(Id,YZ),JZ={kernelName:Id,backendName:"cpu",kernelFunc:ZZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QZ=Vt(jd,t=>Math.atanh(t)),eJ={kernelName:jd,backendName:"cpu",kernelFunc:QZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rw(t,e,s,n,r,i){const o=r.strideHeight,l=r.strideWidth,c=r.dilationHeight,d=r.dilationWidth,u=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.top,f=r.padInfo.left,m=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=Nt(r.outShape,s),g=b.values,x=r.outShape[1]*r.outShape[2]*r.outShape[3],y=r.outShape[2]*r.outShape[3],w=r.outShape[3];for(let v=0;v<r.batchSize;++v){const N=v*x,C=v*n[0];for(let j=0;j<r.inChannels;++j)for(let I=0;I<r.outHeight;++I){const T=I*o-p,E=Math.max(0,T),$=Math.min(r.inHeight,u+T),D=N+I*y;for(let P=0;P<r.outWidth;++P){const _=P*l-f,O=Math.max(0,_),R=Math.min(r.inWidth,h+_);let X=m,L=0,K=0;for(let G=E;G<$;G+=c){const de=C+G*n[1];for(let ae=O;ae<R;ae+=d){const ve=de+ae*n[2],Ne=t[ve+j];i==="max"&&Ne>X?X=Ne:i==="avg"&&(L+=Ne,K++)}if(isNaN(X))break}const B=D+P*w+j;g[B]=i==="avg"?L/K:X}}}return b}function OT(t,e,s,n,r=!1,i=!1){const o=Nt(n.outShape,"int32"),l=n.strideHeight,c=n.strideWidth,d=n.dilationHeight,u=n.dilationWidth,h=n.effectiveFilterHeight,p=n.effectiveFilterWidth,f=n.padInfo.top,m=n.padInfo.left,b=Nt(e,s,t);for(let g=0;g<n.batchSize;++g)for(let x=0;x<n.inChannels;++x)for(let y=0;y<n.outHeight;++y){const w=y*l-f;let v=w;for(;v<0;)v+=d;const N=Math.min(n.inHeight,h+w);for(let C=0;C<n.outWidth;++C){const j=C*c-m;let I=j;for(;I<0;)I+=u;const T=Math.min(n.inWidth,p+j);let E=Number.NEGATIVE_INFINITY,$=-1;for(let D=v;D<N;D+=d){const P=D-w;for(let _=I;_<T;_+=u){const O=_-j,R=b.get(g,D,_,x);R>E&&(E=R,r?$=i?((g*n.inHeight+D)*n.inWidth+_)*n.inChannels+x:(D*n.inWidth+_)*n.inChannels+x:$=P*p+O)}}o.set($,g,y,C,x)}}return o}function MT(t,e,s,n,r,i){const o=r.strideDepth,l=r.strideHeight,c=r.strideWidth,d=r.dilationDepth,u=r.dilationHeight,h=r.dilationWidth,p=r.effectiveFilterDepth,f=r.effectiveFilterHeight,m=r.effectiveFilterWidth,b=r.padInfo.front,g=r.padInfo.top,x=r.padInfo.left,y=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=Nt(r.outShape,s),v=w.values,N=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[2]*r.outShape[3]*r.outShape[4],j=r.outShape[3]*r.outShape[4],I=r.outShape[4];for(let T=0;T<r.batchSize;++T){const E=T*N,$=T*n[0];for(let D=0;D<r.inChannels;++D)for(let P=0;P<r.outDepth;++P){const _=P*o-b;let O=_;for(;O<0;)O+=d;const R=Math.min(r.inDepth,p+_),X=E+P*C;for(let L=0;L<r.outHeight;++L){const K=L*l-g;let B=K;for(;B<0;)B+=u;const G=Math.min(r.inHeight,f+K),de=X+L*j;for(let ae=0;ae<r.outWidth;++ae){const ve=ae*c-x;let Ne=ve;for(;Ne<0;)Ne+=h;const le=Math.min(r.inWidth,m+ve),H=de+ae*I;let ue=y,F=0,ee=0;for(let te=O;te<R;te+=d){const ce=$+te*n[1];for(let Se=B;Se<G;Se+=u){const Pe=ce+Se*n[2];for(let $e=Ne;$e<le;$e+=h){const rt=Pe+$e*n[3],q=t[rt+D];if(i==="max"&&q>ue?ue=q:i==="avg"&&(F+=q,ee++),isNaN(ue))break}if(isNaN(ue))break}if(isNaN(ue))break}const re=H+D;v[re]=i==="avg"?F/Math.max(ee,1):ue}}}}return w}function tJ(t,e){const s=Nt(e.outShape,"int32"),n=e.strideDepth,r=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,d=e.effectiveFilterDepth,u=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.front,f=e.padInfo.top,m=e.padInfo.left;for(let b=0;b<e.batchSize;++b)for(let g=0;g<e.inChannels;++g)for(let x=0;x<e.outDepth;++x){const y=x*n-p;let w=y;for(;w<0;)w+=o;const v=Math.min(e.inDepth,d+y);for(let N=0;N<e.outHeight;++N){const C=N*r-f;let j=C;for(;j<0;)j+=l;const I=Math.min(e.inHeight,u+C);for(let T=0;T<e.outWidth;++T){const E=T*i-m;let $=E;for(;$<0;)$+=c;const D=Math.min(e.inWidth,h+E);let P=Number.NEGATIVE_INFINITY,_=-1;for(let O=w;O<v;O+=o){const R=O-y;for(let X=j;X<I;X+=l){const L=X-C;for(let K=$;K<D;K+=c){const B=K-E,G=t.get(b,O,X,K,g);G>=P&&(P=G,_=R*u*h+L*u+B)}}}s.set(_,b,x,N,T,g)}}}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sJ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e;Ye(r,"avgPool");const{filterSize:i,strides:o,pad:l,dimRoundingMode:c}=n,d=1;A(Qs(o,d),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const u=hr(r.shape,i,o,d,l,c);let h;if(u.filterWidth===1&&u.filterHeight===1&&Ft(u.inShape,u.outShape))h=vi({inputs:{x:r},backend:s});else{const p=s.data.get(r.dataId).values,f=tt(r.shape),m=Rw(p,r.shape,r.dtype,f,u,"avg");h=s.makeTensorInfo(u.outShape,r.dtype,m.values)}return h}const nJ={kernelName:Zp,backendName:"cpu",kernelFunc:sJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rJ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{filterSize:i,strides:o,pad:l,dimRoundingMode:c,dataFormat:d}=n;Ye(r,"avgPool3d");const u=Zi(r.shape,i,o,1,l,c,d),h=s.data.get(r.dataId).values,p=MT(h,r.shape,r.dtype,tt(r.shape),u,"avg");return s.makeTensorInfo(p.shape,"float32",p.values)}const iJ={kernelName:Jp,backendName:"cpu",kernelFunc:rJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oJ(t){const{inputs:e,backend:s,attrs:n}=t,{dy:r,input:i}=e,{filterSize:o,strides:l,pad:c,dimRoundingMode:d}=n;Ye([r,i],"avgPool3DGrad");const u=Zi(i.shape,o,l,1,c,d),h=u.strideDepth,p=u.strideHeight,f=u.strideWidth,m=u.filterDepth,b=u.filterHeight,g=u.filterWidth,x=u.dilationDepth,y=u.dilationHeight,w=u.dilationWidth,v=u.effectiveFilterDepth,N=u.effectiveFilterHeight,C=u.effectiveFilterWidth,j=v-1-u.padInfo.front,I=C-1-u.padInfo.left,T=N-1-u.padInfo.top,E=Nt(i.shape,"float32"),$=1/(m*b*g),D=s.bufferSync(r);for(let P=0;P<u.batchSize;++P)for(let _=0;_<u.inChannels;++_)for(let O=0;O<u.inDepth;++O)for(let R=0;R<u.inHeight;++R)for(let X=0;X<u.inWidth;++X){const L=O-j,K=R-T,B=X-I;let G=0;for(let de=0;de<v;de+=x){const ae=(L+de)/h;if(!(ae<0||ae>=u.outDepth||Math.floor(ae)!==ae))for(let ve=0;ve<N;ve+=y){const Ne=(K+ve)/p;if(!(Ne<0||Ne>=u.outHeight||Math.floor(Ne)!==Ne))for(let le=0;le<C;le+=w){const H=(B+le)/f;if(H<0||H>=u.outWidth||Math.floor(H)!==H)continue;const ue=D.get(P,ae,Ne,H,_);G+=ue}}}E.set(G*$,P,O,R,X,_)}return s.makeTensorInfo(E.shape,E.dtype,E.values)}const aJ={kernelName:S0,backendName:"cpu",kernelFunc:oJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lJ(t){const{inputs:e,backend:s,attrs:n}=t,{dy:r,input:i}=e,o=i;Ye([r,i],"avgPoolGrad");const{filterSize:l,strides:c,pad:d}=n,u=hr(o.shape,l,c,1,d),h=u.strideHeight,p=u.strideWidth,f=u.filterHeight,m=u.filterWidth,b=u.dilationHeight,g=u.dilationWidth,x=u.effectiveFilterHeight,y=u.effectiveFilterWidth,w=y-1-u.padInfo.left,v=x-1-u.padInfo.top,N=Nt(o.shape,"float32"),C=1/(f*m),j=s.data.get(r.dataId).values,I=Nt(r.shape,"float32",j);for(let T=0;T<u.batchSize;++T)for(let E=0;E<u.inChannels;++E)for(let $=0;$<u.inHeight;++$)for(let D=0;D<u.inWidth;++D){const P=$-v,_=D-w;let O=0;for(let R=0;R<x;R+=b){const X=(P+R)/h;if(!(X<0||X>=u.outHeight||Math.floor(X)!==X))for(let L=0;L<y;L+=g){const K=(_+L)/p;if(K<0||K>=u.outWidth||Math.floor(K)!==K)continue;const B=I.get(T,X,K,E);O+=B}}N.set(O*C,T,$,D,E)}return s.makeTensorInfo(N.shape,N.dtype,N.values)}const cJ={kernelName:C0,backendName:"cpu",kernelFunc:lJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dJ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,scale:i,offset:o,mean:l,variance:c}=e;A(l.shape.length===c.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),A(o==null||l.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),A(i==null||l.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Ye([r,l,c,i,o],"batchNorm");let{varianceEpsilon:d}=n;d==null&&(d=.001);const u=s.data.get(r.dataId).values,h=s.data.get(l.dataId).values,p=s.data.get(c.dataId).values,f=i?s.data.get(i.dataId).values:new Float32Array([1]),m=o?s.data.get(o.dataId).values:new Float32Array([0]),b=new Float32Array(u.length),g=m.length,x=f.length,y=p.length,w=h.length;let v=0,N=0,C=0,j=0;for(let I=0;I<u.length;++I)b[I]=m[v++]+(u[I]-h[N++])*f[C++]/Math.sqrt(p[j++]+d),v>=g&&(v=0),N>=w&&(N=0),C>=x&&(C=0),j>=y&&(j=0);return s.makeTensorInfo(r.shape,r.dtype,b)}const uJ={kernelName:hf,backendName:"cpu",kernelFunc:dJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hJ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{blockShape:i,crops:o}=n;Ye([r],"batchToSpaceND");const l=i.reduce((x,y)=>x*y),c=Du(r.shape,i,l),d=_u(c.length,i.length),u=Ru(r.shape,i,l),h=Sy(o,i.length),p=jy(u,o,i.length),f=es({inputs:{x:r},backend:s,attrs:{shape:c}}),m=Sn({inputs:{x:f},backend:s,attrs:{perm:d}}),b=es({inputs:{x:m},backend:s,attrs:{shape:u}}),g=nl({inputs:{x:b},backend:s,attrs:{begin:h,size:p}});return s.disposeIntermediateTensorInfo(f),s.disposeIntermediateTensorInfo(m),s.disposeIntermediateTensorInfo(b),g}const pJ={kernelName:ef,backendName:"cpu",kernelFunc:hJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fJ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,weights:i}=e,{size:o}=n,l=s.data.get(r.dataId).values,c=s.data.get(i.dataId).values,d=$w(l,c,i.dtype,i.shape,o);return s.makeTensorInfo([o],i.dtype,d)}const mJ={kernelName:j0,backendName:"cpu",kernelFunc:fJ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gJ(t){const{inputs:e,backend:s}=t,{s0:n,s1:r}=e,i=s.data.get(n.dataId).values,o=s.data.get(r.dataId).values,l=ft(Array.from(i),Array.from(o));return s.makeTensorInfo([l.length],"int32",Int32Array.from(l))}const xJ={kernelName:Jk,backendName:"cpu",kernelFunc:gJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bJ=Vt(Td,(t,e)=>{const s=e;return t>s.clipValueMax?s.clipValueMax:t<s.clipValueMin?s.clipValueMin:t}),yJ={kernelName:Td,backendName:"cpu",kernelFunc:bJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wJ={kernelName:tf,backendName:"cpu",kernelFunc:t=>{const{x:e}=t.inputs,s=t.backend,n=new Float32Array(pe(e.shape)),r=s.data.get(e.dataId),i=r.complexTensorInfos.real,o=r.complexTensorInfos.imag,l=s.data.get(i.dataId).values,c=s.data.get(o.dataId).values;for(let d=0;d<l.length;d++){const u=l[d],h=c[d];n[d]=Math.hypot(u,h)}return s.makeOutput(n,e.shape,"float32")}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xc(t){const{inputs:e,backend:s}=t,{input:n}=e,r=s.data.get(n.dataId).complexTensorInfos.imag,i=s.data.get(r.dataId).values;return s.makeTensorInfo(r.shape,r.dtype,i)}const vJ={kernelName:H0,backendName:"cpu",kernelFunc:xc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bc(t){const{inputs:e,backend:s,attrs:n}=t,{axis:r}=n,i=vt(r,e[0].shape)[0],o=e.map(b=>b.shape);Ny(o,i);let l=pi(e.map(b=>b.shape),i);if(pe(l)===0)return s.makeTensorInfo(l,e[0].dtype,[]);const c=e.filter(b=>pe(b.shape)>0);if(c.length===1)return vi({inputs:{x:c[0]},backend:s});if(c[0].dtype==="complex64"){const b=c.map(v=>tl({inputs:{input:v},backend:s})),g=c.map(v=>xc({inputs:{input:v},backend:s})),x=bc({inputs:b,backend:s,attrs:{axis:i}}),y=bc({inputs:g,backend:s,attrs:{axis:i}}),w=On({inputs:{real:x,imag:y},backend:s});return b.forEach(v=>s.disposeIntermediateTensorInfo(v)),g.forEach(v=>s.disposeIntermediateTensorInfo(v)),s.disposeIntermediateTensorInfo(x),s.disposeIntermediateTensorInfo(y),w}const d=c.map(b=>{const x=[-1,pe(b.shape.slice(i))];return es({inputs:{x:b},backend:s,attrs:{shape:x}})}),u=d.map(b=>({vals:s.data.get(b.dataId).values,shape:b.shape}));l=pi(d.map(b=>b.shape),1);const h=d[0].shape[0]===1,p=L$(u,l,e[0].dtype,h),f=pi(c.map(b=>b.shape),i),m=s.makeTensorInfo(f,e[0].dtype,p);return d.forEach(b=>s.disposeIntermediateTensorInfo(b)),m}const NJ={kernelName:sf,backendName:"cpu",kernelFunc:bc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LT(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,filter:i}=e,{strides:o,pad:l,dataFormat:c,dilations:d,dimRoundingMode:u}=n;Ye([r,i],"conv2d");const h=Ji(c),p=Vs(r.shape,i.shape,o,d,l,u,!1,h),f=p.filterHeight,m=p.filterWidth,b=p.dilationHeight,g=p.dilationWidth,x=p.padInfo.left,y=p.padInfo.top,w=p.dataFormat==="channelsLast",v=new Us(p.outShape,r.dtype),N=tt(r.shape),C=tt(i.shape),j=N[0],I=w?N[1]:N[2],T=w?N[2]:1,E=w?1:N[1],$=v.strides[0],D=w?v.strides[1]:v.strides[2],P=w?v.strides[2]:1,_=w?1:v.strides[1],O=s.data.get(r.dataId).values,R=s.data.get(i.dataId).values,X=v.values;for(let L=0;L<p.batchSize;++L){const K=L*j,B=L*$;for(let G=0;G<p.outHeight;++G){const de=B+G*D,ae=G*p.strideHeight-y;for(let ve=0;ve<f;++ve){const Ne=ae+ve*b;if(Ne<0||Ne>=p.inHeight)continue;const le=ve*C[0],H=K+Ne*I;for(let ue=0;ue<p.outWidth;++ue){const F=de+ue*P,ee=ue*p.strideWidth-x;for(let re=0;re<m;++re){const te=ee+re*g;if(te<0||te>=p.inWidth)continue;const ce=le+re*C[1],Se=H+te*T;let Pe=ce;for(let $e=0;$e<p.inChannels;++$e){const rt=O[Se+$e*E];for(let q=0;q<p.outChannels;++q)X[F+q*_]+=rt*R[Pe+q];Pe+=p.outChannels}}}}}}return s.makeTensorInfo(v.shape,v.dtype,X)}const kJ={kernelName:nf,backendName:"cpu",kernelFunc:LT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CJ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,dy:i}=e,{strides:o,pad:l,dataFormat:c,dimRoundingMode:d,filterShape:u}=n;Ye([r,i],"conv2dBackpropFilter");const h=Ji(c),p=Vs(r.shape,u,o,1,l,d,!1,h),{strideHeight:f,strideWidth:m,filterHeight:b,filterWidth:g}=p,x=p.dataFormat==="channelsLast",y=new Us(p.filterShape,"float32"),w=p.padInfo.left,v=p.padInfo.top,N=s.data.get(r.dataId).values,C=s.data.get(i.dataId).values,j=new Us(r.shape,r.dtype,N),I=new Us(i.shape,i.dtype,C);for(let T=0;T<b;++T){const E=Math.max(0,Math.ceil((v-T)/f)),$=Math.min(p.outHeight,(p.inHeight+v-T)/f);for(let D=0;D<g;++D){const P=Math.max(0,Math.ceil((w-D)/m)),_=Math.min(p.outWidth,(p.inWidth+w-D)/m);for(let O=0;O<p.inChannels;++O)for(let R=0;R<p.outChannels;++R){let X=0;for(let L=0;L<p.batchSize;++L)for(let K=E;K<$;++K){const B=T+K*f-v;for(let G=P;G<_;++G){const de=D+G*m-w;x?X+=j.get(L,B,de,O)*I.get(L,K,G,R):X+=j.get(L,O,B,de)*I.get(L,R,K,G)}}y.set(X,T,D,O,R)}}}return s.makeTensorInfo(y.shape,y.dtype,y.values)}const SJ={kernelName:$0,backendName:"cpu",kernelFunc:CJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jJ(t){const{inputs:e,backend:s,attrs:n}=t,{dy:r,filter:i}=e,{inputShape:o,strides:l,pad:c,dataFormat:d,dimRoundingMode:u}=n;Ye([r,i],"conv2dBackpropInput");const h=tt(i.shape),p=tt(r.shape);let f=Ji(d);const m=Vs(o,i.shape,l,1,c,u,!1,f),b=new Us(m.inShape,"float32"),g=b.values,x=s.data.get(r.dataId).values,y=s.data.get(i.dataId).values,[w,v,N]=h,{batchSize:C,filterHeight:j,filterWidth:I,inChannels:T,inHeight:E,inWidth:$,outChannels:D,outHeight:P,outWidth:_,strideHeight:O,strideWidth:R}=m;f=m.dataFormat;const X=j-1-m.padInfo.top,L=I-1-m.padInfo.left,K=f==="channelsLast",B=b.strides[0],G=K?b.strides[1]:b.strides[2],de=K?b.strides[2]:1,ae=K?1:b.strides[1],ve=p[0],Ne=K?p[1]:p[2],le=K?p[2]:1,H=K?1:p[1];for(let ue=0;ue<C;++ue)for(let F=0;F<T;++F)for(let ee=0;ee<E;++ee){const re=ee-X,te=Math.max(0,Math.ceil(re/O)),ce=Math.min(P,(j+re)/O);for(let Se=0;Se<$;++Se){const Pe=Se-L,$e=Math.max(0,Math.ceil(Pe/R)),rt=Math.min(_,(I+Pe)/R);let q=0;for(let Fe=te;Fe<ce;++Fe){const et=Fe*O-re;for(let Me=$e;Me<rt;++Me){const Xe=Me*R-Pe,it=ve*ue+Ne*Fe+le*Me,Et=w*(j-1-et)+v*(I-1-Xe)+N*F;for(let yt=0;yt<D;++yt){const xe=x[it+H*yt],Ve=y[Et+yt];q+=xe*Ve}}}const fe=B*ue+G*ee+de*Se+ae*F;g[fe]=q}}return s.makeTensorInfo(b.shape,b.dtype,b.values)}const IJ={kernelName:rf,backendName:"cpu",kernelFunc:jJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EJ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,filter:i}=e,{strides:o,pad:l,dilations:c}=n;Ye([r,i],"conv3d");const d=Ao(r.shape,i.shape,o,c,l),{filterDepth:u,filterHeight:h,filterWidth:p,dilationDepth:f,dilationHeight:m,dilationWidth:b,padInfo:g}=d,x=g.front,y=g.left,w=g.top,v=new Us(d.outShape,r.dtype),N=s.data.get(r.dataId).values,C=s.data.get(i.dataId).values,j=v.values,I=tt(r.shape),T=tt(i.shape);for(let E=0;E<d.batchSize;++E){const $=E*I[0],D=E*v.strides[0];for(let P=0;P<d.outDepth;++P){const _=D+P*v.strides[1],O=P*d.strideDepth-x;for(let R=0;R<u;++R){const X=O+R*f;if(X<0||X>=d.inDepth)continue;const L=R*T[0],K=$+X*I[1];for(let B=0;B<d.outHeight;++B){const G=_+B*v.strides[2],de=B*d.strideHeight-w;for(let ae=0;ae<h;++ae){const ve=de+ae*m;if(ve<0||ve>=d.inHeight)continue;const Ne=L+ae*T[1],le=K+ve*I[2];for(let H=0;H<d.outWidth;++H){const ue=G+H*d.outChannels,F=H*d.strideWidth-y;for(let ee=0;ee<p;++ee){const re=F+ee*b;if(re<0||re>=d.inWidth)continue;const te=Ne+ee*T[2],ce=le+re*d.inChannels;let Se=te;for(let Pe=0;Pe<d.inChannels;++Pe){const $e=N[ce+Pe];for(let rt=0;rt<d.outChannels;++rt)j[ue+rt]+=$e*C[Se+rt];Se+=d.outChannels}}}}}}}}return s.makeTensorInfo(v.shape,v.dtype,v.values)}const $J={kernelName:of,backendName:"cpu",kernelFunc:EJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TJ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,dy:i}=e,{strides:o,pad:l,filterShape:c}=n;Ye([r,i],"conv3dBackpropFilterV2");const d=tt(r.shape),u=tt(i.shape),h=Ao(r.shape,c,o,1,l),p=h.strideDepth,f=h.strideHeight,m=h.strideWidth,b=h.filterDepth,g=h.filterHeight,x=h.filterWidth,y=new Us(h.filterShape,"float32"),w=y.values,[v,N,C,j]=y.strides,I=s.data.get(i.dataId).values,[T,E,$,D]=u,P=s.data.get(r.dataId).values,[_,O,R,X]=d,L=h.padInfo.front,K=h.padInfo.left,B=h.padInfo.top;for(let G=0;G<b;++G){const de=Math.max(0,Math.ceil((L-G)/p)),ae=Math.min(h.outDepth,(h.inDepth+L-G)/p),ve=G*v;for(let Ne=0;Ne<g;++Ne){const le=Math.max(0,Math.ceil((B-Ne)/f)),H=Math.min(h.outHeight,(h.inHeight+B-Ne)/f),ue=Ne*N+ve;for(let F=0;F<x;++F){const ee=Math.max(0,Math.ceil((K-F)/m)),re=Math.min(h.outWidth,(h.inWidth+K-F)/m),te=F*C+ue;for(let ce=0;ce<h.inChannels;++ce){const Se=ce*j+te;for(let Pe=0;Pe<h.outChannels;++Pe){let $e=0;for(let rt=0;rt<h.batchSize;++rt){const q=rt*_,fe=rt*T;for(let Fe=de;Fe<ae;++Fe){const Me=(G+Fe*p-L)*O+q,Xe=Fe*E+fe;for(let it=le;it<H;++it){const yt=(Ne+it*f-B)*R+Me,xe=it*$+Xe;for(let Ve=ee;Ve<re;++Ve){const We=(F+Ve*m-K)*X+yt,at=Ve*D+xe;$e+=P[We+ce]*I[at+Pe]}}}}w[Se+Pe]=$e}}}}}return s.makeTensorInfo(y.shape,y.dtype,y.values)}const AJ={kernelName:T0,backendName:"cpu",kernelFunc:TJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DJ(t){const{inputs:e,backend:s,attrs:n}=t,{dy:r,filter:i}=e,{pad:o,strides:l,inputShape:c}=n;Ye([r],"conv3dBackpropInputV2");const d=tt(r.shape),u=tt(i.shape),h=Ao(c,i.shape,l,1,o),p=new Us(h.inShape,"float32"),f=p.values,[m,b,g,x]=p.strides,y=s.data.get(r.dataId).values,[w,v,N,C]=d,j=s.data.get(i.dataId).values,[I,T,E,$]=u,{batchSize:D,filterDepth:P,filterHeight:_,filterWidth:O,inChannels:R,inDepth:X,inHeight:L,inWidth:K,outChannels:B,outDepth:G,outHeight:de,outWidth:ae,strideDepth:ve,strideHeight:Ne,strideWidth:le}=h,H=P-1-h.padInfo.front,ue=_-1-h.padInfo.top,F=O-1-h.padInfo.left;for(let ee=0;ee<D;++ee)for(let re=0;re<R;++re)for(let te=0;te<X;++te){const ce=te-H,Se=Math.max(0,Math.ceil(ce/ve)),Pe=Math.min(G,(P+ce)/ve);for(let $e=0;$e<L;++$e){const rt=$e-ue,q=Math.max(0,Math.ceil(rt/Ne)),fe=Math.min(de,(_+rt)/Ne);for(let Fe=0;Fe<K;++Fe){const et=Fe-F,Me=Math.max(0,Math.ceil(et/le)),Xe=Math.min(ae,(O+et)/le);let it=0;for(let Et=Se;Et<Pe;++Et){const yt=Et*ve-ce;for(let xe=q;xe<fe;++xe){const Ve=xe*Ne-rt;for(let qe=Me;qe<Xe;++qe){const We=qe*le-et,at=w*ee+v*Et+N*xe+C*qe,Ct=I*(P-1-yt)+T*(_-1-Ve)+E*(O-1-We)+$*re;for(let ut=0;ut<B;++ut){const mt=y[at+ut],Xt=j[Ct+ut];it+=mt*Xt}}}}f[m*ee+b*te+g*$e+x*Fe+re]=it}}}return s.makeTensorInfo(p.shape,p.dtype,p.values)}const _J={kernelName:A0,backendName:"cpu",kernelFunc:DJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RJ=Vt(Ad,t=>Math.cos(t)),PJ={kernelName:Ad,backendName:"cpu",kernelFunc:RJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FJ=Vt(Dd,t=>Math.cosh(t)),OJ={kernelName:Dd,backendName:"cpu",kernelFunc:FJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MJ(t){const{inputs:e,backend:s,attrs:n}=t,{image:r,boxes:i,boxInd:o}=e,{cropSize:l,method:c,extrapolationValue:d}=n,[u,h,p,f]=r.shape,m=i.shape[0],[b,g]=l,x=Nt([m,b,g,f],"float32"),y=s.data.get(i.dataId).values,w=s.data.get(o.dataId).values,v=s.data.get(r.dataId).values,N=tt(r.shape),C=tt(x.shape);for(let j=0;j<m;j++){const I=j*4,T=y[I],E=y[I+1],$=y[I+2],D=y[I+3],P=w[j];if(P>=u)continue;const _=b>1?($-T)*(h-1)/(b-1):0,O=g>1?(D-E)*(p-1)/(g-1):0;for(let R=0;R<b;R++){const X=b>1?T*(h-1)+R*_:.5*(T+$)*(h-1);if(X<0||X>h-1){for(let L=0;L<g;L++)for(let K=0;K<f;K++){const B=K+L*C[2]+R*C[1]+j*C[0];x.values[B]=d}continue}if(c==="bilinear"){const L=Math.floor(X),K=Math.ceil(X),B=X-L;for(let G=0;G<g;G++){const de=g>1?E*(p-1)+G*O:.5*(E+D)*(p-1);if(de<0||de>p-1){for(let le=0;le<f;le++){const H=le+G*C[2]+R*C[1]+j*C[0];x.values[H]=d}continue}const ae=Math.floor(de),ve=Math.ceil(de),Ne=de-ae;for(let le=0;le<f;le++){let H=le+ae*N[2]+L*N[1]+P*N[0];const ue=v[H];H=le+ve*N[2]+L*N[1]+P*N[0];const F=v[H];H=le+ae*N[2]+K*N[1]+P*N[0];const ee=v[H];H=le+ve*N[2]+K*N[1]+P*N[0];const re=v[H],te=ue+(F-ue)*Ne,ce=ee+(re-ee)*Ne;H=le+G*C[2]+R*C[1]+j*C[0],x.values[H]=te+(ce-te)*B}}}else for(let L=0;L<g;++L){const K=g>1?E*(p-1)+L*O:.5*(E+D)*(p-1);if(K<0||K>p-1){for(let de=0;de<f;de++){const ae=de+L*C[2]+R*C[1]+j*C[0];x.values[ae]=d}continue}const B=Math.round(K),G=Math.round(X);for(let de=0;de<f;de++){const ae=de+B*N[2]+G*N[1]+P*N[0],ve=de+L*C[2]+R*C[1]+j*C[0];x.values[ve]=v[ae]}}}}return s.makeTensorInfo(x.shape,x.dtype,x.values)}const LJ={kernelName:_0,backendName:"cpu",kernelFunc:MJ};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zJ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i,exclusive:o,reverse:l}=n;Ye(r,"cumprod");const c=cs([i],r.shape.length);let d=r;c!=null&&(d=Sn({inputs:{x:r},backend:s,attrs:{perm:c}}));const u=ms(1,r.shape.length)[0];if(u!==d.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${d.shape.length-1} but got axis=${u}`);const h=Rn(d.dtype,"int32"),p=x0(pe(d.shape),h),f=s.data.get(d.dataId).values,m=d.shape[d.shape.length-1],b=l?(x,y)=>x+m-y-1:(x,y)=>x+y;for(let x=0;x<f.length;x+=m)for(let y=0;y<m;y++){const w=b(x,y);if(y===0)p[w]=o?1:f[w];else{const v=b(x,y-1);p[w]=o?f[v]*p[v]:f[w]*p[v]}}const g=s.makeTensorInfo(d.shape,h,p);if(c!=null){const x=Do(c),y=Sn({inputs:{x:g},backend:s,attrs:{perm:x}});return s.disposeIntermediateTensorInfo(g),s.disposeIntermediateTensorInfo(d),y}return g}const BJ={kernelName:D0,backendName:"cpu",kernelFunc:zJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UJ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i,exclusive:o,reverse:l}=n;Ye(r,"cumsum");const c=cs([i],r.shape.length);let d=r;c!=null&&(d=Sn({inputs:{x:r},backend:s,attrs:{perm:c}}));const u=ms(1,r.shape.length)[0];if(u!==d.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${d.shape.length-1} but got axis=${u}`);const h=Rn(d.dtype,"int32"),p=Js(pe(d.shape),h),f=s.data.get(d.dataId).values,m=d.shape[d.shape.length-1],b=l?(x,y)=>x+m-y-1:(x,y)=>x+y;for(let x=0;x<f.length;x+=m)for(let y=0;y<m;y++){const w=b(x,y);if(y===0)p[w]=o?0:f[w];else{const v=b(x,y-1);p[w]=o?f[v]+p[v]:f[w]+p[v]}}const g=s.makeTensorInfo(d.shape,h,p);if(c!=null){const x=Do(c),y=Sn({inputs:{x:g},backend:s,attrs:{perm:x}});return s.disposeIntermediateTensorInfo(g),s.disposeIntermediateTensorInfo(d),y}return g}const VJ={kernelName:af,backendName:"cpu",kernelFunc:UJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WJ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,weights:i}=e,{size:o,binaryOutput:l}=n;if(r.shape.length===1){const c=s.data.get(r.dataId).values,d=s.data.get(i.dataId).values,u=$w(c,d,i.dtype,i.shape,o);return s.makeTensorInfo([o],i.dtype,u)}else if(r.shape.length===2){const c=s.bufferSync(r),d=s.bufferSync(i),u=F$(c,d,o,l);return s.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const GJ={kernelName:R0,backendName:"cpu",kernelFunc:WJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HJ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{blockSize:i,dataFormat:o}=n;A(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const l=r.shape[0],c=r.shape[1],d=r.shape[2],u=r.shape[3],h=c*i,p=d*i,f=u/(i*i),m=s.data.get(r.dataId).values,b=new Float32Array(l*h*p*f);let g=0;for(let x=0;x<l;++x)for(let y=0;y<h;++y){const w=Math.floor(y/i),v=y%i;for(let N=0;N<p;++N){const C=Math.floor(N/i),j=N%i,I=(v*i+j)*f;for(let T=0;T<f;++T){const $=T+I+u*(C+d*(w+c*x));b[g++]=m[$]}}}return s.makeTensorInfo([l,h,p,f],r.dtype,b)}const qJ={kernelName:P0,backendName:"cpu",kernelFunc:HJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zT(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,filter:i}=e,{strides:o,pad:l,dilations:c,dimRoundingMode:d}=n;Ye([r,i],"depthwiseConv2DNative");const u=tt(r.shape),h=tt(i.shape);let p=c;p==null&&(p=[1,1]),A(Qs(o,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${p}'`);const f=Vs(r.shape,i.shape,o,p,l,d,!0),{filterHeight:m,filterWidth:b,dilationHeight:g,dilationWidth:x,padInfo:y}=f,w=y.left,v=y.top,N=f.outChannels/f.inChannels,C=new Us(f.outShape,r.dtype),j=s.data.get(r.dataId).values,I=s.data.get(i.dataId).values,T=C.values;for(let E=0;E<f.batchSize;++E){const $=E*u[0],D=E*C.strides[0];for(let P=0;P<f.outHeight;++P){const _=D+P*C.strides[1],O=P*f.strideHeight-v;for(let R=0;R<m;++R){const X=O+R*g;if(X<0||X>=f.inHeight)continue;const L=R*h[0],K=$+X*u[1];for(let B=0;B<f.outWidth;++B){const G=_+B*C.strides[2],de=B*f.strideWidth-w;for(let ae=0;ae<b;++ae){const ve=de+ae*x;if(ve<0||ve>=f.inWidth)continue;const Ne=L+ae*h[1],le=K+ve*f.inChannels;let H=G,ue=Ne;for(let F=0;F<f.inChannels;++F){const ee=j[le+F];for(let re=0;re<N;++re)T[H+re]+=ee*I[ue+re];H+=N,ue+=N}}}}}}return s.makeTensorInfo(C.shape,C.dtype,C.values)}const KJ={kernelName:lf,backendName:"cpu",kernelFunc:zT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XJ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,dy:i}=e,{strides:o,dilations:l,pad:c,dimRoundingMode:d,filterShape:u}=n;Ye([r,i],"depthwiseConv2dNativeBackpropFilter");const h=Vs(r.shape,u,o,l,c,d,!0),{strideHeight:p,strideWidth:f,filterHeight:m,filterWidth:b}=h,g=new Us(h.filterShape,"float32"),x=h.padInfo.left,y=h.padInfo.top,w=h.outChannels/h.inChannels,v=s.data.get(r.dataId).values,N=new Us(r.shape,r.dtype,v),C=s.data.get(i.dataId).values,j=new Us(i.shape,i.dtype,C);for(let I=0;I<m;++I){const T=Math.max(0,Math.ceil((y-I)/p)),E=Math.min(h.outHeight,(h.inHeight+y-I)/p);for(let $=0;$<b;++$){const D=Math.max(0,Math.ceil((x-$)/f)),P=Math.min(h.outWidth,(h.inWidth+x-$)/f);for(let _=0;_<h.outChannels;++_){const O=Math.trunc(_/w),R=_%w;let X=0;for(let L=0;L<h.batchSize;++L)for(let K=T;K<E;++K){const B=I+K*p-y;for(let G=D;G<P;++G){const de=$+G*f-x;X+=N.get(L,B,de,O)*j.get(L,K,G,_)}}g.set(X,I,$,O,R)}}}return s.makeTensorInfo(g.shape,g.dtype,g.values)}const YJ={kernelName:F0,backendName:"cpu",kernelFunc:XJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZJ(t){const{inputs:e,backend:s,attrs:n}=t,{dy:r,filter:i}=e,{strides:o,dilations:l,pad:c,dimRoundingMode:d,inputShape:u}=n;Ye([r,i],"depthwiseConv2DNativeBackpropInput");const h=tt(r.shape),p=tt(i.shape),f=Vs(u,i.shape,o,l,c,d,!0),m=new Us(f.inShape,"float32"),b=m.values,[g,x,y]=m.strides,w=s.data.get(r.dataId).values,[v,N,C]=h,j=s.data.get(i.dataId).values,[I,T,E]=p,{batchSize:$,filterHeight:D,filterWidth:P,inChannels:_,inHeight:O,inWidth:R,outChannels:X,outHeight:L,outWidth:K,strideHeight:B,strideWidth:G}=f,de=D-1-f.padInfo.top,ae=P-1-f.padInfo.left,ve=X/_;for(let Ne=0;Ne<$;++Ne)for(let le=0;le<_;++le)for(let H=0;H<O;++H){const ue=H-de,F=Math.max(0,Math.ceil(ue/B)),ee=Math.min(L,(D+ue)/B);for(let re=0;re<R;++re){const te=re-ae,ce=Math.max(0,Math.ceil(te/G)),Se=Math.min(K,(P+te)/G);let Pe=0;for(let $e=F;$e<ee;++$e){const rt=$e*B-ue;for(let q=ce;q<Se;++q){const fe=q*G-te,Fe=v*Ne+N*$e+C*q,et=I*(D-1-rt)+T*(P-1-fe)+E*le;for(let Me=0;Me<ve;++Me){const Xe=le*ve+Me,it=w[Fe+Xe],Et=j[et+Me];Pe+=it*Et}}}b[g*Ne+x*H+y*re+le]=Pe}}return s.makeTensorInfo(m.shape,m.dtype,m.values)}const JJ={kernelName:O0,backendName:"cpu",kernelFunc:ZJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QJ(t){const{inputs:e,backend:s}=t,{x:n}=e,r=pe(n.shape),i=s.data.get(n.dataId).values,o=Nt([r,r],n.dtype),l=o.values;for(let d=0;d<i.length;d++)l[d*r+d]=i[d];const c=[...n.shape,...n.shape];return s.makeTensorInfo(c,o.dtype,o.values)}const eQ={kernelName:Qk,backendName:"cpu",kernelFunc:QJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tQ={kernelName:cf,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:s})=>{const{x:n,filter:r}=t,{strides:i,pad:o,dilations:l}=s,c=e,d=c.data.get(n.dataId).values,u=n.shape.length,h=c.data.get(r.dataId).values,p=r.shape.length,{batchSize:f,inHeight:m,inWidth:b,inChannels:g,outHeight:x,outWidth:y,padInfo:w,strideHeight:v,strideWidth:N,filterHeight:C,filterWidth:j,dilationHeight:I,dilationWidth:T,outShape:E}=vu(n.shape,r.shape,i,o,"NHWC",l),$=pe(E),D=E.length,P=ps(n.dtype,$);for(let O=0;O<f;++O)for(let R=0;R<x;++R){const X=R*v-w.top;for(let L=0;L<y;++L){const K=L*N-w.left;for(let B=0;B<g;++B){let G=Number.MIN_SAFE_INTEGER;for(let ae=0;ae<C;++ae){const ve=X+ae*I;if(ve>=0&&ve<m)for(let Ne=0;Ne<j;++Ne){const le=K+Ne*T;if(le>=0&&le<b){const H=oi([O,ve,le,B],u,tt(n.shape)),ue=oi([ae,Ne,B],p,tt(r.shape)),F=d[H]+h[ue];F>G&&(G=F)}}}const de=oi([O,R,L,B],D,tt(E));P[de]=G}}}return{dataId:c.write(Aa(P,n.dtype),E,n.dtype),shape:E,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sQ={kernelName:L0,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:s})=>{const{x:n,filter:r,dy:i}=t,{strides:o,pad:l,dilations:c}=s,d=e,u=Pr(n.shape,d.data.get(n.dataId).values),h=Pr(r.shape,d.data.get(r.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:b,outHeight:g,outWidth:x,padInfo:y,strideHeight:w,strideWidth:v,filterHeight:N,filterWidth:C,dilationHeight:j,dilationWidth:I,outShape:T}=vu(n.shape,r.shape,o,l,"NHWC",c);A(i.rank===T.length,()=>`Error in ${L0}, dy must have the same rank as output ${T.length}, but got ${i.rank}`);const E=Pr(T,d.data.get(i.dataId).values),$=Kk(r.shape,r.dtype);for(let P=0;P<p;++P)for(let _=0;_<g;++_){const O=_*w-y.top;for(let R=0;R<x;++R){const X=R*v-y.left;for(let L=0;L<b;++L){let K=Number.MIN_SAFE_INTEGER,B=0,G=0;for(let de=0;de<N;++de){const ae=O+de*j;if(ae>=0&&ae<f)for(let ve=0;ve<C;++ve){const Ne=X+ve*I;if(Ne>=0&&Ne<m){const le=u[P][ae][Ne][L]+h[de][ve][L];le>K&&(K=le,B=de,G=ve)}}}$[B][G][L]+=E[P][_][R][L]}}}return{dataId:d.write(Aa($,n.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nQ={kernelName:M0,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:s})=>{const{x:n,filter:r,dy:i}=t,{strides:o,pad:l,dilations:c}=s,d=e,u=Pr(n.shape,d.data.get(n.dataId).values),h=Pr(r.shape,d.data.get(r.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:b,outHeight:g,outWidth:x,padInfo:y,strideHeight:w,strideWidth:v,filterHeight:N,filterWidth:C,dilationHeight:j,dilationWidth:I,outShape:T}=vu(n.shape,r.shape,o,l,"NHWC",c);A(i.rank===T.length,()=>`Error in ${M0}, dy must have the same rank as output ${T.length}, but got ${i.rank}`);const E=Pr(T,d.data.get(i.dataId).values),$=Kk(n.shape,n.dtype);for(let P=0;P<p;++P)for(let _=0;_<g;++_){const O=_*w-y.top;for(let R=0;R<x;++R){const X=R*v-y.left;for(let L=0;L<b;++L){let K=Number.MIN_SAFE_INTEGER,B=O<0?0:O,G=X<0?0:X;for(let de=0;de<N;++de){const ae=O+de*j;if(ae>=0&&ae<f)for(let ve=0;ve<C;++ve){const Ne=X+ve*I;if(Ne>=0&&Ne<m){const le=u[P][ae][Ne][L]+h[de][ve][L];le>K&&(K=le,B=ae,G=Ne)}}}$[P][B][G][L]+=E[P][_][R][L]}}}return{dataId:d.write(Aa($,n.dtype),n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rQ(t){const{inputs:e,backend:s,attrs:n}=t,{image:r}=e,{canvas:i,options:o}=n,{contextOptions:l,imageOptions:c}=o||{},d=c?.alpha||1,u=l?.contextType||"2d";if(u!=="2d")throw new Error(`Context type ${l.contextType} is not supported by the CPU backend.`);const h=i.getContext(u,l?.contextAttributes||{});if(h==null)throw new Error(`Could not get the context with ${u} type.`);const[p,f]=r.shape.slice(0,2),m=r.shape.length===2?1:r.shape[2],b=s.data.get(r.dataId).values,g=r.dtype==="float32"?255:1,x=new Uint8ClampedArray(f*p*4);for(let w=0;w<p*f;++w){const v=[0,0,0,255*d];for(let C=0;C<m;C++){const j=b[w*m+C];if(r.dtype==="float32"){if(j<0||j>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${j}.`)}else if(r.dtype==="int32"&&(j<0||j>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${j}.`);m===1?(v[0]=j*g,v[1]=j*g,v[2]=j*g):v[C]=j*g}const N=w*4;x[N+0]=Math.round(v[0]),x[N+1]=Math.round(v[1]),x[N+2]=Math.round(v[2]),x[N+3]=Math.round(v[3])}i.width=f,i.height=p;const y=new ImageData(x,f,p);return h.putImageData(y,0,0),r}const iQ={kernelName:jU,backendName:"cpu",kernelFunc:rQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zu(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i,keepDims:o}=n;Ye(r,"sum");let l;r.dtype==="bool"?l=Wo({inputs:{x:r},backend:s,attrs:{dtype:"int32"}}):l=vi({inputs:{x:r},backend:s});const c=l.shape.length,d=vt(i,l.shape),u=cs(d,c);let h=d,p=l;u!=null&&(p=Sn({inputs:{x:l},backend:s,attrs:{perm:u}}),h=ms(h.length,c)),Ws("sum",h,p.shape.length);const[f,m]=Fs(p.shape,h),b=Rn(p.dtype,"int32");let g=Hm(s,f,b);const x=pe(m),y=s.data.get(g.dataId).values,w=s.data.get(p.dataId).values;for(let v=0;v<y.length;++v){const N=v*x;let C=0;for(let j=0;j<x;++j)C+=w[N+j];y[v]=C}if(o){const v=ks(g.shape,d),N=g;g=es({inputs:{x:g},backend:s,attrs:{shape:v}}),s.disposeIntermediateTensorInfo(N)}return s.disposeIntermediateTensorInfo(l),u!=null&&s.disposeIntermediateTensorInfo(p),g}const oQ={kernelName:Uf,backendName:"cpu",kernelFunc:Zu};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aQ(t){const{inputs:e,backend:s,attrs:n}=t,{equation:r}=n,i=e,{allDims:o,summedDims:l,idDims:c}=Py(r,i.length);Oy(o.length,c,i);const{path:d,steps:u}=My(l,c),h=u.length;let p=null,f=o.length;const m=[];for(let b=0;b<h;++b){for(const g of u[b]){const{permutationIndices:x,expandDims:y}=Fy(f,c[g]);let w;Ly(x)?w=i[g]:(w=Sn({inputs:{x:i[g]},backend:s,attrs:{perm:x}}),m.push(w));const v=w.shape.slice();for(let N=0;N<y.length;++N)v.splice(y[N],0,1);Ft(w.shape,v)||(w=es({inputs:{x:w},backend:s,attrs:{shape:v}}),m.push(w)),p===null?p=w:(p=qm({inputs:{a:w,b:p},backend:s}),m.push(p))}b<h-1&&(d[b]>=0&&(p=Zu({inputs:{x:p},backend:s,attrs:{axis:d[b]-(o.length-f),keepDims:!1}}),m.push(p)),f--)}for(const b of m)b!==p&&s.disposeIntermediateTensorInfo(b);return p}const lQ={kernelName:z0,backendName:"cpu",kernelFunc:aQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cQ(t){const{inputs:e,backend:s}=t,{dy:n,y:r}=e;Ye([n,r],"eluGrad");const i=new Float32Array(pe(r.shape)),o=s.data.get(r.dataId).values,l=s.data.get(n.dataId).values;for(let c=0;c<o.length;++c){const d=o[c];d>=0?i[c]=l[c]:i[c]=l[c]*(d+1)}return s.makeTensorInfo(r.shape,"float32",i)}const dQ={kernelName:B0,backendName:"cpu",kernelFunc:cQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uQ=Iy,hQ=Ey,pQ=$y,fQ=Ty,mQ=Ay,gQ=Dy,xQ=Vt(Pd,t=>{const e=Math.sign(t),s=Math.abs(t),n=1/(1+uQ*s);return e*(1-((((gQ*n+mQ)*n+fQ)*n+pQ)*n+hQ)*n*Math.exp(-s*s))}),bQ={kernelName:Pd,backendName:"cpu",kernelFunc:xQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ym(t){const{inputs:e,backend:s,attrs:n}=t,{input:r}=e,{dim:i}=n,o=r.shape.length,l=r.shape.slice();let c=i;return i<0&&(A(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),c=o+i+1),l.splice(c,0,1),es({inputs:{x:r},backend:s,attrs:{shape:l}})}const yQ={kernelName:uf,backendName:"cpu",kernelFunc:Ym};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wQ=bs((t,e)=>t/e),Pw=_s(_d,wQ),Fw={kernelName:_d,backendName:"cpu",kernelFunc:Pw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BT(t,e,s){const n=t.shape,r=n[0],i=n[1],o=s.data.get(t.dataId),l=o.complexTensorInfos.real,c=o.complexTensorInfos.imag,d=[r,i],u=pe(d),h=Zs("float32",u),p=Zs("float32",u);for(let g=0;g<r;g++){const x=nl({inputs:{x:l},backend:s,attrs:{begin:[g,0],size:[1,i]}}),y=nl({inputs:{x:c},backend:s,attrs:{begin:[g,0],size:[1,i]}}),w=On({inputs:{real:x,imag:y},backend:s}),{real:v,imag:N}=vQ(w,e,s),C=so(v,N);for(let j=0;j<i;j++){const I=_y(C,j);h[g*i+j]=I.real,p[g*i+j]=I.imag}s.disposeIntermediateTensorInfo(x),s.disposeIntermediateTensorInfo(y),s.disposeIntermediateTensorInfo(w)}const f=s.makeTensorInfo(d,"float32",h),m=s.makeTensorInfo(d,"float32",p),b=On({inputs:{real:f,imag:m},backend:s});return s.disposeIntermediateTensorInfo(f),s.disposeIntermediateTensorInfo(m),b}function vQ(t,e,s){const n=pe(t.shape),r=s.data.get(t.dataId),i=s.data.get(r.complexTensorInfos.real.dataId).values,o=s.data.get(r.complexTensorInfos.imag.dataId).values;if(NQ(n)){const l=Ow(i,o,n,e,s),c=[t.shape[0],t.shape[1]];if(e){const d=s.makeTensorInfo(c,"float32",l.real),u=s.makeTensorInfo(c,"float32",l.imag),h=s.makeTensorInfo([],"float32",jo(n,"float32")),p=vi({inputs:{x:h},backend:s}),f=Fw.kernelFunc({inputs:{a:d,b:h},backend:s}),m=Fw.kernelFunc({inputs:{a:u,b:p},backend:s}),b=s.data.get(f.dataId).values,g=s.data.get(m.dataId).values;return s.disposeIntermediateTensorInfo(d),s.disposeIntermediateTensorInfo(u),s.disposeIntermediateTensorInfo(h),s.disposeIntermediateTensorInfo(p),s.disposeIntermediateTensorInfo(f),s.disposeIntermediateTensorInfo(m),{real:b,imag:g}}return l}else{const l=so(i,o),c=kQ(l,n,e);return bj(c)}}function NQ(t){return(t&t-1)===0}function Ow(t,e,s,n,r){if(s===1)return{real:t,imag:e};const i=so(t,e),o=s/2,l=yj(i),c=l.real,d=l.imag,u=[c.length],h=r.makeTensorInfo(u,"float32",c),p=r.makeTensorInfo(u,"float32",d),f=On({inputs:{real:h,imag:p},backend:r}),m=wj(i),b=m.real,g=m.imag,x=[b.length],y=r.makeTensorInfo(x,"float32",b),w=r.makeTensorInfo(x,"float32",g),v=On({inputs:{real:y,imag:w},backend:r}),N=Ow(c,d,o,n,r),C=N.real,j=N.imag,I=[C.length],T=r.makeTensorInfo(I,"float32",C),E=r.makeTensorInfo(I,"float32",j),$=On({inputs:{real:T,imag:E},backend:r}),D=Ow(b,g,o,n,r),P=D.real,_=D.imag,O=[P.length],R=r.makeTensorInfo(O,"float32",P),X=r.makeTensorInfo(O,"float32",_),L=On({inputs:{real:R,imag:X},backend:r}),K=Nj(s,n),B=[K.real.length],G=r.makeTensorInfo(B,"float32",K.real),de=r.makeTensorInfo(B,"float32",K.imag),ae=On({inputs:{real:G,imag:de},backend:r}),ve=qm({inputs:{a:ae,b:L},backend:r}),Ne=gc({inputs:{a:$,b:ve},backend:r}),le=_w({inputs:{a:$,b:ve},backend:r}),H=tl({inputs:{input:Ne},backend:r}),ue=tl({inputs:{input:le},backend:r}),F=xc({inputs:{input:Ne},backend:r}),ee=xc({inputs:{input:le},backend:r}),re=bc({inputs:[H,ue],backend:r,attrs:{axis:0}}),te=bc({inputs:[F,ee],backend:r,attrs:{axis:0}}),ce=r.data.get(re.dataId).values,Se=r.data.get(te.dataId).values;return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(T),r.disposeIntermediateTensorInfo(E),r.disposeIntermediateTensorInfo($),r.disposeIntermediateTensorInfo(R),r.disposeIntermediateTensorInfo(X),r.disposeIntermediateTensorInfo(L),r.disposeIntermediateTensorInfo(G),r.disposeIntermediateTensorInfo(de),r.disposeIntermediateTensorInfo(ae),r.disposeIntermediateTensorInfo(ve),r.disposeIntermediateTensorInfo(Ne),r.disposeIntermediateTensorInfo(le),r.disposeIntermediateTensorInfo(H),r.disposeIntermediateTensorInfo(F),r.disposeIntermediateTensorInfo(ue),r.disposeIntermediateTensorInfo(ee),r.disposeIntermediateTensorInfo(re),r.disposeIntermediateTensorInfo(te),{real:ce,imag:Se}}function kQ(t,e,s){const n=new Float32Array(e*2);for(let r=0;r<e;r++){let i=0,o=0;for(let l=0;l<e;l++){const c=kj(r*l,e,s),d=_y(t,l);i+=d.real*c.real-d.imag*c.imag,o+=d.real*c.imag+d.imag*c.real}s&&(i/=e,o/=e),vj(n,i,o,r)}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CQ(t){const{inputs:e,backend:s}=t,{input:n}=e,r=pe(n.shape),i=n.shape[n.shape.length-1],o=r/i,l=es({inputs:{x:n},backend:s,attrs:{shape:[o,i]}}),c=BT(l,!1,s),d=es({inputs:{x:c},backend:s,attrs:{shape:n.shape}});return s.disposeIntermediateTensorInfo(l),s.disposeIntermediateTensorInfo(c),d}const SQ={kernelName:U0,backendName:"cpu",kernelFunc:CQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mw(t){const{backend:e,attrs:s}=t,{shape:n,value:r,dtype:i}=s,o=i||Hl(r),l=ps(o,pe(n));return IQ(l,r,o),e.makeTensorInfo(n,o,l)}const jQ={kernelName:V0,backendName:"cpu",kernelFunc:Mw};function IQ(t,e,s){t.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EQ={kernelName:W0,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:s})=>{const{image:n}=t,r=s,i=Zs(n.dtype,pe(n.shape)),[o,l,c,d]=n.shape,u=r.data.get(n.dataId).values;for(let p=0;p<o;p++){const f=p*c*l*d;for(let m=0;m<l;m++){const b=m*(c*d);for(let g=0;g<c;g++){const x=g*d;for(let y=0;y<d;y++){const w=Math.round(c-g-1),v=f+b+x+y;let N=u[v];if(w>=0&&w<c){const C=w*d,j=f+b+C+y;N=u[j]}i[v]=N}}}}return{dataId:r.write(i,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $Q(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,filter:i,bias:o,preluActivationWeights:l}=e,{strides:c,pad:d,dataFormat:u,dilations:h,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=n;let b=LT({inputs:{x:r,filter:i},backend:s,attrs:{strides:c,pad:d,dataFormat:u,dilations:h,dimRoundingMode:p}});if(o){const g=b;if(u==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const x=es({inputs:{x:o},backend:s,attrs:{shape:[o.shape[0],1,1]}});b=gc({inputs:{a:b,b:x},backend:s}),s.disposeIntermediateTensorInfo(x)}else b=gc({inputs:{a:b,b:o},backend:s});s.disposeIntermediateTensorInfo(g)}if(f){const g=b;if(u==="NCHW"&&f==="prelu"&&l.shape.length===1&&l.shape[0]!==1){const x=es({inputs:{x:l},backend:s,attrs:{shape:[l.shape[0],1,1]}});b=Xm(s,b,f,x,m),s.disposeIntermediateTensorInfo(x)}else b=Xm(s,b,f,l,m);s.disposeIntermediateTensorInfo(g)}return b}const TQ={kernelName:Yf,backendName:"cpu",kernelFunc:$Q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AQ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,filter:i,bias:o,preluActivationWeights:l}=e,{strides:c,pad:d,dataFormat:u,dilations:h,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=n;let b=zT({inputs:{x:r,filter:i},backend:s,attrs:{strides:c,pad:d,dataFormat:u,dilations:h,dimRoundingMode:p}});if(o){const g=b;b=gc({inputs:{a:b,b:o},backend:s}),s.disposeIntermediateTensorInfo(g)}if(f){const g=b;b=Xm(s,b,f,l,m),s.disposeIntermediateTensorInfo(g)}return b}const DQ={kernelName:bC,backendName:"cpu",kernelFunc:AQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Q(t){const{inputs:e,backend:s}=t,{params:n,indices:r}=e,i=pe(n.shape),o=r.shape,l=o[o.length-1],[c,d,u,h]=my(n,r);if(d===0)return s.makeTensorInfo(c,n.dtype,[]);const p=s.data.get(r.dataId).values,f=s.bufferSync(n),m=q$(p,f,n.dtype,d,l,u,h,n.shape,i);return s.makeTensorInfo(c,n.dtype,m.values)}const RQ={kernelName:eC,backendName:"cpu",kernelFunc:_Q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PQ(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,indices:i}=e,{axis:o,batchDims:l}=n;Ye([r,i],"gatherV2");const c=vt(o,r.shape)[0],d=s.data.get(i.dataId).values,u=r.shape[c];for(let v=0;v<d.length;++v){const N=d[v];A(N<=u-1&&N>=0,()=>`GatherV2: the index value ${N} is not in [0, ${u-1}]`)}let h=l;l==null&&(h=0);const p=pe(i.shape),f=Uy(r,i,c,h),m=es({inputs:{x:r},backend:s,attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]}}),b=es({inputs:{x:i},backend:s,attrs:{shape:[f.batchSize,p/f.batchSize]}}),g=[f.batchSize,f.outerSize,p/f.batchSize,f.sliceSize],x=s.bufferSync(b),y=s.bufferSync(m),w=K$(y,x,g);return s.disposeIntermediateTensorInfo(m),s.disposeIntermediateTensorInfo(b),s.makeTensorInfo(f.outputShape,w.dtype,w.values)}const FQ={kernelName:pf,backendName:"cpu",kernelFunc:PQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OQ(t){const{inputs:e,backend:s}=t,{input:n}=e,r=pe(n.shape),i=n.shape[n.shape.length-1],o=r/i,l=es({inputs:{x:n},backend:s,attrs:{shape:[o,i]}}),c=BT(l,!0,s),d=es({inputs:{x:c},backend:s,attrs:{shape:n.shape}});return s.disposeIntermediateTensorInfo(l),s.disposeIntermediateTensorInfo(c),d}const MQ={kernelName:G0,backendName:"cpu",kernelFunc:OQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LQ=Vt(Ud,t=>Number.isFinite(t)?1:0,"bool"),zQ={kernelName:Ud,backendName:"cpu",kernelFunc:LQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BQ=Vt(Vd,t=>Math.abs(t)===1/0?1:0,"bool"),UQ={kernelName:Vd,backendName:"cpu",kernelFunc:BQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VQ=Vt(Wd,t=>Number.isNaN(t)?1:0,"bool"),WQ={kernelName:Wd,backendName:"cpu",kernelFunc:VQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GQ(t){const{backend:e,attrs:s}=t,{start:n,stop:r,num:i}=s,o=Q$(n,r,i);return e.makeTensorInfo([o.length],"float32",o)}const HQ={kernelName:tC,backendName:"cpu",kernelFunc:GQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qQ=Vt(Hd,t=>Math.log1p(t)),KQ={kernelName:Hd,backendName:"cpu",kernelFunc:qQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XQ=bs((t,e)=>t&&e),YQ=_s(bf,XQ,null,"bool"),ZQ={kernelName:bf,backendName:"cpu",kernelFunc:YQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JQ=Vt(yf,t=>t?0:1,"bool"),QQ={kernelName:yf,backendName:"cpu",kernelFunc:JQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eee=bs((t,e)=>t||e),tee=_s(wf,eee,null,"bool"),see={kernelName:wf,backendName:"cpu",kernelFunc:tee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nee(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{depthRadius:i,bias:o,alpha:l,beta:c}=n;Ye(r,"LRN");const d=r.shape[3],u=d-1,h=s.data.get(r.dataId).values,p=pe(r.shape),f=new Float32Array(p);function m(b){const g=b%d;let x=b-g+Math.max(0,g-i);const y=b-g+Math.min(g+i,u);let w=0;for(;x<=y;x++){const v=h[x];w+=v*v}return w}for(let b=0;b<p;b++){const g=m(b),x=h[b]*Math.pow(o+l*g,-c);f[b]=x}return s.makeTensorInfo(r.shape,r.dtype,f)}const ree={kernelName:vf,backendName:"cpu",kernelFunc:nee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iee(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,y:i,dy:o}=e,{depthRadius:l,bias:c,alpha:d,beta:u}=n;Ye(o,"LRNGrad");const h=pe(o.shape),p=o.shape[3],f=s.data.get(o.dataId).values,m=s.data.get(r.dataId).values,b=s.data.get(i.dataId).values,g=new Float32Array(h),x=h;for(let y=0;y<x;y++){const w=y%p,v=y-w+Math.max(0,w-l),N=y-w+Math.min(p,w+l+1);let C=0;for(let j=v;j<N;j++)C+=Math.pow(m[j],2);C=d*C+c;for(let j=v;j<N;j++){let I=-2*d*u*m[j]*b[y]/C;y===j&&(I+=Math.pow(C,-u)),I*=f[y],g[j]+=I}}return s.makeTensorInfo(o.shape,r.dtype,g)}const oee={kernelName:q0,backendName:"cpu",kernelFunc:iee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UT(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{reductionIndices:i,keepDims:o}=n,l=s;let c=r.shape;const d=c.length,u=vt(i,c);let h=u;const p=cs(h,d);let f=l.data.get(r.dataId).values;if(p!=null){const v=new Array(d);for(let N=0;N<v.length;N++)v[N]=c[p[N]];f=Aw(f,c,r.dtype,p,v),h=ms(h.length,d),c=v}Ye(r,"max"),Ws("max",h,d);const[m,b]=Fs(c,h),g=pe(b),x=tT(f,g,m,r.dtype),y=l.write(x,m,r.dtype);let w=m;return o&&(w=ks(m,u)),{dataId:y,shape:w,dtype:r.dtype}}const aee={kernelName:Nf,backendName:"cpu",kernelFunc:UT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lee(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e;Ye(r,"maxPool");const{filterSize:i,strides:o,pad:l,dimRoundingMode:c}=n,d=1;A(Qs(o,d),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const u=hr(r.shape,i,o,d,l,c);let h;if(u.filterWidth===1&&u.filterHeight===1&&Ft(u.inShape,u.outShape))h=vi({inputs:{x:r},backend:s});else{const p=s.data.get(r.dataId).values,f=tt(r.shape),m=Rw(p,r.shape,r.dtype,f,u,"max");h=s.makeTensorInfo(u.outShape,r.dtype,m.values)}return h}const cee={kernelName:kf,backendName:"cpu",kernelFunc:lee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dee(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{filterSize:i,strides:o,pad:l,dimRoundingMode:c,dataFormat:d}=n;Ye(r,"maxPool3d");const u=Zi(r.shape,i,o,1,l,c,d),h=s.data.get(r.dataId).values,p=MT(h,r.shape,r.dtype,tt(r.shape),u,"max");return s.makeTensorInfo(p.shape,"float32",p.values)}const uee={kernelName:Cf,backendName:"cpu",kernelFunc:dee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hee(t){const{inputs:e,backend:s,attrs:n}=t,{dy:r,input:i}=e,{filterSize:o,strides:l,pad:c,dimRoundingMode:d}=n;Ye([r,i],"maxPool3DGrad");const u=Zi(i.shape,o,l,1,c,d),h=s.bufferSync(i),p=tJ(h,u),f=u.strideDepth,m=u.strideHeight,b=u.strideWidth,g=u.dilationDepth,x=u.dilationHeight,y=u.dilationWidth,w=u.effectiveFilterDepth,v=u.effectiveFilterHeight,N=u.effectiveFilterWidth,C=w-1-u.padInfo.front,j=N-1-u.padInfo.left,I=v-1-u.padInfo.top,T=Nt(i.shape,"float32"),E=s.bufferSync(r);for(let $=0;$<u.batchSize;++$)for(let D=0;D<u.inChannels;++D)for(let P=0;P<u.inDepth;++P)for(let _=0;_<u.inHeight;++_)for(let O=0;O<u.inWidth;++O){const R=P-C,X=_-I,L=O-j;let K=0;for(let B=0;B<w;B+=g){const G=(R+B)/f;if(!(G<0||G>=u.outDepth||Math.floor(G)!==G))for(let de=0;de<v;de+=x){const ae=(X+de)/m;if(!(ae<0||ae>=u.outHeight||Math.floor(ae)!==ae))for(let ve=0;ve<N;ve+=y){const Ne=(L+ve)/b;if(Ne<0||Ne>=u.outWidth||Math.floor(Ne)!==Ne)continue;const le=w*v*N-1-p.get($,G,ae,Ne,D),H=B*v*N+de*N+ve,ue=le===H?1:0;if(ue===0)continue;const F=E.get($,G,ae,Ne,D);K+=F*ue}}}T.set(K,$,P,_,O,D)}return s.makeTensorInfo(T.shape,T.dtype,T.values)}const pee={kernelName:X0,backendName:"cpu",kernelFunc:hee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fee(t){const{inputs:e,backend:s,attrs:n}=t,{dy:r,input:i,output:o}=e,l=i;Ye([i,o],"maxPoolGrad");const{filterSize:c,strides:d,pad:u,dimRoundingMode:h}=n,p=hr(l.shape,c,d,1,u,h),f=s.data.get(l.dataId).values,m=Nt(p.outShape,l.dtype,OT(f,l.shape,l.dtype,p).values),b=p.strideHeight,g=p.strideWidth,x=p.dilationHeight,y=p.dilationWidth,w=p.effectiveFilterHeight,v=p.effectiveFilterWidth,N=v-1-p.padInfo.left,C=w-1-p.padInfo.top,j=Nt(l.shape,"float32"),I=s.data.get(r.dataId).values,T=Nt(r.shape,"float32",I);for(let E=0;E<p.batchSize;++E)for(let $=0;$<p.inChannels;++$)for(let D=0;D<p.inHeight;++D)for(let P=0;P<p.inWidth;++P){const _=D-C,O=P-N;let R=0;for(let X=0;X<w;X+=x){const L=(_+X)/b;if(!(L<0||L>=p.outHeight||Math.floor(L)!==L))for(let K=0;K<v;K+=y){const B=(O+K)/g;if(B<0||B>=p.outWidth||Math.floor(B)!==B)continue;const G=w*v-1-m.get(E,L,B,$),de=X*v+K,ae=G===de?1:0;if(ae===0)continue;const ve=T.get(E,L,B,$);R+=ve*ae}}j.set(R,E,D,P,$)}return s.makeTensorInfo(j.shape,j.dtype,j.values)}const mee={kernelName:K0,backendName:"cpu",kernelFunc:fee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gee(t,e,s,n,r){const i=tt(e),o=Rw(t,e,s,i,r,"max"),l=OT(t,e,s,r,!0,n);return[o.values,l.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xee={kernelName:sC,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:s})=>{const{x:n}=t,{filterSize:r,strides:i,pad:o,includeBatchInIndex:l}=e,c=s;Ye(n,"MaxPoolWithArgmax");const d=c.data.get(n.dataId).values,u=hr(n.shape,r,i,[1,1],o),[h,p]=gee(d,n.shape,n.dtype,l,u),f=c.write(h,u.outShape,n.dtype),m=c.write(p,u.outShape,n.dtype);return[{dataId:f,shape:u.outShape,dtype:n.dtype},{dataId:m,shape:u.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bee(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i,keepDims:o}=n,l=vt(i,r.shape),d=Fs(r.shape,l)[1],u=pe(d),h=[],p=s.makeTensorInfo([],"float32",new Float32Array([u]));h.push(p);const f=Wo({inputs:{x:r},backend:s,attrs:{dtype:"float32"}});h.push(f);const m=Pw({inputs:{a:f,b:p},backend:s});h.push(m);const b=Zu({inputs:{x:m},backend:s,attrs:{axis:i,keepDims:o}});return h.forEach(g=>s.disposeIntermediateTensorInfo(g)),b}const yee={kernelName:Sf,backendName:"cpu",kernelFunc:bee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wee(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i,keepDims:o}=n;Ye(r,"min");const l=vt(i,r.shape);let c=l;const d=cs(c,r.shape.length);let u=r;d!=null&&(u=Sn({inputs:{x:r},backend:s,attrs:{perm:d}}),c=ms(c.length,r.shape.length)),Ws("min",c,u.shape.length);const[h,p]=Fs(u.shape,c),f=pe(p),m=Js(pe(h),u.dtype),b=s.data.get(u.dataId).values;for(let x=0;x<m.length;++x){const y=x*f;let w=b[y];for(let v=0;v<f;++v){const N=b[y+v];(Number.isNaN(N)||N<w)&&(w=N)}m[x]=w}d!=null&&s.disposeIntermediateTensorInfo(u);const g=s.makeTensorInfo(h,u.dtype,m);if(o){const x=ks(h,l),y=es({inputs:{x:g},backend:s,attrs:{shape:x}});return s.disposeIntermediateTensorInfo(g),y}return g}const vee={kernelName:jf,backendName:"cpu",kernelFunc:wee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nee(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{paddings:i,mode:o}=n;Ye(r,"mirrorPad");const l=i.map((w,v)=>w[0]+r.shape[v]+w[1]),c=i.map(w=>w[0]),d=i.map((w,v)=>w[0]+r.shape[v]),u=o==="reflect"?0:1,h=s.data.get(r.dataId).values,p=r.shape.length,f=tt(r.shape),m=pe(l),b=l.length,g=tt(l),x=Zs(r.dtype,m);for(let w=0;w<m;w++){let v=ql(w,b,g);for(let C=0;C<b;C++)v[C]<c[C]?v[C]=c[C]*2-v[C]-u:v[C]>=d[C]&&(v[C]=(d[C]-1)*2-v[C]+u);v=v.map((C,j)=>C-c[j]);const N=oi(v,p,f);x[w]=h[N]}return{dataId:s.write(x,l,r.dtype),shape:l,dtype:r.dtype}}const kee={kernelName:If,backendName:"cpu",kernelFunc:Nee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cee=bs((t,e)=>{const s=t%e;return t<0&&e<0||t>=0&&e>=0?s:(s+e)%e}),See=_s(Xd,Cee),jee={kernelName:Xd,backendName:"cpu",kernelFunc:See};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VT(t){const{inputs:e,backend:s,attrs:n}=t,{logits:r}=e,{dim:i}=n,o=r.shape.length;let l=i;if(l===-1&&(l=o-1),l!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${l}`);const c=vt([l],r.shape),d=UT({inputs:{x:r},backend:s,attrs:{reductionIndices:c,keepDims:!1}}),u=ks(d.shape,c),h=es({inputs:{x:d},backend:s,attrs:{shape:u}}),p=_w({inputs:{a:r,b:h},backend:s}),f=V$({inputs:{x:p},backend:s}),m=Zu({inputs:{x:f},backend:s,attrs:{axis:c,keepDims:!1}}),b=es({inputs:{x:m},backend:s,attrs:{shape:u}}),g=Pw({inputs:{a:f,b},backend:s});return s.disposeIntermediateTensorInfo(d),s.disposeIntermediateTensorInfo(h),s.disposeIntermediateTensorInfo(p),s.disposeIntermediateTensorInfo(f),s.disposeIntermediateTensorInfo(m),s.disposeIntermediateTensorInfo(b),g}const Iee={kernelName:Gf,backendName:"cpu",kernelFunc:VT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eee(t){const{inputs:e,backend:s,attrs:n}=t,{logits:r}=e,{numSamples:i,seed:o,normalized:l}=n;Ye(r,"multinomial");const c=l?r:VT({inputs:{logits:r},backend:s,attrs:{dim:-1}}),d=c.shape[0],u=c.shape[1],h=s.data.get(c.dataId).values,p=[d,i],f=Js(pe(p),"int32");for(let m=0;m<d;++m){const b=m*u,g=new Float32Array(u-1);g[0]=h[b];for(let w=1;w<g.length;++w)g[w]=g[w-1]+h[b+w];const x=Jb.alea(o.toString()),y=m*i;for(let w=0;w<i;++w){const v=x();f[y+w]=g.length;for(let N=0;N<g.length;N++)if(v<g[N]){f[y+w]=N;break}}}return l||s.disposeIntermediateTensorInfo(c),s.makeTensorInfo(p,"int32",f)}const $ee={kernelName:nC,backendName:"cpu",kernelFunc:Eee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tee=cy;function Aee(t){const{inputs:e,backend:s,attrs:n}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:l,scoreThreshold:c}=n;Ye(r,"NonMaxSuppression");const d=s.data.get(r.dataId).values,u=s.data.get(i.dataId).values,{selectedIndices:h}=Tee(d,u,o,l,c);return s.makeTensorInfo([h.length],"int32",new Int32Array(h))}const Dee={kernelName:Y0,backendName:"cpu",kernelFunc:Aee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ee=dy;function Ree(t){const{inputs:e,backend:s,attrs:n}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:l,scoreThreshold:c,padToMaxOutputSize:d}=n;Ye(r,"NonMaxSuppressionPadded");const u=s.data.get(r.dataId).values,h=s.data.get(i.dataId).values,{selectedIndices:p,validOutputs:f}=_ee(u,h,o,l,c,d);return[s.makeTensorInfo([p.length],"int32",new Int32Array(p)),s.makeTensorInfo([],"int32",new Int32Array([f]))]}const Pee={kernelName:Z0,backendName:"cpu",kernelFunc:Ree};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fee=uy;function Oee(t){const{inputs:e,backend:s,attrs:n}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:l,scoreThreshold:c,softNmsSigma:d}=n;Ye(r,"NonMaxSuppressionWithScore");const u=s.data.get(r.dataId).values,h=s.data.get(i.dataId).values,p=o,f=l,m=c,b=d,{selectedIndices:g,selectedScores:x}=Fee(u,h,p,f,m,b);return[s.makeTensorInfo([g.length],"int32",new Int32Array(g)),s.makeTensorInfo([x.length],"float32",new Float32Array(x))]}const Mee={kernelName:J0,backendName:"cpu",kernelFunc:Oee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lee(t){const{inputs:e,backend:s,attrs:n}=t,{indices:r}=e,{dtype:i,depth:o,onValue:l,offValue:c}=n;Ye(r,"oneHot");const d=pe(r.shape),u=new Float32Array(d*o);u.fill(c);const h=s.data.get(r.dataId).values;for(let p=0;p<d;++p)h[p]>=0&&h[p]<o&&(u[p*o+h[p]]=l);return s.makeTensorInfo([...r.shape,o],i,u)}const zee={kernelName:Af,backendName:"cpu",kernelFunc:Lee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zm(t){const{inputs:e,backend:s}=t,{x:n}=e;if(n.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(n.dtype==="complex64"){const r=tl({inputs:{input:n},backend:s}),i=Zm({inputs:{x:r},backend:s}),o=xc({inputs:{input:n},backend:s}),l=Zm({inputs:{x:o},backend:s}),c=On({inputs:{real:i,imag:l},backend:s});return s.disposeIntermediateTensorInfo(r),s.disposeIntermediateTensorInfo(i),s.disposeIntermediateTensorInfo(o),s.disposeIntermediateTensorInfo(l),c}else return Mw({backend:s,attrs:{shape:n.shape,value:0,dtype:n.dtype}})}const Bee={kernelName:Kf,backendName:"cpu",kernelFunc:Zm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WT(t){const{inputs:e,backend:s}=t,{x:n}=e;if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(n.dtype==="complex64"){const r=tl({inputs:{input:n},backend:s}),i=WT({inputs:{x:r},backend:s}),o=xc({inputs:{input:n},backend:s}),l=Zm({inputs:{x:o},backend:s}),c=On({inputs:{real:i,imag:l},backend:s});return s.disposeIntermediateTensorInfo(r),s.disposeIntermediateTensorInfo(i),s.disposeIntermediateTensorInfo(o),s.disposeIntermediateTensorInfo(l),c}else return Mw({backend:s,attrs:{shape:n.shape,value:1,dtype:n.dtype}})}const Uee={kernelName:Tf,backendName:"cpu",kernelFunc:WT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GT(t){const{inputs:e,backend:s,attrs:n}=t,{axis:r}=n;if(e.length===1)return Ym({inputs:{input:e[0]},backend:s,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(u=>{h0(i,u.shape,"All tensors passed to stack must have matching shapes"),A(o===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const l=[],c=e.map(u=>{const h=Ym({inputs:{input:u},backend:s,attrs:{dim:r}});return l.push(h),h}),d=bc({inputs:c,backend:s,attrs:{axis:r}});return l.forEach(u=>s.disposeIntermediateTensorInfo(u)),d}const Vee={kernelName:Df,backendName:"cpu",kernelFunc:GT};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wee(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{paddings:i,constantValue:o}=n;Ye(r,"pad");const l=i.map((y,w)=>y[0]+r.shape[w]+y[1]),c=i.map(y=>y[0]),d=s.data.get(r.dataId).values,u=pe(r.shape),h=r.shape.length,p=tt(r.shape),f=pe(l),m=l.length,b=tt(l),g=Zs(r.dtype,f);o!==0&&g.fill(o);for(let y=0;y<u;y++){const v=ql(y,h,p).map((C,j)=>C+c[j]),N=oi(v,m,b);g[N]=d[y]}return{dataId:s.write(g,l,r.dtype),shape:l,dtype:r.dtype}}const HT={kernelName:_f,backendName:"cpu",kernelFunc:Wee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gee=bs((t,e)=>Math.pow(t,e)),Hee=_s(Zd,Gee),qee={kernelName:Zd,backendName:"cpu",kernelFunc:Hee};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kee(t){const{inputs:e,backend:s,attrs:n}=t,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,l=r.map(g=>s.data.get(g.dataId).values),c=r.map(g=>g.shape),d=s.data.get(i.dataId).values,u=s.data.get(o.dataId).values,[h,p,f]=lT(l,c,d,i.shape,i.dtype,u,o.shape),m=h.map(g=>s.makeTensorInfo([g.length],"int32",g)),b=s.makeTensorInfo(f,i.dtype,p);return m.concat([b])}const Xee={kernelName:rC,backendName:"cpu",kernelFunc:Kee};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yee(t){const{inputs:e,backend:s}=t,{starts:n,limits:r,deltas:i}=e,o=s.data.get(n.dataId).values,l=s.data.get(r.dataId).values,c=s.data.get(i.dataId).values,[d,u]=dT(o,n.shape,n.dtype,l,r.shape,c,i.shape),h=s.makeTensorInfo([d.length],"int32",d),p=s.makeTensorInfo([u.length],n.dtype,u);return[h,p]}const Zee={kernelName:iC,backendName:"cpu",kernelFunc:Yee};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jee(t){const{inputs:e,backend:s,attrs:n}=t,{shape:r,values:i,defaultValue:o,rowPartitionTensors:l}=e,{rowPartitionTypes:c}=n,d=s.data.get(r.dataId).values,u=s.data.get(i.dataId).values,h=s.data.get(o.dataId).values,p=l.map(g=>s.data.get(g.dataId).values),f=l.map(g=>g.shape),[m,b]=pT(d,r.shape,u,i.shape,i.dtype,h,o.shape,p,f,c);return s.makeTensorInfo(m,i.dtype,b)}const Qee={kernelName:oC,backendName:"cpu",kernelFunc:Jee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ete(t){const{backend:e,attrs:s}=t,{start:n,stop:r,dtype:i,step:o}=s,l=fT(n,r,o,i);return e.makeTensorInfo([l.length],i,l)}const tte={kernelName:Q0,backendName:"cpu",kernelFunc:ete};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ste=Vt(Jd,t=>1/t),nte={kernelName:Jd,backendName:"cpu",kernelFunc:ste};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rte(t){const{inputs:e,backend:s,attrs:n}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:l}=n;Ye(r,"resizeBilinear");const c=tt(r.shape),[d,u]=l,[h,p,f,m]=r.shape,b=s.data.get(r.dataId).values,g=new Float32Array(pe([h,d,u,m])),x=[i&&d>1?p-1:p,i&&u>1?f-1:f],y=[i&&d>1?d-1:d,i&&u>1?u-1:u];let w=0;const v=x[0]/y[0],N=x[1]/y[1];for(let C=0;C<h;C++)for(let j=0;j<d;j++){let I;o?I=v*(j+.5)-.5:I=v*j;const T=Math.max(0,Math.floor(I)),E=I-T,$=Math.min(p-1,Math.ceil(I)),D=C*c[0]+T*c[1],P=C*c[0]+$*c[1];for(let _=0;_<u;_++){let O;o?O=N*(_+.5)-.5:O=N*_;const R=Math.max(0,Math.floor(O)),X=O-R,L=Math.min(f-1,Math.ceil(O)),K=D+R*c[2],B=P+R*c[2],G=D+L*c[2],de=P+L*c[2];for(let ae=0;ae<m;ae++){const ve=b[K+ae],Ne=b[B+ae],le=b[G+ae],H=b[de+ae],ue=ve+(le-ve)*X,F=Ne+(H-Ne)*X,ee=ue+(F-ue)*E;g[w++]=ee}}}return s.makeTensorInfo([h,d,u,m],"float32",g)}const ite={kernelName:Mf,backendName:"cpu",kernelFunc:rte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ote(t){const{inputs:e,backend:s,attrs:n}=t,{images:r,dy:i}=e,{alignCorners:o}=n;Ye([i,r],"resizeBilinearGrad");const l=tt(r.shape),[c,d,u,h]=r.shape,[,p,f]=i.shape,m=new Float32Array(c*d*u*h),b=[o&&p>1?d-1:d,o&&f>1?u-1:u],g=[o&&p>1?p-1:p,o&&f>1?f-1:f],x=b[0]/g[0],y=b[1]/g[1],w=s.data.get(i.dataId).values;let v=0;for(let N=0;N<c;N++){const C=N*l[0];for(let j=0;j<p;j++){const I=j*x,T=Math.floor(I),E=Math.min(Math.ceil(I),d-1),$=C+T*l[1],D=C+E*l[1],P=I-T,_=1-P;for(let O=0;O<f;O++){const R=O*y,X=Math.floor(R),L=Math.min(Math.ceil(R),u-1),K=R-X,B=1-K,G=$+X*l[2],de=$+L*l[2],ae=D+X*l[2],ve=D+L*l[2],Ne=_*B,le=_*K,H=P*B,ue=P*K;for(let F=0;F<h;F++){const ee=w[v++];m[G+F]+=ee*Ne,m[de+F]+=ee*le,m[ae+F]+=ee*H,m[ve+F]+=ee*ue}}}}return s.makeTensorInfo([c,u,d,h],"float32",m)}const ate={kernelName:sb,backendName:"cpu",kernelFunc:ote};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lte(t){const{inputs:e,backend:s,attrs:n}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:l}=n;Ye(r,"resizeNearestNeighbor");const c=tt(r.shape),[d,u]=l,[h,p,f,m]=r.shape,b=s.data.get(r.dataId).values,g=new Float32Array(h*d*u*m),x=[i&&d>1?p-1:p,i&&u>1?f-1:f],y=[i&&d>1?d-1:d,i&&u>1?u-1:u],w=x[0]/y[0],v=x[1]/y[1];let N=0;for(let C=0;C<h;C++){const j=C*c[0];for(let I=0;I<d;I++){const T=o?w*(I+.5):w*I;let E=Math.min(p-1,i?Math.round(T):Math.floor(T));o&&(E=Math.max(0,E));const $=j+E*c[1];for(let D=0;D<u;D++){const P=o?v*(D+.5):v*D;let _=Math.min(f-1,i?Math.round(P):Math.floor(P));o&&(_=Math.max(0,_));const O=$+_*c[2];for(let R=0;R<m;R++){const X=b[O+R];g[N++]=X}}}}return s.makeTensorInfo([h,d,u,m],r.dtype,g)}const cte={kernelName:Of,backendName:"cpu",kernelFunc:lte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dte(t){const{inputs:e,backend:s,attrs:n}=t,{images:r,dy:i}=e,{alignCorners:o}=n;Ye([i,r],"resizeNearestNeighborGrad");const l=tt(r.shape),c=tt(i.shape),[d,u,h,p]=r.shape,[,f,m]=i.shape,b=new Float32Array(d*u*h*p),g=s.data.get(i.dataId).values,x=[o&&f>1?u-1:u,o&&m>1?h-1:h],y=[o&&f>1?f-1:f,o&&m>1?m-1:m],w=x[0]/y[0],v=x[1]/y[1],N=1/w,C=1/v,j=Math.ceil(N)*2+2,I=Math.ceil(C)*2+2;for(let T=0;T<d;T++){const E=T*l[0];for(let $=0;$<u;$++){const D=E+$*l[1],P=Math.floor($*N),_=Math.floor(P-j/2);for(let O=0;O<h;O++){const R=D+O*l[2],X=Math.floor(O*C),L=Math.floor(X-I/2);for(let K=0;K<p;K++){let B=0;for(let G=0;G<j;G++){const de=G+_;if(de<0||de>=f)continue;const ae=E+de*c[1],ve=de*w,Ne=Math.min(u-1,o?Math.round(ve):Math.floor(ve));if($===Ne)for(let le=0;le<I;le++){const H=le+L;if(H<0||H>=m)continue;const ue=ae+H*c[2],F=H*v,ee=Math.min(h-1,o?Math.round(F):Math.floor(F));O===ee&&(B+=g[ue+K])}}b[R+K]=B}}}}return s.makeTensorInfo(r.shape,r.dtype,b)}const ute={kernelName:tb,backendName:"cpu",kernelFunc:dte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hte(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{dims:i}=n;Ye(r,"reverse");const o=r.shape.length,l=vt(i,r.shape);if(o===0)return vi({inputs:{x:r},backend:s});const c=new Us(r.shape,r.dtype),d=s.bufferSync(r);for(let u=0;u<c.size;u++){const h=c.indexToLoc(u),p=h.slice();l.forEach(f=>p[f]=r.shape[f]-1-p[f]),c.set(d.get(...p),...h)}return s.makeTensorInfo(c.shape,c.dtype,c.values)}const pte={kernelName:Lf,backendName:"cpu",kernelFunc:hte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fte={kernelName:cb,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:s})=>{const{image:n}=t,{radians:r,fillValue:i,center:o}=e,l=s,c=Zs(n.dtype,pe(n.shape)),[d,u,h,p]=n.shape,[f,m]=Cy(o,u,h),b=255,g=Math.sin(r),x=Math.cos(r),y=l.data.get(n.dataId).values;for(let v=0;v<d;v++){const N=v*h*u*p;for(let C=0;C<u;C++){const j=C*(h*p);for(let I=0;I<h;I++){const T=I*p;for(let E=0;E<p;E++){const $=[d,C,I,E],D=$[2],P=$[1];let _=(D-f)*x-(P-m)*g,O=(D-f)*g+(P-m)*x;_=Math.round(_+f),O=Math.round(O+m);let R=i;if(typeof i!="number"&&(E===3?R=b:R=i[E]),_>=0&&_<h&&O>=0&&O<u){const L=O*(h*p),K=_*p,B=N+L+K+E;R=y[B]}const X=N+j+T+E;c[X]=R}}}}return{dataId:l.write(c,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mte=Vt(tu,t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1}),gte={kernelName:tu,backendName:"cpu",kernelFunc:mte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xte(t){const{inputs:e,backend:s,attrs:n}=t,{indices:r,updates:i}=e,{shape:o}=n,{sliceRank:l,numUpdates:c,sliceSize:d,strides:u,outputSize:h}=Ha(i,r,o),p=!0,f=s.bufferSync(r),m=s.bufferSync(i),b=sl(f,m,o,h,d,c,l,u,0,p);return s.makeTensorInfo(o,b.dtype,b.values)}const bte={kernelName:aC,backendName:"cpu",kernelFunc:xte};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yte(t,e){let s=0,n=t.length,r=0;for(;s<n;)r=Math.floor((s+n)/2),t[r]<e?s=r+1:n=r;return n}function wte(t,e){let s=0,n=t.length,r=0;for(;s<n;)r=Math.floor((s+n)/2),t[r]<=e?s=r+1:n=r;return n}function vte(t,e,s,n,r,i){const o=ps("int32",s*r);for(let l=0;l<s;++l){const c=t.slice(l*n,(l+1)*n),d=l*r;for(let u=0;u<r;++u)o[d+u]=i==="left"?yte(c,e[u+d]):wte(c,e[u+d])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nte(t){const{inputs:e,backend:s,attrs:n}=t,{sortedSequence:r,values:i}=e,{side:o}=n,l=s.data.get(r.dataId).values,c=s.data.get(i.dataId).values,d=vte(l,c,r.shape[0],r.shape[1],i.shape[1],o);return s.makeTensorInfo(i.shape,"int32",d)}const kte={kernelName:cC,backendName:"cpu",kernelFunc:Nte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cte(t){const{inputs:e,backend:s}=t,{condition:n,t:r,e:i}=e;Ye([n,r,i],"select");const o=n.shape.length,l=s.data.get(n.dataId).values,c=s.data.get(r.dataId).values,d=s.data.get(i.dataId).values,u=Rn(r.dtype,i.dtype),h=Js(pe(r.shape),u);let p=0;const f=o===0||o>1||r.shape.length===1?1:pe(r.shape.slice(1));for(let m=0;m<l.length;m++)for(let b=0;b<f;b++)l[m]===1?h[p++]=c[m]:h[p++]=d[m];return s.makeTensorInfo(r.shape,u,h)}const Ste={kernelName:zf,backendName:"cpu",kernelFunc:Cte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jte=ym,Ite=wm,Ete=Vt(nu,t=>t>=0?Ite*t:jte*(Math.exp(t)-1)),$te={kernelName:nu,backendName:"cpu",kernelFunc:Ete};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tte=Vt(ou,t=>t<0?-1:t>0?1:0),Ate={kernelName:ou,backendName:"cpu",kernelFunc:Tte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dte=Vt(ru,t=>Math.sin(t)),_te={kernelName:ru,backendName:"cpu",kernelFunc:Dte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rte=Vt(iu,t=>Math.sinh(t)),Pte={kernelName:iu,backendName:"cpu",kernelFunc:Rte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qT=Math.log(11920928955078125e-23)+2,Fte=Vt(lu,t=>{const e=t>-qT,s=t<qT,n=Math.exp(t);let r;return s?r=n:e?r=t:r=Math.log(1+n),r}),Ote={kernelName:lu,backendName:"cpu",kernelFunc:Fte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mte(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{blockShape:i,paddings:o}=n;Ye([r],"spaceToBatchND");const l=pe(i),c=[[0,0]];c.push(...o);for(let C=1+i.length;C<r.shape.length;++C)c.push([0,0]);const d=HT.kernelFunc({inputs:{x:r},backend:s,attrs:{paddings:c,constantValue:0}}),u=Du(d.shape,i,l,!1),h=_u(u.length,i.length,!1),p=Ru(d.shape,i,l,!1),b=es({inputs:{x:d},backend:s,attrs:{shape:u}}),y=Sn({inputs:{x:b},backend:s,attrs:{perm:h}}),N=es({inputs:{x:y},backend:s,attrs:{shape:p}});return s.disposeIntermediateTensorInfo(d),s.disposeIntermediateTensorInfo(b),s.disposeIntermediateTensorInfo(y),N}const Lte={kernelName:Vf,backendName:"cpu",kernelFunc:Mte};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zte(t){const{inputs:e,backend:s}=t,{indices:n,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${n.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const l=s.data.get(n.dataId).values,c=s.data.get(r.dataId).values,d=s.data.get(i.dataId).values,u=s.data.get(o.dataId).values[0],[h,p,f,m,b]=bT(l,n.shape,n.dtype,c,r.dtype,d,u);return[s.makeTensorInfo(p,n.dtype,h),s.makeTensorInfo([p[0]],r.dtype,f),s.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(g=>Number(g)))),s.makeTensorInfo([b.length],n.dtype,new Int32Array(b))]}const Bte={kernelName:dC,backendName:"cpu",kernelFunc:zte};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ute(t){const{inputs:e,backend:s}=t,{inputIndices:n,inputShape:r,newShape:i}=e;if(n.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${n.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(s.data.get(r.dataId).values),l=s.data.get(n.dataId).values,c=Array.from(s.data.get(i.dataId).values),[d,u,h]=yT(l,n.shape,n.dtype,o,c);return[s.makeTensorInfo(u,n.dtype,d),s.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const Vte={kernelName:uC,backendName:"cpu",kernelFunc:Ute};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wte(t){const{inputs:e,backend:s}=t,{data:n,indices:r,segmentIds:i}=e;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=s.data.get(n.dataId).values,l=s.data.get(r.dataId).values,c=s.data.get(i.dataId).values,[d,u]=Dw(o,n.shape,n.dtype,l,c,!0);return s.makeTensorInfo(u,n.dtype,d)}const Gte={kernelName:hC,backendName:"cpu",kernelFunc:Wte};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hte(t){const{inputs:e,backend:s}=t,{data:n,indices:r,segmentIds:i}=e;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=s.data.get(n.dataId).values,l=s.data.get(r.dataId).values,c=s.data.get(i.dataId).values,[d,u]=Dw(o,n.shape,n.dtype,l,c);return s.makeTensorInfo(u,n.dtype,d)}const qte={kernelName:pC,backendName:"cpu",kernelFunc:Hte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kte(t){const{inputs:e,backend:s,attrs:n}=t,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:l}=n,{sliceRank:c,numUpdates:d,sliceSize:u,strides:h,outputSize:p}=Ha(i,r,l),f=!1,m=s.bufferSync(r);let b;switch(i.dtype){case"bool":{const g=s.bufferSync(i),x=!!s.data.get(o.dataId).values[0];b=sl(m,g,l,p,u,d,c,h,x,f);break}case"float32":{const g=s.bufferSync(i),x=s.data.get(o.dataId).values[0];b=sl(m,g,l,p,u,d,c,h,x,f);break}case"int32":{const g=s.bufferSync(i),x=s.data.get(o.dataId).values[0];b=sl(m,g,l,p,u,d,c,h,x,f);break}case"string":{const g=s.bufferSync(i),x=Eo(s.data.get(o.dataId).values[0]);b=sl(m,g,l,p,u,d,c,h,x,f);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return s.makeTensorInfo(l,b.dtype,b.values)}const Xte={kernelName:fC,backendName:"cpu",kernelFunc:Kte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yte(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{numOrSizeSplits:i,axis:o}=n,l=vt(o,r.shape)[0],c=zy(r,i,l),d=new Array(r.shape.length).fill(0),u=r.shape.slice();return c.map(h=>{const p=[...u];p[l]=h;const f=nl({inputs:{x:r},backend:s,attrs:{begin:d,size:p}});return d[l]+=h,f})}const Zte={kernelName:Wf,backendName:"cpu",kernelFunc:Yte};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jte={kernelName:nb,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:s}=t,n=e;Ye(s,"square");const r=n.data.get(s.dataId).values,i=new Float32Array(r.length);for(let l=0;l<r.length;++l){const c=r[l];i[l]=c*c}return{dataId:n.write(i,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qte=Vt(mu,(t,e)=>{const s=e;return isNaN(t)?NaN:t>0?1:s.alpha}),ese={kernelName:mu,backendName:"cpu",kernelFunc:Qte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tse(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{begin:i,end:o,strides:l,beginMask:c,endMask:d,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:p}=n;Ye(r,"stridedSlice");const{finalShapeSparse:f,finalShape:m,isIdentity:b,sliceDim0:g,isSimpleSlice:x,begin:y,end:w,strides:v}=vy(r.shape,i,o,l,c,d,u,h,p);let N;if(b)N=es({inputs:{x:r},backend:s,attrs:{shape:m}});else if(g||x){A(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const C=by(y,w,v),j=nl({inputs:{x:r},backend:s,attrs:{begin:y,size:C}});N=es({inputs:{x:j},backend:s,attrs:{shape:m}}),s.disposeIntermediateTensorInfo(j)}else{const C=s.bufferSync(r),j=NT(f,C,v,y);N=s.makeTensorInfo(m,j.dtype,j.values)}return N}const sse={kernelName:ib,backendName:"cpu",kernelFunc:tse};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nse(t){const{inputs:e,backend:s,attrs:n}=t,{separator:r,nGramWidths:i,leftPad:o,rightPad:l,padWidth:c,preserveShortSequences:d}=n,{data:u,dataSplits:h}=e,p=s.data.get(u.dataId).values,f=s.data.get(h.dataId).values,[m,b]=kT(p,f,r,i,o,l,c,d);return[s.makeTensorInfo([m.length],"string",m),s.makeTensorInfo(h.shape,"int32",b)]}const rse={kernelName:mC,backendName:"cpu",kernelFunc:nse};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ise(t){const{inputs:e,backend:s,attrs:n}=t,{skipEmpty:r}=n,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const l=s.data.get(i.dataId).values,c=s.data.get(o.dataId).values[0],[d,u,h]=CT(l,c,r),p=u.length;return[s.makeTensorInfo([p,2],"int32",d),s.makeTensorInfo([p],"string",u),s.makeTensorInfo([2],"int32",new Int32Array(h))]}const ose={kernelName:gC,backendName:"cpu",kernelFunc:ise};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ase(t){const{inputs:e,backend:s,attrs:n}=t,{numBuckets:r}=n,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=s.data.get(i.dataId).values,l=ST(o,r);return s.makeTensorInfo(i.shape,"int32",l)}const lse={kernelName:xC,backendName:"cpu",kernelFunc:ase};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cse=Vt(hu,t=>Math.tan(t)),dse={kernelName:hu,backendName:"cpu",kernelFunc:cse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const use=Vt(pu,t=>Math.tanh(t)),hse={kernelName:pu,backendName:"cpu",kernelFunc:use};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pse(t){const{inputs:e,backend:s}=t,{tensor:n,indices:r,updates:i}=e,{sliceRank:o,numUpdates:l,sliceSize:c,strides:d,outputSize:u}=Ha(i,r,n.shape),h=!1,p=s.bufferSync(r),f=s.bufferSync(i),m=s.bufferSync(n),b=sl(p,f,n.shape,u,c,l,o,d,m,h);return s.makeTensorInfo(n.shape,b.dtype,b.values)}const fse={kernelName:lC,backendName:"cpu",kernelFunc:pse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mse(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{reps:i}=n;Ye(r,"tile");const o=IT(s.bufferSync(r),i);return s.makeTensorInfo(o.shape,o.dtype,o.values)}const gse={kernelName:fu,backendName:"cpu",kernelFunc:mse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xse(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{k:i,sorted:o}=n;Ye(r,"topk");const l=s.data.get(r.dataId).values,[c,d]=$T(l,r.shape,r.dtype,i,o);return[s.makeTensorInfo(c.shape,c.dtype,c.values),s.makeTensorInfo(d.shape,d.dtype,d.values)]}const bse={kernelName:ob,backendName:"cpu",kernelFunc:xse};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yse(t){const{inputs:e,attrs:s,backend:n}=t,{image:r,transforms:i}=e,{interpolation:o,fillMode:l,fillValue:c,outputShape:d}=s,[u,h,p,f]=r.shape,[m,b]=d??[h,p],g=[u,m,b,f],x=tt(r.shape),y=x[0],w=x[1],v=x[2],N=tt(g),C=N[0],j=N[1],I=N[2],T=Zs(r.dtype,pe(g));T.fill(c);const E=n.data.get(r.dataId).values,$=n.data.get(i.dataId).values;for(let P=0;P<u;++P){const _=i.shape[0]===1?$:$.subarray(P*8,P*8+8);for(let O=0;O<m;++O)for(let R=0;R<b;++R)for(let X=0;X<f;++X){let L;const K=_[6]*R+_[7]*O+1;if(K===0)continue;const B=(_[0]*R+_[1]*O+_[2])/K,G=(_[3]*R+_[4]*O+_[5])/K,de=KT(B,p,l),ae=KT(G,h,l);switch(o){case"nearest":L=Sse(E,h,p,y,w,v,P,ae,de,X,c);break;case"bilinear":L=jse(E,h,p,y,w,v,P,ae,de,X,c);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const ve=P*C+O*j+R*I+X;T[ve]=L}return n.makeTensorInfo(g,r.dtype,T)}return{dataId:n.write(T,g,r.dtype),shape:r.shape,dtype:r.dtype}}const wse={kernelName:ab,backendName:"cpu",kernelFunc:yse};function KT(t,e,s){switch(s){case"reflect":return vse(t,e);case"wrap":return Nse(t,e);case"nearest":return Cse(t,e);case"constant":default:return kse(t)}}function vse(t,e){let s=t;if(s<0)if(e<=1)s=0;else{const n=2*e;s<n&&(s=n*Math.trunc(-s/n)+s),s=s<-e?s+n:-s-1}else if(s>e-1)if(e<=1)s=0;else{const n=2*e;s-=n*Math.trunc(s/n),s>=e&&(s=n-s-1)}return ja(0,s,e-1)}function Nse(t,e){let s=t;if(s<0)if(e<=1)s=0;else{const n=e-1;s+=e*(Math.trunc(-s/n)+1)}else if(s>e-1)if(e<=1)s=0;else{const n=e-1;s-=e*Math.trunc(s/n)}return ja(0,s,e-1)}function kse(t,e){return t}function Cse(t,e){return ja(0,t,e-1)}function Ju(t,e,s,n,r,i,o,l,c,d,u){const h=o*n+l*r+c*i+d;return 0<=l&&l<e&&0<=c&&c<s?t[h]:u}function Sse(t,e,s,n,r,i,o,l,c,d,u){const h=Math.round(l),p=Math.round(c);return Ju(t,e,s,n,r,i,o,h,p,d,u)}function jse(t,e,s,n,r,i,o,l,c,d,u){const h=Math.floor(l),p=Math.floor(c),f=h+1,m=p+1,b=(m-c)*Ju(t,e,s,n,r,i,o,h,p,d,u)+(c-p)*Ju(t,e,s,n,r,i,o,h,m,d,u),g=(m-c)*Ju(t,e,s,n,r,i,o,f,p,d,u)+(c-p)*Ju(t,e,s,n,r,i,o,f,m,d,u);return(f-l)*b+(l-h)*g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ise(t){const{inputs:e,attrs:s,backend:n}=t,{axis:r}=s,{x:i}=e;Ye(i,"unique");const o=n.data.get(i.dataId).values,{outputValues:l,outputShape:c,indices:d}=TT(o,r,i.shape,i.dtype);return[n.makeTensorInfo(c,i.dtype,l),n.makeTensorInfo([d.length],"int32",d)]}const Ese={kernelName:lb,backendName:"cpu",kernelFunc:Ise};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $se(t){const{inputs:e,backend:s,attrs:n}=t,{value:r}=e;let{axis:i}=n;i<0&&(i+=r.shape.length);const o=r.shape.length,l=r.shape[i],c=new Array(o-1);let d=0;for(let f=0;f<o;f++)f!==i&&(c[d++]=r.shape[f]);const u=new Array(o).fill(0),h=r.shape.slice();h[i]=1;const p=new Array(l);for(let f=0;f<p.length;f++){u[i]=f;const m=nl({inputs:{x:r},backend:s,attrs:{begin:u,size:h}});p[f]=es({inputs:{x:m},backend:s,attrs:{shape:c}}),s.disposeIntermediateTensorInfo(m)}return p}const Tse={kernelName:Hf,backendName:"cpu",kernelFunc:$se};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ase(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,segmentIds:i}=e,{numSegments:o}=n;Ye(r,"unsortedSegmentSum");const l=r.shape.length,c=i.shape.length,d=[],u=[],h=l-c;let p=i;for(let m=0;m<h;++m){const b=Ym({inputs:{input:p},backend:s,attrs:{dim:m+1}});p=b,u.push(b)}for(let m=0;m<o;++m){const b=jo(m,"int32"),g=s.makeTensorInfo([],"int32",b),x=B$({inputs:{a:g,b:p},backend:s}),y=Wo({inputs:{x},backend:s,attrs:{dtype:"float32"}}),w=qm({inputs:{a:y,b:r},backend:s}),v=Zu({inputs:{x:w},backend:s,attrs:{axis:0,keepDims:!1}});d.push(v),u.push(g),u.push(x),u.push(y),u.push(w),u.push(v)}const f=GT({inputs:d,backend:s,attrs:{axis:0}});return u.forEach(m=>s.disposeIntermediateTensorInfo(m)),f}const Dse={kernelName:qf,backendName:"cpu",kernelFunc:Ase};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _se=[$Z,cY,AZ,_Z,mY,PZ,OZ,LZ,BZ,VZ,GZ,qZ,XZ,JZ,eJ,nJ,iJ,aJ,cJ,IZ,uJ,pJ,mJ,xY,xJ,pY,yY,yJ,dY,wJ,NJ,kJ,SJ,IJ,$J,AJ,_J,PJ,OJ,LJ,BJ,VJ,GJ,qJ,KJ,YJ,JJ,eQ,tQ,sQ,nQ,iQ,lQ,wZ,dQ,wY,bQ,vY,yQ,kY,SQ,jQ,EQ,SY,IY,TQ,DQ,RQ,FQ,$Y,AY,uY,MQ,vJ,zQ,UQ,WQ,vZ,_Y,PY,HQ,OY,KQ,ZQ,QQ,see,ree,oee,aee,LY,cee,uee,pee,mee,xee,yee,vee,BY,kee,jee,$ee,VY,GY,Dee,Pee,Mee,qY,zee,Uee,Vee,HT,qee,kZ,YY,Xee,Zee,Qee,tte,hY,Fw,nte,CZ,SZ,jZ,ite,ate,cte,ute,pte,fte,gte,rZ,bte,kte,Ste,$te,oZ,Ate,_te,Pte,aZ,Iee,Ote,Lte,Bte,Vte,Gte,qte,Xte,Zte,dZ,Jte,hZ,fZ,ese,sse,rse,ose,lse,bZ,oQ,dse,hse,fse,gse,bse,wse,KY,Ese,Tse,Dse,Bee];for(const t of _se)NC(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rl={},Jm={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Rse(t,e){rl[t]=e}function qr(t,e){if(!(t in rl)||e!=null){const n=Fse(t,e);if(n!==null)rl[t]=n;else return console.log("Could not get context for WebGL version",t),null}const s=rl[t];return s==null||s.isContextLost()?(delete rl[t],qr(t)):(s.disable(s.DEPTH_TEST),s.disable(s.STENCIL_TEST),s.disable(s.BLEND),s.disable(s.DITHER),s.disable(s.POLYGON_OFFSET_FILL),s.disable(s.SAMPLE_COVERAGE),s.enable(s.SCISSOR_TEST),s.enable(s.CULL_FACE),s.cullFace(s.BACK),rl[t])}function Pse(t){if(!oe().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function Fse(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const s=e??Pse(t);return s.addEventListener("webglcontextlost",n=>{n.preventDefault(),delete rl[t]},!1),oe().getBool("SOFTWARE_WEBGL_ENABLED")&&(Jm.failIfMajorPerformanceCaveat=!1),t===1?s.getContext("webgl",Jm)||s.getContext("experimental-webgl",Jm):s.getContext("webgl2",Jm)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Qu;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(Qu||(Qu={}));var Yn;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(Yn||(Yn={}));var Gs;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Gs||(Gs={}));function eh(t,e){return[e,t]}function Ose(t,e){return t*e}function Qm(t){const e=pe(t),s=Math.ceil(e/4);return p0(s)}function yc(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function Mse(t,e){const[s,n]=yc(t,e);return s*n*4}function Lw(t,e){const s=t;let n,r,i,o,l,c,d,u,h,p;return oe().getNumber("WEBGL_VERSION")===2?(n=s.R32F,r=s.R16F,i=s.RGBA16F,o=s.RGBA32F,l=s.RED,d=4,u=1,h=s.HALF_FLOAT,p=s.FLOAT,c=s.RGBA8):(n=t.RGBA,r=t.RGBA,i=t.RGBA,o=s.RGBA,l=t.RGBA,d=4,u=4,h=e!=null?e.HALF_FLOAT_OES:null,p=t.FLOAT,c=t.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:l,downloadTextureFormat:c,downloadUnpackNumChannels:d,defaultNumChannels:u,textureTypeHalfFloat:h,textureTypeFloat:p}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ue(t,e){const s=e();return oe().getBool("DEBUG")&&Lse(t),s}function Lse(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+Vse(t,e))}const zse=596e-10,Bse=65504;function Use(t){return!!(oe().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||zse<Math.abs(t)&&Math.abs(t)<Bse)}function Vse(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function eg(t,e){return io(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function Wse(t,e){const s=io(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Ue(t,()=>t.shaderSource(s,e)),Ue(t,()=>t.compileShader(s)),t.getShaderParameter(s,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(s)),new Error("Failed to compile vertex shader.");return s}function Gse(t,e){const s=io(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Ue(t,()=>t.shaderSource(s,e)),Ue(t,()=>t.compileShader(s)),oe().get("ENGINE_COMPILE_ONLY"))return s;if(t.getShaderParameter(s,t.COMPILE_STATUS)===!1)throw XT(e,t.getShaderInfoLog(s)),new Error("Failed to compile fragment shader.");return s}const Hse=/ERROR: [0-9]+:([0-9]+):/g;function XT(t,e){const s=Hse.exec(e);if(s==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const n=+s[1],r=t.split(`
`),i=r.length.toString().length+2,o=r.map((h,p)=>Gl((p+1).toString(),i)+h);let l=0;for(let h=0;h<o.length;h++)l=Math.max(o[h].length,l);const c=o.slice(0,n-1),d=o.slice(n-1,n),u=o.slice(n);console.log(c.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Gl(d[0],l)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function qse(t){return io(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function Kse(t,e){if(Ue(t,()=>t.linkProgram(e)),!oe().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function zw(t,e){if(Ue(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function Xse(t,e){const s=io(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Ue(t,()=>t.bindBuffer(t.ARRAY_BUFFER,s)),Ue(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),s}function Yse(t,e){const s=io(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Ue(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s)),Ue(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),s}function Zse(t){return io(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function Jse(t,e){const s=oe().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const n=`[${t}x${e}]`;throw new Error("Requested texture size "+n+" is invalid.")}if(t>s||e>s){const n=`[${t}x${e}]`,r=`[${s}x${s}]`;throw new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+r+".")}}function Qse(t){return io(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function YT(t,e,s,n,r,i,o){const l=t.getAttribLocation(e,s);return l===-1?!1:(Ue(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),Ue(t,()=>t.vertexAttribPointer(l,r,t.FLOAT,!1,i,o)),Ue(t,()=>t.enableVertexAttribArray(l)),!0)}function ene(t,e,s){ine(t,s),Ue(t,()=>t.activeTexture(t.TEXTURE0+s)),Ue(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function tne(t,e,s){return io(t,()=>t.getUniformLocation(e,s),'uniform "'+s+'" not present in program.')}function sne(t,e,s){return t.getUniformLocation(e,s)}function nne(t,e,s,n){Ue(t,()=>ene(t,e,n)),Ue(t,()=>t.uniform1i(s,n))}function Bw(t,e,s){Ue(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,s)),Ue(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function ZT(t,e){Ue(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),Ue(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function tg(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+rne(t,e))}function rne(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function io(t,e,s){const n=Ue(t,()=>e());if(n==null)throw new Error(s);return n}function ine(t,e){const s=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+t.TEXTURE0;if(n<t.TEXTURE0||n>s){const r=`[gl.TEXTURE0, gl.TEXTURE${s}]`;throw new Error(`textureUnit must be in ${r}.`)}}function wc(t,e=2){return pe(t.slice(0,t.length-e))}function vc(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function sg(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[wc(t),...vc(t)]),e}function one(t,e=!1){let s=oe().getNumber("WEBGL_MAX_TEXTURE_SIZE"),n=oe().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");n===1/0&&oe().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(n=s/2),e&&(s=s*2,n=n*2,t=t.map((l,c)=>c>=t.length-2?u0(t[c]):t[c]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=Co(t).newShape);let r=pe(t),i=null;t.length<=1&&r<=s?i=[1,r]:t.length===2&&t[0]<=s&&t[1]<=s?i=t:t.length===3&&t[0]*t[1]<=s&&t[2]<=s?i=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=s&&t[1]*t[2]<=s?i=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=s&&t[3]<=s?i=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=s&&t[1]*t[2]*t[3]<=s&&(i=[t[0],t[1]*t[2]*t[3]]);const o=i!=null&&Math.max(...i)>n&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const l=wc(t);let c=2,d=2;t.length&&([c,d]=vc(t)),r=l*(c/2)*(d/2),i=p0(r).map(u=>u*2)}else i=p0(r);return i}function ng(t){return t%2===0}function rg(t,e){if(t=t.slice(-2),e=e.slice(-2),Ft(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const s=t[t.length-1],n=e[e.length-1];if(s===n||ng(s)&&ng(n)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&ng(t[0])&&ng(e[0])}let Uw,Vw;function ane(t){if(Uw==null){const e=qr(t);Uw=e.getParameter(e.MAX_TEXTURE_SIZE)}return Uw}function lne(t){if(Vw==null){const e=qr(t);Vw=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Vw)}function cne(t){if(t===0)return 0;let e;const s=qr(t);return wr(s,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:wr(s,"EXT_disjoint_timer_query")?e=1:e=0,e}function wr(t,e){return t.getExtension(e)!=null}function JT(t){try{if(qr(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function dne(t){if(t===0)return!1;const e=qr(t);if(t===1){if(!wr(e,"OES_texture_float"))return!1}else if(!wr(e,"EXT_color_buffer_float"))return!1;return Ww(e)}function une(t){if(t===0)return!1;const e=qr(t);if(t===1){if(!wr(e,"OES_texture_float")||!wr(e,"WEBGL_color_buffer_float"))return!1}else{if(wr(e,"EXT_color_buffer_float"))return Ww(e);const n="EXT_color_buffer_half_float";if(wr(e,n)){const r=e.getExtension(n);return hne(e,r)}return!1}return Ww(e)}function Ww(t){const e=Lw(t),s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(s),t.deleteFramebuffer(i),o}function hne(t,e){const s=Lw(t,e),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,s.internalFormatHalfFloat,1,1,0,s.textureFormatFloat,s.textureTypeHalfFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const l=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(o),l}function pne(t){return t!==2?!1:qr(t).fenceSync!=null}function th(t,e){Array.isArray(t)||(t=[t]),t.forEach(s=>{s!=null&&A(s.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ze=oe();Ze.registerFlag("HAS_WEBGL",()=>Ze.getNumber("WEBGL_VERSION")>0),Ze.registerFlag("WEBGL_VERSION",()=>JT(2)?2:JT(1)?1:0),Ze.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1),Ze.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Ze.get("WEBGL_VERSION")===2),Ze.registerFlag("WEBGL_CPU_FORWARD",()=>!0),Ze.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1),Ze.registerFlag("WEBGL_PACK",()=>Ze.getBool("HAS_WEBGL")),Ze.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Ze.getBool("WEBGL_PACK")),Ze.registerFlag("WEBGL_PACK_CLIP",()=>Ze.getBool("WEBGL_PACK")),Ze.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Ze.getBool("WEBGL_PACK")),Ze.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Ze.getBool("WEBGL_PACK")),Ze.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Ze.getBool("WEBGL_PACK")),Ze.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Ze.getBool("WEBGL_PACK")),Ze.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Ze.getBool("WEBGL_PACK")),Ze.registerFlag("WEBGL_PACK_REDUCE",()=>Ze.getBool("WEBGL_PACK")),Ze.registerFlag("WEBGL_LAZILY_UNPACK",()=>Ze.getBool("WEBGL_PACK")),Ze.registerFlag("WEBGL_CONV_IM2COL",()=>Ze.getBool("WEBGL_PACK")),Ze.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Ze.getBool("WEBGL_PACK")),Ze.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>ane(Ze.getNumber("WEBGL_VERSION"))),Ze.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>lne(Ze.getNumber("WEBGL_VERSION"))),Ze.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=Ze.getNumber("WEBGL_VERSION");return t===0?0:cne(t)}),Ze.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Ze.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!KC()),Ze.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>dne(Ze.getNumber("WEBGL_VERSION"))),Ze.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Ze.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ze.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")),Ze.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>une(Ze.getNumber("WEBGL_VERSION"))),Ze.registerFlag("WEBGL_FENCE_API_ENABLED",()=>pne(Ze.getNumber("WEBGL_VERSION"))),Ze.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Ze.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0),Ze.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)}),Ze.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>KC()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)}),Ze.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128),Ze.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1),Ze.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5),Ze.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128),Ze.registerFlag("WEBGL_EXP_CONV",()=>!1),Ze.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Ze.getBool("IS_TEST")),Ze.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0),Ze.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1),Ze.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1),Ze.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dn(){let t,e,s,n,r,i,o,l,c,d;return oe().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",s="out",n="in",r="texture",i="outputColor",o="out vec4 outputColor;",l=oe().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",c="",d=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",s="varying",n="varying",r="texture2D",i="gl_FragColor",o="",l=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,c=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,d=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:s,varyingFs:n,texture2D:r,output:i,defineOutput:o,defineSpecialNaN:l,defineSpecialInf:c,defineRound:d}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function il(t,e,s="index"){const n=tt(e);return n.map((r,i)=>{const o=`int ${t[i]} = ${s} / ${r}`,l=i===n.length-1?`int ${t[i+1]} = ${s} - ${t[i]} * ${r}`:`index -= ${t[i]} * ${r}`;return`${o}; ${l};`}).join("")}function ig(t,e,s="index"){const n=tt(e);return n.map((r,i)=>{const o=`int ${t[i]} = ${s} / outShapeStrides[${i}]`,l=i===n.length-1?`int ${t[i+1]} = ${s} - ${t[i]} * outShapeStrides[${i}]`:`index -= ${t[i]} * outShapeStrides[${i}]`;return`${o}; ${l};`}).join("")}function fne(t,e){const s=t.length,n=t.map(i=>`${e}[${i}]`),r=new Array(s-1);r[s-2]=n[s-1];for(let i=s-3;i>=0;--i)r[i]=`(${r[i+1]} * ${n[i+1]})`;return r}function mne(t,e,s="index"){const n=t.map((i,o)=>o),r=fne(n,e);return r.map((i,o)=>{const l=`int ${t[o]} = ${s} / ${r[o]}`,c=o===r.length-1?`int ${t[o+1]} = ${s} - ${t[o]} * ${r[o]}`:`index -= ${t[o]} * ${r[o]}`;return`${l}; ${c};`}).join("")}function Gw(t){const e=tt(t).map(s=>s.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function Hw(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const QT=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:eA}=o9;function gne(t,e,s){const n=[];if(t.forEach(f=>{const m=pe(f.shapeInfo.logicalShape);if(f.shapeInfo.isUniform?n.push(`uniform float ${f.name}${m>1?`[${m}]`:""};`):(n.push(`uniform sampler2D ${f.name};`),n.push(`uniform int offset${f.name};`)),s.enableShapeUniforms){const{uniformShape:b}=qw(s.packedInputs,f.shapeInfo.logicalShape,f.shapeInfo.texShape);switch(b.length){case 1:n.push(`uniform int ${f.name}Shape;`);break;case 2:n.push(`uniform ivec2 ${f.name}Shape;`);break;case 3:n.push(`uniform ivec3 ${f.name}Shape;`);break;case 4:n.push(`uniform ivec4 ${f.name}Shape;`);break}n.push(`uniform ivec2 ${f.name}TexShape;`)}}),s.enableShapeUniforms){switch(e.logicalShape.length){case 1:n.push("uniform int outShape;");break;case 2:n.push("uniform ivec2 outShape;"),n.push("uniform int outShapeStrides;");break;case 3:n.push("uniform ivec3 outShape;"),n.push("uniform ivec2 outShapeStrides;");break;case 4:n.push("uniform ivec4 outShape;"),n.push("uniform ivec3 outShapeStrides;");break}n.push("uniform ivec2 outTexShape;")}s.customUniforms&&s.customUniforms.forEach(f=>{n.push(`uniform ${f.type} ${f.name}${f.arrayIndex?`[${f.arrayIndex}]`:""};`)});const r=n.join(`
`),i=t.map(f=>xne(f,e,s.packedInputs,s.enableShapeUniforms)).join(`
`),o=e.texShape,l=dn(),c=wne(l);let d,u,h=kne(l);return e.isPacked?(d=bne(e.logicalShape,o,s.enableShapeUniforms),u=Nne(l)):(d=yne(e.logicalShape,o,s.enableShapeUniforms),u=vne(l)),s.packedInputs&&(h+=Ine),[h,c,u,r,d,i,s.userCode].join(`
`)}function Nc(t,e=!1){const s=t.shapeInfo.logicalShape;switch(s.length){case 0:return Lne(t,e);case 1:return Bne(t,e);case 2:return Vne(t,e);case 3:return Gne(t,e);case 4:return qne(t,e);case 5:return Kne(t);case 6:return Xne(t);default:throw new Error(`${s.length}-D input sampling is not yet supported`)}}function tA(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return Mne(t);case 1:return zne(t,e);case 2:return Une(t,e);case 3:return Wne(t,e);default:return Hne(t,e)}}function xne(t,e,s=!1,n){let r="";s?r+=tA(t,n):r+=Nc(t,n);const i=t.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(s?r+=Yne(t,e):r+=Zne(t,e)),r}function bne(t,e,s){switch(t.length){case 0:return sA();case 1:return Ene(t,e,s);case 2:return Fne(t,e,s);case 3:return Tne(t,e,s);default:return Dne(t,e,s)}}function yne(t,e,s){switch(t.length){case 0:return sA();case 1:return $ne(t,e,s);case 2:return One(t,e,s);case 3:return Ane(t,e,s);case 4:return _ne(t,e,s);case 5:return Rne(t,e);case 6:return Pne(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function wne(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function vne(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function Nne(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function kne(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${Cne}
    ${Sne}
    ${jne}
  `}const Cne=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Sne=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,jne=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Ine=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function sA(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function Ene(t,e,s){const n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return n[0]===1?s?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${n[1]}.0);
      }
    `:n[1]===1?s?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${n[0]}.0);
      }
    `:s?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      return 2 * (resTexRC.x * ${n[1]} + resTexRC.y);
    }
  `}function $ne(t,e,s){return e[0]===1?s?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?s?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:s?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function Tne(t,e,s){if(s)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[2]/2),i=r*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function Ane(t,e,s){if(s)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${ig(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const n=il(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${n}
      return ivec3(r, c, d);
    }
  `}function Dne(t,e,s){if(s)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),i=r*Math.ceil(t[t.length-2]/2);let o=i,l="",c="b, r, c";for(let d=2;d<t.length-1;d++)o*=t[t.length-d-1],l=`
      int b${d} = index / ${o};
      index -= b${d} * ${o};
    `+l,c=`b${d}, `+c;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      ${l}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${t.length}(${c});
    }
  `}function _ne(t,e,s){if(s)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${ig(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const n=il(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${n}
      return ivec4(r, c, d, d2);
    }
  `}function Rne(t,e){const s=il(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${s}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function Pne(t,e){const s=il(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${s}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function Fne(t,e,s){const n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Ft(t,e))return s?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${n[0]}, ${n[1]}));
      }
    `;const r=Math.ceil(t[1]/2);return s?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));

      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function One(t,e,s){return Ft(t,e)?s?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?s?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?s?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:s?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function ol(t){return`offset${t}`}function Mne(t){const e=t.name,s="get"+e.charAt(0).toUpperCase()+e.slice(1),n=dn();return`
    vec4 ${s}() {
      return ${n.texture2D}(${e}, halfCR);
    }
  `}function Lne(t,e){const s=t.name,n="get"+s.charAt(0).toUpperCase()+s.slice(1);if(t.shapeInfo.isUniform)return`float ${n}() {return ${s};}`;const[r,i]=t.shapeInfo.texShape;if(r===1&&i===1)return`
      float ${n}() {
        return sampleTexture(${s}, halfCR);
      }
    `;const o=ol(s);if(e)return`
    float ${n}() {
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], ${o});
      return sampleTexture(${s}, uv);
    }
  `;const[l,c]=t.shapeInfo.texShape;return`
    float ${n}() {
      vec2 uv = uvFromFlat(${l}, ${c}, ${o});
      return sampleTexture(${s}, uv);
    }
  `}function zne(t,e){const s=t.name,n="get"+s.charAt(0).toUpperCase()+s.slice(1),r=t.shapeInfo.texShape,i=dn();if(e)return`
    vec4 ${n}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${s}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${n}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${s}, uv);
    }
  `}function Bne(t,e){const s=t.name,n="get"+s.charAt(0).toUpperCase()+s.slice(1);if(t.shapeInfo.isUniform)return`
      float ${n}(int index) {
        ${kc(t)}
      }
    `;const r=t.shapeInfo.texShape,i=r[0],o=r[1];if(o===1&&i===1)return`
      float ${n}(int index) {
        return sampleTexture(${s}, halfCR);
      }
    `;const l=ol(s);return o===1?e?`
      float ${n}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${l}) + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${n}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${l}) + 0.5) / ${i}.0);
        return sampleTexture(${s}, uv);
      }
    `:i===1?e?`
      float ${n}(int index) {
        vec2 uv = vec2((float(index + ${l}) + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${n}(int index) {
        vec2 uv = vec2((float(index + ${l}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${s}, uv);
      }
    `:e?`
    float ${n}(int index) {
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${l});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${n}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${l});
      return sampleTexture(${s}, uv);
    }
  `}function Une(t,e){const s=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,o=i[0],l=i[1],c=dn();if(i!=null&&Ft(s,i))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${n}TexShape[1], ${n}TexShape[0]);

        return ${c.texture2D}(${n}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${l}.0, ${o}.0);

        return ${c.texture2D}(${n}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${n}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${c.texture2D}(${n}, uv);
    }
  `;const d=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],u=Math.ceil(s[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${u}, ${d[0]}, ${d[1]}, row, col);
      return ${c.texture2D}(${n}, uv);
    }
  `}function Vne(t,e){const s=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape;if(i!=null&&Ft(s,i)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `;const p=i[0],f=i[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${f}.0, ${p}.0);
      return sampleTexture(${n}, uv);
    }
  `}const{newShape:o,keptDims:l}=Co(s),c=o;if(c.length<s.length){const p=Cc(t,c),f=["row","col"];return`
      ${Nc(p,e)}
      float ${r}(int row, int col) {
        return ${r}(${Sc(f,l)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${s[1]}, 1)));
        ${kc(t)}
      }
    `;const d=i[0],u=i[1],h=ol(n);return u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${n}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${s[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${d}.0);
      return sampleTexture(${n}, uv);
    }
  `:d===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${h}), vec3(${n}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${h}), vec3(${s[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);
      return sampleTexture(${n}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${n}Shape[1] + col + ${h};
        vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index);
        return sampleTexture(${n}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${s[1]} + col + ${h};
    vec2 uv = uvFromFlat(${d}, ${u}, index);
    return sampleTexture(${n}, uv);
  }
`}function Wne(t,e){const s=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(s[0]===1){const p=s.slice(1),f=[1,2],m=Cc(t,p),b=["b","row","col"];return`
        ${tA(m,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Sc(b,f)});
        }
      `}const l=dn();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${n}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${l.texture2D}(${n}, uv);
    }
  `;const c=o[0],d=o[1],u=Math.ceil(s[2]/2),h=u*Math.ceil(s[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${c}, ${d}, ${h}, ${u}, b, row, col);
      return ${l.texture2D}(${n}, uv);
    }
  `}function Gne(t,e){const s=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=s[1]*s[2],o=s[2],{newShape:l,keptDims:c}=Co(s),d=l;if(d.length<s.length){const b=Cc(t,d),g=["row","col","depth"];return`
        ${Nc(b,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Sc(g,c)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${kc(t)}
      }
    `;const u=t.shapeInfo.texShape,h=u[0],p=u[1],f=t.shapeInfo.flatOffset;if(p===i&&f==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${n}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${p}.0, ${h}.0);
          return sampleTexture(${n}, uv);
        }
      `;if(p===o&&f==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${n}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${s[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${h}.0);
      return sampleTexture(${n}, uv);
    }
  `;const m=ol(n);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${n}Shape[1] * ${n}Shape[2];
      int stride1 = ${n}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${m};
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index);
      return sampleTexture(${n}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${m};
        vec2 uv = uvFromFlat(${h}, ${p}, index);
        return sampleTexture(${n}, uv);
      }
  `}function Hne(t,e){const s=t.name,n="get"+s.charAt(0).toUpperCase()+s.slice(1),r=dn();if(e)return`
    vec4 ${n}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${s}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${s}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${s}, uv);
    }
  `;const i=t.shapeInfo.logicalShape,o=i.length,l=t.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],d=c[0],u=c[1],h=Math.ceil(i[o-1]/2);let p=h*Math.ceil(i[o-2]/2),f="int b, int row, int col",m=`b * ${p} + (row / 2) * ${h} + (col / 2)`;for(let b=2;b<o-1;b++)f=`int b${b}, `+f,p*=i[o-b-1],m=`b${b} * ${p} + `+m;return`
    vec4 ${n}(${f}) {
      int index = ${m};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${d});
      return ${r.texture2D}(${s}, uv);
    }
  `}function qne(t,e){const s=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=s[3],o=s[2]*i,l=s[1]*o,{newShape:c,keptDims:d}=Co(s);if(c.length<s.length){const y=Cc(t,c),w=["row","col","depth","depth2"];return`
      ${Nc(y,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Sc(w,d)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${l}, ${o}, ${i}, 1)));
        ${kc(t)}
      }
    `;const u=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,p=h[0],f=h[1],m=`int stride2 = ${n}Shape[3];`,b=`int stride1 = ${n}Shape[2] * stride2;`,g=`int stride0 = ${n}Shape[1] * stride1;`;if(f===l&&u==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${m}
        ${b}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(f===i&&u==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n}Shape[1] * ${n}Shape[2], ${n}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s[1]*s[2]}, ${s[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${n}, uv);
      }
    `;const x=ol(n);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${m}
      ${b}
      ${g}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${x});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${l} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${p}, ${f}, index + ${x});
      return sampleTexture(${n}, uv);
    }
  `}function Kne(t){const e=t.shapeInfo.logicalShape,s=t.name,n="get"+s.charAt(0).toUpperCase()+s.slice(1),r=e[4],i=e[3]*r,o=e[2]*i,l=e[1]*o,{newShape:c,keptDims:d}=Co(e);if(c.length<e.length){const b=Cc(t,c),g=["row","col","depth","depth2","depth3"];return`
      ${Nc(b)}
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        return ${n}(${Sc(g,d)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${l}, ${o}, ${i}, ${r})) +
          depth3;
        ${kc(t)}
      }
    `;const u=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,p=h[0],f=h[1];if(f===l&&u==null)return`
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(f===r&&u==null)return`
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;const m=ol(s);return`
    float ${n}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${l} + col * ${o} + depth * ${i} +
          depth2 * ${r} + depth3 + ${m};
      vec2 uv = uvFromFlat(${p}, ${f}, index);
      return sampleTexture(${s}, uv);
    }
  `}function Xne(t){const e=t.shapeInfo.logicalShape,s=t.name,n="get"+s.charAt(0).toUpperCase()+s.slice(1),{newShape:r,keptDims:i}=Co(e);if(r.length<e.length){const g=Cc(t,r),x=["row","col","depth","depth2","depth3","depth4"];return`
      ${Nc(g)}
      float ${n}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${n}(${Sc(x,i)});
      }
    `}const o=e[5],l=e[4]*o,c=e[3]*l,d=e[2]*c,u=e[1]*d;if(t.shapeInfo.isUniform)return`
      float ${n}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${d}, ${c}, ${l})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${kc(t)}
      }
    `;const h=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,f=p[0],m=p[1];if(m===u&&h==null)return`
      float ${n}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${d}, ${c}, ${l}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(m===o&&h==null)return`
      float ${n}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${f}.0);
        return sampleTexture(${s}, uv);
      }
    `;const b=ol(s);return`
    float ${n}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${d} + depth * ${c} +
          depth2 * ${l} + depth3 * ${o} + depth4 + ${b};
      vec2 uv = uvFromFlat(${f}, ${m}, index);
      return sampleTexture(${s}, uv);
    }
  `}function kc(t){const e=t.name,s=pe(t.shapeInfo.logicalShape);return s<2?`return ${e};`:`
    for (int i = 0; i < ${s}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function Yne(t,e){const s=t.name,n=s.charAt(0).toUpperCase()+s.slice(1),r="get"+n+"AtOutCoords",i=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,l=eA(t.shapeInfo.logicalShape,e.logicalShape),c=Ht(o),d=o-i;let u;const h=["x","y","z","w","u","v"];i===0?u="":o<2&&l.length>=1?u="coords = 0;":u=l.map(y=>`coords.${h[y+d]} = 0;`).join(`
`);let p="";o<2&&i>0?p="coords":p=t.shapeInfo.logicalShape.map((y,w)=>`coords.${h[w+d]}`).join(", ");let f="return outputValue;";const b=pe(t.shapeInfo.logicalShape)===1,x=pe(e.logicalShape)===1;if(i===1&&!b&&!x)f=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(b&&!x)o===1?f=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:f=`
        return vec4(outputValue.x);
      `;else if(l.length){const y=i-2,w=i-1;l.indexOf(y)>-1&&l.indexOf(w)>-1?f="return vec4(outputValue.x);":l.indexOf(y)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":l.indexOf(w)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${c} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${n}(${p});
      ${f}
    }
  `}function Zne(t,e){const s=t.name,n=s.charAt(0).toUpperCase()+s.slice(1),r="get"+n+"AtOutCoords",i=e.texShape,o=t.shapeInfo.texShape,l=t.shapeInfo.logicalShape.length,c=e.logicalShape.length;if(!t.shapeInfo.isUniform&&l===c&&t.shapeInfo.flatOffset==null&&Ft(o,i))return`
      float ${r}() {
        return sampleTexture(${s}, resultUV);
      }
    `;const d=Ht(c),u=eA(t.shapeInfo.logicalShape,e.logicalShape),h=c-l;let p;const f=["x","y","z","w","u","v"];l===0?p="":c<2&&u.length>=1?p="coords = 0;":p=u.map(b=>`coords.${f[b+h]} = 0;`).join(`
`);let m="";return c<2&&l>0?m="coords":m=t.shapeInfo.logicalShape.map((b,g)=>`coords.${f[g+h]}`).join(", "),`
    float ${r}() {
      ${d} coords = getOutputCoords();
      ${p}
      return get${n}(${m});
    }
  `}function Ht(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function qw(t,e,s){const{newShape:n,keptDims:r}=Co(e),i=e.length,o=t&&i===3&&e[0]===1,l=o?e.slice(1):n,c=!t&&i>1&&!Ft(e,s)&&n.length<i||o;return{useSqueezeShape:c,uniformShape:c?l:e,keptDims:r}}function Cc(t,e){const s=JSON.parse(JSON.stringify(t));return s.shapeInfo.logicalShape=e,s}function Sc(t,e){return e.map(s=>t[s]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jne(t,e,s,n){const r=s.map((u,h)=>{const p={logicalShape:u.shape,texShape:u.isUniform?null:u.texData.texShape,isUniform:u.isUniform,isPacked:u.isUniform?!1:u.texData.isPacked,flatOffset:null};return u.texData!=null&&u.texData.slice!=null&&u.texData.slice.flatOffset>0&&(p.flatOffset=u.texData.slice.flatOffset),{name:e.variableNames[h],shapeInfo:p}}),i=r.map(u=>u.shapeInfo),o={logicalShape:n.shape,texShape:n.texData.texShape,isUniform:!1,isPacked:n.texData.isPacked,flatOffset:null},l=gne(r,o,e),c=Gse(t.gl,l),d=t.createProgram(c);return oe().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:c,source:l,webGLProgram:d,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(d),Object.assign({program:e,fragmentShader:c,source:l,webGLProgram:d,inShapeInfos:i,outShapeInfo:o},nA(t,e,d)))}function nA(t,e,s){const n=[],r=[];let i,o,l,c=null,d=null;d=t.getUniformLocation(s,"NAN",!1),oe().getNumber("WEBGL_VERSION")===1&&(c=t.getUniformLocation(s,"INFINITY",!1));const u=!1;for(const h of e.variableNames){const p={name:h,uniform:t.getUniformLocation(s,h,u),offset:t.getUniformLocation(s,`offset${h}`,u)};e.enableShapeUniforms&&(p.shape=t.getUniformLocation(s,`${h}Shape`,u),p.texShape=t.getUniformLocation(s,`${h}TexShape`,u)),n.push(p)}if(e.enableShapeUniforms&&(i=t.getUniformLocation(s,"outShape",u),l=t.getUniformLocation(s,"outShapeStrides",u),o=t.getUniformLocation(s,"outTexShape",u)),e.customUniforms)for(const h of e.customUniforms)r.push(t.getUniformLocation(s,h.name,u));return{variablesLocations:n,customUniformLocations:r,infLoc:c,nanLoc:d,outShapeLocation:i,outShapeStridesLocation:l,outTexShapeLocation:o}}function rA(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((s,n)=>{const r=s.logicalShape,i=e[n],o=i.shape;if(!Ft(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(s.isUniform&&i.isUniform)return;const l=s.texShape,c=i.isUniform?null:i.texData.texShape;if(!Ft(l,c))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${l} and ${c} must match`)})}function Qne(t,e,s,n,r){e.program.enableShapeUniforms||(rA(e.inShapeInfos,s),rA([e.outShapeInfo],[n]));const i=n.texData.texture,o=n.texData.texShape;n.texData.isPacked?t.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):t.setOutputMatrixTexture(i.texture,o[0],o[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),oe().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let c=0;c<s.length;++c){const d=s[c],{uniform:u,offset:h,shape:p,texShape:f}=e.variablesLocations[c];if(p){const{uniformShape:m}=qw(e.program.packedInputs,d.shape,d.texData.texShape);switch(m.length){case 1:t.gl.uniform1iv(p,new Int32Array(m));break;case 2:t.gl.uniform2iv(p,new Int32Array(m));break;case 3:t.gl.uniform3iv(p,new Int32Array(m));break;case 4:t.gl.uniform4iv(p,new Int32Array(m));break}}if(f&&t.gl.uniform2i(f,d.texData.texShape[0],d.texData.texShape[1]),u!=null){if(d.isUniform){if(pe(d.shape)<2)t.gl.uniform1f(u,d.uniformValues[0]);else{let m=d.uniformValues;m instanceof Float32Array||(m=new Float32Array(m)),t.gl.uniform1fv(u,m)}continue}d.texData.slice!=null&&h!=null&&t.gl.uniform1i(h,d.texData.slice.flatOffset),t.setInputMatrixTexture(d.texData.texture.texture,u,c)}}const l=e.outShapeLocation;if(l)switch(n.shape.length){case 1:t.gl.uniform1iv(l,new Int32Array(n.shape));break;case 2:t.gl.uniform2iv(l,new Int32Array(n.shape));break;case 3:t.gl.uniform3iv(l,new Int32Array(n.shape));break;case 4:t.gl.uniform4iv(l,new Int32Array(n.shape));break}if(e.outShapeStridesLocation){const c=tt(n.shape);switch(n.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(c));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(c));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(c));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,n.texData.texShape[0],n.texData.texShape[1]),e.program.customUniforms&&r)for(let c=0;c<e.program.customUniforms.length;++c){const d=e.program.customUniforms[c],u=e.customUniformLocations[c],h=r[c];if(d.type==="float")t.gl.uniform1fv(u,h);else if(d.type==="vec2")t.gl.uniform2fv(u,h);else if(d.type==="vec3")t.gl.uniform3fv(u,h);else if(d.type==="vec4")t.gl.uniform4fv(u,h);else if(d.type==="int")t.gl.uniform1iv(u,h);else if(d.type==="ivec2")t.gl.uniform2iv(u,h);else if(d.type==="ivec3")t.gl.uniform3iv(u,h);else if(d.type==="ivec4")t.gl.uniform4iv(u,h);else throw Error(`uniform type ${d.type} is not supported yet.`)}t.executeProgram()}function ere(t,e,s){let n="";e.concat(s).forEach(o=>{const l=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!o.isUniform){const c=o.texData.texShape,{useSqueezeShape:d,uniformShape:u,keptDims:h}=qw(t.packedInputs,o.shape,c);let p="",f="",m="";if(u.length===1&&t.packedInputs){const N=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];p=`${N[0]>1}_${N[1]>1}`}else if(u.length===2&&!t.packedInputs)f=`${u[0]>1}_${u[1]>1}`;else if(u.length>2&&!t.packedInputs){const N=tt(u);m=`${N[0]===c[1]}_${N[N.length-1]===c[1]}`}const b=o.shape.length,g=u.length===2&&Ft(o.shape,c),x=pe(o.shape)===1,y=rc(o.shape,s.shape),w=!t.packedInputs&&b===s.shape.length&&Ft(c,s.texData.texShape),v=t.packedInputs||u.length>2?"":`${c[0]>1}_${c[1]>1}`;n+=`${b}_${w}_${d?h:""}_${u.length}_${x}_${y}_${g}_${p}_${f}_${m}_${v}_${l}`}else{const c=o.isUniform?"uniform":o.texData.texShape;n+=`${o.shape}_${c}_${l}`}});const r=t.userCode;let i=t.constructor.name;return i+="_"+n+"_"+r+`${oe().getNumber("WEBGL_VERSION")}`,i}function sn(t){return oe().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tre{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Qu.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=dn();this.outputShape=e,this.enableShapeUniforms=sn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?ig(["r","c","d"],e):il(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${s.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sre{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Qu.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=dn();this.outputShape=e,this.enableShapeUniforms=sn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?ig(["r","c","d"],e):il(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${s.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nre{constructor(e){this.variableNames=["A"],this.outTexUsage=Yn.DOWNLOAD;const s=dn();this.outputShape=e,this.userCode=`
      ${QT}

      void main() {
        float x = getAAtOutCoords();
        ${s.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rre{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Yn.DOWNLOAD;const s=dn();this.outputShape=e,this.userCode=`
      ${QT}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${s.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ire={R:0,G:1,B:2,A:3};class iA{constructor(e,s=!1,n="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=dn();this.outputShape=e,this.enableShapeUniforms=sn(this.outputShape.length);let i="result";s&&(i="floor(result * 255. + 0.5)");let o="";for(let l=0;l<n.length;l++){const c=n[l];o+=`
          if(offset == ${l}) {
            result = values[${ire[c]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?Hw():Gw(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${n.length});

        flatIndex = idiv(flatIndex, ${n.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ore{constructor(e,s=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=dn();this.outputShape=e,this.enableShapeUniforms=sn(this.outputShape.length);let r="",i="result";s&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let l=0;l<=1;l++){const c=o*2+l;r+=`
          localCoords = coords;
          if(localCoords[2] + ${l} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${l};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${n.texture2D}(A, uv);

            if (offset == 0) {
              result[${c}] = values[0];
            } else if (offset == 1) {
              result[${c}] = values[1];
            } else if (offset == 2) {
              result[${c}] = values[2];
            } else {
              result[${c}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?Hw():Gw(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${n.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function are(t){const e=dn(),s=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return Wse(t,s)}function lre(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return Xse(t,e)}function cre(t){const e=new Uint16Array([0,1,2,2,1,3]);return Yse(t,e)}function sh(t,e,s,n,r,i){Jse(e,s);const o=Zse(t),l=t.TEXTURE_2D;return Ue(t,()=>t.bindTexture(l,o)),Ue(t,()=>t.texParameteri(l,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),Ue(t,()=>t.texParameteri(l,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),Ue(t,()=>t.texParameteri(l,t.TEXTURE_MIN_FILTER,t.NEAREST)),Ue(t,()=>t.texParameteri(l,t.TEXTURE_MAG_FILTER,t.NEAREST)),oe().getNumber("WEBGL_VERSION")===1?Ue(t,()=>t.texImage2D(l,0,n,e,s,0,r,i,null)):Ue(t,()=>t.texStorage2D(l,1,n,e,s)),Ue(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:o,texShape:[s,e]}}function oA(t){return t.internalFormatFloat}function dre(t,e,s,n){const[r,i]=eh(e,s);return sh(t,r,i,oA(n),n.textureFormatFloat,t.FLOAT)}function aA(t){return t.internalFormatHalfFloat}function ure(t,e,s,n){const[r,i]=eh(e,s);return sh(t,r,i,aA(n),n.textureFormatFloat,n.textureTypeHalfFloat)}function lA(t){return t.downloadTextureFormat}function hre(t,e,s,n){const[r,i]=eh(e,s);return sh(t,r,i,lA(n),t.RGBA,t.UNSIGNED_BYTE)}function cA(t){return t.internalFormatPackedFloat}function pre(t,e,s,n){const[r,i]=yc(e,s);return sh(t,r,i,cA(n),t.RGBA,t.FLOAT)}function dA(t){return t.internalFormatPackedHalfFloat}function fre(t,e,s,n){const[r,i]=yc(e,s);return sh(t,r,i,dA(n),t.RGBA,n.textureTypeHalfFloat)}function mre(t,e,s){return Ue(t,()=>t.bindBuffer(t.ARRAY_BUFFER,s)),YT(t,e,"clipSpacePos",s,3,20,0)&&YT(t,e,"uv",s,2,20,12)}function gre(t,e,s,n,r,i){Ue(t,()=>t.bindTexture(t.TEXTURE_2D,e));let o,l,c;r instanceof Uint8Array?(o=new Uint8Array(s*n*4),l=t.UNSIGNED_BYTE,c=t.RGBA):(o=new Float32Array(s*n*4),l=t.FLOAT,c=i.internalFormatPackedFloat),o.set(r),oe().getNumber("WEBGL_VERSION")===2?Ue(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,s,n,t.RGBA,l,o)):Ue(t,()=>t.texImage2D(t.TEXTURE_2D,0,c,s,n,0,t.RGBA,l,o)),Ue(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function xre(t,e,s){Ue(t,()=>t.bindTexture(t.TEXTURE_2D,e)),s.data instanceof Uint8Array?oe().getNumber("WEBGL_VERSION")===2?Ue(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,s.width,s.height,t.RGBA,t.UNSIGNED_BYTE,s.data)):Ue(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,s.width,s.height,0,t.RGBA,t.UNSIGNED_BYTE,s.data)):oe().getNumber("WEBGL_VERSION")===2?Ue(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,s)):Ue(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,s)),Ue(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function bre(t,e,s,n){const r=t.createBuffer();Ue(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,r));const l=4*4*e*s;return Ue(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,l,t.STREAM_READ)),Ue(t,()=>t.readPixels(0,0,s,e,t.RGBA,t.FLOAT,0)),Ue(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),r}function yre(t,e,s){const n=t,r=new Float32Array(s);return n.bindBuffer(n.PIXEL_PACK_BUFFER,e),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,r),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),r}function wre(t,e,s,n){const[r,i]=eh(e,s),o=4,l=new Uint8Array(Ose(e*s,o));return Ue(t,()=>t.readPixels(0,0,r,i,n.downloadTextureFormat,t.UNSIGNED_BYTE,l)),new Float32Array(l.buffer)}function vre(t,e,s,n,r,i,o,l){const c=t,d=new Float32Array(Mse(i,o));return c.bindBuffer(c.PIXEL_PACK_BUFFER,e),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,d),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),d}function Nre(t,e,s){const n=new Float32Array(e*s*4);return Ue(t,()=>t.readPixels(0,0,s,e,t.RGBA,t.FLOAT,n)),n}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kw{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const s=oe().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,Rse(s,e)):this.gl=qr(s),e=this.gl,oe().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>Ue(i,()=>i.createVertexArray()),this.bindVertexArray=o=>Ue(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>Ue(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>Ue(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Ue(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>Ue(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>Ue(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>Ue(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let n="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),oe().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=eg(this.gl,i),wr(this.gl,o))this.textureHalfFloatExtension=eg(this.gl,o);else if(oe().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),wr(this.gl,r))this.colorBufferHalfFloatExtension=eg(this.gl,r);else if(oe().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",wr(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else if(wr(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=lre(this.gl),this.indexBuffer=cre(this.gl),this.framebuffer=Qse(this.gl),this.textureConfig=Lw(this.gl,this.textureHalfFloatExtension)}get debug(){return oe().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Ue(e,()=>e.finish()),Ue(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Ue(e,()=>e.deleteFramebuffer(this.framebuffer)),Ue(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Ue(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Ue(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,s){return this.throwIfDisposed(),dre(this.gl,e,s,this.textureConfig)}createFloat16MatrixTexture(e,s){return this.throwIfDisposed(),ure(this.gl,e,s,this.textureConfig)}createUnsignedBytesMatrixTexture(e,s){return this.throwIfDisposed(),hre(this.gl,e,s,this.textureConfig)}uploadPixelDataToTexture(e,s){this.throwIfDisposed(),xre(this.gl,e,s)}uploadDenseMatrixToTexture(e,s,n,r){this.throwIfDisposed(),gre(this.gl,e,s,n,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,s){return this.throwIfDisposed(),fre(this.gl,e,s,this.textureConfig)}createPackedMatrixTexture(e,s){return this.throwIfDisposed(),pre(this.gl,e,s,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(ZT(this.gl,this.framebuffer),this.outputTexture=null),Ue(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,s,n){return this.downloadMatrixDriver(e,()=>wre(this.gl,s,n,this.textureConfig))}downloadPackedMatrixFromBuffer(e,s,n,r,i,o){return vre(this.gl,e,s,n,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,s){return yre(this.gl,e,s)}createBufferFromTexture(e,s,n){this.bindTextureToFrameBuffer(e);const r=bre(this.gl,s,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let s,n;if(oe().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{const o=r.clientWaitSync(i,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},s=i}else oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(s=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(s,oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:s,isFencePassed:n}}downloadMatrixFromPackedTexture(e,s,n){return this.downloadMatrixDriver(e,()=>Nre(this.gl,s,n))}createProgram(e){this.throwIfDisposed();const s=this.gl;this.vertexShader==null&&(this.vertexShader=are(s));const n=qse(s);Ue(s,()=>s.attachShader(n,this.vertexShader)),Ue(s,()=>s.attachShader(n,e)),Kse(s,n);const r=Object.assign(n,{vao:this.createVertexArray()});return this.debug&&zw(s,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const s=this.gl;Ue(s,()=>s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),mre(s,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Ue(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&zw(this.gl,this.program),Ue(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,s,n=!0){return this.throwIfDisposed(),n?tne(this.gl,e,s):sne(this.gl,e,s)}getAttributeLocation(e,s){return this.throwIfDisposed(),Ue(this.gl,()=>this.gl.getAttribLocation(e,s))}getUniformLocationNoThrow(e,s){return this.throwIfDisposed(),this.gl.getUniformLocation(e,s)}setInputMatrixTexture(e,s,n){this.throwIfDisposed(),this.throwIfNoProgram(),nne(this.gl,e,s,n)}setOutputMatrixTexture(e,s,n){this.setOutputMatrixTextureDriver(e,n,s)}setOutputPackedMatrixTexture(e,s,n){this.throwIfDisposed();const[r,i]=yc(s,n);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,s,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,s)}setOutputPackedMatrixWriteRegion(e,s,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&zw(this.gl,this.program),tg(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const s=this.getVertexArray();console.assert(s===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Ue(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Ue(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=eg(this.gl,oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=n.createQuery();return n.beginQuery(r.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),s=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,s),s}endQuery(){if(oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,n=this.getQueryTimerExtensionWebGL2();s.endQuery(n.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await Wk(()=>this.disposed||this.isQueryAvailable(e,oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,s){if(s===0)return null;if(s===2){const n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}else{const n=this.getQueryTimerExtensionWebGL1();return n.getQueryObjectEXT(e,n.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,s){if(s===0)return!0;if(s===2){const n=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const n=this.getQueryTimerExtensionWebGL1(),r=n.getQueryObjectEXT(e,n.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(s=>{this.addItemToPoll(()=>e.isFencePassed(),()=>s())})}pollItems(){const e=kre(this.itemsToPoll.map(s=>s.isDoneFn));for(let s=0;s<=e;++s){const{resolveFn:n}=this.itemsToPoll[s];n()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,s){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:s}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in oe().platform&&(n=oe().platform.setTimeoutCustom.bind(oe().platform)),Wk(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,n)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),Bw(this.gl,e,this.framebuffer),this.debug&&tg(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(Bw(this.gl,this.outputTexture,this.framebuffer),this.debug&&tg(this.gl)):ZT(this.gl,this.framebuffer)}downloadMatrixDriver(e,s){this.bindTextureToFrameBuffer(e);const n=s();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,s,n){this.throwIfDisposed();const r=this.gl;Bw(r,e,this.framebuffer),this.debug&&tg(r),this.outputTexture=e,Ue(r,()=>r.viewport(0,0,s,n)),Ue(r,()=>r.scissor(0,0,s,n))}setOutputMatrixWriteRegionDriver(e,s,n,r){this.throwIfDisposed(),Ue(this.gl,()=>this.gl.scissor(e,s,n,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function kre(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:Cre,bincountImpl:uA,bincountReduceImpl:Sre,bitwiseAndImpl:jre,castImpl:Ire,ceilImpl:Ere,concatImpl:$re,equalImpl:Tre,expImpl:Are,expm1Impl:Dre,floorImpl:_re,gatherNdImpl:Rre,gatherV2Impl:Pre,greaterImpl:Fre,greaterEqualImpl:Ore,lessImpl:Mre,lessEqualImpl:Lre,linSpaceImpl:zre,logImpl:Bre,maxImpl:Ure,maximumImpl:Vre,minimumImpl:Wre,multiplyImpl:Gre,negImpl:Hre,notEqualImpl:qre,prodImpl:Kre,raggedGatherImpl:Xre,raggedRangeImpl:Yre,raggedTensorToTensorImpl:Zre,rangeImpl:Jre,rsqrtImpl:Qre,scatterImpl:eie,sigmoidImpl:tie,simpleAbsImpl:hA,sliceImpl:sie,sparseFillEmptyRowsImpl:nie,sparseReshapeImpl:rie,sparseSegmentReductionImpl:pA,sqrtImpl:iie,staticRegexReplaceImpl:oie,stridedSliceImpl:aie,stringNGramsImpl:lie,stringSplitImpl:cie,stringToHashBucketFastImpl:die,subImpl:uie,tileImpl:hie,topKImpl:pie,transposeImpl:Xw,uniqueImpl:fie}=yZ;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fA(t,e){return["x","y","z","w","u","v"].slice(0,e).map(s=>`${t}.${s}`)}function un(t,e){return e===1?[t]:fA(t,e)}function mie(t,e){if(t===1)return"rc";let s="";for(let n=0;n<t;n++)s+=e[n],n<t-1&&(s+=",");return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gie{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=sn(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const s=un("rc",this.rank),n=Ht(this.rank),r=this.getOutOfBoundsCondition(s),i=this.getSetup(s),o=this.getOutput(s);this.userCode=`
        void main() {
          ${n} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const s=[];for(let n=0;n<=1;n++)for(let r=0;r<=1;r++){let i=`${n===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;s.push(i)}return s}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let s="";for(let n=this.rank-2;n<this.rank;n++)s+=`${e[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(s+="||");return s}getSetup(e){if(this.rank===1)return"";const s=e.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${s[0]};
      int c = ${s[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${n};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const s=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${s[0]}),
            cEdge ? 0. : getA(${s[1]}),
            rEdge ? 0. : getA(${s[2]}),
            rEdge || cEdge ? 0. : getA(${s[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mA{constructor(e,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=sn(this.outputShape.length);let n="";for(let r=0;r<4;r++){let i="thisRC = rc;";r%2===1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),n+=`
        ${i}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${xie(s,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?Hw():Gw(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${n}

        setOutput(result);
      }
    `}}function xie(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?mne(["r","c","d"],"inputShape"):il(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bie{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,s,n){const r=xA(s,n),i=bA(e,r,n);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=gA(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const c=this.freeTextures[i].pop();return this.usedTextures[i].push(c),c}let l;return r===Gs.PACKED_2X2_FLOAT32?l=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Gs.PACKED_2X2_FLOAT16?l=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Gs.UNPACKED_FLOAT32?l=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Gs.UNPACKED_FLOAT16?l=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Gs.PACKED_4X1_UNSIGNED_BYTE&&(l=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(l),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),l}releaseTexture(e,s,n,r){if(this.freeTextures==null)return;const i=xA(n,r),o=bA(s,i,r);o in this.freeTextures||(this.freeTextures[o]=[]);const l=gA(s,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),c=oe().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");c!==-1&&this._numBytesAllocated>c?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=l):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=l),this.numUsedTextures--;const d=this.usedTextures[o],u=d&&d.indexOf(e);if(u==null||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");d[u]=d[d.length-1],d.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const s=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*s)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(s=>{this.gpgpu.deleteMatrixTexture(s.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(s=>{this.gpgpu.deleteMatrixTexture(s.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function yie(t,e){const s=t;if(e===s.R32F)return 4;if(e===s.R16F)return 2;if(e===s.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===s.RGBA16F)return 8;if(e===s.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function gA(t,e,s,n,r){const i=wie(e,n);let o;if(r){const[c,d]=yc(t[0],t[1]);o=c*d}else{const[c,d]=eh(t[0],t[1]);o=c*d}const l=yie(s,i);return o*l}function wie(t,e){switch(t){case Gs.PACKED_2X2_FLOAT32:return cA(e);case Gs.PACKED_2X2_FLOAT16:return dA(e);case Gs.UNPACKED_FLOAT32:return oA(e);case Gs.UNPACKED_FLOAT16:return aA(e);case Gs.PACKED_4X1_UNSIGNED_BYTE:return lA(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function vie(t){return oe().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Gs.PACKED_2X2_FLOAT32:Gs.UNPACKED_FLOAT32:t?Gs.PACKED_2X2_FLOAT16:Gs.UNPACKED_FLOAT16}function xA(t,e){if(t===Yn.UPLOAD)return Gs.PACKED_2X2_FLOAT32;if(t===Yn.RENDER||t==null)return vie(e);if(t===Yn.DOWNLOAD||t===Yn.PIXELS)return Gs.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function bA(t,e,s){return`${t[0]}_${t[1]}_${e}_${s}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ki{constructor(e,s){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=sn(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${s}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const vr="if (isnan(x)) return x;",Nie="return x;",yA="return abs(x);",kie="return (x >= 0.0) ? x : (exp(x) - 1.0);",Cie=vr+`
  return (x < 0.0) ? 0.0 : x;
`,Sie=vr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Ho="return x;",jie="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iie="return x;",Eie=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,$ie=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Tie=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Aie="return 1.0 / (1.0 + exp(-1.0 * x));";class qo{constructor(e,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=sn(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${s}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Die{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=sn(this.outputShape.length);const s=e.length,n=un("rc",s),r=Ht(s),i=mie(s,n),o=n.slice(-2),l=s<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${l}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ie=US,Rie=1e-7,Pie=1e-4,og={};function Fie(t){return t in og||(og[t]={}),og[t]}const Oie=oe().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Mie=600;function Lie(){return oe().global.screen==null?1024:oe().global.screen.height*oe().global.screen.width*window.devicePixelRatio*Mie/1024/1024}class ag extends d0{nextDataId(){return ag.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!oe().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let s;if(e!=null){if(e instanceof Kw)s=e;else{const n=qr(oe().getNumber("WEBGL_VERSION"),e);s=new Kw(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const n=qr(oe().getNumber("WEBGL_VERSION"));s=new Kw(n),this.binaryCache=Fie(oe().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=s,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new bie(this.gpgpu),this.numMBBeforeWarning=Lie(),this.texData=new Uk(this,ai())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,s,n,r,i,o){const l=this.makeTensorInfo(s,n),c=this.texData.get(l.dataId);c.isPacked=!1,c.texture={texture:e,texShape:[r,i]},c.texShape=[r,i];const d=sg(s),u=new iA(d,!1,o),h=this.runWebGLProgram(u,[l],n,[[r,i]]);return h.shape=s,c.texture=null,this.disposeIntermediateTensorInfo(l),h.dataId}write(e,s,n){if((oe().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||oe().getBool("DEBUG"))&&this.checkNumericalProblems(e),n==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:s,dtype:n,values:e,usage:Yn.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const s=this.texData.get(e);s.refCount++}decRef(e){if(this.texData.has(e)){const s=this.texData.get(e);s.refCount--}}move(e,s,n,r,i){if(oe().getBool("DEBUG")&&this.checkNumericalProblems(s),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:s,usage:Yn.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const s=this.texData.get(e),{values:n,dtype:r,complexTensorInfos:i,slice:o,shape:l,isPacked:c}=s;if(o!=null){let p;c?p=new qo(l,Ho):p=new ki(l,Ho);const f=this.runWebGLProgram(p,[{dataId:e,shape:l,dtype:r}],r),m=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),m}if(n!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return n;const d=this.activeTimers!=null;let u;d&&(u=yn());let h;if(r==="complex64"){const p=this.readSync(i.real.dataId),f=this.readSync(i.imag.dataId);h=so(p,f)}else h=this.getValuesFromTexture(e);return d&&(this.downloadWaitMs+=yn()-u),this.convertAndCacheOnCPU(e,h)}async read(e){if(this.pendingRead.has(e)){const m=this.pendingRead.get(e);return new Promise(b=>m.push(b))}const s=this.texData.get(e),{values:n,shape:r,slice:i,dtype:o,complexTensorInfos:l,isPacked:c}=s;if(i!=null){let m;c?m=new qo(r,Ho):m=new ki(r,Ho);const b=this.runWebGLProgram(m,[{dataId:e,shape:r,dtype:o}],o),g=this.read(b.dataId);return this.disposeIntermediateTensorInfo(b),g}if(n!=null)return this.convertAndCacheOnCPU(e);if(oe().getBool("DEBUG")&&!oe().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&oe().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let d=null,u;if(o!=="complex64"&&oe().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(e);const m=this.texData.get(u.dataId);d=this.gpgpu.createBufferFromTexture(m.texture.texture,...Qm(r))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let h;if(o==="complex64"){const m=await Promise.all([this.read(l.real.dataId),this.read(l.imag.dataId)]),b=m[0],g=m[1];h=so(b,g)}else if(d==null)h=this.getValuesFromTexture(e);else{const m=pe(r);h=this.gpgpu.downloadFloat32MatrixFromBuffer(d,m)}if(u!=null&&this.disposeIntermediateTensorInfo(u),d!=null){const m=this.gpgpu.gl;Ue(m,()=>m.deleteBuffer(d))}const p=this.convertAndCacheOnCPU(e,h),f=this.pendingRead.get(e);return this.pendingRead.delete(e),f.forEach(m=>m(p)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&ai().removeDataId(e,this),this.pendingDeletes--),p}readToGPU(e,s={}){const n=this.texData.get(e),{values:r,shape:i,slice:o,dtype:l,isPacked:c,texture:d}=n;if(l==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let f;c?f=new qo(i,Ho):f=new ki(i,Ho);const m=this.runWebGLProgram(f,[{dataId:e,shape:i,dtype:l}],l),b=this.readToGPU(m,s);return this.disposeIntermediateTensorInfo(m),b}if(d==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const u=this.decode(e,s.customTexShape),h=ai().makeTensorFromTensorInfo(u),p=this.texData.get(u.dataId);return Object.assign({tensorRef:h},p.texture)}bufferSync(e){const s=this.readSync(e.dataId);if(e.dtype==="string")try{const n=s.map(r=>Eo(r));return Nt(e.shape,e.dtype,n)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Nt(e.shape,e.dtype,s)}checkNumericalProblems(e){if(e!=null)for(let s=0;s<e.length;s++){const n=e[s];if(!Use(n))throw oe().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${n} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:s,dtype:n,isPacked:r}=this.texData.get(e),i=pe(s);if(oe().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const p=this.decode(e),f=this.texData.get(p.dataId),m=this.gpgpu.downloadMatrixFromPackedTexture(f.texture.texture,...Qm(s)).subarray(0,i);return this.disposeIntermediateTensorInfo(p),m}const o=oe().getBool("WEBGL_PACK")&&r===!0,l=o?sg(s):s,c=o?new rre(l):new nre(l),d=this.runWebGLProgram(c,[{shape:l,dtype:n,dataId:e}],"float32"),u=this.texData.get(d.dataId),h=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(d),h}timerAvailable(){return oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const s=this.activeTimers,n=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e();const i=Da(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),o=Da(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=s,r&&(this.programTimersStack=null);const l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const c=await Promise.all(i);l.kernelMs=pU(c),l.getExtraProfileInfo=()=>c.map((d,u)=>({name:o[u],ms:d})).map(d=>`${d.name}: ${d.ms}`).join(", ")}else l.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,l})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:yn(),endMs:null}}endTimer(e){return oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=yn(),e)}async getQueryTime(e){if(oe().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const s=e;return s.endMs-s.startMs}disposeData(e,s=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(s?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!s&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:n}=this.texData.get(e);return n!=null&&(this.disposeData(n.real.dataId,s),this.disposeData(n.imag.dataId,s)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:s,dtype:n,texShape:r,usage:i,isPacked:o,slice:l}=this.texData.get(e),c=l&&l.origDataId||e,d=this.dataRefCount.get(c);d>1?this.dataRefCount.set(c,d-1):(this.dataRefCount.delete(c),s!=null&&(this.numBytesInGPU-=this.computeBytes(r,n),this.textureManager.releaseTexture(s,r,i,o)));const u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,s=Oie){return oe().getBool("WEBGL_CPU_FORWARD")&&e.every(n=>this.texData.get(n.dataId).texture==null&&pe(n.shape)<s)}getGPGPUContext(){return this.gpgpu}where(e){Gn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const s=e.dataSync();return _ie(e.shape,s)}packedUnaryOp(e,s,n){const r=new qo(e.shape,s),i=this.compileAndRun(r,[e],n);return ai().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=hA(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(oe().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,yA,e.dtype);const s=new ki(e.shape,yA),n=this.compileAndRun(s,[e]);return ai().makeTensorFromTensorInfo(n)}makeTensorInfo(e,s,n){let r;if(s==="string"&&n!=null&&n.length>0&&wd(n[0])){const i=n.map(o=>Io(o));r=this.write(i,e,s)}else r=this.write(n,e,s);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:s}}makeOutput(e,s,n){return ai().makeTensorFromTensorInfo(this.makeTensorInfo(e,s,n),this)}unpackTensor(e){const s=new Die(e.shape);return this.runWebGLProgram(s,[e],e.dtype)}packTensor(e){const s=new gie(e.shape);return this.runWebGLProgram(s,[e],e.dtype,null,!0)}packedReshape(e,s){const n=[wc(e.shape),...vc(e.shape)],r={dtype:e.dtype,shape:n,dataId:e.dataId},i=[wc(s),...vc(s)],o=new mA(i,n),l=!0,c=[n],d=this.runWebGLProgram(o,[r],e.dtype,c,l);return{dataId:d.dataId,shape:s,dtype:d.dtype}}decode(e,s){const n=this.texData.get(e),{isPacked:r,shape:i,dtype:o}=n;if(s!=null){const p=pe(i),f=s[0]*s[1]*4;A(p<=f,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const l=sg(i);let c;r?c=new sre(l):c=new tre(l);const d=!0,u=[s??Qm(l)],h=this.runWebGLProgram(c,[{shape:l,dtype:o,dataId:e}],o,u,d,s);return{dtype:o,shape:i,dataId:h.dataId}}runWebGLProgram(e,s,n,r,i=!1,o){const l=this.makeTensorInfo(e.outputShape,n),c=this.texData.get(l.dataId);if(e.packedOutput&&(c.isPacked=!0),e.outPackingScheme===Qu.DENSE){const x=o??Qm(e.outputShape);c.texShape=x.map(y=>y*2)}if(e.outTexUsage!=null&&(c.usage=e.outTexUsage),pe(l.shape)===0)return c.values=Zs(l.dtype,0),l;const d=[],u=s.map(x=>{if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let y=this.texData.get(x.dataId);if(y.texture==null){if(!e.packedInputs&&pe(x.shape)<=oe().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:y.values};e.packedInputs&&(y.isPacked=!0,y.shape=x.shape)}if(this.uploadToGPU(x.dataId),!!y.isPacked!=!!e.packedInputs)x=y.isPacked?this.unpackTensor(x):this.packTensor(x),d.push(x),y=this.texData.get(x.dataId);else if(y.isPacked&&!rg(y.shape,x.shape)){const w=x,v=x.shape;x.shape=y.shape,x=this.packedReshape(x,v),d.push(x),y=this.texData.get(x.dataId),w.shape=v}return{shape:x.shape,texData:y,isUniform:!1}});this.uploadToGPU(l.dataId);const h={shape:l.shape,texData:c,isUniform:!1},p=ere(e,u,h),f=this.getAndSaveBinary(p,()=>Jne(this.gpgpu,e,u,h)),m=this.activeTimers!=null;let b;m&&(b=this.startTimer()),oe().get("ENGINE_COMPILE_ONLY")||Qne(this.gpgpu,f,u,h,r),d.forEach(x=>this.disposeIntermediateTensorInfo(x)),m&&(b=this.endTimer(b),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(b)}));const g=oe().getNumber("WEBGL_FLUSH_THRESHOLD");if(g>0){const x=yn();x-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=x)}if(!oe().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&i===!1){const x=this.unpackTensor(l);return this.disposeIntermediateTensorInfo(l),x}return l}compileAndRun(e,s,n,r,i=!1){return n=n||s[0].dtype,this.runWebGLProgram(e,s,n,r,i)}getAndSaveBinary(e,s){return e in this.binaryCache||(this.binaryCache[e]=s()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(oe().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(s=>{this.gpgpu.deleteProgram(this.binaryCache[s].webGLProgram),delete this.binaryCache[s]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=ne(()=>{if(!oe().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=oe().getBool("DEBUG");oe().set("DEBUG",!1);const s=this.abs(Mt(1e-8)).dataSync()[0];if(oe().set("DEBUG",e),s>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?Rie:Pie}uploadToGPU(e){const s=this.texData.get(e),{shape:n,dtype:r,values:i,texture:o,usage:l,isPacked:c}=s;if(o!=null)return;const d=this.activeTimers!=null;let u;d&&(u=yn());let h=s.texShape;if(h==null&&(h=one(n,c),s.texShape=h),i!=null){const p=sg(n);let f,m=h[1],b=h[0];const g=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(c||!g)&&([m,b]=yc(h[0],h[1])),c?f=new ore(p,g):f=new iA(p,g);const x=g?[b,m]:h,y=this.makeTensorInfo(x,r),w=this.texData.get(y.dataId);g?w.usage=Yn.PIXELS:w.usage=Yn.UPLOAD,w.texShape=x,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),m,b,i);const v=[[b,m]],C=this.runWebGLProgram(f,[y],r,v,!0),j=this.texData.get(C.dataId);s.texShape=j.texShape,s.isPacked=j.isPacked,s.usage=j.usage,oe().get("ENGINE_COMPILE_ONLY")?this.disposeData(C.dataId):(s.texture=j.texture,s.values=null,this.texData.delete(C.dataId)),this.disposeIntermediateTensorInfo(y),d&&(this.uploadWaitMs+=yn()-u)}else{const p=this.acquireTexture(h,l,r,c);s.texture=p}}convertAndCacheOnCPU(e,s){const n=this.texData.get(e),{dtype:r}=n;return s!=null&&(n.values=zie(s,r)),n.values}acquireTexture(e,s,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,s,r)}computeBytes(e,s){return e[0]*e[1]*qp(s)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,s]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(s));return Promise.all(e)}else{for(const[,s]of Object.entries(this.binaryCache)){const n=new Promise(r=>{try{this.checkCompletion_(s),r(!0)}catch(i){throw i}});e.push(n)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await pj(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(XT(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:s,customUniformLocations:n,infLoc:r,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:l,outTexShapeLocation:c}=nA(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=s,e.customUniformLocations=n,e.infLoc=r,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=l,e.outTexShapeLocation=c}}createTensorFromGPUData(e,s,n){e.channels=e.channels||"RGBA";const{texture:r,height:i,width:o,channels:l}=e,c=ai().backend;if(!c.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const d=c.writeTexture(r,s,n,i,o,l);return ai().makeTensorFromDataId(d,s,n,c)}}ag.nextDataId=0;function zie(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const s=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let n=0;n<s.length;++n)s[n]=Math.round(t[n]);return s}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */XC()&&eS("webgl",()=>new ag,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yw=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class al{constructor(e,s,n){this.variableNames=["A","B"],this.outputShape=ft(s,n),this.enableShapeUniforms=sn(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ll=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class jc{constructor(e,s,n,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=ft(s,n);const i=this.outputShape.length;this.enableShapeUniforms=sn(i);let o="";if(r)if(i===0||pe(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${Ht(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const c=un("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${c[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${c[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${c[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${c[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mn(t){const{inputs:e,backend:s}=t,{x:n}=e;return s.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}const Bie={kernelName:Bd,backendName:"webgl",kernelFunc:Mn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ko(t){const{inputs:e,backend:s}=t,{real:n,imag:r}=e,i=s.makeTensorInfo(n.shape,"complex64"),o=s.texData.get(i.dataId),l=Mn({inputs:{x:n},backend:s}),c=Mn({inputs:{x:r},backend:s});return o.complexTensorInfos={real:l,imag:c},i}const Uie={kernelName:E0,backendName:"webgl",kernelFunc:Ko};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wA="return (a < 0.) ? b * a : a;",vA=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Vie(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{alpha:i}=n,o=s.makeTensorInfo([],"float32",jo(i,"float32")),l=oe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new jc(vA,r.shape,o.shape):new al(wA,r.shape,o.shape),c=s.runWebGLProgram(l,[r,o],"float32");return s.disposeIntermediateTensorInfo(o),c}const Wie={kernelName:mf,backendName:"webgl",kernelFunc:Vie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NA="return (a < 0.) ? b * a : a;",kA=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Gie(t){const{inputs:e,backend:s}=t,{x:n,alpha:r}=e,i=oe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new jc(kA,n.shape,r.shape):new al(NA,n.shape,r.shape);return s.runWebGLProgram(i,[n,r],"float32")}const Hie={kernelName:Rf,backendName:"webgl",kernelFunc:Gie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ic="if (isnan(x)) return x;";function At({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:s,dtype:n}){return({inputs:r,backend:i})=>{const{x:o}=r,l=i,c=n||o.dtype;if(l.shouldExecuteOnCPU([o])&&s!=null){const h=l.texData.get(o.dataId),p=s(h.values,c);return l.makeTensorInfo(o.shape,c,p)}const d=oe().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let u;return d?u=new qo(o.shape,e):u=new ki(o.shape,t),l.runWebGLProgram(u,[o],c)}}function Hs({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:s=!1,supportsComplex:n=!1,cpuKernelImpl:r,dtype:i}){return({inputs:o,backend:l})=>{const{a:c,b:d}=o,u=l;if(n&&c.dtype==="complex64"){const m=u.texData.get(c.dataId),b=u.texData.get(d.dataId),[g,x]=[[m.complexTensorInfos.real,b.complexTensorInfos.real],[m.complexTensorInfos.imag,b.complexTensorInfos.imag]].map(w=>{const[v,N]=w,C={dataId:v.dataId,dtype:v.dtype,shape:c.shape},j={dataId:N.dataId,dtype:N.dtype,shape:d.shape},I=new al(t,c.shape,d.shape);return u.runWebGLProgram(I,[C,j],Rn(v.dtype,N.dtype))}),y=Ko({inputs:{real:g,imag:x},backend:u});return u.disposeIntermediateTensorInfo(g),u.disposeIntermediateTensorInfo(x),y}const h=i||Rn(c.dtype,d.dtype);if((c.dtype==="string"||d.dtype==="string"||u.shouldExecuteOnCPU([c,d]))&&r!=null){const m=u.texData.get(c.dataId).values,b=u.texData.get(d.dataId).values,g=c.dtype==="string"?no(m):m,x=c.dtype==="string"?no(b):b,[y,w]=r(c.shape,d.shape,g,x,h),v=u.makeTensorInfo(w,h),N=u.texData.get(v.dataId);return N.values=y,v}const p=oe().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let f;return p?f=new jc(e,c.shape,d.shape,s):f=new al(t,c.shape,d.shape),u.runWebGLProgram(f,[c,d],h)}}function nh(t,e=!1){if(t==="linear")return e?Iie:Nie;if(t==="relu")return e?$ie:Cie;if(t==="elu")return e?Eie:kie;if(t==="relu6")return e?Tie:Sie;if(t==="prelu")return e?kA:NA;if(t==="leakyrelu")return e?vA:wA;if(t==="sigmoid")return e?Aie:jie;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CA{constructor(e,s,n,r=!1,i=!1,o=!1,l=null,c=!1,d=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=sn(this.outputShape.length);const u=r?e[1]:e[2],h=Math.ceil(u/2),p=r?"i * 2, rc.y":"rc.y, i * 2",f=i?"rc.z, i * 2":"i * 2, rc.z",m=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],b=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let g="",x="";l&&(c?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${l}
        }`:d?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${l}
        }`:g=`vec4 activation(vec4 x) {
          ${l}
        }`,x="result = activation(result);");const y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),c&&this.variableNames.push("preluActivationWeights"),d&&this.variableNames.push("leakyreluAlpha");let w="rc.x",v="rc.x";e[0]<s[0]?w=`imod(rc.x, ${e[0]})`:s[0]<e[0]&&(v=`imod(rc.x, ${s[0]})`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${h}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${w};
        int batchB = ${v};
        for (int i = 0; i < ${h}; i++) {
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${f});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${m[0]} * ${b[0]});
          result += (${m[1]} * ${b[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${y}

        ${x}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SA={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class jA{constructor(e,s,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=ft(s,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IA="return a * b;";function Zw(t){const{inputs:e,backend:s}=t,{a:n,b:r}=e,i=Rn(n.dtype,r.dtype);if(n.dtype==="complex64"){const l=s.texData.get(n.dataId),c=s.texData.get(r.dataId),d=new jA(SA.REAL,n.shape,r.shape),u=new jA(SA.IMAG,n.shape,r.shape),h=[{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:n.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:n.shape},{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:r.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:r.shape}],p=s.runWebGLProgram(d,h,"float32"),f=s.runWebGLProgram(u,h,"float32"),m=Ko({inputs:{real:p,imag:f},backend:s});return s.disposeIntermediateTensorInfo(p),s.disposeIntermediateTensorInfo(f),m}if(s.shouldExecuteOnCPU([n,r])){const l=s.texData.get(n.dataId),c=s.texData.get(r.dataId),[d,u]=Gre(n.shape,r.shape,l.values,c.values,i),h=s.makeTensorInfo(u,i),p=s.texData.get(h.dataId);return p.values=d,h}let o;return oe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new jc(IA,n.shape,r.shape):o=new al(IA,n.shape,r.shape),s.runWebGLProgram(o,[n,r],i)}const qie={kernelName:Yd,backendName:"webgl",kernelFunc:Zw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kie(t,e,s){const n=[wc(t.shape),...vc(t.shape)],r={dtype:t.dtype,shape:n,dataId:t.dataId},i=[wc(e),...vc(e)],o=new mA(i,n),l=!0,c=[n],d=s.runWebGLProgram(o,[r],t.dtype,c,l);return{dataId:d.dataId,shape:e,dtype:d.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oe(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{shape:i}=n,o=s,l=pe(r.shape),c=Gk(i,l),d=pe(c);A(l===d,()=>`The new shape (${c}) has ${d} elements and the old shape (${r.shape}) has ${l} elements. The new shape and old shape must have the same number of elements.`);const u=o.texData.get(r.dataId);return u.isPacked&&!rg(r.shape,c)&&!(u.texture!==null&&rg(u.shape,c))?Kie(r,c,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:c,dtype:r.dtype})}const Xie={kernelName:Ff,backendName:"webgl",kernelFunc:Oe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EA{constructor(e,s){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];const l=Math.floor(n/4)*4,c=n%4;let d="sumValue += dot(values, ones);";if(s!=null){const h=1/s;d=`sumValue += dot(values * ${Wl(h)?h.toPrecision(2):h}, ones);`}let u="";i%n>0&&(u=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${n};

        float sumValue = 0.0;

        for (int i = 0; i < ${l}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${d}
        }

        int inIdx = inOffset + ${l};
        if (${c===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${d}
        } else if (${c===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${d}
        } else if (${c===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${d}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yie{constructor(e,s){this.variableNames=["x"];const{windowSize:n,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];let l="0.0",c="";s==="prod"?l="1.0":s==="min"?(l="1.0 / 1e-20",c="min"):s==="max"&&(l="-1.0 / 1e-20",c="max");let d=`${s}(${s}(${s}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;s==="sum"?d="sumValue":s==="prod"?d="prodValue":s==="all"?d="allValue":s==="any"&&(d="anyValue");const u=Math.floor(n/4)*4,h=n%4;let p=`
      if (${s==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${s==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${c}(values, minMaxValue);
        if (${s==="min"} || ${s==="max"}) {
          minMaxValue = ${c}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,f="vec4";s==="all"?(l="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):s==="any"&&(l="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");let m="";i%n>0&&(m=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${l};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${n};

        vec4 minMaxValue = vec4(${l});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${u};
        if (${h===1}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${h===2}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${h===3}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${d});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zie(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const s=e.length?e[e.length-1].outSize:t[1],n=bm(s);e.push({inSize:s,windowSize:n,outSize:Math.ceil(s/n)})}return e}function cl(t,e,s,n){const r=Zie(t.shape);let i=t;for(let o=0;o<r.length;o++){const{inSize:l,windowSize:c,outSize:d}=r[o];let u,h;s==="mean"?u=o===0?new EA({windowSize:c,inSize:l,batchSize:t.shape[0],outSize:d},l):new EA({windowSize:c,inSize:l,batchSize:t.shape[0],outSize:d}):u=new Yie({windowSize:c,inSize:l,batchSize:t.shape[0],outSize:d},s),h=i,i=n.runWebGLProgram(u,[i],e),h.dataId!==t.dataId&&n.disposeIntermediateTensorInfo(h)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jie{constructor(e,s){this.variableNames=["A"];const n=new Array(e.length);for(let o=0;o<n.length;o++)n[o]=e[s[o]];this.outputShape=n,this.rank=n.length;const r=Ht(this.rank),i=Qie(s);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function Qie(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const s=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],n=new Array(e);for(let r=0;r<t.length;r++)n[t[r]]=s[r];return n.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eoe{constructor(e,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(e.length);for(let u=0;u<n.length;u++)n[u]=e[s[u]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=Ht(this.rank),i=fA("rc",this.rank),o=new Array(this.rank);for(let u=0;u<s.length;u++)o[s[u]]=i[u];const l=`vec2(${o.slice(-2).join()})`,c=`++${i[this.rank-1]} < ${n[this.rank-1]}`,d=`getChannel(getA(${o.join()}), ${l})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${d};
      if(${c}) {
        result[1] = ${d};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${n[this.rank-2]}) {
        result[2] = ${d};
        if(${c}) {
          result[3] = ${d};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lg(t,e,s){const n=oe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new eoe(t.shape,e):new Jie(t.shape,e);return s.runWebGLProgram(n,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function toe(t,e,s,n){const r=e,i=t.shape.length,o=vt(r,t.shape);let l=o;const c=cs(l,i),d=c!=null;let u=t;d&&(u=lg(t,c,n),l=ms(l.length,i)),Ws("sum",l,i);const[h,p]=Fs(u.shape,l);let f=h;s&&(f=ks(h,o));const m=pe(p),g=pe(t.shape)/m,x=Oe({inputs:{x:u},attrs:{shape:[g,m]},backend:n}),y=yb(t.dtype),w=cl(x,y,"sum",n),v=Oe({inputs:{x:w},attrs:{shape:f},backend:n});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(w),d&&n.disposeIntermediateTensorInfo(u),v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cg(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i,keepDims:o}=n;return toe(r,i,o,s)}const soe={kernelName:Uf,backendName:"webgl",kernelFunc:cg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hn(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{perm:i}=n,o=s,l=r.shape.length,c=new Array(l);for(let u=0;u<c.length;u++)c[u]=r.shape[i[u]];let d;if(o.shouldExecuteOnCPU([r])){const h=o.texData.get(r.dataId).values,p=Xw(h,r.shape,r.dtype,i,c);d=o.makeTensorInfo(c,r.dtype);const f=o.texData.get(d.dataId);f.values=p}else d=lg(r,i,o);return d}const noe={kernelName:Xl,backendName:"webgl",kernelFunc:hn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $A=1e3;function dg({a:t,b:e,transposeA:s,transposeB:n,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:l=0,activation:c=null}){const d=t.shape.length,u=e.shape.length,h=s?t.shape[d-2]:t.shape[d-1],p=n?e.shape[u-1]:e.shape[u-2],f=s?t.shape[d-1]:t.shape[d-2],m=n?e.shape[u-2]:e.shape[u-1],b=t.shape.slice(0,-2),g=e.shape.slice(0,-2),x=pe(b),y=pe(g),v=ft(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([f,m]);A(h===p,()=>`Error in matMul: inner shapes (${h}) and (${p}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${s} and transposeB=${n} must match.`);const N=s?[x,h,f]:[x,f,h],C=n?[y,m,p]:[y,p,m],j=Oe({inputs:{x:t},backend:r,attrs:{shape:N}}),I=Oe({inputs:{x:e},backend:r,attrs:{shape:C}}),T=[j,I],E=Math.max(x,y),$=s?j.shape[1]:j.shape[2],D=i!=null,P=o!=null,_=c==="leakyrelu",O=c!=null?nh(c,!0):null,R=D||P||_||O!=null;let X;if((f===1||m===1)&&$>$A&&R===!1){let K=j,B=I;s&&(K=hn({inputs:{x:j},backend:r,attrs:{perm:[0,2,1]}}),T.push(K)),n&&(B=hn({inputs:{x:I},backend:r,attrs:{perm:[0,2,1]}}),T.push(B));const G=m!==1,de=m===1;let ae=K;G&&(ae=Oe({inputs:{x:K},backend:r,attrs:{shape:[E,$,1]}}),T.push(ae));const ve=m===1?2:1;let Ne=B;de&&(Ne=Oe({inputs:{x:B},backend:r,attrs:{shape:[E,1,$]}}),T.push(Ne));const le=Zw({inputs:{a:ae,b:Ne},backend:r});X=cg({inputs:{x:le},backend:r,attrs:{axis:ve,keepDims:!0}}),T.push(le)}else{const K=Rn(t.dtype,e.dtype),B=new CA(N,C,[E,f,m],s,n,D,O,P,_),G=[j,I];if(i!=null&&G.push(i),P&&G.push(o),_){const de=r.makeTensorInfo([],"float32",jo(l,"float32"));G.push(de),T.push(de)}X=r.runWebGLProgram(B,G,K)}const L=Oe({inputs:{x:X},backend:r,attrs:{shape:v}});T.push(X);for(const K of T)r.disposeIntermediateTensorInfo(K);return L}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function roe(t){const{inputs:e,backend:s,attrs:n}=t,{a:r,b:i,bias:o,preluActivationWeights:l}=e,{transposeA:c,transposeB:d,activation:u,leakyreluAlpha:h}=n;return dg({a:r,b:i,transposeA:c,transposeB:d,backend:s,bias:o,preluActivationWeights:l,leakyreluAlpha:h,activation:u})}const ioe={kernelName:Xf,backendName:"webgl",kernelFunc:roe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TA="return abs(x);";function ooe(t){const{inputs:e,backend:s}=t,{x:n}=e;if(s.shouldExecuteOnCPU([n])&&n.dtype!=="complex64"){const i=s.texData.get(n.dataId),o=hA(i.values);return s.makeTensorInfo(n.shape,n.dtype,o)}let r;return oe().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new qo(n.shape,TA):r=new ki(n.shape,TA),s.runWebGLProgram(r,[n],n.dtype)}const aoe={kernelName:Kp,backendName:"webgl",kernelFunc:ooe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const loe=vr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,coe=At({opSnippet:loe}),doe={kernelName:vd,backendName:"webgl",kernelFunc:coe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uoe=vr+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,hoe=At({opSnippet:uoe}),poe={kernelName:Nd,backendName:"webgl",kernelFunc:hoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AA="return a + b;",foe=Hs({opSnippet:AA,packedOpSnippet:AA,supportsComplex:!0,cpuKernelImpl:Cre}),moe={kernelName:Kl,backendName:"webgl",kernelFunc:foe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class goe{constructor(e,s){this.outputShape=[],this.outputShape=e,this.variableNames=s.map((i,o)=>`T${o}`);const n=[];this.variableNames.forEach(i=>{n.push(`float v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${n.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xoe{constructor(e,s){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=s.map((i,o)=>`T${o}`);const n=[];this.variableNames.forEach(i=>{n.push(`vec4 v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${n.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ug(t){const{inputs:e,backend:s}=t,n=e;if(n.length===1)return Mn({inputs:{x:n[0]},backend:s});if(n.length>oe().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const c=Math.floor(n.length/2),d=ug({inputs:n.slice(0,c),backend:s}),u=ug({inputs:n.slice(c),backend:s});return ug({inputs:[d,u],backend:s})}const r=n.map(c=>c.dtype).reduce((c,d)=>Rn(c,d)),i=n.map(c=>c.shape),l=oe().getBool("WEBGL_PACK")?new xoe(n[0].shape,i):new goe(n[0].shape,i);return s.runWebGLProgram(l,n,r)}const boe={kernelName:v0,backendName:"webgl",kernelFunc:ug};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yoe(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i,keepDims:o}=n,l=r.shape.length,c=vt(i,r.shape);let d=c;const u=cs(d,l);let h=r;u!=null&&(h=hn({inputs:{x:r},backend:s,attrs:{perm:u}}),d=ms(d.length,l)),Ws("all",d,l);const[p,f]=Fs(h.shape,d),m=pe(f),b=Oe({inputs:{x:h},backend:s,attrs:{shape:[-1,m]}}),g=cl(b,b.dtype,"all",s);let x;if(o){const y=ks(p,c);x=Oe({inputs:{x:g},backend:s,attrs:{shape:y}})}else x=Oe({inputs:{x:g},backend:s,attrs:{shape:p}});return s.disposeIntermediateTensorInfo(b),s.disposeIntermediateTensorInfo(g),u!=null&&s.disposeIntermediateTensorInfo(h),x}const woe={kernelName:N0,backendName:"webgl",kernelFunc:yoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function voe(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i,keepDims:o}=n,l=r.shape.length,c=vt(i,r.shape);let d=c;const u=cs(d,l);let h=r;u!=null&&(h=hn({inputs:{x:r},backend:s,attrs:{perm:u}}),d=ms(d.length,l)),Ws("any",d,l);const[p,f]=Fs(h.shape,d),m=pe(f),b=Oe({inputs:{x:h},backend:s,attrs:{shape:[-1,m]}}),g=cl(b,b.dtype,"any",s);let x;if(o){const y=ks(p,c);x=Oe({inputs:{x:g},backend:s,attrs:{shape:y}})}else x=Oe({inputs:{x:g},backend:s,attrs:{shape:p}});return s.disposeIntermediateTensorInfo(b),s.disposeIntermediateTensorInfo(g),u!=null&&s.disposeIntermediateTensorInfo(h),x}const Noe={kernelName:k0,backendName:"webgl",kernelFunc:voe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class koe{constructor(e,s,n){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const l=s==="max"?">":"<",c=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${c};
          float candidate = getA(batch, inIdx);
          if (candidate ${l} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Coe{constructor(e,s,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,A(e.length>2,()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/s);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const l=this.outputShape,c=l.length,d=Ht(c),u=un("coords",c);let h,p;if(o===1){p=c+1;const I=Ht(p);h=`
        ${I} sourceLocR = ${I}(${u.join()}, 0);
        ++${u[c-1]};
        ${I} sourceLocG = ${I}(${u.join()}, 0);
        ++${u[c-2]};
        ${I} sourceLocA = ${I}(${u.join()}, 0);
        --${u[c-1]};
        ${I} sourceLocB = ${I}(${u.join()}, 0);
        --${u[c-2]};`}else p=c,h=`
        ${d} sourceLocR = coords;
        ++${u[c-1]};
        ${d} sourceLocG = coords;
        ++${u[c-2]};
        ${d} sourceLocA = coords;
        --${u[c-1]};
        ${d} sourceLocB = coords;
        --${u[c-2]};`;const f=["x","y","z","w","u","v"].slice(0,p),m="."+f[p-1],b=f.map(I=>"int "+I),g=un("sourceLocR",p-1).concat("inIdx.r"),x=un("sourceLocG",p-1).concat("inIdx.g"),y=un("sourceLocB",p-1).concat("inIdx.b"),w=un("sourceLocA",p-1).concat("inIdx.a"),v=n==="max"?"greaterThan":"lessThan",N=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${w.join()})));`,C=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${x.join()}) : 0.,
            hasNextRow ? getAChannel(${y.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${w.join()}) : 0.)`,j=r?"":`
      float getBestIndicesAChannel(${b.join()}) {
        return getChannel(getBestIndicesA(${f.join()}),
                                          vec2(${f.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${b.join()}) {
        return getChannel(getA(${f.join()}),
                               vec2(${f.slice(-2).join()}));
      }
      ${j}
      void main() {
        ${d} coords = getOutputCoords();
        bool hasNextCol = ${u[c-1]} < ${l[c-1]-1};
        bool hasNextRow = ${u[c-2]} < ${l[c-2]-1};
        ${h}
        ivec4 srcIdx = ivec4(sourceLocR${m}, sourceLocG${m},
          sourceLocB${m}, sourceLocA${m}) * ${s};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${C};

        for (int i = 0; i < ${s}; i++) {
          inIdx = srcIdx;
          ${N}
          vec4 candidate = ${C};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${v}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DA(t,e,s,n=null){let r=e.shape[0],i=e.shape[1];n!=null&&(r=n.shape[0],i=n.shape[1]);const o=bm(i),l={windowSize:o,inSize:i,batchSize:r,outSize:Math.ceil(i/o)},c=new koe(l,s,n==null),d=[e];n!=null&&d.push(n);const u=t.runWebGLProgram(c,d,"int32");if(u.shape[1]===1)return u;const h=DA(t,e,s,u);return t.disposeIntermediateTensorInfo(u),h}function _A(t,e,s,n=null){const r=n!=null?n.shape:e.shape,i=r[r.length-1],o=bm(i),l=new Coe(r,o,s,n==null),c=n==null?[e]:[e,n],d=t.runWebGLProgram(l,c,"int32");if(d.shape.length===e.shape.length){const u=_A(t,e,s,d);return t.disposeIntermediateTensorInfo(d),u}return d}function RA(t,e,s,n){const r=[s];if(Ws("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.shape.length),!oe().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=t.texData.get(e.dataId),l=o!==null&&o.isPacked;let c=e;l&&(c=t.unpackTensor(e),i.push(c));const[d,u]=Fs(c.shape,r),h=pe(u),p=Oe({inputs:{x:c},backend:t,attrs:{shape:[-1,h]}});i.push(p);const f=DA(t,p,n);i.push(f);const m=Oe({inputs:{x:f},backend:t,attrs:{shape:d}});return i.forEach(b=>t.disposeIntermediateTensorInfo(b)),m}return _A(t,e,n)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Soe(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i}=n;let o=vt(i,r.shape);const l=cs(o,r.shape.length);let c=r;const d=[];l!=null&&(c=hn({inputs:{x:r},backend:s,attrs:{perm:l}}),d.push(c),o=ms(o.length,c.shape.length)),Ws("argMax",[o[0]],c.shape.length);const u=RA(s,c,o[0],"max");return d.forEach(h=>s.disposeIntermediateTensorInfo(h)),u}const joe={kernelName:Xp,backendName:"webgl",kernelFunc:Soe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ioe(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i}=n;let o=vt(i,r.shape);const l=cs(o,r.shape.length);let c=r;const d=[];l!=null&&(c=hn({inputs:{x:r},backend:s,attrs:{perm:l}}),d.push(c),o=ms(o.length,c.shape.length)),Ws("argMin",[o[0]],c.shape.length);const u=RA(s,c,o[0],"min");return d.forEach(h=>s.disposeIntermediateTensorInfo(h)),u}const Eoe={kernelName:Yp,backendName:"webgl",kernelFunc:Ioe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $oe=vr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,Toe=At({opSnippet:$oe}),Aoe={kernelName:kd,backendName:"webgl",kernelFunc:Toe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Doe=vr+"return log(x + sqrt(x * x + 1.0));",_oe=At({opSnippet:Doe}),Roe={kernelName:Cd,backendName:"webgl",kernelFunc:_oe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Poe=vr+`
  return atan(x);
`,Foe=At({opSnippet:Poe}),Ooe={kernelName:Sd,backendName:"webgl",kernelFunc:Foe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Moe=Yw+`
  return atan(a, b);
`,Loe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ll+`
  return result;
`,zoe=Hs({opSnippet:Moe,packedOpSnippet:Loe}),Boe={kernelName:Id,backendName:"webgl",kernelFunc:zoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uoe=vr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Voe=At({opSnippet:Uoe}),Woe={kernelName:jd,backendName:"webgl",kernelFunc:Voe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rh{constructor(e,s,n,r=!1,i=!1){if(this.variableNames=["x"],s==="avg"&&n)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,l=e.strideHeight,c=e.strideWidth,d=e.dilationHeight,u=e.dilationWidth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;const b=s==="avg",g=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,x=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let y="0.0";if(b||(y="-1.0 / 1e-20"),n){const I=">=";this.userCode=`
        const ivec2 strides = ivec2(${l}, ${c});
        const ivec2 pads = ivec2(${f}, ${m});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${h};
              wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${I} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?g:x:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const w="max";let v=`${s}(${s}(${s}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;s==="avg"&&(v="avgValue / max(count, 1.0)");const N=Math.floor(o/4)*4,C=o%4,j=`
      if (${b}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${f}, ${m});
      const float initializationValue = ${y};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${y});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${h};
            wR += ${d}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${N}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${j}
          }

          int xC = xCCorner + ${N};
          if (${C===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${j}
          } else if (${C===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${j}
          } else if (${C===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${j}
          }
        }
        setOutput(${v});
      }
    `}}class Jw{constructor(e,s,n,r=!1,i=!1){if(this.variableNames=["x"],s==="avg"&&n)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,l=e.strideDepth,c=e.strideHeight,d=e.strideWidth,u=e.dilationDepth,h=e.dilationHeight,p=e.dilationWidth,f=e.effectiveFilterDepth,m=e.effectiveFilterHeight,b=e.effectiveFilterWidth,g=e.padInfo.front,x=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;const w=s==="avg";let v="0.0";if(w||(v="-1.0 / 1e-20"),n){const E=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${l}, ${c}, ${d});
        const ivec3 pads = ivec3(${g}, ${x}, ${y});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${f};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${m};
                wR += ${h}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${b};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${E} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${m} * ${b} +
                      wR * ${b} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const N="max";let C=`${s}(${s}(${s}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;s==="avg"&&(C="avgValue / max(count, 1.0)");const j=Math.floor(o/4)*4,I=o%4,T=`
      if (${w}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${N}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${l}, ${c}, ${d});
      const ivec3 pads = ivec3(${g}, ${x}, ${y});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m};
            wR += ${h}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${j}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${T}
            }

            int xC = xCCorner + ${j};
            if (${I===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${T}
            } else if (${I===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${T}
            } else if (${I===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${T}
            }
          }
        }
        setOutput(${C});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Goe(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e;th(r,"avgPool");const{filterSize:i,strides:o,pad:l,dimRoundingMode:c}=n,d=1;A(Qs(o,d),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const u=hr(r.shape,i,o,d,l,c);if(u.filterWidth===1&&u.filterHeight===1&&Ft(u.inShape,u.outShape))return Mn({inputs:{x:r},backend:s});const h=new rh(u,"avg",!1);return s.runWebGLProgram(h,[r],"float32")}const Hoe={kernelName:Zp,backendName:"webgl",kernelFunc:Goe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qoe(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{filterSize:i,strides:o,pad:l,dimRoundingMode:c,dataFormat:d}=n,u=[1,1,1],h=Zi(r.shape,i,o,u,l,c,d),p=new Jw(h,"avg",!1);return s.runWebGLProgram(p,[r],"float32")}const Koe={kernelName:Jp,backendName:"webgl",kernelFunc:qoe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xoe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const s=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterHeight,d=e.effectiveFilterWidth,u=c-1-e.padInfo.top,h=d-1-e.padInfo.left,p=1/(s*n);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${h});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${c};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${d};
            wC+= ${l}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class Yoe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const s=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,l=e.strideWidth,c=e.dilationDepth,d=e.dilationHeight,u=e.dilationWidth,h=e.effectiveFilterDepth,p=e.effectiveFilterHeight,f=e.effectiveFilterWidth,m=h-1-e.padInfo.front,b=p-1-e.padInfo.top,g=f-1-e.padInfo.left,x=1/(s*n*r);this.userCode=`
      const ivec3 pads = ivec3(${m}, ${b}, ${g});
      const float avgMultiplier = float(${x});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${h};
            wD += ${c}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${d}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${f};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${l}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zoe(t){const{inputs:e,backend:s,attrs:n}=t,{dy:r,input:i}=e,o=i,{filterSize:l,strides:c,pad:d,dimRoundingMode:u}=n,h=[1,1,1],p=Zi(o.shape,l,c,h,d,u),f=new Yoe(p);return s.runWebGLProgram(f,[r],o.dtype)}const Joe={kernelName:S0,backendName:"webgl",kernelFunc:Zoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qoe(t){const{inputs:e,backend:s,attrs:n}=t,{dy:r,input:i}=e,o=i;th([r,i],"avgPoolGrad");const{filterSize:l,strides:c,pad:d}=n,u=hr(o.shape,l,c,1,d),h=new Xoe(u);return s.runWebGLProgram(h,[r],o.dtype)}const eae={kernelName:C0,backendName:"webgl",kernelFunc:Qoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tae(t){const{inputs:e,backend:s,attrs:n}=t,{a:r,b:i}=e,{transposeA:o,transposeB:l}=n;return dg({a:r,b:i,transposeA:o,transposeB:l,backend:s})}const sae={kernelName:Qp,backendName:"webgl",kernelFunc:tae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nae{constructor(e,s,n,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],ft(e,s),ft(e,n);let l="0.0";r!=null&&(ft(e,r),this.variableNames.push("offset"),l="getOffsetAtOutCoords()");let c="1.0";i!=null&&(ft(e,i),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${l};
        float scale = ${c};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rae{constructor(e,s,n,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],ft(e,s),ft(e,n);let l="vec4(0.0)";r!=null&&(ft(e,r),this.variableNames.push("offset"),l="getOffsetAtOutCoords()");let c="vec4(1.0)";i!=null&&(ft(e,i),this.variableNames.push("scale"),c="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${l};
        vec4 scale = ${c};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iae={kernelName:hf,backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:s})=>{const{x:n,mean:r,variance:i,offset:o,scale:l}=t;A(r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),A(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),A(l==null||r.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:c}=s;c==null&&(c=.001);const d=[n,r,i];let u=null;o!=null&&(u=o.shape,d.push(o));let h=null;l!=null&&(h=l.shape,d.push(l));const p=oe().getBool("WEBGL_PACK_NORMALIZATION")?new rae(n.shape,r.shape,i.shape,u,h,c):new nae(n.shape,r.shape,i.shape,u,h,c);return e.runWebGLProgram(p,d,d[0].dtype)}};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oae{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const s=Ht(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=aae(this.rank);let r;const i=e.map((o,l)=>`sourceLoc.${Qw[l]} = start[${l}] + coords.${Qw[l]};`);r=`
        ${s} sourceLoc;
        ${s} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${n}));
      }
    `}}const Qw=["x","y","z","w","u","v"];function aae(t){if(t===1)return"sourceLoc";if(t<=6)return Qw.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lae{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=Ht(this.rank),n=un("coords",this.rank),r=un("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${i})`,l=`
      result.x = ${o};
      if (++${n[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,c=this.rank===1?"":`
      --${n[this.rank-1]};
      if (++${n[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${n[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,d=this.rank<=4?`sourceLoc = coords +
            ${s}(${e.map((u,h)=>`start[${h}]`).join()});`:e.map((u,h)=>`${r[h]} = ${n[h]} + start[${h}];`).join(`
`);this.userCode=`
      void main() {
        ${s} coords = getOutputCoords();
        ${s} sourceLoc;
        ${d}
        vec4 result = vec4(0.);
        ${l}
        ${c}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cae(t,e,s,n){const r=n.texData.get(t.dataId),i=n.makeTensorInfo(s,t.dtype),o=n.texData.get(i.dataId);Object.assign(o,r),o.refCount=1,o.shape=s,o.dtype=t.dtype;let l=wy(e,tt(t.shape));r.slice&&(l+=r.slice.flatOffset),o.slice={flatOffset:l,origDataId:r.slice&&r.slice.origDataId||t.dataId};const c=n.dataRefCount.get(o.slice.origDataId)||1;return n.dataRefCount.set(o.slice.origDataId,c+1),i}function Ec(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{begin:i,size:o}=n,[l,c]=xm(r,i,o);if(xy(r,l,c),pe(c)===0)return s.makeTensorInfo(c,r.dtype,[]);if(s.shouldExecuteOnCPU([r])||r.dtype==="string"){const h=s.texData.get(r.dataId),p=sie(h.values,l,c,r.shape,r.dtype);return s.makeTensorInfo(c,r.dtype,p)}const{isPacked:d}=s.texData.get(r.dataId),u=yy(r.shape,l,c);if(d||!u){const h=oe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new lae(c):new oae(c),p=[l];return s.runWebGLProgram(h,[r],r.dtype,p)}return s.uploadToGPU(r.dataId),cae(r,l,c,s)}const dae={kernelName:Bf,backendName:"webgl",kernelFunc:Ec};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uae={kernelName:ef,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{blockShape:i,crops:o}=n;A(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const l=i.reduce((y,w)=>y*w),c=Du(r.shape,i,l),d=_u(c.length,i.length),u=Ru(r.shape,i,l),h=Sy(o,i.length),p=jy(u,o,i.length),f=[],m=Oe({inputs:{x:r},backend:s,attrs:{shape:c}}),b=hn({inputs:{x:m},backend:s,attrs:{perm:d}}),g=Oe({inputs:{x:b},backend:s,attrs:{shape:u}}),x=Ec({inputs:{x:g},backend:s,attrs:{begin:h,size:p}});return f.push(m),f.push(b),f.push(g),f.forEach(y=>s.disposeIntermediateTensorInfo(y)),x}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hae(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,weights:i}=e,{size:o}=n,l=s.readSync(r.dataId),c=s.readSync(i.dataId),d=uA(l,c,i.dtype,i.shape,o);return s.makeTensorInfo([o],i.dtype,d)}const pae={kernelName:j0,backendName:"webgl",kernelFunc:hae};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fae=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,mae=`
  return float(int(a.r) & int(b.r));
`;function gae(t){const{inputs:e,backend:s}=t,{a:n,b:r}=e,i=oe().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=oe().getNumber("WEBGL_VERSION");if(s.shouldExecuteOnCPU([n,r])||o===1){const c=s.texData.get(n.dataId).values,d=s.texData.get(r.dataId).values,[u,h]=jre(n.shape,r.shape,c,d,n.dtype),p=s.makeTensorInfo(h,n.dtype),f=s.texData.get(p.dataId);return f.values=u,p}let l;return i?l=new jc(fae,n.shape,r.shape,!1):l=new al(mae,n.shape,r.shape),s.runWebGLProgram(l,[n,r],n.dtype)}const xae={kernelName:I0,backendName:"webgl",kernelFunc:gae};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bae(t){const{inputs:e,backend:s}=t,{s0:n,s1:r}=e,i=s.readSync(n.dataId),o=s.readSync(r.dataId),l=ft(Array.from(i),Array.from(o));return s.makeTensorInfo([l.length],"int32",Int32Array.from(l))}const yae={kernelName:Jk,backendName:"webgl",kernelFunc:bae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PA=Hs({opSnippet:"return float(a != b);",cpuKernelImpl:qre,dtype:"bool"}),wae={kernelName:$f,backendName:"webgl",kernelFunc:PA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ih(t){const{inputs:e,backend:s}=t,{input:n}=e,r=s.texData.get(n.dataId);return Mn({inputs:{x:r.complexTensorInfos.real},backend:s})}const vae={kernelName:eb,backendName:"webgl",kernelFunc:ih};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nae="return float(int(x));";function kae(t,e){const s=new ki(t.shape,Nae),n=e.runWebGLProgram(s,[t],"int32");return{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ev(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{dtype:i}=n;if(i==="complex64"){if(r.dtype==="complex64")return Mn({inputs:{x:r},backend:s});const o=Os(r.shape),l=ev({inputs:{x:r},backend:s,attrs:{dtype:"float32"}}),c=Ko({inputs:{real:l,imag:o},backend:s});return o.dispose(),s.disposeIntermediateTensorInfo(l),c}if(r.dtype==="complex64"){const o=ih({inputs:{input:r},backend:s}),l=ev({inputs:{x:o},backend:s,attrs:{dtype:i}});return s.disposeIntermediateTensorInfo(o),l}if(!Hk(r.dtype,i)){const o=Mn({inputs:{x:r},backend:s});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(s.shouldExecuteOnCPU([r])){const o=s.texData.get(r.dataId).values,[l,c,d]=Ire(o,r.shape,r.dtype,i);return s.makeTensorInfo(l,c,d)}if(i==="int32")return kae(r,s);if(i==="bool"){const o=s.makeTensorInfo([],"bool",Zs("bool",1)),c=PA({inputs:{a:r,b:o},backend:s});return s.disposeIntermediateTensorInfo(o),c}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const Cae={kernelName:Ed,backendName:"webgl",kernelFunc:ev};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FA="return ceil(x);",Sae=At({opSnippet:FA,packedOpSnippet:FA,cpuKernelImpl:Ere}),jae={kernelName:$d,backendName:"webgl",kernelFunc:Sae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Iae{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Eae{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ae(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{clipValueMin:i,clipValueMax:o}=n;let l;oe().getBool("WEBGL_PACK_CLIP")?l=new Eae(r.shape):l=new Iae(r.shape);const c=[[i],[o]];return s.runWebGLProgram(l,[r],r.dtype,c)}const Tae={kernelName:Td,backendName:"webgl",kernelFunc:$ae};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Aae{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OA(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function Dae(t){const{inputs:e,backend:s}=t,{x:n}=e,r=s.texData.get(n.dataId),i=new Aae(n.shape),o=[OA(n,r.complexTensorInfos.real),OA(n,r.complexTensorInfos.imag)];return s.runWebGLProgram(i,o,o[0].dtype)}const _ae={kernelName:tf,backendName:"webgl",kernelFunc:Dae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rae{constructor(e){this.outputShape=[],this.outputShape=pi(e,1),this.variableNames=e.map((o,l)=>`T${l}`);const s=new Array(e.length-1);s[0]=e[0][1];for(let o=1;o<s.length;o++)s[o]=s[o-1]+e[o][1];const n=[`if (yC < ${s[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<s.length;o++){const l=s[o-1];n.push(`else if (yC < ${s[o]}) setOutput(getT${o}(yR, yC-${l}));`)}const r=s.length,i=s[s.length-1];n.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${n.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pae{constructor(e,s){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=pi(e,s);const n=this.outputShape,r=n.length,i=Ht(r),o=un("coords",r),l=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((b,g)=>`T${g}`);const c=new Array(e.length-1);c[0]=e[0][s];for(let b=1;b<c.length;b++)c[b]=c[b-1]+e[b][s];const d=l[s],u=l.slice(-2),h=l.join();let p=`if (${d} < ${c[0]}) {
        return getChannel(
            getT0(${h}), vec2(${u.join()}));
        }`;for(let b=1;b<c.length;b++){const g=c[b-1];p+=`
        if (${d} < ${c[b]}  && ${d} >= ${c[b-1]}) {
          return getChannel(
            getT${b}(${hg(l,d,g)}),
            vec2(${hg(u,d,g)}));
        }`}const f=c.length,m=c[c.length-1];p+=`
        return getChannel(
          getT${f}(${hg(l,d,m)}),
          vec2(${hg(u,d,m)}));`,this.userCode=`
      float getValue(${l.map(b=>"int "+b)}) {
        ${p}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${n[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${n[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${n[r-2]} &&
            ${o[r-1]} < ${n[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function hg(t,e,s){const n=t.indexOf(e);return t.map((i,o)=>o===n?`${i} - ${s}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pg(t){const{inputs:e,backend:s}=t,{input:n}=e,r=s.texData.get(n.dataId);return Mn({inputs:{x:r.complexTensorInfos.imag},backend:s})}const Fae={kernelName:H0,backendName:"webgl",kernelFunc:pg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oh(t,e,s){const n=t[0].dtype;if(n==="complex64"){const f=t.map(y=>ih({inputs:{input:y},backend:s})),m=t.map(y=>pg({inputs:{input:y},backend:s})),b=oh(f,e,s),g=oh(m,e,s),x=Ko({inputs:{real:b,imag:g},backend:s});return f.forEach(y=>s.disposeIntermediateTensorInfo(y)),m.forEach(y=>s.disposeIntermediateTensorInfo(y)),s.disposeIntermediateTensorInfo(b),s.disposeIntermediateTensorInfo(g),x}let r=s.shouldExecuteOnCPU(t);if(n==="string"&&(r=!0),r){const f=t.map(v=>{const C=[-1,pe(v.shape.slice(e))];return Oe({inputs:{x:v},backend:s,attrs:{shape:C}})}),m=f.map(v=>({vals:s.readSync(v.dataId),shape:v.shape})),b=pi(f.map(v=>v.shape),1),g=f[0].shape[0]===1,x=$re(m,b,n,g),y=pi(t.map(v=>v.shape),e),w=s.makeTensorInfo(y,n,x);return f.forEach(v=>s.disposeIntermediateTensorInfo(v)),w}const i=t.filter(f=>pe(f.shape)>0),o=oe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const f=o?new ki(t[0].shape,Ho):new qo(t[0].shape,Ho);return s.runWebGLProgram(f,t,n)}const l=oe().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>l){const f=[];for(let b=0;b<i.length;b+=l){const g=i.slice(b,b+l);f.push(oh(g,e,s))}const m=oh(f,e,s);for(const b of f)s.disposeIntermediateTensorInfo(b);return m}if(o){const f=new Pae(i.map(m=>m.shape),e);return s.runWebGLProgram(f,i,n)}const{tensors2D:c,outShape:d}=Oae(i,e,s),u=new Rae(c.map(f=>f.shape)),h=s.runWebGLProgram(u,c,n);c.forEach(f=>s.disposeIntermediateTensorInfo(f));const p=Oe({inputs:{x:h},attrs:{shape:d},backend:s});return s.disposeIntermediateTensorInfo(h),p}function Oae(t,e,s){const n=pi(t.map(i=>i.shape),e);return{tensors2D:t.map(i=>Oe({inputs:{x:i},attrs:{shape:[-1,pe(i.shape.slice(e))]},backend:s})),outShape:n}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MA(t){const{inputs:e,backend:s,attrs:n}=t,{axis:r}=n,i=vt(r,e[0].shape)[0],o=e.map(d=>d.shape);Ny(o,i);const l=pi(e.map(d=>d.shape),i);if(pe(l)===0)return s.makeTensorInfo(l,e[0].dtype,[]);const c=e.filter(d=>pe(d.shape)>0);return c.length===1?Mn({inputs:{x:c[0]},backend:s}):oh(c,i,s)}const Mae={kernelName:sf,backendName:"webgl",kernelFunc:MA};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LA{constructor(e,s=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,l=e.padInfo.left,c=e.strideHeight,d=e.strideWidth,u=e.dilationHeight,h=e.dilationWidth,p=e.filterHeight,f=e.filterWidth,m=Math.floor(e.inChannels/4)*4,b=e.inChannels%4,g=e.dataFormat==="channelsLast",x=g?1:2,y=g?2:3,w=g?3:1;let v="",N="";n&&(r?v=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:i?v=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:v=`
          float activation(float x) {
            ${n}
          }
        `,N="result = activation(result);");const C=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${v}

      const ivec2 strides = ivec2(${c}, ${d});
      const ivec2 pads = ivec2(${o}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${w}];

        ivec2 xRCCorner =
            ivec2(coords[${x}], coords[${y}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${f}; wC++) {
            int xC = xCCorner + wC * ${h};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${m}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${b===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${m}) *
                    getW(wR, wC, ${m}, d2);
              } else {
                dotProd +=
                    getX(batch, ${m}, xR, xC) *
                    getW(wR, wC, ${m}, d2);
              }

            } else if (${b===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${b===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2),
                getW(wR, wC, ${m} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1),
                  getX(batch, xR, xC, ${m} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC),
                  getX(batch, ${m} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${C}
        ${N}
        setOutput(result);
      }
    `}}class Lae{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const s=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,l=e.strideWidth,c=e.dilationDepth,d=e.dilationHeight,u=e.dilationWidth,h=e.filterDepth,p=e.filterHeight,f=e.filterWidth,m=Math.floor(e.inChannels/4)*4,b=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${l});
      const ivec3 pads = ivec3(${s}, ${n}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${h}; wF++) {
          int xF = xFCorner + wF * ${c};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${d};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${m}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${b===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${m}) *
                  getW(wF, wR, wC, ${m}, d2);
              } else if (${b===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${b===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1),
                  getX(batch, xF, xR, xC, ${m} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2),
                  getW(wF, wR, wC, ${m} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zA{constructor(e,s=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=sn(this.outputShape.length);const o=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,d=e.filterHeight,u=e.filterWidth,h=u;let p=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<u;g++)p+=`
           vec4 xTexelC${g*2};
           int xTexelC${g*2}Ready;
           vec4 xTexelC${g*2+1};
           int xTexelC${g*2+1}Ready;
           vec4 xC${g};`;p+=`
     for (int r = 0; r < ${d}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let g=0;g<u;g++)p+=`
           xTexelC${g*2} = vec4(0.0);
           xTexelC${g*2}Ready = 0;
           xTexelC${g*2+1} = vec4(0.0);
           xTexelC${g*2+1}Ready = 0;
           xC${g} = vec4(0.0);`;p+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let g=0;g<(h+1)/2;g++){const x=g*2;if(p+=`
           xC = xCCorner + ${x*c};
           `,l===1){if(x<u&&(o%2===1?(p+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }
               `,c===1&&x>0?p+=`
                 xC${x} = vec4(xTexelC${x-2}.zw, xTexelC${x}.xy);
                 `:p+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${x} = vec4(previous.zw, xTexelC${x}.xy);
                   } else {
                     xC${x} = vec4(0.0, 0.0, xTexelC${x}.xy);
                   }
                   `):p+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 xC${x} = xTexelC${x};
                 `,x+1<u)){const y=o%2===0?u0(c):c;c%2===0&&o%2===1||c%2!==0&&o%2!==1?(p+=`
                   xCOffset = xC + imod(pads[1], 2) + ${y};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                     xTexelC${x+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${x+1}.zw = vec2(0.0);
                     }
                     xTexelC${x+1}Ready = 1;
                   }
                   `,c>1?p+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${x+1} = vec4(previous.zw, xTexelC${x+1}.xy);
                     } else {
                      xC${x+1} = vec4(0.0, 0.0, xTexelC${x+1}.xy);
                     }
                     `:p+=`
                     xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.xy);
                     `):y===1?p+=`
                     xC${x+1} = xTexelC${x};
                     `:p+=`
                     xCOffset = xC + ${y};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                       xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${x+1}.zw = vec2(0.0);
                       }
                       xTexelC${x+1}Ready = 1;
                     }

                     xC${x+1} = xTexelC${x+1};
                     `}}else x<u&&(o%2===1?(p+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${x+1}Ready == 0) {
                   xTexelC${x+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${x+1}.zw = vec2(0.0);
                   }
                   xTexelC${x+1}Ready = 1;
                 }

                 xC${x} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
               `,x+1<u&&(p+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${x+1} = vec4(xTexelC${x+1}.xy, final.xy);
                 `)):(p+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                   xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x+1}.zw = vec2(0.);
                   }
                   xTexelC${x+1}Ready = 1;
                 }

                 xC${x} = vec4(
                   xTexelC${x}.xy, xTexelC${x+1}.xy);
               `,x+1<u&&(p+=`
                   xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
                 `)));x<u&&(p+=`
             wTexel = getW(r, ${x}, d1, d2);
             dotProd += xC${x}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${x}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,x+1<u&&(p+=`
               wTexel = getW(r, ${x+1}, d1, d2);
               dotProd += xC${x+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${x+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}p+=`
     }
   `,p+=`
     }
   `,p+=`
     }
   `;let f="",m="";n&&(r?f=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${n}
         }`:i?f=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${n}
         }`:f=`vec4 activation(vec4 x) {
           ${n}
         }`,m="result = activation(result);");const b=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${f}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${p}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${b}
         ${m}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zae{constructor(e,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=sn(this.outputShape.length);const{dataFormat:n}=s,r=dn(),i=n==="channelsLast",o=i?1:2,l=i?2:3,c=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let d="";for(let u=0;u<=1;u++)for(let h=0;h<=1;h++)d+=`
          blockIndex = rc.z + ${h};
          pos = rc.y + ${u};

          ${c}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${l}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${u*2+h}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${u*2+h}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${d}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fg(t,e){const s=t.length;return s>=3?e?[...t.slice(0,-3),t[s-3]*t[s-2],t[s-1]]:[...t.slice(0,-3),t[s-3],t[s-2]*t[s-1]]:!e&&s===1&&t[0]>1?[t[0],1]:null}function BA({x:t,filter:e,convInfo:s,backend:n,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:l=null}){const c=t.shape,d=n.texData.get(t.dataId),u=s.inChannels,h=c[0]*c[1]*c[2],p=s.outChannels,f=s.dataFormat==="channelsLast",m=!1,b=!1;let g;const x=[];if(i!=null){const v=fg(i.shape,f);v!=null&&(i=Oe({inputs:{x:i},backend:n,attrs:{shape:v}}),x.push(i))}if(r!=null){const v=fg(r.shape,f);v!=null&&(r=Oe({inputs:{x:r},backend:n,attrs:{shape:v}}),x.push(r))}if(!((h===1||p===1)&&u>$A)&&d.isPacked&&f&&d.texture!=null&&c[2]%2!==0&&Ft(d.shape.slice(-3),c.slice(-3))){const v=c[0]*c[1]*(c[2]+1),N={dataId:t.dataId,shape:[1,v,s.inChannels],dtype:t.dtype},C=d.shape;d.shape=d.shape.slice(),d.shape[d.shape.length-2]++,A(rg(d.shape,N.shape),()=>`packed reshape ${d.shape} to ${N.shape} isn't free`);const j=Oe({inputs:{x:e},backend:n,attrs:{shape:[1,s.inChannels,s.outChannels]}});x.push(j);const I=dg({a:N,b:j,backend:n,transposeA:m,transposeB:b,bias:r,activation:l,preluActivationWeights:i,leakyreluAlpha:o}),T=n.texData.get(I.dataId);A(T.isPacked,()=>"batchMatMul result is expected to be packed"),d.shape=C,T.shape=s.outShape,g=Mn({inputs:{x:I},backend:n}),g.shape=s.outShape,x.push(I)}else{const v=s.outHeight*s.outWidth,N=Oe({inputs:{x:t},backend:n,attrs:{shape:f?[s.batchSize,v,s.inChannels]:[s.batchSize,s.inChannels,v]}}),C=Oe({inputs:{x:e},backend:n,attrs:{shape:[1,s.inChannels,s.outChannels]}}),j=dg({a:f?N:C,b:f?C:N,transposeA:!f,transposeB:b,backend:n,bias:r,activation:l,preluActivationWeights:i,leakyreluAlpha:o});g=Oe({inputs:{x:j},backend:n,attrs:{shape:s.outShape}}),x.push(N),x.push(C),x.push(j)}for(const v of x)n.disposeIntermediateTensorInfo(v);return g}function UA({x:t,filter:e,convInfo:s,backend:n,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:l=null}){const{filterWidth:c,filterHeight:d,inChannels:u,outWidth:h,outHeight:p,dataFormat:f}=s,m=f==="channelsLast",b=c*d*u,g=p*h,x=[s.batchSize,b,g],y=!0,w=!1,v=[];if(i!=null){const L=fg(i.shape,m);L!=null&&(i=Oe({inputs:{x:i},backend:n,attrs:{shape:L}}),v.push(i))}if(r!=null){const L=fg(r.shape,m);L!=null&&(r=Oe({inputs:{x:r},backend:n,attrs:{shape:L}}),v.push(r))}const N=Oe({inputs:{x:e},backend:n,attrs:{shape:[1,b,pe(e.shape)/b]}});v.push(N);const C=new zae(x,s),j=[t.shape,[s.padInfo.top,s.padInfo.left],[s.strideHeight,s.strideWidth],[s.dilationHeight,s.dilationWidth],[s.inChannels],[s.filterWidth*s.inChannels],[s.outWidth]],I=n.runWebGLProgram(C,[t],"float32",j),T=Oe({inputs:{x:I},backend:n,attrs:{shape:x}});v.push(I),v.push(T);const E=r!=null,$=i!=null,D=l==="leakyrelu",P=l?nh(l,!0):null,_=new CA(m?T.shape:N.shape,m?N.shape:T.shape,m?[s.batchSize,g,s.outChannels]:[s.batchSize,s.outChannels,g],y,w,E,P,$,D),O=m?[T,N]:[N,T];if(r&&O.push(r),$&&O.push(i),D){const L=n.makeTensorInfo([],"float32",jo(o,"float32"));O.push(L),v.push(L)}const R=n.runWebGLProgram(_,O,"float32"),X=Oe({inputs:{x:R},backend:n,attrs:{shape:s.outShape}});v.push(R);for(const L of v)n.disposeIntermediateTensorInfo(L);return X}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bae(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,filter:i}=e,{strides:o,pad:l,dataFormat:c,dilations:d,dimRoundingMode:u}=n,h=Ji(c),p=Vs(r.shape,i.shape,o,d,l,u,!1,h);let f;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))f=BA({x:r,filter:i,convInfo:p,backend:s});else if(p.strideWidth<=2&&h==="channelsLast"&&oe().getBool("WEBGL_EXP_CONV")){const b=new zA(p),g=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];f=s.runWebGLProgram(b,[r,i],"float32",g)}else if(oe().getBool("WEBGL_CONV_IM2COL"))f=UA({x:r,filter:i,convInfo:p,backend:s});else{const b=new LA(p);f=s.runWebGLProgram(b,[r,i],"float32")}const m=Oe({inputs:{x:f},backend:s,attrs:{shape:p.outShape}});return s.disposeIntermediateTensorInfo(f),m}const Uae={kernelName:nf,backendName:"webgl",kernelFunc:Bae};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vae{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const s=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${s} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${n} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Wae{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const s=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",l=s-1-e.padInfo.top,c=n-1-e.padInfo.left,d=o?1:2,u=o?2:3,h=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${l}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${h}];

        ivec2 dyCorner = ivec2(coords[${d}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${s}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${s} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${n} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Gae{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const s=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,l=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${s} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${n} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${l};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Hae{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const s=e.filterDepth,n=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,l=e.strideWidth,c=s-1-e.padInfo.front,d=n-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${c}, ${d}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${s}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${s} - 1 - wF;

          for (int wR = 0; wR < ${n}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${n} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${l}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qae(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,dy:i}=e,{strides:o,pad:l,dataFormat:c,dimRoundingMode:d,filterShape:u}=n,h=Ji(c),p=Vs(r.shape,u,o,1,l,d,!1,h),f=new Vae(p);return s.runWebGLProgram(f,[r,i],"float32")}const Kae={kernelName:$0,backendName:"webgl",kernelFunc:qae};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xae{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=sn(this.outputShape.length);const s=e.filterHeight,n=e.filterWidth,r=s-1-e.padInfo.top,i=n-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${s}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${s} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            int wCPerm = ${n} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yae(t){const{inputs:e,backend:s,attrs:n}=t,{dy:r,filter:i}=e,{inputShape:o,strides:l,pad:c,dataFormat:d,dimRoundingMode:u}=n,h=Ji(d),p=Vs(o,i.shape,l,1,c,u,!1,h);if(oe().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&h==="channelsLast"){const f=[[p.strideHeight,p.strideWidth]],m=new Xae(p);return s.runWebGLProgram(m,[r,i],"float32",f)}else{const f=new Wae(p);return s.runWebGLProgram(f,[r,i],"float32")}}const Zae={kernelName:rf,backendName:"webgl",kernelFunc:Yae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jae(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,filter:i}=e,{strides:o,pad:l,dilations:c}=n,d=Ao(r.shape,i.shape,o,c,l),u=new Lae(d);return s.runWebGLProgram(u,[r,i],"float32")}const Qae={kernelName:of,backendName:"webgl",kernelFunc:Jae};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ele(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,dy:i}=e,{strides:o,pad:l,filterShape:c}=n,d=Ao(r.shape,c,o,1,l),u=new Gae(d);return s.runWebGLProgram(u,[r,i],"float32")}const tle={kernelName:T0,backendName:"webgl",kernelFunc:ele};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sle(t){const{inputs:e,backend:s,attrs:n}=t,{dy:r,filter:i}=e,{pad:o,strides:l,inputShape:c}=n,d=Ao(c,i.shape,l,1,o),u=new Hae(d);return s.runWebGLProgram(u,[r,i],"float32")}const nle={kernelName:A0,backendName:"webgl",kernelFunc:sle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rle=Ic+`
  return cos(x);
`,ile=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${ll}
  return result;
`,ole=At({opSnippet:rle,packedOpSnippet:ile}),ale={kernelName:Ad,backendName:"webgl",kernelFunc:ole};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lle=At({opSnippet:`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`}),cle={kernelName:Dd,backendName:"webgl",kernelFunc:lle};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dle{constructor(e,s,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,l,c,d]=e,[u]=s,[h,p]=n;this.outputShape=[u,h,p,d];const f=r==="bilinear"?1:0,[m,b]=[`${l-1}.0`,`${c-1}.0`],[g,x,y]=h>1?[`${(l-1)/(h-1)}`,"(y2-y1) * height_ratio",`y1*${m} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${m}`],[w,v,N]=p>1?[`${(c-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${b} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${b}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${w});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${x};
        float width_scale = ${v};

        float in_y = ${y};
        if( in_y < 0.0 || in_y > ${m} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${N};
        if( in_x < 0.0 || in_x > ${b} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${f} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ule={kernelName:_0,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:s,attrs:n}=t,{image:r,boxes:i,boxInd:o}=e,{cropSize:l,method:c,extrapolationValue:d}=n,u=new dle(r.shape,i.shape,l,c,d);return s.runWebGLProgram(u,[r,i,o],"float32")}};var ah;(function(t){t.Prod="*",t.Sum="+"})(ah||(ah={}));class VA{constructor(e,s,n,r){this.op=e,this.outputShape=s,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===ah.Prod?"1.0":"0.0",l=n?o:`getX(${WA(i,"coords",this.op)})`,c=this.outputShape[this.outputShape.length-1];let d="",u="";n?(d=r?`end != ${c-1}`:"end != 0",u=r?"end + 1":"end - 1"):(d=r?`end + pow2 < ${c}`:"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Ht(i)} coords = getOutputCoords();
        int end = ${GA(i,"coords",this.op)};
        float val = ${l};
        int pow2 = int(pow(2.0, index));
        if (${d}) {
          int idx = ${u};
          ${GA(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${WA(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function WA(t,e,s){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${s} for rank ${t} is not yet supported`)}function GA(t,e,s){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${s} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HA(t,e,s,n,r,i){const o=e.shape.length,l=cs([n],o);let c=e;l!=null&&(c=hn({inputs:{x:e},backend:s,attrs:{perm:l}}));const d=ms(1,o)[0];if(d!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${n}`);const u=c.shape[d];let h=Mn({inputs:{x:c},backend:s});for(let p=0;p<=Math.ceil(Math.log2(u))-1;p++){const f=new VA(t,c.shape,!1,i),m=[[p]],b=h;h=s.runWebGLProgram(f,[h],h.dtype,m),s.disposeIntermediateTensorInfo(b)}if(r){const p=new VA(t,c.shape,r,i),f=h;h=s.runWebGLProgram(p,[h],h.dtype),s.disposeIntermediateTensorInfo(f)}if(l!=null){const p=Do(l),f=hn({inputs:{x:h},backend:s,attrs:{perm:p}});return s.disposeIntermediateTensorInfo(h),s.disposeIntermediateTensorInfo(c),f}return h}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hle(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i,exclusive:o,reverse:l}=n;return HA(ah.Prod,r,s,i,o,l)}const ple={kernelName:D0,backendName:"webgl",kernelFunc:hle};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fle(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i,exclusive:o,reverse:l}=n;return HA(ah.Sum,r,s,i,o,l)}const mle={kernelName:af,backendName:"webgl",kernelFunc:fle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gle(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,weights:i}=e,{size:o,binaryOutput:l}=n;if(r.shape.length===1){const c=s.readSync(r.dataId),d=s.readSync(i.dataId),u=uA(c,d,i.dtype,i.shape,o);return s.makeTensorInfo([o],i.dtype,u)}else if(r.shape.length===2){const c=s.bufferSync(r),d=s.bufferSync(i),u=Sre(c,d,o,l);return s.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const xle={kernelName:R0,backendName:"webgl",kernelFunc:gle};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ble{constructor(e,s,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=s,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${s};
      int offset_h = imod(h, ${s});
      int in_w = w / ${s};
      int offset_w = imod(w, ${s});
      int offset_d = (offset_h * ${s} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yle(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{blockSize:i,dataFormat:o}=n,l=r.shape[0],c=o==="NHWC"?r.shape[1]:r.shape[2],d=o==="NHWC"?r.shape[2]:r.shape[3],u=o==="NHWC"?r.shape[3]:r.shape[1],h=c*i,p=d*i,f=u/(i*i),m=o==="NHWC"?[l,h,p,f]:[l,f,h,p],b=new ble(m,i,o);return s.runWebGLProgram(b,[r],r.dtype)}const wle={kernelName:P0,backendName:"webgl",kernelFunc:yle};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qA{constructor(e,s=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=sn(this.outputShape.length);const o=e.filterHeight,l=e.filterWidth,c=e.outChannels/e.inChannels;let d="",u="";n&&(r?d=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:i?d=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:d=`
          float activation(float x) {
            ${n}
          }
        `,u="result = activation(result);");const h=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${d}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${c};
        int q = d2 - d1 * ${c};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${l}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${h}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KA{constructor(e,s=!1,n=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=sn(this.outputShape.length);const o=e.outChannels/e.inChannels,l=e.padInfo.left,c=e.strideWidth,d=e.dilationWidth,u=e.filterHeight,h=e.filterWidth,p=h;let f=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<h;x++)f+=`
          vec4 xTexelC${x*2};
          int xTexelC${x*2}Ready;
          vec4 xTexelC${x*2+1};
          int xTexelC${x*2+1}Ready;
          vec4 xC${x};`;f+=`
    for (int r = 0; r < ${u}; r++) {
      `;for(let x=0;x<h;x++)f+=`
          xTexelC${x*2} = vec4(0.0);
          xTexelC${x*2}Ready = 0;
          xTexelC${x*2+1} = vec4(0.0);
          xTexelC${x*2+1}Ready = 0;
          xC${x} = vec4(0.0);`;f+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let x=0;x<(p+1)/2;x++){const y=x*2;if(f+=`
          xC = xCCorner + ${y*d};
          `,c===1){if(y<h&&(l%2===1?(f+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }
              `,d===1&&y>0?f+=`
                xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                `:f+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                  } else {
                    xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                  }
                  `):f+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xC${y} = xTexelC${y};
                `,y+1<h)){const w=l%2===0?u0(d):d;d%2===0&&l%2===1||d%2!==0&&l%2!==1?(f+=`
                  xCOffset = xC + imod(pads[1], 2) + ${w};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                    xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${y+1}.zw = vec2(0.0);
                    }
                    xTexelC${y+1}Ready = 1;
                  }
                  `,d>1?f+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                    } else {
                     xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                    }
                    `:f+=`
                    xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                    `):w===1?f+=`
                    xC${y+1} = xTexelC${y};
                    `:f+=`
                    xCOffset = xC + ${w};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                      xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${y+1}.zw = vec2(0.0);
                      }
                      xTexelC${y+1}Ready = 1;
                    }

                    xC${y+1} = xTexelC${y+1};
                    `}}else y<h&&(l%2===1?(f+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.0);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
              `,y+1<h&&(f+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                `)):(f+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(
                  xTexelC${y}.xy, xTexelC${y+1}.xy);
              `,y+1<h&&(f+=`
                  xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                `)));y<h&&(f+=`
            wTexel = getW(r, ${y}, d1, q);
            dotProd += xC${y} * vec4(wTexel.xz, wTexel.xz);
          `,y+1<h&&(f+=`
              wTexel = getW(r, ${y+1}, d1, q);
              dotProd += xC${y+1} * vec4(wTexel.xz, wTexel.xz);
            `))}f+=`
    }
  `,f+=`
      }
    `;let m="",b="";n&&(r?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:i?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:m=`vec4 activation(vec4 x) {
          ${n}
        }`,b="result = activation(result);");const g=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${m}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${f}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${b}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vle(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,filter:i}=e,{strides:o,pad:l,dilations:c,dimRoundingMode:d}=n;let u=c;u==null&&(u=[1,1]),A(Qs(o,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const h=Vs(r.shape,i.shape,o,u,l,d,!0);let p;oe().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?p=new KA(h):p=new qA(h);const f=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];return s.runWebGLProgram(p,[r,i],"float32",f)}const Nle={kernelName:lf,backendName:"webgl",kernelFunc:vle};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kle{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const s=e.strideHeight,n=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${s} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${n} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Cle{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const s=e.filterHeight,n=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=s-1-e.padInfo.top,l=n-1-e.padInfo.left,c=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${s}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${s} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${n} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${c}; dm++) {
              int d2 = d1 * ${c} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sle(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,dy:i}=e,{strides:o,dilations:l,pad:c,dimRoundingMode:d,filterShape:u}=n,h=Vs(r.shape,u,o,l,c,d,!0),p=new kle(h);return s.runWebGLProgram(p,[r,i],"float32")}const jle={kernelName:F0,backendName:"webgl",kernelFunc:Sle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ile(t){const{inputs:e,backend:s,attrs:n}=t,{dy:r,filter:i}=e,{strides:o,dilations:l,pad:c,dimRoundingMode:d,inputShape:u}=n,h=Vs(u,i.shape,o,l,c,d,!0),p=new Cle(h);return s.runWebGLProgram(p,[r,i],"float32")}const Ele={kernelName:O0,backendName:"webgl",kernelFunc:Ile};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $le{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tle(t){const{inputs:e,backend:s}=t,{x:n}=e,r=[...n.shape,...n.shape],i=pe(n.shape),o=Oe({inputs:{x:n},backend:s,attrs:{shape:[i]}}),l=new $le(i),c=s.runWebGLProgram(l,[o],o.dtype),d=Oe({inputs:{x:c},backend:s,attrs:{shape:r}});return s.disposeIntermediateTensorInfo(o),s.disposeIntermediateTensorInfo(c),d}const Ale={kernelName:Qk,backendName:"webgl",kernelFunc:Tle};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Dle{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:s,inWidth:n,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:l,filterWidth:c,dilationHeight:d,dilationWidth:u}=e,{top:h,left:p}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${h}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${l}; h++) {
          int hIn = hBeg + h * ${d};

          if (hIn >= 0 && hIn < ${s}) {
            for (int w = 0; w < ${c}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${n}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _le(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,filter:i}=e,{strides:o,pad:l,dilations:c}=n,d=vu(r.shape,i.shape,o,l,"NHWC",c);let u;const h=new Dle(d);u=s.runWebGLProgram(h,[r,i],"float32");const p=Oe({inputs:{x:u},backend:s,attrs:{shape:d.outShape}});return s.disposeIntermediateTensorInfo(u),p}const Rle={kernelName:cf,backendName:"webgl",kernelFunc:_le};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ple(t){const{inputs:e,backend:s,attrs:n}=t,{equation:r}=n,i=e,{allDims:o,summedDims:l,idDims:c}=Py(r,i.length);Oy(o.length,c,i);const{path:d,steps:u}=My(l,c),h=u.length;let p=null,f=o.length;const m=[];for(let b=0;b<h;++b){for(const g of u[b]){const{permutationIndices:x,expandDims:y}=Fy(f,c[g]);let w;Ly(x)?w=i[g]:(w=hn({inputs:{x:i[g]},backend:s,attrs:{perm:x}}),m.push(w));const v=w.shape.slice();for(let N=0;N<y.length;++N)v.splice(y[N],0,1);Ft(w.shape,v)||(w=Oe({inputs:{x:w},backend:s,attrs:{shape:v}}),m.push(w)),p===null?p=w:(p=Zw({inputs:{a:w,b:p},backend:s}),m.push(p))}b<h-1&&(d[b]>=0&&(p=cg({inputs:{x:p},backend:s,attrs:{axis:d[b]-(o.length-f),keepDims:!1}}),m.push(p)),f--)}for(const b of m)b!==p&&s.disposeIntermediateTensorInfo(b);return p}const Fle={kernelName:z0,backendName:"webgl",kernelFunc:Ple};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ole=At({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`}),Mle={kernelName:Rd,backendName:"webgl",kernelFunc:Ole};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lle="return (b >= 0.0) ? a : a * (b + 1.0);",zle=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Ble={kernelName:B0,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:s}=t,{dy:n,y:r}=e,i=oe().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new jc(zle,n.shape,r.shape):new al(Lle,n.shape,r.shape);return s.runWebGLProgram(i,[n,r],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ule=Hs({opSnippet:"return float(a == b);",packedOpSnippet:`
  return vec4(equal(a, b));
`,dtype:"bool",cpuKernelImpl:Tre}),Vle={kernelName:df,backendName:"webgl",kernelFunc:Ule};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wle=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${Iy};
  float a1 = ${Ey};
  float a2 = ${$y};
  float a3 = ${Ty};
  float a4 = ${Ay};
  float a5 = ${Dy};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Gle=At({opSnippet:Wle}),Hle={kernelName:Pd,backendName:"webgl",kernelFunc:Gle};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qle=Ic+`
  return exp(x);
`,XA=At({opSnippet:qle,packedOpSnippet:`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cpuKernelImpl:Are,dtype:"float32"}),Kle={kernelName:Fd,backendName:"webgl",kernelFunc:XA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tv(t){const{inputs:e,attrs:s,backend:n}=t,{dim:r}=s,{input:i}=e,o=i.shape.length,l=i.shape.slice();let c=r;return r<0&&(A(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),c=o+r+1),l.splice(c,0,1),Oe({inputs:{x:i},backend:n,attrs:{shape:l}})}const Xle={kernelName:uf,backendName:"webgl",kernelFunc:tv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YA="return exp(x) - 1.0;",Yle=At({opSnippet:YA,packedOpSnippet:YA,cpuKernelImpl:Dre}),Zle={kernelName:Od,backendName:"webgl",kernelFunc:Yle};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZA{constructor(e,s,n){this.variableNames=["real","imag"];const r=s[1];this.outputShape=s;const i=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=n?`${r}.0`:"1.0";let l;if(e==="real")l="return real * expR - imag * expI;";else if(e==="imag")l="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${l}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JA(t,e,s){const n=s.texData.get(t.dataId),r=pe(t.shape),i=t.shape[t.shape.length-1],o=r/i,l=Oe({inputs:{x:t},backend:s,attrs:{shape:[o,i]}}),c=l.shape,d=new ZA("real",c,e),u=new ZA("imag",c,e),h=[{dataId:n.complexTensorInfos.real.dataId,dtype:n.complexTensorInfos.real.dtype,shape:c},{dataId:n.complexTensorInfos.imag.dataId,dtype:n.complexTensorInfos.imag.dtype,shape:c}],p=s.runWebGLProgram(d,h,"float32"),f=s.runWebGLProgram(u,h,"float32"),m=Ko({inputs:{real:p,imag:f},backend:s});s.disposeIntermediateTensorInfo(p),s.disposeIntermediateTensorInfo(f);const b=Oe({inputs:{x:m},backend:s,attrs:{shape:t.shape}});return s.disposeIntermediateTensorInfo(l),s.disposeIntermediateTensorInfo(m),b}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jle(t){const{inputs:e,backend:s}=t,{input:n}=e;return JA(n,!1,s)}const Qle={kernelName:U0,backendName:"webgl",kernelFunc:Jle};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ece{constructor(e,s){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lh(t){const{backend:e,attrs:s}=t,{shape:n,value:r}=s;let{dtype:i}=s;if(i=i||Hl(r),i==="string"){const o=ps(i,pe(n));return o.fill(r),e.makeTensorInfo(n,i,o)}else{const o=new ece(n,r),l=[[r]];return e.runWebGLProgram(o,[],i,l)}}const tce={kernelName:V0,backendName:"webgl",kernelFunc:lh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sce{constructor(e){this.variableNames=["Image"],this.outputShape=[];const s=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${s} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${s}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nce={kernelName:W0,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:s}=t,n=e,r=new sce(s.shape);return n.runWebGLProgram(r,[s],s.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QA="return floor(x);",rce=At({opSnippet:QA,packedOpSnippet:QA,cpuKernelImpl:_re}),ice={kernelName:Md,backendName:"webgl",kernelFunc:rce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oce=Hs({opSnippet:`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,packedOpSnippet:`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,dtype:"int32"}),ace={kernelName:Ld,backendName:"webgl",kernelFunc:oce};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lce{constructor(e){this.variableNames=["A"];const s=dn(),[n,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${n}.0);

        vec4 values = ${s.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cce{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const s=dn(),[n,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${n}.0);
            vec4 values = ${s.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${s.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dce={kernelName:EU,backendName:"webgl",kernelFunc:uce};let $c,sv=oe().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function uce(t){const{inputs:e,backend:s,attrs:n}=t;let{pixels:r}=e;const{numChannels:i}=n,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,l=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[c,d]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],u=[d,c],h=[d,c,i];if(l||o){const b=oe().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");($c==null||b!==sv)&&(sv=b,$c=document.createElement("canvas").getContext("2d",{willReadFrequently:sv})),$c.canvas.width=c,$c.canvas.height=d,$c.drawImage(r,0,0,c,d),r=$c.canvas}const p=s.makeTensorInfo(u,"int32");s.texData.get(p.dataId).usage=Yn.PIXELS,s.gpgpu.uploadPixelDataToTexture(s.getTexture(p.dataId),r);const f=oe().getBool("WEBGL_PACK")?new cce(h):new lce(h),m=s.runWebGLProgram(f,[p],"int32");return s.disposeData(p.dataId),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hce(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,filter:i,bias:o,preluActivationWeights:l}=e,{strides:c,pad:d,dataFormat:u,dilations:h,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=n,b=Ji(u),g=Vs(r.shape,i.shape,c,h,d,p,!1,b);let x;const y=[],w=o!=null,v=l!=null,N=f==="leakyrelu",C=()=>{const I=[r,i],T=(E,$)=>{if($==="NCHW"&&E.shape.length===1&&E.shape[0]!==1){const D=Oe({inputs:{x:E},backend:s,attrs:{shape:[E.shape[0],1,1]}});return y.push(D),D}return E};if(w&&I.push(T(o,u)),v&&I.push(T(l,u)),N){const E=s.makeTensorInfo([],"float32",jo(m,"float32"));I.push(E),y.push(E)}return I};if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))x=BA({x:r,filter:i,convInfo:g,backend:s,bias:o,activation:f,preluActivationWeights:l,leakyreluAlpha:m});else if(g.strideWidth<=2&&b==="channelsLast"&&oe().getBool("WEBGL_EXP_CONV")){const I=f?nh(f,!0):null,T=new zA(g,w,I,v,N),E=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],$=C();x=s.runWebGLProgram(T,$,"float32",E)}else if(oe().getBool("WEBGL_CONV_IM2COL"))x=UA({x:r,filter:i,convInfo:g,backend:s,bias:o,activation:f,preluActivationWeights:l,leakyreluAlpha:m});else{const I=f?nh(f,!1):null,T=new LA(g,w,I,v,N),E=C();x=s.runWebGLProgram(T,E,"float32")}const j=Oe({inputs:{x},backend:s,attrs:{shape:g.outShape}});return y.push(x),y.forEach(I=>s.disposeIntermediateTensorInfo(I)),j}const pce={kernelName:Yf,backendName:"webgl",kernelFunc:hce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fce(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,filter:i,bias:o,preluActivationWeights:l}=e,{strides:c,pad:d,dilations:u,dimRoundingMode:h,activation:p,leakyreluAlpha:f}=n,m=[];let b=u;b==null&&(b=[1,1]),A(Qs(c,b),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${c} and dilations '${b}'`);const g=Vs(r.shape,i.shape,c,b,d,h,!0),x=oe().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,y=p?nh(p,x):null,w=[r,i],v=o!=null,N=l!=null,C=p==="leakyrelu";if(v&&w.push(o),N&&w.push(l),C){const E=s.makeTensorInfo([],"float32",jo(f,"float32"));w.push(E),m.push(E)}let j;x?j=new KA(g,v,y,N,C):j=new qA(g,v,y,N,C);const I=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],T=s.runWebGLProgram(j,w,"float32",I);return m.forEach(E=>s.disposeIntermediateTensorInfo(E)),T}const mce={kernelName:bC,backendName:"webgl",kernelFunc:fce};class gce{constructor(e,s,n,r){this.sliceDim=e,this.strides=s,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=n;const i=Ht(n.length);let o=`
    int index;`;for(let l=0;l<this.sliceDim;l++)o+=`
          index = round(getIndices(coords[0], ${l}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[l]};
          flattenIndex += index * ${this.strides[l]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xce(t){const{inputs:e,backend:s}=t,{params:n,indices:r}=e,i=r.shape,o=i[i.length-1],l=pe(n.shape),[c,d,u,h]=my(n,r),p=Oe({inputs:{x:r},backend:s,attrs:{shape:[d,o]}}),f=Oe({inputs:{x:n},backend:s,attrs:{shape:[pe(n.shape)/u,u]}});if(s.shouldExecuteOnCPU([n,r])||n.dtype==="string"){const x=s.readSync(r.dataId),y=s.bufferSync(n),w=Rre(x,y,n.dtype,d,o,u,h,n.shape,l);return s.makeTensorInfo(c,n.dtype,w.values)}const m=new gce(o,h,[d,u],n.shape),b=s.runWebGLProgram(m,[f,p],f.dtype),g=Oe({inputs:{x:b},backend:s,attrs:{shape:c}});return s.disposeIntermediateTensorInfo(p),s.disposeIntermediateTensorInfo(f),s.disposeIntermediateTensorInfo(b),g}const bce={kernelName:eC,backendName:"webgl",kernelFunc:xce};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yce{constructor(e,s){this.variableNames=["A","indices"],this.outputShape=s,this.rank=s.length;const n=Ht(this.rank),r=wce(e);this.userCode=`
      void main() {
        ${n} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function wce(t,e){const s=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[];for(let r=0;r<t.length;r++)r===2?n.push("index"):n.push(`${s[r]}`);return n.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eD(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,indices:i}=e,{axis:o,batchDims:l}=n,c=vt(o,r.shape)[0];if(oe().get("DEBUG")){const y=s.readSync(i.dataId),w=r.shape[c];for(let v=0;v<y.length;++v){const N=y[v];A(N<=w-1&&N>=0,()=>`GatherV2: the index value ${N} is not in [0, ${w-1}]`)}}const d=Uy(r,i,c,l),u=pe(i.shape),h=[],p=Oe({inputs:{x:r},backend:s,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),f=Oe({inputs:{x:i},backend:s,attrs:{shape:[d.batchSize,u/d.batchSize]}});h.push(p),h.push(f);const m=[d.batchSize,d.outerSize,u/d.batchSize,d.sliceSize];if(s.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const y=s.bufferSync(f),w=s.bufferSync(p),v=Pre(w,y,m);return h.forEach(N=>s.disposeIntermediateTensorInfo(N)),s.makeTensorInfo(d.outputShape,v.dtype,v.values)}const b=new yce(p.shape,m),g=s.runWebGLProgram(b,[p,f],p.dtype);h.push(g);const x=Oe({inputs:{x:g},backend:s,attrs:{shape:d.outputShape}});return h.forEach(y=>s.disposeIntermediateTensorInfo(y)),x}const vce={kernelName:pf,backendName:"webgl",kernelFunc:eD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nce=Hs({opSnippet:"return float(a > b);",packedOpSnippet:`
  return vec4(greaterThan(a, b));
`,cpuKernelImpl:Fre,dtype:"bool"}),kce={kernelName:ff,backendName:"webgl",kernelFunc:Nce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cce=Hs({opSnippet:"return float(a >= b);",packedOpSnippet:`
  return vec4(greaterThanEqual(a, b));
`,dtype:"bool",cpuKernelImpl:Ore}),Sce={kernelName:zd,backendName:"webgl",kernelFunc:Cce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jce(t){const{inputs:e,backend:s}=t,{input:n}=e;return JA(n,!0,s)}const Ice={kernelName:G0,backendName:"webgl",kernelFunc:jce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ece=At({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),$ce={kernelName:Ud,backendName:"webgl",kernelFunc:Ece};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tce=At({opSnippet:"return float(isinf(x));",dtype:"bool"}),Ace={kernelName:Vd,backendName:"webgl",kernelFunc:Tce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dce=At({opSnippet:"return float(isnan(x));",dtype:"bool"}),_ce={kernelName:Wd,backendName:"webgl",kernelFunc:Dce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rce=Hs({opSnippet:"return float(a < b);",packedOpSnippet:`
  return vec4(lessThan(a, b));
`,cpuKernelImpl:Mre,dtype:"bool"}),Pce={kernelName:gf,backendName:"webgl",kernelFunc:Rce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fce=Hs({opSnippet:"return float(a <= b);",packedOpSnippet:`
  return vec4(lessThanEqual(a, b));
`,cpuKernelImpl:Lre,dtype:"bool"}),Oce={kernelName:xf,backendName:"webgl",kernelFunc:Fce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mce(t){const{backend:e,attrs:s}=t,{start:n,stop:r,num:i}=s,o=zre(n,r,i);return e.makeTensorInfo([o.length],"float32",o)}const Lce={kernelName:tC,backendName:"webgl",kernelFunc:Mce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zce=Ic+`
  return x < 0.0 ? 0./0. : log(x);
`,Bce=At({opSnippet:zce,packedOpSnippet:`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,cpuKernelImpl:Bre}),Uce={kernelName:Gd,backendName:"webgl",kernelFunc:Bce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vce=Ic+`
  return log(1.0 + x);
`,Wce=At({opSnippet:Vce}),Gce={kernelName:Hd,backendName:"webgl",kernelFunc:Wce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hce=Hs({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,dtype:"bool"}),qce={kernelName:bf,backendName:"webgl",kernelFunc:Hce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kce=At({opSnippet:"return float(!(x >= 1.0));"}),Xce={kernelName:yf,backendName:"webgl",kernelFunc:Kce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yce=Hs({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,dtype:"bool"}),Zce={kernelName:wf,backendName:"webgl",kernelFunc:Yce};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jce{constructor(e,s,n,r,i){this.variableNames=["x"],this.outputShape=[];const o=s,l=e[3]-1;this.outputShape=e;let c;const d=`float(${n}) + float(${r}) * sum`;i===.5?c=`inversesqrt(${d})`:i===1?c=`1.0/(${d})`:c=`exp(log(${d}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${l}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${c};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qce{constructor(e,s,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=s,l=e[3]-1;this.outputShape=e;let c;const d=`float(${n}) + float(${r}) * sum`;i===.5?c=`inversesqrt(${d})`:i===1?c=`1.0/(${d})`:c=`exp(log(${d}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${l}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${c};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ede={kernelName:vf,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{depthRadius:i,bias:o,alpha:l,beta:c}=n,d=oe().getBool("WEBGL_PACK_NORMALIZATION")?new Qce(r.shape,i,o,l,c):new Jce(r.shape,i,o,l,c);return s.runWebGLProgram(d,[r],r.dtype)}};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tde{constructor(e,s,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=s,this.bias=n,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${s})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${s} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${n});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sde={kernelName:q0,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:s,attrs:n}=t,{x:r,y:i,dy:o}=e,{depthRadius:l,bias:c,alpha:d,beta:u}=n,h=new tde(r.shape,l,c,d,u);return s.runWebGLProgram(h,[r,i,o],r.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nde(t,e,s,n){const r=pe(e),o=pe(t.shape)/r,l=Oe({inputs:{x:t},attrs:{shape:[o,r]},backend:n}),c=cl(l,t.dtype,"max",n),d=Oe({inputs:{x:c},attrs:{shape:s},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),d}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tD(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{reductionIndices:i,keepDims:o}=n,l=r.shape.length,c=vt(i,r.shape);let d=c;const u=cs(d,l),h=u!=null,p=s.shouldExecuteOnCPU([r]);let f=r;if(h){if(p){const w=s.texData.get(f.dataId).values,v=new Array(l);for(let j=0;j<v.length;j++)v[j]=r.shape[u[j]];const N=Xw(w,r.shape,r.dtype,u,v);f=s.makeTensorInfo(v,r.dtype);const C=s.texData.get(f.dataId);C.values=N}else f=lg(r,u,s);d=ms(d.length,l)}Ws("max",d,l);const[m,b]=Fs(f.shape,d);let g=m;o&&(g=ks(m,c));let x;if(p){const w=s.texData.get(f.dataId).values,v=Ure(w,pe(b),g,r.dtype);x=s.makeTensorInfo(g,r.dtype);const N=s.texData.get(x.dataId);N.values=v}else x=nde(f,b,g,s);return h&&s.disposeIntermediateTensorInfo(f),x}const rde={kernelName:Nf,backendName:"webgl",kernelFunc:tD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ide=Yw+`
  return max(a, b);
`,ode=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ll+`
  return result;
`,ade=Hs({opSnippet:ide,packedOpSnippet:ode,cpuKernelImpl:Vre}),lde={kernelName:qd,backendName:"webgl",kernelFunc:ade};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cde(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e;th(r,"maxPool");const{filterSize:i,strides:o,pad:l,dimRoundingMode:c}=n,d=1;A(Qs(o,d),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${d}'`);const u=hr(r.shape,i,o,d,l,c);if(u.filterWidth===1&&u.filterHeight===1&&Ft(u.inShape,u.outShape))return Mn({inputs:{x:r},backend:s});const h=new rh(u,"max",!1);return s.runWebGLProgram(h,[r],r.dtype)}const dde={kernelName:kf,backendName:"webgl",kernelFunc:cde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ude(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{filterSize:i,strides:o,pad:l,dataFormat:c,dimRoundingMode:d}=n,u=[1,1,1],h=Zi(r.shape,i,o,u,l,d,c),p=new Jw(h,"max",!1);return s.runWebGLProgram(p,[r],r.dtype)}const hde={kernelName:Cf,backendName:"webgl",kernelFunc:ude};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pde{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const s=e.strideHeight,n=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,l=i-1-e.padInfo.top,c=o-1-e.padInfo.left,d=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${l}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${s}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${n}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${d} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class fde{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const s=e.strideDepth,n=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,d=e.effectiveFilterHeight,u=e.effectiveFilterWidth,h=c-1-e.padInfo.front,p=d-1-e.padInfo.top,f=u-1-e.padInfo.left,m=c*d*u-1;this.userCode=`
      const ivec3 pads = ivec3(${h}, ${p}, ${f});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${c};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${s}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${d};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${n}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${l}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${m} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${d} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mde(t){const{inputs:e,backend:s,attrs:n}=t,{dy:r,input:i}=e,o=i,{filterSize:l,strides:c,pad:d,dimRoundingMode:u}=n,h=[1,1,1],p=Zi(o.shape,l,c,h,d,u),f=new Jw(p,"max",!0),m=s.runWebGLProgram(f,[o],o.dtype),b=new fde(p),g=s.runWebGLProgram(b,[r,m],o.dtype);return s.disposeIntermediateTensorInfo(m),g}const gde={kernelName:X0,backendName:"webgl",kernelFunc:mde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xde(t){const{inputs:e,backend:s,attrs:n}=t,{dy:r,input:i,output:o}=e,l=i;th([i,o],"maxPoolGrad");const{filterSize:c,strides:d,pad:u,dimRoundingMode:h}=n,p=hr(l.shape,c,d,1,u,h),f=!0,m=new rh(p,"max",f),b=s.runWebGLProgram(m,[l],l.dtype),g=new pde(p),x=s.runWebGLProgram(g,[r,b],l.dtype);return s.disposeIntermediateTensorInfo(b),x}const bde={kernelName:K0,backendName:"webgl",kernelFunc:xde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yde(t,e,s,n){let r=new rh(s,"max",!1);const i=n.runWebGLProgram(r,[t],"float32");r=new rh(s,"max",!0,!0,e);const o=n.runWebGLProgram(r,[t],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wde={kernelName:sC,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:s})=>{const{x:n}=t,{filterSize:r,strides:i,pad:o,includeBatchInIndex:l}=e,c=s;A(n.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${n.shape.length}.`);const d=[1,1];A(Qs(i,d),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${d}'`);const u=hr(n.shape,r,i,d,o),[h,p]=yde(n,l,u,c);return[h,p]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vde(t,e,s,n){const r=pe(e),o=pe(t.shape)/r,l=Oe({inputs:{x:t},attrs:{shape:[o,r]},backend:n}),c=cl(l,"float32","mean",n),d=Oe({inputs:{x:c},attrs:{shape:s},backend:n});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(c),d}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nde={kernelName:Sf,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:s})=>{const{x:n}=t,{keepDims:r,axis:i}=e,o=s,l=n.shape.length,c=vt(i,n.shape);let d=c;const u=cs(d,l),h=u!=null,p=o.shouldExecuteOnCPU([n]),f=[];let m=n;if(h){if(p){const v=o.texData.get(m.dataId).values,N=new Array(l);for(let I=0;I<N.length;I++)N[I]=n.shape[u[I]];const C=Xw(v,n.shape,n.dtype,u,N);m=o.makeTensorInfo(N,n.dtype);const j=o.texData.get(m.dataId);j.values=C}else m=lg(n,u,o);f.push(m),d=ms(d.length,l)}Ws("sum",d,l);const[b,g]=Fs(m.shape,d);let x=b;r&&(x=ks(b,c));const y=vde(m,g,x,o);for(const w of f)o.disposeIntermediateTensorInfo(w);return y}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kde(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i,keepDims:o}=n,l=r.shape.length,c=vt(i,r.shape);let d=c;const u=cs(d,l);let h=r;u!=null&&(h=hn({inputs:{x:r},backend:s,attrs:{perm:u}}),d=ms(d.length,r.shape.length)),Ws("min",d,l);const[p,f]=Fs(h.shape,d),m=pe(f),b=Oe({inputs:{x:h},backend:s,attrs:{shape:[-1,m]}}),g=cl(b,b.dtype,"min",s);let x;if(o){const y=ks(p,c);x=Oe({inputs:{x:g},backend:s,attrs:{shape:y}})}else x=Oe({inputs:{x:g},backend:s,attrs:{shape:p}});return s.disposeIntermediateTensorInfo(b),s.disposeIntermediateTensorInfo(g),u!=null&&s.disposeIntermediateTensorInfo(h),x}const Cde={kernelName:jf,backendName:"webgl",kernelFunc:kde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sde=Yw+`
  return min(a, b);
`,jde=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ll+`
  return result;
`,Ide=Hs({opSnippet:Sde,packedOpSnippet:jde,cpuKernelImpl:Wre}),Ede={kernelName:Kd,backendName:"webgl",kernelFunc:Ide};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $de{constructor(e,s,n){this.variableNames=["x"],this.outputShape=s.map((u,h)=>u[0]+e[h]+u[1]);const r=e.length,i=Ht(r),o=s.map(u=>u[0]).join(","),l=s.map((u,h)=>u[0]+e[h]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),d=n==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${l};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${d};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${d};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${l});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${d};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${d};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${c}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tde{constructor(e,s,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s.map((m,b)=>m[0]+e[b]+m[1]);const r=e.length,i=Ht(r),o=s.map(m=>m[0]).join(","),l=s.map((m,b)=>m[0]+e[b]).join(","),c=un("rc",r),d=un("source",r),u=`${c[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${d.slice(-2).join()})`,p=n==="reflect"?0:1;let f="";if(r===1){const m=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${d.join()}), ${h});
        ${c[r-1]} += 1;
        if(${u}) {
          ${m}
          result[1] = getChannel(getX(${d.join()}), ${h});
        }
      `}else{const m=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${d.join()}), ${h});
        ${c[r-1]} += 1;
        if(${u}) {
          ${m}
          result[1] = getChannel(getX(${d.join()}), ${h});
        }
        rc = outputLoc;
        ${c[r-2]} += 1;
        if(${c[r-2]} < ${this.outputShape[r-2]}) {
          ${m}
          result[2] = getChannel(getX(${d.join()}), ${h});
          ${c[r-1]} += 1;
          if(${u}) {
            ${m}
            result[3] = getChannel(getX(${d.join()}), ${h});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${l});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ade={kernelName:If,backendName:"webgl",kernelFunc:({inputs:t,backend:e,attrs:s})=>{const{x:n}=t,{paddings:r,mode:i}=s,o=oe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Tde(n.shape,r,i):new $de(n.shape,r,i);return e.runWebGLProgram(o,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dde=`if (b == 0.0) return NAN;
  return mod(a, b);`,_de=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+ll+`
  return result;
`,Rde=Hs({opSnippet:Dde,packedOpSnippet:_de}),Pde={kernelName:Xd,backendName:"webgl",kernelFunc:Rde};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fde{constructor(e,s,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${s-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${s-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sD=Hs({opSnippet:`
if (a == b) {
  return 1.0;
};
return a / b;`,packedOpSnippet:`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,checkOutOfBounds:!0}),Ode={kernelName:_d,backendName:"webgl",kernelFunc:sD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nD="return a - b;",rD=Hs({opSnippet:nD,packedOpSnippet:nD,supportsComplex:!0,cpuKernelImpl:uie}),Mde={kernelName:uu,backendName:"webgl",kernelFunc:rD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iD(t){const{inputs:e,backend:s,attrs:n}=t,{logits:r}=e,{dim:i}=n,o=vt([i],r.shape),l=tD({inputs:{x:r},backend:s,attrs:{reductionIndices:o,keepDims:!1}}),c=ks(l.shape,o),d=Oe({inputs:{x:l},backend:s,attrs:{shape:c}}),u=rD({inputs:{a:r,b:d},backend:s}),h=XA({inputs:{x:u},backend:s}),p=cg({inputs:{x:h},backend:s,attrs:{axis:o,keepDims:!1}}),f=Oe({inputs:{x:p},backend:s,attrs:{shape:c}}),m=sD({inputs:{a:h,b:f},backend:s});return s.disposeIntermediateTensorInfo(l),s.disposeIntermediateTensorInfo(d),s.disposeIntermediateTensorInfo(u),s.disposeIntermediateTensorInfo(h),s.disposeIntermediateTensorInfo(p),s.disposeIntermediateTensorInfo(f),m}const Lde={kernelName:Gf,backendName:"webgl",kernelFunc:iD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zde(t){const{inputs:e,backend:s,attrs:n}=t,{logits:r}=e,{numSamples:i,seed:o,normalized:l}=n,c=l?r:iD({inputs:{logits:r},backend:s,attrs:{dim:r.shape.length-1}}),d=c.shape[0],u=c.shape[1],h=new Fde(d,u,i),p=[[o]],f=s.runWebGLProgram(h,[c],"int32",p);return l||s.disposeIntermediateTensorInfo(c),f}const Bde={kernelName:nC,backendName:"webgl",kernelFunc:zde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ude=vr+`
  return -x;
`,Vde=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Wde(t){const{inputs:e,backend:s}=t,{x:n}=e;if(s.shouldExecuteOnCPU([n])){const i=s.texData.get(n.dataId),[o,l]=Hre(i.values,n.shape,n.dtype);return s.makeTensorInfo(l,n.dtype,o)}let r;return oe().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new qo(n.shape,Vde):r=new ki(n.shape,Ude),s.runWebGLProgram(r,[n],n.dtype)}const Gde={kernelName:Ef,backendName:"webgl",kernelFunc:Wde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hde=cy;function qde(t){Gn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:s,attrs:n}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:l,scoreThreshold:c}=n,d=s.readSync(r.dataId),u=s.readSync(i.dataId),{selectedIndices:h}=Hde(d,u,o,l,c);return s.makeTensorInfo([h.length],"int32",new Int32Array(h))}const Kde={kernelName:Y0,backendName:"webgl",kernelFunc:qde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xde=dy;function Yde(t){Gn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:s,attrs:n}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:l,scoreThreshold:c,padToMaxOutputSize:d}=n,u=s.readSync(r.dataId),h=s.readSync(i.dataId),{selectedIndices:p,validOutputs:f}=Xde(u,h,o,l,c,d);return[s.makeTensorInfo([p.length],"int32",new Int32Array(p)),s.makeTensorInfo([],"int32",new Int32Array([f]))]}const Zde={kernelName:Z0,backendName:"webgl",kernelFunc:Yde};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jde=uy;function Qde(t){Gn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:s,attrs:n}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:l,scoreThreshold:c,softNmsSigma:d}=n,u=s.readSync(r.dataId),h=s.readSync(i.dataId),p=o,f=l,m=c,b=d,{selectedIndices:g,selectedScores:x}=Jde(u,h,p,f,m,b);return[s.makeTensorInfo([g.length],"int32",new Int32Array(g)),s.makeTensorInfo([x.length],"float32",new Float32Array(x))]}const eue={kernelName:J0,backendName:"webgl",kernelFunc:Qde};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tue{constructor(e,s,n,r){this.variableNames=["indices"],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${n}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sue={kernelName:Af,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:s,attrs:n}=t,{indices:r}=e,{dtype:i,depth:o,onValue:l,offValue:c}=n,d=pe(r.shape),u=new tue(d,o,l,c),h=Oe({inputs:{x:r},backend:s,attrs:{shape:[d]}}),p=s.runWebGLProgram(u,[h],i);s.disposeIntermediateTensorInfo(h);const f=[...r.shape,o],m=Oe({inputs:{x:p},backend:s,attrs:{shape:f}});return s.disposeIntermediateTensorInfo(p),m}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mg(t){const{inputs:e,backend:s}=t,{x:n}=e;if(n.dtype==="complex64"){const r=ih({inputs:{input:n},backend:s}),i=mg({inputs:{x:r},backend:s}),o=pg({inputs:{input:n},backend:s}),l=mg({inputs:{x:o},backend:s}),c=Ko({inputs:{real:i,imag:l},backend:s});return s.disposeIntermediateTensorInfo(r),s.disposeIntermediateTensorInfo(i),s.disposeIntermediateTensorInfo(o),s.disposeIntermediateTensorInfo(l),c}else return lh({attrs:{shape:n.shape,dtype:n.dtype,value:n.dtype==="string"?"":0},backend:s})}const nue={kernelName:Kf,backendName:"webgl",kernelFunc:mg};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oD(t){const{inputs:e,backend:s}=t,{x:n}=e;if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(n.dtype==="complex64"){const r=ih({inputs:{input:n},backend:s}),i=oD({inputs:{x:r},backend:s}),o=pg({inputs:{input:n},backend:s}),l=mg({inputs:{x:o},backend:s}),c=Ko({inputs:{real:i,imag:l},backend:s});return s.disposeIntermediateTensorInfo(r),s.disposeIntermediateTensorInfo(i),s.disposeIntermediateTensorInfo(o),s.disposeIntermediateTensorInfo(l),c}else return lh({attrs:{shape:n.shape,dtype:n.dtype,value:1},backend:s})}const rue={kernelName:Tf,backendName:"webgl",kernelFunc:oD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iue(t){const{inputs:e,backend:s,attrs:n}=t,{axis:r}=n;if(e.length===1)return tv({inputs:{input:e[0]},backend:s,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(u=>{h0(i,u.shape,"All tensors passed to stack must have matching shapes"),A(o===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const l=[],c=e.map(u=>{const h=tv({inputs:{input:u},backend:s,attrs:{dim:r}});return l.push(h),h}),d=MA({inputs:c,backend:s,attrs:{axis:r}});return l.forEach(u=>s.disposeIntermediateTensorInfo(u)),d}const oue={kernelName:Df,backendName:"webgl",kernelFunc:iue};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aue{constructor(e,s,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=s.map((d,u)=>d[0]+e[u]+d[1]);const r=e.length,i=Ht(r),o=s.map(d=>d[0]).join(","),l=s.map((d,u)=>d[0]+e[u]).join(","),c=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${l};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${l});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${c}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lue{constructor(e,s,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=s.map((b,g)=>b[0]+e[g]+b[1]);const r=e.length,i=Ht(r),o=s.map(b=>b[0]).join(","),l=s.map((b,g)=>b[0]+e[g]).join(","),c=un("rc",r),d=un("source",r),u=`${c[r-1]} < ${this.outputShape[r-1]}`,h=r===1?"source":`vec2(${d.slice(-2).join()})`,p=[`${i} rc = outputLoc;`,`${c[r-1]} += 1;
       if(${u}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${c[r-2]} += 1;
       if(${c[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${c[r-1]} += 1;
         if(${u}) {`],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let m="";for(let b=0,g=r===1?2:4;b<g;b++)m+=`
        ${p[b]}
        if (${f}) {
          result[${b}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${b}] = getChannel(getX(${d.join()}), ${h});
        }
      `;m+=r===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${l});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aD=t=>{const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{paddings:i,constantValue:o}=n;if(pe(r.shape)===0){const d=i.map((u,h)=>u[0]+r.shape[h]+u[1]);return lh({backend:s,attrs:{shape:d,value:o,dtype:r.dtype}})}const l=oe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new lue(r.shape,i,o):new aue(r.shape,i,o),c=[[o]];return s.runWebGLProgram(l,[r],r.dtype,c)},cue={kernelName:_f,backendName:"webgl",kernelFunc:aD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const due=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,uue=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+ll+`
  return result;
`,hue=Hs({opSnippet:due,packedOpSnippet:uue}),pue={kernelName:Zd,backendName:"webgl",kernelFunc:hue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fue(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{axis:i,keepDims:o}=n,l=r.shape.length,c=[],d=vt(i,r.shape);let u=d;const h=cs(u,l);let p=r;h!=null&&(p=hn({inputs:{x:r},backend:s,attrs:{perm:h}}),u=ms(u.length,l),c.push(p)),Ws("prod",u,l);let f;if(s.shouldExecuteOnCPU([p])){const m=s.texData.get(p.dataId).values,{outVals:b,outShape:g,outDtype:x}=Kre(p.shape,p.dtype,m,u);f=s.makeTensorInfo(g,x,b)}else{const[m,b]=Fs(p.shape,u),g=pe(b),x=Oe({inputs:{x:p},backend:s,attrs:{shape:[-1,g]}}),y=yb(r.dtype),w=cl(x,y,"prod",s);f=Oe({inputs:{x:w},backend:s,attrs:{shape:m}}),c.push(x),c.push(w)}if(o){c.push(f);const m=ks(f.shape,d);f=Oe({inputs:{x:f},backend:s,attrs:{shape:m}})}return c.forEach(m=>s.disposeIntermediateTensorInfo(m)),f}const mue={kernelName:Pf,backendName:"webgl",kernelFunc:fue};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gue(t){const{inputs:e,backend:s,attrs:n}=t,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:l}=n,c=r.map(x=>s.readSync(x.dataId)),d=r.map(x=>x.shape),u=s.readSync(i.dataId),h=s.readSync(o.dataId),[p,f,m]=Xre(c,d,u,i.shape,i.dtype,h,o.shape,l),b=p.map(x=>s.makeTensorInfo([x.length],"int32",x)),g=s.makeTensorInfo(m,i.dtype,f);return b.concat([g])}const xue={kernelName:rC,backendName:"webgl",kernelFunc:gue};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bue(t){const{inputs:e,backend:s}=t,{starts:n,limits:r,deltas:i}=e,o=s.readSync(n.dataId),l=s.readSync(r.dataId),c=s.readSync(i.dataId),[d,u]=Yre(o,n.shape,n.dtype,l,r.shape,c,i.shape),h=s.makeTensorInfo([d.length],"int32",d),p=s.makeTensorInfo([u.length],n.dtype,u);return[h,p]}const yue={kernelName:iC,backendName:"webgl",kernelFunc:bue};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wue(t){const{inputs:e,backend:s,attrs:n}=t,{shape:r,values:i,defaultValue:o,rowPartitionTensors:l}=e,{rowPartitionTypes:c}=n,d=s.readSync(r.dataId),u=s.readSync(i.dataId),h=s.readSync(o.dataId),p=l.map(g=>s.readSync(g.dataId)),f=l.map(g=>g.shape),[m,b]=Zre(d,r.shape,u,i.shape,i.dtype,h,o.shape,p,f,c);return s.makeTensorInfo(m,i.dtype,b)}const vue={kernelName:oC,backendName:"webgl",kernelFunc:wue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lD=t=>{const{backend:e,attrs:s}=t,{start:n,stop:r,step:i,dtype:o}=s,l=Jre(n,r,i,o);return e.makeTensorInfo([l.length],o,l)},Nue={kernelName:Q0,backendName:"webgl",kernelFunc:lD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kue=At({opSnippet:"return 1.0 / x;"}),Cue={kernelName:Jd,backendName:"webgl",kernelFunc:kue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sue=vr+`
  return (x < 0.0) ? 0.0 : x;
`,jue=At({opSnippet:Sue,packedOpSnippet:`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`}),Iue={kernelName:Qd,backendName:"webgl",kernelFunc:jue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eue=vr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,$ue=At({opSnippet:Eue,packedOpSnippet:`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`}),Tue={kernelName:eu,backendName:"webgl",kernelFunc:$ue};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Aue{constructor(e,s,n,r,i){this.variableNames=["A"],this.outputShape=[];const[o,l,c,d]=e;this.outputShape=[o,s,n,d];const u=[r&&s>1?l-1:l,r&&n>1?c-1:c],h=[r&&s>1?s-1:s,r&&n>1?n-1:n];let p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/h[0]},
          ${u[1]/h[1]});
      const vec2 inputShapeRC = vec2(${l}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Due{constructor(e,s,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,l,c,d]=e;this.outputShape=[o,s,n,d];const u=[r&&s>1?l-1:l,r&&n>1?c-1:c],h=[r&&s>1?s-1:s,r&&n>1?n-1:n];let p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/h[0]},
          ${u[1]/h[1]},
          ${u[1]/h[1]});
      const vec3 inputShapeRC = vec3(${l}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${d-1};
        bool hasNextRow = coords.z < ${n-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ue(t){const{inputs:e,backend:s,attrs:n}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:l}=n,[c,d]=l,u=oe().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Due(r.shape,c,d,i,o):new Aue(r.shape,c,d,i,o);return s.runWebGLProgram(u,[r],"float32")}const Rue={kernelName:Mf,backendName:"webgl",kernelFunc:_ue};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pue{constructor(e,s,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=s;const[,r,i]=s,[,o,l]=e,c=[n&&o>1?r-1:r,n&&l>1?i-1:i],d=[n&&o>1?o-1:o,n&&l>1?l-1:l],u=c[0]/d[0],h=c[1]/d[1],p=1/u,f=1/h,m=Math.ceil(p)*2+2,b=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${h});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${f});

        const int winHeight = int(${m});
        const int winWidth = int(${b});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${l}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fue(t){const{inputs:e,backend:s,attrs:n}=t,{images:r,dy:i}=e,{alignCorners:o}=n,l=new Pue(i.shape,r.shape,o);return s.runWebGLProgram(l,[i],i.dtype)}const Oue={kernelName:sb,backendName:"webgl",kernelFunc:Fue};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mue{constructor(e,s,n,r,i){this.variableNames=["A"],this.outputShape=[];const[o,l,c,d]=e;this.outputShape=[o,s,n,d];const u=[r&&s>1?l-1:l,r&&n>1?c-1:c],h=[r&&s>1?s-1:s,r&&n>1?n-1:n],p=r?"0.5":"0.0";let f;i?f="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/h[0]},
          ${u[1]/h[1]});
      const vec2 inputShapeRC = vec2(${l}.0, ${c}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lue{constructor(e,s,n,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,l,c,d]=e;this.outputShape=[o,s,n,d];const u=[r&&s>1?l-1:l,r&&n>1?c-1:c],h=[r&&s>1?s-1:s,r&&n>1?n-1:n],p=r?"0.5":"0.0";let f;i?f="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/h[0]},
          ${u[1]/h[1]},
          ${u[1]/h[1]});
      const vec3 inputShapeRC = vec3(${l}.0, ${c}.0,
                                     ${c}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${d-1};
        bool hasNextRow = coords.z < ${n-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zue(t){const{inputs:e,backend:s,attrs:n}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:l}=n,[c,d]=l,u=oe().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Lue(r.shape,c,d,i,o):new Mue(r.shape,c,d,i,o);return s.runWebGLProgram(u,[r],r.dtype)}const Bue={kernelName:Of,backendName:"webgl",kernelFunc:zue};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Uue{constructor(e,s,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=s;const[,r,i]=s,[,o,l]=e,c=[n&&o>1?r-1:r,n&&l>1?i-1:i],d=[n&&o>1?o-1:o,n&&l>1?l-1:l],u=c[0]/d[0],h=c[1]/d[1],p=1/u,f=1/h,m=Math.ceil(p)*2+2,b=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${h});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${f});

        const int winHeight = int(${m});
        const int winWidth = int(${b});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${l}) {
              continue;
            }

            float sourceFracRow =
              float(${c[0]}) *
                (float(dyR) / float(${d[0]}));

            float sourceFracCol =
                float(${c[1]}) *
                  (float(dyC) / float(${d[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${n} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${n} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vue(t){const{inputs:e,backend:s,attrs:n}=t,{images:r,dy:i}=e,{alignCorners:o}=n,l=new Uue(i.shape,r.shape,o);return s.runWebGLProgram(l,[i],i.dtype)}const Wue={kernelName:tb,backendName:"webgl",kernelFunc:Vue};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gue{constructor(e,s){this.variableNames=["x"];const n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=e,n===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=l=>s.indexOf(l)!==-1&&e[l]!==1?`${e[l]} - coords[${l}] - 1`:`coords[${l}]`,i=e.map((l,c)=>r(c)).join(","),o=Ht(n);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hue{constructor(e,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=e;const r=un("rc",n),i=`${r[n-1]} + 1 < ${this.outputShape[n-1]}`,o=`${r[n-2]} + 1 < ${this.outputShape[n-2]}`,l=Ht(n);n===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${l} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${c(r.slice())};
          if(${i}){
            result.g = ${d(r.slice())};
          }
          if(${o}) {
            result.b = ${u(r.slice())};
            if(${i}) {
              result.a = ${h(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function c(m){return p(m)}function d(m){return m[n-1]="("+m[n-1]+" + 1)",p(m)}function u(m){return m[n-2]="("+m[n-2]+" + 1)",p(m)}function h(m){return m[n-1]="("+m[n-1]+" + 1)",m[n-2]="("+m[n-2]+" + 1)",p(m)}function p(m){const b=e.map((y,w)=>f(w,m)),g=b.join(","),x=b.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${x}))`}function f(m,b){return s.indexOf(m)!==-1&&e[m]!==1?`${e[m]} - ${b[m]} - 1`:`${b[m]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function que(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{dims:i}=n,o=r.shape.length,l=vt(i,r.shape);if(o===0)return Mn({inputs:{x:r},backend:s});const c=oe().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Hue(r.shape,l):new Gue(r.shape,l);return s.runWebGLProgram(c,[r],r.dtype)}const Kue={kernelName:Lf,backendName:"webgl",kernelFunc:que};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xue{constructor(e,s){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const n=e[1],r=e[2];this.outputShape=e;let i="";typeof s=="number"?i=`float outputValue = ${s.toFixed(2)};`:i=`
        vec3 fill = vec3(${s.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${n}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yue={kernelName:cb,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:s})=>{const{image:n}=t,{radians:r,fillValue:i,center:o}=e,l=s,c=new Xue(n.shape,i),[d,u]=Cy(o,n.shape[1],n.shape[2]),h=[[d,u,Math.sin(r),Math.cos(r)]];return l.runWebGLProgram(c,[n],n.dtype,h)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zue=At({opSnippet:`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`}),Jue={kernelName:tu,backendName:"webgl",kernelFunc:Zue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Que=At({opSnippet:"return inversesqrt(x);",cpuKernelImpl:Qre}),ehe={kernelName:su,backendName:"webgl",kernelFunc:Que};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nv{constructor(e,s,n,r,i,o,l=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const d=Ht(i.length),u=Ht(o.length);let h="";n===1?h="i":n===2&&(h="i, j");const p=`getIndices(${h})`;let f="";r===1?f="i":r===2&&(f="i, coords[1]");const m=`getUpdates(${f})`;let b="";c&&(b="coords[0], coords[1]");const g=`getDefaultValue(${b})`,x=s>1?"strides[j]":"strides";this.userCode=`
        ${d} strides = ${d}(${i});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${s}; j++) {
              int index = round(${p});
              flattenedIndex += index * ${x};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${m};
              found = true;
            }
          }
          setOutput(mix(${g}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class the{constructor(e,s,n,r,i,o,l=!0,c=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const d=Ht(i.length),u=Ht(o.length);let h="";n===1?h="i":n===2&&(h="i, j");const p=`getIndices(${h})`;let f="";r===1?f="i":r===2&&(f="i, coords[1]");const m=`getUpdates(${f})`;let b="";c&&(b="coords[0], coords[1]");const g=`getDefaultValue(${b})`,x=s>1?"strides[j]":"strides",y=s>1?"strides[j + 1]":"strides";this.userCode=`
        ${d} strides = ${d}(${i});

        void main() {
          ${u} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${s}; j+=2) {
              ivec4 index = round(${p});
              flattenedIndex += index.xz * ${x};
              if (j + 1 < ${s}) {
                flattenedIndex += index.yw * ${y};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${m};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${g}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function she(t){const{inputs:e,backend:s,attrs:n}=t,{indices:r,updates:i}=e,{shape:o}=n,{sliceRank:l,numUpdates:c,sliceSize:d,strides:u,outputSize:h}=Ha(i,r,o),p=[h/d,d];if(h===0)return s.makeTensorInfo(o,r.dtype);const f=Oe({inputs:{x:r},backend:s,attrs:{shape:[c,l]}}),m=Oe({inputs:{x:i},backend:s,attrs:{shape:[c,d]}}),b=s.makeTensorInfo([],"float32",new Float32Array([0]));let g;oe().getBool("WEBGL_PACK")?g=new the(c,l,f.shape.length,m.shape.length,u,p):g=new nv(c,l,f.shape.length,m.shape.length,u,p);const x=s.runWebGLProgram(g,[m,f,b],m.dtype),y=Oe({inputs:{x},backend:s,attrs:{shape:o}});return s.disposeIntermediateTensorInfo(f),s.disposeIntermediateTensorInfo(m),s.disposeIntermediateTensorInfo(x),s.disposeIntermediateTensorInfo(b),y}const nhe={kernelName:aC,backendName:"webgl",kernelFunc:she};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rhe{constructor(e,s,n,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(s+1))}; ++i) { if (left >= right) break;`,l=oe().getNumber("WEBGL_VERSION")===2?i:o,c=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${l}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${c} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ihe(t){const{inputs:e,backend:s,attrs:n}=t,{sortedSequence:r,values:i}=e,{side:o}=n,l=new rhe(r.shape[0],r.shape[1],i.shape[1],o),c=[[r.shape[1]]];return s.runWebGLProgram(l,[r,i],"int32",c)}const ohe={kernelName:cC,backendName:"webgl",kernelFunc:ihe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ahe{constructor(e,s,n){this.variableNames=["c","a","b"],this.outputShape=s;let r,i;if(n>4)throw Error(`Where for rank ${n} is not yet supported`);if(n===1)i="resRC",r="resRC";else{const l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],d=[];for(let u=0;u<s.length;u++)d.push(`${l[u]}`),u<e&&c.push(`${l[u]}`);r=c.join(),i=d.join()}const o=Ht(n);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lhe(t){const{inputs:e,backend:s}=t,{condition:n,t:r,e:i}=e,o=new ahe(n.shape.length,r.shape,r.shape.length);return s.runWebGLProgram(o,[n,r,i],Rn(r.dtype,i.dtype))}const che={kernelName:zf,backendName:"webgl",kernelFunc:lhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dhe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${ym};
  float scale = ${wm};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,uhe=At({opSnippet:dhe}),hhe={kernelName:nu,backendName:"webgl",kernelFunc:uhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const phe=Ic+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,fhe=At({opSnippet:phe,packedOpSnippet:`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,cpuKernelImpl:tie}),mhe={kernelName:au,backendName:"webgl",kernelFunc:fhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ghe=At({opSnippet:`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`}),xhe={kernelName:ou,backendName:"webgl",kernelFunc:ghe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bhe=Ic+`
  return sin(x);
`,yhe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${ll}
  return result;
`,whe=At({opSnippet:bhe,packedOpSnippet:yhe}),vhe={kernelName:ru,backendName:"webgl",kernelFunc:whe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nhe=At({opSnippet:`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`}),khe={kernelName:iu,backendName:"webgl",kernelFunc:Nhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Che=At({opSnippet:`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`}),She={kernelName:lu,backendName:"webgl",kernelFunc:Che};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jhe={kernelName:Vf,backendName:"webgl",kernelFunc:t=>{const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{blockShape:i,paddings:o}=n;A(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const l=i.reduce((x,y)=>x*y),c=[[0,0]];c.push(...o);for(let x=1+i.length;x<r.shape.length;++x)c.push([0,0]);const d=[],u=aD({inputs:{x:r},backend:s,attrs:{paddings:c,constantValue:0}}),h=Du(u.shape,i,l,!1),p=_u(h.length,i.length,!1),f=Ru(u.shape,i,l,!1),m=Oe({inputs:{x:u},backend:s,attrs:{shape:h}}),b=hn({inputs:{x:m},backend:s,attrs:{perm:p}}),g=Oe({inputs:{x:b},backend:s,attrs:{shape:f}});return d.push(u),d.push(m),d.push(b),d.forEach(x=>s.disposeIntermediateTensorInfo(x)),g}};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ihe(t){const{inputs:e,backend:s}=t,{indices:n,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${n.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const l=s.readSync(n.dataId),c=s.readSync(r.dataId),d=s.readSync(i.dataId),u=s.readSync(o.dataId)[0],[h,p,f,m,b]=nie(l,n.shape,n.dtype,c,r.dtype,d,u);return[s.makeTensorInfo(p,n.dtype,h),s.makeTensorInfo([p[0]],r.dtype,f),s.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(g=>Number(g)))),s.makeTensorInfo([b.length],n.dtype,new Int32Array(b))]}const Ehe={kernelName:dC,backendName:"webgl",kernelFunc:Ihe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $he(t){const{inputs:e,backend:s}=t,{inputIndices:n,inputShape:r,newShape:i}=e;if(n.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${n.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(s.readSync(r.dataId)),l=s.readSync(n.dataId),c=Array.from(s.readSync(i.dataId)),[d,u,h]=rie(l,n.shape,n.dtype,o,c);return[s.makeTensorInfo(u,n.dtype,d),s.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}const The={kernelName:uC,backendName:"webgl",kernelFunc:$he};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ahe(t){const{inputs:e,backend:s}=t,{data:n,indices:r,segmentIds:i}=e;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=s.readSync(n.dataId),l=s.readSync(r.dataId),c=s.readSync(i.dataId),[d,u]=pA(o,n.shape,n.dtype,l,c,!0);return s.makeTensorInfo(u,n.dtype,d)}const Dhe={kernelName:hC,backendName:"webgl",kernelFunc:Ahe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _he(t){const{inputs:e,backend:s}=t,{data:n,indices:r,segmentIds:i}=e;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=s.readSync(n.dataId),l=s.readSync(r.dataId),c=s.readSync(i.dataId),[d,u]=pA(o,n.shape,n.dtype,l,c);return s.makeTensorInfo(u,n.dtype,d)}const Rhe={kernelName:pC,backendName:"webgl",kernelFunc:_he};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Phe(t){const{inputs:e,backend:s,attrs:n}=t,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:l}=n,{sliceRank:c,numUpdates:d,sliceSize:u,strides:h,outputSize:p}=Ha(i,r,l),f=!1;if(i.dtype==="string"){const x=s.bufferSync(r),y=s.bufferSync(i),w=Eo(s.readSync(o.dataId)[0]),v=eie(x,y,l,p,u,d,c,h,w,f);return s.makeTensorInfo(l,v.dtype,v.values)}const m=new nv(d,c,r.shape.length,i.shape.length,h,[p,1],f),b=s.runWebGLProgram(m,[i,r,o],i.dtype),g=Oe({inputs:{x:b},backend:s,attrs:{shape:l}});return s.disposeIntermediateTensorInfo(b),g}const Fhe={kernelName:fC,backendName:"webgl",kernelFunc:Phe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ohe(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{numOrSizeSplits:i,axis:o}=n,l=vt(o,r.shape)[0],c=zy(r,i,l),d=r.shape.length,u=new Array(d).fill(0),h=r.shape.slice();return c.map(p=>{const f=[...h];f[l]=p;const m=Ec({inputs:{x:r},backend:s,attrs:{begin:u,size:f}});return u[l]+=p,m})}const Mhe={kernelName:Wf,backendName:"webgl",kernelFunc:Ohe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cD="return sqrt(x);",Lhe=At({opSnippet:cD,packedOpSnippet:cD,cpuKernelImpl:iie}),zhe={kernelName:cu,backendName:"webgl",kernelFunc:Lhe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bhe=At({opSnippet:"return x * x;"}),Uhe={kernelName:nb,backendName:"webgl",kernelFunc:Bhe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dD="return (a - b) * (a - b);",Vhe=Hs({opSnippet:dD,packedOpSnippet:dD}),Whe={kernelName:du,backendName:"webgl",kernelFunc:Vhe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ghe(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const i=s.readSync(r.dataId),o=no(i),l=oie(o,"string",n);return s.makeTensorInfo(r.shape,"string",l)}const Hhe={kernelName:rb,backendName:"webgl",kernelFunc:Ghe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qhe({inputs:t,attrs:e,backend:s}){const{x:n}=t,r=vr+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new ki(n.shape,r);return s.runWebGLProgram(i,[n],n.dtype)}const Khe={kernelName:mu,backendName:"webgl",kernelFunc:qhe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xhe{constructor(e,s,n){this.variableNames=["x"],this.outputShape=n;const r=n.length,i=Ht(n.length),o=Ht(n.length);let l="";if(r===1)l="coords * strides + begin";else{let c=0;l=n.map((d,u)=>(c++,n.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${c-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${s});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yhe(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{begin:i,end:o,strides:l,beginMask:c,endMask:d,ellipsisMask:u,newAxisMask:h,shrinkAxisMask:p}=n,{finalShapeSparse:f,finalShape:m,isIdentity:b,sliceDim0:g,isSimpleSlice:x,begin:y,end:w,strides:v}=vy(r.shape,i,o,l,c,d,u,h,p);let N;if(b)N=Oe({inputs:{x:r},backend:s,attrs:{shape:m}});else if(g||x){A(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const j=by(y,w,v),I=Ec({inputs:{x:r},backend:s,attrs:{begin:y,size:j}});N=Oe({inputs:{x:I},backend:s,attrs:{shape:m}}),s.disposeIntermediateTensorInfo(I)}else if(s.shouldExecuteOnCPU([r])){const I=s.readSync(r.dataId),T=Nt(r.shape,r.dtype,I),E=aie(f,T,v,y);N=s.makeTensorInfo(m,r.dtype,E.values)}else{const I=new Xhe(y,v,f);N=s.runWebGLProgram(I,[r],r.dtype)}const C=Oe({inputs:{x:N},backend:s,attrs:{shape:m}});return s.disposeIntermediateTensorInfo(N),C}const Zhe={kernelName:ib,backendName:"webgl",kernelFunc:Yhe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jhe(t){const{inputs:e,backend:s,attrs:n}=t,{separator:r,nGramWidths:i,leftPad:o,rightPad:l,padWidth:c,preserveShortSequences:d}=n,{data:u,dataSplits:h}=e,p=s.readSync(u.dataId),f=s.readSync(h.dataId),[m,b]=lie(p,f,r,i,o,l,c,d);return[s.makeTensorInfo([m.length],"string",m),s.makeTensorInfo(h.shape,"int32",b)]}const Qhe={kernelName:mC,backendName:"webgl",kernelFunc:Jhe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function epe(t){const{inputs:e,backend:s,attrs:n}=t,{skipEmpty:r}=n,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const l=s.readSync(i.dataId),c=s.readSync(o.dataId)[0],[d,u,h]=cie(l,c,r),p=u.length;return[s.makeTensorInfo([p,2],"int32",d),s.makeTensorInfo([p],"string",u),s.makeTensorInfo([2],"int32",new Int32Array(h))]}const tpe={kernelName:gC,backendName:"webgl",kernelFunc:epe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function spe(t){const{inputs:e,backend:s,attrs:n}=t,{numBuckets:r}=n,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=s.readSync(i.dataId),l=die(o,r);return s.makeTensorInfo(i.shape,"int32",l)}const npe={kernelName:xC,backendName:"webgl",kernelFunc:spe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rpe=At({opSnippet:"return tan(x);"}),ipe={kernelName:hu,backendName:"webgl",kernelFunc:rpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ope=At({opSnippet:`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`}),ape={kernelName:pu,backendName:"webgl",kernelFunc:ope};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lpe(t){const{inputs:e,backend:s,attrs:n}=t,{tensor:r,indices:i,updates:o}=e,{sliceRank:l,numUpdates:c,sliceSize:d,strides:u,outputSize:h}=Ha(o,i,r.shape),p=[h/d,d];if(h===0)return s.makeTensorInfo(r.shape,i.dtype);const f=Oe({inputs:{x:i},backend:s,attrs:{shape:[c,l]}}),m=Oe({inputs:{x:o},backend:s,attrs:{shape:[c,d]}}),b=Oe({inputs:{x:r},backend:s,attrs:{shape:p}}),g=new nv(c,l,f.shape.length,m.shape.length,u,p,!1,!0),x=s.runWebGLProgram(g,[m,f,b],b.dtype),y=Oe({inputs:{x},backend:s,attrs:{shape:r.shape}});return s.disposeIntermediateTensorInfo(f),s.disposeIntermediateTensorInfo(m),s.disposeIntermediateTensorInfo(b),s.disposeIntermediateTensorInfo(x),y}const cpe={kernelName:lC,backendName:"webgl",kernelFunc:lpe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dpe{constructor(e,s){this.variableNames=["A"];const n=new Array(e.length);for(let o=0;o<n.length;o++)n[o]=e[o]*s[o];this.outputShape=n,this.rank=n.length;const r=Ht(this.rank),i=upe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function upe(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const s=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],n=[];for(let r=0;r<t.length;r++)n.push(`imod(${s[r]}, ${t[r]})`);return n.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uD(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{reps:i}=n;if(r.dtype==="string"||r.shape.length>5){const c=s.readSync(r.dataId),d=r.dtype==="string"?c.map(p=>Eo(p)):c,u=Nt(r.shape,r.dtype,d),h=hie(u,i);return s.makeTensorInfo(h.shape,h.dtype,h.values)}const o=new dpe(r.shape,i);return s.runWebGLProgram(o,[r],r.dtype)}const hpe={kernelName:fu,backendName:"webgl",kernelFunc:uD};class ppe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class fpe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dl(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function hD(t){let e=1;for(;e<t;)e*=2;return e}function mpe(t){const{inputs:e,backend:s,attrs:n}=t,{x:r}=e,{k:i,sorted:o}=n,l=oe().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),c=oe().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),d=r.shape,u=d[d.length-1];if(s.shouldExecuteOnCPU([r])||u<l||i>c){const E=s.readSync(r.dataId),[$,D]=pie(E,d,r.dtype,i,o);return[s.makeTensorInfo($.shape,$.dtype,$.values),s.makeTensorInfo(D.shape,D.dtype,D.values)]}if(i===0)return d[d.length-1]=0,[s.makeTensorInfo(d,r.dtype,[]),s.makeTensorInfo(d,"int32",[])];if(u===1)return[r,lh({attrs:{shape:d,dtype:"int32",value:0},backend:s})];const h=s.texData.get(r.dataId),p=h!==null&&h.isPacked,f=p?s.unpackTensor(r):r,b=pe(d)/u,g=Oe({inputs:{x:f},attrs:{shape:[b,u]},backend:s});p&&dl(s,f);const x=hD(i),y=hD(u);let w=null;const v=()=>w===null?[g,g]:[g,w],N=(E,$,D)=>{const P=v(),_=new ppe(D),R=[[u],[w===null?1:0],[Number.NEGATIVE_INFINITY],[E],[$]],X=w;w=s.runWebGLProgram(_,P,"int32",R),dl(s,X)};for(let E=1;E<x;E*=2){const $=E*2;for(let D=E;D>=1;D/=2)N($,D,[b,y])}for(let E=y;E>x;E/=2){const $=v(),D=new fpe([b,E/2]),_=[[u],[w===null?1:0],[x]],O=w;w=s.runWebGLProgram(D,$,"int32",_),dl(s,O);const R=x/2,X=R*2;for(let L=R;L>=1;L/=2)N(X,L,w.shape)}let C=w;w=Ec({inputs:{x:w},backend:s,attrs:{begin:0,size:[b,i]}}),dl(s,C);let j=eD({inputs:{x:g,indices:w},backend:s,attrs:{axis:1,batchDims:1}});dl(s,g);const I=d.slice(0,-1);I.push(i),C=w,w=Oe({inputs:{x:w},attrs:{shape:I},backend:s}),dl(s,C);const T=j;return j=Oe({inputs:{x:j},attrs:{shape:I},backend:s}),dl(s,T),[j,w]}const gpe={kernelName:ob,backendName:"webgl",kernelFunc:mpe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xpe{constructor(e,s,n,r,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const l=n==="nearest"?1:2;let c;switch(r){case"constant":c=1;break;case"reflect":c=2;break;case"wrap":c=3;break;case"nearest":c=4;break;default:c=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${c} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${c} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${s}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${s}));
                float mapY = mapCoord(inY, float(${e}));

                if (${l} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bpe(t){const{inputs:e,backend:s,attrs:n}=t,{image:r,transforms:i}=e,{interpolation:o,fillMode:l,fillValue:c,outputShape:d}=n,[u,h,p,f]=r.shape,[m,b]=d??[h,p],g=[u,m,b,f],x=new xpe(h,p,o,l,c,g);return s.runWebGLProgram(x,[r,i],"float32")}const ype={kernelName:ab,backendName:"webgl",kernelFunc:bpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wpe(t){const{inputs:e,attrs:s,backend:n}=t,{axis:r}=s,{x:i}=e;th(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=n.readSync(i.dataId),{outputValues:l,outputShape:c,indices:d}=fie(o,r,i.shape,i.dtype);return[n.makeTensorInfo(c,i.dtype,l),n.makeTensorInfo([d.length],"int32",d)]}const vpe={kernelName:lb,backendName:"webgl",kernelFunc:wpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Npe(t){const{inputs:e,backend:s,attrs:n}=t,{value:r}=e;let{axis:i}=n;i<0&&(i+=r.shape.length);const o=r,l=o.shape.length,c=r.shape[i],d=new Array(l-1);let u=0;for(let b=0;b<l;b++)b!==i&&(d[u++]=o.shape[b]);const h=[],p=new Array(l).fill(0),f=o.shape.slice();f[i]=1;const m=new Array(c);for(let b=0;b<m.length;b++){p[i]=b;const g=Ec({inputs:{x:o},backend:s,attrs:{begin:p,size:f}}),x=Oe({inputs:{x:g},backend:s,attrs:{shape:d}});m[b]=x,h.push(g)}return h.forEach(b=>s.disposeIntermediateTensorInfo(b)),m}const kpe={kernelName:Hf,backendName:"webgl",kernelFunc:Npe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Cpe{constructor(e,s){this.variableNames=["x","segmentIds"];const n=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,l=o*Math.ceil(i/n);this.outputShape=[r,l];const c="0.0",d="sumValue",u=Math.floor(n/4)*4,h=n%4,p=`
        sumValue += dot(values, segFilter);
    `;let f="";i%n>0&&(f=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let m="";i%n>0&&(m=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${c};

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${m}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${n}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${u};
        if (${h===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${h===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${h===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${d});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Spe(t){const{inputs:e,backend:s,attrs:n}=t,{x:r,segmentIds:i}=e,{numSegments:o}=n,l=r.shape.length,c=[];let d=0;const u=cs([d],l);let h=r;u!=null&&(h=hn({inputs:{x:r},backend:s,attrs:{perm:u}}),c.push(h),d=ms(1,l)[0]);const p=Mj(h.shape,d,o),f=pe([h.shape[d]]),m=Oe({inputs:{x:h},backend:s,attrs:{shape:[-1,f]}});c.push(m);const b=yb(r.dtype),g=(v,N,C,j,I)=>{const T=v.shape[0],E=v.shape[1],$=Oj(E,I),D={windowSize:$,inSize:E,batchSize:T,numSegments:I},P=new Cpe(D,N),_=s.compileAndRun(P,[v,C],j);if(c.push(_),_.shape[1]===I)return _;const O=lD({backend:s,attrs:{start:0,stop:I,step:1,dtype:"float32"}}),R=uD({inputs:{x:O},backend:s,attrs:{reps:[E/$]}});return c.push(O),c.push(R),g(_,N,R,j,I)},x=g(m,"unsortedSegmentSum",i,b,o),y=Oe({inputs:{x},backend:s,attrs:{shape:p}});let w=y;if(u!=null){c.push(y);const v=Do(u);w=hn({inputs:{x:w},backend:s,attrs:{perm:v}})}return c.forEach(v=>s.disposeIntermediateTensorInfo(v)),w}const jpe={kernelName:qf,backendName:"webgl",kernelFunc:Spe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ipe=[ioe,aoe,doe,poe,moe,boe,woe,Noe,joe,Eoe,Aoe,Roe,Ooe,Boe,Woe,Hoe,Koe,Joe,eae,sae,iae,uae,pae,xae,yae,Cae,jae,Tae,Uie,_ae,Mae,Uae,Kae,Zae,Qae,tle,nle,ale,cle,ule,ple,mle,xle,wle,Nle,jle,Ele,Ale,Rle,Fle,Mle,Ble,Vle,Hle,Kle,Xle,Zle,Qle,tce,nce,ice,ace,dce,pce,mce,bce,vce,kce,Sce,Bie,Ice,Fae,$ce,Ace,_ce,Wie,Pce,Oce,Lce,Uce,Gce,qce,Xce,Zce,ede,sde,rde,lde,dde,hde,gde,bde,wde,Nde,Cde,Ede,Ade,Pde,Bde,qie,Gde,Kde,Zde,eue,wae,sue,rue,oue,cue,pue,Hie,mue,xue,yue,vue,Nue,vae,Ode,Cue,Iue,Tue,Xie,Rue,Oue,Bue,Wue,Kue,Yue,Jue,ehe,nhe,ohe,che,hhe,mhe,xhe,vhe,khe,dae,Lde,She,jhe,Ehe,The,Dhe,Rhe,Fhe,Mhe,zhe,Uhe,Whe,Hhe,Khe,Zhe,Qhe,tpe,npe,Mde,soe,ipe,ape,cpe,hpe,gpe,ype,noe,vpe,kpe,jpe,nue];for(const t of Ipe)NC(t);let rv=null;async function Epe(){try{try{rv=await BX("indexeddb://rep-project-matching-model"),console.log("Loaded existing model from IndexedDB")}catch{console.log("Creating new model"),rv=$pe(),await rv.save("indexeddb://rep-project-matching-model")}return!0}catch(t){return console.error("Failed to initialize AI:",t),!1}}function $pe(){const t=WX();return t.add(Iw({units:16,activation:"relu",inputShape:[20]})),t.add(Iw({units:8,activation:"relu"})),t.add(Iw({units:1,activation:"sigmoid"})),t.compile({optimizer:"adam",loss:"binaryCrossentropy",metrics:["accuracy"]}),t}function Tpe(t,e,s){const n=[],r={};return s.filter(i=>i.repId===t.id&&i.status==="reserved"&&i.gigId).forEach(i=>{i.gigId&&(r[i.gigId]=(r[i.gigId]||0)+1)}),e.forEach(i=>{const o=i.skills.filter(h=>t.specialties.some(p=>p.toLowerCase().includes(h.toLowerCase())||h.toLowerCase().includes(p.toLowerCase()))).length/Math.max(i.skills.length,1),l=r[i.id]?r[i.id]/Object.values(r).reduce((h,p)=>h+p,0):0,c=.7*o+.3*l;let d="";o>.7?d="Strong skill match with your specialties":l>.3?d="Based on your previous project history":d="New opportunity that might match your skills";const u=i.priority==="high"?.2:i.priority==="medium"?.1:0;n.push({repId:t.id,gigId:i.id,confidence:Math.min(c+u,1),reason:d})}),n.sort((i,o)=>o.confidence-i.confidence)}function Ape(t,e){const s=Array(24).fill(0);e.filter(r=>r.repId===t.id&&r.status==="reserved").forEach(r=>{const i=parseInt(r.startTime.split(":")[0]);s[i]++});const n=s.reduce((r,i)=>r+i,0);return s.map((r,i)=>{let o=n>0?r/n:0;return t.preferredHours&&i>=t.preferredHours.start&&i<t.preferredHours.end&&(o+=.2),{hour:i,score:Math.min(o,1)}})}function Dpe(t,e){const s=e.filter(c=>c.repId===t.id&&c.status==="reserved");if(s.length===0)return[{repId:t.id,metric:"satisfaction",value:0},{repId:t.id,metric:"efficiency",value:0},{repId:t.id,metric:"quality",value:0}];const n=new Set(s.map(c=>c.gigId).filter(Boolean)).size,r=Math.min(n*20,100),i=s.filter(c=>c.notes&&c.notes.length>0).length,o=Math.min((s.length+i)*5,100),l=Math.floor(70+Math.random()*30);return[{repId:t.id,metric:"satisfaction",value:r},{repId:t.id,metric:"efficiency",value:o},{repId:t.id,metric:"quality",value:l}]}function _pe(t,e=7){const s=new Date,n=[];for(let r=0;r<e;r++){const i=new Date(s);i.setDate(i.getDate()+r);const o=i.toISOString().split("T")[0],l=i.getDay(),c=t.filter(f=>new Date(f.date).getDay()===l&&f.status==="reserved"),d=c.reduce((f,m)=>f+(m.duration||1),0),u=c.length>0?d/Math.max(1,c.length/4):8,h=.9+Math.random()*.2,p=Math.round(u*h);n.push({date:o,predictedHours:p})}return n}function Rpe({rep:t,projects:e,slots:s,onSelectProject:n}){const[r,i]=k.useState([]),[o,l]=k.useState(!0);return k.useEffect(()=>{l(!0);const c=setTimeout(()=>{const d=Tpe(t,e,s);i(d),l(!1)},800);return()=>clearTimeout(c)},[t,e,s]),o?a.jsxs("div",{className:"bg-white rounded-lg shadow p-4 animate-pulse",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx("div",{className:"w-6 h-6 bg-blue-100 rounded-full mr-2"}),a.jsx("div",{className:"h-5 bg-blue-100 rounded w-48"})]}),a.jsx("div",{className:"space-y-3",children:[1,2,3].map(c=>a.jsx("div",{className:"h-16 bg-gray-100 rounded"},c))})]}):a.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx(ia,{className:"w-5 h-5 text-purple-600 mr-2"}),a.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"AI Gig Recommendations"})]}),r.length>0?a.jsx("div",{className:"space-y-3",children:r.slice(0,3).map(c=>{const d=e.find(u=>u.id===c.gigId);return d?a.jsxs("div",{className:"border rounded-lg p-3 hover:bg-blue-50 transition-colors cursor-pointer",onClick:()=>n(c.gigId),children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:d.color}}),a.jsx("h3",{className:"font-medium",children:d.name})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsxs("div",{className:"text-xs font-medium px-2 py-1 rounded-full bg-purple-100 text-purple-800 flex items-center",children:[a.jsx(El,{className:"w-3 h-3 mr-1"}),Math.round(c.confidence*100),"% match"]}),a.jsx(js,{className:"w-4 h-4 text-gray-400 ml-2"})]})]}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:c.reason}),a.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:d.skills.map(u=>a.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t.specialties.some(h=>h.toLowerCase().includes(u.toLowerCase())||u.toLowerCase().includes(h.toLowerCase()))?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:u},u))})]},c.gigId):null})}):a.jsx("div",{className:"text-center py-6 text-gray-500",children:"No recommendations available yet"})]})}function Ppe({rep:t,slots:e,onSelectHour:s}){const[n,r]=k.useState([]);k.useEffect(()=>{const l=Ape(t,e);r(l)},[t,e]);const i=l=>l>=.8?"bg-green-500 text-white":l>=.6?"bg-green-200 text-green-800":l>=.4?"bg-yellow-200 text-yellow-800":l>=.2?"bg-orange-200 text-orange-800":"bg-gray-100 text-gray-500",o=l=>l>=.8?"Optimal":l>=.6?"Good":l>=.4?"Fair":"Low";return a.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx(St,{className:"w-5 h-5 text-blue-600 mr-2"}),a.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Optimal Scheduling Times"})]}),a.jsx("div",{className:"grid grid-cols-6 gap-2",children:n.map(({hour:l,score:c})=>a.jsxs("button",{onClick:()=>s(l),className:`p-2 rounded-lg flex flex-col items-center justify-center transition-colors hover:opacity-80 ${i(c)}`,children:[a.jsxs("span",{className:"text-sm font-bold",children:[l,":00"]}),a.jsx("span",{className:"text-xs mt-1",children:o(c)})]},l))}),a.jsxs("div",{className:"mt-4 flex items-center justify-center space-x-4 text-xs text-gray-500",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-sm mr-1"}),a.jsx("span",{children:"Best"})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-3 h-3 bg-green-200 rounded-sm mr-1"}),a.jsx("span",{children:"Good"})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-3 h-3 bg-yellow-200 rounded-sm mr-1"}),a.jsx("span",{children:"Fair"})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-3 h-3 bg-gray-100 rounded-sm mr-1"}),a.jsx("span",{children:"Avoid"})]})]})]})}/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function ch(t){return t+.5|0}const Xo=(t,e,s)=>Math.max(Math.min(t,s),e);function dh(t){return Xo(ch(t*2.55),0,255)}function Yo(t){return Xo(ch(t*255),0,255)}function oo(t){return Xo(ch(t/2.55)/100,0,1)}function pD(t){return Xo(ch(t*100),0,100)}const Nr={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},iv=[..."0123456789ABCDEF"],Fpe=t=>iv[t&15],Ope=t=>iv[(t&240)>>4]+iv[t&15],gg=t=>(t&240)>>4===(t&15),Mpe=t=>gg(t.r)&&gg(t.g)&&gg(t.b)&&gg(t.a);function Lpe(t){var e=t.length,s;return t[0]==="#"&&(e===4||e===5?s={r:255&Nr[t[1]]*17,g:255&Nr[t[2]]*17,b:255&Nr[t[3]]*17,a:e===5?Nr[t[4]]*17:255}:(e===7||e===9)&&(s={r:Nr[t[1]]<<4|Nr[t[2]],g:Nr[t[3]]<<4|Nr[t[4]],b:Nr[t[5]]<<4|Nr[t[6]],a:e===9?Nr[t[7]]<<4|Nr[t[8]]:255})),s}const zpe=(t,e)=>t<255?e(t):"";function Bpe(t){var e=Mpe(t)?Fpe:Ope;return t?"#"+e(t.r)+e(t.g)+e(t.b)+zpe(t.a,e):void 0}const Upe=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function fD(t,e,s){const n=e*Math.min(s,1-s),r=(i,o=(i+t/30)%12)=>s-n*Math.max(Math.min(o-3,9-o,1),-1);return[r(0),r(8),r(4)]}function Vpe(t,e,s){const n=(r,i=(r+t/60)%6)=>s-s*e*Math.max(Math.min(i,4-i,1),0);return[n(5),n(3),n(1)]}function Wpe(t,e,s){const n=fD(t,1,.5);let r;for(e+s>1&&(r=1/(e+s),e*=r,s*=r),r=0;r<3;r++)n[r]*=1-e-s,n[r]+=e;return n}function Gpe(t,e,s,n,r){return t===r?(e-s)/n+(e<s?6:0):e===r?(s-t)/n+2:(t-e)/n+4}function ov(t){const s=t.r/255,n=t.g/255,r=t.b/255,i=Math.max(s,n,r),o=Math.min(s,n,r),l=(i+o)/2;let c,d,u;return i!==o&&(u=i-o,d=l>.5?u/(2-i-o):u/(i+o),c=Gpe(s,n,r,u,i),c=c*60+.5),[c|0,d||0,l]}function av(t,e,s,n){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,s,n)).map(Yo)}function lv(t,e,s){return av(fD,t,e,s)}function Hpe(t,e,s){return av(Wpe,t,e,s)}function qpe(t,e,s){return av(Vpe,t,e,s)}function mD(t){return(t%360+360)%360}function Kpe(t){const e=Upe.exec(t);let s=255,n;if(!e)return;e[5]!==n&&(s=e[6]?dh(+e[5]):Yo(+e[5]));const r=mD(+e[2]),i=+e[3]/100,o=+e[4]/100;return e[1]==="hwb"?n=Hpe(r,i,o):e[1]==="hsv"?n=qpe(r,i,o):n=lv(r,i,o),{r:n[0],g:n[1],b:n[2],a:s}}function Xpe(t,e){var s=ov(t);s[0]=mD(s[0]+e),s=lv(s),t.r=s[0],t.g=s[1],t.b=s[2]}function Ype(t){if(!t)return;const e=ov(t),s=e[0],n=pD(e[1]),r=pD(e[2]);return t.a<255?`hsla(${s}, ${n}%, ${r}%, ${oo(t.a)})`:`hsl(${s}, ${n}%, ${r}%)`}const gD={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},xD={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Zpe(){const t={},e=Object.keys(xD),s=Object.keys(gD);let n,r,i,o,l;for(n=0;n<e.length;n++){for(o=l=e[n],r=0;r<s.length;r++)i=s[r],l=l.replace(i,gD[i]);i=parseInt(xD[o],16),t[l]=[i>>16&255,i>>8&255,i&255]}return t}let xg;function Jpe(t){xg||(xg=Zpe(),xg.transparent=[0,0,0,0]);const e=xg[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const Qpe=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function efe(t){const e=Qpe.exec(t);let s=255,n,r,i;if(e){if(e[7]!==n){const o=+e[7];s=e[8]?dh(o):Xo(o*255,0,255)}return n=+e[1],r=+e[3],i=+e[5],n=255&(e[2]?dh(n):Xo(n,0,255)),r=255&(e[4]?dh(r):Xo(r,0,255)),i=255&(e[6]?dh(i):Xo(i,0,255)),{r:n,g:r,b:i,a:s}}}function tfe(t){return t&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${oo(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`)}const cv=t=>t<=.0031308?t*12.92:Math.pow(t,1/2.4)*1.055-.055,Tc=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function sfe(t,e,s){const n=Tc(oo(t.r)),r=Tc(oo(t.g)),i=Tc(oo(t.b));return{r:Yo(cv(n+s*(Tc(oo(e.r))-n))),g:Yo(cv(r+s*(Tc(oo(e.g))-r))),b:Yo(cv(i+s*(Tc(oo(e.b))-i))),a:t.a+s*(e.a-t.a)}}function bg(t,e,s){if(t){let n=ov(t);n[e]=Math.max(0,Math.min(n[e]+n[e]*s,e===0?360:1)),n=lv(n),t.r=n[0],t.g=n[1],t.b=n[2]}}function bD(t,e){return t&&Object.assign(e||{},t)}function yD(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=Yo(t[3]))):(e=bD(t,{r:0,g:0,b:0,a:1}),e.a=Yo(e.a)),e}function nfe(t){return t.charAt(0)==="r"?efe(t):Kpe(t)}class uh{constructor(e){if(e instanceof uh)return e;const s=typeof e;let n;s==="object"?n=yD(e):s==="string"&&(n=Lpe(e)||Jpe(e)||nfe(e)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var e=bD(this._rgb);return e&&(e.a=oo(e.a)),e}set rgb(e){this._rgb=yD(e)}rgbString(){return this._valid?tfe(this._rgb):void 0}hexString(){return this._valid?Bpe(this._rgb):void 0}hslString(){return this._valid?Ype(this._rgb):void 0}mix(e,s){if(e){const n=this.rgb,r=e.rgb;let i;const o=s===i?.5:s,l=2*o-1,c=n.a-r.a,d=((l*c===-1?l:(l+c)/(1+l*c))+1)/2;i=1-d,n.r=255&d*n.r+i*r.r+.5,n.g=255&d*n.g+i*r.g+.5,n.b=255&d*n.b+i*r.b+.5,n.a=o*n.a+(1-o)*r.a,this.rgb=n}return this}interpolate(e,s){return e&&(this._rgb=sfe(this._rgb,e._rgb,s)),this}clone(){return new uh(this.rgb)}alpha(e){return this._rgb.a=Yo(e),this}clearer(e){const s=this._rgb;return s.a*=1-e,this}greyscale(){const e=this._rgb,s=ch(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=s,this}opaquer(e){const s=this._rgb;return s.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return bg(this._rgb,2,e),this}darken(e){return bg(this._rgb,2,-e),this}saturate(e){return bg(this._rgb,1,e),this}desaturate(e){return bg(this._rgb,1,-e),this}rotate(e){return Xpe(this._rgb,e),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function ao(){}const rfe=(()=>{let t=0;return()=>t++})();function Wt(t){return t==null}function Ls(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function Lt(t){return t!==null&&Object.prototype.toString.call(t)==="[object Object]"}function kr(t){return(typeof t=="number"||t instanceof Number)&&isFinite(+t)}function Ci(t,e){return kr(t)?t:e}function It(t,e){return typeof t>"u"?e:t}const ife=(t,e)=>typeof t=="string"&&t.endsWith("%")?parseFloat(t)/100*e:+t;function ls(t,e,s){if(t&&typeof t.call=="function")return t.apply(s,e)}function qt(t,e,s,n){let r,i,o;if(Ls(t))for(i=t.length,r=0;r<i;r++)e.call(s,t[r],r);else if(Lt(t))for(o=Object.keys(t),i=o.length,r=0;r<i;r++)e.call(s,t[o[r]],o[r])}function yg(t,e){let s,n,r,i;if(!t||!e||t.length!==e.length)return!1;for(s=0,n=t.length;s<n;++s)if(r=t[s],i=e[s],r.datasetIndex!==i.datasetIndex||r.index!==i.index)return!1;return!0}function wg(t){if(Ls(t))return t.map(wg);if(Lt(t)){const e=Object.create(null),s=Object.keys(t),n=s.length;let r=0;for(;r<n;++r)e[s[r]]=wg(t[s[r]]);return e}return t}function wD(t){return["__proto__","prototype","constructor"].indexOf(t)===-1}function ofe(t,e,s,n){if(!wD(t))return;const r=e[t],i=s[t];Lt(r)&&Lt(i)?hh(r,i,n):e[t]=wg(i)}function hh(t,e,s){const n=Ls(e)?e:[e],r=n.length;if(!Lt(t))return t;s=s||{};const i=s.merger||ofe;let o;for(let l=0;l<r;++l){if(o=n[l],!Lt(o))continue;const c=Object.keys(o);for(let d=0,u=c.length;d<u;++d)i(c[d],t,o,s)}return t}function ph(t,e){return hh(t,e,{merger:afe})}function afe(t,e,s){if(!wD(t))return;const n=e[t],r=s[t];Lt(n)&&Lt(r)?ph(n,r):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=wg(r))}const vD={"":t=>t,x:t=>t.x,y:t=>t.y};function lfe(t){const e=t.split("."),s=[];let n="";for(const r of e)n+=r,n.endsWith("\\")?n=n.slice(0,-1)+".":(s.push(n),n="");return s}function cfe(t){const e=lfe(t);return s=>{for(const n of e){if(n==="")break;s=s&&s[n]}return s}}function Ac(t,e){return(vD[e]||(vD[e]=cfe(e)))(t)}function dv(t){return t.charAt(0).toUpperCase()+t.slice(1)}const fh=t=>typeof t<"u",Zo=t=>typeof t=="function",ND=(t,e)=>{if(t.size!==e.size)return!1;for(const s of t)if(!e.has(s))return!1;return!0};function dfe(t){return t.type==="mouseup"||t.type==="click"||t.type==="contextmenu"}const qs=Math.PI,Si=2*qs,ufe=Si+qs,vg=Number.POSITIVE_INFINITY,hfe=qs/180,Kr=qs/2,ul=qs/4,kD=qs*2/3,uv=Math.log10,ji=Math.sign;function mh(t,e,s){return Math.abs(t-e)<s}function CD(t){const e=Math.round(t);t=mh(t,e,t/1e3)?e:t;const s=Math.pow(10,Math.floor(uv(t))),n=t/s;return(n<=1?1:n<=2?2:n<=5?5:10)*s}function pfe(t){const e=[],s=Math.sqrt(t);let n;for(n=1;n<s;n++)t%n===0&&(e.push(n),e.push(t/n));return s===(s|0)&&e.push(s),e.sort((r,i)=>r-i).pop(),e}function ffe(t){return typeof t=="symbol"||typeof t=="object"&&t!==null&&!(Symbol.toPrimitive in t||"toString"in t||"valueOf"in t)}function gh(t){return!ffe(t)&&!isNaN(parseFloat(t))&&isFinite(t)}function mfe(t,e){const s=Math.round(t);return s-e<=t&&s+e>=t}function gfe(t,e,s){let n,r,i;for(n=0,r=t.length;n<r;n++)i=t[n][s],isNaN(i)||(e.min=Math.min(e.min,i),e.max=Math.max(e.max,i))}function hl(t){return t*(qs/180)}function xfe(t){return t*(180/qs)}function SD(t){if(!kr(t))return;let e=1,s=0;for(;Math.round(t*e)/e!==t;)e*=10,s++;return s}function bfe(t,e){const s=e.x-t.x,n=e.y-t.y,r=Math.sqrt(s*s+n*n);let i=Math.atan2(n,s);return i<-.5*qs&&(i+=Si),{angle:i,distance:r}}function hv(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function yfe(t,e){return(t-e+ufe)%Si-qs}function Jo(t){return(t%Si+Si)%Si}function jD(t,e,s,n){const r=Jo(t),i=Jo(e),o=Jo(s),l=Jo(i-r),c=Jo(o-r),d=Jo(r-i),u=Jo(r-o);return r===i||r===o||n&&i===o||l>c&&d<u}function Zn(t,e,s){return Math.max(e,Math.min(s,t))}function wfe(t){return Zn(t,-32768,32767)}function pl(t,e,s,n=1e-6){return t>=Math.min(e,s)-n&&t<=Math.max(e,s)+n}function pv(t,e,s){s=s||(o=>t[o]<e);let n=t.length-1,r=0,i;for(;n-r>1;)i=r+n>>1,s(i)?r=i:n=i;return{lo:r,hi:n}}const fl=(t,e,s,n)=>pv(t,s,n?r=>{const i=t[r][e];return i<s||i===s&&t[r+1][e]===s}:r=>t[r][e]<s),vfe=(t,e,s)=>pv(t,s,n=>t[n][e]>=s);function Nfe(t,e,s){let n=0,r=t.length;for(;n<r&&t[n]<e;)n++;for(;r>n&&t[r-1]>s;)r--;return n>0||r<t.length?t.slice(n,r):t}const ID=["push","pop","shift","splice","unshift"];function kfe(t,e){if(t._chartjs){t._chartjs.listeners.push(e);return}Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),ID.forEach(s=>{const n="_onData"+dv(s),r=t[s];Object.defineProperty(t,s,{configurable:!0,enumerable:!1,value(...i){const o=r.apply(this,i);return t._chartjs.listeners.forEach(l=>{typeof l[n]=="function"&&l[n](...i)}),o}})})}function ED(t,e){const s=t._chartjs;if(!s)return;const n=s.listeners,r=n.indexOf(e);r!==-1&&n.splice(r,1),!(n.length>0)&&(ID.forEach(i=>{delete t[i]}),delete t._chartjs)}function $D(t){const e=new Set(t);return e.size===t.length?t:Array.from(e)}const TD=function(){return typeof window>"u"?function(t){return t()}:window.requestAnimationFrame}();function AD(t,e){let s=[],n=!1;return function(...r){s=r,n||(n=!0,TD.call(window,()=>{n=!1,t.apply(e,s)}))}}function Cfe(t,e){let s;return function(...n){return e?(clearTimeout(s),s=setTimeout(t,e,n)):t.apply(this,n),e}}const fv=t=>t==="start"?"left":t==="end"?"right":"center",pn=(t,e,s)=>t==="start"?e:t==="end"?s:(e+s)/2,Sfe=(t,e,s,n)=>t===(n?"left":"right")?s:t==="center"?(e+s)/2:e;function jfe(t,e,s){const n=e.length;let r=0,i=n;if(t._sorted){const{iScale:o,vScale:l,_parsed:c}=t,d=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null,u=o.axis,{min:h,max:p,minDefined:f,maxDefined:m}=o.getUserBounds();if(f){if(r=Math.min(fl(c,u,h).lo,s?n:fl(e,u,o.getPixelForValue(h)).lo),d){const b=c.slice(0,r+1).reverse().findIndex(g=>!Wt(g[l.axis]));r-=Math.max(0,b)}r=Zn(r,0,n-1)}if(m){let b=Math.max(fl(c,o.axis,p,!0).hi+1,s?0:fl(e,u,o.getPixelForValue(p),!0).hi+1);if(d){const g=c.slice(b-1).findIndex(x=>!Wt(x[l.axis]));b+=Math.max(0,g)}i=Zn(b,r,n)-r}else i=n-r}return{start:r,count:i}}function Ife(t){const{xScale:e,yScale:s,_scaleRanges:n}=t,r={xmin:e.min,xmax:e.max,ymin:s.min,ymax:s.max};if(!n)return t._scaleRanges=r,!0;const i=n.xmin!==e.min||n.xmax!==e.max||n.ymin!==s.min||n.ymax!==s.max;return Object.assign(n,r),i}const Ng=t=>t===0||t===1,DD=(t,e,s)=>-(Math.pow(2,10*(t-=1))*Math.sin((t-e)*Si/s)),_D=(t,e,s)=>Math.pow(2,-10*t)*Math.sin((t-e)*Si/s)+1,xh={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>-Math.cos(t*Kr)+1,easeOutSine:t=>Math.sin(t*Kr),easeInOutSine:t=>-.5*(Math.cos(qs*t)-1),easeInExpo:t=>t===0?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>t===1?1:-Math.pow(2,-10*t)+1,easeInOutExpo:t=>Ng(t)?t:t<.5?.5*Math.pow(2,10*(t*2-1)):.5*(-Math.pow(2,-10*(t*2-1))+2),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>Ng(t)?t:DD(t,.075,.3),easeOutElastic:t=>Ng(t)?t:_D(t,.075,.3),easeInOutElastic(t){return Ng(t)?t:t<.5?.5*DD(t*2,.1125,.45):.5+.5*_D(t*2-1,.1125,.45)},easeInBack(t){return t*t*((1.70158+1)*t-1.70158)},easeOutBack(t){return(t-=1)*t*((1.70158+1)*t+1.70158)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?.5*(t*t*(((e*=1.525)+1)*t-e)):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},easeInBounce:t=>1-xh.easeOutBounce(1-t),easeOutBounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},easeInOutBounce:t=>t<.5?xh.easeInBounce(t*2)*.5:xh.easeOutBounce(t*2-1)*.5+.5};function mv(t){if(t&&typeof t=="object"){const e=t.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function RD(t){return mv(t)?t:new uh(t)}function gv(t){return mv(t)?t:new uh(t).saturate(.5).darken(.1).hexString()}const Efe=["x","y","borderWidth","radius","tension"],$fe=["color","borderColor","backgroundColor"];function Tfe(t){t.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),t.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),t.set("animations",{colors:{type:"color",properties:$fe},numbers:{type:"number",properties:Efe}}),t.describe("animations",{_fallback:"animation"}),t.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function Afe(t){t.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const PD=new Map;function Dfe(t,e){e=e||{};const s=t+JSON.stringify(e);let n=PD.get(s);return n||(n=new Intl.NumberFormat(t,e),PD.set(s,n)),n}function FD(t,e,s){return Dfe(e,s).format(t)}const OD={values(t){return Ls(t)?t:""+t},numeric(t,e,s){if(t===0)return"0";const n=this.chart.options.locale;let r,i=t;if(s.length>1){const d=Math.max(Math.abs(s[0].value),Math.abs(s[s.length-1].value));(d<1e-4||d>1e15)&&(r="scientific"),i=_fe(t,s)}const o=uv(Math.abs(i)),l=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),c={notation:r,minimumFractionDigits:l,maximumFractionDigits:l};return Object.assign(c,this.options.ticks.format),FD(t,n,c)},logarithmic(t,e,s){if(t===0)return"0";const n=s[e].significand||t/Math.pow(10,Math.floor(uv(t)));return[1,2,3,5,10,15].includes(n)||e>.8*s.length?OD.numeric.call(this,t,e,s):""}};function _fe(t,e){let s=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(s)>=1&&t!==Math.floor(t)&&(s=t-Math.floor(t)),s}var MD={formatters:OD};function Rfe(t){t.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,s)=>s.lineWidth,tickColor:(e,s)=>s.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:MD.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),t.route("scale.ticks","color","","color"),t.route("scale.grid","color","","borderColor"),t.route("scale.border","color","","borderColor"),t.route("scale.title","color","","color"),t.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),t.describe("scales",{_fallback:"scale"}),t.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const ml=Object.create(null),xv=Object.create(null);function bh(t,e){if(!e)return t;const s=e.split(".");for(let n=0,r=s.length;n<r;++n){const i=s[n];t=t[i]||(t[i]=Object.create(null))}return t}function bv(t,e,s){return typeof e=="string"?hh(bh(t,e),s):hh(bh(t,""),e)}class Pfe{constructor(e,s){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=n=>n.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(n,r)=>gv(r.backgroundColor),this.hoverBorderColor=(n,r)=>gv(r.borderColor),this.hoverColor=(n,r)=>gv(r.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(s)}set(e,s){return bv(this,e,s)}get(e){return bh(this,e)}describe(e,s){return bv(xv,e,s)}override(e,s){return bv(ml,e,s)}route(e,s,n,r){const i=bh(this,e),o=bh(this,n),l="_"+s;Object.defineProperties(i,{[l]:{value:i[s],writable:!0},[s]:{enumerable:!0,get(){const c=this[l],d=o[r];return Lt(c)?Object.assign({},d,c):It(c,d)},set(c){this[l]=c}}})}apply(e){e.forEach(s=>s(this))}}var Ss=new Pfe({_scriptable:t=>!t.startsWith("on"),_indexable:t=>t!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Tfe,Afe,Rfe]);function Ffe(t){return!t||Wt(t.size)||Wt(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}function LD(t,e,s,n,r){let i=e[r];return i||(i=e[r]=t.measureText(r).width,s.push(r)),i>n&&(n=i),n}function gl(t,e,s){const n=t.currentDevicePixelRatio,r=s!==0?Math.max(s/2,.5):0;return Math.round((e-r)*n)/n+r}function zD(t,e){!e&&!t||(e=e||t.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore())}function yv(t,e,s,n){BD(t,e,s,n,null)}function BD(t,e,s,n,r){let i,o,l,c,d,u,h,p;const f=e.pointStyle,m=e.rotation,b=e.radius;let g=(m||0)*hfe;if(f&&typeof f=="object"&&(i=f.toString(),i==="[object HTMLImageElement]"||i==="[object HTMLCanvasElement]")){t.save(),t.translate(s,n),t.rotate(g),t.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),t.restore();return}if(!(isNaN(b)||b<=0)){switch(t.beginPath(),f){default:r?t.ellipse(s,n,r/2,b,0,0,Si):t.arc(s,n,b,0,Si),t.closePath();break;case"triangle":u=r?r/2:b,t.moveTo(s+Math.sin(g)*u,n-Math.cos(g)*b),g+=kD,t.lineTo(s+Math.sin(g)*u,n-Math.cos(g)*b),g+=kD,t.lineTo(s+Math.sin(g)*u,n-Math.cos(g)*b),t.closePath();break;case"rectRounded":d=b*.516,c=b-d,o=Math.cos(g+ul)*c,h=Math.cos(g+ul)*(r?r/2-d:c),l=Math.sin(g+ul)*c,p=Math.sin(g+ul)*(r?r/2-d:c),t.arc(s-h,n-l,d,g-qs,g-Kr),t.arc(s+p,n-o,d,g-Kr,g),t.arc(s+h,n+l,d,g,g+Kr),t.arc(s-p,n+o,d,g+Kr,g+qs),t.closePath();break;case"rect":if(!m){c=Math.SQRT1_2*b,u=r?r/2:c,t.rect(s-u,n-c,2*u,2*c);break}g+=ul;case"rectRot":h=Math.cos(g)*(r?r/2:b),o=Math.cos(g)*b,l=Math.sin(g)*b,p=Math.sin(g)*(r?r/2:b),t.moveTo(s-h,n-l),t.lineTo(s+p,n-o),t.lineTo(s+h,n+l),t.lineTo(s-p,n+o),t.closePath();break;case"crossRot":g+=ul;case"cross":h=Math.cos(g)*(r?r/2:b),o=Math.cos(g)*b,l=Math.sin(g)*b,p=Math.sin(g)*(r?r/2:b),t.moveTo(s-h,n-l),t.lineTo(s+h,n+l),t.moveTo(s+p,n-o),t.lineTo(s-p,n+o);break;case"star":h=Math.cos(g)*(r?r/2:b),o=Math.cos(g)*b,l=Math.sin(g)*b,p=Math.sin(g)*(r?r/2:b),t.moveTo(s-h,n-l),t.lineTo(s+h,n+l),t.moveTo(s+p,n-o),t.lineTo(s-p,n+o),g+=ul,h=Math.cos(g)*(r?r/2:b),o=Math.cos(g)*b,l=Math.sin(g)*b,p=Math.sin(g)*(r?r/2:b),t.moveTo(s-h,n-l),t.lineTo(s+h,n+l),t.moveTo(s+p,n-o),t.lineTo(s-p,n+o);break;case"line":o=r?r/2:Math.cos(g)*b,l=Math.sin(g)*b,t.moveTo(s-o,n-l),t.lineTo(s+o,n+l);break;case"dash":t.moveTo(s,n),t.lineTo(s+Math.cos(g)*(r?r/2:b),n+Math.sin(g)*b);break;case!1:t.closePath();break}t.fill(),e.borderWidth>0&&t.stroke()}}function yh(t,e,s){return s=s||.5,!e||t&&t.x>e.left-s&&t.x<e.right+s&&t.y>e.top-s&&t.y<e.bottom+s}function wv(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function vv(t){t.restore()}function Ofe(t,e,s,n,r){if(!e)return t.lineTo(s.x,s.y);if(r==="middle"){const i=(e.x+s.x)/2;t.lineTo(i,e.y),t.lineTo(i,s.y)}else r==="after"!=!!n?t.lineTo(e.x,s.y):t.lineTo(s.x,e.y);t.lineTo(s.x,s.y)}function Mfe(t,e,s,n){if(!e)return t.lineTo(s.x,s.y);t.bezierCurveTo(n?e.cp1x:e.cp2x,n?e.cp1y:e.cp2y,n?s.cp2x:s.cp1x,n?s.cp2y:s.cp1y,s.x,s.y)}function Lfe(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),Wt(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}function zfe(t,e,s,n,r){if(r.strikethrough||r.underline){const i=t.measureText(n),o=e-i.actualBoundingBoxLeft,l=e+i.actualBoundingBoxRight,c=s-i.actualBoundingBoxAscent,d=s+i.actualBoundingBoxDescent,u=r.strikethrough?(c+d)/2:d;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=r.decorationWidth||2,t.moveTo(o,u),t.lineTo(l,u),t.stroke()}}function Bfe(t,e){const s=t.fillStyle;t.fillStyle=e.color,t.fillRect(e.left,e.top,e.width,e.height),t.fillStyle=s}function wh(t,e,s,n,r,i={}){const o=Ls(e)?e:[e],l=i.strokeWidth>0&&i.strokeColor!=="";let c,d;for(t.save(),t.font=r.string,Lfe(t,i),c=0;c<o.length;++c)d=o[c],i.backdrop&&Bfe(t,i.backdrop),l&&(i.strokeColor&&(t.strokeStyle=i.strokeColor),Wt(i.strokeWidth)||(t.lineWidth=i.strokeWidth),t.strokeText(d,s,n,i.maxWidth)),t.fillText(d,s,n,i.maxWidth),zfe(t,s,n,d,i),n+=Number(r.lineHeight);t.restore()}function kg(t,e){const{x:s,y:n,w:r,h:i,radius:o}=e;t.arc(s+o.topLeft,n+o.topLeft,o.topLeft,1.5*qs,qs,!0),t.lineTo(s,n+i-o.bottomLeft),t.arc(s+o.bottomLeft,n+i-o.bottomLeft,o.bottomLeft,qs,Kr,!0),t.lineTo(s+r-o.bottomRight,n+i),t.arc(s+r-o.bottomRight,n+i-o.bottomRight,o.bottomRight,Kr,0,!0),t.lineTo(s+r,n+o.topRight),t.arc(s+r-o.topRight,n+o.topRight,o.topRight,0,-Kr,!0),t.lineTo(s+o.topLeft,n)}const Ufe=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Vfe=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Wfe(t,e){const s=(""+t).match(Ufe);if(!s||s[1]==="normal")return e*1.2;switch(t=+s[2],s[3]){case"px":return t;case"%":t/=100;break}return e*t}const Gfe=t=>+t||0;function UD(t,e){const s={},n=Lt(e),r=n?Object.keys(e):e,i=Lt(t)?n?o=>It(t[o],t[e[o]]):o=>t[o]:()=>t;for(const o of r)s[o]=Gfe(i(o));return s}function VD(t){return UD(t,{top:"y",right:"x",bottom:"y",left:"x"})}function Dc(t){return UD(t,["topLeft","topRight","bottomLeft","bottomRight"])}function Cr(t){const e=VD(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function fn(t,e){t=t||{},e=e||Ss.font;let s=It(t.size,e.size);typeof s=="string"&&(s=parseInt(s,10));let n=It(t.style,e.style);n&&!(""+n).match(Vfe)&&(console.warn('Invalid font style specified: "'+n+'"'),n=void 0);const r={family:It(t.family,e.family),lineHeight:Wfe(It(t.lineHeight,e.lineHeight),s),size:s,style:n,weight:It(t.weight,e.weight),string:""};return r.string=Ffe(r),r}function Cg(t,e,s,n){let r,i,o;for(r=0,i=t.length;r<i;++r)if(o=t[r],o!==void 0&&o!==void 0)return o}function Hfe(t,e,s){const{min:n,max:r}=t,i=ife(e,(r-n)/2),o=(l,c)=>s&&l===0?0:l+c;return{min:o(n,-Math.abs(i)),max:o(r,i)}}function xl(t,e){return Object.assign(Object.create(t),e)}function Nv(t,e=[""],s,n,r=()=>t[0]){const i=s||t;typeof n>"u"&&(n=KD("_fallback",t));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:i,_fallback:n,_getTarget:r,override:l=>Nv([l,...t],e,i,n)};return new Proxy(o,{deleteProperty(l,c){return delete l[c],delete l._keys,delete t[0][c],!0},get(l,c){return GD(l,c,()=>eme(c,e,t,l))},getOwnPropertyDescriptor(l,c){return Reflect.getOwnPropertyDescriptor(l._scopes[0],c)},getPrototypeOf(){return Reflect.getPrototypeOf(t[0])},has(l,c){return XD(l).includes(c)},ownKeys(l){return XD(l)},set(l,c,d){const u=l._storage||(l._storage=r());return l[c]=u[c]=d,delete l._keys,!0}})}function _c(t,e,s,n){const r={_cacheable:!1,_proxy:t,_context:e,_subProxy:s,_stack:new Set,_descriptors:WD(t,n),setContext:i=>_c(t,i,s,n),override:i=>_c(t.override(i),e,s,n)};return new Proxy(r,{deleteProperty(i,o){return delete i[o],delete t[o],!0},get(i,o,l){return GD(i,o,()=>Kfe(i,o,l))},getOwnPropertyDescriptor(i,o){return i._descriptors.allKeys?Reflect.has(t,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,o)},getPrototypeOf(){return Reflect.getPrototypeOf(t)},has(i,o){return Reflect.has(t,o)},ownKeys(){return Reflect.ownKeys(t)},set(i,o,l){return t[o]=l,delete i[o],!0}})}function WD(t,e={scriptable:!0,indexable:!0}){const{_scriptable:s=e.scriptable,_indexable:n=e.indexable,_allKeys:r=e.allKeys}=t;return{allKeys:r,scriptable:s,indexable:n,isScriptable:Zo(s)?s:()=>s,isIndexable:Zo(n)?n:()=>n}}const qfe=(t,e)=>t?t+dv(e):e,kv=(t,e)=>Lt(e)&&t!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function GD(t,e,s){if(Object.prototype.hasOwnProperty.call(t,e)||e==="constructor")return t[e];const n=s();return t[e]=n,n}function Kfe(t,e,s){const{_proxy:n,_context:r,_subProxy:i,_descriptors:o}=t;let l=n[e];return Zo(l)&&o.isScriptable(e)&&(l=Xfe(e,l,t,s)),Ls(l)&&l.length&&(l=Yfe(e,l,t,o.isIndexable)),kv(e,l)&&(l=_c(l,r,i&&i[e],o)),l}function Xfe(t,e,s,n){const{_proxy:r,_context:i,_subProxy:o,_stack:l}=s;if(l.has(t))throw new Error("Recursion detected: "+Array.from(l).join("->")+"->"+t);l.add(t);let c=e(i,o||n);return l.delete(t),kv(t,c)&&(c=Cv(r._scopes,r,t,c)),c}function Yfe(t,e,s,n){const{_proxy:r,_context:i,_subProxy:o,_descriptors:l}=s;if(typeof i.index<"u"&&n(t))return e[i.index%e.length];if(Lt(e[0])){const c=e,d=r._scopes.filter(u=>u!==c);e=[];for(const u of c){const h=Cv(d,r,t,u);e.push(_c(h,i,o&&o[t],l))}}return e}function HD(t,e,s){return Zo(t)?t(e,s):t}const Zfe=(t,e)=>t===!0?e:typeof t=="string"?Ac(e,t):void 0;function Jfe(t,e,s,n,r){for(const i of e){const o=Zfe(s,i);if(o){t.add(o);const l=HD(o._fallback,s,r);if(typeof l<"u"&&l!==s&&l!==n)return l}else if(o===!1&&typeof n<"u"&&s!==n)return null}return!1}function Cv(t,e,s,n){const r=e._rootScopes,i=HD(e._fallback,s,n),o=[...t,...r],l=new Set;l.add(n);let c=qD(l,o,s,i||s,n);return c===null||typeof i<"u"&&i!==s&&(c=qD(l,o,i,c,n),c===null)?!1:Nv(Array.from(l),[""],r,i,()=>Qfe(e,s,n))}function qD(t,e,s,n,r){for(;s;)s=Jfe(t,e,s,n,r);return s}function Qfe(t,e,s){const n=t._getTarget();e in n||(n[e]={});const r=n[e];return Ls(r)&&Lt(s)?s:r||{}}function eme(t,e,s,n){let r;for(const i of e)if(r=KD(qfe(i,t),s),typeof r<"u")return kv(t,r)?Cv(s,n,t,r):r}function KD(t,e){for(const s of e){if(!s)continue;const n=s[t];if(typeof n<"u")return n}}function XD(t){let e=t._keys;return e||(e=t._keys=tme(t._scopes)),e}function tme(t){const e=new Set;for(const s of t)for(const n of Object.keys(s).filter(r=>!r.startsWith("_")))e.add(n);return Array.from(e)}const sme=Number.EPSILON||1e-14,Rc=(t,e)=>e<t.length&&!t[e].skip&&t[e],YD=t=>t==="x"?"y":"x";function nme(t,e,s,n){const r=t.skip?e:t,i=e,o=s.skip?e:s,l=hv(i,r),c=hv(o,i);let d=l/(l+c),u=c/(l+c);d=isNaN(d)?0:d,u=isNaN(u)?0:u;const h=n*d,p=n*u;return{previous:{x:i.x-h*(o.x-r.x),y:i.y-h*(o.y-r.y)},next:{x:i.x+p*(o.x-r.x),y:i.y+p*(o.y-r.y)}}}function rme(t,e,s){const n=t.length;let r,i,o,l,c,d=Rc(t,0);for(let u=0;u<n-1;++u)if(c=d,d=Rc(t,u+1),!(!c||!d)){if(mh(e[u],0,sme)){s[u]=s[u+1]=0;continue}r=s[u]/e[u],i=s[u+1]/e[u],l=Math.pow(r,2)+Math.pow(i,2),!(l<=9)&&(o=3/Math.sqrt(l),s[u]=r*o*e[u],s[u+1]=i*o*e[u])}}function ime(t,e,s="x"){const n=YD(s),r=t.length;let i,o,l,c=Rc(t,0);for(let d=0;d<r;++d){if(o=l,l=c,c=Rc(t,d+1),!l)continue;const u=l[s],h=l[n];o&&(i=(u-o[s])/3,l[`cp1${s}`]=u-i,l[`cp1${n}`]=h-i*e[d]),c&&(i=(c[s]-u)/3,l[`cp2${s}`]=u+i,l[`cp2${n}`]=h+i*e[d])}}function ome(t,e="x"){const s=YD(e),n=t.length,r=Array(n).fill(0),i=Array(n);let o,l,c,d=Rc(t,0);for(o=0;o<n;++o)if(l=c,c=d,d=Rc(t,o+1),!!c){if(d){const u=d[e]-c[e];r[o]=u!==0?(d[s]-c[s])/u:0}i[o]=l?d?ji(r[o-1])!==ji(r[o])?0:(r[o-1]+r[o])/2:r[o-1]:r[o]}rme(t,r,i),ime(t,i,e)}function Sg(t,e,s){return Math.max(Math.min(t,s),e)}function ame(t,e){let s,n,r,i,o,l=yh(t[0],e);for(s=0,n=t.length;s<n;++s)o=i,i=l,l=s<n-1&&yh(t[s+1],e),i&&(r=t[s],o&&(r.cp1x=Sg(r.cp1x,e.left,e.right),r.cp1y=Sg(r.cp1y,e.top,e.bottom)),l&&(r.cp2x=Sg(r.cp2x,e.left,e.right),r.cp2y=Sg(r.cp2y,e.top,e.bottom)))}function lme(t,e,s,n,r){let i,o,l,c;if(e.spanGaps&&(t=t.filter(d=>!d.skip)),e.cubicInterpolationMode==="monotone")ome(t,r);else{let d=n?t[t.length-1]:t[0];for(i=0,o=t.length;i<o;++i)l=t[i],c=nme(d,l,t[Math.min(i+1,o-(n?0:1))%o],e.tension),l.cp1x=c.previous.x,l.cp1y=c.previous.y,l.cp2x=c.next.x,l.cp2y=c.next.y,d=l}e.capBezierPoints&&ame(t,s)}function Sv(){return typeof window<"u"&&typeof document<"u"}function jv(t){let e=t.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function jg(t,e,s){let n;return typeof t=="string"?(n=parseInt(t,10),t.indexOf("%")!==-1&&(n=n/100*e.parentNode[s])):n=t,n}const Ig=t=>t.ownerDocument.defaultView.getComputedStyle(t,null);function cme(t,e){return Ig(t).getPropertyValue(e)}const dme=["top","right","bottom","left"];function bl(t,e,s){const n={};s=s?"-"+s:"";for(let r=0;r<4;r++){const i=dme[r];n[i]=parseFloat(t[e+"-"+i+s])||0}return n.width=n.left+n.right,n.height=n.top+n.bottom,n}const ume=(t,e,s)=>(t>0||e>0)&&(!s||!s.shadowRoot);function hme(t,e){const s=t.touches,n=s&&s.length?s[0]:t,{offsetX:r,offsetY:i}=n;let o=!1,l,c;if(ume(r,i,t.target))l=r,c=i;else{const d=e.getBoundingClientRect();l=n.clientX-d.left,c=n.clientY-d.top,o=!0}return{x:l,y:c,box:o}}function yl(t,e){if("native"in t)return t;const{canvas:s,currentDevicePixelRatio:n}=e,r=Ig(s),i=r.boxSizing==="border-box",o=bl(r,"padding"),l=bl(r,"border","width"),{x:c,y:d,box:u}=hme(t,s),h=o.left+(u&&l.left),p=o.top+(u&&l.top);let{width:f,height:m}=e;return i&&(f-=o.width+l.width,m-=o.height+l.height),{x:Math.round((c-h)/f*s.width/n),y:Math.round((d-p)/m*s.height/n)}}function pme(t,e,s){let n,r;if(e===void 0||s===void 0){const i=t&&jv(t);if(!i)e=t.clientWidth,s=t.clientHeight;else{const o=i.getBoundingClientRect(),l=Ig(i),c=bl(l,"border","width"),d=bl(l,"padding");e=o.width-d.width-c.width,s=o.height-d.height-c.height,n=jg(l.maxWidth,i,"clientWidth"),r=jg(l.maxHeight,i,"clientHeight")}}return{width:e,height:s,maxWidth:n||vg,maxHeight:r||vg}}const Qo=t=>Math.round(t*10)/10;function fme(t,e,s,n){const r=Ig(t),i=bl(r,"margin"),o=jg(r.maxWidth,t,"clientWidth")||vg,l=jg(r.maxHeight,t,"clientHeight")||vg,c=pme(t,e,s);let{width:d,height:u}=c;if(r.boxSizing==="content-box"){const p=bl(r,"border","width"),f=bl(r,"padding");d-=f.width+p.width,u-=f.height+p.height}return d=Math.max(0,d-i.width),u=Math.max(0,n?d/n:u-i.height),d=Qo(Math.min(d,o,c.maxWidth)),u=Qo(Math.min(u,l,c.maxHeight)),d&&!u&&(u=Qo(d/2)),(e!==void 0||s!==void 0)&&n&&c.height&&u>c.height&&(u=c.height,d=Qo(Math.floor(u*n))),{width:d,height:u}}function ZD(t,e,s){const n=e||1,r=Qo(t.height*n),i=Qo(t.width*n);t.height=Qo(t.height),t.width=Qo(t.width);const o=t.canvas;return o.style&&(s||!o.style.height&&!o.style.width)&&(o.style.height=`${t.height}px`,o.style.width=`${t.width}px`),t.currentDevicePixelRatio!==n||o.height!==r||o.width!==i?(t.currentDevicePixelRatio=n,o.height=r,o.width=i,t.ctx.setTransform(n,0,0,n,0,0),!0):!1}const mme=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};Sv()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return t}();function JD(t,e){const s=cme(t,e),n=s&&s.match(/^(\d+)(\.\d+)?px$/);return n?+n[1]:void 0}function wl(t,e,s,n){return{x:t.x+s*(e.x-t.x),y:t.y+s*(e.y-t.y)}}function gme(t,e,s,n){return{x:t.x+s*(e.x-t.x),y:n==="middle"?s<.5?t.y:e.y:n==="after"?s<1?t.y:e.y:s>0?e.y:t.y}}function xme(t,e,s,n){const r={x:t.cp2x,y:t.cp2y},i={x:e.cp1x,y:e.cp1y},o=wl(t,r,s),l=wl(r,i,s),c=wl(i,e,s),d=wl(o,l,s),u=wl(l,c,s);return wl(d,u,s)}const bme=function(t,e){return{x(s){return t+t+e-s},setWidth(s){e=s},textAlign(s){return s==="center"?s:s==="right"?"left":"right"},xPlus(s,n){return s-n},leftForLtr(s,n){return s-n}}},yme=function(){return{x(t){return t},setWidth(t){},textAlign(t){return t},xPlus(t,e){return t+e},leftForLtr(t,e){return t}}};function Pc(t,e,s){return t?bme(e,s):yme()}function QD(t,e){let s,n;(e==="ltr"||e==="rtl")&&(s=t.canvas.style,n=[s.getPropertyValue("direction"),s.getPropertyPriority("direction")],s.setProperty("direction",e,"important"),t.prevTextDirection=n)}function e_(t,e){e!==void 0&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function t_(t){return t==="angle"?{between:jD,compare:yfe,normalize:Jo}:{between:pl,compare:(e,s)=>e-s,normalize:e=>e}}function s_({start:t,end:e,count:s,loop:n,style:r}){return{start:t%s,end:e%s,loop:n&&(e-t+1)%s===0,style:r}}function wme(t,e,s){const{property:n,start:r,end:i}=s,{between:o,normalize:l}=t_(n),c=e.length;let{start:d,end:u,loop:h}=t,p,f;if(h){for(d+=c,u+=c,p=0,f=c;p<f&&o(l(e[d%c][n]),r,i);++p)d--,u--;d%=c,u%=c}return u<d&&(u+=c),{start:d,end:u,loop:h,style:t.style}}function vme(t,e,s){if(!s)return[t];const{property:n,start:r,end:i}=s,o=e.length,{compare:l,between:c,normalize:d}=t_(n),{start:u,end:h,loop:p,style:f}=wme(t,e,s),m=[];let b=!1,g=null,x,y,w;const v=()=>c(r,w,x)&&l(r,w)!==0,N=()=>l(i,x)===0||c(i,w,x),C=()=>b||v(),j=()=>!b||N();for(let I=u,T=u;I<=h;++I)y=e[I%o],!y.skip&&(x=d(y[n]),x!==w&&(b=c(x,r,i),g===null&&C()&&(g=l(x,r)===0?I:T),g!==null&&j()&&(m.push(s_({start:g,end:I,loop:p,count:o,style:f})),g=null),T=I,w=x));return g!==null&&m.push(s_({start:g,end:h,loop:p,count:o,style:f})),m}function Nme(t,e){const s=[],n=t.segments;for(let r=0;r<n.length;r++){const i=vme(n[r],t.points,e);i.length&&s.push(...i)}return s}function kme(t,e,s,n){let r=0,i=e-1;if(s&&!n)for(;r<e&&!t[r].skip;)r++;for(;r<e&&t[r].skip;)r++;for(r%=e,s&&(i+=r);i>r&&t[i%e].skip;)i--;return i%=e,{start:r,end:i}}function Cme(t,e,s,n){const r=t.length,i=[];let o=e,l=t[e],c;for(c=e+1;c<=s;++c){const d=t[c%r];d.skip||d.stop?l.skip||(n=!1,i.push({start:e%r,end:(c-1)%r,loop:n}),e=o=d.stop?c:null):(o=c,l.skip&&(e=c)),l=d}return o!==null&&i.push({start:e%r,end:o%r,loop:n}),i}function Sme(t,e){const s=t.points,n=t.options.spanGaps,r=s.length;if(!r)return[];const i=!!t._loop,{start:o,end:l}=kme(s,r,i,n);if(n===!0)return n_(t,[{start:o,end:l,loop:i}],s,e);const c=l<o?l+r:l,d=!!t._fullLoop&&o===0&&l===r-1;return n_(t,Cme(s,o,c,d),s,e)}function n_(t,e,s,n){return!n||!n.setContext||!s?e:jme(t,e,s,n)}function jme(t,e,s,n){const r=t._chart.getContext(),i=r_(t.options),{_datasetIndex:o,options:{spanGaps:l}}=t,c=s.length,d=[];let u=i,h=e[0].start,p=h;function f(m,b,g,x){const y=l?-1:1;if(m!==b){for(m+=c;s[m%c].skip;)m-=y;for(;s[b%c].skip;)b+=y;m%c!==b%c&&(d.push({start:m%c,end:b%c,loop:g,style:x}),u=x,h=b%c)}}for(const m of e){h=l?h:m.start;let b=s[h%c],g;for(p=h+1;p<=m.end;p++){const x=s[p%c];g=r_(n.setContext(xl(r,{type:"segment",p0:b,p1:x,p0DataIndex:(p-1)%c,p1DataIndex:p%c,datasetIndex:o}))),Ime(g,u)&&f(h,p-1,m.loop,u),b=x,u=g}h<p-1&&f(h,p-1,m.loop,u)}return d}function r_(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function Ime(t,e){if(!e)return!1;const s=[],n=function(r,i){return mv(i)?(s.includes(i)||s.push(i),s.indexOf(i)):i};return JSON.stringify(t,n)!==JSON.stringify(e,n)}function Eg(t,e,s){return t.options.clip?t[s]:e[s]}function Eme(t,e){const{xScale:s,yScale:n}=t;return s&&n?{left:Eg(s,e,"left"),right:Eg(s,e,"right"),top:Eg(n,e,"top"),bottom:Eg(n,e,"bottom")}:e}function $me(t,e){const s=e._clip;if(s.disabled)return!1;const n=Eme(e,t.chartArea);return{left:s.left===!1?0:n.left-(s.left===!0?0:s.left),right:s.right===!1?t.width:n.right+(s.right===!0?0:s.right),top:s.top===!1?0:n.top-(s.top===!0?0:s.top),bottom:s.bottom===!1?t.height:n.bottom+(s.bottom===!0?0:s.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class Tme{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,s,n,r){const i=s.listeners[r],o=s.duration;i.forEach(l=>l({chart:e,initial:s.initial,numSteps:o,currentStep:Math.min(n-s.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=TD.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let s=0;this._charts.forEach((n,r)=>{if(!n.running||!n.items.length)return;const i=n.items;let o=i.length-1,l=!1,c;for(;o>=0;--o)c=i[o],c._active?(c._total>n.duration&&(n.duration=c._total),c.tick(e),l=!0):(i[o]=i[i.length-1],i.pop());l&&(r.draw(),this._notify(r,n,e,"progress")),i.length||(n.running=!1,this._notify(r,n,e,"complete"),n.initial=!1),s+=i.length}),this._lastDate=e,s===0&&(this._running=!1)}_getAnims(e){const s=this._charts;let n=s.get(e);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},s.set(e,n)),n}listen(e,s,n){this._getAnims(e).listeners[s].push(n)}add(e,s){!s||!s.length||this._getAnims(e).items.push(...s)}has(e){return this._getAnims(e).items.length>0}start(e){const s=this._charts.get(e);s&&(s.running=!0,s.start=Date.now(),s.duration=s.items.reduce((n,r)=>Math.max(n,r._duration),0),this._refresh())}running(e){if(!this._running)return!1;const s=this._charts.get(e);return!(!s||!s.running||!s.items.length)}stop(e){const s=this._charts.get(e);if(!s||!s.items.length)return;const n=s.items;let r=n.length-1;for(;r>=0;--r)n[r].cancel();s.items=[],this._notify(e,s,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var lo=new Tme;const i_="transparent",Ame={boolean(t,e,s){return s>.5?e:t},color(t,e,s){const n=RD(t||i_),r=n.valid&&RD(e||i_);return r&&r.valid?r.mix(n,s).hexString():e},number(t,e,s){return t+(e-t)*s}};class Dme{constructor(e,s,n,r){const i=s[n];r=Cg([e.to,r,i,e.from]);const o=Cg([e.from,i,r]);this._active=!0,this._fn=e.fn||Ame[e.type||typeof o],this._easing=xh[e.easing]||xh.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=s,this._prop=n,this._from=o,this._to=r,this._promises=void 0}active(){return this._active}update(e,s,n){if(this._active){this._notify(!1);const r=this._target[this._prop],i=n-this._start,o=this._duration-i;this._start=n,this._duration=Math.floor(Math.max(o,e.duration)),this._total+=i,this._loop=!!e.loop,this._to=Cg([e.to,s,r,e.from]),this._from=Cg([e.from,r,s])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const s=e-this._start,n=this._duration,r=this._prop,i=this._from,o=this._loop,l=this._to;let c;if(this._active=i!==l&&(o||s<n),!this._active){this._target[r]=l,this._notify(!0);return}if(s<0){this._target[r]=i;return}c=s/n%2,c=o&&c>1?2-c:c,c=this._easing(Math.min(1,Math.max(0,c))),this._target[r]=this._fn(i,l,c)}wait(){const e=this._promises||(this._promises=[]);return new Promise((s,n)=>{e.push({res:s,rej:n})})}_notify(e){const s=e?"res":"rej",n=this._promises||[];for(let r=0;r<n.length;r++)n[r][s]()}}class o_{constructor(e,s){this._chart=e,this._properties=new Map,this.configure(s)}configure(e){if(!Lt(e))return;const s=Object.keys(Ss.animation),n=this._properties;Object.getOwnPropertyNames(e).forEach(r=>{const i=e[r];if(!Lt(i))return;const o={};for(const l of s)o[l]=i[l];(Ls(i.properties)&&i.properties||[r]).forEach(l=>{(l===r||!n.has(l))&&n.set(l,o)})})}_animateOptions(e,s){const n=s.options,r=Rme(e,n);if(!r)return[];const i=this._createAnimations(r,n);return n.$shared&&_me(e.options.$animations,n).then(()=>{e.options=n},()=>{}),i}_createAnimations(e,s){const n=this._properties,r=[],i=e.$animations||(e.$animations={}),o=Object.keys(s),l=Date.now();let c;for(c=o.length-1;c>=0;--c){const d=o[c];if(d.charAt(0)==="$")continue;if(d==="options"){r.push(...this._animateOptions(e,s));continue}const u=s[d];let h=i[d];const p=n.get(d);if(h)if(p&&h.active()){h.update(p,u,l);continue}else h.cancel();if(!p||!p.duration){e[d]=u;continue}i[d]=h=new Dme(p,e,d,u),r.push(h)}return r}update(e,s){if(this._properties.size===0){Object.assign(e,s);return}const n=this._createAnimations(e,s);if(n.length)return lo.add(this._chart,n),!0}}function _me(t,e){const s=[],n=Object.keys(e);for(let r=0;r<n.length;r++){const i=t[n[r]];i&&i.active()&&s.push(i.wait())}return Promise.all(s)}function Rme(t,e){if(!e)return;let s=t.options;if(!s){t.options=e;return}return s.$shared&&(t.options=s=Object.assign({},s,{$shared:!1,$animations:{}})),s}function a_(t,e){const s=t&&t.options||{},n=s.reverse,r=s.min===void 0?e:0,i=s.max===void 0?e:0;return{start:n?i:r,end:n?r:i}}function Pme(t,e,s){if(s===!1)return!1;const n=a_(t,s),r=a_(e,s);return{top:r.end,right:n.end,bottom:r.start,left:n.start}}function Fme(t){let e,s,n,r;return Lt(t)?(e=t.top,s=t.right,n=t.bottom,r=t.left):e=s=n=r=t,{top:e,right:s,bottom:n,left:r,disabled:t===!1}}function l_(t,e){const s=[],n=t._getSortedDatasetMetas(e);let r,i;for(r=0,i=n.length;r<i;++r)s.push(n[r].index);return s}function c_(t,e,s,n={}){const r=t.keys,i=n.mode==="single";let o,l,c,d;if(e===null)return;let u=!1;for(o=0,l=r.length;o<l;++o){if(c=+r[o],c===s){if(u=!0,n.all)continue;break}d=t.values[c],kr(d)&&(i||e===0||ji(e)===ji(d))&&(e+=d)}return!u&&!n.all?0:e}function Ome(t,e){const{iScale:s,vScale:n}=e,r=s.axis==="x"?"x":"y",i=n.axis==="x"?"x":"y",o=Object.keys(t),l=new Array(o.length);let c,d,u;for(c=0,d=o.length;c<d;++c)u=o[c],l[c]={[r]:u,[i]:t[u]};return l}function Iv(t,e){const s=t&&t.options.stacked;return s||s===void 0&&e.stack!==void 0}function Mme(t,e,s){return`${t.id}.${e.id}.${s.stack||s.type}`}function Lme(t){const{min:e,max:s,minDefined:n,maxDefined:r}=t.getUserBounds();return{min:n?e:Number.NEGATIVE_INFINITY,max:r?s:Number.POSITIVE_INFINITY}}function zme(t,e,s){const n=t[e]||(t[e]={});return n[s]||(n[s]={})}function d_(t,e,s,n){for(const r of e.getMatchingVisibleMetas(n).reverse()){const i=t[r.index];if(s&&i>0||!s&&i<0)return r.index}return null}function u_(t,e){const{chart:s,_cachedMeta:n}=t,r=s._stacks||(s._stacks={}),{iScale:i,vScale:o,index:l}=n,c=i.axis,d=o.axis,u=Mme(i,o,n),h=e.length;let p;for(let f=0;f<h;++f){const m=e[f],{[c]:b,[d]:g}=m,x=m._stacks||(m._stacks={});p=x[d]=zme(r,u,b),p[l]=g,p._top=d_(p,o,!0,n.type),p._bottom=d_(p,o,!1,n.type);const y=p._visualValues||(p._visualValues={});y[l]=g}}function Ev(t,e){const s=t.scales;return Object.keys(s).filter(n=>s[n].axis===e).shift()}function Bme(t,e){return xl(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function Ume(t,e,s){return xl(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:s,index:e,mode:"default",type:"data"})}function vh(t,e){const s=t.controller.index,n=t.vScale&&t.vScale.axis;if(n){e=e||t._parsed;for(const r of e){const i=r._stacks;if(!i||i[n]===void 0||i[n][s]===void 0)return;delete i[n][s],i[n]._visualValues!==void 0&&i[n]._visualValues[s]!==void 0&&delete i[n]._visualValues[s]}}}const $v=t=>t==="reset"||t==="none",h_=(t,e)=>e?t:Object.assign({},t),Vme=(t,e,s)=>t&&!e.hidden&&e._stacked&&{keys:l_(s,!0),values:null};class Tv{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(e,s){this.chart=e,this._ctx=e.ctx,this.index=s,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=Iv(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&vh(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,s=this._cachedMeta,n=this.getDataset(),r=(h,p,f,m)=>h==="x"?p:h==="r"?m:f,i=s.xAxisID=It(n.xAxisID,Ev(e,"x")),o=s.yAxisID=It(n.yAxisID,Ev(e,"y")),l=s.rAxisID=It(n.rAxisID,Ev(e,"r")),c=s.indexAxis,d=s.iAxisID=r(c,i,o,l),u=s.vAxisID=r(c,o,i,l);s.xScale=this.getScaleForId(i),s.yScale=this.getScaleForId(o),s.rScale=this.getScaleForId(l),s.iScale=this.getScaleForId(d),s.vScale=this.getScaleForId(u)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const s=this._cachedMeta;return e===s.iScale?s.vScale:s.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&ED(this._data,this),e._stacked&&vh(e)}_dataCheck(){const e=this.getDataset(),s=e.data||(e.data=[]),n=this._data;if(Lt(s)){const r=this._cachedMeta;this._data=Ome(s,r)}else if(n!==s){if(n){ED(n,this);const r=this._cachedMeta;vh(r),r._parsed=[]}s&&Object.isExtensible(s)&&kfe(s,this),this._syncList=[],this._data=s}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const s=this._cachedMeta,n=this.getDataset();let r=!1;this._dataCheck();const i=s._stacked;s._stacked=Iv(s.vScale,s),s.stack!==n.stack&&(r=!0,vh(s),s.stack=n.stack),this._resyncElements(e),(r||i!==s._stacked)&&(u_(this,s._parsed),s._stacked=Iv(s.vScale,s))}configure(){const e=this.chart.config,s=e.datasetScopeKeys(this._type),n=e.getOptionScopes(this.getDataset(),s,!0);this.options=e.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,s){const{_cachedMeta:n,_data:r}=this,{iScale:i,_stacked:o}=n,l=i.axis;let c=e===0&&s===r.length?!0:n._sorted,d=e>0&&n._parsed[e-1],u,h,p;if(this._parsing===!1)n._parsed=r,n._sorted=!0,p=r;else{Ls(r[e])?p=this.parseArrayData(n,r,e,s):Lt(r[e])?p=this.parseObjectData(n,r,e,s):p=this.parsePrimitiveData(n,r,e,s);const f=()=>h[l]===null||d&&h[l]<d[l];for(u=0;u<s;++u)n._parsed[u+e]=h=p[u],c&&(f()&&(c=!1),d=h);n._sorted=c}o&&u_(this,p)}parsePrimitiveData(e,s,n,r){const{iScale:i,vScale:o}=e,l=i.axis,c=o.axis,d=i.getLabels(),u=i===o,h=new Array(r);let p,f,m;for(p=0,f=r;p<f;++p)m=p+n,h[p]={[l]:u||i.parse(d[m],m),[c]:o.parse(s[m],m)};return h}parseArrayData(e,s,n,r){const{xScale:i,yScale:o}=e,l=new Array(r);let c,d,u,h;for(c=0,d=r;c<d;++c)u=c+n,h=s[u],l[c]={x:i.parse(h[0],u),y:o.parse(h[1],u)};return l}parseObjectData(e,s,n,r){const{xScale:i,yScale:o}=e,{xAxisKey:l="x",yAxisKey:c="y"}=this._parsing,d=new Array(r);let u,h,p,f;for(u=0,h=r;u<h;++u)p=u+n,f=s[p],d[u]={x:i.parse(Ac(f,l),p),y:o.parse(Ac(f,c),p)};return d}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,s,n){const r=this.chart,i=this._cachedMeta,o=s[e.axis],l={keys:l_(r,!0),values:s._stacks[e.axis]._visualValues};return c_(l,o,i.index,{mode:n})}updateRangeFromParsed(e,s,n,r){const i=n[s.axis];let o=i===null?NaN:i;const l=r&&n._stacks[s.axis];r&&l&&(r.values=l,o=c_(r,i,this._cachedMeta.index)),e.min=Math.min(e.min,o),e.max=Math.max(e.max,o)}getMinMax(e,s){const n=this._cachedMeta,r=n._parsed,i=n._sorted&&e===n.iScale,o=r.length,l=this._getOtherScale(e),c=Vme(s,n,this.chart),d={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:u,max:h}=Lme(l);let p,f;function m(){f=r[p];const b=f[l.axis];return!kr(f[e.axis])||u>b||h<b}for(p=0;p<o&&!(!m()&&(this.updateRangeFromParsed(d,e,f,c),i));++p);if(i){for(p=o-1;p>=0;--p)if(!m()){this.updateRangeFromParsed(d,e,f,c);break}}return d}getAllParsedValues(e){const s=this._cachedMeta._parsed,n=[];let r,i,o;for(r=0,i=s.length;r<i;++r)o=s[r][e.axis],kr(o)&&n.push(o);return n}getMaxOverflow(){return!1}getLabelAndValue(e){const s=this._cachedMeta,n=s.iScale,r=s.vScale,i=this.getParsed(e);return{label:n?""+n.getLabelForValue(i[n.axis]):"",value:r?""+r.getLabelForValue(i[r.axis]):""}}_update(e){const s=this._cachedMeta;this.update(e||"default"),s._clip=Fme(It(this.options.clip,Pme(s.xScale,s.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,s=this.chart,n=this._cachedMeta,r=n.data||[],i=s.chartArea,o=[],l=this._drawStart||0,c=this._drawCount||r.length-l,d=this.options.drawActiveElementsOnTop;let u;for(n.dataset&&n.dataset.draw(e,i,l,c),u=l;u<l+c;++u){const h=r[u];h.hidden||(h.active&&d?o.push(h):h.draw(e,i))}for(u=0;u<o.length;++u)o[u].draw(e,i)}getStyle(e,s){const n=s?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(e||0,n)}getContext(e,s,n){const r=this.getDataset();let i;if(e>=0&&e<this._cachedMeta.data.length){const o=this._cachedMeta.data[e];i=o.$context||(o.$context=Ume(this.getContext(),e,o)),i.parsed=this.getParsed(e),i.raw=r.data[e],i.index=i.dataIndex=e}else i=this.$context||(this.$context=Bme(this.chart.getContext(),this.index)),i.dataset=r,i.index=i.datasetIndex=this.index;return i.active=!!s,i.mode=n,i}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,s){return this._resolveElementOptions(this.dataElementType.id,s,e)}_resolveElementOptions(e,s="default",n){const r=s==="active",i=this._cachedDataOpts,o=e+"-"+s,l=i[o],c=this.enableOptionSharing&&fh(n);if(l)return h_(l,c);const d=this.chart.config,u=d.datasetElementScopeKeys(this._type,e),h=r?[`${e}Hover`,"hover",e,""]:[e,""],p=d.getOptionScopes(this.getDataset(),u),f=Object.keys(Ss.elements[e]),m=()=>this.getContext(n,r,s),b=d.resolveNamedOptions(p,f,m,h);return b.$shared&&(b.$shared=c,i[o]=Object.freeze(h_(b,c))),b}_resolveAnimations(e,s,n){const r=this.chart,i=this._cachedDataOpts,o=`animation-${s}`,l=i[o];if(l)return l;let c;if(r.options.animation!==!1){const u=this.chart.config,h=u.datasetAnimationScopeKeys(this._type,s),p=u.getOptionScopes(this.getDataset(),h);c=u.createResolver(p,this.getContext(e,n,s))}const d=new o_(r,c&&c.animations);return c&&c._cacheable&&(i[o]=Object.freeze(d)),d}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,s){return!s||$v(e)||this.chart._animationsDisabled}_getSharedOptions(e,s){const n=this.resolveDataElementOptions(e,s),r=this._sharedOptions,i=this.getSharedOptions(n),o=this.includeOptions(s,i)||i!==r;return this.updateSharedOptions(i,s,n),{sharedOptions:i,includeOptions:o}}updateElement(e,s,n,r){$v(r)?Object.assign(e,n):this._resolveAnimations(s,r).update(e,n)}updateSharedOptions(e,s,n){e&&!$v(s)&&this._resolveAnimations(void 0,s).update(e,n)}_setStyle(e,s,n,r){e.active=r;const i=this.getStyle(s,r);this._resolveAnimations(s,n,r).update(e,{options:!r&&this.getSharedOptions(i)||i})}removeHoverStyle(e,s,n){this._setStyle(e,n,"active",!1)}setHoverStyle(e,s,n){this._setStyle(e,n,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const s=this._data,n=this._cachedMeta.data;for(const[l,c,d]of this._syncList)this[l](c,d);this._syncList=[];const r=n.length,i=s.length,o=Math.min(i,r);o&&this.parse(0,o),i>r?this._insertElements(r,i-r,e):i<r&&this._removeElements(i,r-i)}_insertElements(e,s,n=!0){const r=this._cachedMeta,i=r.data,o=e+s;let l;const c=d=>{for(d.length+=s,l=d.length-1;l>=o;l--)d[l]=d[l-s]};for(c(i),l=e;l<o;++l)i[l]=new this.dataElementType;this._parsing&&c(r._parsed),this.parse(e,s),n&&this.updateElements(i,e,s,"reset")}updateElements(e,s,n,r){}_removeElements(e,s){const n=this._cachedMeta;if(this._parsing){const r=n._parsed.splice(e,s);n._stacked&&vh(n,r)}n.data.splice(e,s)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[s,n,r]=e;this[s](n,r)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,s){s&&this._sync(["_removeElements",e,s]);const n=arguments.length-2;n&&this._sync(["_insertElements",e,n])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function Wme(t,e){if(!t._cache.$bar){const s=t.getMatchingVisibleMetas(e);let n=[];for(let r=0,i=s.length;r<i;r++)n=n.concat(s[r].controller.getAllParsedValues(t));t._cache.$bar=$D(n.sort((r,i)=>r-i))}return t._cache.$bar}function Gme(t){const e=t.iScale,s=Wme(e,t.type);let n=e._length,r,i,o,l;const c=()=>{o===32767||o===-32768||(fh(l)&&(n=Math.min(n,Math.abs(o-l)||n)),l=o)};for(r=0,i=s.length;r<i;++r)o=e.getPixelForValue(s[r]),c();for(l=void 0,r=0,i=e.ticks.length;r<i;++r)o=e.getPixelForTick(r),c();return n}function Hme(t,e,s,n){const r=s.barThickness;let i,o;return Wt(r)?(i=e.min*s.categoryPercentage,o=s.barPercentage):(i=r*n,o=1),{chunk:i/n,ratio:o,start:e.pixels[t]-i/2}}function qme(t,e,s,n){const r=e.pixels,i=r[t];let o=t>0?r[t-1]:null,l=t<r.length-1?r[t+1]:null;const c=s.categoryPercentage;o===null&&(o=i-(l===null?e.end-e.start:l-i)),l===null&&(l=i+i-o);const d=i-(i-Math.min(o,l))/2*c;return{chunk:Math.abs(l-o)/2*c/n,ratio:s.barPercentage,start:d}}function Kme(t,e,s,n){const r=s.parse(t[0],n),i=s.parse(t[1],n),o=Math.min(r,i),l=Math.max(r,i);let c=o,d=l;Math.abs(o)>Math.abs(l)&&(c=l,d=o),e[s.axis]=d,e._custom={barStart:c,barEnd:d,start:r,end:i,min:o,max:l}}function p_(t,e,s,n){return Ls(t)?Kme(t,e,s,n):e[s.axis]=s.parse(t,n),e}function f_(t,e,s,n){const r=t.iScale,i=t.vScale,o=r.getLabels(),l=r===i,c=[];let d,u,h,p;for(d=s,u=s+n;d<u;++d)p=e[d],h={},h[r.axis]=l||r.parse(o[d],d),c.push(p_(p,h,i,d));return c}function Av(t){return t&&t.barStart!==void 0&&t.barEnd!==void 0}function Xme(t,e,s){return t!==0?ji(t):(e.isHorizontal()?1:-1)*(e.min>=s?1:-1)}function Yme(t){let e,s,n,r,i;return t.horizontal?(e=t.base>t.x,s="left",n="right"):(e=t.base<t.y,s="bottom",n="top"),e?(r="end",i="start"):(r="start",i="end"),{start:s,end:n,reverse:e,top:r,bottom:i}}function Zme(t,e,s,n){let r=e.borderSkipped;const i={};if(!r){t.borderSkipped=i;return}if(r===!0){t.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:o,end:l,reverse:c,top:d,bottom:u}=Yme(t);r==="middle"&&s&&(t.enableBorderRadius=!0,(s._top||0)===n?r=d:(s._bottom||0)===n?r=u:(i[m_(u,o,l,c)]=!0,r=d)),i[m_(r,o,l,c)]=!0,t.borderSkipped=i}function m_(t,e,s,n){return n?(t=Jme(t,e,s),t=g_(t,s,e)):t=g_(t,e,s),t}function Jme(t,e,s){return t===e?s:t===s?e:t}function g_(t,e,s){return t==="start"?e:t==="end"?s:t}function Qme(t,{inflateAmount:e},s){t.inflateAmount=e==="auto"?s===1?.33:0:e}class ege extends Tv{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(e,s,n,r){return f_(e,s,n,r)}parseArrayData(e,s,n,r){return f_(e,s,n,r)}parseObjectData(e,s,n,r){const{iScale:i,vScale:o}=e,{xAxisKey:l="x",yAxisKey:c="y"}=this._parsing,d=i.axis==="x"?l:c,u=o.axis==="x"?l:c,h=[];let p,f,m,b;for(p=n,f=n+r;p<f;++p)b=s[p],m={},m[i.axis]=i.parse(Ac(b,d),p),h.push(p_(Ac(b,u),m,o,p));return h}updateRangeFromParsed(e,s,n,r){super.updateRangeFromParsed(e,s,n,r);const i=n._custom;i&&s===this._cachedMeta.vScale&&(e.min=Math.min(e.min,i.min),e.max=Math.max(e.max,i.max))}getMaxOverflow(){return 0}getLabelAndValue(e){const s=this._cachedMeta,{iScale:n,vScale:r}=s,i=this.getParsed(e),o=i._custom,l=Av(o)?"["+o.start+", "+o.end+"]":""+r.getLabelForValue(i[r.axis]);return{label:""+n.getLabelForValue(i[n.axis]),value:l}}initialize(){this.enableOptionSharing=!0,super.initialize();const e=this._cachedMeta;e.stack=this.getDataset().stack}update(e){const s=this._cachedMeta;this.updateElements(s.data,0,s.data.length,e)}updateElements(e,s,n,r){const i=r==="reset",{index:o,_cachedMeta:{vScale:l}}=this,c=l.getBasePixel(),d=l.isHorizontal(),u=this._getRuler(),{sharedOptions:h,includeOptions:p}=this._getSharedOptions(s,r);for(let f=s;f<s+n;f++){const m=this.getParsed(f),b=i||Wt(m[l.axis])?{base:c,head:c}:this._calculateBarValuePixels(f),g=this._calculateBarIndexPixels(f,u),x=(m._stacks||{})[l.axis],y={horizontal:d,base:b.base,enableBorderRadius:!x||Av(m._custom)||o===x._top||o===x._bottom,x:d?b.head:g.center,y:d?g.center:b.head,height:d?g.size:Math.abs(b.size),width:d?Math.abs(b.size):g.size};p&&(y.options=h||this.resolveDataElementOptions(f,e[f].active?"active":r));const w=y.options||e[f].options;Zme(y,w,x,o),Qme(y,w,u.ratio),this.updateElement(e[f],f,y,r)}}_getStacks(e,s){const{iScale:n}=this._cachedMeta,r=n.getMatchingVisibleMetas(this._type).filter(u=>u.controller.options.grouped),i=n.options.stacked,o=[],l=this._cachedMeta.controller.getParsed(s),c=l&&l[n.axis],d=u=>{const h=u._parsed.find(f=>f[n.axis]===c),p=h&&h[u.vScale.axis];if(Wt(p)||isNaN(p))return!0};for(const u of r)if(!(s!==void 0&&d(u))&&((i===!1||o.indexOf(u.stack)===-1||i===void 0&&u.stack===void 0)&&o.push(u.stack),u.index===e))break;return o.length||o.push(void 0),o}_getStackCount(e){return this._getStacks(void 0,e).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const e=this.chart.scales,s=this.chart.options.indexAxis;return Object.keys(e).filter(n=>e[n].axis===s).shift()}_getAxis(){const e={},s=this.getFirstScaleIdForIndexAxis();for(const n of this.chart.data.datasets)e[It(this.chart.options.indexAxis==="x"?n.xAxisID:n.yAxisID,s)]=!0;return Object.keys(e)}_getStackIndex(e,s,n){const r=this._getStacks(e,n),i=s!==void 0?r.indexOf(s):-1;return i===-1?r.length-1:i}_getRuler(){const e=this.options,s=this._cachedMeta,n=s.iScale,r=[];let i,o;for(i=0,o=s.data.length;i<o;++i)r.push(n.getPixelForValue(this.getParsed(i)[n.axis],i));const l=e.barThickness;return{min:l||Gme(s),pixels:r,start:n._startPixel,end:n._endPixel,stackCount:this._getStackCount(),scale:n,grouped:e.grouped,ratio:l?1:e.categoryPercentage*e.barPercentage}}_calculateBarValuePixels(e){const{_cachedMeta:{vScale:s,_stacked:n,index:r},options:{base:i,minBarLength:o}}=this,l=i||0,c=this.getParsed(e),d=c._custom,u=Av(d);let h=c[s.axis],p=0,f=n?this.applyStack(s,c,n):h,m,b;f!==h&&(p=f-h,f=h),u&&(h=d.barStart,f=d.barEnd-d.barStart,h!==0&&ji(h)!==ji(d.barEnd)&&(p=0),p+=h);const g=!Wt(i)&&!u?i:p;let x=s.getPixelForValue(g);if(this.chart.getDataVisibility(e)?m=s.getPixelForValue(p+f):m=x,b=m-x,Math.abs(b)<o){b=Xme(b,s,l)*o,h===l&&(x-=b/2);const y=s.getPixelForDecimal(0),w=s.getPixelForDecimal(1),v=Math.min(y,w),N=Math.max(y,w);x=Math.max(Math.min(x,N),v),m=x+b,n&&!u&&(c._stacks[s.axis]._visualValues[r]=s.getValueForPixel(m)-s.getValueForPixel(x))}if(x===s.getPixelForValue(l)){const y=ji(b)*s.getLineWidthForValue(l)/2;x+=y,b-=y}return{size:b,base:x,head:m,center:m+b/2}}_calculateBarIndexPixels(e,s){const n=s.scale,r=this.options,i=r.skipNull,o=It(r.maxBarThickness,1/0);let l,c;const d=this._getAxisCount();if(s.grouped){const u=i?this._getStackCount(e):s.stackCount,h=r.barThickness==="flex"?qme(e,s,r,u*d):Hme(e,s,r,u*d),p=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,f=this._getAxis().indexOf(It(p,this.getFirstScaleIdForIndexAxis())),m=this._getStackIndex(this.index,this._cachedMeta.stack,i?e:void 0)+f;l=h.start+h.chunk*m+h.chunk/2,c=Math.min(o,h.chunk*h.ratio)}else l=n.getPixelForValue(this.getParsed(e)[n.axis],e),c=Math.min(o,s.min*s.ratio);return{base:l-c/2,head:l+c/2,center:l,size:c}}draw(){const e=this._cachedMeta,s=e.vScale,n=e.data,r=n.length;let i=0;for(;i<r;++i)this.getParsed(i)[s.axis]!==null&&!n[i].hidden&&n[i].draw(this._ctx)}}class tge extends Tv{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const s=this._cachedMeta,{dataset:n,data:r=[],_dataset:i}=s,o=this.chart._animationsDisabled;let{start:l,count:c}=jfe(s,r,o);this._drawStart=l,this._drawCount=c,Ife(s)&&(l=0,c=r.length),n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!i._decimated,n.points=r;const d=this.resolveDatasetElementOptions(e);this.options.showLine||(d.borderWidth=0),d.segment=this.options.segment,this.updateElement(n,void 0,{animated:!o,options:d},e),this.updateElements(r,l,c,e)}updateElements(e,s,n,r){const i=r==="reset",{iScale:o,vScale:l,_stacked:c,_dataset:d}=this._cachedMeta,{sharedOptions:u,includeOptions:h}=this._getSharedOptions(s,r),p=o.axis,f=l.axis,{spanGaps:m,segment:b}=this.options,g=gh(m)?m:Number.POSITIVE_INFINITY,x=this.chart._animationsDisabled||i||r==="none",y=s+n,w=e.length;let v=s>0&&this.getParsed(s-1);for(let N=0;N<w;++N){const C=e[N],j=x?C:{};if(N<s||N>=y){j.skip=!0;continue}const I=this.getParsed(N),T=Wt(I[f]),E=j[p]=o.getPixelForValue(I[p],N),$=j[f]=i||T?l.getBasePixel():l.getPixelForValue(c?this.applyStack(l,I,c):I[f],N);j.skip=isNaN(E)||isNaN($)||T,j.stop=N>0&&Math.abs(I[p]-v[p])>g,b&&(j.parsed=I,j.raw=d.data[N]),h&&(j.options=u||this.resolveDataElementOptions(N,C.active?"active":r)),x||this.updateElement(C,N,j,r),v=I}}getMaxOverflow(){const e=this._cachedMeta,s=e.dataset,n=s.options&&s.options.borderWidth||0,r=e.data||[];if(!r.length)return n;const i=r[0].size(this.resolveDataElementOptions(0)),o=r[r.length-1].size(this.resolveDataElementOptions(r.length-1));return Math.max(n,i,o)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}function vl(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Dv{static override(e){Object.assign(Dv.prototype,e)}options;constructor(e){this.options=e||{}}init(){}formats(){return vl()}parse(){return vl()}format(){return vl()}add(){return vl()}diff(){return vl()}startOf(){return vl()}endOf(){return vl()}}var sge={_date:Dv};function nge(t,e,s,n){const{controller:r,data:i,_sorted:o}=t,l=r._cachedMeta.iScale,c=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null;if(l&&e===l.axis&&e!=="r"&&o&&i.length){const d=l._reversePixels?vfe:fl;if(n){if(r._sharedOptions){const u=i[0],h=typeof u.getRange=="function"&&u.getRange(e);if(h){const p=d(i,e,s-h),f=d(i,e,s+h);return{lo:p.lo,hi:f.hi}}}}else{const u=d(i,e,s);if(c){const{vScale:h}=r._cachedMeta,{_parsed:p}=t,f=p.slice(0,u.lo+1).reverse().findIndex(b=>!Wt(b[h.axis]));u.lo-=Math.max(0,f);const m=p.slice(u.hi).findIndex(b=>!Wt(b[h.axis]));u.hi+=Math.max(0,m)}return u}}return{lo:0,hi:i.length-1}}function Nh(t,e,s,n,r){const i=t.getSortedVisibleDatasetMetas(),o=s[e];for(let l=0,c=i.length;l<c;++l){const{index:d,data:u}=i[l],{lo:h,hi:p}=nge(i[l],e,o,r);for(let f=h;f<=p;++f){const m=u[f];m.skip||n(m,d,f)}}}function rge(t){const e=t.indexOf("x")!==-1,s=t.indexOf("y")!==-1;return function(n,r){const i=e?Math.abs(n.x-r.x):0,o=s?Math.abs(n.y-r.y):0;return Math.sqrt(Math.pow(i,2)+Math.pow(o,2))}}function _v(t,e,s,n,r){const i=[];return!r&&!t.isPointInArea(e)||Nh(t,s,e,function(l,c,d){!r&&!yh(l,t.chartArea,0)||l.inRange(e.x,e.y,n)&&i.push({element:l,datasetIndex:c,index:d})},!0),i}function ige(t,e,s,n){let r=[];function i(o,l,c){const{startAngle:d,endAngle:u}=o.getProps(["startAngle","endAngle"],n),{angle:h}=bfe(o,{x:e.x,y:e.y});jD(h,d,u)&&r.push({element:o,datasetIndex:l,index:c})}return Nh(t,s,e,i),r}function oge(t,e,s,n,r,i){let o=[];const l=rge(s);let c=Number.POSITIVE_INFINITY;function d(u,h,p){const f=u.inRange(e.x,e.y,r);if(n&&!f)return;const m=u.getCenterPoint(r);if(!(!!i||t.isPointInArea(m))&&!f)return;const g=l(e,m);g<c?(o=[{element:u,datasetIndex:h,index:p}],c=g):g===c&&o.push({element:u,datasetIndex:h,index:p})}return Nh(t,s,e,d),o}function Rv(t,e,s,n,r,i){return!i&&!t.isPointInArea(e)?[]:s==="r"&&!n?ige(t,e,s,r):oge(t,e,s,n,r,i)}function x_(t,e,s,n,r){const i=[],o=s==="x"?"inXRange":"inYRange";let l=!1;return Nh(t,s,e,(c,d,u)=>{c[o]&&c[o](e[s],r)&&(i.push({element:c,datasetIndex:d,index:u}),l=l||c.inRange(e.x,e.y,r))}),n&&!l?[]:i}var age={evaluateInteractionItems:Nh,modes:{index(t,e,s,n){const r=yl(e,t),i=s.axis||"x",o=s.includeInvisible||!1,l=s.intersect?_v(t,r,i,n,o):Rv(t,r,i,!1,n,o),c=[];return l.length?(t.getSortedVisibleDatasetMetas().forEach(d=>{const u=l[0].index,h=d.data[u];h&&!h.skip&&c.push({element:h,datasetIndex:d.index,index:u})}),c):[]},dataset(t,e,s,n){const r=yl(e,t),i=s.axis||"xy",o=s.includeInvisible||!1;let l=s.intersect?_v(t,r,i,n,o):Rv(t,r,i,!1,n,o);if(l.length>0){const c=l[0].datasetIndex,d=t.getDatasetMeta(c).data;l=[];for(let u=0;u<d.length;++u)l.push({element:d[u],datasetIndex:c,index:u})}return l},point(t,e,s,n){const r=yl(e,t),i=s.axis||"xy",o=s.includeInvisible||!1;return _v(t,r,i,n,o)},nearest(t,e,s,n){const r=yl(e,t),i=s.axis||"xy",o=s.includeInvisible||!1;return Rv(t,r,i,s.intersect,n,o)},x(t,e,s,n){const r=yl(e,t);return x_(t,r,"x",s.intersect,n)},y(t,e,s,n){const r=yl(e,t);return x_(t,r,"y",s.intersect,n)}}};const b_=["left","top","right","bottom"];function kh(t,e){return t.filter(s=>s.pos===e)}function y_(t,e){return t.filter(s=>b_.indexOf(s.pos)===-1&&s.box.axis===e)}function Ch(t,e){return t.sort((s,n)=>{const r=e?n:s,i=e?s:n;return r.weight===i.weight?r.index-i.index:r.weight-i.weight})}function lge(t){const e=[];let s,n,r,i,o,l;for(s=0,n=(t||[]).length;s<n;++s)r=t[s],{position:i,options:{stack:o,stackWeight:l=1}}=r,e.push({index:s,box:r,pos:i,horizontal:r.isHorizontal(),weight:r.weight,stack:o&&i+o,stackWeight:l});return e}function cge(t){const e={};for(const s of t){const{stack:n,pos:r,stackWeight:i}=s;if(!n||!b_.includes(r))continue;const o=e[n]||(e[n]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=i}return e}function dge(t,e){const s=cge(t),{vBoxMaxWidth:n,hBoxMaxHeight:r}=e;let i,o,l;for(i=0,o=t.length;i<o;++i){l=t[i];const{fullSize:c}=l.box,d=s[l.stack],u=d&&l.stackWeight/d.weight;l.horizontal?(l.width=u?u*n:c&&e.availableWidth,l.height=r):(l.width=n,l.height=u?u*r:c&&e.availableHeight)}return s}function uge(t){const e=lge(t),s=Ch(e.filter(d=>d.box.fullSize),!0),n=Ch(kh(e,"left"),!0),r=Ch(kh(e,"right")),i=Ch(kh(e,"top"),!0),o=Ch(kh(e,"bottom")),l=y_(e,"x"),c=y_(e,"y");return{fullSize:s,leftAndTop:n.concat(i),rightAndBottom:r.concat(c).concat(o).concat(l),chartArea:kh(e,"chartArea"),vertical:n.concat(r).concat(c),horizontal:i.concat(o).concat(l)}}function w_(t,e,s,n){return Math.max(t[s],e[s])+Math.max(t[n],e[n])}function v_(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function hge(t,e,s,n){const{pos:r,box:i}=s,o=t.maxPadding;if(!Lt(r)){s.size&&(t[r]-=s.size);const h=n[s.stack]||{size:0,count:1};h.size=Math.max(h.size,s.horizontal?i.height:i.width),s.size=h.size/h.count,t[r]+=s.size}i.getPadding&&v_(o,i.getPadding());const l=Math.max(0,e.outerWidth-w_(o,t,"left","right")),c=Math.max(0,e.outerHeight-w_(o,t,"top","bottom")),d=l!==t.w,u=c!==t.h;return t.w=l,t.h=c,s.horizontal?{same:d,other:u}:{same:u,other:d}}function pge(t){const e=t.maxPadding;function s(n){const r=Math.max(e[n]-t[n],0);return t[n]+=r,r}t.y+=s("top"),t.x+=s("left"),s("right"),s("bottom")}function fge(t,e){const s=e.maxPadding;function n(r){const i={left:0,top:0,right:0,bottom:0};return r.forEach(o=>{i[o]=Math.max(e[o],s[o])}),i}return n(t?["left","right"]:["top","bottom"])}function Sh(t,e,s,n){const r=[];let i,o,l,c,d,u;for(i=0,o=t.length,d=0;i<o;++i){l=t[i],c=l.box,c.update(l.width||e.w,l.height||e.h,fge(l.horizontal,e));const{same:h,other:p}=hge(e,s,l,n);d|=h&&r.length,u=u||p,c.fullSize||r.push(l)}return d&&Sh(r,e,s,n)||u}function $g(t,e,s,n,r){t.top=s,t.left=e,t.right=e+n,t.bottom=s+r,t.width=n,t.height=r}function N_(t,e,s,n){const r=s.padding;let{x:i,y:o}=e;for(const l of t){const c=l.box,d=n[l.stack]||{count:1,placed:0,weight:1},u=l.stackWeight/d.weight||1;if(l.horizontal){const h=e.w*u,p=d.size||c.height;fh(d.start)&&(o=d.start),c.fullSize?$g(c,r.left,o,s.outerWidth-r.right-r.left,p):$g(c,e.left+d.placed,o,h,p),d.start=o,d.placed+=h,o=c.bottom}else{const h=e.h*u,p=d.size||c.width;fh(d.start)&&(i=d.start),c.fullSize?$g(c,i,r.top,p,s.outerHeight-r.bottom-r.top):$g(c,i,e.top+d.placed,p,h),d.start=i,d.placed+=h,i=c.right}}e.x=i,e.y=o}var Sr={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(s){e.draw(s)}}]},t.boxes.push(e)},removeBox(t,e){const s=t.boxes?t.boxes.indexOf(e):-1;s!==-1&&t.boxes.splice(s,1)},configure(t,e,s){e.fullSize=s.fullSize,e.position=s.position,e.weight=s.weight},update(t,e,s,n){if(!t)return;const r=Cr(t.options.layout.padding),i=Math.max(e-r.width,0),o=Math.max(s-r.height,0),l=uge(t.boxes),c=l.vertical,d=l.horizontal;qt(t.boxes,b=>{typeof b.beforeLayout=="function"&&b.beforeLayout()});const u=c.reduce((b,g)=>g.box.options&&g.box.options.display===!1?b:b+1,0)||1,h=Object.freeze({outerWidth:e,outerHeight:s,padding:r,availableWidth:i,availableHeight:o,vBoxMaxWidth:i/2/u,hBoxMaxHeight:o/2}),p=Object.assign({},r);v_(p,Cr(n));const f=Object.assign({maxPadding:p,w:i,h:o,x:r.left,y:r.top},r),m=dge(c.concat(d),h);Sh(l.fullSize,f,h,m),Sh(c,f,h,m),Sh(d,f,h,m)&&Sh(c,f,h,m),pge(f),N_(l.leftAndTop,f,h,m),f.x+=f.w,f.y+=f.h,N_(l.rightAndBottom,f,h,m),t.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},qt(l.chartArea,b=>{const g=b.box;Object.assign(g,t.chartArea),g.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class k_{acquireContext(e,s){}releaseContext(e){return!1}addEventListener(e,s,n){}removeEventListener(e,s,n){}getDevicePixelRatio(){return 1}getMaximumSize(e,s,n,r){return s=Math.max(0,s||e.width),n=n||e.height,{width:s,height:Math.max(0,r?Math.floor(s/r):n)}}isAttached(e){return!0}updateConfig(e){}}class mge extends k_{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const Tg="$chartjs",gge={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},C_=t=>t===null||t==="";function xge(t,e){const s=t.style,n=t.getAttribute("height"),r=t.getAttribute("width");if(t[Tg]={initial:{height:n,width:r,style:{display:s.display,height:s.height,width:s.width}}},s.display=s.display||"block",s.boxSizing=s.boxSizing||"border-box",C_(r)){const i=JD(t,"width");i!==void 0&&(t.width=i)}if(C_(n))if(t.style.height==="")t.height=t.width/(e||2);else{const i=JD(t,"height");i!==void 0&&(t.height=i)}return t}const S_=mme?{passive:!0}:!1;function bge(t,e,s){t&&t.addEventListener(e,s,S_)}function yge(t,e,s){t&&t.canvas&&t.canvas.removeEventListener(e,s,S_)}function wge(t,e){const s=gge[t.type]||t.type,{x:n,y:r}=yl(t,e);return{type:s,chart:e,native:t,x:n!==void 0?n:null,y:r!==void 0?r:null}}function Ag(t,e){for(const s of t)if(s===e||s.contains(e))return!0}function vge(t,e,s){const n=t.canvas,r=new MutationObserver(i=>{let o=!1;for(const l of i)o=o||Ag(l.addedNodes,n),o=o&&!Ag(l.removedNodes,n);o&&s()});return r.observe(document,{childList:!0,subtree:!0}),r}function Nge(t,e,s){const n=t.canvas,r=new MutationObserver(i=>{let o=!1;for(const l of i)o=o||Ag(l.removedNodes,n),o=o&&!Ag(l.addedNodes,n);o&&s()});return r.observe(document,{childList:!0,subtree:!0}),r}const jh=new Map;let j_=0;function I_(){const t=window.devicePixelRatio;t!==j_&&(j_=t,jh.forEach((e,s)=>{s.currentDevicePixelRatio!==t&&e()}))}function kge(t,e){jh.size||window.addEventListener("resize",I_),jh.set(t,e)}function Cge(t){jh.delete(t),jh.size||window.removeEventListener("resize",I_)}function Sge(t,e,s){const n=t.canvas,r=n&&jv(n);if(!r)return;const i=AD((l,c)=>{const d=r.clientWidth;s(l,c),d<r.clientWidth&&s()},window),o=new ResizeObserver(l=>{const c=l[0],d=c.contentRect.width,u=c.contentRect.height;d===0&&u===0||i(d,u)});return o.observe(r),kge(t,i),o}function Pv(t,e,s){s&&s.disconnect(),e==="resize"&&Cge(t)}function jge(t,e,s){const n=t.canvas,r=AD(i=>{t.ctx!==null&&s(wge(i,t))},t);return bge(n,e,r),r}class Ige extends k_{acquireContext(e,s){const n=e&&e.getContext&&e.getContext("2d");return n&&n.canvas===e?(xge(e,s),n):null}releaseContext(e){const s=e.canvas;if(!s[Tg])return!1;const n=s[Tg].initial;["height","width"].forEach(i=>{const o=n[i];Wt(o)?s.removeAttribute(i):s.setAttribute(i,o)});const r=n.style||{};return Object.keys(r).forEach(i=>{s.style[i]=r[i]}),s.width=s.width,delete s[Tg],!0}addEventListener(e,s,n){this.removeEventListener(e,s);const r=e.$proxies||(e.$proxies={}),o={attach:vge,detach:Nge,resize:Sge}[s]||jge;r[s]=o(e,s,n)}removeEventListener(e,s){const n=e.$proxies||(e.$proxies={}),r=n[s];if(!r)return;({attach:Pv,detach:Pv,resize:Pv}[s]||yge)(e,s,r),n[s]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,s,n,r){return fme(e,s,n,r)}isAttached(e){const s=e&&jv(e);return!!(s&&s.isConnected)}}function Ege(t){return!Sv()||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas?mge:Ige}let ea=class{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(e){const{x:s,y:n}=this.getProps(["x","y"],e);return{x:s,y:n}}hasValue(){return gh(this.x)&&gh(this.y)}getProps(e,s){const n=this.$animations;if(!s||!n)return this;const r={};return e.forEach(i=>{r[i]=n[i]&&n[i].active()?n[i]._to:this[i]}),r}};function $ge(t,e){const s=t.options.ticks,n=Tge(t),r=Math.min(s.maxTicksLimit||n,n),i=s.major.enabled?Dge(e):[],o=i.length,l=i[0],c=i[o-1],d=[];if(o>r)return _ge(e,d,i,o/r),d;const u=Age(i,e,r);if(o>0){let h,p;const f=o>1?Math.round((c-l)/(o-1)):null;for(Dg(e,d,u,Wt(f)?0:l-f,l),h=0,p=o-1;h<p;h++)Dg(e,d,u,i[h],i[h+1]);return Dg(e,d,u,c,Wt(f)?e.length:c+f),d}return Dg(e,d,u),d}function Tge(t){const e=t.options.offset,s=t._tickSize(),n=t._length/s+(e?0:1),r=t._maxLength/s;return Math.floor(Math.min(n,r))}function Age(t,e,s){const n=Rge(t),r=e.length/s;if(!n)return Math.max(r,1);const i=pfe(n);for(let o=0,l=i.length-1;o<l;o++){const c=i[o];if(c>r)return c}return Math.max(r,1)}function Dge(t){const e=[];let s,n;for(s=0,n=t.length;s<n;s++)t[s].major&&e.push(s);return e}function _ge(t,e,s,n){let r=0,i=s[0],o;for(n=Math.ceil(n),o=0;o<t.length;o++)o===i&&(e.push(t[o]),r++,i=s[r*n])}function Dg(t,e,s,n,r){const i=It(n,0),o=Math.min(It(r,t.length),t.length);let l=0,c,d,u;for(s=Math.ceil(s),r&&(c=r-n,s=c/Math.floor(c/s)),u=i;u<0;)l++,u=Math.round(i+l*s);for(d=Math.max(i,0);d<o;d++)d===u&&(e.push(t[d]),l++,u=Math.round(i+l*s))}function Rge(t){const e=t.length;let s,n;if(e<2)return!1;for(n=t[0],s=1;s<e;++s)if(t[s]-t[s-1]!==n)return!1;return n}const Pge=t=>t==="left"?"right":t==="right"?"left":t,E_=(t,e,s)=>e==="top"||e==="left"?t[e]+s:t[e]-s,$_=(t,e)=>Math.min(e||t,t);function T_(t,e){const s=[],n=t.length/e,r=t.length;let i=0;for(;i<r;i+=n)s.push(t[Math.floor(i)]);return s}function Fge(t,e,s){const n=t.ticks.length,r=Math.min(e,n-1),i=t._startPixel,o=t._endPixel,l=1e-6;let c=t.getPixelForTick(r),d;if(!(s&&(n===1?d=Math.max(c-i,o-c):e===0?d=(t.getPixelForTick(1)-c)/2:d=(c-t.getPixelForTick(r-1))/2,c+=r<e?d:-d,c<i-l||c>o+l)))return c}function Oge(t,e){qt(t,s=>{const n=s.gc,r=n.length/2;let i;if(r>e){for(i=0;i<r;++i)delete s.data[n[i]];n.splice(0,r)}})}function Ih(t){return t.drawTicks?t.tickLength:0}function A_(t,e){if(!t.display)return 0;const s=fn(t.font,e),n=Cr(t.padding);return(Ls(t.text)?t.text.length:1)*s.lineHeight+n.height}function Mge(t,e){return xl(t,{scale:e,type:"scale"})}function Lge(t,e,s){return xl(t,{tick:s,index:e,type:"tick"})}function zge(t,e,s){let n=fv(t);return(s&&e!=="right"||!s&&e==="right")&&(n=Pge(n)),n}function Bge(t,e,s,n){const{top:r,left:i,bottom:o,right:l,chart:c}=t,{chartArea:d,scales:u}=c;let h=0,p,f,m;const b=o-r,g=l-i;if(t.isHorizontal()){if(f=pn(n,i,l),Lt(s)){const x=Object.keys(s)[0],y=s[x];m=u[x].getPixelForValue(y)+b-e}else s==="center"?m=(d.bottom+d.top)/2+b-e:m=E_(t,s,e);p=l-i}else{if(Lt(s)){const x=Object.keys(s)[0],y=s[x];f=u[x].getPixelForValue(y)-g+e}else s==="center"?f=(d.left+d.right)/2-g+e:f=E_(t,s,e);m=pn(n,o,r),h=s==="left"?-Kr:Kr}return{titleX:f,titleY:m,maxWidth:p,rotation:h}}class Fc extends ea{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,s){return e}getUserBounds(){let{_userMin:e,_userMax:s,_suggestedMin:n,_suggestedMax:r}=this;return e=Ci(e,Number.POSITIVE_INFINITY),s=Ci(s,Number.NEGATIVE_INFINITY),n=Ci(n,Number.POSITIVE_INFINITY),r=Ci(r,Number.NEGATIVE_INFINITY),{min:Ci(e,n),max:Ci(s,r),minDefined:kr(e),maxDefined:kr(s)}}getMinMax(e){let{min:s,max:n,minDefined:r,maxDefined:i}=this.getUserBounds(),o;if(r&&i)return{min:s,max:n};const l=this.getMatchingVisibleMetas();for(let c=0,d=l.length;c<d;++c)o=l[c].controller.getMinMax(this,e),r||(s=Math.min(s,o.min)),i||(n=Math.max(n,o.max));return s=i&&s>n?n:s,n=r&&s>n?s:n,{min:Ci(s,Ci(n,s)),max:Ci(n,Ci(s,n))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){ls(this.options.beforeUpdate,[this])}update(e,s,n){const{beginAtZero:r,grace:i,ticks:o}=this.options,l=o.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=s,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Hfe(this,i,r),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const c=l<this.ticks.length;this._convertTicksToLabels(c?T_(this.ticks,l):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=$ge(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),c&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,s,n;this.isHorizontal()?(s=this.left,n=this.right):(s=this.top,n=this.bottom,e=!e),this._startPixel=s,this._endPixel=n,this._reversePixels=e,this._length=n-s,this._alignToPixels=this.options.alignToPixels}afterUpdate(){ls(this.options.afterUpdate,[this])}beforeSetDimensions(){ls(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){ls(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),ls(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){ls(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const s=this.options.ticks;let n,r,i;for(n=0,r=e.length;n<r;n++)i=e[n],i.label=ls(s.callback,[i.value,n,e],this)}afterTickToLabelConversion(){ls(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){ls(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,s=e.ticks,n=$_(this.ticks.length,e.ticks.maxTicksLimit),r=s.minRotation||0,i=s.maxRotation;let o=r,l,c,d;if(!this._isVisible()||!s.display||r>=i||n<=1||!this.isHorizontal()){this.labelRotation=r;return}const u=this._getLabelSizes(),h=u.widest.width,p=u.highest.height,f=Zn(this.chart.width-h,0,this.maxWidth);l=e.offset?this.maxWidth/n:f/(n-1),h+6>l&&(l=f/(n-(e.offset?.5:1)),c=this.maxHeight-Ih(e.grid)-s.padding-A_(e.title,this.chart.options.font),d=Math.sqrt(h*h+p*p),o=xfe(Math.min(Math.asin(Zn((u.highest.height+6)/l,-1,1)),Math.asin(Zn(c/d,-1,1))-Math.asin(Zn(p/d,-1,1)))),o=Math.max(r,Math.min(i,o))),this.labelRotation=o}afterCalculateLabelRotation(){ls(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){ls(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:s,options:{ticks:n,title:r,grid:i}}=this,o=this._isVisible(),l=this.isHorizontal();if(o){const c=A_(r,s.options.font);if(l?(e.width=this.maxWidth,e.height=Ih(i)+c):(e.height=this.maxHeight,e.width=Ih(i)+c),n.display&&this.ticks.length){const{first:d,last:u,widest:h,highest:p}=this._getLabelSizes(),f=n.padding*2,m=hl(this.labelRotation),b=Math.cos(m),g=Math.sin(m);if(l){const x=n.mirror?0:g*h.width+b*p.height;e.height=Math.min(this.maxHeight,e.height+x+f)}else{const x=n.mirror?0:b*h.width+g*p.height;e.width=Math.min(this.maxWidth,e.width+x+f)}this._calculatePadding(d,u,g,b)}}this._handleMargins(),l?(this.width=this._length=s.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=s.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,s,n,r){const{ticks:{align:i,padding:o},position:l}=this.options,c=this.labelRotation!==0,d=l!=="top"&&this.axis==="x";if(this.isHorizontal()){const u=this.getPixelForTick(0)-this.left,h=this.right-this.getPixelForTick(this.ticks.length-1);let p=0,f=0;c?d?(p=r*e.width,f=n*s.height):(p=n*e.height,f=r*s.width):i==="start"?f=s.width:i==="end"?p=e.width:i!=="inner"&&(p=e.width/2,f=s.width/2),this.paddingLeft=Math.max((p-u+o)*this.width/(this.width-u),0),this.paddingRight=Math.max((f-h+o)*this.width/(this.width-h),0)}else{let u=s.height/2,h=e.height/2;i==="start"?(u=0,h=e.height):i==="end"&&(u=s.height,h=0),this.paddingTop=u+o,this.paddingBottom=h+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){ls(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:s}=this.options;return s==="top"||s==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let s,n;for(s=0,n=e.length;s<n;s++)Wt(e[s].label)&&(e.splice(s,1),n--,s--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const s=this.options.ticks.sampleSize;let n=this.ticks;s<n.length&&(n=T_(n,s)),this._labelSizes=e=this._computeLabelSizes(n,n.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,s,n){const{ctx:r,_longestTextCache:i}=this,o=[],l=[],c=Math.floor(s/$_(s,n));let d=0,u=0,h,p,f,m,b,g,x,y,w,v,N;for(h=0;h<s;h+=c){if(m=e[h].label,b=this._resolveTickFontOptions(h),r.font=g=b.string,x=i[g]=i[g]||{data:{},gc:[]},y=b.lineHeight,w=v=0,!Wt(m)&&!Ls(m))w=LD(r,x.data,x.gc,w,m),v=y;else if(Ls(m))for(p=0,f=m.length;p<f;++p)N=m[p],!Wt(N)&&!Ls(N)&&(w=LD(r,x.data,x.gc,w,N),v+=y);o.push(w),l.push(v),d=Math.max(w,d),u=Math.max(v,u)}Oge(i,s);const C=o.indexOf(d),j=l.indexOf(u),I=T=>({width:o[T]||0,height:l[T]||0});return{first:I(0),last:I(s-1),widest:I(C),highest:I(j),widths:o,heights:l}}getLabelForValue(e){return e}getPixelForValue(e,s){return NaN}getValueForPixel(e){}getPixelForTick(e){const s=this.ticks;return e<0||e>s.length-1?null:this.getPixelForValue(s[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const s=this._startPixel+e*this._length;return wfe(this._alignToPixels?gl(this.chart,s,0):s)}getDecimalForPixel(e){const s=(e-this._startPixel)/this._length;return this._reversePixels?1-s:s}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:s}=this;return e<0&&s<0?s:e>0&&s>0?e:0}getContext(e){const s=this.ticks||[];if(e>=0&&e<s.length){const n=s[e];return n.$context||(n.$context=Lge(this.getContext(),e,n))}return this.$context||(this.$context=Mge(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,s=hl(this.labelRotation),n=Math.abs(Math.cos(s)),r=Math.abs(Math.sin(s)),i=this._getLabelSizes(),o=e.autoSkipPadding||0,l=i?i.widest.width+o:0,c=i?i.highest.height+o:0;return this.isHorizontal()?c*n>l*r?l/n:c/r:c*r<l*n?c/n:l/r}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const s=this.axis,n=this.chart,r=this.options,{grid:i,position:o,border:l}=r,c=i.offset,d=this.isHorizontal(),h=this.ticks.length+(c?1:0),p=Ih(i),f=[],m=l.setContext(this.getContext()),b=m.display?m.width:0,g=b/2,x=function(R){return gl(n,R,b)};let y,w,v,N,C,j,I,T,E,$,D,P;if(o==="top")y=x(this.bottom),j=this.bottom-p,T=y-g,$=x(e.top)+g,P=e.bottom;else if(o==="bottom")y=x(this.top),$=e.top,P=x(e.bottom)-g,j=y+g,T=this.top+p;else if(o==="left")y=x(this.right),C=this.right-p,I=y-g,E=x(e.left)+g,D=e.right;else if(o==="right")y=x(this.left),E=e.left,D=x(e.right)-g,C=y+g,I=this.left+p;else if(s==="x"){if(o==="center")y=x((e.top+e.bottom)/2+.5);else if(Lt(o)){const R=Object.keys(o)[0],X=o[R];y=x(this.chart.scales[R].getPixelForValue(X))}$=e.top,P=e.bottom,j=y+g,T=j+p}else if(s==="y"){if(o==="center")y=x((e.left+e.right)/2);else if(Lt(o)){const R=Object.keys(o)[0],X=o[R];y=x(this.chart.scales[R].getPixelForValue(X))}C=y-g,I=C-p,E=e.left,D=e.right}const _=It(r.ticks.maxTicksLimit,h),O=Math.max(1,Math.ceil(h/_));for(w=0;w<h;w+=O){const R=this.getContext(w),X=i.setContext(R),L=l.setContext(R),K=X.lineWidth,B=X.color,G=L.dash||[],de=L.dashOffset,ae=X.tickWidth,ve=X.tickColor,Ne=X.tickBorderDash||[],le=X.tickBorderDashOffset;v=Fge(this,w,c),v!==void 0&&(N=gl(n,v,K),d?C=I=E=D=N:j=T=$=P=N,f.push({tx1:C,ty1:j,tx2:I,ty2:T,x1:E,y1:$,x2:D,y2:P,width:K,color:B,borderDash:G,borderDashOffset:de,tickWidth:ae,tickColor:ve,tickBorderDash:Ne,tickBorderDashOffset:le}))}return this._ticksLength=h,this._borderValue=y,f}_computeLabelItems(e){const s=this.axis,n=this.options,{position:r,ticks:i}=n,o=this.isHorizontal(),l=this.ticks,{align:c,crossAlign:d,padding:u,mirror:h}=i,p=Ih(n.grid),f=p+u,m=h?-u:f,b=-hl(this.labelRotation),g=[];let x,y,w,v,N,C,j,I,T,E,$,D,P="middle";if(r==="top")C=this.bottom-m,j=this._getXAxisLabelAlignment();else if(r==="bottom")C=this.top+m,j=this._getXAxisLabelAlignment();else if(r==="left"){const O=this._getYAxisLabelAlignment(p);j=O.textAlign,N=O.x}else if(r==="right"){const O=this._getYAxisLabelAlignment(p);j=O.textAlign,N=O.x}else if(s==="x"){if(r==="center")C=(e.top+e.bottom)/2+f;else if(Lt(r)){const O=Object.keys(r)[0],R=r[O];C=this.chart.scales[O].getPixelForValue(R)+f}j=this._getXAxisLabelAlignment()}else if(s==="y"){if(r==="center")N=(e.left+e.right)/2-f;else if(Lt(r)){const O=Object.keys(r)[0],R=r[O];N=this.chart.scales[O].getPixelForValue(R)}j=this._getYAxisLabelAlignment(p).textAlign}s==="y"&&(c==="start"?P="top":c==="end"&&(P="bottom"));const _=this._getLabelSizes();for(x=0,y=l.length;x<y;++x){w=l[x],v=w.label;const O=i.setContext(this.getContext(x));I=this.getPixelForTick(x)+i.labelOffset,T=this._resolveTickFontOptions(x),E=T.lineHeight,$=Ls(v)?v.length:1;const R=$/2,X=O.color,L=O.textStrokeColor,K=O.textStrokeWidth;let B=j;o?(N=I,j==="inner"&&(x===y-1?B=this.options.reverse?"left":"right":x===0?B=this.options.reverse?"right":"left":B="center"),r==="top"?d==="near"||b!==0?D=-$*E+E/2:d==="center"?D=-_.highest.height/2-R*E+E:D=-_.highest.height+E/2:d==="near"||b!==0?D=E/2:d==="center"?D=_.highest.height/2-R*E:D=_.highest.height-$*E,h&&(D*=-1),b!==0&&!O.showLabelBackdrop&&(N+=E/2*Math.sin(b))):(C=I,D=(1-$)*E/2);let G;if(O.showLabelBackdrop){const de=Cr(O.backdropPadding),ae=_.heights[x],ve=_.widths[x];let Ne=D-de.top,le=0-de.left;switch(P){case"middle":Ne-=ae/2;break;case"bottom":Ne-=ae;break}switch(j){case"center":le-=ve/2;break;case"right":le-=ve;break;case"inner":x===y-1?le-=ve:x>0&&(le-=ve/2);break}G={left:le,top:Ne,width:ve+de.width,height:ae+de.height,color:O.backdropColor}}g.push({label:v,font:T,textOffset:D,options:{rotation:b,color:X,strokeColor:L,strokeWidth:K,textAlign:B,textBaseline:P,translation:[N,C],backdrop:G}})}return g}_getXAxisLabelAlignment(){const{position:e,ticks:s}=this.options;if(-hl(this.labelRotation))return e==="top"?"left":"right";let r="center";return s.align==="start"?r="left":s.align==="end"?r="right":s.align==="inner"&&(r="inner"),r}_getYAxisLabelAlignment(e){const{position:s,ticks:{crossAlign:n,mirror:r,padding:i}}=this.options,o=this._getLabelSizes(),l=e+i,c=o.widest.width;let d,u;return s==="left"?r?(u=this.right+i,n==="near"?d="left":n==="center"?(d="center",u+=c/2):(d="right",u+=c)):(u=this.right-l,n==="near"?d="right":n==="center"?(d="center",u-=c/2):(d="left",u=this.left)):s==="right"?r?(u=this.left+i,n==="near"?d="right":n==="center"?(d="center",u-=c/2):(d="left",u-=c)):(u=this.left+l,n==="near"?d="left":n==="center"?(d="center",u+=c/2):(d="right",u=this.right)):d="right",{textAlign:d,x:u}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,s=this.options.position;if(s==="left"||s==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(s==="top"||s==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:s},left:n,top:r,width:i,height:o}=this;s&&(e.save(),e.fillStyle=s,e.fillRect(n,r,i,o),e.restore())}getLineWidthForValue(e){const s=this.options.grid;if(!this._isVisible()||!s.display)return 0;const r=this.ticks.findIndex(i=>i.value===e);return r>=0?s.setContext(this.getContext(r)).lineWidth:0}drawGrid(e){const s=this.options.grid,n=this.ctx,r=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let i,o;const l=(c,d,u)=>{!u.width||!u.color||(n.save(),n.lineWidth=u.width,n.strokeStyle=u.color,n.setLineDash(u.borderDash||[]),n.lineDashOffset=u.borderDashOffset,n.beginPath(),n.moveTo(c.x,c.y),n.lineTo(d.x,d.y),n.stroke(),n.restore())};if(s.display)for(i=0,o=r.length;i<o;++i){const c=r[i];s.drawOnChartArea&&l({x:c.x1,y:c.y1},{x:c.x2,y:c.y2},c),s.drawTicks&&l({x:c.tx1,y:c.ty1},{x:c.tx2,y:c.ty2},{color:c.tickColor,width:c.tickWidth,borderDash:c.tickBorderDash,borderDashOffset:c.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:s,options:{border:n,grid:r}}=this,i=n.setContext(this.getContext()),o=n.display?i.width:0;if(!o)return;const l=r.setContext(this.getContext(0)).lineWidth,c=this._borderValue;let d,u,h,p;this.isHorizontal()?(d=gl(e,this.left,o)-o/2,u=gl(e,this.right,l)+l/2,h=p=c):(h=gl(e,this.top,o)-o/2,p=gl(e,this.bottom,l)+l/2,d=u=c),s.save(),s.lineWidth=i.width,s.strokeStyle=i.color,s.beginPath(),s.moveTo(d,h),s.lineTo(u,p),s.stroke(),s.restore()}drawLabels(e){if(!this.options.ticks.display)return;const n=this.ctx,r=this._computeLabelArea();r&&wv(n,r);const i=this.getLabelItems(e);for(const o of i){const l=o.options,c=o.font,d=o.label,u=o.textOffset;wh(n,d,0,u,c,l)}r&&vv(n)}drawTitle(){const{ctx:e,options:{position:s,title:n,reverse:r}}=this;if(!n.display)return;const i=fn(n.font),o=Cr(n.padding),l=n.align;let c=i.lineHeight/2;s==="bottom"||s==="center"||Lt(s)?(c+=o.bottom,Ls(n.text)&&(c+=i.lineHeight*(n.text.length-1))):c+=o.top;const{titleX:d,titleY:u,maxWidth:h,rotation:p}=Bge(this,c,s,l);wh(e,n.text,0,0,i,{color:n.color,maxWidth:h,rotation:p,textAlign:zge(l,s,r),textBaseline:"middle",translation:[d,u]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,s=e.ticks&&e.ticks.z||0,n=It(e.grid&&e.grid.z,-1),r=It(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==Fc.prototype.draw?[{z:s,draw:i=>{this.draw(i)}}]:[{z:n,draw:i=>{this.drawBackground(),this.drawGrid(i),this.drawTitle()}},{z:r,draw:()=>{this.drawBorder()}},{z:s,draw:i=>{this.drawLabels(i)}}]}getMatchingVisibleMetas(e){const s=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",r=[];let i,o;for(i=0,o=s.length;i<o;++i){const l=s[i];l[n]===this.id&&(!e||l.type===e)&&r.push(l)}return r}_resolveTickFontOptions(e){const s=this.options.ticks.setContext(this.getContext(e));return fn(s.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class _g{constructor(e,s,n){this.type=e,this.scope=s,this.override=n,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const s=Object.getPrototypeOf(e);let n;Wge(s)&&(n=this.register(s));const r=this.items,i=e.id,o=this.scope+"."+i;if(!i)throw new Error("class does not have id: "+e);return i in r||(r[i]=e,Uge(e,o,n),this.override&&Ss.override(e.id,e.overrides)),o}get(e){return this.items[e]}unregister(e){const s=this.items,n=e.id,r=this.scope;n in s&&delete s[n],r&&n in Ss[r]&&(delete Ss[r][n],this.override&&delete ml[n])}}function Uge(t,e,s){const n=hh(Object.create(null),[s?Ss.get(s):{},Ss.get(e),t.defaults]);Ss.set(e,n),t.defaultRoutes&&Vge(e,t.defaultRoutes),t.descriptors&&Ss.describe(e,t.descriptors)}function Vge(t,e){Object.keys(e).forEach(s=>{const n=s.split("."),r=n.pop(),i=[t].concat(n).join("."),o=e[s].split("."),l=o.pop(),c=o.join(".");Ss.route(i,r,c,l)})}function Wge(t){return"id"in t&&"defaults"in t}class Gge{constructor(){this.controllers=new _g(Tv,"datasets",!0),this.elements=new _g(ea,"elements"),this.plugins=new _g(Object,"plugins"),this.scales=new _g(Fc,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,s,n){[...s].forEach(r=>{const i=n||this._getRegistryForType(r);n||i.isForType(r)||i===this.plugins&&r.id?this._exec(e,i,r):qt(r,o=>{const l=n||this._getRegistryForType(o);this._exec(e,l,o)})})}_exec(e,s,n){const r=dv(e);ls(n["before"+r],[],n),s[e](n),ls(n["after"+r],[],n)}_getRegistryForType(e){for(let s=0;s<this._typedRegistries.length;s++){const n=this._typedRegistries[s];if(n.isForType(e))return n}return this.plugins}_get(e,s,n){const r=s.get(e);if(r===void 0)throw new Error('"'+e+'" is not a registered '+n+".");return r}}var Ii=new Gge;class Hge{constructor(){this._init=void 0}notify(e,s,n,r){if(s==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install")),this._init===void 0)return;const i=r?this._descriptors(e).filter(r):this._descriptors(e),o=this._notify(i,e,s,n);return s==="afterDestroy"&&(this._notify(i,e,"stop"),this._notify(this._init,e,"uninstall"),this._init=void 0),o}_notify(e,s,n,r){r=r||{};for(const i of e){const o=i.plugin,l=o[n],c=[s,r,i.options];if(ls(l,c,o)===!1&&r.cancelable)return!1}return!0}invalidate(){Wt(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const s=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),s}_createDescriptors(e,s){const n=e&&e.config,r=It(n.options&&n.options.plugins,{}),i=qge(n);return r===!1&&!s?[]:Xge(e,i,r,s)}_notifyStateChanges(e){const s=this._oldCache||[],n=this._cache,r=(i,o)=>i.filter(l=>!o.some(c=>l.plugin.id===c.plugin.id));this._notify(r(s,n),e,"stop"),this._notify(r(n,s),e,"start")}}function qge(t){const e={},s=[],n=Object.keys(Ii.plugins.items);for(let i=0;i<n.length;i++)s.push(Ii.getPlugin(n[i]));const r=t.plugins||[];for(let i=0;i<r.length;i++){const o=r[i];s.indexOf(o)===-1&&(s.push(o),e[o.id]=!0)}return{plugins:s,localIds:e}}function Kge(t,e){return!e&&t===!1?null:t===!0?{}:t}function Xge(t,{plugins:e,localIds:s},n,r){const i=[],o=t.getContext();for(const l of e){const c=l.id,d=Kge(n[c],r);d!==null&&i.push({plugin:l,options:Yge(t.config,{plugin:l,local:s[c]},d,o)})}return i}function Yge(t,{plugin:e,local:s},n,r){const i=t.pluginScopeKeys(e),o=t.getOptionScopes(n,i);return s&&e.defaults&&o.push(e.defaults),t.createResolver(o,r,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Fv(t,e){const s=Ss.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||s.indexAxis||"x"}function Zge(t,e){let s=t;return t==="_index_"?s=e:t==="_value_"&&(s=e==="x"?"y":"x"),s}function Jge(t,e){return t===e?"_index_":"_value_"}function D_(t){if(t==="x"||t==="y"||t==="r")return t}function Qge(t){if(t==="top"||t==="bottom")return"x";if(t==="left"||t==="right")return"y"}function Ov(t,...e){if(D_(t))return t;for(const s of e){const n=s.axis||Qge(s.position)||t.length>1&&D_(t[0].toLowerCase());if(n)return n}throw new Error(`Cannot determine type of '${t}' axis. Please provide 'axis' or 'position' option.`)}function __(t,e,s){if(s[e+"AxisID"]===t)return{axis:e}}function exe(t,e){if(e.data&&e.data.datasets){const s=e.data.datasets.filter(n=>n.xAxisID===t||n.yAxisID===t);if(s.length)return __(t,"x",s[0])||__(t,"y",s[0])}return{}}function txe(t,e){const s=ml[t.type]||{scales:{}},n=e.scales||{},r=Fv(t.type,e),i=Object.create(null);return Object.keys(n).forEach(o=>{const l=n[o];if(!Lt(l))return console.error(`Invalid scale configuration for scale: ${o}`);if(l._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${o}`);const c=Ov(o,l,exe(o,t),Ss.scales[l.type]),d=Jge(c,r),u=s.scales||{};i[o]=ph(Object.create(null),[{axis:c},l,u[c],u[d]])}),t.data.datasets.forEach(o=>{const l=o.type||t.type,c=o.indexAxis||Fv(l,e),u=(ml[l]||{}).scales||{};Object.keys(u).forEach(h=>{const p=Zge(h,c),f=o[p+"AxisID"]||p;i[f]=i[f]||Object.create(null),ph(i[f],[{axis:p},n[f],u[h]])})}),Object.keys(i).forEach(o=>{const l=i[o];ph(l,[Ss.scales[l.type],Ss.scale])}),i}function R_(t){const e=t.options||(t.options={});e.plugins=It(e.plugins,{}),e.scales=txe(t,e)}function P_(t){return t=t||{},t.datasets=t.datasets||[],t.labels=t.labels||[],t}function sxe(t){return t=t||{},t.data=P_(t.data),R_(t),t}const F_=new Map,O_=new Set;function Rg(t,e){let s=F_.get(t);return s||(s=e(),F_.set(t,s),O_.add(s)),s}const Eh=(t,e,s)=>{const n=Ac(e,s);n!==void 0&&t.add(n)};class nxe{constructor(e){this._config=sxe(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=P_(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),R_(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return Rg(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,s){return Rg(`${e}.transition.${s}`,()=>[[`datasets.${e}.transitions.${s}`,`transitions.${s}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,s){return Rg(`${e}-${s}`,()=>[[`datasets.${e}.elements.${s}`,`datasets.${e}`,`elements.${s}`,""]])}pluginScopeKeys(e){const s=e.id,n=this.type;return Rg(`${n}-plugin-${s}`,()=>[[`plugins.${s}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,s){const n=this._scopeCache;let r=n.get(e);return(!r||s)&&(r=new Map,n.set(e,r)),r}getOptionScopes(e,s,n){const{options:r,type:i}=this,o=this._cachedScopes(e,n),l=o.get(s);if(l)return l;const c=new Set;s.forEach(u=>{e&&(c.add(e),u.forEach(h=>Eh(c,e,h))),u.forEach(h=>Eh(c,r,h)),u.forEach(h=>Eh(c,ml[i]||{},h)),u.forEach(h=>Eh(c,Ss,h)),u.forEach(h=>Eh(c,xv,h))});const d=Array.from(c);return d.length===0&&d.push(Object.create(null)),O_.has(s)&&o.set(s,d),d}chartOptionScopes(){const{options:e,type:s}=this;return[e,ml[s]||{},Ss.datasets[s]||{},{type:s},Ss,xv]}resolveNamedOptions(e,s,n,r=[""]){const i={$shared:!0},{resolver:o,subPrefixes:l}=M_(this._resolverCache,e,r);let c=o;if(ixe(o,s)){i.$shared=!1,n=Zo(n)?n():n;const d=this.createResolver(e,n,l);c=_c(o,n,d)}for(const d of s)i[d]=c[d];return i}createResolver(e,s,n=[""],r){const{resolver:i}=M_(this._resolverCache,e,n);return Lt(s)?_c(i,s,void 0,r):i}}function M_(t,e,s){let n=t.get(e);n||(n=new Map,t.set(e,n));const r=s.join();let i=n.get(r);return i||(i={resolver:Nv(e,s),subPrefixes:s.filter(l=>!l.toLowerCase().includes("hover"))},n.set(r,i)),i}const rxe=t=>Lt(t)&&Object.getOwnPropertyNames(t).some(e=>Zo(t[e]));function ixe(t,e){const{isScriptable:s,isIndexable:n}=WD(t);for(const r of e){const i=s(r),o=n(r),l=(o||i)&&t[r];if(i&&(Zo(l)||rxe(l))||o&&Ls(l))return!0}return!1}var oxe="4.5.1";const axe=["top","bottom","left","right","chartArea"];function L_(t,e){return t==="top"||t==="bottom"||axe.indexOf(t)===-1&&e==="x"}function z_(t,e){return function(s,n){return s[t]===n[t]?s[e]-n[e]:s[t]-n[t]}}function B_(t){const e=t.chart,s=e.options.animation;e.notifyPlugins("afterRender"),ls(s&&s.onComplete,[t],e)}function lxe(t){const e=t.chart,s=e.options.animation;ls(s&&s.onProgress,[t],e)}function U_(t){return Sv()&&typeof t=="string"?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const Pg={},V_=t=>{const e=U_(t);return Object.values(Pg).filter(s=>s.canvas===e).pop()};function cxe(t,e,s){const n=Object.keys(t);for(const r of n){const i=+r;if(i>=e){const o=t[r];delete t[r],(s>0||i>e)&&(t[i+s]=o)}}}function dxe(t,e,s,n){return!s||t.type==="mouseout"?null:n?e:t}let $h=class{static defaults=Ss;static instances=Pg;static overrides=ml;static registry=Ii;static version=oxe;static getChart=V_;static register(...e){Ii.add(...e),W_()}static unregister(...e){Ii.remove(...e),W_()}constructor(e,s){const n=this.config=new nxe(s),r=U_(e),i=V_(r);if(i)throw new Error("Canvas is already in use. Chart with ID '"+i.id+"' must be destroyed before the canvas with ID '"+i.canvas.id+"' can be reused.");const o=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||Ege(r)),this.platform.updateConfig(n);const l=this.platform.acquireContext(r,o.aspectRatio),c=l&&l.canvas,d=c&&c.height,u=c&&c.width;if(this.id=rfe(),this.ctx=l,this.canvas=c,this.width=u,this.height=d,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Hge,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=Cfe(h=>this.update(h),o.resizeDelay||0),this._dataChanges=[],Pg[this.id]=this,!l||!c){console.error("Failed to create chart: can't acquire context from the given item");return}lo.listen(this,"complete",B_),lo.listen(this,"progress",lxe),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:s},width:n,height:r,_aspectRatio:i}=this;return Wt(e)?s&&i?i:r?n/r:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return Ii}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():ZD(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return zD(this.canvas,this.ctx),this}stop(){return lo.stop(this),this}resize(e,s){lo.running(this)?this._resizeBeforeDraw={width:e,height:s}:this._resize(e,s)}_resize(e,s){const n=this.options,r=this.canvas,i=n.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(r,e,s,i),l=n.devicePixelRatio||this.platform.getDevicePixelRatio(),c=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,ZD(this,l,!0)&&(this.notifyPlugins("resize",{size:o}),ls(n.onResize,[this,o],this),this.attached&&this._doResize(c)&&this.render())}ensureScalesHaveIDs(){const s=this.options.scales||{};qt(s,(n,r)=>{n.id=r})}buildOrUpdateScales(){const e=this.options,s=e.scales,n=this.scales,r=Object.keys(n).reduce((o,l)=>(o[l]=!1,o),{});let i=[];s&&(i=i.concat(Object.keys(s).map(o=>{const l=s[o],c=Ov(o,l),d=c==="r",u=c==="x";return{options:l,dposition:d?"chartArea":u?"bottom":"left",dtype:d?"radialLinear":u?"category":"linear"}}))),qt(i,o=>{const l=o.options,c=l.id,d=Ov(c,l),u=It(l.type,o.dtype);(l.position===void 0||L_(l.position,d)!==L_(o.dposition))&&(l.position=o.dposition),r[c]=!0;let h=null;if(c in n&&n[c].type===u)h=n[c];else{const p=Ii.getScale(u);h=new p({id:c,type:u,ctx:this.ctx,chart:this}),n[h.id]=h}h.init(l,e)}),qt(r,(o,l)=>{o||delete n[l]}),qt(n,o=>{Sr.configure(this,o,o.options),Sr.addBox(this,o)})}_updateMetasets(){const e=this._metasets,s=this.data.datasets.length,n=e.length;if(e.sort((r,i)=>r.index-i.index),n>s){for(let r=s;r<n;++r)this._destroyDatasetMeta(r);e.splice(s,n-s)}this._sortedMetasets=e.slice(0).sort(z_("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:s}}=this;e.length>s.length&&delete this._stacks,e.forEach((n,r)=>{s.filter(i=>i===n._dataset).length===0&&this._destroyDatasetMeta(r)})}buildOrUpdateControllers(){const e=[],s=this.data.datasets;let n,r;for(this._removeUnreferencedMetasets(),n=0,r=s.length;n<r;n++){const i=s[n];let o=this.getDatasetMeta(n);const l=i.type||this.config.type;if(o.type&&o.type!==l&&(this._destroyDatasetMeta(n),o=this.getDatasetMeta(n)),o.type=l,o.indexAxis=i.indexAxis||Fv(l,this.options),o.order=i.order||0,o.index=n,o.label=""+i.label,o.visible=this.isDatasetVisible(n),o.controller)o.controller.updateIndex(n),o.controller.linkScales();else{const c=Ii.getController(l),{datasetElementType:d,dataElementType:u}=Ss.datasets[l];Object.assign(c,{dataElementType:Ii.getElement(u),datasetElementType:d&&Ii.getElement(d)}),o.controller=new c(this,n),e.push(o.controller)}}return this._updateMetasets(),e}_resetElements(){qt(this.data.datasets,(e,s)=>{this.getDatasetMeta(s).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const s=this.config;s.update();const n=this._options=s.createResolver(s.chartOptionScopes(),this.getContext()),r=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const i=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let d=0,u=this.data.datasets.length;d<u;d++){const{controller:h}=this.getDatasetMeta(d),p=!r&&i.indexOf(h)===-1;h.buildOrUpdateElements(p),o=Math.max(+h.getMaxOverflow(),o)}o=this._minPadding=n.layout.autoPadding?o:0,this._updateLayout(o),r||qt(i,d=>{d.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(z_("z","_idx"));const{_active:l,_lastEvent:c}=this;c?this._eventHandler(c,!0):l.length&&this._updateHoverStyles(l,l,!0),this.render()}_updateScales(){qt(this.scales,e=>{Sr.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,s=new Set(Object.keys(this._listeners)),n=new Set(e.events);(!ND(s,n)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,s=this._getUniformDataChanges()||[];for(const{method:n,start:r,count:i}of s){const o=n==="_removeElements"?-i:i;cxe(e,r,o)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const s=this.data.datasets.length,n=i=>new Set(e.filter(o=>o[0]===i).map((o,l)=>l+","+o.splice(1).join(","))),r=n(0);for(let i=1;i<s;i++)if(!ND(r,n(i)))return;return Array.from(r).map(i=>i.split(",")).map(i=>({method:i[1],start:+i[2],count:+i[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Sr.update(this,this.width,this.height,e);const s=this.chartArea,n=s.width<=0||s.height<=0;this._layers=[],qt(this.boxes,r=>{n&&r.position==="chartArea"||(r.configure&&r.configure(),this._layers.push(...r._layers()))},this),this._layers.forEach((r,i)=>{r._idx=i}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let s=0,n=this.data.datasets.length;s<n;++s)this.getDatasetMeta(s).controller.configure();for(let s=0,n=this.data.datasets.length;s<n;++s)this._updateDataset(s,Zo(e)?e({datasetIndex:s}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,s){const n=this.getDatasetMeta(e),r={meta:n,index:e,mode:s,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",r)!==!1&&(n.controller._update(s),r.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",r))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(lo.has(this)?this.attached&&!lo.running(this)&&lo.start(this):(this.draw(),B_({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:n,height:r}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(n,r)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const s=this._layers;for(e=0;e<s.length&&s[e].z<=0;++e)s[e].draw(this.chartArea);for(this._drawDatasets();e<s.length;++e)s[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const s=this._sortedMetasets,n=[];let r,i;for(r=0,i=s.length;r<i;++r){const o=s[r];(!e||o.visible)&&n.push(o)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let s=e.length-1;s>=0;--s)this._drawDataset(e[s]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const s=this.ctx,n={meta:e,index:e.index,cancelable:!0},r=$me(this,e);this.notifyPlugins("beforeDatasetDraw",n)!==!1&&(r&&wv(s,r),e.controller.draw(),r&&vv(s),n.cancelable=!1,this.notifyPlugins("afterDatasetDraw",n))}isPointInArea(e){return yh(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,s,n,r){const i=age.modes[s];return typeof i=="function"?i(this,e,n,r):[]}getDatasetMeta(e){const s=this.data.datasets[e],n=this._metasets;let r=n.filter(i=>i&&i._dataset===s).pop();return r||(r={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:s&&s.order||0,index:e,_dataset:s,_parsed:[],_sorted:!1},n.push(r)),r}getContext(){return this.$context||(this.$context=xl(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const s=this.data.datasets[e];if(!s)return!1;const n=this.getDatasetMeta(e);return typeof n.hidden=="boolean"?!n.hidden:!s.hidden}setDatasetVisibility(e,s){const n=this.getDatasetMeta(e);n.hidden=!s}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,s,n){const r=n?"show":"hide",i=this.getDatasetMeta(e),o=i.controller._resolveAnimations(void 0,r);fh(s)?(i.data[s].hidden=!n,this.update()):(this.setDatasetVisibility(e,n),o.update(i,{visible:n}),this.update(l=>l.datasetIndex===e?r:void 0))}hide(e,s){this._updateVisibility(e,s,!1)}show(e,s){this._updateVisibility(e,s,!0)}_destroyDatasetMeta(e){const s=this._metasets[e];s&&s.controller&&s.controller._destroy(),delete this._metasets[e]}_stop(){let e,s;for(this.stop(),lo.remove(this),e=0,s=this.data.datasets.length;e<s;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:s}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),zD(e,s),this.platform.releaseContext(s),this.canvas=null,this.ctx=null),delete Pg[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,s=this.platform,n=(i,o)=>{s.addEventListener(this,i,o),e[i]=o},r=(i,o,l)=>{i.offsetX=o,i.offsetY=l,this._eventHandler(i)};qt(this.options.events,i=>n(i,r))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,s=this.platform,n=(c,d)=>{s.addEventListener(this,c,d),e[c]=d},r=(c,d)=>{e[c]&&(s.removeEventListener(this,c,d),delete e[c])},i=(c,d)=>{this.canvas&&this.resize(c,d)};let o;const l=()=>{r("attach",l),this.attached=!0,this.resize(),n("resize",i),n("detach",o)};o=()=>{this.attached=!1,r("resize",i),this._stop(),this._resize(0,0),n("attach",l)},s.isAttached(this.canvas)?l():o()}unbindEvents(){qt(this._listeners,(e,s)=>{this.platform.removeEventListener(this,s,e)}),this._listeners={},qt(this._responsiveListeners,(e,s)=>{this.platform.removeEventListener(this,s,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,s,n){const r=n?"set":"remove";let i,o,l,c;for(s==="dataset"&&(i=this.getDatasetMeta(e[0].datasetIndex),i.controller["_"+r+"DatasetHoverStyle"]()),l=0,c=e.length;l<c;++l){o=e[l];const d=o&&this.getDatasetMeta(o.datasetIndex).controller;d&&d[r+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const s=this._active||[],n=e.map(({datasetIndex:i,index:o})=>{const l=this.getDatasetMeta(i);if(!l)throw new Error("No dataset found at index "+i);return{datasetIndex:i,element:l.data[o],index:o}});!yg(n,s)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,s))}notifyPlugins(e,s,n){return this._plugins.notify(this,e,s,n)}isPluginEnabled(e){return this._plugins._cache.filter(s=>s.plugin.id===e).length===1}_updateHoverStyles(e,s,n){const r=this.options.hover,i=(c,d)=>c.filter(u=>!d.some(h=>u.datasetIndex===h.datasetIndex&&u.index===h.index)),o=i(s,e),l=n?e:i(e,s);o.length&&this.updateHoverStyle(o,r.mode,!1),l.length&&r.mode&&this.updateHoverStyle(l,r.mode,!0)}_eventHandler(e,s){const n={event:e,replay:s,cancelable:!0,inChartArea:this.isPointInArea(e)},r=o=>(o.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",n,r)===!1)return;const i=this._handleEvent(e,s,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,r),(i||n.changed)&&this.render(),this}_handleEvent(e,s,n){const{_active:r=[],options:i}=this,o=s,l=this._getActiveElements(e,r,n,o),c=dfe(e),d=dxe(e,this._lastEvent,n,c);n&&(this._lastEvent=null,ls(i.onHover,[e,l,this],this),c&&ls(i.onClick,[e,l,this],this));const u=!yg(l,r);return(u||s)&&(this._active=l,this._updateHoverStyles(l,r,s)),this._lastEvent=d,u}_getActiveElements(e,s,n,r){if(e.type==="mouseout")return[];if(!n)return s;const i=this.options.hover;return this.getElementsAtEventForMode(e,i.mode,i,r)}};function W_(){return qt($h.instances,t=>t._plugins.invalidate())}function G_(t,e,s=e){t.lineCap=It(s.borderCapStyle,e.borderCapStyle),t.setLineDash(It(s.borderDash,e.borderDash)),t.lineDashOffset=It(s.borderDashOffset,e.borderDashOffset),t.lineJoin=It(s.borderJoinStyle,e.borderJoinStyle),t.lineWidth=It(s.borderWidth,e.borderWidth),t.strokeStyle=It(s.borderColor,e.borderColor)}function uxe(t,e,s){t.lineTo(s.x,s.y)}function hxe(t){return t.stepped?Ofe:t.tension||t.cubicInterpolationMode==="monotone"?Mfe:uxe}function H_(t,e,s={}){const n=t.length,{start:r=0,end:i=n-1}=s,{start:o,end:l}=e,c=Math.max(r,o),d=Math.min(i,l),u=r<o&&i<o||r>l&&i>l;return{count:n,start:c,loop:e.loop,ilen:d<c&&!u?n+d-c:d-c}}function pxe(t,e,s,n){const{points:r,options:i}=e,{count:o,start:l,loop:c,ilen:d}=H_(r,s,n),u=hxe(i);let{move:h=!0,reverse:p}=n||{},f,m,b;for(f=0;f<=d;++f)m=r[(l+(p?d-f:f))%o],!m.skip&&(h?(t.moveTo(m.x,m.y),h=!1):u(t,b,m,p,i.stepped),b=m);return c&&(m=r[(l+(p?d:0))%o],u(t,b,m,p,i.stepped)),!!c}function fxe(t,e,s,n){const r=e.points,{count:i,start:o,ilen:l}=H_(r,s,n),{move:c=!0,reverse:d}=n||{};let u=0,h=0,p,f,m,b,g,x;const y=v=>(o+(d?l-v:v))%i,w=()=>{b!==g&&(t.lineTo(u,g),t.lineTo(u,b),t.lineTo(u,x))};for(c&&(f=r[y(0)],t.moveTo(f.x,f.y)),p=0;p<=l;++p){if(f=r[y(p)],f.skip)continue;const v=f.x,N=f.y,C=v|0;C===m?(N<b?b=N:N>g&&(g=N),u=(h*u+v)/++h):(w(),t.lineTo(v,N),m=C,h=0,b=g=N),x=N}w()}function Mv(t){const e=t.options,s=e.borderDash&&e.borderDash.length;return!t._decimated&&!t._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!s?fxe:pxe}function mxe(t){return t.stepped?gme:t.tension||t.cubicInterpolationMode==="monotone"?xme:wl}function gxe(t,e,s,n){let r=e._path;r||(r=e._path=new Path2D,e.path(r,s,n)&&r.closePath()),G_(t,e.options),t.stroke(r)}function xxe(t,e,s,n){const{segments:r,options:i}=e,o=Mv(e);for(const l of r)G_(t,i,l.style),t.beginPath(),o(t,e,l,{start:s,end:s+n-1})&&t.closePath(),t.stroke()}const bxe=typeof Path2D=="function";function yxe(t,e,s,n){bxe&&!e.options.segment?gxe(t,e,s,n):xxe(t,e,s,n)}class wxe extends ea{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"};constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,s){const n=this.options;if((n.tension||n.cubicInterpolationMode==="monotone")&&!n.stepped&&!this._pointsUpdated){const r=n.spanGaps?this._loop:this._fullLoop;lme(this._points,n,e,r,s),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Sme(this,this.options.segment))}first(){const e=this.segments,s=this.points;return e.length&&s[e[0].start]}last(){const e=this.segments,s=this.points,n=e.length;return n&&s[e[n-1].end]}interpolate(e,s){const n=this.options,r=e[s],i=this.points,o=Nme(this,{property:s,start:r,end:r});if(!o.length)return;const l=[],c=mxe(n);let d,u;for(d=0,u=o.length;d<u;++d){const{start:h,end:p}=o[d],f=i[h],m=i[p];if(f===m){l.push(f);continue}const b=Math.abs((r-f[s])/(m[s]-f[s])),g=c(f,m,b,n.stepped);g[s]=e[s],l.push(g)}return l.length===1?l[0]:l}pathSegment(e,s,n){return Mv(this)(e,this,s,n)}path(e,s,n){const r=this.segments,i=Mv(this);let o=this._loop;s=s||0,n=n||this.points.length-s;for(const l of r)o&=i(e,this,l,{start:s,end:s+n-1});return!!o}draw(e,s,n,r){const i=this.options||{};(this.points||[]).length&&i.borderWidth&&(e.save(),yxe(e,this,n,r),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function q_(t,e,s,n){const r=t.options,{[s]:i}=t.getProps([s],n);return Math.abs(e-i)<r.radius+r.hitRadius}class vxe extends ea{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,s,n){const r=this.options,{x:i,y:o}=this.getProps(["x","y"],n);return Math.pow(e-i,2)+Math.pow(s-o,2)<Math.pow(r.hitRadius+r.radius,2)}inXRange(e,s){return q_(this,e,"x",s)}inYRange(e,s){return q_(this,e,"y",s)}getCenterPoint(e){const{x:s,y:n}=this.getProps(["x","y"],e);return{x:s,y:n}}size(e){e=e||this.options||{};let s=e.radius||0;s=Math.max(s,s&&e.hoverRadius||0);const n=s&&e.borderWidth||0;return(s+n)*2}draw(e,s){const n=this.options;this.skip||n.radius<.1||!yh(this,s,this.size(n)/2)||(e.strokeStyle=n.borderColor,e.lineWidth=n.borderWidth,e.fillStyle=n.backgroundColor,yv(e,n,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}function K_(t,e){const{x:s,y:n,base:r,width:i,height:o}=t.getProps(["x","y","base","width","height"],e);let l,c,d,u,h;return t.horizontal?(h=o/2,l=Math.min(s,r),c=Math.max(s,r),d=n-h,u=n+h):(h=i/2,l=s-h,c=s+h,d=Math.min(n,r),u=Math.max(n,r)),{left:l,top:d,right:c,bottom:u}}function ta(t,e,s,n){return t?0:Zn(e,s,n)}function Nxe(t,e,s){const n=t.options.borderWidth,r=t.borderSkipped,i=VD(n);return{t:ta(r.top,i.top,0,s),r:ta(r.right,i.right,0,e),b:ta(r.bottom,i.bottom,0,s),l:ta(r.left,i.left,0,e)}}function kxe(t,e,s){const{enableBorderRadius:n}=t.getProps(["enableBorderRadius"]),r=t.options.borderRadius,i=Dc(r),o=Math.min(e,s),l=t.borderSkipped,c=n||Lt(r);return{topLeft:ta(!c||l.top||l.left,i.topLeft,0,o),topRight:ta(!c||l.top||l.right,i.topRight,0,o),bottomLeft:ta(!c||l.bottom||l.left,i.bottomLeft,0,o),bottomRight:ta(!c||l.bottom||l.right,i.bottomRight,0,o)}}function Cxe(t){const e=K_(t),s=e.right-e.left,n=e.bottom-e.top,r=Nxe(t,s/2,n/2),i=kxe(t,s/2,n/2);return{outer:{x:e.left,y:e.top,w:s,h:n,radius:i},inner:{x:e.left+r.l,y:e.top+r.t,w:s-r.l-r.r,h:n-r.t-r.b,radius:{topLeft:Math.max(0,i.topLeft-Math.max(r.t,r.l)),topRight:Math.max(0,i.topRight-Math.max(r.t,r.r)),bottomLeft:Math.max(0,i.bottomLeft-Math.max(r.b,r.l)),bottomRight:Math.max(0,i.bottomRight-Math.max(r.b,r.r))}}}}function Lv(t,e,s,n){const r=e===null,i=s===null,l=t&&!(r&&i)&&K_(t,n);return l&&(r||pl(e,l.left,l.right))&&(i||pl(s,l.top,l.bottom))}function Sxe(t){return t.topLeft||t.topRight||t.bottomLeft||t.bottomRight}function jxe(t,e){t.rect(e.x,e.y,e.w,e.h)}function zv(t,e,s={}){const n=t.x!==s.x?-e:0,r=t.y!==s.y?-e:0,i=(t.x+t.w!==s.x+s.w?e:0)-n,o=(t.y+t.h!==s.y+s.h?e:0)-r;return{x:t.x+n,y:t.y+r,w:t.w+i,h:t.h+o,radius:t.radius}}class Ixe extends ea{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){const{inflateAmount:s,options:{borderColor:n,backgroundColor:r}}=this,{inner:i,outer:o}=Cxe(this),l=Sxe(o.radius)?kg:jxe;e.save(),(o.w!==i.w||o.h!==i.h)&&(e.beginPath(),l(e,zv(o,s,i)),e.clip(),l(e,zv(i,-s,o)),e.fillStyle=n,e.fill("evenodd")),e.beginPath(),l(e,zv(i,s)),e.fillStyle=r,e.fill(),e.restore()}inRange(e,s,n){return Lv(this,e,s,n)}inXRange(e,s){return Lv(this,e,null,s)}inYRange(e,s){return Lv(this,null,e,s)}getCenterPoint(e){const{x:s,y:n,base:r,horizontal:i}=this.getProps(["x","y","base","horizontal"],e);return{x:i?(s+r)/2:s,y:i?n:(n+r)/2}}getRange(e){return e==="x"?this.width/2:this.height/2}}const X_=(t,e)=>{let{boxHeight:s=e,boxWidth:n=e}=t;return t.usePointStyle&&(s=Math.min(s,e),n=t.pointStyleWidth||Math.min(n,e)),{boxWidth:n,boxHeight:s,itemHeight:Math.max(e,s)}},Exe=(t,e)=>t!==null&&e!==null&&t.datasetIndex===e.datasetIndex&&t.index===e.index;class Y_ extends ea{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,s,n){this.maxWidth=e,this.maxHeight=s,this._margins=n,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let s=ls(e.generateLabels,[this.chart],this)||[];e.filter&&(s=s.filter(n=>e.filter(n,this.chart.data))),e.sort&&(s=s.sort((n,r)=>e.sort(n,r,this.chart.data))),this.options.reverse&&s.reverse(),this.legendItems=s}fit(){const{options:e,ctx:s}=this;if(!e.display){this.width=this.height=0;return}const n=e.labels,r=fn(n.font),i=r.size,o=this._computeTitleHeight(),{boxWidth:l,itemHeight:c}=X_(n,i);let d,u;s.font=r.string,this.isHorizontal()?(d=this.maxWidth,u=this._fitRows(o,i,l,c)+10):(u=this.maxHeight,d=this._fitCols(o,r,l,c)+10),this.width=Math.min(d,e.maxWidth||this.maxWidth),this.height=Math.min(u,e.maxHeight||this.maxHeight)}_fitRows(e,s,n,r){const{ctx:i,maxWidth:o,options:{labels:{padding:l}}}=this,c=this.legendHitBoxes=[],d=this.lineWidths=[0],u=r+l;let h=e;i.textAlign="left",i.textBaseline="middle";let p=-1,f=-u;return this.legendItems.forEach((m,b)=>{const g=n+s/2+i.measureText(m.text).width;(b===0||d[d.length-1]+g+2*l>o)&&(h+=u,d[d.length-(b>0?0:1)]=0,f+=u,p++),c[b]={left:0,top:f,row:p,width:g,height:r},d[d.length-1]+=g+l}),h}_fitCols(e,s,n,r){const{ctx:i,maxHeight:o,options:{labels:{padding:l}}}=this,c=this.legendHitBoxes=[],d=this.columnSizes=[],u=o-e;let h=l,p=0,f=0,m=0,b=0;return this.legendItems.forEach((g,x)=>{const{itemWidth:y,itemHeight:w}=$xe(n,s,i,g,r);x>0&&f+w+2*l>u&&(h+=p+l,d.push({width:p,height:f}),m+=p+l,b++,p=f=0),c[x]={left:m,top:f,col:b,width:y,height:w},p=Math.max(p,y),f+=w+l}),h+=p,d.push({width:p,height:f}),h}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:s,options:{align:n,labels:{padding:r},rtl:i}}=this,o=Pc(i,this.left,this.width);if(this.isHorizontal()){let l=0,c=pn(n,this.left+r,this.right-this.lineWidths[l]);for(const d of s)l!==d.row&&(l=d.row,c=pn(n,this.left+r,this.right-this.lineWidths[l])),d.top+=this.top+e+r,d.left=o.leftForLtr(o.x(c),d.width),c+=d.width+r}else{let l=0,c=pn(n,this.top+e+r,this.bottom-this.columnSizes[l].height);for(const d of s)d.col!==l&&(l=d.col,c=pn(n,this.top+e+r,this.bottom-this.columnSizes[l].height)),d.top=c,d.left+=this.left+r,d.left=o.leftForLtr(o.x(d.left),d.width),c+=d.height+r}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;wv(e,this),this._draw(),vv(e)}}_draw(){const{options:e,columnSizes:s,lineWidths:n,ctx:r}=this,{align:i,labels:o}=e,l=Ss.color,c=Pc(e.rtl,this.left,this.width),d=fn(o.font),{padding:u}=o,h=d.size,p=h/2;let f;this.drawTitle(),r.textAlign=c.textAlign("left"),r.textBaseline="middle",r.lineWidth=.5,r.font=d.string;const{boxWidth:m,boxHeight:b,itemHeight:g}=X_(o,h),x=function(C,j,I){if(isNaN(m)||m<=0||isNaN(b)||b<0)return;r.save();const T=It(I.lineWidth,1);if(r.fillStyle=It(I.fillStyle,l),r.lineCap=It(I.lineCap,"butt"),r.lineDashOffset=It(I.lineDashOffset,0),r.lineJoin=It(I.lineJoin,"miter"),r.lineWidth=T,r.strokeStyle=It(I.strokeStyle,l),r.setLineDash(It(I.lineDash,[])),o.usePointStyle){const E={radius:b*Math.SQRT2/2,pointStyle:I.pointStyle,rotation:I.rotation,borderWidth:T},$=c.xPlus(C,m/2),D=j+p;BD(r,E,$,D,o.pointStyleWidth&&m)}else{const E=j+Math.max((h-b)/2,0),$=c.leftForLtr(C,m),D=Dc(I.borderRadius);r.beginPath(),Object.values(D).some(P=>P!==0)?kg(r,{x:$,y:E,w:m,h:b,radius:D}):r.rect($,E,m,b),r.fill(),T!==0&&r.stroke()}r.restore()},y=function(C,j,I){wh(r,I.text,C,j+g/2,d,{strikethrough:I.hidden,textAlign:c.textAlign(I.textAlign)})},w=this.isHorizontal(),v=this._computeTitleHeight();w?f={x:pn(i,this.left+u,this.right-n[0]),y:this.top+u+v,line:0}:f={x:this.left+u,y:pn(i,this.top+v+u,this.bottom-s[0].height),line:0},QD(this.ctx,e.textDirection);const N=g+u;this.legendItems.forEach((C,j)=>{r.strokeStyle=C.fontColor,r.fillStyle=C.fontColor;const I=r.measureText(C.text).width,T=c.textAlign(C.textAlign||(C.textAlign=o.textAlign)),E=m+p+I;let $=f.x,D=f.y;c.setWidth(this.width),w?j>0&&$+E+u>this.right&&(D=f.y+=N,f.line++,$=f.x=pn(i,this.left+u,this.right-n[f.line])):j>0&&D+N>this.bottom&&($=f.x=$+s[f.line].width+u,f.line++,D=f.y=pn(i,this.top+v+u,this.bottom-s[f.line].height));const P=c.x($);if(x(P,D,C),$=Sfe(T,$+m+p,w?$+E:this.right,e.rtl),y(c.x($),D,C),w)f.x+=E+u;else if(typeof C.text!="string"){const _=d.lineHeight;f.y+=Z_(C,_)+u}else f.y+=N}),e_(this.ctx,e.textDirection)}drawTitle(){const e=this.options,s=e.title,n=fn(s.font),r=Cr(s.padding);if(!s.display)return;const i=Pc(e.rtl,this.left,this.width),o=this.ctx,l=s.position,c=n.size/2,d=r.top+c;let u,h=this.left,p=this.width;if(this.isHorizontal())p=Math.max(...this.lineWidths),u=this.top+d,h=pn(e.align,h,this.right-p);else{const m=this.columnSizes.reduce((b,g)=>Math.max(b,g.height),0);u=d+pn(e.align,this.top,this.bottom-m-e.labels.padding-this._computeTitleHeight())}const f=pn(l,h,h+p);o.textAlign=i.textAlign(fv(l)),o.textBaseline="middle",o.strokeStyle=s.color,o.fillStyle=s.color,o.font=n.string,wh(o,s.text,f,u,n)}_computeTitleHeight(){const e=this.options.title,s=fn(e.font),n=Cr(e.padding);return e.display?s.lineHeight+n.height:0}_getLegendItemAt(e,s){let n,r,i;if(pl(e,this.left,this.right)&&pl(s,this.top,this.bottom)){for(i=this.legendHitBoxes,n=0;n<i.length;++n)if(r=i[n],pl(e,r.left,r.left+r.width)&&pl(s,r.top,r.top+r.height))return this.legendItems[n]}return null}handleEvent(e){const s=this.options;if(!Dxe(e.type,s))return;const n=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const r=this._hoveredItem,i=Exe(r,n);r&&!i&&ls(s.onLeave,[e,r,this],this),this._hoveredItem=n,n&&!i&&ls(s.onHover,[e,n,this],this)}else n&&ls(s.onClick,[e,n,this],this)}}function $xe(t,e,s,n,r){const i=Txe(n,t,e,s),o=Axe(r,n,e.lineHeight);return{itemWidth:i,itemHeight:o}}function Txe(t,e,s,n){let r=t.text;return r&&typeof r!="string"&&(r=r.reduce((i,o)=>i.length>o.length?i:o)),e+s.size/2+n.measureText(r).width}function Axe(t,e,s){let n=t;return typeof e.text!="string"&&(n=Z_(e,s)),n}function Z_(t,e){const s=t.text?t.text.length:0;return e*s}function Dxe(t,e){return!!((t==="mousemove"||t==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(t==="click"||t==="mouseup"))}var J_={id:"legend",_element:Y_,start(t,e,s){const n=t.legend=new Y_({ctx:t.ctx,options:s,chart:t});Sr.configure(t,n,s),Sr.addBox(t,n)},stop(t){Sr.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,s){const n=t.legend;Sr.configure(t,n,s),n.options=s},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,s){const n=e.datasetIndex,r=s.chart;r.isDatasetVisible(n)?(r.hide(n),e.hidden=!0):(r.show(n),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:s,pointStyle:n,textAlign:r,color:i,useBorderRadius:o,borderRadius:l}}=t.legend.options;return t._getSortedDatasetMetas().map(c=>{const d=c.controller.getStyle(s?0:void 0),u=Cr(d.borderWidth);return{text:e[c.index].label,fillStyle:d.backgroundColor,fontColor:i,hidden:!c.visible,lineCap:d.borderCapStyle,lineDash:d.borderDash,lineDashOffset:d.borderDashOffset,lineJoin:d.borderJoinStyle,lineWidth:(u.width+u.height)/4,strokeStyle:d.borderColor,pointStyle:n||d.pointStyle,rotation:d.rotation,textAlign:r||d.textAlign,borderRadius:o&&(l||d.borderRadius),datasetIndex:c.index}},this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class Q_ extends ea{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,s){const n=this.options;if(this.left=0,this.top=0,!n.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=s;const r=Ls(n.text)?n.text.length:1;this._padding=Cr(n.padding);const i=r*fn(n.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=i:this.width=i}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:s,left:n,bottom:r,right:i,options:o}=this,l=o.align;let c=0,d,u,h;return this.isHorizontal()?(u=pn(l,n,i),h=s+e,d=i-n):(o.position==="left"?(u=n+e,h=pn(l,r,s),c=qs*-.5):(u=i-e,h=pn(l,s,r),c=qs*.5),d=r-s),{titleX:u,titleY:h,maxWidth:d,rotation:c}}draw(){const e=this.ctx,s=this.options;if(!s.display)return;const n=fn(s.font),i=n.lineHeight/2+this._padding.top,{titleX:o,titleY:l,maxWidth:c,rotation:d}=this._drawArgs(i);wh(e,s.text,0,0,n,{color:s.color,maxWidth:c,rotation:d,textAlign:fv(s.align),textBaseline:"middle",translation:[o,l]})}}function _xe(t,e){const s=new Q_({ctx:t.ctx,options:e,chart:t});Sr.configure(t,s,e),Sr.addBox(t,s),t.titleBlock=s}var eR={id:"title",_element:Q_,start(t,e,s){_xe(t,s)},stop(t){const e=t.titleBlock;Sr.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,s){const n=t.titleBlock;Sr.configure(t,n,s),n.options=s},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Th={average(t){if(!t.length)return!1;let e,s,n=new Set,r=0,i=0;for(e=0,s=t.length;e<s;++e){const l=t[e].element;if(l&&l.hasValue()){const c=l.tooltipPosition();n.add(c.x),r+=c.y,++i}}return i===0||n.size===0?!1:{x:[...n].reduce((l,c)=>l+c)/n.size,y:r/i}},nearest(t,e){if(!t.length)return!1;let s=e.x,n=e.y,r=Number.POSITIVE_INFINITY,i,o,l;for(i=0,o=t.length;i<o;++i){const c=t[i].element;if(c&&c.hasValue()){const d=c.getCenterPoint(),u=hv(e,d);u<r&&(r=u,l=c)}}if(l){const c=l.tooltipPosition();s=c.x,n=c.y}return{x:s,y:n}}};function Ei(t,e){return e&&(Ls(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function co(t){return(typeof t=="string"||t instanceof String)&&t.indexOf(`
`)>-1?t.split(`
`):t}function Rxe(t,e){const{element:s,datasetIndex:n,index:r}=e,i=t.getDatasetMeta(n).controller,{label:o,value:l}=i.getLabelAndValue(r);return{chart:t,label:o,parsed:i.getParsed(r),raw:t.data.datasets[n].data[r],formattedValue:l,dataset:i.getDataset(),dataIndex:r,datasetIndex:n,element:s}}function tR(t,e){const s=t.chart.ctx,{body:n,footer:r,title:i}=t,{boxWidth:o,boxHeight:l}=e,c=fn(e.bodyFont),d=fn(e.titleFont),u=fn(e.footerFont),h=i.length,p=r.length,f=n.length,m=Cr(e.padding);let b=m.height,g=0,x=n.reduce((v,N)=>v+N.before.length+N.lines.length+N.after.length,0);if(x+=t.beforeBody.length+t.afterBody.length,h&&(b+=h*d.lineHeight+(h-1)*e.titleSpacing+e.titleMarginBottom),x){const v=e.displayColors?Math.max(l,c.lineHeight):c.lineHeight;b+=f*v+(x-f)*c.lineHeight+(x-1)*e.bodySpacing}p&&(b+=e.footerMarginTop+p*u.lineHeight+(p-1)*e.footerSpacing);let y=0;const w=function(v){g=Math.max(g,s.measureText(v).width+y)};return s.save(),s.font=d.string,qt(t.title,w),s.font=c.string,qt(t.beforeBody.concat(t.afterBody),w),y=e.displayColors?o+2+e.boxPadding:0,qt(n,v=>{qt(v.before,w),qt(v.lines,w),qt(v.after,w)}),y=0,s.font=u.string,qt(t.footer,w),s.restore(),g+=m.width,{width:g,height:b}}function Pxe(t,e){const{y:s,height:n}=e;return s<n/2?"top":s>t.height-n/2?"bottom":"center"}function Fxe(t,e,s,n){const{x:r,width:i}=n,o=s.caretSize+s.caretPadding;if(t==="left"&&r+i+o>e.width||t==="right"&&r-i-o<0)return!0}function Oxe(t,e,s,n){const{x:r,width:i}=s,{width:o,chartArea:{left:l,right:c}}=t;let d="center";return n==="center"?d=r<=(l+c)/2?"left":"right":r<=i/2?d="left":r>=o-i/2&&(d="right"),Fxe(d,t,e,s)&&(d="center"),d}function sR(t,e,s){const n=s.yAlign||e.yAlign||Pxe(t,s);return{xAlign:s.xAlign||e.xAlign||Oxe(t,e,s,n),yAlign:n}}function Mxe(t,e){let{x:s,width:n}=t;return e==="right"?s-=n:e==="center"&&(s-=n/2),s}function Lxe(t,e,s){let{y:n,height:r}=t;return e==="top"?n+=s:e==="bottom"?n-=r+s:n-=r/2,n}function nR(t,e,s,n){const{caretSize:r,caretPadding:i,cornerRadius:o}=t,{xAlign:l,yAlign:c}=s,d=r+i,{topLeft:u,topRight:h,bottomLeft:p,bottomRight:f}=Dc(o);let m=Mxe(e,l);const b=Lxe(e,c,d);return c==="center"?l==="left"?m+=d:l==="right"&&(m-=d):l==="left"?m-=Math.max(u,p)+r:l==="right"&&(m+=Math.max(h,f)+r),{x:Zn(m,0,n.width-e.width),y:Zn(b,0,n.height-e.height)}}function Fg(t,e,s){const n=Cr(s.padding);return e==="center"?t.x+t.width/2:e==="right"?t.x+t.width-n.right:t.x+n.left}function rR(t){return Ei([],co(t))}function zxe(t,e,s){return xl(t,{tooltip:e,tooltipItems:s,type:"tooltip"})}function iR(t,e){const s=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return s?t.override(s):t}const oR={beforeTitle:ao,title(t){if(t.length>0){const e=t[0],s=e.chart.data.labels,n=s?s.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(n>0&&e.dataIndex<n)return s[e.dataIndex]}return""},afterTitle:ao,beforeBody:ao,beforeLabel:ao,label(t){if(this&&this.options&&this.options.mode==="dataset")return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const s=t.formattedValue;return Wt(s)||(e+=s),e},labelColor(t){const s=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:s.borderColor,backgroundColor:s.backgroundColor,borderWidth:s.borderWidth,borderDash:s.borderDash,borderDashOffset:s.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const s=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:s.pointStyle,rotation:s.rotation}},afterLabel:ao,afterBody:ao,beforeFooter:ao,footer:ao,afterFooter:ao};function Ln(t,e,s,n){const r=t[e].call(s,n);return typeof r>"u"?oR[e].call(s,n):r}class aR extends ea{static positioners=Th;constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const s=this.chart,n=this.options.setContext(this.getContext()),r=n.enabled&&s.options.animation&&n.animations,i=new o_(this.chart,r);return r._cacheable&&(this._cachedAnimations=Object.freeze(i)),i}getContext(){return this.$context||(this.$context=zxe(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,s){const{callbacks:n}=s,r=Ln(n,"beforeTitle",this,e),i=Ln(n,"title",this,e),o=Ln(n,"afterTitle",this,e);let l=[];return l=Ei(l,co(r)),l=Ei(l,co(i)),l=Ei(l,co(o)),l}getBeforeBody(e,s){return rR(Ln(s.callbacks,"beforeBody",this,e))}getBody(e,s){const{callbacks:n}=s,r=[];return qt(e,i=>{const o={before:[],lines:[],after:[]},l=iR(n,i);Ei(o.before,co(Ln(l,"beforeLabel",this,i))),Ei(o.lines,Ln(l,"label",this,i)),Ei(o.after,co(Ln(l,"afterLabel",this,i))),r.push(o)}),r}getAfterBody(e,s){return rR(Ln(s.callbacks,"afterBody",this,e))}getFooter(e,s){const{callbacks:n}=s,r=Ln(n,"beforeFooter",this,e),i=Ln(n,"footer",this,e),o=Ln(n,"afterFooter",this,e);let l=[];return l=Ei(l,co(r)),l=Ei(l,co(i)),l=Ei(l,co(o)),l}_createItems(e){const s=this._active,n=this.chart.data,r=[],i=[],o=[];let l=[],c,d;for(c=0,d=s.length;c<d;++c)l.push(Rxe(this.chart,s[c]));return e.filter&&(l=l.filter((u,h,p)=>e.filter(u,h,p,n))),e.itemSort&&(l=l.sort((u,h)=>e.itemSort(u,h,n))),qt(l,u=>{const h=iR(e.callbacks,u);r.push(Ln(h,"labelColor",this,u)),i.push(Ln(h,"labelPointStyle",this,u)),o.push(Ln(h,"labelTextColor",this,u))}),this.labelColors=r,this.labelPointStyles=i,this.labelTextColors=o,this.dataPoints=l,l}update(e,s){const n=this.options.setContext(this.getContext()),r=this._active;let i,o=[];if(!r.length)this.opacity!==0&&(i={opacity:0});else{const l=Th[n.position].call(this,r,this._eventPosition);o=this._createItems(n),this.title=this.getTitle(o,n),this.beforeBody=this.getBeforeBody(o,n),this.body=this.getBody(o,n),this.afterBody=this.getAfterBody(o,n),this.footer=this.getFooter(o,n);const c=this._size=tR(this,n),d=Object.assign({},l,c),u=sR(this.chart,n,d),h=nR(n,d,u,this.chart);this.xAlign=u.xAlign,this.yAlign=u.yAlign,i={opacity:1,x:h.x,y:h.y,width:c.width,height:c.height,caretX:l.x,caretY:l.y}}this._tooltipItems=o,this.$context=void 0,i&&this._resolveAnimations().update(this,i),e&&n.external&&n.external.call(this,{chart:this.chart,tooltip:this,replay:s})}drawCaret(e,s,n,r){const i=this.getCaretPosition(e,n,r);s.lineTo(i.x1,i.y1),s.lineTo(i.x2,i.y2),s.lineTo(i.x3,i.y3)}getCaretPosition(e,s,n){const{xAlign:r,yAlign:i}=this,{caretSize:o,cornerRadius:l}=n,{topLeft:c,topRight:d,bottomLeft:u,bottomRight:h}=Dc(l),{x:p,y:f}=e,{width:m,height:b}=s;let g,x,y,w,v,N;return i==="center"?(v=f+b/2,r==="left"?(g=p,x=g-o,w=v+o,N=v-o):(g=p+m,x=g+o,w=v-o,N=v+o),y=g):(r==="left"?x=p+Math.max(c,u)+o:r==="right"?x=p+m-Math.max(d,h)-o:x=this.caretX,i==="top"?(w=f,v=w-o,g=x-o,y=x+o):(w=f+b,v=w+o,g=x+o,y=x-o),N=w),{x1:g,x2:x,x3:y,y1:w,y2:v,y3:N}}drawTitle(e,s,n){const r=this.title,i=r.length;let o,l,c;if(i){const d=Pc(n.rtl,this.x,this.width);for(e.x=Fg(this,n.titleAlign,n),s.textAlign=d.textAlign(n.titleAlign),s.textBaseline="middle",o=fn(n.titleFont),l=n.titleSpacing,s.fillStyle=n.titleColor,s.font=o.string,c=0;c<i;++c)s.fillText(r[c],d.x(e.x),e.y+o.lineHeight/2),e.y+=o.lineHeight+l,c+1===i&&(e.y+=n.titleMarginBottom-l)}}_drawColorBox(e,s,n,r,i){const o=this.labelColors[n],l=this.labelPointStyles[n],{boxHeight:c,boxWidth:d}=i,u=fn(i.bodyFont),h=Fg(this,"left",i),p=r.x(h),f=c<u.lineHeight?(u.lineHeight-c)/2:0,m=s.y+f;if(i.usePointStyle){const b={radius:Math.min(d,c)/2,pointStyle:l.pointStyle,rotation:l.rotation,borderWidth:1},g=r.leftForLtr(p,d)+d/2,x=m+c/2;e.strokeStyle=i.multiKeyBackground,e.fillStyle=i.multiKeyBackground,yv(e,b,g,x),e.strokeStyle=o.borderColor,e.fillStyle=o.backgroundColor,yv(e,b,g,x)}else{e.lineWidth=Lt(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,e.strokeStyle=o.borderColor,e.setLineDash(o.borderDash||[]),e.lineDashOffset=o.borderDashOffset||0;const b=r.leftForLtr(p,d),g=r.leftForLtr(r.xPlus(p,1),d-2),x=Dc(o.borderRadius);Object.values(x).some(y=>y!==0)?(e.beginPath(),e.fillStyle=i.multiKeyBackground,kg(e,{x:b,y:m,w:d,h:c,radius:x}),e.fill(),e.stroke(),e.fillStyle=o.backgroundColor,e.beginPath(),kg(e,{x:g,y:m+1,w:d-2,h:c-2,radius:x}),e.fill()):(e.fillStyle=i.multiKeyBackground,e.fillRect(b,m,d,c),e.strokeRect(b,m,d,c),e.fillStyle=o.backgroundColor,e.fillRect(g,m+1,d-2,c-2))}e.fillStyle=this.labelTextColors[n]}drawBody(e,s,n){const{body:r}=this,{bodySpacing:i,bodyAlign:o,displayColors:l,boxHeight:c,boxWidth:d,boxPadding:u}=n,h=fn(n.bodyFont);let p=h.lineHeight,f=0;const m=Pc(n.rtl,this.x,this.width),b=function(I){s.fillText(I,m.x(e.x+f),e.y+p/2),e.y+=p+i},g=m.textAlign(o);let x,y,w,v,N,C,j;for(s.textAlign=o,s.textBaseline="middle",s.font=h.string,e.x=Fg(this,g,n),s.fillStyle=n.bodyColor,qt(this.beforeBody,b),f=l&&g!=="right"?o==="center"?d/2+u:d+2+u:0,v=0,C=r.length;v<C;++v){for(x=r[v],y=this.labelTextColors[v],s.fillStyle=y,qt(x.before,b),w=x.lines,l&&w.length&&(this._drawColorBox(s,e,v,m,n),p=Math.max(h.lineHeight,c)),N=0,j=w.length;N<j;++N)b(w[N]),p=h.lineHeight;qt(x.after,b)}f=0,p=h.lineHeight,qt(this.afterBody,b),e.y-=i}drawFooter(e,s,n){const r=this.footer,i=r.length;let o,l;if(i){const c=Pc(n.rtl,this.x,this.width);for(e.x=Fg(this,n.footerAlign,n),e.y+=n.footerMarginTop,s.textAlign=c.textAlign(n.footerAlign),s.textBaseline="middle",o=fn(n.footerFont),s.fillStyle=n.footerColor,s.font=o.string,l=0;l<i;++l)s.fillText(r[l],c.x(e.x),e.y+o.lineHeight/2),e.y+=o.lineHeight+n.footerSpacing}}drawBackground(e,s,n,r){const{xAlign:i,yAlign:o}=this,{x:l,y:c}=e,{width:d,height:u}=n,{topLeft:h,topRight:p,bottomLeft:f,bottomRight:m}=Dc(r.cornerRadius);s.fillStyle=r.backgroundColor,s.strokeStyle=r.borderColor,s.lineWidth=r.borderWidth,s.beginPath(),s.moveTo(l+h,c),o==="top"&&this.drawCaret(e,s,n,r),s.lineTo(l+d-p,c),s.quadraticCurveTo(l+d,c,l+d,c+p),o==="center"&&i==="right"&&this.drawCaret(e,s,n,r),s.lineTo(l+d,c+u-m),s.quadraticCurveTo(l+d,c+u,l+d-m,c+u),o==="bottom"&&this.drawCaret(e,s,n,r),s.lineTo(l+f,c+u),s.quadraticCurveTo(l,c+u,l,c+u-f),o==="center"&&i==="left"&&this.drawCaret(e,s,n,r),s.lineTo(l,c+h),s.quadraticCurveTo(l,c,l+h,c),s.closePath(),s.fill(),r.borderWidth>0&&s.stroke()}_updateAnimationTarget(e){const s=this.chart,n=this.$animations,r=n&&n.x,i=n&&n.y;if(r||i){const o=Th[e.position].call(this,this._active,this._eventPosition);if(!o)return;const l=this._size=tR(this,e),c=Object.assign({},o,this._size),d=sR(s,e,c),u=nR(e,c,d,s);(r._to!==u.x||i._to!==u.y)&&(this.xAlign=d.xAlign,this.yAlign=d.yAlign,this.width=l.width,this.height=l.height,this.caretX=o.x,this.caretY=o.y,this._resolveAnimations().update(this,u))}}_willRender(){return!!this.opacity}draw(e){const s=this.options.setContext(this.getContext());let n=this.opacity;if(!n)return;this._updateAnimationTarget(s);const r={width:this.width,height:this.height},i={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;const o=Cr(s.padding),l=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;s.enabled&&l&&(e.save(),e.globalAlpha=n,this.drawBackground(i,e,r,s),QD(e,s.textDirection),i.y+=o.top,this.drawTitle(i,e,s),this.drawBody(i,e,s),this.drawFooter(i,e,s),e_(e,s.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,s){const n=this._active,r=e.map(({datasetIndex:l,index:c})=>{const d=this.chart.getDatasetMeta(l);if(!d)throw new Error("Cannot find a dataset at index "+l);return{datasetIndex:l,element:d.data[c],index:c}}),i=!yg(n,r),o=this._positionChanged(r,s);(i||o)&&(this._active=r,this._eventPosition=s,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,s,n=!0){if(s&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const r=this.options,i=this._active||[],o=this._getActiveElements(e,i,s,n),l=this._positionChanged(o,e),c=s||!yg(o,i)||l;return c&&(this._active=o,(r.enabled||r.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,s))),c}_getActiveElements(e,s,n,r){const i=this.options;if(e.type==="mouseout")return[];if(!r)return s.filter(l=>this.chart.data.datasets[l.datasetIndex]&&this.chart.getDatasetMeta(l.datasetIndex).controller.getParsed(l.index)!==void 0);const o=this.chart.getElementsAtEventForMode(e,i.mode,i,n);return i.reverse&&o.reverse(),o}_positionChanged(e,s){const{caretX:n,caretY:r,options:i}=this,o=Th[i.position].call(this,e,s);return o!==!1&&(n!==o.x||r!==o.y)}}var lR={id:"tooltip",_element:aR,positioners:Th,afterInit(t,e,s){s&&(t.tooltip=new aR({chart:t,options:s}))},beforeUpdate(t,e,s){t.tooltip&&t.tooltip.initialize(s)},reset(t,e,s){t.tooltip&&t.tooltip.initialize(s)},afterDraw(t){const e=t.tooltip;if(e&&e._willRender()){const s={tooltip:e};if(t.notifyPlugins("beforeTooltipDraw",{...s,cancelable:!0})===!1)return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",s)}},afterEvent(t,e){if(t.tooltip){const s=e.replay;t.tooltip.handleEvent(e.event,s,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:oR},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>t!=="filter"&&t!=="itemSort"&&t!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const Bxe=(t,e,s,n)=>(typeof e=="string"?(s=t.push(e)-1,n.unshift({index:s,label:e})):isNaN(e)&&(s=null),s);function Uxe(t,e,s,n){const r=t.indexOf(e);if(r===-1)return Bxe(t,e,s,n);const i=t.lastIndexOf(e);return r!==i?s:r}const Vxe=(t,e)=>t===null?null:Zn(Math.round(t),0,e);function cR(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}class dR extends Fc{static id="category";static defaults={ticks:{callback:cR}};constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const s=this._addedLabels;if(s.length){const n=this.getLabels();for(const{index:r,label:i}of s)n[r]===i&&n.splice(r,1);this._addedLabels=[]}super.init(e)}parse(e,s){if(Wt(e))return null;const n=this.getLabels();return s=isFinite(s)&&n[s]===e?s:Uxe(n,e,It(s,e),this._addedLabels),Vxe(s,n.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:s}=this.getUserBounds();let{min:n,max:r}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(n=0),s||(r=this.getLabels().length-1)),this.min=n,this.max=r}buildTicks(){const e=this.min,s=this.max,n=this.options.offset,r=[];let i=this.getLabels();i=e===0&&s===i.length-1?i:i.slice(e,s+1),this._valueRange=Math.max(i.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let o=e;o<=s;o++)r.push({value:o});return r}getLabelForValue(e){return cR.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const s=this.ticks;return e<0||e>s.length-1?null:this.getPixelForValue(s[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}function Wxe(t,e){const s=[],{bounds:r,step:i,min:o,max:l,precision:c,count:d,maxTicks:u,maxDigits:h,includeBounds:p}=t,f=i||1,m=u-1,{min:b,max:g}=e,x=!Wt(o),y=!Wt(l),w=!Wt(d),v=(g-b)/(h+1);let N=CD((g-b)/m/f)*f,C,j,I,T;if(N<1e-14&&!x&&!y)return[{value:b},{value:g}];T=Math.ceil(g/N)-Math.floor(b/N),T>m&&(N=CD(T*N/m/f)*f),Wt(c)||(C=Math.pow(10,c),N=Math.ceil(N*C)/C),r==="ticks"?(j=Math.floor(b/N)*N,I=Math.ceil(g/N)*N):(j=b,I=g),x&&y&&i&&mfe((l-o)/i,N/1e3)?(T=Math.round(Math.min((l-o)/N,u)),N=(l-o)/T,j=o,I=l):w?(j=x?o:j,I=y?l:I,T=d-1,N=(I-j)/T):(T=(I-j)/N,mh(T,Math.round(T),N/1e3)?T=Math.round(T):T=Math.ceil(T));const E=Math.max(SD(N),SD(j));C=Math.pow(10,Wt(c)?E:c),j=Math.round(j*C)/C,I=Math.round(I*C)/C;let $=0;for(x&&(p&&j!==o?(s.push({value:o}),j<o&&$++,mh(Math.round((j+$*N)*C)/C,o,uR(o,v,t))&&$++):j<o&&$++);$<T;++$){const D=Math.round((j+$*N)*C)/C;if(y&&D>l)break;s.push({value:D})}return y&&p&&I!==l?s.length&&mh(s[s.length-1].value,l,uR(l,v,t))?s[s.length-1].value=l:s.push({value:l}):(!y||I===l)&&s.push({value:I}),s}function uR(t,e,{horizontal:s,minRotation:n}){const r=hl(n),i=(s?Math.sin(r):Math.cos(r))||.001,o=.75*e*(""+t).length;return Math.min(e/i,o)}class Gxe extends Fc{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,s){return Wt(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:s,maxDefined:n}=this.getUserBounds();let{min:r,max:i}=this;const o=c=>r=s?r:c,l=c=>i=n?i:c;if(e){const c=ji(r),d=ji(i);c<0&&d<0?l(0):c>0&&d>0&&o(0)}if(r===i){let c=i===0?1:Math.abs(i*.05);l(i+c),e||o(r-c)}this.min=r,this.max=i}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:s,stepSize:n}=e,r;return n?(r=Math.ceil(this.max/n)-Math.floor(this.min/n)+1,r>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${n} would result generating up to ${r} ticks. Limiting to 1000.`),r=1e3)):(r=this.computeTickLimit(),s=s||11),s&&(r=Math.min(s,r)),r}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,s=e.ticks;let n=this.getTickLimit();n=Math.max(2,n);const r={maxTicks:n,bounds:e.bounds,min:e.min,max:e.max,precision:s.precision,step:s.stepSize,count:s.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:s.minRotation||0,includeBounds:s.includeBounds!==!1},i=this._range||this,o=Wxe(r,i);return e.bounds==="ticks"&&gfe(o,this,"value"),e.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){const e=this.ticks;let s=this.min,n=this.max;if(super.configure(),this.options.offset&&e.length){const r=(n-s)/Math.max(e.length-1,1)/2;s-=r,n+=r}this._startValue=s,this._endValue=n,this._valueRange=n-s}getLabelForValue(e){return FD(e,this.chart.options.locale,this.options.ticks.format)}}class hR extends Gxe{static id="linear";static defaults={ticks:{callback:MD.formatters.numeric}};determineDataLimits(){const{min:e,max:s}=this.getMinMax(!0);this.min=kr(e)?e:0,this.max=kr(s)?s:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),s=e?this.width:this.height,n=hl(this.options.ticks.minRotation),r=(e?Math.sin(n):Math.cos(n))||.001,i=this._resolveTickFontOptions(0);return Math.ceil(s/Math.min(40,i.lineHeight/r))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}const Og={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},zn=Object.keys(Og);function pR(t,e){return t-e}function fR(t,e){if(Wt(e))return null;const s=t._adapter,{parser:n,round:r,isoWeekday:i}=t._parseOpts;let o=e;return typeof n=="function"&&(o=n(o)),kr(o)||(o=typeof n=="string"?s.parse(o,n):s.parse(o)),o===null?null:(r&&(o=r==="week"&&(gh(i)||i===!0)?s.startOf(o,"isoWeek",i):s.startOf(o,r)),+o)}function mR(t,e,s,n){const r=zn.length;for(let i=zn.indexOf(t);i<r-1;++i){const o=Og[zn[i]],l=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((s-e)/(l*o.size))<=n)return zn[i]}return zn[r-1]}function Hxe(t,e,s,n,r){for(let i=zn.length-1;i>=zn.indexOf(s);i--){const o=zn[i];if(Og[o].common&&t._adapter.diff(r,n,o)>=e-1)return o}return zn[s?zn.indexOf(s):0]}function qxe(t){for(let e=zn.indexOf(t)+1,s=zn.length;e<s;++e)if(Og[zn[e]].common)return zn[e]}function gR(t,e,s){if(!s)t[e]=!0;else if(s.length){const{lo:n,hi:r}=pv(s,e),i=s[n]>=e?s[n]:s[r];t[i]=!0}}function Kxe(t,e,s,n){const r=t._adapter,i=+r.startOf(e[0].value,n),o=e[e.length-1].value;let l,c;for(l=i;l<=o;l=+r.add(l,1,n))c=s[l],c>=0&&(e[c].major=!0);return e}function xR(t,e,s){const n=[],r={},i=e.length;let o,l;for(o=0;o<i;++o)l=e[o],r[l]=o,n.push({value:l,major:!1});return i===0||!s?n:Kxe(t,n,r,s)}class bR extends Fc{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,s={}){const n=e.time||(e.time={}),r=this._adapter=new sge._date(e.adapters.date);r.init(s),ph(n.displayFormats,r.formats()),this._parseOpts={parser:n.parser,round:n.round,isoWeekday:n.isoWeekday},super.init(e),this._normalized=s.normalized}parse(e,s){return e===void 0?null:fR(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,s=this._adapter,n=e.time.unit||"day";let{min:r,max:i,minDefined:o,maxDefined:l}=this.getUserBounds();function c(d){!o&&!isNaN(d.min)&&(r=Math.min(r,d.min)),!l&&!isNaN(d.max)&&(i=Math.max(i,d.max))}(!o||!l)&&(c(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&c(this.getMinMax(!1))),r=kr(r)&&!isNaN(r)?r:+s.startOf(Date.now(),n),i=kr(i)&&!isNaN(i)?i:+s.endOf(Date.now(),n)+1,this.min=Math.min(r,i-1),this.max=Math.max(r+1,i)}_getLabelBounds(){const e=this.getLabelTimestamps();let s=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return e.length&&(s=e[0],n=e[e.length-1]),{min:s,max:n}}buildTicks(){const e=this.options,s=e.time,n=e.ticks,r=n.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&r.length&&(this.min=this._userMin||r[0],this.max=this._userMax||r[r.length-1]);const i=this.min,o=this.max,l=Nfe(r,i,o);return this._unit=s.unit||(n.autoSkip?mR(s.minUnit,this.min,this.max,this._getLabelCapacity(i)):Hxe(this,l.length,s.minUnit,this.min,this.max)),this._majorUnit=!n.major.enabled||this._unit==="year"?void 0:qxe(this._unit),this.initOffsets(r),e.reverse&&l.reverse(),xR(this,l,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let s=0,n=0,r,i;this.options.offset&&e.length&&(r=this.getDecimalForValue(e[0]),e.length===1?s=1-r:s=(this.getDecimalForValue(e[1])-r)/2,i=this.getDecimalForValue(e[e.length-1]),e.length===1?n=i:n=(i-this.getDecimalForValue(e[e.length-2]))/2);const o=e.length<3?.5:.25;s=Zn(s,0,o),n=Zn(n,0,o),this._offsets={start:s,end:n,factor:1/(s+1+n)}}_generate(){const e=this._adapter,s=this.min,n=this.max,r=this.options,i=r.time,o=i.unit||mR(i.minUnit,s,n,this._getLabelCapacity(s)),l=It(r.ticks.stepSize,1),c=o==="week"?i.isoWeekday:!1,d=gh(c)||c===!0,u={};let h=s,p,f;if(d&&(h=+e.startOf(h,"isoWeek",c)),h=+e.startOf(h,d?"day":o),e.diff(n,s,o)>1e5*l)throw new Error(s+" and "+n+" are too far apart with stepSize of "+l+" "+o);const m=r.ticks.source==="data"&&this.getDataTimestamps();for(p=h,f=0;p<n;p=+e.add(p,l,o),f++)gR(u,p,m);return(p===n||r.bounds==="ticks"||f===1)&&gR(u,p,m),Object.keys(u).sort(pR).map(b=>+b)}getLabelForValue(e){const s=this._adapter,n=this.options.time;return n.tooltipFormat?s.format(e,n.tooltipFormat):s.format(e,n.displayFormats.datetime)}format(e,s){const r=this.options.time.displayFormats,i=this._unit,o=s||r[i];return this._adapter.format(e,o)}_tickFormatFunction(e,s,n,r){const i=this.options,o=i.ticks.callback;if(o)return ls(o,[e,s,n],this);const l=i.time.displayFormats,c=this._unit,d=this._majorUnit,u=c&&l[c],h=d&&l[d],p=n[s],f=d&&h&&p&&p.major;return this._adapter.format(e,r||(f?h:u))}generateTickLabels(e){let s,n,r;for(s=0,n=e.length;s<n;++s)r=e[s],r.label=this._tickFormatFunction(r.value,s,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const s=this._offsets,n=this.getDecimalForValue(e);return this.getPixelForDecimal((s.start+n)*s.factor)}getValueForPixel(e){const s=this._offsets,n=this.getDecimalForPixel(e)/s.factor-s.end;return this.min+n*(this.max-this.min)}_getLabelSize(e){const s=this.options.ticks,n=this.ctx.measureText(e).width,r=hl(this.isHorizontal()?s.maxRotation:s.minRotation),i=Math.cos(r),o=Math.sin(r),l=this._resolveTickFontOptions(0).size;return{w:n*i+l*o,h:n*o+l*i}}_getLabelCapacity(e){const s=this.options.time,n=s.displayFormats,r=n[s.unit]||n.millisecond,i=this._tickFormatFunction(e,0,xR(this,[e],this._majorUnit),r),o=this._getLabelSize(i),l=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return l>0?l:1}getDataTimestamps(){let e=this._cache.data||[],s,n;if(e.length)return e;const r=this.getMatchingVisibleMetas();if(this._normalized&&r.length)return this._cache.data=r[0].controller.getAllParsedValues(this);for(s=0,n=r.length;s<n;++s)e=e.concat(r[s].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let s,n;if(e.length)return e;const r=this.getLabels();for(s=0,n=r.length;s<n;++s)e.push(fR(this,r[s]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return $D(e.sort(pR))}}function Mg(t,e,s){let n=0,r=t.length-1,i,o,l,c;s?(e>=t[n].pos&&e<=t[r].pos&&({lo:n,hi:r}=fl(t,"pos",e)),{pos:i,time:l}=t[n],{pos:o,time:c}=t[r]):(e>=t[n].time&&e<=t[r].time&&({lo:n,hi:r}=fl(t,"time",e)),{time:i,pos:l}=t[n],{time:o,pos:c}=t[r]);const d=o-i;return d?l+(c-l)*(e-i)/d:l}class Bbe extends bR{static id="timeseries";static defaults=bR.defaults;constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),s=this._table=this.buildLookupTable(e);this._minPos=Mg(s,this.min),this._tableRange=Mg(s,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:s,max:n}=this,r=[],i=[];let o,l,c,d,u;for(o=0,l=e.length;o<l;++o)d=e[o],d>=s&&d<=n&&r.push(d);if(r.length<2)return[{time:s,pos:0},{time:n,pos:1}];for(o=0,l=r.length;o<l;++o)u=r[o+1],c=r[o-1],d=r[o],Math.round((u+c)/2)!==d&&i.push({time:d,pos:o/(l-1)});return i}_generate(){const e=this.min,s=this.max;let n=super.getDataTimestamps();return(!n.includes(e)||!n.length)&&n.splice(0,0,e),(!n.includes(s)||n.length===1)&&n.push(s),n.sort((r,i)=>r-i)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const s=this.getDataTimestamps(),n=this.getLabelTimestamps();return s.length&&n.length?e=this.normalize(s.concat(n)):e=s.length?s:n,e=this._cache.all=e,e}getDecimalForValue(e){return(Mg(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const s=this._offsets,n=this.getDecimalForPixel(e)/s.factor-s.end;return Mg(this._table,n*this._tableRange+this._minPos,!0)}}const yR="label";function wR(t,e){typeof t=="function"?t(e):t&&(t.current=e)}function Xxe(t,e){const s=t.options;s&&e&&Object.assign(s,e)}function vR(t,e){t.labels=e}function NR(t,e,s=yR){const n=[];t.datasets=e.map(r=>{const i=t.datasets.find(o=>o[s]===r[s]);return!i||!r.data||n.includes(i)?{...r}:(n.push(i),Object.assign(i,r),i)})}function Yxe(t,e=yR){const s={labels:[],datasets:[]};return vR(s,t.labels),NR(s,t.datasets,e),s}function Zxe(t,e){const{height:s=150,width:n=300,redraw:r=!1,datasetIdKey:i,type:o,data:l,options:c,plugins:d=[],fallbackContent:u,updateMode:h,...p}=t,f=k.useRef(null),m=k.useRef(null),b=()=>{f.current&&(m.current=new $h(f.current,{type:o,data:Yxe(l,i),options:c&&{...c},plugins:d}),wR(e,m.current))},g=()=>{wR(e,null),m.current&&(m.current.destroy(),m.current=null)};return k.useEffect(()=>{!r&&m.current&&c&&Xxe(m.current,c)},[r,c]),k.useEffect(()=>{!r&&m.current&&vR(m.current.config.data,l.labels)},[r,l.labels]),k.useEffect(()=>{!r&&m.current&&l.datasets&&NR(m.current.config.data,l.datasets,i)},[r,l.datasets]),k.useEffect(()=>{m.current&&(r?(g(),setTimeout(b)):m.current.update(h))},[r,c,l.labels,l.datasets,h]),k.useEffect(()=>{m.current&&(g(),setTimeout(b))},[o]),k.useEffect(()=>(b(),()=>g()),[]),a.jsx("canvas",{ref:f,role:"img",height:s,width:n,...p,children:u})}const Jxe=k.forwardRef(Zxe);function kR(t,e){return $h.register(e),k.forwardRef((s,n)=>a.jsx(Jxe,{...s,ref:n,type:t}))}const Qxe=kR("line",tge),e0e=kR("bar",ege);$h.register(dR,hR,Ixe,eR,lR,J_);function t0e({rep:t,slots:e}){const[s,n]=k.useState([]);k.useEffect(()=>{const o=Dpe(t,e);n(o)},[t,e]);const r={labels:["Satisfaction","Efficiency","Quality"],datasets:[{label:"Performance Score",data:[s.find(o=>o.metric==="satisfaction")?.value||0,s.find(o=>o.metric==="efficiency")?.value||0,s.find(o=>o.metric==="quality")?.value||0],backgroundColor:["rgba(59, 130, 246, 0.6)","rgba(16, 185, 129, 0.6)","rgba(139, 92, 246, 0.6)"],borderColor:["rgb(59, 130, 246)","rgb(16, 185, 129)","rgb(139, 92, 246)"],borderWidth:1}]},i={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,max:100}},plugins:{legend:{display:!1}}};return a.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx(Tr,{className:"w-5 h-5 text-green-600 mr-2"}),a.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Performance Metrics"})]}),a.jsx("div",{className:"h-64 mb-4",children:a.jsx(e0e,{data:r,options:i})}),a.jsx("div",{className:"grid grid-cols-3 gap-2",children:s.map(o=>a.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded-lg",children:[a.jsx("div",{className:"text-xs text-gray-500 capitalize",children:o.metric}),a.jsxs("div",{className:"text-lg font-bold",children:[Math.round(o.value),"%"]})]},o.metric))})]})}$h.register(dR,hR,vxe,wxe,eR,lR,J_);function CR({slots:t}){const[e,s]=k.useState([]);k.useEffect(()=>{const i=_pe(t);s(i)},[t]);const n={labels:e.map(i=>{const o=new Date(i.date);return`${o.getDate()}/${o.getMonth()+1}`}),datasets:[{label:"Predicted Hours",data:e.map(i=>i.predictedHours),borderColor:"rgb(75, 192, 192)",backgroundColor:"rgba(75, 192, 192, 0.5)",tension:.3}]},r={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!1}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Hours"}}}};return a.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx(i1,{className:"w-5 h-5 text-purple-600 mr-2"}),a.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Workload Prediction"})]}),a.jsx("div",{className:"h-64",children:a.jsx(Qxe,{data:n,options:r})}),a.jsxs("div",{className:"mt-4 bg-purple-50 p-3 rounded-lg flex items-start",children:[a.jsx(Er,{className:"w-5 h-5 text-purple-600 mr-2 mt-0.5"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-purple-900",children:"AI Insight"}),a.jsx("p",{className:"text-sm text-purple-800 mt-1",children:"Based on historical trends, next week appears to have heavier workload on Tuesday and Thursday. Consider distributing tasks earlier in the week."})]})]})]})}function SR({slots:t,reps:e,selectedDate:s,onAttendanceUpdate:n}){const[r,i]=k.useState(null),[o,l]=k.useState(""),c=t.filter(h=>h.date===Bt(s,"yyyy-MM-dd")&&h.status==="reserved"),d=(h,p)=>{n(h.id,p,o),i(null),l("")},u=h=>{const p=e.find(f=>f.id===h);return p?p.name:"Unknown REP"};return c.length===0?a.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx(St,{className:"w-5 h-5 text-blue-600 mr-2"}),a.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Attendance Tracking"})]}),a.jsx("div",{className:"text-center py-8 text-gray-500",children:"No reserved slots for this date to track attendance"})]}):a.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx(St,{className:"w-5 h-5 text-blue-600 mr-2"}),a.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Attendance Tracking"})]}),a.jsx("div",{className:"space-y-3",children:c.map(h=>{const p=r===h.id;return a.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[a.jsxs("div",{className:`p-3 flex items-center justify-between cursor-pointer ${h.attended===!0?"bg-green-50":h.attended===!1?"bg-red-50":"bg-white"}`,onClick:()=>i(p?null:h.id),children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-medium",children:u(h.repId)}),a.jsxs("div",{className:"text-sm text-gray-600",children:[h.startTime," - ",h.endTime]})]}),a.jsxs("div",{className:"flex items-center",children:[h.attended===!0&&a.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[a.jsx(ht,{className:"w-3 h-3 mr-1"}),"Attended"]}),h.attended===!1&&a.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[a.jsx(fo,{className:"w-3 h-3 mr-1"}),"Missed"]}),h.attended===void 0&&a.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[a.jsx(Oc,{className:"w-3 h-3 mr-1"}),"Not Recorded"]})]})]}),p&&a.jsxs("div",{className:"p-3 border-t bg-gray-50",children:[a.jsxs("div",{className:"mb-3",children:[a.jsx("label",{htmlFor:"attendanceNotes",className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),a.jsx("textarea",{id:"attendanceNotes",value:o,onChange:f=>l(f.target.value),className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",rows:2,placeholder:"Add notes about attendance..."})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs("button",{onClick:()=>d(h,!0),className:"flex-1 py-2 px-4 bg-green-600 hover:bg-green-700 text-white rounded-md font-medium flex items-center justify-center",children:[a.jsx(ht,{className:"w-4 h-4 mr-2"}),"Mark Attended"]}),a.jsxs("button",{onClick:()=>d(h,!1),className:"flex-1 py-2 px-4 bg-red-600 hover:bg-red-700 text-white rounded-md font-medium flex items-center justify-center",children:[a.jsx(fo,{className:"w-4 h-4 mr-2"}),"Mark Missed"]})]})]})]},h.id)})})]})}function s0e({rep:t,slots:e}){const s=k.useMemo(()=>{const i=e.filter(x=>x.repId===t.id&&x.status==="reserved"&&x.attended!==void 0),o=i.length,l=i.filter(x=>x.attended===!0).length,c=new Date,d=gd(c),u=o0(c),h=i.filter(x=>{const y=new Date(x.date);return l0(y,{start:d,end:u})}),p=h.length,f=h.filter(x=>x.attended===!0).length,m=o>0?Math.round(l/o*100):0,b=p>0?Math.round(f/p*100):0;let g="Unknown";return o>=5&&(m>=95?g="Excellent":m>=85?g="Good":m>=75?g="Average":g="Needs Improvement"),{attendanceScore:m,currentMonthScore:b,totalTracked:o,attended:l,currentMonthTotal:p,currentMonthAttended:f,reliabilityTier:g}},[t,e]),n=i=>i>=90?"text-green-600":i>=80?"text-blue-600":i>=70?"text-yellow-600":"text-red-600",r=i=>{switch(i){case"Excellent":return"bg-green-100 text-green-800";case"Good":return"bg-blue-100 text-blue-800";case"Average":return"bg-yellow-100 text-yellow-800";case"Needs Improvement":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return a.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx(jr,{className:"w-5 h-5 text-blue-600 mr-2"}),a.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Attendance Scorecard"})]}),a.jsx("div",{className:"flex justify-center mb-6",children:a.jsx("div",{className:"w-32 h-32 rounded-full border-8 border-blue-100 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsxs("div",{className:`text-3xl font-bold ${n(s.attendanceScore)}`,children:[s.attendanceScore,"%"]}),a.jsx("div",{className:"text-sm text-gray-500",children:"Overall Score"})]})})}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[a.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg text-center",children:[a.jsx("div",{className:"text-sm text-gray-500",children:"Current Month"}),a.jsxs("div",{className:`text-xl font-bold ${n(s.currentMonthScore)}`,children:[s.currentMonthScore,"%"]}),a.jsxs("div",{className:"text-xs text-gray-500",children:[s.currentMonthAttended," of ",s.currentMonthTotal," sessions"]})]}),a.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg text-center",children:[a.jsx("div",{className:"text-sm text-gray-500",children:"Reliability Tier"}),a.jsx("div",{className:`text-sm font-medium px-2 py-1 rounded-full inline-block mt-1 ${r(s.reliabilityTier)}`,children:s.reliabilityTier})]})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center p-2 bg-green-50 rounded-lg",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(ht,{className:"w-4 h-4 text-green-600 mr-2"}),a.jsx("span",{className:"text-sm",children:"Sessions Attended"})]}),a.jsx("span",{className:"font-medium",children:s.attended})]}),a.jsxs("div",{className:"flex justify-between items-center p-2 bg-red-50 rounded-lg",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(fo,{className:"w-4 h-4 text-red-600 mr-2"}),a.jsx("span",{className:"text-sm",children:"Sessions Missed"})]}),a.jsx("span",{className:"font-medium",children:s.totalTracked-s.attended})]}),a.jsxs("div",{className:"flex justify-between items-center p-2 bg-blue-50 rounded-lg",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(hs,{className:"w-4 h-4 text-blue-600 mr-2"}),a.jsx("span",{className:"text-sm",children:"Total Tracked"})]}),a.jsx("span",{className:"font-medium",children:s.totalTracked})]})]}),s.totalTracked<5&&a.jsxs("div",{className:"mt-4 text-sm text-gray-500 bg-yellow-50 p-2 rounded-lg",children:[a.jsx(hs,{className:"w-4 h-4 text-yellow-600 inline mr-1"}),"Not enough data for reliable scoring (minimum 5 sessions)"]})]})}function jR({reps:t,slots:e}){const[s,n]=k.useState("month"),[r,i]=k.useState("score"),o=e.filter(h=>{const p=V6(h.date),f=new Date;if(s==="month"){const m=gd(f),b=o0(f);return l0(p,{start:m,end:b})}else if(s==="week"){const m=new Date(f);m.setDate(f.getDate()-f.getDay());const b=new Date(m);return b.setDate(m.getDate()+6),l0(p,{start:m,end:b})}return!0}),c=[...t.map(h=>{const p=o.filter(g=>g.repId===h.id&&g.status==="reserved"&&g.attended!==void 0),f=p.length,m=p.filter(g=>g.attended===!0).length,b=f>0?Math.round(m/f*100):0;return{...h,attendanceScore:b,totalTracked:f,attended:m}})].sort((h,p)=>r==="name"?h.name.localeCompare(p.name):(p.attendanceScore||0)-(h.attendanceScore||0)),d=h=>{const p=h||0;return p>=90?"text-green-600":p>=80?"text-blue-600":p>=70?"text-yellow-600":"text-red-600"},u=()=>{const h=["REP Name","Email","Attendance Score","Sessions Attended","Total Sessions","Specialties"],p=c.map(x=>[x.name,x.email,`${x.attendanceScore}%`,x.attended,x.totalTracked,x.specialties.join(", ")]),f=[h.join(","),...p.map(x=>x.join(","))].join(`
`),m=new Blob([f],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(m),g=document.createElement("a");g.setAttribute("href",b),g.setAttribute("download",`attendance_report_${Bt(new Date,"yyyy-MM-dd")}.csv`),g.click()};return a.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(is,{className:"w-5 h-5 text-blue-600 mr-2"}),a.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Attendance Report"})]}),a.jsxs("button",{onClick:u,className:"px-3 py-1 bg-blue-600 text-white rounded-md text-sm font-medium flex items-center",children:[a.jsx(Sl,{className:"w-4 h-4 mr-1"}),"Export"]})]}),a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Uc,{className:"w-4 h-4 text-gray-500"}),a.jsxs("select",{value:s,onChange:h=>n(h.target.value),className:"rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[a.jsx("option",{value:"all",children:"All Time"}),a.jsx("option",{value:"month",children:"This Month"}),a.jsx("option",{value:"week",children:"This Week"})]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("span",{className:"text-sm text-gray-500",children:"Sort by:"}),a.jsxs("select",{value:r,onChange:h=>i(h.target.value),className:"rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[a.jsx("option",{value:"score",children:"Attendance Score"}),a.jsx("option",{value:"name",children:"Name"})]})]})]}),a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[a.jsx("thead",{className:"bg-gray-50",children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"REP"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Attendance Score"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sessions"}),a.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Specialties"})]})}),a.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[c.map(h=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center",children:h.avatar?a.jsx("img",{src:h.avatar,alt:h.name,className:"h-10 w-10 rounded-full"}):a.jsx("span",{className:"text-gray-500 text-sm",children:h.name.charAt(0)})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:h.name}),a.jsx("div",{className:"text-sm text-gray-500",children:h.email})]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:`text-lg font-bold ${d(h.attendanceScore)}`,children:[h.attendanceScore,"%"]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:a.jsxs("div",{className:"flex items-center",children:[a.jsxs("div",{className:"flex items-center mr-2",children:[a.jsx(ht,{className:"w-4 h-4 text-green-500 mr-1"}),a.jsx("span",{className:"text-sm",children:h.attended})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx(fo,{className:"w-4 h-4 text-red-500 mr-1"}),a.jsx("span",{className:"text-sm",children:h.totalTracked-h.attended})]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:a.jsx("div",{className:"flex flex-wrap gap-1",children:h.specialties.map(p=>a.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs bg-gray-100",children:p},p))})})]},h.id)),c.length===0&&a.jsx("tr",{children:a.jsx("td",{colSpan:4,className:"px-6 py-4 text-center text-gray-500",children:"No attendance data available for the selected timeframe"})})]})]})})]})}const Ah="https://v25matchingbackend-production.up.railway.app/api",uo={getTimeSlots:async(t,e,s)=>{try{const n={};return t&&(n.agentId=t),e&&(n.gigId=e),s&&(n.date=s),(await Ae.get(`${Ah}/time-slots`,{params:n})).data}catch(n){throw console.error("Error fetching time slots:",n),n}},upsertTimeSlot:async t=>{try{return(await Ae.post(`${Ah}/time-slots`,t)).data}catch(e){throw console.error("Error saving time slot:",e),e}},deleteTimeSlot:async t=>{try{await Ae.delete(`${Ah}/time-slots/${t}`)}catch(e){throw console.error("Error deleting time slot:",e),e}},cancelTimeSlot:async t=>{try{return(await Ae.patch(`${Ah}/time-slots/${t}/cancel`)).data}catch(e){throw console.error("Error cancelling time slot:",e),e}},getGigAgents:async(t,e)=>{try{const s={};return e&&(s.status=e),(await Ae.get(`${Ah}/gig-agents/gigs/${t}/agents`,{params:s})).data}catch(s){throw console.error("Error fetching gig agents:",s),s}}},Dh="https://v25matchingbackend-production.up.railway.app/api",n0e={generateSlots:async t=>{try{return(await Ae.post(`${Dh}/slots/generate`,t)).data}catch(e){throw console.error("Error generating slots:",e),e}},getSlots:async(t,e)=>{try{const s={};return t&&(s.gigId=t),e&&(s.date=e),(await Ae.get(`${Dh}/slots`,{params:s})).data}catch(s){throw console.error("Error fetching slots:",s),s}},reserveSlot:async(t,e,s)=>{try{return(await Ae.post(`${Dh}/slots/${t}/reserve`,{agentId:e,notes:s})).data}catch(n){throw console.error("Error reserving slot:",n),n}},cancelReservation:async t=>{try{return(await Ae.delete(`${Dh}/slots/reservations/${t}`)).data}catch(e){throw console.error("Error cancelling reservation:",e),e}},getReservations:async(t,e)=>{try{const s={};return t&&(s.agentId=t),e&&(s.gigId=e),(await Ae.get(`${Dh}/slots/reservations`,{params:s})).data}catch(s){throw console.error("Error fetching reservations:",s),s}}};function r0e({gigId:t,onSlotsGenerated:e}){const s=()=>{try{return Bt(new Date,"yyyy-MM-dd")}catch(v){return console.error("Error formatting default date:",v),new Date().toISOString().split("T")[0]}},[n,r]=k.useState(s()),[i,o]=k.useState(s()),[l,c]=k.useState(1),[d,u]=k.useState(1),[h,p]=k.useState(9),[f,m]=k.useState(18),[b,g]=k.useState(!1),[x,y]=k.useState(null);if(!t||t==="")return a.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 text-center text-gray-500 text-sm",children:"Select a gig to generate slots"});const w=async()=>{if(!t||t===""){y({text:"Please select a gig first",type:"error"});return}try{if(!n||!i){y({text:"Please select start and end dates",type:"error"});return}if(new Date(n)>new Date(i)){y({text:"End date must be after start date",type:"error"});return}if(h>=f){y({text:"End hour must be after start hour",type:"error"});return}if(l<=0||d<=0){y({text:"Duration and capacity must be greater than 0",type:"error"});return}g(!0),y(null);const v={gigId:t,startDate:n,endDate:i,slotDuration:l,capacity:d,startHour:h,endHour:f},N=await n0e.generateSlots(v);N&&N.message?y({text:N.message,type:"success"}):y({text:"Slots generated successfully",type:"success"}),e&&setTimeout(()=>{try{e()}catch(C){console.error("Error in onSlotsGenerated callback:",C)}y(null)},2e3)}catch(v){console.error("Error generating slots:",v),y({text:v.response?.data?.message||v.message||"Failed to generate slots",type:"error"})}finally{g(!1)}};return a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx(Er,{className:"w-5 h-5 text-blue-600"}),a.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Generate Slots"})]}),a.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Automatically create available time slots for this gig based on the parameters below."}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Start Date"}),a.jsx("input",{type:"date",value:n,onChange:v=>r(v.target.value),min:s(),className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-3 py-2 text-sm font-medium text-gray-800"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"End Date"}),a.jsx("input",{type:"date",value:i,onChange:v=>o(v.target.value),min:n,className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-3 py-2 text-sm font-medium text-gray-800"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Slot Duration (hours)"}),a.jsxs("select",{value:l,onChange:v=>c(parseFloat(v.target.value)),className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-3 py-2 text-sm font-medium text-gray-800",children:[a.jsx("option",{value:"0.5",children:"30 minutes"}),a.jsx("option",{value:"1",children:"1 hour"}),a.jsx("option",{value:"1.5",children:"1.5 hours"}),a.jsx("option",{value:"2",children:"2 hours"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Capacity (reps per slot)"}),a.jsx("input",{type:"number",value:d,onChange:v=>u(parseInt(v.target.value)||1),min:1,max:50,className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-3 py-2 text-sm font-medium text-gray-800"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Start Hour"}),a.jsx("select",{value:h,onChange:v=>p(parseInt(v.target.value)),className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-3 py-2 text-sm font-medium text-gray-800",children:Array.from({length:12},(v,N)=>N+6).map(v=>a.jsxs("option",{value:v,children:[v,":00"]},v))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"End Hour"}),a.jsx("select",{value:f,onChange:v=>m(parseInt(v.target.value)),className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-3 py-2 text-sm font-medium text-gray-800",children:Array.from({length:12},(v,N)=>N+6).map(v=>a.jsxs("option",{value:v,children:[v,":00"]},v))})]})]}),x&&a.jsxs("div",{className:`mt-4 p-3 rounded-xl flex items-center gap-2 ${x.type==="success"?"bg-emerald-50 text-emerald-800 border border-emerald-200":"bg-red-50 text-red-800 border border-red-200"}`,children:[x.type==="success"?a.jsx(ht,{className:"w-5 h-5"}):a.jsx(hs,{className:"w-5 h-5"}),a.jsx("span",{className:"text-sm font-medium",children:x.text})]}),a.jsx("button",{onClick:w,disabled:b||!t,className:"mt-4 w-full py-3 bg-blue-600 text-white rounded-xl text-sm font-semibold hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:b?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Generating..."]}):a.jsxs(a.Fragment,{children:[a.jsx(Er,{className:"w-4 h-4"}),"Generate Slots"]})})]})}const i0e=t=>{let e=0;for(let n=0;n<t.length;n++)e=t.charCodeAt(n)+((e<<5)-e);const s=(e&16777215).toString(16).toUpperCase();return"#"+"00000".substring(0,6-s.length)+s},_h=t=>{const e=t.agentId&&typeof t.agentId=="object"?t.agentId:null,s=t.gigId&&typeof t.gigId=="object"?t.gigId:null,n=t._id?.$oid||t._id?.toString()||crypto.randomUUID(),r=e?._id||e?.$oid||t.agentId?.toString()||t.repId?.toString()||"",i=s?._id||s?.$oid||t.gigId?.toString()||"";return{id:n,startTime:t.startTime,endTime:t.endTime,date:t.date,gigId:i,repId:r,status:t.status,duration:t.duration||1,notes:t.notes,attended:t.attended,attendanceNotes:t.attendanceNotes,agent:e,gig:s}},o0e=t=>{const e=t._id?.$oid||t._id?.toString()||crypto.randomUUID();return{id:e,name:t.title,description:t.description,company:t.companyName||"Unknown Company",color:i0e(e),skills:t.requiredSkills?.map(s=>typeof s=="string"?s:s.name)||[],priority:"medium"}},IR=[{id:"1",name:"Alex Johnson",email:"alex@harx.com",avatar:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80",specialties:["Customer Support","Technical Troubleshooting"],performanceScore:87,preferredHours:{start:9,end:17},attendanceScore:92,attendanceHistory:[]},{id:"2",name:"Jamie Smith",email:"jamie@harx.com",avatar:"https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80",specialties:["Sales","Product Demos"],performanceScore:92,preferredHours:{start:8,end:16},attendanceScore:85,attendanceHistory:[]},{id:"3",name:"Taylor Wilson",email:"taylor@harx.com",avatar:"https://images.unsplash.com/photo-1519345182560-3f2917c472ef?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80",specialties:["Training","Onboarding"],performanceScore:78,preferredHours:{start:10,end:18},attendanceScore:78,attendanceHistory:[]},{id:"4",name:"Morgan Lee",email:"morgan@harx.com",avatar:"https://images.unsplash.com/photo-1531427186611-ecfd6d936c79?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80",specialties:["Technical Support","Product Expertise"],performanceScore:85,preferredHours:{start:9,end:17},attendanceScore:88,attendanceHistory:[]}],ER=[{id:"1",name:"Tech Co",logo:"https://images.unsplash.com/photo-1551288049-bebda4e38f71?ixlib=rb-1.2.1&auto=format&fit=crop&w=128&h=128&q=80",priority:3},{id:"2",name:"Marketing Inc",logo:"https://images.unsplash.com/photo-1551288049-bebda4e38f71?ixlib=rb-1.2.1&auto=format&fit=crop&w=128&h=128&q=80",priority:2},{id:"3",name:"Acme Corp",logo:"https://images.unsplash.com/photo-1551288049-bebda4e38f71?ixlib=rb-1.2.1&auto=format&fit=crop&w=128&h=128&q=80",priority:1}];function a0e(){const[t,e]=k.useState(new Date),[s,n]=k.useState([]),[r,i]=k.useState(null),[o,l]=k.useState(null),[c]=k.useState("company"),[d,u]=k.useState(IR[0].id),[h,p]=k.useState(null),[f,m]=k.useState(!1),[b,g]=k.useState(!1),[x,y]=k.useState(!1),[w,v]=k.useState(IR),[N,C]=k.useState([]),[j,I]=k.useState(!0),[T,E]=k.useState(""),[$,D]=k.useState("09:00"),[P,_]=k.useState("10:00"),[O,R]=k.useState(!1);k.useEffect(()=>{const H=async()=>{const F=De.get("companyId");if(!F){l({message:"Company ID not found. Gigs cannot be loaded.",type:"error"}),I(!1);return}try{I(!0);const re=await Ae.get(`https://v25gigsmanualcreationbackend-production.up.railway.app/api/gigs/company/${F}`),te=re.data.data||re.data;if(Array.isArray(te)){const ce=te.map(o0e);C(ce),ce.length>0&&p(ce[0].id),console.log(`Loaded ${ce.length} gigs`)}}catch(ee){console.error("Error fetching gigs:",ee),l({message:"Failed to load Gigs",type:"error"})}finally{I(!1)}};(async()=>{const F=await Epe();m(F)})(),H()},[c]),k.useEffect(()=>{(async()=>{if(h)try{I(!0);const ue=await uo.getGigAgents(h);if(ue&&ue.length>0){const te=ue.map(ce=>{const Se=ce.agentId&&typeof ce.agentId=="object"?ce.agentId:ce,Pe=Se?._id||Se?.$oid||Se?.toString()||"",$e=Se.personalInfo||{},rt=Se.professionalSummary||{};return{id:Pe,name:$e.name||Se.name||Se.fullName||"Unknown Agent",email:$e.email||Se.email||"",avatar:$e.photo?.url||Se.avatar||Se.photo?.url||"",specialties:rt.currentRole?[rt.currentRole]:Se.specialties||[],performanceScore:Se.performanceScore||85,preferredHours:Se.preferredHours||{start:9,end:17},attendanceScore:Se.attendanceScore||90,attendanceHistory:[]}});v(te),te.length>0&&!te.find(ce=>ce.id===d)&&u(te[0].id),te.length>0&&!te.find(ce=>ce.id===T)&&E(te[0].id)}else E("");const F=await uo.getTimeSlots(void 0,h),ee=Array.isArray(F)?F.map(_h):[];n(ee);const re=[];ee.forEach(te=>{if(te.agent&&te.agent._id){const ce=te.agent,Se=ce.personalInfo||{},Pe=ce.professionalSummary||{},$e=ce?._id||ce?.$oid||ce?.toString()||"";!w.find(rt=>rt.id===$e)&&!re.find(rt=>rt.id===$e)&&re.push({id:$e,name:Se.name||ce.name||ce.fullName||"Unknown Agent",email:Se.email||ce.email||"",avatar:Se.photo?.url||ce.avatar||ce.photo?.url||"",specialties:Pe.currentRole?[Pe.currentRole]:ce.specialties||[],performanceScore:ce.performanceScore||85,preferredHours:ce.preferredHours||{start:9,end:17},attendanceScore:ce.attendanceScore||90,attendanceHistory:[]})}}),re.length>0&&v(te=>{const ce=[...te];return re.forEach(Se=>{ce.find(Pe=>Pe.id===Se.id)||ce.push(Se)}),ce})}catch(ue){console.error("Error fetching gig data:",ue)}finally{I(!1)}})()},[h,t]);const X=k.useMemo(()=>w.find(H=>H.id===d)||w[0],[d,w]),L=k.useMemo(()=>{const H={totalHours:0,projectBreakdown:{},availableSlots:0,reservedSlots:0};return(c==="rep"?s.filter(F=>F.repId===d):s).forEach(F=>{F.status!=="cancelled"&&(H.totalHours+=F.duration||1,F.status==="available"?H.availableSlots++:F.status==="reserved"&&H.reservedSlots++,F.gigId&&(H.projectBreakdown[F.gigId]=(H.projectBreakdown[F.gigId]||0)+(F.duration||1)))}),H},[s,c,d]),K=async H=>{let ue;if(H.id){const F=s.find(ee=>ee.id===H.id);F?ue={...F,...H}:ue={...H,repId:H.repId||d}}else if(r)ue={...r,...H};else return;try{await uo.upsertTimeSlot(ue);const F=await uo.getTimeSlots(d),ee=Array.isArray(F)?F.map(_h):[];n(ee),l({message:H.id?"Time slot updated successfully":"New time slot created",type:"success"})}catch(F){console.error("Error saving slot:",F),l({message:"Failed to save time slot",type:"error"})}setTimeout(()=>l(null),3e3)},B=async H=>{try{await uo.cancelTimeSlot(H);const ue=await uo.getTimeSlots(d),F=Array.isArray(ue)?ue.map(_h):[];n(F),l({message:"Time slot cancelled",type:"success"})}catch(ue){console.error("Error cancelling slot:",ue),l({message:"Failed to cancel time slot",type:"error"})}setTimeout(()=>l(null),3e3),r?.id===H&&i(null)},G=H=>{i(H)},de=Bt(t,"yyyy-MM-dd")<Bt(new Date,"yyyy-MM-dd"),ae=async()=>{if(!h||!T){l({message:"Select a gig and a rep",type:"error"}),setTimeout(()=>l(null),3e3);return}if(de){l({message:"Cannot create slots for past dates",type:"error"}),setTimeout(()=>l(null),3e3);return}const H=parseInt($.split(":")[0],10),ue=parseInt(P.split(":")[0],10);if(ue<=H){l({message:"End time must be after start time",type:"error"}),setTimeout(()=>l(null),3e3);return}const F=Bt(t,"yyyy-MM-dd"),ee=[];for(let re=H;re<ue;re++)ee.push({repId:T,gigId:h,date:F,startTime:`${re.toString().padStart(2,"0")}:00`,endTime:`${(re+1).toString().padStart(2,"0")}:00`,duration:1,status:"reserved",notes:""});R(!0);try{await Promise.all(ee.map(ce=>uo.upsertTimeSlot(ce)));const re=await uo.getTimeSlots(void 0,h),te=Array.isArray(re)?re.map(_h):[];n(te),l({message:`${ee.length} slot(s) created for this gig`,type:"success"})}catch(re){console.error("Error creating slots:",re),l({message:"Failed to create slots",type:"error"})}finally{R(!1)}setTimeout(()=>l(null),3e3)},ve=H=>{const ue=X.preferredHours?.start||9,F=`${ue.toString().padStart(2,"0")}:00`,ee=s.find(re=>re.date===Bt(t,"yyyy-MM-dd")&&re.startTime===F&&re.repId===d);K(ee?{...ee,gigId:H,status:"reserved"}:{id:crypto.randomUUID(),startTime:F,endTime:`${(ue+1).toString().padStart(2,"0")}:00`,date:Bt(t,"yyyy-MM-dd"),status:"reserved",duration:1,gigId:H,repId:d})},Ne=H=>{const ue=document.getElementById(`time-slot-${H}`);ue&&ue.scrollIntoView({behavior:"smooth"});const F=`${H.toString().padStart(2,"0")}:00`,ee=s.find(re=>re.date===Bt(t,"yyyy-MM-dd")&&re.startTime===F&&re.repId===d);ee?i(ee):(K({id:crypto.randomUUID(),startTime:F,endTime:`${(H+1).toString().padStart(2,"0")}:00`,date:Bt(t,"yyyy-MM-dd"),status:"available",duration:1,repId:d}),i({id:crypto.randomUUID(),startTime:F,endTime:`${(H+1).toString().padStart(2,"0")}:00`,date:Bt(t,"yyyy-MM-dd"),status:"available",duration:1,repId:d}))},le=(H,ue,F)=>{n(re=>re.map(te=>te.id===H?{...te,attended:ue,attendanceNotes:F}:te));const ee=s.find(re=>re.id===H);if(ee){const re=w.findIndex(te=>te.id===ee.repId);if(re>=0){const te=w[re],ce={date:ee.date,slotId:H,attended:ue,reason:F},Se={...te,attendanceHistory:[...te.attendanceHistory||[],ce]},Pe=Se.attendanceHistory.filter(q=>q.attended).length,$e=Se.attendanceHistory.length,rt=$e>0?Math.round(Pe/$e*100):0;Se.attendanceScore=rt,v(q=>[...q.slice(0,re),Se,...q.slice(re+1)])}}l({message:`Attendance ${ue?"confirmed":"marked as missed"}`,type:"success"}),setTimeout(()=>l(null),3e3)};return a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[o&&a.jsxs("div",{className:`fixed top-4 right-4 z-50 px-4 py-3 rounded-xl shadow-lg flex items-center gap-2 ${o.type==="success"?"bg-emerald-50 text-emerald-800 border border-emerald-200":"bg-red-50 text-red-800 border border-red-200"}`,children:[a.jsx(hs,{className:"w-5 h-5 shrink-0"}),a.jsx("p",{className:"font-medium",children:o.message})]}),a.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6 space-y-6",children:[a.jsxs("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[a.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2.5 bg-blue-50 rounded-xl",children:a.jsx(Ai,{className:"w-7 h-7 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Session Planning"}),a.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:"Schedule and manage time slots"})]}),j&&a.jsx("span",{className:"text-xs text-blue-500 font-medium animate-pulse",children:"Loading Gigs..."})]}),a.jsxs("div",{className:"flex items-center gap-6",children:[a.jsxs("div",{className:"flex items-center gap-3 px-4 py-2.5 bg-gray-50 rounded-xl border border-gray-100",children:[a.jsx(St,{className:"w-5 h-5 text-blue-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"Weekly Hours"}),a.jsxs("p",{className:"text-lg font-bold text-gray-900",children:[L.totalHours,"h"]})]})]}),a.jsxs("div",{className:"flex items-center gap-3 px-4 py-2.5 bg-gray-50 rounded-xl border border-gray-100",children:[a.jsx(Ir,{className:"w-5 h-5 text-indigo-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 font-medium",children:"Active Gigs"}),a.jsx("p",{className:"text-lg font-bold text-gray-900",children:Object.keys(L.projectBreakdown).length})]})]})]})]}),a.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 flex flex-wrap gap-2",children:[a.jsxs("button",{onClick:()=>g(!b),className:`px-4 py-2 rounded-xl text-sm font-medium flex items-center gap-2 ${b?"bg-purple-100 text-purple-800":"bg-gray-50 text-gray-600 hover:bg-gray-100 border border-gray-100"}`,children:[a.jsx(ia,{className:"w-4 h-4"}),"AI Assistant ",b?"On":"Off"]}),a.jsxs("button",{onClick:()=>y(!x),className:`px-4 py-2 rounded-xl text-sm font-medium flex items-center gap-2 ${x?"bg-emerald-100 text-emerald-800":"bg-gray-50 text-gray-600 hover:bg-gray-100 border border-gray-100"}`,children:[a.jsx(St,{className:"w-4 h-4"}),"Attendance ",x?"On":"Off"]})]})]}),a.jsx("main",{className:"space-y-6",children:c==="company"?a.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[a.jsx("div",{className:"flex space-x-2 overflow-x-auto pb-2 no-scrollbar",children:N.length===0?a.jsx("div",{className:"text-gray-500 italic px-4 py-3 bg-white rounded-xl border border-dashed border-gray-200 w-full text-center text-sm",children:"No active gigs found."}):N.map(H=>a.jsx("button",{onClick:()=>p(H.id),className:`px-4 py-2.5 rounded-xl whitespace-nowrap text-sm font-medium transition-all ${h===H.id?"bg-blue-600 text-white shadow-sm":"bg-white text-gray-600 hover:bg-gray-50 border border-gray-200"}`,children:H.name},H.id))}),a.jsx("div",{className:"grid grid-cols-1 gap-6",children:a.jsx(Bk,{selectedDate:t,onDateSelect:e,slots:s,view:"2-weeks"})}),h&&a.jsxs(a.Fragment,{children:[a.jsx(r0e,{gigId:h||void 0,onSlotsGenerated:()=>{if(!h)return;(async()=>{try{const ue=await uo.getTimeSlots(void 0,h),F=Array.isArray(ue)?ue.map(_h):[];n(F)}catch(ue){console.error("Error refreshing slots:",ue)}})()}}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[a.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-4",children:"Create slots (by gig)"}),a.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Create reserved slots for a rep on the selected date. Slots are linked to the current gig."}),w.length===0?a.jsx("p",{className:"text-sm text-amber-600",children:"No reps enrolled in this gig. Enroll agents to create slots."}):a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 items-end",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Rep"}),a.jsx("select",{value:T,onChange:H=>E(H.target.value),className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-3 py-2 text-sm font-medium text-gray-800",children:w.map(H=>a.jsx("option",{value:H.id,children:H.name},H.id))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Start time"}),a.jsx("select",{value:$,onChange:H=>D(H.target.value),className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-3 py-2 text-sm font-medium text-gray-800",children:Array.from({length:11},(H,ue)=>ue+8).map(H=>{const ue=`${H.toString().padStart(2,"0")}:00`;return a.jsx("option",{value:ue,children:ue},ue)})})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"End time"}),a.jsx("select",{value:P,onChange:H=>_(H.target.value),className:"w-full rounded-xl border border-gray-200 bg-gray-50 px-3 py-2 text-sm font-medium text-gray-800",children:Array.from({length:11},(H,ue)=>ue+8).map(H=>{const ue=`${H.toString().padStart(2,"0")}:00`;return a.jsx("option",{value:ue,children:ue},ue)})})]}),a.jsx("button",{type:"button",onClick:ae,disabled:O||de,className:"py-2.5 px-4 rounded-xl bg-blue-600 text-white text-sm font-semibold hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:O?"Creating":"Create slots"})]}),de&&a.jsx("p",{className:"text-xs text-amber-600 mt-2",children:"Cannot create slots for past dates."})]})]}),h&&a.jsx(cU,{company:N.find(H=>H.id===h)?.name||"",slots:s,projects:N.filter(H=>H.id===h).map(H=>({...H,company:H.name})),reps:w,selectedDate:t}),x&&a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsx(SR,{slots:s,reps:w,selectedDate:t,onAttendanceUpdate:le}),a.jsx(jR,{reps:w,slots:s})]}),b&&a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 border-l-4 border-purple-500",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx(ia,{className:"w-6 h-6 text-purple-600 mr-2"}),a.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"AI Insights"})]}),a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:a.jsx(CR,{slots:s})})]})]}):c==="rep"?a.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[a.jsx(lU,{reps:w,selectedRepId:d,onSelectRep:u}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsx("div",{className:"lg:col-span-2",children:a.jsx(Bk,{selectedDate:t,onDateSelect:e,slots:s.filter(H=>H.repId===d),view:"2-weeks"})}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[a.jsx("h2",{className:"text-base font-semibold text-gray-900 mb-4",children:"Weekly Overview"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center text-sm",children:[a.jsx("span",{className:"text-gray-500",children:"Available Slots"}),a.jsx("span",{className:"font-semibold text-gray-900",children:L.availableSlots})]}),a.jsxs("div",{className:"flex justify-between items-center text-sm",children:[a.jsx("span",{className:"text-gray-500",children:"Reserved Slots"}),a.jsx("span",{className:"font-semibold text-gray-900",children:L.reservedSlots})]}),a.jsx("hr",{className:"my-4 border-gray-100"}),a.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Gig Hours"}),Object.entries(L.projectBreakdown).map(([H,ue])=>{const F=N.find(ee=>ee.id===H);return a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:F?.color||"#ccc"}}),a.jsx("span",{className:"text-gray-600",children:F?.name||"Unknown Gig"})]}),a.jsxs("span",{className:"font-medium",children:[ue,"h"]})]},H)}),a.jsx("hr",{className:"my-4 border-gray-100"}),a.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Quick Reserve"}),a.jsx(aU,{slot:r||s[0]||{},availableProjects:N,onUpdate:K,onClear:()=>B(r?.id||"")})]})]})]}),x&&a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsx(s0e,{rep:X,slots:s}),a.jsx(SR,{slots:s.filter(H=>H.repId===d),reps:w,selectedDate:t,onAttendanceUpdate:le})]}),b&&a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[a.jsx("div",{children:a.jsx(Rpe,{rep:X,projects:N,slots:s,onSelectProject:ve})}),a.jsx("div",{children:a.jsx(Ppe,{rep:X,slots:s,onSelectHour:Ne})}),a.jsx("div",{children:a.jsx(t0e,{rep:X,slots:s})})]}),a.jsx(oU,{selectedSlotId:r?.id||null,slots:s.filter(H=>H.repId===d),projects:N,onSlotClick:H=>G(s.find(ue=>ue.id===H))})]}):a.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Admin Dashboard"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl border border-blue-100",children:[a.jsx("h3",{className:"text-sm font-medium text-blue-800 mb-1",children:"Total REPs"}),a.jsx("p",{className:"text-2xl font-bold text-blue-900",children:w.length})]}),a.jsxs("div",{className:"bg-emerald-50 p-4 rounded-xl border border-emerald-100",children:[a.jsx("h3",{className:"text-sm font-medium text-emerald-800 mb-1",children:"Total Companies"}),a.jsx("p",{className:"text-2xl font-bold text-emerald-900",children:ER.length})]}),a.jsxs("div",{className:"bg-purple-50 p-4 rounded-xl border border-purple-100",children:[a.jsx("h3",{className:"text-sm font-medium text-purple-800 mb-1",children:"Total Gigs"}),a.jsx("p",{className:"text-2xl font-bold text-purple-900",children:N.length})]})]})]}),x&&a.jsx(jR,{reps:w,slots:s}),b&&a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsx(CR,{slots:s}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[a.jsx(ia,{className:"w-5 h-5 text-purple-600 mr-2"}),a.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"AI Insights"})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"p-4 bg-purple-50 rounded-xl border border-purple-100",children:[a.jsx("h3",{className:"text-sm font-medium text-purple-800 mb-2",children:"Scheduling Efficiency"}),a.jsxs("p",{className:"text-sm text-gray-700",children:["Based on current scheduling patterns, the system is operating at",a.jsx("span",{className:"font-bold text-purple-800",children:" 78% "}),"efficiency. Consider optimizing REP assignments based on AI recommendations."]})]}),a.jsxs("div",{className:"p-4 bg-blue-50 rounded-xl border border-blue-100",children:[a.jsx("h3",{className:"text-sm font-medium text-blue-800 mb-2",children:"Resource Allocation"}),a.jsxs("p",{className:"text-sm text-gray-700",children:["Tech Co projects are currently overallocated by",a.jsx("span",{className:"font-bold text-blue-800",children:" 12% "}),"while Acme Corp is underallocated. Consider rebalancing resources."]})]}),a.jsxs("div",{className:"p-4 bg-emerald-50 rounded-xl border border-emerald-100",children:[a.jsx("h3",{className:"text-sm font-medium text-emerald-800 mb-2",children:"Performance Insights"}),a.jsxs("p",{className:"text-sm text-gray-700",children:["REPs with diverse project assignments show",a.jsx("span",{className:"font-bold text-green-800",children:" 23% higher "}),"satisfaction scores. Consider rotating assignments more frequently."]})]})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"REP Overview"}),a.jsx("div",{className:"space-y-4",children:w.map(H=>{const ue=s.filter(ee=>ee.repId===H.id&&ee.status==="reserved"),F=ue.reduce((ee,re)=>ee+(re.duration||1),0);return a.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl border border-gray-100",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center mr-3",children:H.avatar?a.jsx("img",{src:H.avatar,alt:H.name,className:"w-full h-full rounded-full object-cover"}):a.jsx(tr,{className:"w-5 h-5 text-gray-500"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium",children:H.name}),a.jsx("p",{className:"text-sm text-gray-500",children:H.email})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("p",{className:"text-lg font-bold",children:[F,"h"]}),a.jsxs("p",{className:"text-sm text-gray-500",children:[ue.length," slots"]}),H.performanceScore&&a.jsxs("div",{className:"mt-1 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800",children:["Score: ",H.performanceScore]}),H.attendanceScore&&a.jsxs("div",{className:"mt-1 ml-1 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",children:["Attendance: ",H.attendanceScore,"%"]})]})]},H.id)})})]}),a.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Company Overview"}),a.jsx("div",{className:"space-y-4",children:ER.map(H=>{const ue=s.filter(re=>N.find(ce=>ce.id===re.gigId)?.company===H.name&&re.status==="reserved"),F=ue.reduce((re,te)=>re+(te.duration||1),0),ee=new Set(ue.map(re=>re.repId)).size;return a.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl border border-gray-100",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center mr-3",children:H.logo?a.jsx("img",{src:H.logo,alt:H.name,className:"w-full h-full rounded-full object-cover"}):a.jsx(Ai,{className:"w-5 h-5 text-gray-500"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium",children:H.name}),a.jsxs("p",{className:"text-sm text-gray-500",children:[ee," REPs assigned"]})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("p",{className:"text-lg font-bold",children:[F,"h"]}),a.jsxs("p",{className:"text-sm text-gray-500",children:[ue.length," slots"]}),H.priority&&a.jsxs("div",{className:"mt-1 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-purple-100 text-purple-800",children:["Priority: ",H.priority]})]})]},H.id)})})]})]})]})})]})]})}const l0e=({gig:t,onBack:e})=>{const s=n=>{switch(n.toLowerCase()){case"active":return"bg-green-100 text-green-800 border-green-200";case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"completed":return"bg-blue-100 text-blue-800 border-blue-200";case"cancelled":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center justify-between",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("button",{onClick:e,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-900 transition-colors",children:[a.jsx(ra,{size:16}),"Back to Gigs"]}),a.jsx("div",{className:"h-6 w-px bg-gray-300"}),a.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["View: ",t.title]})]})}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:a.jsx(is,{className:"h-6 w-6 text-blue-600"})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Basic Information"})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Ys,{className:"h-4 w-4 text-blue-500"}),a.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Gig Title"})]}),a.jsx("p",{className:"text-gray-900 font-medium",children:t.title})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(is,{className:"h-4 w-4 text-blue-500"}),a.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Description"})]}),a.jsx("p",{className:"text-gray-700 leading-relaxed",children:t.description||"No description available"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(jr,{className:"h-4 w-4 text-purple-500"}),a.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Category"})]}),a.jsx("p",{className:"text-gray-900 font-medium",children:t.category||"Not specified"})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Ks,{className:"h-4 w-4 text-indigo-500"}),a.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Status"})]}),a.jsx("div",{className:`inline-block px-3 py-1 rounded-full text-sm font-semibold border ${s(t.status)}`,children:t.status})]})]})]})]}),t.seniority&&a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-purple-50 to-violet-50 border border-purple-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:a.jsx(jr,{className:"h-6 w-6 text-purple-600"})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Seniority Requirements"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-purple-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Ys,{className:"h-4 w-4 text-purple-500"}),a.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Seniority Level"})]}),a.jsx("p",{className:"text-gray-900 font-medium",children:t.seniority.level||"Not specified"})]}),a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-purple-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(St,{className:"h-4 w-4 text-violet-500"}),a.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Years of Experience"})]}),a.jsxs("p",{className:"text-gray-900 font-medium",children:[t.seniority.yearsExperience||"0"," years"]})]})]})]}),t.commission&&a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:a.jsx(Gg,{className:"h-6 w-6 text-blue-600"})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Commission Structure"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Commission details and structure"})]})]}),a.jsx("div",{className:"bg-white rounded-lg p-4 border border-blue-100",children:a.jsxs("div",{className:"space-y-3",children:[t.commission.base&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Base Type:"}),a.jsx("span",{className:"font-medium text-gray-900",children:t.commission.base})]}),t.commission.baseAmount&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Base Amount:"}),a.jsxs("span",{className:"font-medium text-gray-900",children:[t.commission.baseAmount," ",t.commission.currency?.symbol||""]})]}),t.commission.bonus&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Bonus Type:"}),a.jsx("span",{className:"font-medium text-gray-900",children:t.commission.bonus})]}),t.commission.bonusAmount&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Bonus Amount:"}),a.jsxs("span",{className:"font-medium text-gray-900",children:[t.commission.bonusAmount," ",t.commission.currency?.symbol||""]})]}),t.commission.transactionCommission?.amount&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Transaction Commission:"}),a.jsxs("span",{className:"font-medium text-gray-900",children:[t.commission.transactionCommission.amount," ",t.commission.currency?.symbol||""]})]}),t.commission.structure&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Structure:"}),a.jsx("span",{className:"font-medium text-gray-900",children:t.commission.structure})]}),t.commission.additionalDetails&&a.jsxs("div",{className:"pt-3 border-t border-gray-200",children:[a.jsx("span",{className:"text-sm text-gray-600",children:"Additional Details:"}),a.jsx("p",{className:"text-sm text-gray-900 mt-1",children:t.commission.additionalDetails})]})]})})]})}),t.team&&a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-pink-50 to-rose-50 border border-pink-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"p-2 bg-pink-100 rounded-lg",children:a.jsx(tr,{className:"h-6 w-6 text-pink-600"})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Team Structure"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.team.size&&a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-pink-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(tr,{className:"h-4 w-4 text-pink-500"}),a.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Team Size"})]}),a.jsxs("p",{className:"text-gray-900 font-medium",children:[t.team.size," members"]})]}),t.team.territories&&t.team.territories.length>0&&a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-pink-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Zr,{className:"h-4 w-4 text-rose-500"}),a.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Territories"})]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:t.team.territories.map((n,r)=>a.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-rose-50 rounded-full border border-rose-200",children:[a.jsx("img",{src:n.flags.png,alt:n.flags.alt,className:"w-4 h-3 rounded-sm"}),a.jsx("span",{className:"text-sm font-medium text-rose-800",children:n.name.common})]},r))})]})]})]}),t.skills&&a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-purple-50 to-indigo-50 border border-purple-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:a.jsx(Ys,{className:"h-6 w-6 text-purple-600"})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Skills & Requirements"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.skills.professional&&t.skills.professional.length>0&&a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-purple-100",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Professional Skills"}),a.jsx("div",{className:"space-y-2",children:t.skills.professional.map((n,r)=>a.jsxs("div",{className:"flex items-center justify-between p-2 bg-purple-50 rounded-lg",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-purple-900",children:n.skill.name}),a.jsx("p",{className:"text-xs text-purple-600",children:n.skill.category})]}),a.jsxs("span",{className:"text-xs bg-purple-200 text-purple-800 px-2 py-1 rounded-full",children:["Level ",n.level]})]},r))})]}),t.skills.technical&&t.skills.technical.length>0&&a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-purple-100",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Technical Skills"}),a.jsx("div",{className:"space-y-2",children:t.skills.technical.map((n,r)=>a.jsxs("div",{className:"flex items-center justify-between p-2 bg-indigo-50 rounded-lg",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-indigo-900",children:n.skill.name}),a.jsx("p",{className:"text-xs text-indigo-600",children:n.skill.category})]}),a.jsxs("span",{className:"text-xs bg-indigo-200 text-indigo-800 px-2 py-1 rounded-full",children:["Level ",n.level]})]},r))})]}),t.skills.soft&&t.skills.soft.length>0&&a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-purple-100",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Soft Skills"}),a.jsx("div",{className:"space-y-2",children:t.skills.soft.map((n,r)=>a.jsxs("div",{className:"flex items-center justify-between p-2 bg-pink-50 rounded-lg",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-pink-900",children:n.skill.name}),a.jsx("p",{className:"text-xs text-pink-600",children:n.skill.category})]}),a.jsxs("span",{className:"text-xs bg-pink-200 text-pink-800 px-2 py-1 rounded-full",children:["Level ",n.level]})]},r))})]}),t.skills.languages&&t.skills.languages.length>0&&a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-purple-100",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Languages"}),a.jsx("div",{className:"space-y-2",children:t.skills.languages.map((n,r)=>a.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded-lg",children:[a.jsxs("div",{children:[a.jsx("span",{className:"text-sm font-medium text-green-900",children:n.language.name}),a.jsx("p",{className:"text-xs text-green-600",children:n.language.nativeName})]}),a.jsx("span",{className:"text-xs bg-green-200 text-green-800 px-2 py-1 rounded-full",children:n.proficiency})]},r))})]})]})]}),t.destination_zone&&a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-emerald-50 to-teal-50 border border-emerald-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg",children:a.jsx(Zr,{className:"h-6 w-6 text-emerald-600"})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Destination Zone"})]}),a.jsx("div",{className:"bg-white rounded-lg p-4 border border-emerald-100",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("img",{src:t.destination_zone.flags.png,alt:t.destination_zone.flags.alt,className:"w-12 h-8 rounded-md border border-gray-200"}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.destination_zone.name.common}),a.jsx("p",{className:"text-sm text-gray-600",children:t.destination_zone.name.official}),a.jsxs("p",{className:"text-xs text-gray-500",children:["Code: ",t.destination_zone.cca2]})]})]})})]}),t.availability&&a.jsxs("div",{className:"rounded-xl bg-gradient-to-br from-cyan-50 to-blue-50 border border-cyan-100 shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[a.jsx("div",{className:"p-2 bg-cyan-100 rounded-lg",children:a.jsx(St,{className:"h-6 w-6 text-cyan-600"})}),a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Schedule & Availability"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[t.availability.minimumHours&&a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-cyan-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(St,{className:"h-4 w-4 text-cyan-500"}),a.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Minimum Hours"})]}),a.jsxs("div",{className:"space-y-1",children:[a.jsxs("p",{className:"text-sm text-gray-900",children:["Daily: ",a.jsxs("span",{className:"font-medium",children:[t.availability.minimumHours.daily,"h"]})]}),a.jsxs("p",{className:"text-sm text-gray-900",children:["Weekly: ",a.jsxs("span",{className:"font-medium",children:[t.availability.minimumHours.weekly,"h"]})]}),a.jsxs("p",{className:"text-sm text-gray-900",children:["Monthly: ",a.jsxs("span",{className:"font-medium",children:[t.availability.minimumHours.monthly,"h"]})]})]})]}),t.availability.time_zone&&a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-cyan-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Ks,{className:"h-4 w-4 text-cyan-500"}),a.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Time Zone"})]}),a.jsx("p",{className:"text-gray-900 font-medium",children:t.availability.time_zone.zoneName}),a.jsxs("p",{className:"text-sm text-gray-600",children:[t.availability.time_zone.countryName," (",t.availability.time_zone.countryCode,")"]})]}),t.availability.flexibility&&t.availability.flexibility.length>0&&a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-cyan-100",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(Qn,{className:"h-4 w-4 text-blue-500"}),a.jsx("label",{className:"text-sm font-semibold text-gray-700",children:"Flexibility"})]}),a.jsx("p",{className:"text-gray-900 font-medium",children:t.availability.flexibility.join(", ")})]})]}),t.availability.schedule&&t.availability.schedule.length>0&&a.jsxs("div",{className:"bg-white rounded-lg p-4 border border-cyan-100",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Working Schedule"}),a.jsx("div",{className:"space-y-3",children:t.availability.schedule.map((n,r)=>a.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(St,{className:"h-4 w-4 text-cyan-500"}),a.jsx("span",{className:"text-sm font-medium text-gray-900",children:n.day})]}),a.jsxs("span",{className:"text-sm text-gray-600",children:[n.hours.start," - ",n.hours.end]})]},r))})]})]})]})]})},c0e=()=>{const[t,e]=k.useState([]),[s,n]=k.useState(!0),[r,i]=k.useState(null),[o,l]=k.useState(null),c=De.get("companyId");console.log("GigDetails render - selectedGig:",o),k.useEffect(()=>{(async()=>{if(!c){i("Company ID not found"),n(!1);return}try{const b=await Ae.get(`undefined/gigs/company/${c}`);e(b.data.data)}catch(b){i("Failed to fetch gigs"),console.error("Error fetching gigs:",b)}finally{n(!1)}})()},[c]);const d=m=>{if(!m)return{bg:"bg-white/30",text:"text-indigo-900",border:"border-white/40"};switch(m.toLowerCase()){case"active":return{bg:"bg-white/30",text:"text-blue-900",border:"border-white/40"};case"pending":return{bg:"bg-white/30",text:"text-yellow-900",border:"border-white/40"};case"completed":return{bg:"bg-white/30",text:"text-green-900",border:"border-white/40"};case"cancelled":return{bg:"bg-white/30",text:"text-red-900",border:"border-white/40"};default:return{bg:"bg-white/30",text:"text-indigo-900",border:"border-white/40"}}},u=()=>"from-blue-500 via-indigo-500 to-purple-500",h=m=>{if(!m)return"Not specified";const b=m.currency?.symbol||"";return m.transactionCommission?.amount?`${m.transactionCommission.amount} ${b}`:m.bonusAmount?`${m.bonusAmount} ${b}`:m.base||"Not specified"},p=m=>{if(!m)return"Not specified";if(m.schedule&&m.schedule.length>0){const b=m.schedule.length;return`${b} day${b>1?"s":""}/week`}return"Flexible"};if(s)return a.jsx("div",{className:"flex items-center justify-center p-8",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})});if(r)return a.jsx("div",{className:"p-6 text-red-600 bg-red-50 rounded-xl border border-red-200",children:a.jsxs("div",{className:"flex items-center",children:[a.jsx("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),r]})});if(o)return console.log("Rendering GigDetailsView with gig:",o),a.jsx(l0e,{gig:o,onBack:()=>l(null)});const f=async(m,b)=>{m.preventDefault(),m.stopPropagation();try{await Ae.delete(`undefined/gigs/${b}`),e(x=>x.filter(y=>y._id!==b)),ka.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}).fire({icon:"success",title:"Gig deleted successfully"})}catch(g){console.error("Error deleting gig:",g),ka.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3}).fire({icon:"error",title:"Failed to delete gig"})}};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Gig Details"}),a.jsx("div",{className:"flex items-center gap-4",children:a.jsxs("button",{className:"flex items-center gap-2 bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500 hover:from-indigo-600 hover:to-purple-600 text-white font-bold px-5 py-2 rounded-full shadow-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-400",onClick:()=>{window.location.href="/app6"},children:[a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),"Add gig"]})})]}),t.length===0?a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:a.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No gigs found"}),a.jsx("p",{className:"text-gray-500",children:"No gigs have been created for this company yet."})]}):a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map((m,b)=>{const g=d(m.status);return a.jsxs("div",{className:`group relative overflow-hidden rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 bg-gradient-to-br ${u()}`,children:[a.jsxs("div",{className:"p-6 text-white",children:[a.jsxs("div",{className:"flex items-start justify-between mb-4",children:[a.jsx("h3",{className:"text-lg font-bold leading-tight line-clamp-2 flex-1",children:m.title}),a.jsx("div",{className:`ml-3 px-3 py-1 rounded-full text-xs font-semibold ${g.bg} ${g.text} border ${g.border} flex-shrink-0`,children:m.status})]}),m.category&&a.jsx("div",{className:"mb-3",children:a.jsx("span",{className:"inline-block bg-white/20 text-white px-2 py-1 rounded-md text-xs font-medium",children:m.category})}),a.jsx("p",{className:"text-white/90 text-sm leading-relaxed mb-4 overflow-hidden",style:{display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",lineHeight:"1.4",maxHeight:"4.2em"},children:m.description||"No description available"}),a.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[m.seniority&&m.seniority.level&&a.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[a.jsx("div",{className:"text-white/70 text-xs font-medium mb-1",children:"Seniority"}),a.jsxs("div",{className:"text-white text-sm font-semibold",children:[m.seniority.level," (",m.seniority.yearsExperience||"0","y)"]})]}),m.commission&&a.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[a.jsx("div",{className:"text-white/70 text-xs font-medium mb-1",children:"Commission"}),a.jsx("div",{className:"text-white text-sm font-semibold",children:h(m.commission)})]}),m.availability&&a.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[a.jsx("div",{className:"text-white/70 text-xs font-medium mb-1",children:"Availability"}),a.jsx("div",{className:"text-white text-sm font-semibold",children:p(m.availability)})]}),m.team&&m.team.size&&a.jsxs("div",{className:"bg-white/10 rounded-lg p-3",children:[a.jsx("div",{className:"text-white/70 text-xs font-medium mb-1",children:"Team Size"}),a.jsxs("div",{className:"text-white text-sm font-semibold",children:[m.team.size," members"]})]})]}),a.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-white/20",children:[a.jsxs("div",{className:"flex items-center text-white/80 text-xs",children:[a.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),m.createdAt?new Date(m.createdAt).toLocaleDateString():"Date unknown"]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{className:"bg-red-500/20 hover:bg-red-500/40 text-white p-2 rounded-lg transition-all duration-200 relative z-20",onClick:x=>f(x,m._id),title:"Delete Gig",children:a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}),a.jsx("button",{className:"bg-white/20 hover:bg-white/30 text-white px-3 py-1 rounded-lg text-xs font-medium transition-all duration-200 relative z-10",onClick:x=>{x.preventDefault(),x.stopPropagation(),console.log("View Details clicked for gig:",m),console.log("Setting selectedGig to:",m),l(m)},children:"View Details"})]})]})]}),a.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-300 pointer-events-none"})]},m._id)})})]})},d0e=()=>{const[t,e]=k.useState("product"),[s,n]=k.useState(""),[r,i]=k.useState(!1),[o,l]=k.useState([]),c=De.get("companyId"),d="https://v25searchcompanywizardbackend-production.up.railway.app/api";k.useEffect(()=>{c&&u()},[c]),k.useEffect(()=>{c&&h()&&!r&&(console.log(" Knowledge base data changed, checking if step should be auto-completed..."),u())},[o,c,r]);const u=async()=>{try{if(!c)return;console.log(" Checking step 7 status for company:",c);const b=await Ae.get(`${d}/onboarding/companies/${c}/onboarding/phases/2/steps/7`);if(console.log(" API response for step 7:",b.data),b.data&&b.data.status==="completed"){console.log(" Step 7 is already completed according to API"),i(!0);return}const g=localStorage.getItem("companyOnboardingProgress");if(g)try{const x=JSON.parse(g);if(x.completedSteps&&Array.isArray(x.completedSteps)&&x.completedSteps.includes(7)){console.log(" Step 7 found in localStorage, setting as completed"),i(!0);return}}catch(x){console.error(" Error parsing stored progress:",x)}if(h()&&!r){console.log(" Auto-completing step 7 locally because basic info is present"),i(!0);const x=[7],y={currentPhase:2,completedSteps:x,lastUpdated:new Date().toISOString()};localStorage.setItem("companyOnboardingProgress",JSON.stringify(y)),De.set("knowledgeBaseStepCompleted","true",{expires:7}),window.dispatchEvent(new CustomEvent("stepCompleted",{detail:{stepId:7,phaseId:2,status:"completed",completedSteps:x}})),console.log(" Step 7 marked as completed locally and parent component notified")}}catch(b){console.error(" Error checking step status:",b);const g=localStorage.getItem("companyOnboardingProgress");if(g)try{const x=JSON.parse(g);x.completedSteps&&Array.isArray(x.completedSteps)&&x.completedSteps.includes(7)&&i(!0)}catch(x){console.error(" Error parsing stored progress:",x)}}},h=()=>{const b=f.flatMap(x=>x.articles.filter(y=>y.status==="published")),g=b.length>=3;return console.log(" Checking basic info for KnowledgeBase:",{publishedArticles:b.length,hasInfo:g}),g},p=async()=>{try{if(!c){console.error(" No companyId available");return}console.log(" Completing knowledge base setup...");const b=await Ae.put(`${d}/onboarding/companies/${c}/onboarding/phases/2/steps/7`,{status:"completed"});console.log(" Step 7 marked as completed:",b.data),i(!0);const g={currentPhase:2,completedSteps:[7],lastUpdated:new Date().toISOString()};localStorage.setItem("companyOnboardingProgress",JSON.stringify(g)),De.set("knowledgeBaseStepCompleted","true",{expires:7}),window.dispatchEvent(new CustomEvent("stepCompleted",{detail:{stepId:7,phaseId:2,status:"completed",completedSteps:[7]}})),console.log(" Knowledge base setup completed and step 7 marked as completed")}catch(b){console.error(" Error completing knowledge base setup:",b)}},f=[{id:"product",title:"Product Information",articles:[{id:1,title:"Product Overview",content:"Comprehensive overview of our product features and benefits...",lastUpdated:"2 days ago",status:"published"},{id:2,title:"Technical Specifications",content:"Detailed technical specifications and requirements...",lastUpdated:"1 week ago",status:"draft"}]},{id:"objections",title:"Common Objections",articles:[{id:3,title:"Price Concerns",content:"How to handle pricing objections and demonstrate value...",lastUpdated:"3 days ago",status:"published"},{id:4,title:"Competition Comparison",content:"Key differentiators from competitors...",lastUpdated:"5 days ago",status:"published"}]},{id:"faq",title:"Frequently Asked Questions",articles:[{id:5,title:"General FAQs",content:"Common questions about our services...",lastUpdated:"1 day ago",status:"published"},{id:6,title:"Technical FAQs",content:"Technical support and troubleshooting questions...",lastUpdated:"4 days ago",status:"published"}]}],m=b=>{e(t===b?null:b)};return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Knowledge Base"}),r&&a.jsxs("div",{className:"flex items-center gap-2 bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium",children:[a.jsx(Yr,{className:"w-4 h-4"}),"Completed"]})]}),a.jsx("p",{className:"text-sm text-gray-500",children:"Create and manage training materials for REPS"})]}),a.jsxs("div",{className:"flex space-x-3",children:[a.jsxs("button",{className:"flex items-center rounded-lg bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50",children:[a.jsx(r4,{className:"mr-2 h-4 w-4"}),"New Section"]}),r?a.jsxs("button",{className:"flex items-center rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white shadow-sm cursor-not-allowed",children:[a.jsx(Yr,{className:"mr-2 h-4 w-4"}),"Setup Completed"]}):a.jsxs("button",{onClick:p,className:"flex items-center rounded-lg bg-green-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-green-700",disabled:!h(),children:[a.jsx(ht,{className:"mr-2 h-4 w-4"}),"Complete Setup"]}),a.jsxs("button",{className:"flex items-center rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",children:[a.jsx(Xs,{className:"mr-2 h-4 w-4"}),"New Article"]})]})]}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:a.jsx(Il,{className:"h-5 w-5 text-gray-400"})}),a.jsx("input",{type:"text",className:"block w-full rounded-lg border-gray-300 pl-10 focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:"Search knowledge base...",value:s,onChange:b=>n(b.target.value)})]})}),a.jsxs("select",{className:"rounded-lg border-gray-300 py-2 pl-3 pr-10 text-sm focus:border-indigo-500 focus:outline-none focus:ring-indigo-500",children:[a.jsx("option",{children:"All Categories"}),a.jsx("option",{children:"Product Information"}),a.jsx("option",{children:"Common Objections"}),a.jsx("option",{children:"FAQs"})]})]}),a.jsx("div",{className:"space-y-4",children:f.map(b=>a.jsxs("div",{className:"rounded-lg bg-white shadow",children:[a.jsxs("div",{className:"flex cursor-pointer items-center justify-between p-4",onClick:()=>m(b.id),children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"rounded-full bg-indigo-100 p-2 text-indigo-600",children:a.jsx(Ti,{className:"h-5 w-5"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900",children:b.title}),a.jsxs("p",{className:"text-sm text-gray-500",children:[b.articles.length," articles"]})]})]}),t===b.id?a.jsx(Lc,{className:"h-5 w-5 text-gray-400"}):a.jsx(Cl,{className:"h-5 w-5 text-gray-400"})]}),t===b.id&&a.jsxs("div",{className:"border-t border-gray-200",children:[b.articles.map(g=>a.jsx("div",{className:"border-b border-gray-200 p-4 last:border-b-0",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx(is,{className:"mt-1 h-5 w-5 text-gray-400"}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:g.title}),a.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:[g.content.substring(0,100),"..."]}),a.jsxs("div",{className:"mt-2 flex items-center space-x-4 text-xs text-gray-500",children:[a.jsxs("span",{children:["Last updated ",g.lastUpdated]}),a.jsxs("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-xs font-medium ${g.status==="published"?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:[g.status==="published"?a.jsx(ht,{className:"mr-1 h-3 w-3"}):a.jsx(hs,{className:"mr-1 h-3 w-3"}),g.status]})]})]})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("button",{className:"rounded-md p-1 text-gray-400 hover:bg-gray-100 hover:text-gray-500",children:a.jsx(Oh,{className:"h-4 w-4"})}),a.jsx("button",{className:"rounded-md p-1 text-gray-400 hover:bg-gray-100 hover:text-gray-500",children:a.jsx(po,{className:"h-4 w-4"})}),a.jsx("button",{className:"rounded-md p-1 text-gray-400 hover:bg-gray-100 hover:text-red-500",children:a.jsx(er,{className:"h-4 w-4"})})]})]})},g.id)),a.jsx("div",{className:"bg-gray-50 p-4",children:a.jsxs("button",{className:"flex w-full items-center justify-center rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-100",children:[a.jsx(Xs,{className:"mr-2 h-4 w-4"}),"Add Article to ",b.title]})})]})]},b.id))}),a.jsxs("div",{className:"rounded-lg bg-indigo-50 p-6",children:[a.jsx("h3",{className:"text-lg font-medium text-indigo-900",children:"Knowledge Base Best Practices"}),a.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[a.jsx("div",{className:"rounded-lg bg-white p-4 shadow-sm",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"rounded-full bg-green-100 p-2 text-green-600",children:a.jsx(ht,{className:"h-5 w-5"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Keep It Updated"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Regularly review and update content to ensure accuracy"})]})]})}),a.jsx("div",{className:"rounded-lg bg-white p-4 shadow-sm",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"rounded-full bg-blue-100 p-2 text-blue-600",children:a.jsx(_i,{className:"h-5 w-5"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Clear Communication"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Use simple language and provide examples"})]})]})}),a.jsx("div",{className:"rounded-lg bg-white p-4 shadow-sm",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:"rounded-full bg-purple-100 p-2 text-purple-600",children:a.jsx(Oh,{className:"h-5 w-5"})}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"Easy Access"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Organize content logically for quick reference"})]})]})})]})]})]})},u0e=()=>{const[t,e]=k.useState(1),[s,n]=k.useState(1),[r,i]=k.useState([]),[o,l]=k.useState(null),[c,d]=k.useState(!1),[u,h]=k.useState(!1);k.useEffect(()=>{const F=localStorage.getItem("parsedLeads"),ee=sessionStorage.getItem("uploadContactsManuallyClosed");F&&!ee&&s>=2&&!u&&(console.log(" Restoring UploadContacts view - parsed leads exist and phase allows it"),h(!0)),console.log(" UploadContacts restoration check:",{hasParsedLeads:!!F,wasManuallyClosed:!!ee,displayedPhase:s,showUploadContacts:u,shouldRestore:F&&!ee&&s>=2&&!u})},[s]),k.useEffect(()=>{s<2&&u&&(console.log(" Cleaning parsed leads - current phase too early:",s),localStorage.removeItem("parsedLeads"),h(!1))},[s,u]),k.useEffect(()=>{u||(sessionStorage.setItem("uploadContactsManuallyClosed","true"),console.log(" Set manual close flag - preventing auto-restoration"))},[u]);const[p,f]=k.useState(!0),[m,b]=k.useState(!1),[g,x]=k.useState(!1),[y,w]=k.useState(null),[v,N]=k.useState(!1),C=De.get("userId"),j="https://v25searchcompanywizardbackend-production.up.railway.app/api";k.useEffect(()=>{(async()=>{if(!C){console.error("User ID not found in cookies"),window.location.href="/auth";return}try{const ee=await Ae.get(`${j}/companies/user/${C}`);ee.data.success&&ee.data.data?(w(ee.data.data._id),De.set("companyId",ee.data.data._id),console.log(" Company ID fetched and stored:",ee.data.data._id)):console.error("No company data found for user:",C)}catch(ee){console.error("Error fetching company ID:",ee)}})()},[C]),k.useEffect(()=>{y&&(console.log(" Company ID available, loading progress and checking gigs..."),D(),T(),P())},[y]),k.useEffect(()=>{const F=ee=>{if(ee.data.type==="STEP_COMPLETED"){console.log("Received step completion message:",ee.data);const{stepId:re,phaseId:te,data:ce}=ee.data;i(Se=>Se.includes(re)?Se:[...Se,re]),D(),console.log(` Step ${re} completed successfully`)}};return window.addEventListener("message",F),()=>{window.removeEventListener("message",F)}},[]),k.useEffect(()=>{const F=re=>{const{stepId:te,phaseId:ce,status:Se,completedSteps:Pe}=re.detail;if(console.log(" Step completion event received:",{stepId:te,phaseId:ce,status:Se,completedSteps:Pe}),Pe&&Array.isArray(Pe)){i(Pe);const $e={currentPhase:ce,completedSteps:Pe,lastUpdated:new Date().toISOString()};localStorage.setItem("companyOnboardingProgress",JSON.stringify($e)),console.log(" Local state updated from step completion event"),setTimeout(()=>{console.log(" Reloading onboarding progress after step completion"),D()},500)}},ee=()=>{console.log(" Contacts upload completed - refreshing onboarding state"),h(!1),sessionStorage.removeItem("uploadContactsManuallyClosed"),I(),setTimeout(()=>{D()},1e3)};return window.addEventListener("stepCompleted",F),window.addEventListener("contactsUploadCompleted",ee),()=>{window.removeEventListener("stepCompleted",F),window.removeEventListener("contactsUploadCompleted",ee)}},[]),k.useEffect(()=>{if(!y)return;const F=setInterval(()=>{I()},1e4);return()=>clearInterval(F)},[y,r]);const I=async()=>{try{if(!y||r.includes(6))return;const F=await Ae.get(`undefined/leads/company/${y}/has-leads`);if(F.data.hasLeads&&F.data.count>0){console.log(" Company has leads - auto-completing step 6");try{await Ae.put(`${j}/onboarding/companies/${y}/onboarding/phases/2/steps/6`,{status:"completed"}),i(ee=>{if(!ee.includes(6)){const re=[...ee,6];console.log(" Step 6 auto-completed successfully - updating local state");const te={currentPhase:2,completedSteps:re,lastUpdated:new Date().toISOString()};return localStorage.setItem("companyOnboardingProgress",JSON.stringify(te)),re}return ee}),x(!0)}catch(ee){console.error("Error auto-completing step 6:",ee)}}}catch(F){console.error("Error checking company leads for auto-completion:",F)}};k.useEffect(()=>{new URLSearchParams(window.location.search).get("session")==="someGeneratedSessionId"&&y&&_(6)},[y]);const T=async()=>{try{if(!y){console.error(" Company ID not available for checking gigs");return}const ee=(await Ae.get(`undefined/gigs/company/${y}/has-gigs`)).data.data.hasGigs;if(b(ee),ee)try{await Ae.put(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${y}/onboarding/phases/2/steps/4`,{status:"completed"}),i(re=>[...re,4])}catch(re){console.error("Error updating onboarding progress:",re)}}catch(F){console.error("Error checking company gigs:",F)}},E=async()=>{try{if(!y){console.error(" Company ID not available for checking leads");return}const ee=(await Ae.get(`undefined/leads/company/${y}/has-leads`)).data.hasLeads;if(x(ee),ee){console.log(" Company has leads - auto-completing step 6");try{await Ae.put(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${y}/onboarding/phases/2/steps/6`,{status:"completed"}),i(re=>re.includes(6)?re:[...re,6]),console.log(" Step 6 auto-completed successfully")}catch(re){console.error("Error auto-completing step 6:",re)}}else console.log(" Company has no leads - step 6 needs manual completion")}catch(F){console.error("Error checking company leads:",F)}},$=async()=>{try{if(console.log(" Checking for active gigs..."),!y){console.error(" Company ID not available for checking active gigs");return}const F=await Ae.get(`undefined/gigs/company/${y}`);if(F.data&&F.data.data){const ee=F.data.data,re=ee.some(te=>te.status==="active"||te.status==="approved"||te.status==="published");if(console.log(" Active gigs check:",{totalGigs:ee.length,hasActiveGig:re,gigStatuses:ee.map(te=>te.status)}),re)try{console.log(" Found active gig - completing last phase and step");const te=await Ae.put(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${y}/onboarding/complete-last`);if(te.data){console.log(" Last phase and step completed successfully:",te.data),i(Se=>{const Pe=[...Se];return Pe.includes(13)||Pe.push(13),Pe});const ce={currentPhase:4,completedSteps:[...r,13]};De.set("companyOnboardingProgress",JSON.stringify(ce)),console.log(" Step 13 marked as completed - active gig found")}}catch(te){console.error("Error completing last phase and step:",te)}else try{console.log(" No active gigs found - updating step 13 status"),t>=4&&await Ae.put(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${y}/onboarding/phases/4/steps/13`,{status:"in_progress"}),i(ce=>ce.filter(Se=>Se!==13)),console.log(" Step 13 removed from completed steps and marked as in_progress");const te={currentPhase:3,completedSteps:r.filter(ce=>ce!==13)};De.set("companyOnboardingProgress",JSON.stringify(te)),console.log(" Step 13 marked as in_progress - no active gigs found")}catch(te){console.error("Error updating onboarding progress for step 13:",te)}}}catch(F){console.error("Error checking active gigs:",F)}};k.useEffect(()=>{y&&(console.log(" Initial check for leads and gigs..."),E(),$())},[y]),k.useEffect(()=>{y&&(console.log(" Loading company progress on mount..."),D())},[y]);const D=async()=>{f(!0);try{if(!y){console.error(" Company ID not available for loading progress"),f(!1);return}const F=await Ae.get(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${y}/onboarding`),ee=F.data;console.log(" API Response:",F.data),console.log(" currentPhase from API:",ee.currentPhase),console.log(" completedSteps from API:",ee.completedSteps),De.set("companyOnboardingProgress",JSON.stringify(ee));const re=ce=>{const Se=G[ce-1];return Se?Se.steps.filter($e=>!$e.disabled).every($e=>ee.completedSteps.includes($e.id)):!1};let te=1;for(let ce=1;ce<=4;ce++)if(ce===1)te=1;else if(re(ce-1))te=ce,console.log(` Phase ${ce-1} is fully completed, allowing access to phase ${ce}`);else{console.log(` Phase ${ce-1} is not fully completed, stopping at phase ${te}`);break}ee.completedSteps.includes(7)&&te<3&&(re(2)?(te=3,console.log(" Step 7 completed and phase 2 is fully completed - setting phase to 3")):(console.log(" Step 7 completed but phase 2 is not fully completed - staying in phase 2"),te=2)),ee.completedSteps.includes(10)&&te<4&&(re(3)?(te=4,console.log(" Step 10 completed and phase 3 is fully completed - setting phase to 4")):(console.log(" Step 10 completed but phase 3 is not fully completed - staying in phase 3"),te=3)),ee.completedSteps.includes(13)&&te<4&&(re(3)?(te=4,console.log(" Step 13 completed and phase 3 is fully completed - setting phase to 4")):(console.log(" Step 13 completed but phase 3 is not fully completed - staying in phase 3"),te=3)),console.log(" Final valid phase determined:",te,"from API currentPhase:",ee.currentPhase),console.log(" Setting completed steps:",ee.completedSteps),e(te),n(te),i(ee.completedSteps),ee.completedSteps.includes(6)||setTimeout(()=>{I()},100),setTimeout(()=>{console.log(" Forcing re-render after state update"),e(ce=>ce)},50)}catch(F){console.error("Error loading company progress:",F),e(1),n(1),i([])}finally{f(!1)}},P=async()=>{try{ri.getInstance().isConfigured()&&console.log(" Zoho est configur - ready for manual upload")}catch(F){console.error("Error checking Zoho connection:",F)}},_=async F=>{if(!y){console.error("Company ID not available for starting step");return}try{if(r.includes(F))console.log(` Step ${F} is already completed, not changing status`);else{const ce=G.findIndex(Se=>Se.steps.some(Pe=>Pe.id===F))+1;await Ae.put(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${y}/onboarding/phases/${ce}/steps/${F}`,{status:"in_progress"}),console.log(` Step ${F} status updated to in_progress`)}const te=G.flatMap(ce=>ce.steps).find(ce=>ce.id===F);if(F===7){localStorage.setItem("activeTab","knowledge-base"),window.dispatchEvent(new CustomEvent("tabChange",{detail:{tab:"knowledge-base"}}));return}if(F===8){localStorage.setItem("activeTab","script-generator"),window.dispatchEvent(new CustomEvent("tabChange",{detail:{tab:"script-generator"}}));return}if(F===13){localStorage.setItem("activeTab","approval-publishing"),window.dispatchEvent(new CustomEvent("tabChange",{detail:{tab:"approval-publishing"}}));return}if(F===4){m||r.includes(4)?window.location.href="/app11":window.location.href="/app6";return}te?.component&&(F===5?d(!0):l(F))}catch(ee){console.error("Error updating step status:",ee),ee instanceof Error&&console.error("Error details:",ee.message)}},O=async F=>{if(!y){console.error("Company ID not available for reviewing step");return}try{console.log(` Reviewing step ${F} (already completed)`);const re=G.flatMap(te=>te.steps).find(te=>te.id===F);if(F===7){localStorage.setItem("activeTab","knowledge-base"),window.dispatchEvent(new CustomEvent("tabChange",{detail:{tab:"knowledge-base"}}));return}if(F===8){localStorage.setItem("activeTab","script-generator"),window.dispatchEvent(new CustomEvent("tabChange",{detail:{tab:"script-generator"}}));return}if(F===13){localStorage.setItem("activeTab","approval-publishing"),window.dispatchEvent(new CustomEvent("tabChange",{detail:{tab:"approval-publishing"}}));return}if(F===4){console.log(" Opening GigDetails for review"),N(!0);return}re?.component&&(F===5?d(!0):l(F))}catch(ee){console.error("Error reviewing step:",ee),ee instanceof Error&&console.error("Error details:",ee.message)}},R=async F=>{if(!y)return;const ee=te=>{const ce=G[te-1];return ce?ce.steps.filter(Pe=>!Pe.disabled).every(Pe=>r.includes(Pe.id)):!1};let re=!0;if(F>1){for(let te=1;te<F;te++)if(!ee(te)){console.log(` Cannot access phase ${F} - phase ${te} is not fully completed`),re=!1;break}}if(re){if(n(F),B(F)&&F<=t&&!X(F))try{await Ae.put(`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${y}/onboarding/current-phase`,{phase:F}),e(F),console.log(` Successfully changed to phase ${F}`)}catch(te){console.error("Error updating phase:",te)}}else console.log(` Cannot change to phase ${F} - previous phases not completed`),console.log(`Vous devez complter toutes les tapes de la phase prcdente avant d'accder  la phase ${F}`)},X=F=>G[F-1].steps.filter(re=>!re.disabled).every(re=>r.includes(re.id)),L=()=>{const F=Math.max(1,s-1);n(F)},K=()=>{const F=Math.min(4,s+1),ee=re=>{const te=G[re-1];return te?te.steps.filter(Se=>!Se.disabled).every(Se=>r.includes(Se.id)):!1};if(s<4)if(ee(s))console.log(` Phase ${s} is fully completed, proceeding to phase ${F}`),R(F);else{console.log(` Cannot proceed to phase ${F} - current phase ${s} is not fully completed`),console.log(`Vous devez complter toutes les tapes de la phase ${s} avant de passer  la phase suivante`);return}else s===4&&(window.location.href="/company#/company")},B=F=>F===1?!0:G[F-2].steps.filter(re=>!re.disabled).every(re=>r.includes(re.id)),G=[{id:1,title:"Company Account Setup & Identity",icon:Mc,color:"blue",steps:[{id:1,title:"Create Company Profile",description:"Legal and commercial details, key contacts, terms agreement",status:"completed",component:DB},{id:2,title:"KYC / KYB Verification",description:"Identity verification through Stripe Identity or Sumsub",status:"current",component:_B,disabled:!0},{id:3,title:"Subscription Plan",description:"Select plan: Free, Standard, or Premium",status:"pending",component:RB}]},{id:2,title:"Operational Setup",icon:Qn,color:"yellow",steps:[{id:4,title:"Create Gigs",description:"Define multi-channel gigs and requirements",status:"pending"},{id:5,title:"Telephony Setup",description:"Phone numbers, call tracking, and dialer configuration",status:"pending",component:bN},{id:6,title:"Upload Contacts",description:"Import contacts for multi-channel engagement",status:"pending",component:Sk},{id:7,title:"Knowledge Base",description:"Create training materials and FAQs",status:"pending",component:d0e},{id:8,title:"Call Script",description:"Define script and conversation flows",status:"pending",component:PB},{id:9,title:"Reporting Setup",description:"Configure KPIs and reporting preferences",status:"pending",component:FB,disabled:!0}]},{id:3,title:"REPS Engagement",icon:tr,color:"green",steps:[{id:10,title:"Match HARX REPS",description:"Connect with qualified REPS based on requirements",status:"pending",component:OB},{id:11,title:"REP Onboarding",description:"Training, validation, and contract acceptance",status:"pending",component:MB},{id:12,title:"Session Planning",description:"Schedule call slots and prioritize leads",status:"pending",component:a0e}]},{id:4,title:"Activation",icon:Kg,color:"red",steps:[{id:13,title:"Gig Activation",description:"Launch multi-channel operations",status:"pending",component:E2}]}],de=F=>{switch(F.id){case 1:return Mc;case 2:return Xg;case 3:return is;case 4:return _i;case 5:return oa;case 6:return Ri;case 7:return Ti;case 8:return is;case 9:return Yv;case 10:return tr;case 11:return Ti;case 12:return Er;case 13:return Kg;default:return ht}},ae=()=>{if(u){if(console.log(" Back to onboarding clicked while UploadContacts is active - cancelling processing"),window.cancelUploadProcessing){console.log(" Calling cancelUploadProcessing function");try{window.cancelUploadProcessing(),console.log(" cancelUploadProcessing executed successfully")}catch(F){if(console.error(" Error calling cancelUploadProcessing:",F),window.emergencyCancelUpload){console.log(" Trying emergency cancellation...");try{window.emergencyCancelUpload(),console.log(" Emergency cancellation executed successfully")}catch(ee){console.error(" Emergency cancellation also failed:",ee)}}}}else if(console.warn(" cancelUploadProcessing function not found on window"),window.emergencyCancelUpload){console.log(" Trying emergency cancellation as fallback...");try{window.emergencyCancelUpload(),console.log(" Emergency cancellation executed successfully")}catch(F){console.error(" Emergency cancellation failed:",F)}}localStorage.removeItem("parsedLeads"),localStorage.removeItem("validationResults"),localStorage.removeItem("uploadProcessing"),sessionStorage.removeItem("uploadProcessing"),sessionStorage.removeItem("parsedLeads"),sessionStorage.removeItem("validationResults"),console.log(" Removed all storage items"),h(!1),console.log(" Set showUploadContacts to false"),console.log(" Closing UploadContacts and returning to normal onboarding state");return}l(null)},ve=F=>{const re=G.flatMap($e=>$e.steps).find($e=>$e.id===F),te=G[t-1].steps,ce=te.findIndex($e=>$e.id===F),Pe=te.slice(0,ce).every($e=>$e.disabled||r.includes($e.id));if(F===4){r.includes(F)?N(!0):m?window.location.href="/app11":window.location.href="/app6";return}if(F===7){Pe&&(localStorage.setItem("activeTab","knowledge-base"),window.dispatchEvent(new CustomEvent("tabChange",{detail:{tab:"knowledge-base"}})));return}if(F===8){Pe&&(localStorage.setItem("activeTab","script-generator"),window.dispatchEvent(new CustomEvent("tabChange",{detail:{tab:"script-generator"}})));return}if(F===5){Pe&&d(!0);return}if(F===6){Pe&&(sessionStorage.getItem("uploadContactsManuallyClosed")?console.log(" UploadContacts was manually closed - not reopening"):(h(!0),console.log(" Opening UploadContacts via step click")));return}re?.component&&Pe&&!re.disabled&&l(F)};if(!C)return console.log("User ID not found, redirecting to /auth"),window.location.href="/auth",a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:"Redirecting to authentication..."})]})});const Ne=o?G.flatMap(F=>F.steps).find(F=>F.id===o)?.component:null;if(p)return a.jsx("div",{className:"flex items-center justify-center min-h-screen",children:a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"})});let le=null,H=()=>{};if(v?(le=a.jsx(c0e,{}),H=()=>{N(!1)}):c?(le=a.jsx(bN,{onBackToOnboarding:async()=>{if(d(!1),y)try{await D(),console.log(" Onboarding state reloaded successfully")}catch(F){console.error(" Error reloading onboarding state:",F)}}}),H=()=>{d(!1)}):u?(le=a.jsx(Sk,{}),H=()=>{localStorage.removeItem("parsedLeads"),localStorage.removeItem("validationResults"),localStorage.removeItem("uploadProcessing"),sessionStorage.removeItem("uploadProcessing"),sessionStorage.removeItem("parsedLeads"),sessionStorage.removeItem("validationResults"),sessionStorage.removeItem("uploadContactsManuallyClosed"),console.log(" Manual cleanup - UploadContacts closed"),h(!1)}):Ne&&(le=a.jsx(Ne,{}),H=ae),le)return a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center space-x-4",children:a.jsxs("button",{onClick:()=>{H()},className:"flex items-center transition-colors text-gray-600 hover:text-gray-900",children:[a.jsx(Fh,{className:"h-5 w-5 rotate-180"}),a.jsx("span",{children:"Back to Onboarding"})]})}),le]});const ue=G[s-1];return ue?a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Company Onboarding"}),a.jsx("button",{className:"rounded-lg bg-indigo-600 px-4 py-2 text-white hover:bg-indigo-700",children:"Save Progress"})]}),a.jsx("div",{className:"grid grid-cols-5 gap-4",children:G.map(F=>{const ee=F.icon,re=s===F.id,te=X(F.id),ce=B(F.id);return a.jsxs("div",{className:`relative rounded-lg p-4 ${re?"bg-indigo-50 border-2 border-indigo-500":te?"bg-green-50 border border-green-500":ce?"bg-white border border-gray-200":"bg-gray-50 border border-gray-300"} cursor-pointer`,onClick:()=>R(F.id),children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx("div",{className:`rounded-full p-2 ${re?"bg-indigo-100 text-indigo-600":te?"bg-green-100 text-green-600":ce?"bg-gray-100 text-gray-500":"bg-gray-200 text-gray-500"}`,children:a.jsx(ee,{className:"h-5 w-5"})}),a.jsxs("div",{children:[a.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["Phase ",F.id]}),a.jsx("p",{className:"text-xs text-gray-500",children:F.title}),!ce&&F.id>1&&a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Complete previous phase first"})]})]}),F.id<4&&a.jsx("div",{className:"absolute -right-2 top-1/2 -translate-y-1/2",children:a.jsx(Fh,{className:"h-4 w-4 text-gray-400"})})]},F.id)})}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsxs("div",{className:"mb-6",children:[a.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Phase ",ue.id,": ",ue.title]}),a.jsx("p",{className:"text-sm text-gray-500",children:B(ue.id)?"Complete the following steps to proceed to the next phase":"Complete all steps in the previous phase to unlock this phase"})]}),a.jsx("div",{className:"space-y-4",children:ue.steps.map(F=>{const ee=de(F),re=!!F.component||F.id===4,te=r.includes(F.id),ce=B(ue.id),Se=!te&&!F.disabled&&ue.steps.slice(0,ue.steps.findIndex($e=>$e.id===F.id)).every($e=>$e.disabled||r.includes($e.id)),Pe=ce&&(te||Se);return a.jsx("div",{className:`rounded-lg border p-4 ${!ce||!te&&!Se&&!F.disabled?"opacity-50 cursor-not-allowed border-gray-200 bg-gray-50":F.disabled?"opacity-50 cursor-not-allowed border-gray-200":te?"border-green-200 bg-green-50":Se?"border-indigo-200 bg-indigo-50 ring-2 ring-indigo-500":"border-gray-200 bg-white"} ${re&&!F.disabled&&Pe?"cursor-pointer hover:border-indigo-300":""}`,onClick:()=>re&&!F.disabled&&Pe&&ve(F.id),children:a.jsxs("div",{className:"flex items-start space-x-4",children:[a.jsx("div",{className:`rounded-full p-2 ${!ce||!te&&!Se&&!F.disabled||F.disabled?"bg-gray-200 text-gray-400":te?"bg-green-100 text-green-600":Se?"bg-indigo-100 text-indigo-600":"bg-gray-100 text-gray-500"}`,children:a.jsx(ee,{className:"h-5 w-5"})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-900",children:F.title}),ce?F.disabled?a.jsx("span",{className:"inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800",children:"Coming Soon"}):te?a.jsxs("span",{className:"inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800",children:[a.jsx(ht,{className:"mr-1 h-3 w-3"}),"Completed"]}):Se?a.jsxs("span",{className:"inline-flex items-center rounded-full bg-yellow-100 px-2.5 py-0.5 text-xs font-medium text-yellow-800",children:[a.jsx(hs,{className:"mr-1 h-3 w-3"}),"Current Step"]}):a.jsx("span",{className:"inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800",children:"Locked"}):a.jsx("span",{className:"inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-800",children:"Locked"})]}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:F.description}),re&&!F.disabled&&Pe&&a.jsx("button",{className:"mt-3 text-sm font-medium text-indigo-600 hover:text-indigo-500",onClick:$e=>{$e.stopPropagation(),te?O(F.id):_(F.id)},children:te?"Review Step":"Start Step"})]})]})},F.id)})}),a.jsxs("div",{className:"mt-6 flex justify-between",children:[a.jsx("button",{className:"rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50",disabled:s===1,onClick:L,children:"Previous Phase"}),a.jsx("button",{className:"rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",disabled:!1,onClick:K,children:"Next Phase"})]})]}),a.jsxs("div",{className:"rounded-lg bg-white p-6 shadow",children:[a.jsx("h2",{className:"mb-4 text-lg font-semibold text-gray-900",children:"Need Help?"}),a.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3",children:[a.jsxs("button",{className:"flex items-center justify-center rounded-lg border border-gray-200 p-4 hover:bg-gray-50",children:[a.jsx(_i,{className:"mr-2 h-5 w-5 text-indigo-600"}),a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Chat with Support"})]}),a.jsxs("button",{className:"flex items-center justify-center rounded-lg border border-gray-200 p-4 hover:bg-gray-50",children:[a.jsx(Ti,{className:"mr-2 h-5 w-5 text-indigo-600"}),a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"View Documentation"})]}),a.jsxs("button",{className:"flex items-center justify-center rounded-lg border border-gray-200 p-4 hover:bg-gray-50",children:[a.jsx(Er,{className:"mr-2 h-5 w-5 text-indigo-600"}),a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Schedule a Call"})]})]})]})]}):a.jsx("div",{className:"text-center text-red-600",children:"Error: Phase data not found. Please try refreshing the page."})},h0e=()=>{const[t,e]=k.useState(null),[s,n]=k.useState(null);return k.useEffect(()=>{(async()=>{try{const i=new URLSearchParams(window.location.search),o=i.get("code"),l=i.get("location"),c=i.get("accounts-server"),d=De.get("userId");if(!d)throw new Error("User ID not found");if(!o)throw new Error("Authorization code not found");const u=new URLSearchParams({code:o,userId:d,...l&&{location:l},...c&&{accountsServer:c}}).toString(),h=await fetch(`undefined/zoho/auth/callback?${u}`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${De.get("gigId")}:${d}`}});if(!h.ok){const f=await h.json();throw new Error(f.error||"Failed to exchange code for tokens")}const p=await h.json();if(console.log("Callback response:",p),!p.access_token||!p.refresh_token||!p.expires_in)throw new Error("Missing required fields in Zoho response");e(p.access_token),n(p.refresh_token),jt.success("Successfully connected to Zoho CRM"),setTimeout(()=>{window.location.href="/app11?startStep=6"},3e3)}catch(i){console.error("Error handling Zoho callback:",i),jt.error(i.message||"Failed to complete Zoho authentication"),setTimeout(()=>{window.location.href="/app11"},2e3)}})()},[]),a.jsx("div",{className:"flex min-h-screen items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Zoho Authentication Successful!"}),a.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"You will be redirected to the main application in a few seconds..."}),t&&a.jsxs("div",{className:"mt-4 p-4 bg-gray-100 rounded-lg",children:[a.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Access Token:"}),a.jsx("p",{className:"mt-1 text-xs text-gray-500 break-all",children:t}),a.jsx("p",{className:"mt-4 text-sm font-medium text-gray-700",children:"Refresh Token:"}),a.jsx("p",{className:"mt-1 text-xs text-gray-500 break-all",children:s})]})]})})},p0e=()=>{const[t,e]=k.useState(!0);return k.useEffect(()=>{(async()=>{try{const n=await fetch("undefined/zoho/auth",{method:"GET",headers:{Accept:"application/json"}});if(n.ok){const r=await n.json();window.location.href=r.authUrl}else throw new Error("Failed to get Zoho auth URL")}catch(n){console.error("Error initiating Zoho auth:",n),jt.error("Failed to initiate Zoho authentication"),e(!1)}})()},[]),a.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-50",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"mb-4 flex justify-center",children:a.jsx(t4,{className:"h-12 w-12 text-indigo-600"})}),a.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Connecting to Zoho CRM"}),a.jsx("p",{className:"mt-2 text-sm text-gray-500",children:t?"Please wait while we redirect you to Zoho's authentication page...":"There was an error connecting to Zoho. Please try again."}),!t&&a.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700",children:"Try Again"})]})})},Xr=Ae.create({baseURL:"http://localhost:3001/api"}),f0e=()=>{const[t,e]=k.useState("all"),[s,n]=k.useState(!1),[r,i]=k.useState("document"),[o,l]=k.useState(""),[c,d]=k.useState(""),[u,h]=k.useState(""),[p,f]=k.useState(null),[m,b]=k.useState(""),[g,x]=k.useState([]),[y,w]=k.useState([]),[v,N]=k.useState(!1),[C,j]=k.useState(!0);k.useState(""),k.useState("neutral"),k.useState([]);const[I,T]=k.useState(null),[E,$]=k.useState(!1),[D,P]=k.useState(0),[_,O]=k.useState(0),[R,X]=k.useState(null);k.useState({}),k.useState({});const[L,K]=k.useState({transcription:!0,sentiment:!0,insights:!0}),[B,G]=k.useState(null),[de,ae]=k.useState(!1),[ve,Ne]=k.useState(null),[le,H]=k.useState({}),[ue,F]=k.useState(!1),[ee,re]=k.useState(null),[te,ce]=k.useState({}),[Se,Pe]=k.useState({}),[$e,rt]=k.useState({}),[q,fe]=k.useState({}),[Fe,et]=k.useState({}),[Me,Xe]=k.useState({}),[it,Et]=k.useState(null),yt=5;k.useEffect(()=>{const ie=localStorage.getItem("knowledgeItems");ie&&x(JSON.parse(ie))},[]),k.useEffect(()=>{localStorage.setItem("knowledgeItems",JSON.stringify(g))},[g]);const xe=ie=>{switch(ie){case"document":return a.jsx(is,{size:20,className:"text-blue-500"});case"audio":return a.jsx(Wc,{size:20,className:"text-purple-500"});default:return a.jsx(s1,{size:20,className:"text-gray-500"})}},Ve=ie=>new Promise(be=>{const me=new Audio;me.src=URL.createObjectURL(ie),me.addEventListener("loadedmetadata",()=>{URL.revokeObjectURL(me.src),be(Math.round(me.duration/60))})}),qe=async ie=>{if(ie.target.files&&ie.target.files[0]){const be=ie.target.files[0];f(be),o||l(be.name)}},We=()=>{let ie;return console.log("Running in in-app mode"),ie=De.get("userId"),console.log("userId cookie:",ie),console.log("Verified saved user ID from cookie:",ie),ie},at=async()=>{try{const ie=De.get("companyId");if(console.log("Attempting to update onboarding progress for company:",ie),!ie)throw new Error("Company ID not found in cookies");const be="https://v25searchcompanywizardbackend-production.up.railway.app/api";console.log("Using API URL:",be);const me=`${be}/onboarding/companies/${ie}/onboarding/phases/2/steps/7`;console.log("Making request to endpoint:",me);const ze=await Ae.put(me,{status:"completed"});return console.log("Onboarding progress update response:",ze.data),ze.data&&(De.set("companyOnboardingProgress",JSON.stringify(ze.data),{expires:7}),console.log("Updated companyOnboardingProgress cookie with new data")),ze.data}catch(ie){throw console.error("Error updating onboarding progress:",ie),Ae.isAxiosError(ie)&&console.error("Axios error details:",{status:ie.response?.status,data:ie.response?.data,headers:ie.response?.headers}),ie}},Ct=async()=>{try{const ie=We();if(!ie)throw new Error("User ID not found");const be=await Xr.get("/documents",{params:{userId:ie}});console.log("Response fetching documents:",be);const me=be.data.documents.map(pt=>({id:pt._id,name:pt.name,description:pt.description,type:"document",fileUrl:pt.fileUrl,uploadedAt:Bt(new Date(pt.uploadedAt),"yyyy-MM-dd"),uploadedBy:pt.uploadedBy,tags:pt.tags,usagePercentage:0,isPublic:!0,analysis:pt.analysis})),ze=me.length>1;console.log("Documents count:",me.length),console.log("Has multiple documents:",ze),j(!ze),x(me);const Ge=me.reduce((pt,ys)=>(ys.analysis&&(pt[ys.id]=ys.analysis),pt),{});return H(Ge),ze}catch(ie){return console.error("Error fetching documents:",ie),j(!0),!1}};k.useEffect(()=>{Ct()},[]),k.useEffect(()=>{(async()=>{try{const be=We();if(!be)throw new Error("userId ID not found");const me=await Xr.get("/call-recordings",{params:{userId:be}});console.log("Response fetching call records:",me);const ze=me.data.callRecordings.map(Ge=>({id:Ge.id,contactId:Ge.contactId,date:Ge.date,duration:Ge.duration,recordingUrl:Ge.recordingUrl,transcriptUrl:"",summary:Ge.summary,sentiment:Ge.sentiment,tags:Ge.tags,aiInsights:Ge.aiInsights,repId:Ge.repId,companyId:Ge.companyId,processingOptions:{transcription:!0,sentiment:!0,insights:!0},audioState:{isPlaying:!1,currentTime:0,duration:Ge.duration||0,audioInstance:null,showPlayer:!1,showTranscript:!1}}));w(ze)}catch(be){console.error("Error fetching call records:",be)}})()},[]);const ut=async ie=>{ie.preventDefault(),N(!0);try{if(!p)throw new Error("No file selected");const be=We();if(!be)throw new Error("User ID not found");if(r==="document"){const me=new FormData;me.append("file",p),me.append("name",o),me.append("description",c),me.append("tags",m),me.append("uploadedBy","Current User"),me.append("userId",be);const ze=await Xr.post("/documents/upload",me);console.log("Document upload successful:",ze.data),await Ct(),console.log("Updating onboarding progress for document upload");try{await at(),console.log("Successfully updated onboarding progress")}catch(Ge){console.error("Failed to update onboarding progress:",Ge)}}else if(r==="audio"){const me=await Ve(p),ze=new FormData;ze.append("file",p),ze.append("contactId",o),ze.append("date",Bt(new Date,"yyyy-MM-dd")),ze.append("duration",me.toString()),ze.append("summary",c),ze.append("sentiment","neutral"),ze.append("tags",m),ze.append("aiInsights",""),ze.append("repId","current-user"),ze.append("userId",be);const Ge=await Xr.post("/call-recordings/upload",ze);console.log("Call recording upload successful:",Ge.data);const pt={id:Ge.data.callRecording.id,contactId:Ge.data.callRecording.contactId,date:Ge.data.callRecording.date,duration:Ge.data.callRecording.duration,recordingUrl:Ge.data.callRecording.recordingUrl,transcriptUrl:"",summary:Ge.data.callRecording.summary,sentiment:Ge.data.callRecording.sentiment,tags:Ge.data.callRecording.tags,aiInsights:Ge.data.callRecording.aiInsights,repId:Ge.data.callRecording.repId,companyId:Ge.data.callRecording.companyId,processingOptions:{transcription:!0,sentiment:!0,insights:!0},audioState:{isPlaying:!1,currentTime:0,duration:me||0,audioInstance:null,showPlayer:!1,showTranscript:!1}};w(ys=>[...ys,pt])}l(""),d(""),h(""),f(null),b(""),n(!1)}catch(be){console.error("Error in handleSubmit:",be),alert("There was an error uploading your file. Please try again.")}finally{N(!1)}},mt=async ie=>{console.log("Attempting to delete item with ID:",ie);try{const be=g.find(ze=>ze.id===ie),me=y.find(ze=>ze.id===ie);be?(console.log("Document being deleted:",be),await Xr.delete(`/documents/${ie}`),x(ze=>ze.filter(Ge=>Ge.id!==ie))):me&&(console.log("Call recording being deleted:",me),await Xr.delete(`/call-recordings/${ie}`),w(ze=>{const Ge=ze.find(pt=>pt.id===ie);return Ge&&Xt(Ge),ze.filter(pt=>pt.id!==ie)}),R===ie&&(I&&I.pause(),T(null),$(!1),X(null),P(0),O(0)))}catch(be){console.error("Error deleting item:",be),alert("There was an error deleting the item. Please try again.")}},Xt=ie=>{if(ie.audioState.audioInstance)try{ie.audioState.audioInstance.pause(),ie.audioState.audioInstance.onloadedmetadata=null,ie.audioState.audioInstance.ontimeupdate=null,ie.audioState.audioInstance.onended=null,ie.audioState.audioInstance.onerror=null,ie.audioState.audioInstance.src&&URL.revokeObjectURL(ie.audioState.audioInstance.src)}catch(be){console.error("Error cleaning up audio instance:",be)}if(ie.recordingUrl)try{URL.revokeObjectURL(ie.recordingUrl)}catch(be){console.error("Error revoking recording URL:",be)}},mn=async ie=>{if(ie.isCallRecording||ie.recordingUrl)if(B?.id===ie.id)G(null);else{if(G(ie),!le[ie.id]||!le[ie.id].summary){ce(be=>({...be,[ie.id]:!0}));try{const be=await Xr.post(`/call-recordings/${ie.id}/analyze/summary`);H(me=>({...me,[ie.id]:{...me[ie.id]||{},summary:be.data.summary}}))}catch{H(me=>({...me,[ie.id]:{...me[ie.id]||{},summary:{keyIdeas:[],lastUpdated:null,error:"Failed to load summary."}}}))}finally{ce(be=>({...be,[ie.id]:!1}))}}if(!le[ie.id]||!le[ie.id].transcription){Pe(be=>({...be,[ie.id]:!0}));try{const be=await Xr.post(`/call-recordings/${ie.id}/analyze/transcription`);H(me=>({...me,[ie.id]:{...me[ie.id]||{},transcription:be.data.transcription}})),rt(me=>({...me,[ie.id]:yt}))}catch{H(me=>({...me,[ie.id]:{...me[ie.id]||{},transcription:{status:"failed",segments:[],lastUpdated:null,error:"Failed to load transcription."}}}))}finally{Pe(be=>({...be,[ie.id]:!1}))}}if(!le[ie.id]||!le[ie.id].scoring){fe(be=>({...be,[ie.id]:!0}));try{const be=await Xr.post(`/call-recordings/${ie.id}/analyze/scoring`);H(me=>({...me,[ie.id]:{...me[ie.id]||{},scoring:be.data.scoring}}))}catch{H(me=>({...me,[ie.id]:{...me[ie.id]||{},scoring:{status:"failed",result:null,lastUpdated:null,error:"Failed to load scoring."}}}))}finally{fe(be=>({...be,[ie.id]:!1}))}}}else ee?.id===ie.id?re(null):(re(ie),(!le[ie.id]||!le[ie.id].summary)&&await S(ie.id))},S=async ie=>{try{Ne(ie);const be=await Xr.post(`/rag/analyze/${ie}`);console.log("Analysis response:",be.data),H(me=>({...me,[ie]:be.data}))}catch(be){console.error("Error analyzing document:",be),alert("Failed to analyze document. Please try again.")}finally{Ne(null)}},z=ie=>{window.open(ie,"_blank")},Y=()=>{v||(n(!1),l(""),d(""),h(""),f(null),b(""))},Ce=()=>{I&&(I.pause(),$(!1),P(0),X(null)),ae(!1),G(null)},je=(ie,be)=>{if(console.log("Attempting to play audio:",ie),I&&(I.pause(),$(!1)),R===be&&I){E?(I.pause(),$(!1)):(I.play(),$(!0));return}const me=new Audio(ie);me.addEventListener("loadedmetadata",()=>{O(me.duration)}),me.addEventListener("timeupdate",()=>{P(me.currentTime)}),me.addEventListener("ended",()=>{$(!1),P(0)}),me.play().then(()=>{$(!0),T(me),X(be)}).catch(ze=>{console.error("Error playing audio:",ze),$(!1)})},se=ie=>{if(isNaN(ie)||ie<0)return"0:00";const be=Math.floor(ie/60),me=Math.floor(ie%60);return`${be}:${me.toString().padStart(2,"0")}`},_e=ie=>{if(!ie)return"";try{return Bt(new Date(ie),"dd MMM yyyy")}catch{return ie}};k.useEffect(()=>()=>{I&&(I.pause(),T(null),$(!1))},[]);const Ke=()=>{const ie=new CustomEvent("tabChange",{detail:{tab:"company-onboarding"}});window.dispatchEvent(ie)},He=()=>{F(!1),re(null)},gt=(ie,be)=>{if(!ie||Fe[be])return;const me=new Audio(ie);me.addEventListener("loadedmetadata",()=>{et(ze=>({...ze,[be]:me.duration}))})},Yt=ie=>{if(!ie)return!0;const be=["the","and","or","but","in","on","at","to","for","of","with","by"],me=ie.toLowerCase().split(/\s+/);return me.filter(pt=>be.includes(pt)).length/Math.min(me.length,20)>.2},$i=ie=>{const be=`${ie.summary} ${ie.domain} ${ie.theme}`.substring(0,200);return!Yt(be)},zg=async(ie,be)=>{try{Et(ie);const me={summary:be.summary,domain:be.domain,theme:be.theme,technicalLevel:be.technicalLevel,mainPoints:be.mainPoints,targetAudience:be.targetAudience,keyTerms:be.keyTerms,recommendations:be.recommendations},ze=await Xr.post("/rag/translate-analysis",{analysis:me,targetLanguage:"English"});console.log("Translation response:",ze.data),Xe(Ge=>({...Ge,[ie]:ze.data.translatedAnalysis}))}catch(me){console.error("Error translating analysis:",me),alert("Failed to translate analysis. Please try again.")}finally{Et(null)}},Bg=()=>{const ie=g.filter(me=>t==="all"||me.type===t).map(me=>({...me,itemType:"document",date:me.uploadedAt,isCallRecording:!1})),be=y.filter(me=>t==="all"||t==="audio").map(me=>({id:me.id,name:me.contactId,description:me.summary,type:"audio",itemType:"callRecording",tags:me.tags,date:me.date,isCallRecording:!0,callData:me}));return[...ie,...be].sort((me,ze)=>new Date(ze.date).getTime()-new Date(me.date).getTime())},Uv=()=>{const ie=Bg();return ie.length>0?a.jsxs("div",{className:"space-y-4",children:[ie.map(be=>{if(be.isCallRecording&&"callData"in be&&be.callData){const me=be.callData;return gt(me.recordingUrl,me.id),a.jsxs(k.Fragment,{children:[a.jsx("div",{className:"bg-white p-5 rounded-lg shadow-sm border border-gray-100",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx("div",{className:"p-3 rounded-lg bg-purple-100 mr-4 flex-shrink-0",children:a.jsx(Wc,{size:20,className:"text-purple-500"})}),a.jsxs("div",{className:"flex-grow min-w-0",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2 flex-wrap gap-2",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 truncate",children:me.contactId}),a.jsxs("div",{className:"flex items-center space-x-2 flex-shrink-0",children:[a.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800",children:"Call Recording"}),me.processingOptions?.sentiment&&me.sentiment&&a.jsxs("span",{className:`px-2 py-1 text-xs rounded-full whitespace-nowrap ${me.sentiment==="positive"?"bg-green-100 text-green-800":me.sentiment==="negative"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:[me.sentiment.charAt(0).toUpperCase()+me.sentiment.slice(1)," Sentiment"]}),a.jsx("button",{onClick:()=>mn(me),className:"text-blue-600 hover:text-blue-800 p-1",title:"View details",children:a.jsx(Bc,{size:16})}),a.jsx("button",{className:"text-red-600 hover:text-red-800 p-1",onClick:()=>mt(me.id),title:"Delete call recording",children:a.jsx(er,{size:16})})]})]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-500 mb-3 whitespace-nowrap",children:[a.jsx(St,{size:14,className:"mr-1 flex-shrink-0"}),_e(me.date),"  ",Fe[me.id]!==void 0?se(Fe[me.id]):"..."]}),a.jsx("p",{className:"text-sm text-gray-700 mb-3 break-words overflow-hidden",children:me.summary}),a.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:me.tags.map((ze,Ge)=>a.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-gray-100 text-gray-700 whitespace-nowrap",children:ze},`${me.id}-${ze}`))})]})]})}),B?.id===me.id&&a.jsxs("div",{className:"bg-purple-50 border-l-4 border-purple-500 p-6 rounded-lg shadow-sm ml-4 mb-4",children:[a.jsxs("div",{className:"flex justify-between items-start mb-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(Wc,{size:20,className:"text-purple-600 mr-2"}),a.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Call Recording Details"})]}),a.jsx("button",{onClick:()=>G(null),className:"text-gray-400 hover:text-gray-600",children:a.jsx(Pi,{size:20})})]}),a.jsx("div",{className:"mb-6",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:B.contactId}),a.jsx("p",{className:"text-gray-600 mb-2",children:B.summary}),a.jsxs("div",{className:"flex items-center text-gray-500 mb-2",children:[a.jsx(St,{size:16,className:"mr-2"}),_e(B.date),"  ",Fe[B.id]!==void 0?se(Fe[B.id]):"..."]})]}),a.jsxs("div",{className:"flex flex-col items-end gap-2",children:[a.jsxs("button",{className:"flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",onClick:()=>je(B.recordingUrl,B.id),title:R===B.id&&E?"Pause":"Play",children:[R===B.id&&E?a.jsx(a1,{size:18}):a.jsx(qg,{size:18}),a.jsxs("span",{className:"ml-2",children:[R===B.id&&E?"Pause":"Play"," Audio"]})]}),a.jsx("span",{className:"text-xs text-gray-500",children:R===B.id?`${se(D)} / ${se(_)}`:"0:00 / 0:00"})]})]})}),a.jsxs("div",{className:"mt-6 w-full",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Call Analysis"}),a.jsxs("details",{className:"mb-4",open:!0,children:[a.jsx("summary",{className:"cursor-pointer text-gray-700 font-semibold py-2",children:"Key Points"}),a.jsx("div",{className:"space-y-4 p-2",children:te[B.id]?a.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[a.jsx(Di,{className:"animate-spin",size:20}),a.jsx("span",{children:"Analyzing call, please wait..."})]}):le[B.id]&&"summary"in le[B.id]&&le[B.id].summary?.keyIdeas?.length>0?a.jsxs(a.Fragment,{children:[le[B.id].summary.keyIdeas.map((ze,Ge)=>a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[a.jsx("h5",{className:"font-medium text-gray-900 mb-2",children:ze.title}),a.jsx("p",{className:"text-gray-700",children:ze.description})]},Ge)),a.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:["Last updated: ",Bt(new Date(le[B.id].summary.lastUpdated),"PPpp")]})]}):a.jsx("div",{className:"text-gray-500 italic",children:"No analysis available yet."})})]}),a.jsxs("details",{className:"mb-4",open:!0,children:[a.jsx("summary",{className:"cursor-pointer text-gray-700 font-semibold py-2",children:"Transcription"}),a.jsx("div",{className:"p-4",children:Se[B.id]?a.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[a.jsx(Di,{className:"animate-spin",size:20}),a.jsx("span",{children:"Generating transcription, please wait..."})]}):(()=>{if(!le||!B?.id)return a.jsx("div",{className:"text-gray-500 italic",children:"No transcription available yet."});const ze=le[B.id];if(!ze||!("transcription"in ze))return a.jsx("div",{className:"text-gray-500 italic",children:"No transcription available yet."});const Ge=ze;if(Ge.transcription?.status!=="completed"||!Ge.transcription?.segments?.length)return a.jsx("div",{className:"text-gray-500 italic",children:"No transcription available yet."});const pt=$e[B.id]||yt,ys=Ge.transcription.segments.slice(0,pt);return a.jsxs("div",{className:"space-y-4",children:[ys.map((us,gn)=>a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2 text-sm text-gray-500",children:[a.jsxs("span",{children:[typeof us.start=="string"?us.start:se(us.start)," - ",typeof us.end=="string"?us.end:se(us.end)]}),us.speaker&&a.jsx("span",{className:"font-medium",children:us.speaker})]}),a.jsx("p",{className:"text-gray-700",children:us.text})]},gn)),pt<Ge.transcription.segments.length&&a.jsx("button",{className:"mt-2 px-4 py-2 bg-blue-100 text-blue-700 rounded hover:bg-blue-200",onClick:()=>rt(us=>({...us,[B.id]:pt+yt})),children:"Show more"}),pt>yt&&a.jsx("button",{className:"mt-2 ml-2 px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200",onClick:()=>rt(us=>({...us,[B.id]:yt})),children:"Show less"}),Ge.transcription.lastUpdated&&a.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:["Last updated: ",Bt(new Date(Ge.transcription.lastUpdated),"PPpp")]})]})})()})]}),a.jsxs("details",{className:"mb-4",open:!0,children:[a.jsx("summary",{className:"cursor-pointer text-gray-700 font-semibold py-2",children:"Scoring"}),a.jsx("div",{className:"p-4",children:q[B.id]?a.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[a.jsx(Di,{className:"animate-spin",size:20}),a.jsx("span",{children:"Generating scoring, please wait..."})]}):(()=>{if(!le||!B?.id)return a.jsx("div",{className:"text-gray-500 italic",children:"No scoring available yet."});const ze=le[B.id];if(!ze||!("scoring"in ze))return a.jsx("div",{className:"text-gray-500 italic",children:"No scoring available yet."});const Ge=ze.scoring;return Ge?.status!=="completed"||!Ge?.result?a.jsx("div",{className:"text-gray-500 italic",children:"No scoring available yet."}):a.jsxs("div",{className:"space-y-4",children:[Object.entries(Ge.result).map(([pt,ys])=>a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2 text-sm text-gray-500",children:[a.jsx("span",{className:"font-medium",children:pt}),a.jsxs("span",{children:["Score: ",ys.score]})]}),a.jsx("p",{className:"text-gray-700",children:ys.feedback})]},pt)),Ge.lastUpdated&&a.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:["Last updated: ",Bt(new Date(Ge.lastUpdated),"PPpp")]})]})})()})]})]})]})]},me.id)}else return a.jsxs(k.Fragment,{children:[a.jsx("div",{className:"bg-white p-5 rounded-lg shadow-sm border border-gray-100",children:a.jsxs("div",{className:"flex items-start",children:[a.jsx("div",{className:"p-3 rounded-lg bg-gray-100 mr-4 flex-shrink-0",children:xe(be.type)}),a.jsxs("div",{className:"flex-grow min-w-0",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1 truncate",children:be.name}),a.jsx("p",{className:"text-sm text-gray-500 mb-3 break-words line-clamp-2",children:be.description}),a.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:be.tags.map((me,ze)=>a.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-gray-100 text-gray-700 whitespace-nowrap",children:me},`${be.id}-${me}`))}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:`px-2 py-1 text-xs rounded-full whitespace-nowrap ${be.type==="document"?"bg-blue-100 text-blue-800":be.type==="audio"?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"}`,children:be.type.charAt(0).toUpperCase()+be.type.slice(1)}),a.jsxs("div",{className:"flex space-x-2 flex-shrink-0",children:[a.jsx("button",{onClick:()=>mn(be),className:"text-blue-600 hover:text-blue-800 p-1",title:"View details",children:a.jsx(Bc,{size:16})}),a.jsx("button",{className:"text-red-600 hover:text-red-800 p-1",onClick:()=>mt(be.id),title:"Delete",children:a.jsx(er,{size:16})})]})]})]})]})}),ee?.id===be.id&&a.jsxs("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-6 rounded-lg shadow-sm ml-4 mb-4",children:[a.jsxs("div",{className:"flex justify-between items-start mb-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(ia,{size:20,className:"text-blue-600 mr-2"}),a.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Document Analysis"})]}),a.jsx("button",{onClick:()=>re(null),className:"text-gray-400 hover:text-gray-600",children:a.jsx(Pi,{size:20})})]}),ve===be.id?a.jsxs("div",{className:"flex items-center justify-center py-8",children:[a.jsx(Di,{className:"animate-spin text-blue-600 mr-3",size:24}),a.jsx("span",{className:"text-gray-600",children:"Analyzing document..."})]}):le[be.id]?Vg(le[be.id],be.id):a.jsxs("div",{className:"text-center py-8",children:[a.jsx("p",{className:"text-gray-600 mb-4",children:"No analysis available yet."}),a.jsx("button",{onClick:()=>S(be.id),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Analyze Document"})]})]})]},be.id)}),B&&B.recordingUrl&&a.jsxs("div",{className:"bg-white rounded-lg shadow-lg border border-blue-200 mt-6 p-6 w-full",children:[a.jsxs("div",{className:"flex justify-between items-start mb-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(Wc,{size:20,className:"text-purple-500"}),a.jsx("h3",{className:"text-xl font-semibold ml-2",children:"Call Recording Details"})]}),a.jsx("button",{onClick:Ce,className:"text-gray-400 hover:text-gray-500",children:a.jsx(Pi,{size:24})})]}),a.jsx("div",{className:"border-b border-gray-200 pb-6 mb-6",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:B.contactId}),a.jsx("p",{className:"text-gray-600 mb-2",children:B.summary}),a.jsxs("div",{className:"flex items-center text-gray-500 mb-2",children:[a.jsx(St,{size:16,className:"mr-2"}),_e(B.date),"  ",Fe[B.id]!==void 0?se(Fe[B.id]):"..."]}),B.tags&&B.tags.length>0&&a.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:B.tags.map((be,me)=>a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-sm",children:be},me))})]}),a.jsxs("div",{className:"flex flex-col items-end gap-2",children:[a.jsxs("button",{className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",onClick:()=>je(B.recordingUrl,B.id),title:R===B.id&&E?"Pause":"Play",children:[R===B.id&&E?a.jsx(a1,{size:18}):a.jsx(qg,{size:18}),a.jsxs("span",{className:"ml-2",children:[R===B.id&&E?"Pause":"Play"," Audio"]})]}),a.jsx("span",{className:"text-xs text-gray-500",children:R===B.id?`${se(D)} / ${se(_)}`:"0:00 / 0:00"})]})]})}),a.jsxs("div",{className:"mt-6 w-full",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Call Analysis"}),a.jsxs("details",{className:"mb-4",open:!0,children:[a.jsx("summary",{className:"cursor-pointer text-gray-700 font-semibold py-2",children:"Key Points"}),a.jsx("div",{className:"space-y-4 p-2",children:te[B.id]?a.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[a.jsx(Di,{className:"animate-spin",size:20}),a.jsx("span",{children:"Analyzing call, please wait..."})]}):le[B.id]&&"summary"in le[B.id]&&le[B.id].summary?.keyIdeas?.length>0?a.jsxs(a.Fragment,{children:[le[B.id].summary.keyIdeas.map((be,me)=>a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[a.jsx("h5",{className:"font-medium text-gray-900 mb-2",children:be.title}),a.jsx("p",{className:"text-gray-700",children:be.description})]},me)),a.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:["Last updated: ",Bt(new Date(le[B.id].summary.lastUpdated),"PPpp")]})]}):a.jsx("div",{className:"text-gray-500 italic",children:"No analysis available yet."})})]}),a.jsxs("details",{className:"mb-4",open:!0,children:[a.jsx("summary",{className:"cursor-pointer text-gray-700 font-semibold py-2",children:"Transcription"}),a.jsx("div",{className:"p-4",children:Se[B.id]?a.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[a.jsx(Di,{className:"animate-spin",size:20}),a.jsx("span",{children:"Generating transcription, please wait..."})]}):(()=>{if(!le||!B?.id)return a.jsx("div",{className:"text-gray-500 italic",children:"No transcription available yet."});const be=le[B.id];if(!be||!("transcription"in be))return a.jsx("div",{className:"text-gray-500 italic",children:"No transcription available yet."});const me=be;if(me.transcription?.status!=="completed"||!me.transcription?.segments?.length)return a.jsx("div",{className:"text-gray-500 italic",children:"No transcription available yet."});const ze=$e[B.id]||yt,Ge=me.transcription.segments.slice(0,ze);return a.jsxs("div",{className:"space-y-4",children:[Ge.map((pt,ys)=>a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2 text-sm text-gray-500",children:[a.jsxs("span",{children:[typeof pt.start=="string"?pt.start:se(pt.start)," - ",typeof pt.end=="string"?pt.end:se(pt.end)]}),pt.speaker&&a.jsx("span",{className:"font-medium",children:pt.speaker})]}),a.jsx("p",{className:"text-gray-700",children:pt.text})]},ys)),ze<me.transcription.segments.length&&a.jsx("button",{className:"mt-2 px-4 py-2 bg-blue-100 text-blue-700 rounded hover:bg-blue-200",onClick:()=>rt(pt=>({...pt,[B.id]:ze+yt})),children:"Show more"}),ze>yt&&a.jsx("button",{className:"mt-2 ml-2 px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200",onClick:()=>rt(pt=>({...pt,[B.id]:yt})),children:"Show less"}),me.transcription.lastUpdated&&a.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:["Last updated: ",Bt(new Date(me.transcription.lastUpdated),"PPpp")]})]})})()})]}),a.jsxs("details",{className:"mb-4",open:!0,children:[a.jsx("summary",{className:"cursor-pointer text-gray-700 font-semibold py-2",children:"Scoring"}),a.jsx("div",{className:"p-4",children:q[B.id]?a.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[a.jsx(Di,{className:"animate-spin",size:20}),a.jsx("span",{children:"Generating scoring, please wait..."})]}):(()=>{if(!le||!B?.id)return a.jsx("div",{className:"text-gray-500 italic",children:"No scoring available yet."});const be=le[B.id];if(!be||!("scoring"in be))return a.jsx("div",{className:"text-gray-500 italic",children:"No scoring available yet."});const me=be.scoring;return me?.status!=="completed"||!me?.result?a.jsx("div",{className:"text-gray-500 italic",children:"No scoring available yet."}):a.jsxs("div",{className:"space-y-4",children:[Object.entries(me.result).map(([ze,Ge])=>a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[a.jsxs("div",{className:"flex justify-between items-center mb-2 text-sm text-gray-500",children:[a.jsx("span",{className:"font-medium",children:ze}),a.jsxs("span",{children:["Score: ",Ge.score]})]}),a.jsx("p",{className:"text-gray-700",children:Ge.feedback})]},ze)),me.lastUpdated&&a.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:["Last updated: ",Bt(new Date(me.lastUpdated),"PPpp")]})]})})()})]})]})]})]}):a.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-sm border border-gray-100 text-center",children:[a.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 mb-4",children:a.jsx(s1,{size:24,className:"text-gray-400"})}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No resources found"}),a.jsx("p",{className:"text-gray-500 max-w-md mx-auto",children:t!=="all"?`No ${t==="document"?"documents":"audio recordings"} found. Try changing the filter or add new resources.`:"Your knowledge base is empty. Add documents or call recordings to get started."}),t==="all"&&a.jsxs("button",{className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center mx-auto",onClick:()=>n(!0),children:[a.jsx(Xs,{size:18,className:"mr-2"}),"Add Your First Resource"]})]})},Ug=()=>s?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl my-8 max-h-[90vh] flex flex-col",children:[a.jsxs("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center flex-shrink-0",children:[a.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Add to Knowledge Base"}),a.jsx("button",{type:"button",className:"text-gray-400 hover:text-gray-500 focus:outline-none text-xl font-semibold",onClick:Y,disabled:v,children:""})]}),a.jsx("div",{className:"overflow-y-auto flex-grow",children:a.jsxs("form",{onSubmit:ut,children:[a.jsxs("div",{className:"p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Resource Type"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("button",{type:"button",className:`p-4 rounded-lg border ${r==="document"?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"} flex flex-col items-center justify-center`,onClick:()=>i("document"),children:[a.jsx(is,{size:24,className:r==="document"?"text-blue-500":"text-gray-500"}),a.jsx("span",{className:"mt-2 text-sm",children:"Document"})]}),a.jsxs("button",{type:"button",className:`p-4 rounded-lg border ${r==="audio"?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"} flex flex-col items-center justify-center`,onClick:()=>i("audio"),children:[a.jsx(Wc,{size:24,className:r==="audio"?"text-blue-500":"text-gray-500"}),a.jsx("span",{className:"mt-2 text-sm",children:"Call Recording"})]})]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Name"}),a.jsx("input",{type:"text",id:"name",className:"bg-gray-100 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5",placeholder:r==="document"?"Enter a name for this resource":"Enter a name for this recording",value:o,onChange:ie=>l(ie.target.value),required:!0})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),a.jsx("textarea",{id:"description",rows:3,className:"bg-gray-100 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5",placeholder:r==="document"?"Describe what this resource contains":"Describe what this recording contains",value:c,onChange:ie=>d(ie.target.value),required:!0})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload File"}),a.jsx("div",{className:"flex items-center justify-center w-full",children:a.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100",children:[a.jsxs("div",{className:"flex flex-col items-center justify-center pt-5 pb-6",children:[a.jsx(Ri,{size:24,className:"text-gray-400 mb-2"}),a.jsxs("p",{className:"mb-2 text-sm text-gray-500",children:[a.jsx("span",{className:"font-semibold",children:"Click to upload"})," or drag and drop"]}),a.jsx("p",{className:"text-xs text-gray-500",children:r==="document"?"PDF, DOCX, TXT, or other document formats":"MP3, WAV, or other audio formats"})]}),a.jsx("input",{type:"file",className:"hidden",onChange:qe,accept:r==="document"?".pdf,.docx,.txt,.md,.csv,.xlsx":".mp3,.wav,.ogg,.m4a",required:!0})]})}),p&&a.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Selected file: ",p.name]})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags"}),a.jsx("input",{type:"text",className:"bg-gray-100 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5",placeholder:"Enter tags separated by commas",value:m,onChange:ie=>b(ie.target.value)}),a.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Example: ",r==="document"?"product, api, technical":"follow-up, sales, support"]})]}),r==="audio"&&a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"AI Processing Options"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"transcription",className:"h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500",checked:L.transcription,onChange:ie=>K(be=>({...be,transcription:ie.target.checked}))}),a.jsx("label",{htmlFor:"transcription",className:"ml-2 text-sm text-gray-700",children:"Generate transcription"})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"sentiment",className:"h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500",checked:L.sentiment,onChange:ie=>K(be=>({...be,sentiment:ie.target.checked}))}),a.jsx("label",{htmlFor:"sentiment",className:"ml-2 text-sm text-gray-700",children:"Analyze sentiment"})]}),a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",id:"insights",className:"h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500",checked:L.insights,onChange:ie=>K(be=>({...be,insights:ie.target.checked}))}),a.jsx("label",{htmlFor:"insights",className:"ml-2 text-sm text-gray-700",children:"Generate AI insights"})]})]})]})]}),a.jsxs("div",{className:"p-6 border-t border-gray-200 flex justify-end space-x-3 flex-shrink-0",children:[a.jsx("button",{type:"button",className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg",onClick:Y,disabled:v,children:"Cancel"}),a.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center",disabled:v,children:v?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"animate-spin mr-2",children:""}),"Uploading..."]}):a.jsxs(a.Fragment,{children:[a.jsx(Ri,{size:18,className:"mr-2"}),"Upload"]})})]})]})})]})}):null,Vg=(ie,be)=>{if("domain"in ie){const me=ie,ze=be&&Me[be],Ge=ze?Me[be]:me,pt=be&&$i(me)&&!ze;return a.jsxs("div",{children:[be&&a.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[ze&&a.jsxs("div",{className:"flex items-center text-sm text-green-600 bg-green-50 px-3 py-1 rounded-full",children:[a.jsx(r1,{size:14,className:"mr-1"}),"Translated to English"]}),pt&&a.jsx("button",{onClick:()=>zg(be,me),disabled:it===be,className:"flex items-center text-sm px-3 py-1 bg-blue-100 text-blue-700 rounded-full hover:bg-blue-200 disabled:opacity-50",children:it===be?a.jsxs(a.Fragment,{children:[a.jsx(Di,{size:14,className:"mr-1 animate-spin"}),"Translating..."]}):a.jsxs(a.Fragment,{children:[a.jsx(r1,{size:14,className:"mr-1"}),"Translate to English"]})})]}),ze&&a.jsx("button",{onClick:()=>Xe(ys=>{const us={...ys};return delete us[be],us}),className:"text-sm text-gray-500 hover:text-gray-700",children:"Show Original"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Summary"}),a.jsx("p",{className:"text-gray-700",children:Ge.summary})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Domain"}),a.jsx("p",{className:"text-gray-700",children:Ge.domain})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Theme"}),a.jsx("p",{className:"text-gray-700",children:Ge.theme})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Technical Level"}),a.jsx("p",{className:"text-gray-700",children:Ge.technicalLevel})]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Main Points"}),a.jsx("ul",{className:"list-disc list-inside space-y-2",children:Ge.mainPoints.map((ys,us)=>a.jsx("li",{className:"text-gray-700",children:ys},us))})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Target Audience"}),a.jsx("p",{className:"text-gray-700",children:Ge.targetAudience})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Key Terms"}),a.jsx("ul",{className:"list-disc list-inside space-y-2",children:Ge.keyTerms.map((ys,us)=>a.jsx("li",{className:"text-gray-700",children:ys},us))})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Recommendations"}),a.jsx("ul",{className:"list-disc list-inside space-y-2",children:Ge.recommendations.map((ys,us)=>a.jsx("li",{className:"text-gray-700",children:ys},us))})]})]})]})]})}else if("summary"in ie&&ie.summary&&"keyIdeas"in ie.summary){const me=ie;return a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Call Summary"}),a.jsx("div",{className:"space-y-4",children:me.summary.keyIdeas.map((ze,Ge)=>a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:ze.title}),a.jsx("p",{className:"text-gray-700",children:ze.description})]},Ge))}),a.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:["Last updated: ",Bt(new Date(me.summary.lastUpdated),"PPpp")]})]})})}else return a.jsx("div",{className:"text-gray-500 italic",children:"No analysis available yet."})},Vv=()=>!ue||!ee||!le[ee.id]?null:a.jsxs("div",{className:"p-6 relative",children:[a.jsx("button",{onClick:He,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl font-bold focus:outline-none",title:"Close details",children:""}),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-100 p-6",children:[a.jsx("div",{className:"border-b border-gray-200 pb-6 mb-6",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex items-start space-x-4",children:[a.jsx("div",{className:"p-3 rounded-lg bg-gray-100",children:xe(ee.type)}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:ee.name}),a.jsx("p",{className:"text-gray-600 mb-4",children:ee.description}),a.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:ee.tags.map((be,me)=>a.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-sm",children:be},me))}),a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsxs("button",{onClick:()=>z(ee.fileUrl),className:"flex items-center text-blue-600 hover:text-blue-800",children:[a.jsx(zc,{size:18,className:"mr-2"}),"Open Document"]}),a.jsxs("span",{className:"text-sm text-gray-500",children:["Uploaded on ",Bt(new Date(ee.uploadedAt),"MMMM d, yyyy")]})]})]})]}),ve===ee.id?a.jsxs("div",{className:"flex items-center text-blue-600",children:[a.jsx(Di,{className:"animate-spin mr-2",size:20}),"Analyzing... This may take a few minutes"]}):le[ee.id]?a.jsxs("button",{onClick:()=>S(ee.id),className:"flex items-center text-blue-600 hover:text-blue-800",children:[a.jsx($r,{size:20,className:"mr-2"}),"Refresh Analysis"]}):a.jsxs("button",{onClick:()=>S(ee.id),className:"flex items-center text-blue-600 hover:text-blue-800",children:[a.jsx(ia,{size:20,className:"mr-2"}),"Start Analysis"]})]})}),le[ee.id]?Vg(le[ee.id],ee.id):a.jsxs("div",{className:"text-center py-12",children:[a.jsx(ia,{size:48,className:"mx-auto text-gray-400 mb-4"}),a.jsxs("p",{className:"text-gray-500",children:['Click "Start Analysis" to get AI-powered insights about this document.',a.jsx("br",{}),a.jsx("span",{className:"text-sm text-gray-400 mt-2 block",children:"This process may take a few minutes as it analyzes the document in detail."})]})]})]})]});return a.jsxs("div",{className:"p-6 bg-gray-50 min-h-screen",children:[a.jsxs("button",{onClick:Ke,className:"mb-6 flex items-center text-gray-600 hover:text-gray-900 transition-colors",children:[a.jsx(ra,{size:20,className:"mr-2"}),a.jsx("span",{children:"Back to Onboarding"})]}),a.jsxs("div",{className:"mb-6",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Knowledge Base"}),a.jsx("p",{className:"text-gray-600",children:"Upload documents and call recordings to build your company's knowledge base. The AI will use this information to provide better insights and assistance when handling contacts."})]}),a.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-100 mb-6",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(Uc,{size:18,className:"text-gray-500"}),a.jsxs("select",{className:"bg-gray-100 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5",value:t,onChange:ie=>e(ie.target.value),children:[a.jsx("option",{value:"all",children:"All Types"}),a.jsx("option",{value:"document",children:"Documents"}),a.jsx("option",{value:"audio",children:"Audio / Call Recordings"})]})]}),a.jsxs("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center",onClick:()=>n(!0),children:[a.jsx(Xs,{size:18,className:"mr-2"}),"Add Resource"]})]})}),Uv(),Ug(),Vv()]})},$R=Ae.create({baseURL:"http://localhost:3001/api"}),Lg=[{name:"Context & Preparation",icon:is,color:"text-purple-600",bgColor:"bg-purple-50",borderColor:"border-purple-200",description:"Preparation and context setting"},{name:"SBAM & Opening",icon:l4,color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",description:"Salutation, Bonjour, Accroche, Motif"},{name:"Legal & Compliance",icon:Xg,color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200",description:"Legal aspects and compliance"},{name:"Need Discovery",icon:Il,color:"text-orange-600",bgColor:"bg-orange-50",borderColor:"border-orange-200",description:"Needs discovery and qualification"},{name:"Value Proposition",icon:b4,color:"text-yellow-600",bgColor:"bg-yellow-50",borderColor:"border-yellow-200",description:"Value proposition presentation"},{name:"Documents/Quote",icon:n4,color:"text-indigo-600",bgColor:"bg-indigo-50",borderColor:"border-indigo-200",description:"Documentation and quotation"},{name:"Objection Handling",icon:Oc,color:"text-pink-600",bgColor:"bg-pink-50",borderColor:"border-pink-200",description:"Objection handling and resolution"},{name:"Confirmation & Closing",icon:ht,color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",description:"Confirmation and closing"}],m0e=t=>Lg.find(e=>e.name===t)||{name:t,icon:Ys,color:"text-gray-600",bgColor:"bg-gray-50",borderColor:"border-gray-200",description:t},g0e=t=>{const e={};t.forEach(r=>{e[r.phase]||(e[r.phase]=[]),e[r.phase].push(r)});const s=Lg.map(r=>r.name).filter(r=>e[r]),n=Object.keys(e).filter(r=>!Lg.some(i=>i.name===r));return[...s,...n].map(r=>({phaseName:r,steps:e[r]}))},x0e=()=>{const[t,e]=k.useState(!1),[s,n]=k.useState(null),[r,i]=k.useState(null),[o,l]=k.useState(""),[c,d]=k.useState(""),[u,h]=k.useState(""),[p,f]=k.useState(""),[m,b]=k.useState([]),[g,x]=k.useState(null),[y,w]=k.useState(!1),[v,N]=k.useState(null),[C,j]=k.useState([]),[I,T]=k.useState(!1),[E,$]=k.useState(null),[D,P]=k.useState("table"),[_,O]=k.useState(null),[R,X]=k.useState(null),[L,K]=k.useState("all"),[B,G]=k.useState(null),[de,ae]=k.useState(null),[ve,Ne]=k.useState([]);k.useState(null);const le=()=>De.get("companyId"),H=()=>{const xe=new CustomEvent("tabChange",{detail:{tab:"company-onboarding"}});window.dispatchEvent(xe)},ue=async()=>{const xe=le();if(console.log("[GIGS] Fetching gigs for companyId:",xe),!xe){N("Company ID not found");return}w(!0),N(null);try{const Ve="https://v25gigsmanualcreationbackend-production.up.railway.app/api",qe=await fetch(`${Ve}/gigs/company/${xe}`);if(!qe.ok)throw new Error(`Failed to fetch gigs: ${qe.statusText}`);const We=await qe.json();console.log("[GIGS] API response:",We),b(Array.isArray(We.data)?We.data:[])}catch(Ve){console.error("[GIGS] Error fetching gigs:",Ve),N(Ve.message||"Failed to fetch gigs")}finally{w(!1)}},F=async()=>{T(!0),$(null);try{const xe=le();if(!xe)throw new Error("Company ID not found");const Ve="http://localhost:3001";let qe=`${Ve}/api/scripts/company/${xe}`;L!=="all"&&(qe+=`?status=${L}`),console.log("[SCRIPTS] Fetching scripts for companyId:",xe,"with filter:",L,"URL:",qe);const We=await fetch(qe);if(!We.ok)throw new Error(`Failed to fetch scripts: ${We.statusText}`);const at=await We.json();console.log("[SCRIPTS] API response:",at),j(Array.isArray(at.data)?at.data:[])}catch(xe){console.error("[SCRIPTS] Error fetching scripts:",xe),$(xe.message||"Failed to fetch scripts")}finally{T(!1)}};k.useEffect(()=>{ue(),F()},[]),k.useEffect(()=>{F()},[L]);const ee=async()=>{try{const xe=le();if(!xe)throw new Error("Company ID not found");const qe=`https://v25searchcompanywizardbackend-production.up.railway.app/api/onboarding/companies/${xe}/onboarding/phases/2/steps/8`,We=await $R.put(qe,{status:"completed"});return console.log("Onboarding progress (script) update response:",We.data),We.data&&(De.set("companyOnboardingProgress",JSON.stringify(We.data),{expires:7}),console.log("Updated companyOnboardingProgress cookie with new data")),We.data}catch(xe){throw console.error("Error updating onboarding progress (script):",xe),xe}},re=async xe=>{xe.preventDefault(),e(!0),i(null),n(null);try{const Ve=le();if(!Ve)throw new Error("Company ID not found");if(!g)throw new Error("Vous devez slectionner un gig pour gnrer un script.");const qe={companyId:Ve,gig:g,typeClient:c,langueTon:p,contexte:u},We=await $R.post("/rag/generate-script",qe);n(We.data);try{await ee(),console.log("Successfully updated onboarding progress (script)")}catch(Ct){console.error("Failed to update onboarding progress (script):",Ct)}await F(),P("table"),x(null),d(""),f(""),h(""),l("");const at=We.data&&We.data.metadata&&We.data.metadata.scriptId?We.data.metadata.scriptId:null;at?setTimeout(()=>{O(Ct=>C.find(ut=>ut._id===at)||null)},300):O(null)}catch(Ve){i(Ve.response?.data?.error||Ve.message||"Failed to generate script")}finally{e(!1)}},te=xe=>{const Ve=m.find(qe=>qe._id===xe)||null;x(Ve),l(Ve?.category||"")},ce=xe=>{O(xe),P("script")},Se=()=>{P(xe=>xe==="form"?"table":"form"),O(null)},Pe=()=>{P("table"),O(null)},$e=async(xe,Ve)=>{G(xe);try{const qe="http://localhost:3001",We=await fetch(`${qe}/api/scripts/${xe}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:Ve})});if(!We.ok)throw new Error(`Failed to update script status: ${We.statusText}`);const at=await We.json();console.log("[SCRIPTS] Script status updated successfully:",at),j(Ct=>Ct.map(ut=>ut._id===xe?{...ut,isActive:Ve}:ut)),_?._id===xe&&O(Ct=>Ct?{...Ct,isActive:Ve}:null)}catch(qe){console.error("[SCRIPTS] Error updating script status:",qe),alert(`Failed to update script status: ${qe.message}`)}finally{G(null)}},rt=async xe=>{if(confirm("Are you sure you want to delete this script? This action cannot be undone.")){X(xe);try{const Ve="http://localhost:3001",qe=await fetch(`${Ve}/api/scripts/${xe}`,{method:"DELETE"});if(!qe.ok)throw new Error(`Failed to delete script: ${qe.statusText}`);const We=await qe.json();console.log("[SCRIPTS] Script deleted successfully:",We),j(at=>at.filter(Ct=>Ct._id!==xe)),_?._id===xe&&(O(null),P("table"))}catch(Ve){console.error("[SCRIPTS] Error deleting script:",Ve),alert(`Failed to delete script: ${Ve.message}`)}finally{X(null)}}},q=async xe=>{if(confirm("Are you sure you want to regenerate this script? The current version will be replaced.")){ae(xe);try{const Ve="http://localhost:3001",qe=le();if(!qe)throw new Error("Company ID not found");const We=await fetch(`${Ve}/api/scripts/${xe}/regenerate`,{method:"POST",headers:{"X-Company-ID":qe}});if(!We.ok)throw new Error(`Failed to regenerate script: ${We.statusText}`);const at=await We.json();console.log("[SCRIPTS] Script regenerated successfully:",at),j(Ct=>Ct.map(ut=>ut._id===xe?at.data:ut)),_?._id===xe&&O(at.data)}catch(Ve){console.error("[SCRIPTS] Error regenerating script:",Ve),alert(`Failed to regenerate script: ${Ve.message}`)}finally{ae(null)}}},fe=async(xe,Ve,qe)=>{try{Ne(mt=>[...mt,Ve]);const We="http://localhost:3001",at=le();if(!at)throw new Error("Company ID not found");const Ct=await fetch(`${We}/api/scripts/${xe}/refine`,{method:"POST",headers:{"Content-Type":"application/json","X-Company-ID":at},body:JSON.stringify({stepIndex:Ve,refinementPrompt:qe})});if(!Ct.ok)throw new Error(`Failed to refine script: ${Ct.statusText}`);const ut=await Ct.json();console.log("[SCRIPTS] Script part refined successfully:",ut),j(mt=>mt.map(Xt=>Xt._id===xe?ut.data.fullScript:Xt)),_?._id===xe&&O(ut.data.fullScript)}catch(We){console.error("[SCRIPTS] Error refining script:",We),alert(`Failed to refine script: ${We.message}`)}finally{Ne(We=>We.filter(at=>at!==Ve))}},Fe=async(xe,Ve,qe)=>{try{const We=qe.replica.trim()===""?" ":qe.replica;Ne(mt=>[...mt,Ve]);const at="http://localhost:3001";await new Promise(mt=>setTimeout(mt,100));const Ct=await fetch(`${at}/api/scripts/${xe}/content`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({stepIndex:Ve,newContent:{replica:We}})});if(!Ct.ok)throw new Error(`Failed to update script content: ${Ct.statusText}`);const ut=await Ct.json();console.log("[SCRIPTS] Script content updated successfully:",ut),j(mt=>mt.map(Xt=>Xt._id===xe?ut.data.fullScript:Xt)),_?._id===xe&&O(ut.data.fullScript)}catch(We){console.error("[SCRIPTS] Error updating script content:",We),alert(`Failed to update script content: ${We.message}`)}finally{Ne(We=>We.filter(at=>at!==Ve))}},et=async(xe,Ve,qe)=>{try{const We="http://localhost:3001",at=_?.script.filter(mn=>mn.phase===Ve)||[],Ct=_?.script.findIndex(mn=>mn.phase===Ve&&mn.replica===at[at.length-1].replica),ut=Ct!==void 0?Ct+1:_?.script.length||0,mt=await fetch(`${We}/api/scripts/${xe}/replicas`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phase:Ve,actor:qe,insertIndex:ut})});if(!mt.ok)throw new Error(`Failed to add replica: ${mt.statusText}`);const Xt=await mt.json();j(mn=>mn.map(S=>S._id===xe?Xt.data.fullScript:S)),_?._id===xe&&O(Xt.data.fullScript),it({index:Xt.data.insertedIndex,text:""})}catch(We){console.error("[SCRIPTS] Error adding replica:",We),alert(`Failed to add replica: ${We.message}`)}},Me=async(xe,Ve)=>{if(confirm("Are you sure you want to delete this replica? This action cannot be undone."))try{const qe="http://localhost:3001",We=await fetch(`${qe}/api/scripts/${xe}/replicas/${Ve}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!We.ok)throw new Error(`Failed to delete replica: ${We.statusText}`);const at=await We.json();j(Ct=>Ct.map(ut=>ut._id===xe?at.data.fullScript:ut)),_?._id===xe&&O(at.data.fullScript)}catch(qe){console.error("[SCRIPTS] Error deleting replica:",qe),alert(`Failed to delete replica: ${qe.message}`)}},[Xe,it]=k.useState(null),[Et,yt]=k.useState(null);return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:a.jsxs("div",{className:"max-w-6xl mx-auto p-6",children:[a.jsxs("div",{className:"mb-8 flex items-center justify-between bg-white rounded-2xl shadow-lg p-6 border border-gray-100",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("button",{onClick:H,className:"p-3 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-xl transition-all duration-200 group",title:"Back to Orchestrator",children:a.jsx(ra,{className:"w-6 h-6 group-hover:scale-110 transition-transform"})}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-3 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl",children:a.jsx(Vc,{className:"w-8 h-8 text-white"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Script Generator"}),a.jsx("p",{className:"text-gray-500 text-sm",children:"Create personalized call scripts for your gigs"})]})]})]}),D!=="form"&&a.jsxs("button",{className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-2 font-medium",onClick:Se,children:[a.jsx(Xs,{className:"w-5 h-5"}),"Generate New Script"]}),(D==="form"||D==="script")&&a.jsxs("button",{className:"px-6 py-3 bg-white text-gray-700 border-2 border-gray-200 rounded-xl hover:bg-gray-50 hover:border-gray-300 shadow-md hover:shadow-lg transition-all duration-200 flex items-center gap-2 font-medium",onClick:Pe,children:[a.jsx(ra,{className:"w-5 h-5"}),"Back to Scripts"]})]}),D==="table"&&a.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden",children:[a.jsx("div",{className:"p-6 border-b border-gray-100 bg-gradient-to-r from-gray-50 to-blue-50",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsxs("h3",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2",children:[a.jsx(Ys,{className:"w-6 h-6 text-blue-600"}),"Your Generated Scripts"]}),a.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"Manage and view all your call scripts"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Uc,{className:"w-4 h-4 text-gray-500"}),a.jsxs("select",{value:L,onChange:xe=>K(xe.target.value),className:"px-3 py-2 border border-gray-200 rounded-lg bg-white text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",children:[a.jsx("option",{value:"all",children:"All Scripts"}),a.jsx("option",{value:"active",children:"Active Scripts"}),a.jsx("option",{value:"inactive",children:"Inactive Scripts"})]})]})]})}),I?a.jsx("div",{className:"p-12 text-center",children:a.jsxs("div",{className:"inline-flex items-center gap-3 text-gray-600",children:[a.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),"Loading your scripts..."]})}):E?a.jsx("div",{className:"p-8 m-6 bg-red-50 border border-red-200 rounded-xl",children:a.jsxs("div",{className:"flex items-center gap-3 text-red-700",children:[a.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:a.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium",children:"Error loading scripts"}),a.jsx("p",{className:"text-sm",children:E})]})]})}):C.length===0?a.jsxs("div",{className:"p-12 text-center",children:[a.jsx("div",{className:"p-4 bg-gray-100 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:a.jsx(Vc,{className:"w-8 h-8 text-gray-400"})}),L==="all"?a.jsxs(a.Fragment,{children:[a.jsx("h4",{className:"text-lg font-medium text-gray-700 mb-2",children:"No scripts yet"}),a.jsx("p",{className:"text-gray-500 mb-6",children:"Create your first call script to get started"}),a.jsxs("button",{className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-2 font-medium mx-auto",onClick:Se,children:[a.jsx(Xs,{className:"w-5 h-5"}),"Generate Your First Script"]})]}):L==="active"?a.jsxs(a.Fragment,{children:[a.jsx("h4",{className:"text-lg font-medium text-gray-700 mb-2",children:"No active scripts"}),a.jsx("p",{className:"text-gray-500 mb-6",children:"All your scripts are currently inactive. You can activate them or create new ones."}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("button",{className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-2 font-medium mx-auto",onClick:Se,children:[a.jsx(Xs,{className:"w-5 h-5"}),"Create New Script"]}),a.jsxs("button",{className:"px-6 py-3 bg-white text-gray-700 border-2 border-gray-200 rounded-xl hover:bg-gray-50 hover:border-gray-300 shadow-md hover:shadow-lg transition-all duration-200 flex items-center gap-2 font-medium mx-auto",onClick:()=>K("all"),children:[a.jsx(Uc,{className:"w-5 h-5"}),"View All Scripts"]})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("h4",{className:"text-lg font-medium text-gray-700 mb-2",children:"No inactive scripts"}),a.jsx("p",{className:"text-gray-500 mb-6",children:"All your scripts are currently active. Great job keeping your scripts organized!"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("button",{className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transition-all duration-200 flex items-center gap-2 font-medium mx-auto",onClick:Se,children:[a.jsx(Xs,{className:"w-5 h-5"}),"Create New Script"]}),a.jsxs("button",{className:"px-6 py-3 bg-white text-gray-700 border-2 border-gray-200 rounded-xl hover:bg-gray-50 hover:border-gray-300 shadow-md hover:shadow-lg transition-all duration-200 flex items-center gap-2 font-medium mx-auto",onClick:()=>K("all"),children:[a.jsx(Uc,{className:"w-5 h-5"}),"View All Scripts"]})]})]})]}):a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"min-w-full",children:[a.jsx("thead",{className:"bg-gradient-to-r from-gray-50 to-blue-50",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Gig"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Target Client"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Language"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Status"}),a.jsx("th",{className:"px-6 py-4 text-left text-sm font-semibold text-gray-700",children:"Created"}),a.jsx("th",{className:"px-6 py-4 text-center text-sm font-semibold text-gray-700",children:"Action"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-100",children:C.map((xe,Ve)=>(xe.gig||m.find(qe=>qe._id===xe.gigId),a.jsxs("tr",{className:"hover:bg-blue-50 transition-colors duration-150 group",children:[a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-blue-100 rounded-lg group-hover:bg-blue-200 transition-colors",children:a.jsx(Ys,{className:"w-4 h-4 text-blue-600"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("p",{className:"font-semibold text-gray-800",children:xe.gig?.title||"Untitled Gig"})}),a.jsx("p",{className:"text-sm text-gray-500",children:xe.gig?.category||"No category"})]})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-purple-100 text-purple-800",children:xe.targetClient})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ks,{className:"w-4 h-4 text-gray-400"}),a.jsx("span",{className:"text-gray-700",children:xe.language})]})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${xe.isActive?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:[a.jsx("div",{className:`w-2 h-2 rounded-full mr-1 ${xe.isActive?"bg-green-500":"bg-gray-500"}`}),xe.isActive?"Active":"Inactive"]})})}),a.jsx("td",{className:"px-6 py-4",children:a.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[a.jsx(Er,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm",children:new Date(xe.createdAt).toLocaleDateString()})]})}),a.jsx("td",{className:"px-6 py-4 text-center",children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-2 text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-lg transition-all duration-200 font-medium",onClick:()=>ce(xe),title:"View script",children:[a.jsx(Bc,{className:"w-4 h-4"}),"View"]}),a.jsxs("button",{className:`inline-flex items-center gap-1 px-3 py-2 rounded-lg transition-all duration-200 font-medium disabled:opacity-50 disabled:cursor-not-allowed ${xe.isActive?"text-orange-600 hover:text-orange-800 hover:bg-orange-50":"text-green-600 hover:text-green-800 hover:bg-green-50"}`,onClick:()=>$e(xe._id,!xe.isActive),disabled:B===xe._id,title:xe.isActive?"Deactivate script":"Activate script",children:[B===xe._id?a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}):xe.isActive?a.jsx(h1,{className:"w-4 h-4"}):a.jsx(u1,{className:"w-4 h-4"}),B===xe._id?"Updating...":xe.isActive?"Deactivate":"Activate"]}),a.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-2 text-red-600 hover:text-red-800 hover:bg-red-50 rounded-lg transition-all duration-200 font-medium disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>rt(xe._id),disabled:R===xe._id,title:"Delete script",children:[R===xe._id?a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-red-600"}):a.jsx(er,{className:"w-4 h-4"}),R===xe._id?"Deleting...":"Delete"]})]})})]},xe._id)))})]})})]}),D==="script"&&_&&a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden animate-fade-in",children:[a.jsx("div",{className:"p-6 bg-gradient-to-r from-blue-600 to-purple-600 text-white",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"p-3 bg-white/20 rounded-xl",children:a.jsx(Vc,{className:"w-8 h-8"})}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[a.jsx("h3",{className:"text-2xl font-bold",children:"Call Script"}),a.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-white/20 text-white border border-white/30",children:"Structured Call"})]}),a.jsx("p",{className:"text-blue-100",children:"Ready to use conversation guide with structured phases"})]})]}),a.jsx("button",{onClick:()=>q(_._id),disabled:de===_._id,className:"px-4 py-2 bg-white/20 hover:bg-white/30 disabled:bg-white/10 disabled:cursor-not-allowed rounded-lg flex items-center gap-2 transition-all duration-200",children:de===_._id?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Regenerating..."]}):a.jsxs(a.Fragment,{children:[a.jsx($r,{className:"w-4 h-4"}),"Regenerate Script"]})})]})}),a.jsxs("div",{className:"p-6 border-b border-gray-100 bg-gray-50",children:[a.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ys,{className:"w-4 h-4 text-blue-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Gig"}),a.jsx("p",{className:"font-medium text-gray-800",children:_.gig?.title||"Untitled Gig"}),a.jsx("p",{className:"text-xs text-gray-500",children:_.gig?.category||"No category"})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx($l,{className:"w-4 h-4 text-purple-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Target Client"}),a.jsx("p",{className:"font-medium text-gray-800",children:_.targetClient})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Ks,{className:"w-4 h-4 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Language"}),a.jsx("p",{className:"font-medium text-gray-800",children:_.language})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[_.isActive?a.jsx(h1,{className:"w-4 h-4 text-green-600"}):a.jsx(u1,{className:"w-4 h-4 text-gray-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Status"}),a.jsx("p",{className:`font-medium ${_.isActive?"text-green-800":"text-gray-800"}`,children:_.isActive?"Active":"Inactive"})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Er,{className:"w-4 h-4 text-orange-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Created"}),a.jsx("p",{className:"font-medium text-gray-800",children:new Date(_.createdAt).toLocaleDateString()})]})]})]}),_.details&&a.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-xl",children:a.jsxs("p",{className:"text-sm text-gray-600",children:[a.jsx("span",{className:"font-medium",children:"Context:"})," ",_.details]})})]}),a.jsx("div",{className:"p-6",children:a.jsx("div",{className:"space-y-8",children:de===_?._id?a.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"}),a.jsx("p",{className:"text-gray-600 font-medium",children:"Regenerating Script..."}),a.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"This may take a few moments"})]}):Array.isArray(_?.script)&&_.script.length>0?g0e(_.script).map((xe,Ve)=>{const qe=m0e(xe.phaseName),We=qe.icon;return a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:`mb-6 p-4 rounded-xl border-2 ${qe.bgColor} ${qe.borderColor} shadow-sm`,children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`p-3 bg-white rounded-lg shadow-md ${qe.color}`,children:a.jsx(We,{className:"w-6 h-6"})}),a.jsxs("div",{children:[a.jsx("h4",{className:`text-lg font-bold ${qe.color}`,children:xe.phaseName}),a.jsx("p",{className:"text-sm text-gray-600 mt-1",children:qe.description})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:()=>et(_._id,xe.phaseName,"agent"),className:"px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors flex items-center gap-1",children:[a.jsx(Xs,{className:"w-4 h-4"}),"Add Agent Response"]}),a.jsxs("button",{onClick:()=>et(_._id,xe.phaseName,"lead"),className:"px-3 py-1 text-sm bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors flex items-center gap-1",children:[a.jsx(Xs,{className:"w-4 h-4"}),"Add Lead Response"]})]})]})}),a.jsx("div",{className:"space-y-4 ml-4 border-l-2 border-gray-200 pl-6 relative",children:xe.steps.map((at,Ct)=>{const ut=_.script.findIndex(mt=>mt.phase===at.phase&&mt.actor===at.actor&&mt.replica===at.replica);return a.jsxs("div",{className:"flex items-start gap-4 group relative",children:[a.jsx("div",{className:`absolute -left-7 top-4 w-3 h-3 rounded-full border-2 border-white shadow-sm ${qe.bgColor} ${qe.borderColor}`}),a.jsx("div",{className:"flex-shrink-0",children:at.actor==="agent"?a.jsx("div",{className:"p-3 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl shadow-lg",children:a.jsx(Vc,{className:"w-5 h-5 text-white"})}):a.jsx("div",{className:"p-3 bg-gradient-to-r from-green-500 to-green-600 rounded-xl shadow-lg",children:a.jsx($l,{className:"w-5 h-5 text-white"})})}),a.jsx("div",{className:"flex-1 min-w-0",children:a.jsx("div",{className:"rounded-2xl px-6 py-4 shadow-md border-l-4 transition-all duration-200 group-hover:shadow-lg "+(at.actor==="agent"?"bg-gradient-to-r from-blue-50 to-blue-100 border-blue-500 text-blue-900":"bg-gradient-to-r from-green-50 to-green-100 border-green-500 text-green-900"),children:a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs("span",{className:"font-bold text-sm uppercase tracking-wide opacity-75",children:[at.actor==="agent"?"Agent":"Lead",":"]}),a.jsxs("div",{className:"min-h-[24px]",children:[" ",ve.includes(ut)?a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-current"}),a.jsx("span",{className:"text-sm font-medium",children:"Updating response..."})]}):a.jsx("p",{className:"leading-relaxed whitespace-pre-wrap",children:at.replica})]})]})})}),a.jsxs("div",{className:"absolute right-0 top-0 opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-2",children:[a.jsx("button",{onClick:()=>Me(_._id,ut),className:"p-2 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200",title:"Delete replica",children:a.jsx(er,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>it({index:ut,text:at.replica}),className:"p-2 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200",title:"Edit directly",children:a.jsx(Hg,{className:"w-4 h-4"})}),a.jsx("button",{onClick:()=>yt({index:ut,prompt:""}),className:"p-2 text-gray-600 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-all duration-200",title:"Refine with prompt",children:a.jsx(_i,{className:"w-4 h-4"})})]}),Xe?.index===ut&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-2xl w-full max-h-[90vh] flex flex-col",children:[a.jsx("h3",{className:"text-lg font-bold mb-4",children:"Edit Response"}),a.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto",children:a.jsx("textarea",{value:Xe.text,onChange:mt=>it({...Xe,text:mt.target.value}),className:"w-full h-full min-h-[200px] p-3 border-2 border-gray-200 rounded-lg mb-4 resize-none"})}),a.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[a.jsx("button",{onClick:()=>it(null),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:"Cancel"}),a.jsx("button",{onClick:()=>{Fe(_._id,ut,{replica:Xe.text}),it(null)},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Save Changes"})]})]})}),Et?.index===ut&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-2xl w-full max-h-[90vh] flex flex-col",children:[a.jsx("h3",{className:"text-lg font-bold mb-4",children:"Refine Response"}),a.jsxs("div",{className:"flex-1 min-h-0 overflow-y-auto",children:[a.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg",children:[a.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Current response:"}),a.jsx("p",{className:"text-gray-800",children:at.replica})]}),a.jsx("textarea",{value:Et.prompt,onChange:mt=>yt({...Et,prompt:mt.target.value}),placeholder:"Describe how you want to refine this response...",className:"w-full h-full min-h-[200px] p-3 border-2 border-gray-200 rounded-lg resize-none"})]}),a.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[a.jsx("button",{onClick:()=>yt(null),className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg",children:"Cancel"}),a.jsx("button",{onClick:()=>{fe(_._id,ut,Et.prompt),yt(null)},className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Refine Response"})]})]})})]},Ct)})})]},Ve)}):a.jsxs("div",{className:"text-center py-12",children:[a.jsx("div",{className:"p-4 bg-gray-100 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:a.jsx(Vc,{className:"w-8 h-8 text-gray-400"})}),a.jsx("p",{className:"text-gray-500",children:"No script content available"})]})})})]}),D==="form"&&a.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden animate-fade-in",children:[a.jsx("div",{className:"p-6 bg-gradient-to-r from-purple-600 to-blue-600 text-white",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"p-3 bg-white/20 rounded-xl",children:a.jsx(Xs,{className:"w-8 h-8"})}),a.jsxs("div",{children:[a.jsx("h3",{className:"text-2xl font-bold",children:"Create New Script"}),a.jsx("p",{className:"text-purple-100",children:"Generate a personalized call script for your gig"})]})]})}),a.jsxs("form",{onSubmit:re,className:"p-8 space-y-6",children:[a.jsxs("div",{className:"mb-8 p-6 bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-xl",children:[a.jsxs("h4",{className:"text-lg font-bold text-purple-800 mb-2 flex items-center gap-2",children:[a.jsx(Ys,{className:"w-5 h-5"}),"Structured Call Script"]}),a.jsx("p",{className:"text-purple-700 mb-4",children:"Your script will be generated following a proven methodology with these key phases:"}),a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Lg.map((xe,Ve)=>{const qe=xe.icon;return a.jsx("div",{className:`p-3 rounded-lg border ${xe.bgColor} ${xe.borderColor} transition-all duration-200 hover:shadow-md`,children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(qe,{className:`w-4 h-4 ${xe.color}`}),a.jsx("p",{className:`text-xs font-semibold ${xe.color} leading-tight`,children:xe.name})]})},Ve)})})]}),a.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Select Gig ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{value:g?._id||"",onChange:xe=>te(xe.target.value),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-white",required:!0,children:[a.jsx("option",{value:"",children:"Choose a gig to create script for..."}),m.map(xe=>a.jsx("option",{value:xe._id,children:xe.title||xe.category},xe._id))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Domain"}),a.jsx("input",{type:"text",value:o,readOnly:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl bg-gray-50 text-gray-600 cursor-not-allowed",placeholder:"Auto-filled from selected gig"})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Target Client (DISC Profile) ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("select",{value:c,onChange:xe=>d(xe.target.value),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-white",required:!0,children:[a.jsx("option",{value:"",children:"Select client personality type..."}),a.jsx("option",{value:"D",children:" D: Direct and results-oriented"}),a.jsx("option",{value:"I",children:" I: Enthusiastic and relational"}),a.jsx("option",{value:"S",children:" S: Reassuring and stable"}),a.jsx("option",{value:"C",children:" C: Structured and analytical"})]})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Context ",a.jsx("span",{className:"text-gray-400",children:"(optional but recommended)"})]}),a.jsx("textarea",{value:u,onChange:xe=>h(xe.target.value),placeholder:"Provide additional context like client history, emotional state, common objections, or specific situation details...",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-white resize-none",rows:3})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Language & Tone ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",value:p,onChange:xe=>f(xe.target.value),placeholder:"e.g., Professional yet warm, Casual and friendly, Formal and authoritative...",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 bg-white",required:!0})]}),a.jsx("div",{className:"pt-4",children:a.jsx("button",{type:"submit",disabled:t||!g||!o.trim()||!c.trim()||!p.trim(),className:"w-full px-8 py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:from-blue-700 hover:to-purple-700 focus:outline-none focus:ring-4 focus:ring-blue-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 font-semibold text-lg shadow-lg hover:shadow-xl transition-all duration-200",children:t?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white"}),"Generating Your Script..."]}):a.jsxs(a.Fragment,{children:[a.jsx(Xs,{className:"w-6 h-6"}),"Generate Script"]})})}),r&&a.jsx("div",{className:"p-6 bg-red-50 border-2 border-red-200 rounded-xl animate-bounce",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:a.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),a.jsxs("div",{children:[a.jsx("p",{className:"text-red-800 font-semibold",children:"Something went wrong"}),a.jsx("p",{className:"text-red-700 text-sm mt-1",children:r})]})]})})]})]})]})})};function b0e(){const[t,e]=k.useState("company-onboarding"),[s,n]=k.useState(!0),[r,i]=k.useState("Admin User"),o=window.location.pathname==="/zoho-callback",l=window.location.pathname==="/zoho-auth";k.useEffect(()=>{const u=De.get("userId");if(!u&&!o&&!l){console.log("User ID not found, redirecting to /auth"),window.location.href="/auth";return}(async()=>{if(u)try{const b="https://v25registrationbackend-production.up.railway.app";console.log("Fetching user details for userId:",u),console.log("Registration backend URL:",b);const g=await fetch(`${b}/api/users/${u}`);if(console.log("Response status:",g.status),g.ok){const x=await g.json();console.log("User data received:",x),x.data&&x.data.fullName?(console.log("Setting user full name to:",x.data.fullName),i(x.data.fullName)):console.log("No fullName in user data")}else console.error("Response not OK:",g.status,g.statusText)}catch(b){console.error("Error fetching user details:",b)}else console.log("No userId found in cookies")})(),(async()=>{ri.getInstance()})().catch(b=>{console.debug("App: Error initializing Zoho",b)});const f=b=>{b.detail&&b.detail.tab&&e(b.detail.tab)},m=localStorage.getItem("activeTab");return m&&(e(m),localStorage.removeItem("activeTab")),window.addEventListener("tabChange",f),()=>{window.removeEventListener("tabChange",f)}},[]);const c=()=>{const u=De.get();Object.keys(u).forEach(h=>{De.remove(h,{path:"/"}),De.remove(h)}),localStorage.clear(),window.location.href="/app1"},d=()=>{if(o)return a.jsx(h0e,{});if(l)return a.jsx(p0e,{});switch(t){case"profile-creation":return a.jsx(f3,{});case"gig-generation":return a.jsx(m3,{});case"matching":return a.jsx(iF,{});case"approval-publishing":return a.jsx(E2,{});case"optimization":return a.jsx(EO,{});case"knowledge-base":return a.jsx(f0e,{});case"script-generator":return a.jsx(x0e,{});case"company-onboarding":default:return a.jsx(u0e,{})}};return o||l?a.jsxs("div",{className:"flex h-screen bg-gray-50",children:[a.jsx(w1,{position:"top-right"}),a.jsx("main",{className:"flex-1 overflow-y-auto",children:d()})]}):a.jsxs("div",{className:"flex h-screen bg-gray-50",children:[a.jsx(w1,{position:"top-right"}),a.jsxs("div",{className:`${s?"translate-x-0":"-translate-x-full"} fixed inset-y-0 left-0 z-30 w-64 bg-indigo-900 text-white transition-transform duration-300 ease-in-out md:relative md:translate-x-0`,children:[a.jsxs("div",{className:"flex h-16 items-center justify-between px-4 border-b border-indigo-800",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(qR,{className:"h-6 w-6"}),a.jsx("span",{className:"text-xl font-bold",children:"Smart Orchestrator"})]}),a.jsx("button",{className:"md:hidden",onClick:()=>n(!1),children:a.jsx(Pi,{className:"h-6 w-6"})})]}),a.jsxs("nav",{className:"mt-6 px-4",children:[a.jsx("div",{className:"space-y-4",children:a.jsxs("button",{className:`flex w-full items-center space-x-2 rounded-lg py-2 px-3 ${t==="company-onboarding"?"bg-indigo-800":"hover:bg-indigo-800"}`,onClick:()=>e("company-onboarding"),children:[a.jsx(Mc,{className:"h-5 w-5"}),a.jsx("span",{children:"Company Onboarding"})]})}),a.jsx("div",{className:"absolute bottom-0 left-0 right-0 border-t border-indigo-800 p-4",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("button",{className:"flex w-full items-center space-x-2 rounded-lg py-2 px-3 hover:bg-indigo-800",children:[a.jsx(Qn,{className:"h-5 w-5"}),a.jsx("span",{children:"Settings"})]}),a.jsxs("button",{className:"flex w-full items-center space-x-2 rounded-lg py-2 px-3 hover:bg-indigo-800",children:[a.jsx(n1,{className:"h-5 w-5"}),a.jsx("span",{children:"Help"})]}),a.jsxs("button",{onClick:c,className:"flex w-full items-center space-x-2 rounded-lg py-2 px-3 hover:bg-indigo-800",children:[a.jsx(p4,{className:"h-5 w-5"}),a.jsx("span",{children:"Logout"})]})]})})]})]}),a.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[a.jsx("header",{className:"bg-white shadow-sm",children:a.jsxs("div",{className:"flex h-16 items-center justify-between px-4",children:[a.jsx("button",{className:"md:hidden",onClick:()=>n(!0),children:a.jsx(f4,{className:"h-6 w-6"})}),a.jsx("div",{className:"flex items-center space-x-4",children:a.jsx("div",{className:"relative",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"h-8 w-8 rounded-full bg-indigo-600 flex items-center justify-center text-white",children:r.charAt(0).toUpperCase()}),a.jsx("span",{className:"font-medium",children:r})]})})})]})}),a.jsx("main",{className:"flex-1 overflow-y-auto p-4",children:d()})]})]})}let Bv=null;function TR(t){const{container:e}=t,s=e?e.querySelector("#root"):document.getElementById("root");s?(console.log("[app11] Rendering in container:",s),Bv||(Bv=Kv(s)),Bv.render(a.jsx(k.StrictMode,{children:a.jsx(b0e,{})}))):console.warn("[app11] Root element not found!")}VR.__POWERED_BY_QIANKUN__?(console.log("[app11] Running inside Qiankun"),TR({})):(console.log("[app11] Running in standalone mode"),TR({}))});
